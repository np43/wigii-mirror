/*! jQuery v1.12.4 | (c) jQuery Foundation | jquery.org/license */
!function(a,b){"object"==typeof module&&"object"==typeof module.exports?module.exports=a.document?b(a,!0):function(a){if(!a.document)throw new Error("jQuery requires a window with a document");return b(a)}:b(a)}("undefined"!=typeof window?window:this,function(a,b){var c=[],d=a.document,e=c.slice,f=c.concat,g=c.push,h=c.indexOf,i={},j=i.toString,k=i.hasOwnProperty,l={},m="1.12.4",n=function(a,b){return new n.fn.init(a,b)},o=/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,p=/^-ms-/,q=/-([\da-z])/gi,r=function(a,b){return b.toUpperCase()};n.fn=n.prototype={jquery:m,constructor:n,selector:"",length:0,toArray:function(){return e.call(this)},get:function(a){return null!=a?0>a?this[a+this.length]:this[a]:e.call(this)},pushStack:function(a){var b=n.merge(this.constructor(),a);return b.prevObject=this,b.context=this.context,b},each:function(a){return n.each(this,a)},map:function(a){return this.pushStack(n.map(this,function(b,c){return a.call(b,c,b)}))},slice:function(){return this.pushStack(e.apply(this,arguments))},first:function(){return this.eq(0)},last:function(){return this.eq(-1)},eq:function(a){var b=this.length,c=+a+(0>a?b:0);return this.pushStack(c>=0&&b>c?[this[c]]:[])},end:function(){return this.prevObject||this.constructor()},push:g,sort:c.sort,splice:c.splice},n.extend=n.fn.extend=function(){var a,b,c,d,e,f,g=arguments[0]||{},h=1,i=arguments.length,j=!1;for("boolean"==typeof g&&(j=g,g=arguments[h]||{},h++),"object"==typeof g||n.isFunction(g)||(g={}),h===i&&(g=this,h--);i>h;h++)if(null!=(e=arguments[h]))for(d in e)a=g[d],c=e[d],g!==c&&(j&&c&&(n.isPlainObject(c)||(b=n.isArray(c)))?(b?(b=!1,f=a&&n.isArray(a)?a:[]):f=a&&n.isPlainObject(a)?a:{},g[d]=n.extend(j,f,c)):void 0!==c&&(g[d]=c));return g},n.extend({expando:"jQuery"+(m+Math.random()).replace(/\D/g,""),isReady:!0,error:function(a){throw new Error(a)},noop:function(){},isFunction:function(a){return"function"===n.type(a)},isArray:Array.isArray||function(a){return"array"===n.type(a)},isWindow:function(a){return null!=a&&a==a.window},isNumeric:function(a){var b=a&&a.toString();return!n.isArray(a)&&b-parseFloat(b)+1>=0},isEmptyObject:function(a){var b;for(b in a)return!1;return!0},isPlainObject:function(a){var b;if(!a||"object"!==n.type(a)||a.nodeType||n.isWindow(a))return!1;try{if(a.constructor&&!k.call(a,"constructor")&&!k.call(a.constructor.prototype,"isPrototypeOf"))return!1}catch(c){return!1}if(!l.ownFirst)for(b in a)return k.call(a,b);for(b in a);return void 0===b||k.call(a,b)},type:function(a){return null==a?a+"":"object"==typeof a||"function"==typeof a?i[j.call(a)]||"object":typeof a},globalEval:function(b){b&&n.trim(b)&&(a.execScript||function(b){a.eval.call(a,b)})(b)},camelCase:function(a){return a.replace(p,"ms-").replace(q,r)},nodeName:function(a,b){return a.nodeName&&a.nodeName.toLowerCase()===b.toLowerCase()},each:function(a,b){var c,d=0;if(s(a)){for(c=a.length;c>d;d++)if(b.call(a[d],d,a[d])===!1)break}else for(d in a)if(b.call(a[d],d,a[d])===!1)break;return a},trim:function(a){return null==a?"":(a+"").replace(o,"")},makeArray:function(a,b){var c=b||[];return null!=a&&(s(Object(a))?n.merge(c,"string"==typeof a?[a]:a):g.call(c,a)),c},inArray:function(a,b,c){var d;if(b){if(h)return h.call(b,a,c);for(d=b.length,c=c?0>c?Math.max(0,d+c):c:0;d>c;c++)if(c in b&&b[c]===a)return c}return-1},merge:function(a,b){var c=+b.length,d=0,e=a.length;while(c>d)a[e++]=b[d++];if(c!==c)while(void 0!==b[d])a[e++]=b[d++];return a.length=e,a},grep:function(a,b,c){for(var d,e=[],f=0,g=a.length,h=!c;g>f;f++)d=!b(a[f],f),d!==h&&e.push(a[f]);return e},map:function(a,b,c){var d,e,g=0,h=[];if(s(a))for(d=a.length;d>g;g++)e=b(a[g],g,c),null!=e&&h.push(e);else for(g in a)e=b(a[g],g,c),null!=e&&h.push(e);return f.apply([],h)},guid:1,proxy:function(a,b){var c,d,f;return"string"==typeof b&&(f=a[b],b=a,a=f),n.isFunction(a)?(c=e.call(arguments,2),d=function(){return a.apply(b||this,c.concat(e.call(arguments)))},d.guid=a.guid=a.guid||n.guid++,d):void 0},now:function(){return+new Date},support:l}),"function"==typeof Symbol&&(n.fn[Symbol.iterator]=c[Symbol.iterator]),n.each("Boolean Number String Function Array Date RegExp Object Error Symbol".split(" "),function(a,b){i["[object "+b+"]"]=b.toLowerCase()});function s(a){var b=!!a&&"length"in a&&a.length,c=n.type(a);return"function"===c||n.isWindow(a)?!1:"array"===c||0===b||"number"==typeof b&&b>0&&b-1 in a}var t=function(a){var b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u="sizzle"+1*new Date,v=a.document,w=0,x=0,y=ga(),z=ga(),A=ga(),B=function(a,b){return a===b&&(l=!0),0},C=1<<31,D={}.hasOwnProperty,E=[],F=E.pop,G=E.push,H=E.push,I=E.slice,J=function(a,b){for(var c=0,d=a.length;d>c;c++)if(a[c]===b)return c;return-1},K="checked|selected|async|autofocus|autoplay|controls|defer|disabled|hidden|ismap|loop|multiple|open|readonly|required|scoped",L="[\\x20\\t\\r\\n\\f]",M="(?:\\\\.|[\\w-]|[^\\x00-\\xa0])+",N="\\["+L+"*("+M+")(?:"+L+"*([*^$|!~]?=)"+L+"*(?:'((?:\\\\.|[^\\\\'])*)'|\"((?:\\\\.|[^\\\\\"])*)\"|("+M+"))|)"+L+"*\\]",O=":("+M+")(?:\\((('((?:\\\\.|[^\\\\'])*)'|\"((?:\\\\.|[^\\\\\"])*)\")|((?:\\\\.|[^\\\\()[\\]]|"+N+")*)|.*)\\)|)",P=new RegExp(L+"+","g"),Q=new RegExp("^"+L+"+|((?:^|[^\\\\])(?:\\\\.)*)"+L+"+$","g"),R=new RegExp("^"+L+"*,"+L+"*"),S=new RegExp("^"+L+"*([>+~]|"+L+")"+L+"*"),T=new RegExp("="+L+"*([^\\]'\"]*?)"+L+"*\\]","g"),U=new RegExp(O),V=new RegExp("^"+M+"$"),W={ID:new RegExp("^#("+M+")"),CLASS:new RegExp("^\\.("+M+")"),TAG:new RegExp("^("+M+"|[*])"),ATTR:new RegExp("^"+N),PSEUDO:new RegExp("^"+O),CHILD:new RegExp("^:(only|first|last|nth|nth-last)-(child|of-type)(?:\\("+L+"*(even|odd|(([+-]|)(\\d*)n|)"+L+"*(?:([+-]|)"+L+"*(\\d+)|))"+L+"*\\)|)","i"),bool:new RegExp("^(?:"+K+")$","i"),needsContext:new RegExp("^"+L+"*[>+~]|:(even|odd|eq|gt|lt|nth|first|last)(?:\\("+L+"*((?:-\\d)?\\d*)"+L+"*\\)|)(?=[^-]|$)","i")},X=/^(?:input|select|textarea|button)$/i,Y=/^h\d$/i,Z=/^[^{]+\{\s*\[native \w/,$=/^(?:#([\w-]+)|(\w+)|\.([\w-]+))$/,_=/[+~]/,aa=/'|\\/g,ba=new RegExp("\\\\([\\da-f]{1,6}"+L+"?|("+L+")|.)","ig"),ca=function(a,b,c){var d="0x"+b-65536;return d!==d||c?b:0>d?String.fromCharCode(d+65536):String.fromCharCode(d>>10|55296,1023&d|56320)},da=function(){m()};try{H.apply(E=I.call(v.childNodes),v.childNodes),E[v.childNodes.length].nodeType}catch(ea){H={apply:E.length?function(a,b){G.apply(a,I.call(b))}:function(a,b){var c=a.length,d=0;while(a[c++]=b[d++]);a.length=c-1}}}function fa(a,b,d,e){var f,h,j,k,l,o,r,s,w=b&&b.ownerDocument,x=b?b.nodeType:9;if(d=d||[],"string"!=typeof a||!a||1!==x&&9!==x&&11!==x)return d;if(!e&&((b?b.ownerDocument||b:v)!==n&&m(b),b=b||n,p)){if(11!==x&&(o=$.exec(a)))if(f=o[1]){if(9===x){if(!(j=b.getElementById(f)))return d;if(j.id===f)return d.push(j),d}else if(w&&(j=w.getElementById(f))&&t(b,j)&&j.id===f)return d.push(j),d}else{if(o[2])return H.apply(d,b.getElementsByTagName(a)),d;if((f=o[3])&&c.getElementsByClassName&&b.getElementsByClassName)return H.apply(d,b.getElementsByClassName(f)),d}if(c.qsa&&!A[a+" "]&&(!q||!q.test(a))){if(1!==x)w=b,s=a;else if("object"!==b.nodeName.toLowerCase()){(k=b.getAttribute("id"))?k=k.replace(aa,"\\$&"):b.setAttribute("id",k=u),r=g(a),h=r.length,l=V.test(k)?"#"+k:"[id='"+k+"']";while(h--)r[h]=l+" "+qa(r[h]);s=r.join(","),w=_.test(a)&&oa(b.parentNode)||b}if(s)try{return H.apply(d,w.querySelectorAll(s)),d}catch(y){}finally{k===u&&b.removeAttribute("id")}}}return i(a.replace(Q,"$1"),b,d,e)}function ga(){var a=[];function b(c,e){return a.push(c+" ")>d.cacheLength&&delete b[a.shift()],b[c+" "]=e}return b}function ha(a){return a[u]=!0,a}function ia(a){var b=n.createElement("div");try{return!!a(b)}catch(c){return!1}finally{b.parentNode&&b.parentNode.removeChild(b),b=null}}function ja(a,b){var c=a.split("|"),e=c.length;while(e--)d.attrHandle[c[e]]=b}function ka(a,b){var c=b&&a,d=c&&1===a.nodeType&&1===b.nodeType&&(~b.sourceIndex||C)-(~a.sourceIndex||C);if(d)return d;if(c)while(c=c.nextSibling)if(c===b)return-1;return a?1:-1}function la(a){return function(b){var c=b.nodeName.toLowerCase();return"input"===c&&b.type===a}}function ma(a){return function(b){var c=b.nodeName.toLowerCase();return("input"===c||"button"===c)&&b.type===a}}function na(a){return ha(function(b){return b=+b,ha(function(c,d){var e,f=a([],c.length,b),g=f.length;while(g--)c[e=f[g]]&&(c[e]=!(d[e]=c[e]))})})}function oa(a){return a&&"undefined"!=typeof a.getElementsByTagName&&a}c=fa.support={},f=fa.isXML=function(a){var b=a&&(a.ownerDocument||a).documentElement;return b?"HTML"!==b.nodeName:!1},m=fa.setDocument=function(a){var b,e,g=a?a.ownerDocument||a:v;return g!==n&&9===g.nodeType&&g.documentElement?(n=g,o=n.documentElement,p=!f(n),(e=n.defaultView)&&e.top!==e&&(e.addEventListener?e.addEventListener("unload",da,!1):e.attachEvent&&e.attachEvent("onunload",da)),c.attributes=ia(function(a){return a.className="i",!a.getAttribute("className")}),c.getElementsByTagName=ia(function(a){return a.appendChild(n.createComment("")),!a.getElementsByTagName("*").length}),c.getElementsByClassName=Z.test(n.getElementsByClassName),c.getById=ia(function(a){return o.appendChild(a).id=u,!n.getElementsByName||!n.getElementsByName(u).length}),c.getById?(d.find.ID=function(a,b){if("undefined"!=typeof b.getElementById&&p){var c=b.getElementById(a);return c?[c]:[]}},d.filter.ID=function(a){var b=a.replace(ba,ca);return function(a){return a.getAttribute("id")===b}}):(delete d.find.ID,d.filter.ID=function(a){var b=a.replace(ba,ca);return function(a){var c="undefined"!=typeof a.getAttributeNode&&a.getAttributeNode("id");return c&&c.value===b}}),d.find.TAG=c.getElementsByTagName?function(a,b){return"undefined"!=typeof b.getElementsByTagName?b.getElementsByTagName(a):c.qsa?b.querySelectorAll(a):void 0}:function(a,b){var c,d=[],e=0,f=b.getElementsByTagName(a);if("*"===a){while(c=f[e++])1===c.nodeType&&d.push(c);return d}return f},d.find.CLASS=c.getElementsByClassName&&function(a,b){return"undefined"!=typeof b.getElementsByClassName&&p?b.getElementsByClassName(a):void 0},r=[],q=[],(c.qsa=Z.test(n.querySelectorAll))&&(ia(function(a){o.appendChild(a).innerHTML="<a id='"+u+"'></a><select id='"+u+"-\r\\' msallowcapture=''><option selected=''></option></select>",a.querySelectorAll("[msallowcapture^='']").length&&q.push("[*^$]="+L+"*(?:''|\"\")"),a.querySelectorAll("[selected]").length||q.push("\\["+L+"*(?:value|"+K+")"),a.querySelectorAll("[id~="+u+"-]").length||q.push("~="),a.querySelectorAll(":checked").length||q.push(":checked"),a.querySelectorAll("a#"+u+"+*").length||q.push(".#.+[+~]")}),ia(function(a){var b=n.createElement("input");b.setAttribute("type","hidden"),a.appendChild(b).setAttribute("name","D"),a.querySelectorAll("[name=d]").length&&q.push("name"+L+"*[*^$|!~]?="),a.querySelectorAll(":enabled").length||q.push(":enabled",":disabled"),a.querySelectorAll("*,:x"),q.push(",.*:")})),(c.matchesSelector=Z.test(s=o.matches||o.webkitMatchesSelector||o.mozMatchesSelector||o.oMatchesSelector||o.msMatchesSelector))&&ia(function(a){c.disconnectedMatch=s.call(a,"div"),s.call(a,"[s!='']:x"),r.push("!=",O)}),q=q.length&&new RegExp(q.join("|")),r=r.length&&new RegExp(r.join("|")),b=Z.test(o.compareDocumentPosition),t=b||Z.test(o.contains)?function(a,b){var c=9===a.nodeType?a.documentElement:a,d=b&&b.parentNode;return a===d||!(!d||1!==d.nodeType||!(c.contains?c.contains(d):a.compareDocumentPosition&&16&a.compareDocumentPosition(d)))}:function(a,b){if(b)while(b=b.parentNode)if(b===a)return!0;return!1},B=b?function(a,b){if(a===b)return l=!0,0;var d=!a.compareDocumentPosition-!b.compareDocumentPosition;return d?d:(d=(a.ownerDocument||a)===(b.ownerDocument||b)?a.compareDocumentPosition(b):1,1&d||!c.sortDetached&&b.compareDocumentPosition(a)===d?a===n||a.ownerDocument===v&&t(v,a)?-1:b===n||b.ownerDocument===v&&t(v,b)?1:k?J(k,a)-J(k,b):0:4&d?-1:1)}:function(a,b){if(a===b)return l=!0,0;var c,d=0,e=a.parentNode,f=b.parentNode,g=[a],h=[b];if(!e||!f)return a===n?-1:b===n?1:e?-1:f?1:k?J(k,a)-J(k,b):0;if(e===f)return ka(a,b);c=a;while(c=c.parentNode)g.unshift(c);c=b;while(c=c.parentNode)h.unshift(c);while(g[d]===h[d])d++;return d?ka(g[d],h[d]):g[d]===v?-1:h[d]===v?1:0},n):n},fa.matches=function(a,b){return fa(a,null,null,b)},fa.matchesSelector=function(a,b){if((a.ownerDocument||a)!==n&&m(a),b=b.replace(T,"='$1']"),c.matchesSelector&&p&&!A[b+" "]&&(!r||!r.test(b))&&(!q||!q.test(b)))try{var d=s.call(a,b);if(d||c.disconnectedMatch||a.document&&11!==a.document.nodeType)return d}catch(e){}return fa(b,n,null,[a]).length>0},fa.contains=function(a,b){return(a.ownerDocument||a)!==n&&m(a),t(a,b)},fa.attr=function(a,b){(a.ownerDocument||a)!==n&&m(a);var e=d.attrHandle[b.toLowerCase()],f=e&&D.call(d.attrHandle,b.toLowerCase())?e(a,b,!p):void 0;return void 0!==f?f:c.attributes||!p?a.getAttribute(b):(f=a.getAttributeNode(b))&&f.specified?f.value:null},fa.error=function(a){throw new Error("Syntax error, unrecognized expression: "+a)},fa.uniqueSort=function(a){var b,d=[],e=0,f=0;if(l=!c.detectDuplicates,k=!c.sortStable&&a.slice(0),a.sort(B),l){while(b=a[f++])b===a[f]&&(e=d.push(f));while(e--)a.splice(d[e],1)}return k=null,a},e=fa.getText=function(a){var b,c="",d=0,f=a.nodeType;if(f){if(1===f||9===f||11===f){if("string"==typeof a.textContent)return a.textContent;for(a=a.firstChild;a;a=a.nextSibling)c+=e(a)}else if(3===f||4===f)return a.nodeValue}else while(b=a[d++])c+=e(b);return c},d=fa.selectors={cacheLength:50,createPseudo:ha,match:W,attrHandle:{},find:{},relative:{">":{dir:"parentNode",first:!0}," ":{dir:"parentNode"},"+":{dir:"previousSibling",first:!0},"~":{dir:"previousSibling"}},preFilter:{ATTR:function(a){return a[1]=a[1].replace(ba,ca),a[3]=(a[3]||a[4]||a[5]||"").replace(ba,ca),"~="===a[2]&&(a[3]=" "+a[3]+" "),a.slice(0,4)},CHILD:function(a){return a[1]=a[1].toLowerCase(),"nth"===a[1].slice(0,3)?(a[3]||fa.error(a[0]),a[4]=+(a[4]?a[5]+(a[6]||1):2*("even"===a[3]||"odd"===a[3])),a[5]=+(a[7]+a[8]||"odd"===a[3])):a[3]&&fa.error(a[0]),a},PSEUDO:function(a){var b,c=!a[6]&&a[2];return W.CHILD.test(a[0])?null:(a[3]?a[2]=a[4]||a[5]||"":c&&U.test(c)&&(b=g(c,!0))&&(b=c.indexOf(")",c.length-b)-c.length)&&(a[0]=a[0].slice(0,b),a[2]=c.slice(0,b)),a.slice(0,3))}},filter:{TAG:function(a){var b=a.replace(ba,ca).toLowerCase();return"*"===a?function(){return!0}:function(a){return a.nodeName&&a.nodeName.toLowerCase()===b}},CLASS:function(a){var b=y[a+" "];return b||(b=new RegExp("(^|"+L+")"+a+"("+L+"|$)"))&&y(a,function(a){return b.test("string"==typeof a.className&&a.className||"undefined"!=typeof a.getAttribute&&a.getAttribute("class")||"")})},ATTR:function(a,b,c){return function(d){var e=fa.attr(d,a);return null==e?"!="===b:b?(e+="","="===b?e===c:"!="===b?e!==c:"^="===b?c&&0===e.indexOf(c):"*="===b?c&&e.indexOf(c)>-1:"$="===b?c&&e.slice(-c.length)===c:"~="===b?(" "+e.replace(P," ")+" ").indexOf(c)>-1:"|="===b?e===c||e.slice(0,c.length+1)===c+"-":!1):!0}},CHILD:function(a,b,c,d,e){var f="nth"!==a.slice(0,3),g="last"!==a.slice(-4),h="of-type"===b;return 1===d&&0===e?function(a){return!!a.parentNode}:function(b,c,i){var j,k,l,m,n,o,p=f!==g?"nextSibling":"previousSibling",q=b.parentNode,r=h&&b.nodeName.toLowerCase(),s=!i&&!h,t=!1;if(q){if(f){while(p){m=b;while(m=m[p])if(h?m.nodeName.toLowerCase()===r:1===m.nodeType)return!1;o=p="only"===a&&!o&&"nextSibling"}return!0}if(o=[g?q.firstChild:q.lastChild],g&&s){m=q,l=m[u]||(m[u]={}),k=l[m.uniqueID]||(l[m.uniqueID]={}),j=k[a]||[],n=j[0]===w&&j[1],t=n&&j[2],m=n&&q.childNodes[n];while(m=++n&&m&&m[p]||(t=n=0)||o.pop())if(1===m.nodeType&&++t&&m===b){k[a]=[w,n,t];break}}else if(s&&(m=b,l=m[u]||(m[u]={}),k=l[m.uniqueID]||(l[m.uniqueID]={}),j=k[a]||[],n=j[0]===w&&j[1],t=n),t===!1)while(m=++n&&m&&m[p]||(t=n=0)||o.pop())if((h?m.nodeName.toLowerCase()===r:1===m.nodeType)&&++t&&(s&&(l=m[u]||(m[u]={}),k=l[m.uniqueID]||(l[m.uniqueID]={}),k[a]=[w,t]),m===b))break;return t-=e,t===d||t%d===0&&t/d>=0}}},PSEUDO:function(a,b){var c,e=d.pseudos[a]||d.setFilters[a.toLowerCase()]||fa.error("unsupported pseudo: "+a);return e[u]?e(b):e.length>1?(c=[a,a,"",b],d.setFilters.hasOwnProperty(a.toLowerCase())?ha(function(a,c){var d,f=e(a,b),g=f.length;while(g--)d=J(a,f[g]),a[d]=!(c[d]=f[g])}):function(a){return e(a,0,c)}):e}},pseudos:{not:ha(function(a){var b=[],c=[],d=h(a.replace(Q,"$1"));return d[u]?ha(function(a,b,c,e){var f,g=d(a,null,e,[]),h=a.length;while(h--)(f=g[h])&&(a[h]=!(b[h]=f))}):function(a,e,f){return b[0]=a,d(b,null,f,c),b[0]=null,!c.pop()}}),has:ha(function(a){return function(b){return fa(a,b).length>0}}),contains:ha(function(a){return a=a.replace(ba,ca),function(b){return(b.textContent||b.innerText||e(b)).indexOf(a)>-1}}),lang:ha(function(a){return V.test(a||"")||fa.error("unsupported lang: "+a),a=a.replace(ba,ca).toLowerCase(),function(b){var c;do if(c=p?b.lang:b.getAttribute("xml:lang")||b.getAttribute("lang"))return c=c.toLowerCase(),c===a||0===c.indexOf(a+"-");while((b=b.parentNode)&&1===b.nodeType);return!1}}),target:function(b){var c=a.location&&a.location.hash;return c&&c.slice(1)===b.id},root:function(a){return a===o},focus:function(a){return a===n.activeElement&&(!n.hasFocus||n.hasFocus())&&!!(a.type||a.href||~a.tabIndex)},enabled:function(a){return a.disabled===!1},disabled:function(a){return a.disabled===!0},checked:function(a){var b=a.nodeName.toLowerCase();return"input"===b&&!!a.checked||"option"===b&&!!a.selected},selected:function(a){return a.parentNode&&a.parentNode.selectedIndex,a.selected===!0},empty:function(a){for(a=a.firstChild;a;a=a.nextSibling)if(a.nodeType<6)return!1;return!0},parent:function(a){return!d.pseudos.empty(a)},header:function(a){return Y.test(a.nodeName)},input:function(a){return X.test(a.nodeName)},button:function(a){var b=a.nodeName.toLowerCase();return"input"===b&&"button"===a.type||"button"===b},text:function(a){var b;return"input"===a.nodeName.toLowerCase()&&"text"===a.type&&(null==(b=a.getAttribute("type"))||"text"===b.toLowerCase())},first:na(function(){return[0]}),last:na(function(a,b){return[b-1]}),eq:na(function(a,b,c){return[0>c?c+b:c]}),even:na(function(a,b){for(var c=0;b>c;c+=2)a.push(c);return a}),odd:na(function(a,b){for(var c=1;b>c;c+=2)a.push(c);return a}),lt:na(function(a,b,c){for(var d=0>c?c+b:c;--d>=0;)a.push(d);return a}),gt:na(function(a,b,c){for(var d=0>c?c+b:c;++d<b;)a.push(d);return a})}},d.pseudos.nth=d.pseudos.eq;for(b in{radio:!0,checkbox:!0,file:!0,password:!0,image:!0})d.pseudos[b]=la(b);for(b in{submit:!0,reset:!0})d.pseudos[b]=ma(b);function pa(){}pa.prototype=d.filters=d.pseudos,d.setFilters=new pa,g=fa.tokenize=function(a,b){var c,e,f,g,h,i,j,k=z[a+" "];if(k)return b?0:k.slice(0);h=a,i=[],j=d.preFilter;while(h){c&&!(e=R.exec(h))||(e&&(h=h.slice(e[0].length)||h),i.push(f=[])),c=!1,(e=S.exec(h))&&(c=e.shift(),f.push({value:c,type:e[0].replace(Q," ")}),h=h.slice(c.length));for(g in d.filter)!(e=W[g].exec(h))||j[g]&&!(e=j[g](e))||(c=e.shift(),f.push({value:c,type:g,matches:e}),h=h.slice(c.length));if(!c)break}return b?h.length:h?fa.error(a):z(a,i).slice(0)};function qa(a){for(var b=0,c=a.length,d="";c>b;b++)d+=a[b].value;return d}function ra(a,b,c){var d=b.dir,e=c&&"parentNode"===d,f=x++;return b.first?function(b,c,f){while(b=b[d])if(1===b.nodeType||e)return a(b,c,f)}:function(b,c,g){var h,i,j,k=[w,f];if(g){while(b=b[d])if((1===b.nodeType||e)&&a(b,c,g))return!0}else while(b=b[d])if(1===b.nodeType||e){if(j=b[u]||(b[u]={}),i=j[b.uniqueID]||(j[b.uniqueID]={}),(h=i[d])&&h[0]===w&&h[1]===f)return k[2]=h[2];if(i[d]=k,k[2]=a(b,c,g))return!0}}}function sa(a){return a.length>1?function(b,c,d){var e=a.length;while(e--)if(!a[e](b,c,d))return!1;return!0}:a[0]}function ta(a,b,c){for(var d=0,e=b.length;e>d;d++)fa(a,b[d],c);return c}function ua(a,b,c,d,e){for(var f,g=[],h=0,i=a.length,j=null!=b;i>h;h++)(f=a[h])&&(c&&!c(f,d,e)||(g.push(f),j&&b.push(h)));return g}function va(a,b,c,d,e,f){return d&&!d[u]&&(d=va(d)),e&&!e[u]&&(e=va(e,f)),ha(function(f,g,h,i){var j,k,l,m=[],n=[],o=g.length,p=f||ta(b||"*",h.nodeType?[h]:h,[]),q=!a||!f&&b?p:ua(p,m,a,h,i),r=c?e||(f?a:o||d)?[]:g:q;if(c&&c(q,r,h,i),d){j=ua(r,n),d(j,[],h,i),k=j.length;while(k--)(l=j[k])&&(r[n[k]]=!(q[n[k]]=l))}if(f){if(e||a){if(e){j=[],k=r.length;while(k--)(l=r[k])&&j.push(q[k]=l);e(null,r=[],j,i)}k=r.length;while(k--)(l=r[k])&&(j=e?J(f,l):m[k])>-1&&(f[j]=!(g[j]=l))}}else r=ua(r===g?r.splice(o,r.length):r),e?e(null,g,r,i):H.apply(g,r)})}function wa(a){for(var b,c,e,f=a.length,g=d.relative[a[0].type],h=g||d.relative[" "],i=g?1:0,k=ra(function(a){return a===b},h,!0),l=ra(function(a){return J(b,a)>-1},h,!0),m=[function(a,c,d){var e=!g&&(d||c!==j)||((b=c).nodeType?k(a,c,d):l(a,c,d));return b=null,e}];f>i;i++)if(c=d.relative[a[i].type])m=[ra(sa(m),c)];else{if(c=d.filter[a[i].type].apply(null,a[i].matches),c[u]){for(e=++i;f>e;e++)if(d.relative[a[e].type])break;return va(i>1&&sa(m),i>1&&qa(a.slice(0,i-1).concat({value:" "===a[i-2].type?"*":""})).replace(Q,"$1"),c,e>i&&wa(a.slice(i,e)),f>e&&wa(a=a.slice(e)),f>e&&qa(a))}m.push(c)}return sa(m)}function xa(a,b){var c=b.length>0,e=a.length>0,f=function(f,g,h,i,k){var l,o,q,r=0,s="0",t=f&&[],u=[],v=j,x=f||e&&d.find.TAG("*",k),y=w+=null==v?1:Math.random()||.1,z=x.length;for(k&&(j=g===n||g||k);s!==z&&null!=(l=x[s]);s++){if(e&&l){o=0,g||l.ownerDocument===n||(m(l),h=!p);while(q=a[o++])if(q(l,g||n,h)){i.push(l);break}k&&(w=y)}c&&((l=!q&&l)&&r--,f&&t.push(l))}if(r+=s,c&&s!==r){o=0;while(q=b[o++])q(t,u,g,h);if(f){if(r>0)while(s--)t[s]||u[s]||(u[s]=F.call(i));u=ua(u)}H.apply(i,u),k&&!f&&u.length>0&&r+b.length>1&&fa.uniqueSort(i)}return k&&(w=y,j=v),t};return c?ha(f):f}return h=fa.compile=function(a,b){var c,d=[],e=[],f=A[a+" "];if(!f){b||(b=g(a)),c=b.length;while(c--)f=wa(b[c]),f[u]?d.push(f):e.push(f);f=A(a,xa(e,d)),f.selector=a}return f},i=fa.select=function(a,b,e,f){var i,j,k,l,m,n="function"==typeof a&&a,o=!f&&g(a=n.selector||a);if(e=e||[],1===o.length){if(j=o[0]=o[0].slice(0),j.length>2&&"ID"===(k=j[0]).type&&c.getById&&9===b.nodeType&&p&&d.relative[j[1].type]){if(b=(d.find.ID(k.matches[0].replace(ba,ca),b)||[])[0],!b)return e;n&&(b=b.parentNode),a=a.slice(j.shift().value.length)}i=W.needsContext.test(a)?0:j.length;while(i--){if(k=j[i],d.relative[l=k.type])break;if((m=d.find[l])&&(f=m(k.matches[0].replace(ba,ca),_.test(j[0].type)&&oa(b.parentNode)||b))){if(j.splice(i,1),a=f.length&&qa(j),!a)return H.apply(e,f),e;break}}}return(n||h(a,o))(f,b,!p,e,!b||_.test(a)&&oa(b.parentNode)||b),e},c.sortStable=u.split("").sort(B).join("")===u,c.detectDuplicates=!!l,m(),c.sortDetached=ia(function(a){return 1&a.compareDocumentPosition(n.createElement("div"))}),ia(function(a){return a.innerHTML="<a href='#'></a>","#"===a.firstChild.getAttribute("href")})||ja("type|href|height|width",function(a,b,c){return c?void 0:a.getAttribute(b,"type"===b.toLowerCase()?1:2)}),c.attributes&&ia(function(a){return a.innerHTML="<input/>",a.firstChild.setAttribute("value",""),""===a.firstChild.getAttribute("value")})||ja("value",function(a,b,c){return c||"input"!==a.nodeName.toLowerCase()?void 0:a.defaultValue}),ia(function(a){return null==a.getAttribute("disabled")})||ja(K,function(a,b,c){var d;return c?void 0:a[b]===!0?b.toLowerCase():(d=a.getAttributeNode(b))&&d.specified?d.value:null}),fa}(a);n.find=t,n.expr=t.selectors,n.expr[":"]=n.expr.pseudos,n.uniqueSort=n.unique=t.uniqueSort,n.text=t.getText,n.isXMLDoc=t.isXML,n.contains=t.contains;var u=function(a,b,c){var d=[],e=void 0!==c;while((a=a[b])&&9!==a.nodeType)if(1===a.nodeType){if(e&&n(a).is(c))break;d.push(a)}return d},v=function(a,b){for(var c=[];a;a=a.nextSibling)1===a.nodeType&&a!==b&&c.push(a);return c},w=n.expr.match.needsContext,x=/^<([\w-]+)\s*\/?>(?:<\/\1>|)$/,y=/^.[^:#\[\.,]*$/;function z(a,b,c){if(n.isFunction(b))return n.grep(a,function(a,d){return!!b.call(a,d,a)!==c});if(b.nodeType)return n.grep(a,function(a){return a===b!==c});if("string"==typeof b){if(y.test(b))return n.filter(b,a,c);b=n.filter(b,a)}return n.grep(a,function(a){return n.inArray(a,b)>-1!==c})}n.filter=function(a,b,c){var d=b[0];return c&&(a=":not("+a+")"),1===b.length&&1===d.nodeType?n.find.matchesSelector(d,a)?[d]:[]:n.find.matches(a,n.grep(b,function(a){return 1===a.nodeType}))},n.fn.extend({find:function(a){var b,c=[],d=this,e=d.length;if("string"!=typeof a)return this.pushStack(n(a).filter(function(){for(b=0;e>b;b++)if(n.contains(d[b],this))return!0}));for(b=0;e>b;b++)n.find(a,d[b],c);return c=this.pushStack(e>1?n.unique(c):c),c.selector=this.selector?this.selector+" "+a:a,c},filter:function(a){return this.pushStack(z(this,a||[],!1))},not:function(a){return this.pushStack(z(this,a||[],!0))},is:function(a){return!!z(this,"string"==typeof a&&w.test(a)?n(a):a||[],!1).length}});var A,B=/^(?:\s*(<[\w\W]+>)[^>]*|#([\w-]*))$/,C=n.fn.init=function(a,b,c){var e,f;if(!a)return this;if(c=c||A,"string"==typeof a){if(e="<"===a.charAt(0)&&">"===a.charAt(a.length-1)&&a.length>=3?[null,a,null]:B.exec(a),!e||!e[1]&&b)return!b||b.jquery?(b||c).find(a):this.constructor(b).find(a);if(e[1]){if(b=b instanceof n?b[0]:b,n.merge(this,n.parseHTML(e[1],b&&b.nodeType?b.ownerDocument||b:d,!0)),x.test(e[1])&&n.isPlainObject(b))for(e in b)n.isFunction(this[e])?this[e](b[e]):this.attr(e,b[e]);return this}if(f=d.getElementById(e[2]),f&&f.parentNode){if(f.id!==e[2])return A.find(a);this.length=1,this[0]=f}return this.context=d,this.selector=a,this}return a.nodeType?(this.context=this[0]=a,this.length=1,this):n.isFunction(a)?"undefined"!=typeof c.ready?c.ready(a):a(n):(void 0!==a.selector&&(this.selector=a.selector,this.context=a.context),n.makeArray(a,this))};C.prototype=n.fn,A=n(d);var D=/^(?:parents|prev(?:Until|All))/,E={children:!0,contents:!0,next:!0,prev:!0};n.fn.extend({has:function(a){var b,c=n(a,this),d=c.length;return this.filter(function(){for(b=0;d>b;b++)if(n.contains(this,c[b]))return!0})},closest:function(a,b){for(var c,d=0,e=this.length,f=[],g=w.test(a)||"string"!=typeof a?n(a,b||this.context):0;e>d;d++)for(c=this[d];c&&c!==b;c=c.parentNode)if(c.nodeType<11&&(g?g.index(c)>-1:1===c.nodeType&&n.find.matchesSelector(c,a))){f.push(c);break}return this.pushStack(f.length>1?n.uniqueSort(f):f)},index:function(a){return a?"string"==typeof a?n.inArray(this[0],n(a)):n.inArray(a.jquery?a[0]:a,this):this[0]&&this[0].parentNode?this.first().prevAll().length:-1},add:function(a,b){return this.pushStack(n.uniqueSort(n.merge(this.get(),n(a,b))))},addBack:function(a){return this.add(null==a?this.prevObject:this.prevObject.filter(a))}});function F(a,b){do a=a[b];while(a&&1!==a.nodeType);return a}n.each({parent:function(a){var b=a.parentNode;return b&&11!==b.nodeType?b:null},parents:function(a){return u(a,"parentNode")},parentsUntil:function(a,b,c){return u(a,"parentNode",c)},next:function(a){return F(a,"nextSibling")},prev:function(a){return F(a,"previousSibling")},nextAll:function(a){return u(a,"nextSibling")},prevAll:function(a){return u(a,"previousSibling")},nextUntil:function(a,b,c){return u(a,"nextSibling",c)},prevUntil:function(a,b,c){return u(a,"previousSibling",c)},siblings:function(a){return v((a.parentNode||{}).firstChild,a)},children:function(a){return v(a.firstChild)},contents:function(a){return n.nodeName(a,"iframe")?a.contentDocument||a.contentWindow.document:n.merge([],a.childNodes)}},function(a,b){n.fn[a]=function(c,d){var e=n.map(this,b,c);return"Until"!==a.slice(-5)&&(d=c),d&&"string"==typeof d&&(e=n.filter(d,e)),this.length>1&&(E[a]||(e=n.uniqueSort(e)),D.test(a)&&(e=e.reverse())),this.pushStack(e)}});var G=/\S+/g;function H(a){var b={};return n.each(a.match(G)||[],function(a,c){b[c]=!0}),b}n.Callbacks=function(a){a="string"==typeof a?H(a):n.extend({},a);var b,c,d,e,f=[],g=[],h=-1,i=function(){for(e=a.once,d=b=!0;g.length;h=-1){c=g.shift();while(++h<f.length)f[h].apply(c[0],c[1])===!1&&a.stopOnFalse&&(h=f.length,c=!1)}a.memory||(c=!1),b=!1,e&&(f=c?[]:"")},j={add:function(){return f&&(c&&!b&&(h=f.length-1,g.push(c)),function d(b){n.each(b,function(b,c){n.isFunction(c)?a.unique&&j.has(c)||f.push(c):c&&c.length&&"string"!==n.type(c)&&d(c)})}(arguments),c&&!b&&i()),this},remove:function(){return n.each(arguments,function(a,b){var c;while((c=n.inArray(b,f,c))>-1)f.splice(c,1),h>=c&&h--}),this},has:function(a){return a?n.inArray(a,f)>-1:f.length>0},empty:function(){return f&&(f=[]),this},disable:function(){return e=g=[],f=c="",this},disabled:function(){return!f},lock:function(){return e=!0,c||j.disable(),this},locked:function(){return!!e},fireWith:function(a,c){return e||(c=c||[],c=[a,c.slice?c.slice():c],g.push(c),b||i()),this},fire:function(){return j.fireWith(this,arguments),this},fired:function(){return!!d}};return j},n.extend({Deferred:function(a){var b=[["resolve","done",n.Callbacks("once memory"),"resolved"],["reject","fail",n.Callbacks("once memory"),"rejected"],["notify","progress",n.Callbacks("memory")]],c="pending",d={state:function(){return c},always:function(){return e.done(arguments).fail(arguments),this},then:function(){var a=arguments;return n.Deferred(function(c){n.each(b,function(b,f){var g=n.isFunction(a[b])&&a[b];e[f[1]](function(){var a=g&&g.apply(this,arguments);a&&n.isFunction(a.promise)?a.promise().progress(c.notify).done(c.resolve).fail(c.reject):c[f[0]+"With"](this===d?c.promise():this,g?[a]:arguments)})}),a=null}).promise()},promise:function(a){return null!=a?n.extend(a,d):d}},e={};return d.pipe=d.then,n.each(b,function(a,f){var g=f[2],h=f[3];d[f[1]]=g.add,h&&g.add(function(){c=h},b[1^a][2].disable,b[2][2].lock),e[f[0]]=function(){return e[f[0]+"With"](this===e?d:this,arguments),this},e[f[0]+"With"]=g.fireWith}),d.promise(e),a&&a.call(e,e),e},when:function(a){var b=0,c=e.call(arguments),d=c.length,f=1!==d||a&&n.isFunction(a.promise)?d:0,g=1===f?a:n.Deferred(),h=function(a,b,c){return function(d){b[a]=this,c[a]=arguments.length>1?e.call(arguments):d,c===i?g.notifyWith(b,c):--f||g.resolveWith(b,c)}},i,j,k;if(d>1)for(i=new Array(d),j=new Array(d),k=new Array(d);d>b;b++)c[b]&&n.isFunction(c[b].promise)?c[b].promise().progress(h(b,j,i)).done(h(b,k,c)).fail(g.reject):--f;return f||g.resolveWith(k,c),g.promise()}});var I;n.fn.ready=function(a){return n.ready.promise().done(a),this},n.extend({isReady:!1,readyWait:1,holdReady:function(a){a?n.readyWait++:n.ready(!0)},ready:function(a){(a===!0?--n.readyWait:n.isReady)||(n.isReady=!0,a!==!0&&--n.readyWait>0||(I.resolveWith(d,[n]),n.fn.triggerHandler&&(n(d).triggerHandler("ready"),n(d).off("ready"))))}});function J(){d.addEventListener?(d.removeEventListener("DOMContentLoaded",K),a.removeEventListener("load",K)):(d.detachEvent("onreadystatechange",K),a.detachEvent("onload",K))}function K(){(d.addEventListener||"load"===a.event.type||"complete"===d.readyState)&&(J(),n.ready())}n.ready.promise=function(b){if(!I)if(I=n.Deferred(),"complete"===d.readyState||"loading"!==d.readyState&&!d.documentElement.doScroll)a.setTimeout(n.ready);else if(d.addEventListener)d.addEventListener("DOMContentLoaded",K),a.addEventListener("load",K);else{d.attachEvent("onreadystatechange",K),a.attachEvent("onload",K);var c=!1;try{c=null==a.frameElement&&d.documentElement}catch(e){}c&&c.doScroll&&!function f(){if(!n.isReady){try{c.doScroll("left")}catch(b){return a.setTimeout(f,50)}J(),n.ready()}}()}return I.promise(b)},n.ready.promise();var L;for(L in n(l))break;l.ownFirst="0"===L,l.inlineBlockNeedsLayout=!1,n(function(){var a,b,c,e;c=d.getElementsByTagName("body")[0],c&&c.style&&(b=d.createElement("div"),e=d.createElement("div"),e.style.cssText="position:absolute;border:0;width:0;height:0;top:0;left:-9999px",c.appendChild(e).appendChild(b),"undefined"!=typeof b.style.zoom&&(b.style.cssText="display:inline;margin:0;border:0;padding:1px;width:1px;zoom:1",l.inlineBlockNeedsLayout=a=3===b.offsetWidth,a&&(c.style.zoom=1)),c.removeChild(e))}),function(){var a=d.createElement("div");l.deleteExpando=!0;try{delete a.test}catch(b){l.deleteExpando=!1}a=null}();var M=function(a){var b=n.noData[(a.nodeName+" ").toLowerCase()],c=+a.nodeType||1;return 1!==c&&9!==c?!1:!b||b!==!0&&a.getAttribute("classid")===b},N=/^(?:\{[\w\W]*\}|\[[\w\W]*\])$/,O=/([A-Z])/g;function P(a,b,c){if(void 0===c&&1===a.nodeType){var d="data-"+b.replace(O,"-$1").toLowerCase();if(c=a.getAttribute(d),"string"==typeof c){try{c="true"===c?!0:"false"===c?!1:"null"===c?null:+c+""===c?+c:N.test(c)?n.parseJSON(c):c}catch(e){}n.data(a,b,c)}else c=void 0;
}return c}function Q(a){var b;for(b in a)if(("data"!==b||!n.isEmptyObject(a[b]))&&"toJSON"!==b)return!1;return!0}function R(a,b,d,e){if(M(a)){var f,g,h=n.expando,i=a.nodeType,j=i?n.cache:a,k=i?a[h]:a[h]&&h;if(k&&j[k]&&(e||j[k].data)||void 0!==d||"string"!=typeof b)return k||(k=i?a[h]=c.pop()||n.guid++:h),j[k]||(j[k]=i?{}:{toJSON:n.noop}),"object"!=typeof b&&"function"!=typeof b||(e?j[k]=n.extend(j[k],b):j[k].data=n.extend(j[k].data,b)),g=j[k],e||(g.data||(g.data={}),g=g.data),void 0!==d&&(g[n.camelCase(b)]=d),"string"==typeof b?(f=g[b],null==f&&(f=g[n.camelCase(b)])):f=g,f}}function S(a,b,c){if(M(a)){var d,e,f=a.nodeType,g=f?n.cache:a,h=f?a[n.expando]:n.expando;if(g[h]){if(b&&(d=c?g[h]:g[h].data)){n.isArray(b)?b=b.concat(n.map(b,n.camelCase)):b in d?b=[b]:(b=n.camelCase(b),b=b in d?[b]:b.split(" ")),e=b.length;while(e--)delete d[b[e]];if(c?!Q(d):!n.isEmptyObject(d))return}(c||(delete g[h].data,Q(g[h])))&&(f?n.cleanData([a],!0):l.deleteExpando||g!=g.window?delete g[h]:g[h]=void 0)}}}n.extend({cache:{},noData:{"applet ":!0,"embed ":!0,"object ":"clsid:D27CDB6E-AE6D-11cf-96B8-444553540000"},hasData:function(a){return a=a.nodeType?n.cache[a[n.expando]]:a[n.expando],!!a&&!Q(a)},data:function(a,b,c){return R(a,b,c)},removeData:function(a,b){return S(a,b)},_data:function(a,b,c){return R(a,b,c,!0)},_removeData:function(a,b){return S(a,b,!0)}}),n.fn.extend({data:function(a,b){var c,d,e,f=this[0],g=f&&f.attributes;if(void 0===a){if(this.length&&(e=n.data(f),1===f.nodeType&&!n._data(f,"parsedAttrs"))){c=g.length;while(c--)g[c]&&(d=g[c].name,0===d.indexOf("data-")&&(d=n.camelCase(d.slice(5)),P(f,d,e[d])));n._data(f,"parsedAttrs",!0)}return e}return"object"==typeof a?this.each(function(){n.data(this,a)}):arguments.length>1?this.each(function(){n.data(this,a,b)}):f?P(f,a,n.data(f,a)):void 0},removeData:function(a){return this.each(function(){n.removeData(this,a)})}}),n.extend({queue:function(a,b,c){var d;return a?(b=(b||"fx")+"queue",d=n._data(a,b),c&&(!d||n.isArray(c)?d=n._data(a,b,n.makeArray(c)):d.push(c)),d||[]):void 0},dequeue:function(a,b){b=b||"fx";var c=n.queue(a,b),d=c.length,e=c.shift(),f=n._queueHooks(a,b),g=function(){n.dequeue(a,b)};"inprogress"===e&&(e=c.shift(),d--),e&&("fx"===b&&c.unshift("inprogress"),delete f.stop,e.call(a,g,f)),!d&&f&&f.empty.fire()},_queueHooks:function(a,b){var c=b+"queueHooks";return n._data(a,c)||n._data(a,c,{empty:n.Callbacks("once memory").add(function(){n._removeData(a,b+"queue"),n._removeData(a,c)})})}}),n.fn.extend({queue:function(a,b){var c=2;return"string"!=typeof a&&(b=a,a="fx",c--),arguments.length<c?n.queue(this[0],a):void 0===b?this:this.each(function(){var c=n.queue(this,a,b);n._queueHooks(this,a),"fx"===a&&"inprogress"!==c[0]&&n.dequeue(this,a)})},dequeue:function(a){return this.each(function(){n.dequeue(this,a)})},clearQueue:function(a){return this.queue(a||"fx",[])},promise:function(a,b){var c,d=1,e=n.Deferred(),f=this,g=this.length,h=function(){--d||e.resolveWith(f,[f])};"string"!=typeof a&&(b=a,a=void 0),a=a||"fx";while(g--)c=n._data(f[g],a+"queueHooks"),c&&c.empty&&(d++,c.empty.add(h));return h(),e.promise(b)}}),function(){var a;l.shrinkWrapBlocks=function(){if(null!=a)return a;a=!1;var b,c,e;return c=d.getElementsByTagName("body")[0],c&&c.style?(b=d.createElement("div"),e=d.createElement("div"),e.style.cssText="position:absolute;border:0;width:0;height:0;top:0;left:-9999px",c.appendChild(e).appendChild(b),"undefined"!=typeof b.style.zoom&&(b.style.cssText="-webkit-box-sizing:content-box;-moz-box-sizing:content-box;box-sizing:content-box;display:block;margin:0;border:0;padding:1px;width:1px;zoom:1",b.appendChild(d.createElement("div")).style.width="5px",a=3!==b.offsetWidth),c.removeChild(e),a):void 0}}();var T=/[+-]?(?:\d*\.|)\d+(?:[eE][+-]?\d+|)/.source,U=new RegExp("^(?:([+-])=|)("+T+")([a-z%]*)$","i"),V=["Top","Right","Bottom","Left"],W=function(a,b){return a=b||a,"none"===n.css(a,"display")||!n.contains(a.ownerDocument,a)};function X(a,b,c,d){var e,f=1,g=20,h=d?function(){return d.cur()}:function(){return n.css(a,b,"")},i=h(),j=c&&c[3]||(n.cssNumber[b]?"":"px"),k=(n.cssNumber[b]||"px"!==j&&+i)&&U.exec(n.css(a,b));if(k&&k[3]!==j){j=j||k[3],c=c||[],k=+i||1;do f=f||".5",k/=f,n.style(a,b,k+j);while(f!==(f=h()/i)&&1!==f&&--g)}return c&&(k=+k||+i||0,e=c[1]?k+(c[1]+1)*c[2]:+c[2],d&&(d.unit=j,d.start=k,d.end=e)),e}var Y=function(a,b,c,d,e,f,g){var h=0,i=a.length,j=null==c;if("object"===n.type(c)){e=!0;for(h in c)Y(a,b,h,c[h],!0,f,g)}else if(void 0!==d&&(e=!0,n.isFunction(d)||(g=!0),j&&(g?(b.call(a,d),b=null):(j=b,b=function(a,b,c){return j.call(n(a),c)})),b))for(;i>h;h++)b(a[h],c,g?d:d.call(a[h],h,b(a[h],c)));return e?a:j?b.call(a):i?b(a[0],c):f},Z=/^(?:checkbox|radio)$/i,$=/<([\w:-]+)/,_=/^$|\/(?:java|ecma)script/i,aa=/^\s+/,ba="abbr|article|aside|audio|bdi|canvas|data|datalist|details|dialog|figcaption|figure|footer|header|hgroup|main|mark|meter|nav|output|picture|progress|section|summary|template|time|video";function ca(a){var b=ba.split("|"),c=a.createDocumentFragment();if(c.createElement)while(b.length)c.createElement(b.pop());return c}!function(){var a=d.createElement("div"),b=d.createDocumentFragment(),c=d.createElement("input");a.innerHTML="  <link/><table></table><a href='/a'>a</a><input type='checkbox'/>",l.leadingWhitespace=3===a.firstChild.nodeType,l.tbody=!a.getElementsByTagName("tbody").length,l.htmlSerialize=!!a.getElementsByTagName("link").length,l.html5Clone="<:nav></:nav>"!==d.createElement("nav").cloneNode(!0).outerHTML,c.type="checkbox",c.checked=!0,b.appendChild(c),l.appendChecked=c.checked,a.innerHTML="<textarea>x</textarea>",l.noCloneChecked=!!a.cloneNode(!0).lastChild.defaultValue,b.appendChild(a),c=d.createElement("input"),c.setAttribute("type","radio"),c.setAttribute("checked","checked"),c.setAttribute("name","t"),a.appendChild(c),l.checkClone=a.cloneNode(!0).cloneNode(!0).lastChild.checked,l.noCloneEvent=!!a.addEventListener,a[n.expando]=1,l.attributes=!a.getAttribute(n.expando)}();var da={option:[1,"<select multiple='multiple'>","</select>"],legend:[1,"<fieldset>","</fieldset>"],area:[1,"<map>","</map>"],param:[1,"<object>","</object>"],thead:[1,"<table>","</table>"],tr:[2,"<table><tbody>","</tbody></table>"],col:[2,"<table><tbody></tbody><colgroup>","</colgroup></table>"],td:[3,"<table><tbody><tr>","</tr></tbody></table>"],_default:l.htmlSerialize?[0,"",""]:[1,"X<div>","</div>"]};da.optgroup=da.option,da.tbody=da.tfoot=da.colgroup=da.caption=da.thead,da.th=da.td;function ea(a,b){var c,d,e=0,f="undefined"!=typeof a.getElementsByTagName?a.getElementsByTagName(b||"*"):"undefined"!=typeof a.querySelectorAll?a.querySelectorAll(b||"*"):void 0;if(!f)for(f=[],c=a.childNodes||a;null!=(d=c[e]);e++)!b||n.nodeName(d,b)?f.push(d):n.merge(f,ea(d,b));return void 0===b||b&&n.nodeName(a,b)?n.merge([a],f):f}function fa(a,b){for(var c,d=0;null!=(c=a[d]);d++)n._data(c,"globalEval",!b||n._data(b[d],"globalEval"))}var ga=/<|&#?\w+;/,ha=/<tbody/i;function ia(a){Z.test(a.type)&&(a.defaultChecked=a.checked)}function ja(a,b,c,d,e){for(var f,g,h,i,j,k,m,o=a.length,p=ca(b),q=[],r=0;o>r;r++)if(g=a[r],g||0===g)if("object"===n.type(g))n.merge(q,g.nodeType?[g]:g);else if(ga.test(g)){i=i||p.appendChild(b.createElement("div")),j=($.exec(g)||["",""])[1].toLowerCase(),m=da[j]||da._default,i.innerHTML=m[1]+n.htmlPrefilter(g)+m[2],f=m[0];while(f--)i=i.lastChild;if(!l.leadingWhitespace&&aa.test(g)&&q.push(b.createTextNode(aa.exec(g)[0])),!l.tbody){g="table"!==j||ha.test(g)?"<table>"!==m[1]||ha.test(g)?0:i:i.firstChild,f=g&&g.childNodes.length;while(f--)n.nodeName(k=g.childNodes[f],"tbody")&&!k.childNodes.length&&g.removeChild(k)}n.merge(q,i.childNodes),i.textContent="";while(i.firstChild)i.removeChild(i.firstChild);i=p.lastChild}else q.push(b.createTextNode(g));i&&p.removeChild(i),l.appendChecked||n.grep(ea(q,"input"),ia),r=0;while(g=q[r++])if(d&&n.inArray(g,d)>-1)e&&e.push(g);else if(h=n.contains(g.ownerDocument,g),i=ea(p.appendChild(g),"script"),h&&fa(i),c){f=0;while(g=i[f++])_.test(g.type||"")&&c.push(g)}return i=null,p}!function(){var b,c,e=d.createElement("div");for(b in{submit:!0,change:!0,focusin:!0})c="on"+b,(l[b]=c in a)||(e.setAttribute(c,"t"),l[b]=e.attributes[c].expando===!1);e=null}();var ka=/^(?:input|select|textarea)$/i,la=/^key/,ma=/^(?:mouse|pointer|contextmenu|drag|drop)|click/,na=/^(?:focusinfocus|focusoutblur)$/,oa=/^([^.]*)(?:\.(.+)|)/;function pa(){return!0}function qa(){return!1}function ra(){try{return d.activeElement}catch(a){}}function sa(a,b,c,d,e,f){var g,h;if("object"==typeof b){"string"!=typeof c&&(d=d||c,c=void 0);for(h in b)sa(a,h,c,d,b[h],f);return a}if(null==d&&null==e?(e=c,d=c=void 0):null==e&&("string"==typeof c?(e=d,d=void 0):(e=d,d=c,c=void 0)),e===!1)e=qa;else if(!e)return a;return 1===f&&(g=e,e=function(a){return n().off(a),g.apply(this,arguments)},e.guid=g.guid||(g.guid=n.guid++)),a.each(function(){n.event.add(this,b,e,d,c)})}n.event={global:{},add:function(a,b,c,d,e){var f,g,h,i,j,k,l,m,o,p,q,r=n._data(a);if(r){c.handler&&(i=c,c=i.handler,e=i.selector),c.guid||(c.guid=n.guid++),(g=r.events)||(g=r.events={}),(k=r.handle)||(k=r.handle=function(a){return"undefined"==typeof n||a&&n.event.triggered===a.type?void 0:n.event.dispatch.apply(k.elem,arguments)},k.elem=a),b=(b||"").match(G)||[""],h=b.length;while(h--)f=oa.exec(b[h])||[],o=q=f[1],p=(f[2]||"").split(".").sort(),o&&(j=n.event.special[o]||{},o=(e?j.delegateType:j.bindType)||o,j=n.event.special[o]||{},l=n.extend({type:o,origType:q,data:d,handler:c,guid:c.guid,selector:e,needsContext:e&&n.expr.match.needsContext.test(e),namespace:p.join(".")},i),(m=g[o])||(m=g[o]=[],m.delegateCount=0,j.setup&&j.setup.call(a,d,p,k)!==!1||(a.addEventListener?a.addEventListener(o,k,!1):a.attachEvent&&a.attachEvent("on"+o,k))),j.add&&(j.add.call(a,l),l.handler.guid||(l.handler.guid=c.guid)),e?m.splice(m.delegateCount++,0,l):m.push(l),n.event.global[o]=!0);a=null}},remove:function(a,b,c,d,e){var f,g,h,i,j,k,l,m,o,p,q,r=n.hasData(a)&&n._data(a);if(r&&(k=r.events)){b=(b||"").match(G)||[""],j=b.length;while(j--)if(h=oa.exec(b[j])||[],o=q=h[1],p=(h[2]||"").split(".").sort(),o){l=n.event.special[o]||{},o=(d?l.delegateType:l.bindType)||o,m=k[o]||[],h=h[2]&&new RegExp("(^|\\.)"+p.join("\\.(?:.*\\.|)")+"(\\.|$)"),i=f=m.length;while(f--)g=m[f],!e&&q!==g.origType||c&&c.guid!==g.guid||h&&!h.test(g.namespace)||d&&d!==g.selector&&("**"!==d||!g.selector)||(m.splice(f,1),g.selector&&m.delegateCount--,l.remove&&l.remove.call(a,g));i&&!m.length&&(l.teardown&&l.teardown.call(a,p,r.handle)!==!1||n.removeEvent(a,o,r.handle),delete k[o])}else for(o in k)n.event.remove(a,o+b[j],c,d,!0);n.isEmptyObject(k)&&(delete r.handle,n._removeData(a,"events"))}},trigger:function(b,c,e,f){var g,h,i,j,l,m,o,p=[e||d],q=k.call(b,"type")?b.type:b,r=k.call(b,"namespace")?b.namespace.split("."):[];if(i=m=e=e||d,3!==e.nodeType&&8!==e.nodeType&&!na.test(q+n.event.triggered)&&(q.indexOf(".")>-1&&(r=q.split("."),q=r.shift(),r.sort()),h=q.indexOf(":")<0&&"on"+q,b=b[n.expando]?b:new n.Event(q,"object"==typeof b&&b),b.isTrigger=f?2:3,b.namespace=r.join("."),b.rnamespace=b.namespace?new RegExp("(^|\\.)"+r.join("\\.(?:.*\\.|)")+"(\\.|$)"):null,b.result=void 0,b.target||(b.target=e),c=null==c?[b]:n.makeArray(c,[b]),l=n.event.special[q]||{},f||!l.trigger||l.trigger.apply(e,c)!==!1)){if(!f&&!l.noBubble&&!n.isWindow(e)){for(j=l.delegateType||q,na.test(j+q)||(i=i.parentNode);i;i=i.parentNode)p.push(i),m=i;m===(e.ownerDocument||d)&&p.push(m.defaultView||m.parentWindow||a)}o=0;while((i=p[o++])&&!b.isPropagationStopped())b.type=o>1?j:l.bindType||q,g=(n._data(i,"events")||{})[b.type]&&n._data(i,"handle"),g&&g.apply(i,c),g=h&&i[h],g&&g.apply&&M(i)&&(b.result=g.apply(i,c),b.result===!1&&b.preventDefault());if(b.type=q,!f&&!b.isDefaultPrevented()&&(!l._default||l._default.apply(p.pop(),c)===!1)&&M(e)&&h&&e[q]&&!n.isWindow(e)){m=e[h],m&&(e[h]=null),n.event.triggered=q;try{e[q]()}catch(s){}n.event.triggered=void 0,m&&(e[h]=m)}return b.result}},dispatch:function(a){a=n.event.fix(a);var b,c,d,f,g,h=[],i=e.call(arguments),j=(n._data(this,"events")||{})[a.type]||[],k=n.event.special[a.type]||{};if(i[0]=a,a.delegateTarget=this,!k.preDispatch||k.preDispatch.call(this,a)!==!1){h=n.event.handlers.call(this,a,j),b=0;while((f=h[b++])&&!a.isPropagationStopped()){a.currentTarget=f.elem,c=0;while((g=f.handlers[c++])&&!a.isImmediatePropagationStopped())a.rnamespace&&!a.rnamespace.test(g.namespace)||(a.handleObj=g,a.data=g.data,d=((n.event.special[g.origType]||{}).handle||g.handler).apply(f.elem,i),void 0!==d&&(a.result=d)===!1&&(a.preventDefault(),a.stopPropagation()))}return k.postDispatch&&k.postDispatch.call(this,a),a.result}},handlers:function(a,b){var c,d,e,f,g=[],h=b.delegateCount,i=a.target;if(h&&i.nodeType&&("click"!==a.type||isNaN(a.button)||a.button<1))for(;i!=this;i=i.parentNode||this)if(1===i.nodeType&&(i.disabled!==!0||"click"!==a.type)){for(d=[],c=0;h>c;c++)f=b[c],e=f.selector+" ",void 0===d[e]&&(d[e]=f.needsContext?n(e,this).index(i)>-1:n.find(e,this,null,[i]).length),d[e]&&d.push(f);d.length&&g.push({elem:i,handlers:d})}return h<b.length&&g.push({elem:this,handlers:b.slice(h)}),g},fix:function(a){if(a[n.expando])return a;var b,c,e,f=a.type,g=a,h=this.fixHooks[f];h||(this.fixHooks[f]=h=ma.test(f)?this.mouseHooks:la.test(f)?this.keyHooks:{}),e=h.props?this.props.concat(h.props):this.props,a=new n.Event(g),b=e.length;while(b--)c=e[b],a[c]=g[c];return a.target||(a.target=g.srcElement||d),3===a.target.nodeType&&(a.target=a.target.parentNode),a.metaKey=!!a.metaKey,h.filter?h.filter(a,g):a},props:"altKey bubbles cancelable ctrlKey currentTarget detail eventPhase metaKey relatedTarget shiftKey target timeStamp view which".split(" "),fixHooks:{},keyHooks:{props:"char charCode key keyCode".split(" "),filter:function(a,b){return null==a.which&&(a.which=null!=b.charCode?b.charCode:b.keyCode),a}},mouseHooks:{props:"button buttons clientX clientY fromElement offsetX offsetY pageX pageY screenX screenY toElement".split(" "),filter:function(a,b){var c,e,f,g=b.button,h=b.fromElement;return null==a.pageX&&null!=b.clientX&&(e=a.target.ownerDocument||d,f=e.documentElement,c=e.body,a.pageX=b.clientX+(f&&f.scrollLeft||c&&c.scrollLeft||0)-(f&&f.clientLeft||c&&c.clientLeft||0),a.pageY=b.clientY+(f&&f.scrollTop||c&&c.scrollTop||0)-(f&&f.clientTop||c&&c.clientTop||0)),!a.relatedTarget&&h&&(a.relatedTarget=h===a.target?b.toElement:h),a.which||void 0===g||(a.which=1&g?1:2&g?3:4&g?2:0),a}},special:{load:{noBubble:!0},focus:{trigger:function(){if(this!==ra()&&this.focus)try{return this.focus(),!1}catch(a){}},delegateType:"focusin"},blur:{trigger:function(){return this===ra()&&this.blur?(this.blur(),!1):void 0},delegateType:"focusout"},click:{trigger:function(){return n.nodeName(this,"input")&&"checkbox"===this.type&&this.click?(this.click(),!1):void 0},_default:function(a){return n.nodeName(a.target,"a")}},beforeunload:{postDispatch:function(a){void 0!==a.result&&a.originalEvent&&(a.originalEvent.returnValue=a.result)}}},simulate:function(a,b,c){var d=n.extend(new n.Event,c,{type:a,isSimulated:!0});n.event.trigger(d,null,b),d.isDefaultPrevented()&&c.preventDefault()}},n.removeEvent=d.removeEventListener?function(a,b,c){a.removeEventListener&&a.removeEventListener(b,c)}:function(a,b,c){var d="on"+b;a.detachEvent&&("undefined"==typeof a[d]&&(a[d]=null),a.detachEvent(d,c))},n.Event=function(a,b){return this instanceof n.Event?(a&&a.type?(this.originalEvent=a,this.type=a.type,this.isDefaultPrevented=a.defaultPrevented||void 0===a.defaultPrevented&&a.returnValue===!1?pa:qa):this.type=a,b&&n.extend(this,b),this.timeStamp=a&&a.timeStamp||n.now(),void(this[n.expando]=!0)):new n.Event(a,b)},n.Event.prototype={constructor:n.Event,isDefaultPrevented:qa,isPropagationStopped:qa,isImmediatePropagationStopped:qa,preventDefault:function(){var a=this.originalEvent;this.isDefaultPrevented=pa,a&&(a.preventDefault?a.preventDefault():a.returnValue=!1)},stopPropagation:function(){var a=this.originalEvent;this.isPropagationStopped=pa,a&&!this.isSimulated&&(a.stopPropagation&&a.stopPropagation(),a.cancelBubble=!0)},stopImmediatePropagation:function(){var a=this.originalEvent;this.isImmediatePropagationStopped=pa,a&&a.stopImmediatePropagation&&a.stopImmediatePropagation(),this.stopPropagation()}},n.each({mouseenter:"mouseover",mouseleave:"mouseout",pointerenter:"pointerover",pointerleave:"pointerout"},function(a,b){n.event.special[a]={delegateType:b,bindType:b,handle:function(a){var c,d=this,e=a.relatedTarget,f=a.handleObj;return e&&(e===d||n.contains(d,e))||(a.type=f.origType,c=f.handler.apply(this,arguments),a.type=b),c}}}),l.submit||(n.event.special.submit={setup:function(){return n.nodeName(this,"form")?!1:void n.event.add(this,"click._submit keypress._submit",function(a){var b=a.target,c=n.nodeName(b,"input")||n.nodeName(b,"button")?n.prop(b,"form"):void 0;c&&!n._data(c,"submit")&&(n.event.add(c,"submit._submit",function(a){a._submitBubble=!0}),n._data(c,"submit",!0))})},postDispatch:function(a){a._submitBubble&&(delete a._submitBubble,this.parentNode&&!a.isTrigger&&n.event.simulate("submit",this.parentNode,a))},teardown:function(){return n.nodeName(this,"form")?!1:void n.event.remove(this,"._submit")}}),l.change||(n.event.special.change={setup:function(){return ka.test(this.nodeName)?("checkbox"!==this.type&&"radio"!==this.type||(n.event.add(this,"propertychange._change",function(a){"checked"===a.originalEvent.propertyName&&(this._justChanged=!0)}),n.event.add(this,"click._change",function(a){this._justChanged&&!a.isTrigger&&(this._justChanged=!1),n.event.simulate("change",this,a)})),!1):void n.event.add(this,"beforeactivate._change",function(a){var b=a.target;ka.test(b.nodeName)&&!n._data(b,"change")&&(n.event.add(b,"change._change",function(a){!this.parentNode||a.isSimulated||a.isTrigger||n.event.simulate("change",this.parentNode,a)}),n._data(b,"change",!0))})},handle:function(a){var b=a.target;return this!==b||a.isSimulated||a.isTrigger||"radio"!==b.type&&"checkbox"!==b.type?a.handleObj.handler.apply(this,arguments):void 0},teardown:function(){return n.event.remove(this,"._change"),!ka.test(this.nodeName)}}),l.focusin||n.each({focus:"focusin",blur:"focusout"},function(a,b){var c=function(a){n.event.simulate(b,a.target,n.event.fix(a))};n.event.special[b]={setup:function(){var d=this.ownerDocument||this,e=n._data(d,b);e||d.addEventListener(a,c,!0),n._data(d,b,(e||0)+1)},teardown:function(){var d=this.ownerDocument||this,e=n._data(d,b)-1;e?n._data(d,b,e):(d.removeEventListener(a,c,!0),n._removeData(d,b))}}}),n.fn.extend({on:function(a,b,c,d){return sa(this,a,b,c,d)},one:function(a,b,c,d){return sa(this,a,b,c,d,1)},off:function(a,b,c){var d,e;if(a&&a.preventDefault&&a.handleObj)return d=a.handleObj,n(a.delegateTarget).off(d.namespace?d.origType+"."+d.namespace:d.origType,d.selector,d.handler),this;if("object"==typeof a){for(e in a)this.off(e,b,a[e]);return this}return b!==!1&&"function"!=typeof b||(c=b,b=void 0),c===!1&&(c=qa),this.each(function(){n.event.remove(this,a,c,b)})},trigger:function(a,b){return this.each(function(){n.event.trigger(a,b,this)})},triggerHandler:function(a,b){var c=this[0];return c?n.event.trigger(a,b,c,!0):void 0}});var ta=/ jQuery\d+="(?:null|\d+)"/g,ua=new RegExp("<(?:"+ba+")[\\s/>]","i"),va=/<(?!area|br|col|embed|hr|img|input|link|meta|param)(([\w:-]+)[^>]*)\/>/gi,wa=/<script|<style|<link/i,xa=/checked\s*(?:[^=]|=\s*.checked.)/i,ya=/^true\/(.*)/,za=/^\s*<!(?:\[CDATA\[|--)|(?:\]\]|--)>\s*$/g,Aa=ca(d),Ba=Aa.appendChild(d.createElement("div"));function Ca(a,b){return n.nodeName(a,"table")&&n.nodeName(11!==b.nodeType?b:b.firstChild,"tr")?a.getElementsByTagName("tbody")[0]||a.appendChild(a.ownerDocument.createElement("tbody")):a}function Da(a){return a.type=(null!==n.find.attr(a,"type"))+"/"+a.type,a}function Ea(a){var b=ya.exec(a.type);return b?a.type=b[1]:a.removeAttribute("type"),a}function Fa(a,b){if(1===b.nodeType&&n.hasData(a)){var c,d,e,f=n._data(a),g=n._data(b,f),h=f.events;if(h){delete g.handle,g.events={};for(c in h)for(d=0,e=h[c].length;e>d;d++)n.event.add(b,c,h[c][d])}g.data&&(g.data=n.extend({},g.data))}}function Ga(a,b){var c,d,e;if(1===b.nodeType){if(c=b.nodeName.toLowerCase(),!l.noCloneEvent&&b[n.expando]){e=n._data(b);for(d in e.events)n.removeEvent(b,d,e.handle);b.removeAttribute(n.expando)}"script"===c&&b.text!==a.text?(Da(b).text=a.text,Ea(b)):"object"===c?(b.parentNode&&(b.outerHTML=a.outerHTML),l.html5Clone&&a.innerHTML&&!n.trim(b.innerHTML)&&(b.innerHTML=a.innerHTML)):"input"===c&&Z.test(a.type)?(b.defaultChecked=b.checked=a.checked,b.value!==a.value&&(b.value=a.value)):"option"===c?b.defaultSelected=b.selected=a.defaultSelected:"input"!==c&&"textarea"!==c||(b.defaultValue=a.defaultValue)}}function Ha(a,b,c,d){b=f.apply([],b);var e,g,h,i,j,k,m=0,o=a.length,p=o-1,q=b[0],r=n.isFunction(q);if(r||o>1&&"string"==typeof q&&!l.checkClone&&xa.test(q))return a.each(function(e){var f=a.eq(e);r&&(b[0]=q.call(this,e,f.html())),Ha(f,b,c,d)});if(o&&(k=ja(b,a[0].ownerDocument,!1,a,d),e=k.firstChild,1===k.childNodes.length&&(k=e),e||d)){for(i=n.map(ea(k,"script"),Da),h=i.length;o>m;m++)g=k,m!==p&&(g=n.clone(g,!0,!0),h&&n.merge(i,ea(g,"script"))),c.call(a[m],g,m);if(h)for(j=i[i.length-1].ownerDocument,n.map(i,Ea),m=0;h>m;m++)g=i[m],_.test(g.type||"")&&!n._data(g,"globalEval")&&n.contains(j,g)&&(g.src?n._evalUrl&&n._evalUrl(g.src):n.globalEval((g.text||g.textContent||g.innerHTML||"").replace(za,"")));k=e=null}return a}function Ia(a,b,c){for(var d,e=b?n.filter(b,a):a,f=0;null!=(d=e[f]);f++)c||1!==d.nodeType||n.cleanData(ea(d)),d.parentNode&&(c&&n.contains(d.ownerDocument,d)&&fa(ea(d,"script")),d.parentNode.removeChild(d));return a}n.extend({htmlPrefilter:function(a){return a.replace(va,"<$1></$2>")},clone:function(a,b,c){var d,e,f,g,h,i=n.contains(a.ownerDocument,a);if(l.html5Clone||n.isXMLDoc(a)||!ua.test("<"+a.nodeName+">")?f=a.cloneNode(!0):(Ba.innerHTML=a.outerHTML,Ba.removeChild(f=Ba.firstChild)),!(l.noCloneEvent&&l.noCloneChecked||1!==a.nodeType&&11!==a.nodeType||n.isXMLDoc(a)))for(d=ea(f),h=ea(a),g=0;null!=(e=h[g]);++g)d[g]&&Ga(e,d[g]);if(b)if(c)for(h=h||ea(a),d=d||ea(f),g=0;null!=(e=h[g]);g++)Fa(e,d[g]);else Fa(a,f);return d=ea(f,"script"),d.length>0&&fa(d,!i&&ea(a,"script")),d=h=e=null,f},cleanData:function(a,b){for(var d,e,f,g,h=0,i=n.expando,j=n.cache,k=l.attributes,m=n.event.special;null!=(d=a[h]);h++)if((b||M(d))&&(f=d[i],g=f&&j[f])){if(g.events)for(e in g.events)m[e]?n.event.remove(d,e):n.removeEvent(d,e,g.handle);j[f]&&(delete j[f],k||"undefined"==typeof d.removeAttribute?d[i]=void 0:d.removeAttribute(i),c.push(f))}}}),n.fn.extend({domManip:Ha,detach:function(a){return Ia(this,a,!0)},remove:function(a){return Ia(this,a)},text:function(a){return Y(this,function(a){return void 0===a?n.text(this):this.empty().append((this[0]&&this[0].ownerDocument||d).createTextNode(a))},null,a,arguments.length)},append:function(){return Ha(this,arguments,function(a){if(1===this.nodeType||11===this.nodeType||9===this.nodeType){var b=Ca(this,a);b.appendChild(a)}})},prepend:function(){return Ha(this,arguments,function(a){if(1===this.nodeType||11===this.nodeType||9===this.nodeType){var b=Ca(this,a);b.insertBefore(a,b.firstChild)}})},before:function(){return Ha(this,arguments,function(a){this.parentNode&&this.parentNode.insertBefore(a,this)})},after:function(){return Ha(this,arguments,function(a){this.parentNode&&this.parentNode.insertBefore(a,this.nextSibling)})},empty:function(){for(var a,b=0;null!=(a=this[b]);b++){1===a.nodeType&&n.cleanData(ea(a,!1));while(a.firstChild)a.removeChild(a.firstChild);a.options&&n.nodeName(a,"select")&&(a.options.length=0)}return this},clone:function(a,b){return a=null==a?!1:a,b=null==b?a:b,this.map(function(){return n.clone(this,a,b)})},html:function(a){return Y(this,function(a){var b=this[0]||{},c=0,d=this.length;if(void 0===a)return 1===b.nodeType?b.innerHTML.replace(ta,""):void 0;if("string"==typeof a&&!wa.test(a)&&(l.htmlSerialize||!ua.test(a))&&(l.leadingWhitespace||!aa.test(a))&&!da[($.exec(a)||["",""])[1].toLowerCase()]){a=n.htmlPrefilter(a);try{for(;d>c;c++)b=this[c]||{},1===b.nodeType&&(n.cleanData(ea(b,!1)),b.innerHTML=a);b=0}catch(e){}}b&&this.empty().append(a)},null,a,arguments.length)},replaceWith:function(){var a=[];return Ha(this,arguments,function(b){var c=this.parentNode;n.inArray(this,a)<0&&(n.cleanData(ea(this)),c&&c.replaceChild(b,this))},a)}}),n.each({appendTo:"append",prependTo:"prepend",insertBefore:"before",insertAfter:"after",replaceAll:"replaceWith"},function(a,b){n.fn[a]=function(a){for(var c,d=0,e=[],f=n(a),h=f.length-1;h>=d;d++)c=d===h?this:this.clone(!0),n(f[d])[b](c),g.apply(e,c.get());return this.pushStack(e)}});var Ja,Ka={HTML:"block",BODY:"block"};function La(a,b){var c=n(b.createElement(a)).appendTo(b.body),d=n.css(c[0],"display");return c.detach(),d}function Ma(a){var b=d,c=Ka[a];return c||(c=La(a,b),"none"!==c&&c||(Ja=(Ja||n("<iframe frameborder='0' width='0' height='0'/>")).appendTo(b.documentElement),b=(Ja[0].contentWindow||Ja[0].contentDocument).document,b.write(),b.close(),c=La(a,b),Ja.detach()),Ka[a]=c),c}var Na=/^margin/,Oa=new RegExp("^("+T+")(?!px)[a-z%]+$","i"),Pa=function(a,b,c,d){var e,f,g={};for(f in b)g[f]=a.style[f],a.style[f]=b[f];e=c.apply(a,d||[]);for(f in b)a.style[f]=g[f];return e},Qa=d.documentElement;!function(){var b,c,e,f,g,h,i=d.createElement("div"),j=d.createElement("div");if(j.style){j.style.cssText="float:left;opacity:.5",l.opacity="0.5"===j.style.opacity,l.cssFloat=!!j.style.cssFloat,j.style.backgroundClip="content-box",j.cloneNode(!0).style.backgroundClip="",l.clearCloneStyle="content-box"===j.style.backgroundClip,i=d.createElement("div"),i.style.cssText="border:0;width:8px;height:0;top:0;left:-9999px;padding:0;margin-top:1px;position:absolute",j.innerHTML="",i.appendChild(j),l.boxSizing=""===j.style.boxSizing||""===j.style.MozBoxSizing||""===j.style.WebkitBoxSizing,n.extend(l,{reliableHiddenOffsets:function(){return null==b&&k(),f},boxSizingReliable:function(){return null==b&&k(),e},pixelMarginRight:function(){return null==b&&k(),c},pixelPosition:function(){return null==b&&k(),b},reliableMarginRight:function(){return null==b&&k(),g},reliableMarginLeft:function(){return null==b&&k(),h}});function k(){var k,l,m=d.documentElement;m.appendChild(i),j.style.cssText="-webkit-box-sizing:border-box;box-sizing:border-box;position:relative;display:block;margin:auto;border:1px;padding:1px;top:1%;width:50%",b=e=h=!1,c=g=!0,a.getComputedStyle&&(l=a.getComputedStyle(j),b="1%"!==(l||{}).top,h="2px"===(l||{}).marginLeft,e="4px"===(l||{width:"4px"}).width,j.style.marginRight="50%",c="4px"===(l||{marginRight:"4px"}).marginRight,k=j.appendChild(d.createElement("div")),k.style.cssText=j.style.cssText="-webkit-box-sizing:content-box;-moz-box-sizing:content-box;box-sizing:content-box;display:block;margin:0;border:0;padding:0",k.style.marginRight=k.style.width="0",j.style.width="1px",g=!parseFloat((a.getComputedStyle(k)||{}).marginRight),j.removeChild(k)),j.style.display="none",f=0===j.getClientRects().length,f&&(j.style.display="",j.innerHTML="<table><tr><td></td><td>t</td></tr></table>",j.childNodes[0].style.borderCollapse="separate",k=j.getElementsByTagName("td"),k[0].style.cssText="margin:0;border:0;padding:0;display:none",f=0===k[0].offsetHeight,f&&(k[0].style.display="",k[1].style.display="none",f=0===k[0].offsetHeight)),m.removeChild(i)}}}();var Ra,Sa,Ta=/^(top|right|bottom|left)$/;a.getComputedStyle?(Ra=function(b){var c=b.ownerDocument.defaultView;return c&&c.opener||(c=a),c.getComputedStyle(b)},Sa=function(a,b,c){var d,e,f,g,h=a.style;return c=c||Ra(a),g=c?c.getPropertyValue(b)||c[b]:void 0,""!==g&&void 0!==g||n.contains(a.ownerDocument,a)||(g=n.style(a,b)),c&&!l.pixelMarginRight()&&Oa.test(g)&&Na.test(b)&&(d=h.width,e=h.minWidth,f=h.maxWidth,h.minWidth=h.maxWidth=h.width=g,g=c.width,h.width=d,h.minWidth=e,h.maxWidth=f),void 0===g?g:g+""}):Qa.currentStyle&&(Ra=function(a){return a.currentStyle},Sa=function(a,b,c){var d,e,f,g,h=a.style;return c=c||Ra(a),g=c?c[b]:void 0,null==g&&h&&h[b]&&(g=h[b]),Oa.test(g)&&!Ta.test(b)&&(d=h.left,e=a.runtimeStyle,f=e&&e.left,f&&(e.left=a.currentStyle.left),h.left="fontSize"===b?"1em":g,g=h.pixelLeft+"px",h.left=d,f&&(e.left=f)),void 0===g?g:g+""||"auto"});function Ua(a,b){return{get:function(){return a()?void delete this.get:(this.get=b).apply(this,arguments)}}}var Va=/alpha\([^)]*\)/i,Wa=/opacity\s*=\s*([^)]*)/i,Xa=/^(none|table(?!-c[ea]).+)/,Ya=new RegExp("^("+T+")(.*)$","i"),Za={position:"absolute",visibility:"hidden",display:"block"},$a={letterSpacing:"0",fontWeight:"400"},_a=["Webkit","O","Moz","ms"],ab=d.createElement("div").style;function bb(a){if(a in ab)return a;var b=a.charAt(0).toUpperCase()+a.slice(1),c=_a.length;while(c--)if(a=_a[c]+b,a in ab)return a}function cb(a,b){for(var c,d,e,f=[],g=0,h=a.length;h>g;g++)d=a[g],d.style&&(f[g]=n._data(d,"olddisplay"),c=d.style.display,b?(f[g]||"none"!==c||(d.style.display=""),""===d.style.display&&W(d)&&(f[g]=n._data(d,"olddisplay",Ma(d.nodeName)))):(e=W(d),(c&&"none"!==c||!e)&&n._data(d,"olddisplay",e?c:n.css(d,"display"))));for(g=0;h>g;g++)d=a[g],d.style&&(b&&"none"!==d.style.display&&""!==d.style.display||(d.style.display=b?f[g]||"":"none"));return a}function db(a,b,c){var d=Ya.exec(b);return d?Math.max(0,d[1]-(c||0))+(d[2]||"px"):b}function eb(a,b,c,d,e){for(var f=c===(d?"border":"content")?4:"width"===b?1:0,g=0;4>f;f+=2)"margin"===c&&(g+=n.css(a,c+V[f],!0,e)),d?("content"===c&&(g-=n.css(a,"padding"+V[f],!0,e)),"margin"!==c&&(g-=n.css(a,"border"+V[f]+"Width",!0,e))):(g+=n.css(a,"padding"+V[f],!0,e),"padding"!==c&&(g+=n.css(a,"border"+V[f]+"Width",!0,e)));return g}function fb(a,b,c){var d=!0,e="width"===b?a.offsetWidth:a.offsetHeight,f=Ra(a),g=l.boxSizing&&"border-box"===n.css(a,"boxSizing",!1,f);if(0>=e||null==e){if(e=Sa(a,b,f),(0>e||null==e)&&(e=a.style[b]),Oa.test(e))return e;d=g&&(l.boxSizingReliable()||e===a.style[b]),e=parseFloat(e)||0}return e+eb(a,b,c||(g?"border":"content"),d,f)+"px"}n.extend({cssHooks:{opacity:{get:function(a,b){if(b){var c=Sa(a,"opacity");return""===c?"1":c}}}},cssNumber:{animationIterationCount:!0,columnCount:!0,fillOpacity:!0,flexGrow:!0,flexShrink:!0,fontWeight:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,widows:!0,zIndex:!0,zoom:!0},cssProps:{"float":l.cssFloat?"cssFloat":"styleFloat"},style:function(a,b,c,d){if(a&&3!==a.nodeType&&8!==a.nodeType&&a.style){var e,f,g,h=n.camelCase(b),i=a.style;if(b=n.cssProps[h]||(n.cssProps[h]=bb(h)||h),g=n.cssHooks[b]||n.cssHooks[h],void 0===c)return g&&"get"in g&&void 0!==(e=g.get(a,!1,d))?e:i[b];if(f=typeof c,"string"===f&&(e=U.exec(c))&&e[1]&&(c=X(a,b,e),f="number"),null!=c&&c===c&&("number"===f&&(c+=e&&e[3]||(n.cssNumber[h]?"":"px")),l.clearCloneStyle||""!==c||0!==b.indexOf("background")||(i[b]="inherit"),!(g&&"set"in g&&void 0===(c=g.set(a,c,d)))))try{i[b]=c}catch(j){}}},css:function(a,b,c,d){var e,f,g,h=n.camelCase(b);return b=n.cssProps[h]||(n.cssProps[h]=bb(h)||h),g=n.cssHooks[b]||n.cssHooks[h],g&&"get"in g&&(f=g.get(a,!0,c)),void 0===f&&(f=Sa(a,b,d)),"normal"===f&&b in $a&&(f=$a[b]),""===c||c?(e=parseFloat(f),c===!0||isFinite(e)?e||0:f):f}}),n.each(["height","width"],function(a,b){n.cssHooks[b]={get:function(a,c,d){return c?Xa.test(n.css(a,"display"))&&0===a.offsetWidth?Pa(a,Za,function(){return fb(a,b,d)}):fb(a,b,d):void 0},set:function(a,c,d){var e=d&&Ra(a);return db(a,c,d?eb(a,b,d,l.boxSizing&&"border-box"===n.css(a,"boxSizing",!1,e),e):0)}}}),l.opacity||(n.cssHooks.opacity={get:function(a,b){return Wa.test((b&&a.currentStyle?a.currentStyle.filter:a.style.filter)||"")?.01*parseFloat(RegExp.$1)+"":b?"1":""},set:function(a,b){var c=a.style,d=a.currentStyle,e=n.isNumeric(b)?"alpha(opacity="+100*b+")":"",f=d&&d.filter||c.filter||"";c.zoom=1,(b>=1||""===b)&&""===n.trim(f.replace(Va,""))&&c.removeAttribute&&(c.removeAttribute("filter"),""===b||d&&!d.filter)||(c.filter=Va.test(f)?f.replace(Va,e):f+" "+e)}}),n.cssHooks.marginRight=Ua(l.reliableMarginRight,function(a,b){return b?Pa(a,{display:"inline-block"},Sa,[a,"marginRight"]):void 0}),n.cssHooks.marginLeft=Ua(l.reliableMarginLeft,function(a,b){return b?(parseFloat(Sa(a,"marginLeft"))||(n.contains(a.ownerDocument,a)?a.getBoundingClientRect().left-Pa(a,{
marginLeft:0},function(){return a.getBoundingClientRect().left}):0))+"px":void 0}),n.each({margin:"",padding:"",border:"Width"},function(a,b){n.cssHooks[a+b]={expand:function(c){for(var d=0,e={},f="string"==typeof c?c.split(" "):[c];4>d;d++)e[a+V[d]+b]=f[d]||f[d-2]||f[0];return e}},Na.test(a)||(n.cssHooks[a+b].set=db)}),n.fn.extend({css:function(a,b){return Y(this,function(a,b,c){var d,e,f={},g=0;if(n.isArray(b)){for(d=Ra(a),e=b.length;e>g;g++)f[b[g]]=n.css(a,b[g],!1,d);return f}return void 0!==c?n.style(a,b,c):n.css(a,b)},a,b,arguments.length>1)},show:function(){return cb(this,!0)},hide:function(){return cb(this)},toggle:function(a){return"boolean"==typeof a?a?this.show():this.hide():this.each(function(){W(this)?n(this).show():n(this).hide()})}});function gb(a,b,c,d,e){return new gb.prototype.init(a,b,c,d,e)}n.Tween=gb,gb.prototype={constructor:gb,init:function(a,b,c,d,e,f){this.elem=a,this.prop=c,this.easing=e||n.easing._default,this.options=b,this.start=this.now=this.cur(),this.end=d,this.unit=f||(n.cssNumber[c]?"":"px")},cur:function(){var a=gb.propHooks[this.prop];return a&&a.get?a.get(this):gb.propHooks._default.get(this)},run:function(a){var b,c=gb.propHooks[this.prop];return this.options.duration?this.pos=b=n.easing[this.easing](a,this.options.duration*a,0,1,this.options.duration):this.pos=b=a,this.now=(this.end-this.start)*b+this.start,this.options.step&&this.options.step.call(this.elem,this.now,this),c&&c.set?c.set(this):gb.propHooks._default.set(this),this}},gb.prototype.init.prototype=gb.prototype,gb.propHooks={_default:{get:function(a){var b;return 1!==a.elem.nodeType||null!=a.elem[a.prop]&&null==a.elem.style[a.prop]?a.elem[a.prop]:(b=n.css(a.elem,a.prop,""),b&&"auto"!==b?b:0)},set:function(a){n.fx.step[a.prop]?n.fx.step[a.prop](a):1!==a.elem.nodeType||null==a.elem.style[n.cssProps[a.prop]]&&!n.cssHooks[a.prop]?a.elem[a.prop]=a.now:n.style(a.elem,a.prop,a.now+a.unit)}}},gb.propHooks.scrollTop=gb.propHooks.scrollLeft={set:function(a){a.elem.nodeType&&a.elem.parentNode&&(a.elem[a.prop]=a.now)}},n.easing={linear:function(a){return a},swing:function(a){return.5-Math.cos(a*Math.PI)/2},_default:"swing"},n.fx=gb.prototype.init,n.fx.step={};var hb,ib,jb=/^(?:toggle|show|hide)$/,kb=/queueHooks$/;function lb(){return a.setTimeout(function(){hb=void 0}),hb=n.now()}function mb(a,b){var c,d={height:a},e=0;for(b=b?1:0;4>e;e+=2-b)c=V[e],d["margin"+c]=d["padding"+c]=a;return b&&(d.opacity=d.width=a),d}function nb(a,b,c){for(var d,e=(qb.tweeners[b]||[]).concat(qb.tweeners["*"]),f=0,g=e.length;g>f;f++)if(d=e[f].call(c,b,a))return d}function ob(a,b,c){var d,e,f,g,h,i,j,k,m=this,o={},p=a.style,q=a.nodeType&&W(a),r=n._data(a,"fxshow");c.queue||(h=n._queueHooks(a,"fx"),null==h.unqueued&&(h.unqueued=0,i=h.empty.fire,h.empty.fire=function(){h.unqueued||i()}),h.unqueued++,m.always(function(){m.always(function(){h.unqueued--,n.queue(a,"fx").length||h.empty.fire()})})),1===a.nodeType&&("height"in b||"width"in b)&&(c.overflow=[p.overflow,p.overflowX,p.overflowY],j=n.css(a,"display"),k="none"===j?n._data(a,"olddisplay")||Ma(a.nodeName):j,"inline"===k&&"none"===n.css(a,"float")&&(l.inlineBlockNeedsLayout&&"inline"!==Ma(a.nodeName)?p.zoom=1:p.display="inline-block")),c.overflow&&(p.overflow="hidden",l.shrinkWrapBlocks()||m.always(function(){p.overflow=c.overflow[0],p.overflowX=c.overflow[1],p.overflowY=c.overflow[2]}));for(d in b)if(e=b[d],jb.exec(e)){if(delete b[d],f=f||"toggle"===e,e===(q?"hide":"show")){if("show"!==e||!r||void 0===r[d])continue;q=!0}o[d]=r&&r[d]||n.style(a,d)}else j=void 0;if(n.isEmptyObject(o))"inline"===("none"===j?Ma(a.nodeName):j)&&(p.display=j);else{r?"hidden"in r&&(q=r.hidden):r=n._data(a,"fxshow",{}),f&&(r.hidden=!q),q?n(a).show():m.done(function(){n(a).hide()}),m.done(function(){var b;n._removeData(a,"fxshow");for(b in o)n.style(a,b,o[b])});for(d in o)g=nb(q?r[d]:0,d,m),d in r||(r[d]=g.start,q&&(g.end=g.start,g.start="width"===d||"height"===d?1:0))}}function pb(a,b){var c,d,e,f,g;for(c in a)if(d=n.camelCase(c),e=b[d],f=a[c],n.isArray(f)&&(e=f[1],f=a[c]=f[0]),c!==d&&(a[d]=f,delete a[c]),g=n.cssHooks[d],g&&"expand"in g){f=g.expand(f),delete a[d];for(c in f)c in a||(a[c]=f[c],b[c]=e)}else b[d]=e}function qb(a,b,c){var d,e,f=0,g=qb.prefilters.length,h=n.Deferred().always(function(){delete i.elem}),i=function(){if(e)return!1;for(var b=hb||lb(),c=Math.max(0,j.startTime+j.duration-b),d=c/j.duration||0,f=1-d,g=0,i=j.tweens.length;i>g;g++)j.tweens[g].run(f);return h.notifyWith(a,[j,f,c]),1>f&&i?c:(h.resolveWith(a,[j]),!1)},j=h.promise({elem:a,props:n.extend({},b),opts:n.extend(!0,{specialEasing:{},easing:n.easing._default},c),originalProperties:b,originalOptions:c,startTime:hb||lb(),duration:c.duration,tweens:[],createTween:function(b,c){var d=n.Tween(a,j.opts,b,c,j.opts.specialEasing[b]||j.opts.easing);return j.tweens.push(d),d},stop:function(b){var c=0,d=b?j.tweens.length:0;if(e)return this;for(e=!0;d>c;c++)j.tweens[c].run(1);return b?(h.notifyWith(a,[j,1,0]),h.resolveWith(a,[j,b])):h.rejectWith(a,[j,b]),this}}),k=j.props;for(pb(k,j.opts.specialEasing);g>f;f++)if(d=qb.prefilters[f].call(j,a,k,j.opts))return n.isFunction(d.stop)&&(n._queueHooks(j.elem,j.opts.queue).stop=n.proxy(d.stop,d)),d;return n.map(k,nb,j),n.isFunction(j.opts.start)&&j.opts.start.call(a,j),n.fx.timer(n.extend(i,{elem:a,anim:j,queue:j.opts.queue})),j.progress(j.opts.progress).done(j.opts.done,j.opts.complete).fail(j.opts.fail).always(j.opts.always)}n.Animation=n.extend(qb,{tweeners:{"*":[function(a,b){var c=this.createTween(a,b);return X(c.elem,a,U.exec(b),c),c}]},tweener:function(a,b){n.isFunction(a)?(b=a,a=["*"]):a=a.match(G);for(var c,d=0,e=a.length;e>d;d++)c=a[d],qb.tweeners[c]=qb.tweeners[c]||[],qb.tweeners[c].unshift(b)},prefilters:[ob],prefilter:function(a,b){b?qb.prefilters.unshift(a):qb.prefilters.push(a)}}),n.speed=function(a,b,c){var d=a&&"object"==typeof a?n.extend({},a):{complete:c||!c&&b||n.isFunction(a)&&a,duration:a,easing:c&&b||b&&!n.isFunction(b)&&b};return d.duration=n.fx.off?0:"number"==typeof d.duration?d.duration:d.duration in n.fx.speeds?n.fx.speeds[d.duration]:n.fx.speeds._default,null!=d.queue&&d.queue!==!0||(d.queue="fx"),d.old=d.complete,d.complete=function(){n.isFunction(d.old)&&d.old.call(this),d.queue&&n.dequeue(this,d.queue)},d},n.fn.extend({fadeTo:function(a,b,c,d){return this.filter(W).css("opacity",0).show().end().animate({opacity:b},a,c,d)},animate:function(a,b,c,d){var e=n.isEmptyObject(a),f=n.speed(b,c,d),g=function(){var b=qb(this,n.extend({},a),f);(e||n._data(this,"finish"))&&b.stop(!0)};return g.finish=g,e||f.queue===!1?this.each(g):this.queue(f.queue,g)},stop:function(a,b,c){var d=function(a){var b=a.stop;delete a.stop,b(c)};return"string"!=typeof a&&(c=b,b=a,a=void 0),b&&a!==!1&&this.queue(a||"fx",[]),this.each(function(){var b=!0,e=null!=a&&a+"queueHooks",f=n.timers,g=n._data(this);if(e)g[e]&&g[e].stop&&d(g[e]);else for(e in g)g[e]&&g[e].stop&&kb.test(e)&&d(g[e]);for(e=f.length;e--;)f[e].elem!==this||null!=a&&f[e].queue!==a||(f[e].anim.stop(c),b=!1,f.splice(e,1));!b&&c||n.dequeue(this,a)})},finish:function(a){return a!==!1&&(a=a||"fx"),this.each(function(){var b,c=n._data(this),d=c[a+"queue"],e=c[a+"queueHooks"],f=n.timers,g=d?d.length:0;for(c.finish=!0,n.queue(this,a,[]),e&&e.stop&&e.stop.call(this,!0),b=f.length;b--;)f[b].elem===this&&f[b].queue===a&&(f[b].anim.stop(!0),f.splice(b,1));for(b=0;g>b;b++)d[b]&&d[b].finish&&d[b].finish.call(this);delete c.finish})}}),n.each(["toggle","show","hide"],function(a,b){var c=n.fn[b];n.fn[b]=function(a,d,e){return null==a||"boolean"==typeof a?c.apply(this,arguments):this.animate(mb(b,!0),a,d,e)}}),n.each({slideDown:mb("show"),slideUp:mb("hide"),slideToggle:mb("toggle"),fadeIn:{opacity:"show"},fadeOut:{opacity:"hide"},fadeToggle:{opacity:"toggle"}},function(a,b){n.fn[a]=function(a,c,d){return this.animate(b,a,c,d)}}),n.timers=[],n.fx.tick=function(){var a,b=n.timers,c=0;for(hb=n.now();c<b.length;c++)a=b[c],a()||b[c]!==a||b.splice(c--,1);b.length||n.fx.stop(),hb=void 0},n.fx.timer=function(a){n.timers.push(a),a()?n.fx.start():n.timers.pop()},n.fx.interval=13,n.fx.start=function(){ib||(ib=a.setInterval(n.fx.tick,n.fx.interval))},n.fx.stop=function(){a.clearInterval(ib),ib=null},n.fx.speeds={slow:600,fast:200,_default:400},n.fn.delay=function(b,c){return b=n.fx?n.fx.speeds[b]||b:b,c=c||"fx",this.queue(c,function(c,d){var e=a.setTimeout(c,b);d.stop=function(){a.clearTimeout(e)}})},function(){var a,b=d.createElement("input"),c=d.createElement("div"),e=d.createElement("select"),f=e.appendChild(d.createElement("option"));c=d.createElement("div"),c.setAttribute("className","t"),c.innerHTML="  <link/><table></table><a href='/a'>a</a><input type='checkbox'/>",a=c.getElementsByTagName("a")[0],b.setAttribute("type","checkbox"),c.appendChild(b),a=c.getElementsByTagName("a")[0],a.style.cssText="top:1px",l.getSetAttribute="t"!==c.className,l.style=/top/.test(a.getAttribute("style")),l.hrefNormalized="/a"===a.getAttribute("href"),l.checkOn=!!b.value,l.optSelected=f.selected,l.enctype=!!d.createElement("form").enctype,e.disabled=!0,l.optDisabled=!f.disabled,b=d.createElement("input"),b.setAttribute("value",""),l.input=""===b.getAttribute("value"),b.value="t",b.setAttribute("type","radio"),l.radioValue="t"===b.value}();var rb=/\r/g,sb=/[\x20\t\r\n\f]+/g;n.fn.extend({val:function(a){var b,c,d,e=this[0];{if(arguments.length)return d=n.isFunction(a),this.each(function(c){var e;1===this.nodeType&&(e=d?a.call(this,c,n(this).val()):a,null==e?e="":"number"==typeof e?e+="":n.isArray(e)&&(e=n.map(e,function(a){return null==a?"":a+""})),b=n.valHooks[this.type]||n.valHooks[this.nodeName.toLowerCase()],b&&"set"in b&&void 0!==b.set(this,e,"value")||(this.value=e))});if(e)return b=n.valHooks[e.type]||n.valHooks[e.nodeName.toLowerCase()],b&&"get"in b&&void 0!==(c=b.get(e,"value"))?c:(c=e.value,"string"==typeof c?c.replace(rb,""):null==c?"":c)}}}),n.extend({valHooks:{option:{get:function(a){var b=n.find.attr(a,"value");return null!=b?b:n.trim(n.text(a)).replace(sb," ")}},select:{get:function(a){for(var b,c,d=a.options,e=a.selectedIndex,f="select-one"===a.type||0>e,g=f?null:[],h=f?e+1:d.length,i=0>e?h:f?e:0;h>i;i++)if(c=d[i],(c.selected||i===e)&&(l.optDisabled?!c.disabled:null===c.getAttribute("disabled"))&&(!c.parentNode.disabled||!n.nodeName(c.parentNode,"optgroup"))){if(b=n(c).val(),f)return b;g.push(b)}return g},set:function(a,b){var c,d,e=a.options,f=n.makeArray(b),g=e.length;while(g--)if(d=e[g],n.inArray(n.valHooks.option.get(d),f)>-1)try{d.selected=c=!0}catch(h){d.scrollHeight}else d.selected=!1;return c||(a.selectedIndex=-1),e}}}}),n.each(["radio","checkbox"],function(){n.valHooks[this]={set:function(a,b){return n.isArray(b)?a.checked=n.inArray(n(a).val(),b)>-1:void 0}},l.checkOn||(n.valHooks[this].get=function(a){return null===a.getAttribute("value")?"on":a.value})});var tb,ub,vb=n.expr.attrHandle,wb=/^(?:checked|selected)$/i,xb=l.getSetAttribute,yb=l.input;n.fn.extend({attr:function(a,b){return Y(this,n.attr,a,b,arguments.length>1)},removeAttr:function(a){return this.each(function(){n.removeAttr(this,a)})}}),n.extend({attr:function(a,b,c){var d,e,f=a.nodeType;if(3!==f&&8!==f&&2!==f)return"undefined"==typeof a.getAttribute?n.prop(a,b,c):(1===f&&n.isXMLDoc(a)||(b=b.toLowerCase(),e=n.attrHooks[b]||(n.expr.match.bool.test(b)?ub:tb)),void 0!==c?null===c?void n.removeAttr(a,b):e&&"set"in e&&void 0!==(d=e.set(a,c,b))?d:(a.setAttribute(b,c+""),c):e&&"get"in e&&null!==(d=e.get(a,b))?d:(d=n.find.attr(a,b),null==d?void 0:d))},attrHooks:{type:{set:function(a,b){if(!l.radioValue&&"radio"===b&&n.nodeName(a,"input")){var c=a.value;return a.setAttribute("type",b),c&&(a.value=c),b}}}},removeAttr:function(a,b){var c,d,e=0,f=b&&b.match(G);if(f&&1===a.nodeType)while(c=f[e++])d=n.propFix[c]||c,n.expr.match.bool.test(c)?yb&&xb||!wb.test(c)?a[d]=!1:a[n.camelCase("default-"+c)]=a[d]=!1:n.attr(a,c,""),a.removeAttribute(xb?c:d)}}),ub={set:function(a,b,c){return b===!1?n.removeAttr(a,c):yb&&xb||!wb.test(c)?a.setAttribute(!xb&&n.propFix[c]||c,c):a[n.camelCase("default-"+c)]=a[c]=!0,c}},n.each(n.expr.match.bool.source.match(/\w+/g),function(a,b){var c=vb[b]||n.find.attr;yb&&xb||!wb.test(b)?vb[b]=function(a,b,d){var e,f;return d||(f=vb[b],vb[b]=e,e=null!=c(a,b,d)?b.toLowerCase():null,vb[b]=f),e}:vb[b]=function(a,b,c){return c?void 0:a[n.camelCase("default-"+b)]?b.toLowerCase():null}}),yb&&xb||(n.attrHooks.value={set:function(a,b,c){return n.nodeName(a,"input")?void(a.defaultValue=b):tb&&tb.set(a,b,c)}}),xb||(tb={set:function(a,b,c){var d=a.getAttributeNode(c);return d||a.setAttributeNode(d=a.ownerDocument.createAttribute(c)),d.value=b+="","value"===c||b===a.getAttribute(c)?b:void 0}},vb.id=vb.name=vb.coords=function(a,b,c){var d;return c?void 0:(d=a.getAttributeNode(b))&&""!==d.value?d.value:null},n.valHooks.button={get:function(a,b){var c=a.getAttributeNode(b);return c&&c.specified?c.value:void 0},set:tb.set},n.attrHooks.contenteditable={set:function(a,b,c){tb.set(a,""===b?!1:b,c)}},n.each(["width","height"],function(a,b){n.attrHooks[b]={set:function(a,c){return""===c?(a.setAttribute(b,"auto"),c):void 0}}})),l.style||(n.attrHooks.style={get:function(a){return a.style.cssText||void 0},set:function(a,b){return a.style.cssText=b+""}});var zb=/^(?:input|select|textarea|button|object)$/i,Ab=/^(?:a|area)$/i;n.fn.extend({prop:function(a,b){return Y(this,n.prop,a,b,arguments.length>1)},removeProp:function(a){return a=n.propFix[a]||a,this.each(function(){try{this[a]=void 0,delete this[a]}catch(b){}})}}),n.extend({prop:function(a,b,c){var d,e,f=a.nodeType;if(3!==f&&8!==f&&2!==f)return 1===f&&n.isXMLDoc(a)||(b=n.propFix[b]||b,e=n.propHooks[b]),void 0!==c?e&&"set"in e&&void 0!==(d=e.set(a,c,b))?d:a[b]=c:e&&"get"in e&&null!==(d=e.get(a,b))?d:a[b]},propHooks:{tabIndex:{get:function(a){var b=n.find.attr(a,"tabindex");return b?parseInt(b,10):zb.test(a.nodeName)||Ab.test(a.nodeName)&&a.href?0:-1}}},propFix:{"for":"htmlFor","class":"className"}}),l.hrefNormalized||n.each(["href","src"],function(a,b){n.propHooks[b]={get:function(a){return a.getAttribute(b,4)}}}),l.optSelected||(n.propHooks.selected={get:function(a){var b=a.parentNode;return b&&(b.selectedIndex,b.parentNode&&b.parentNode.selectedIndex),null},set:function(a){var b=a.parentNode;b&&(b.selectedIndex,b.parentNode&&b.parentNode.selectedIndex)}}),n.each(["tabIndex","readOnly","maxLength","cellSpacing","cellPadding","rowSpan","colSpan","useMap","frameBorder","contentEditable"],function(){n.propFix[this.toLowerCase()]=this}),l.enctype||(n.propFix.enctype="encoding");var Bb=/[\t\r\n\f]/g;function Cb(a){return n.attr(a,"class")||""}n.fn.extend({addClass:function(a){var b,c,d,e,f,g,h,i=0;if(n.isFunction(a))return this.each(function(b){n(this).addClass(a.call(this,b,Cb(this)))});if("string"==typeof a&&a){b=a.match(G)||[];while(c=this[i++])if(e=Cb(c),d=1===c.nodeType&&(" "+e+" ").replace(Bb," ")){g=0;while(f=b[g++])d.indexOf(" "+f+" ")<0&&(d+=f+" ");h=n.trim(d),e!==h&&n.attr(c,"class",h)}}return this},removeClass:function(a){var b,c,d,e,f,g,h,i=0;if(n.isFunction(a))return this.each(function(b){n(this).removeClass(a.call(this,b,Cb(this)))});if(!arguments.length)return this.attr("class","");if("string"==typeof a&&a){b=a.match(G)||[];while(c=this[i++])if(e=Cb(c),d=1===c.nodeType&&(" "+e+" ").replace(Bb," ")){g=0;while(f=b[g++])while(d.indexOf(" "+f+" ")>-1)d=d.replace(" "+f+" "," ");h=n.trim(d),e!==h&&n.attr(c,"class",h)}}return this},toggleClass:function(a,b){var c=typeof a;return"boolean"==typeof b&&"string"===c?b?this.addClass(a):this.removeClass(a):n.isFunction(a)?this.each(function(c){n(this).toggleClass(a.call(this,c,Cb(this),b),b)}):this.each(function(){var b,d,e,f;if("string"===c){d=0,e=n(this),f=a.match(G)||[];while(b=f[d++])e.hasClass(b)?e.removeClass(b):e.addClass(b)}else void 0!==a&&"boolean"!==c||(b=Cb(this),b&&n._data(this,"__className__",b),n.attr(this,"class",b||a===!1?"":n._data(this,"__className__")||""))})},hasClass:function(a){var b,c,d=0;b=" "+a+" ";while(c=this[d++])if(1===c.nodeType&&(" "+Cb(c)+" ").replace(Bb," ").indexOf(b)>-1)return!0;return!1}}),n.each("blur focus focusin focusout load resize scroll unload click dblclick mousedown mouseup mousemove mouseover mouseout mouseenter mouseleave change select submit keydown keypress keyup error contextmenu".split(" "),function(a,b){n.fn[b]=function(a,c){return arguments.length>0?this.on(b,null,a,c):this.trigger(b)}}),n.fn.extend({hover:function(a,b){return this.mouseenter(a).mouseleave(b||a)}});var Db=a.location,Eb=n.now(),Fb=/\?/,Gb=/(,)|(\[|{)|(}|])|"(?:[^"\\\r\n]|\\["\\\/bfnrt]|\\u[\da-fA-F]{4})*"\s*:?|true|false|null|-?(?!0\d)\d+(?:\.\d+|)(?:[eE][+-]?\d+|)/g;n.parseJSON=function(b){if(a.JSON&&a.JSON.parse)return a.JSON.parse(b+"");var c,d=null,e=n.trim(b+"");return e&&!n.trim(e.replace(Gb,function(a,b,e,f){return c&&b&&(d=0),0===d?a:(c=e||b,d+=!f-!e,"")}))?Function("return "+e)():n.error("Invalid JSON: "+b)},n.parseXML=function(b){var c,d;if(!b||"string"!=typeof b)return null;try{a.DOMParser?(d=new a.DOMParser,c=d.parseFromString(b,"text/xml")):(c=new a.ActiveXObject("Microsoft.XMLDOM"),c.async="false",c.loadXML(b))}catch(e){c=void 0}return c&&c.documentElement&&!c.getElementsByTagName("parsererror").length||n.error("Invalid XML: "+b),c};var Hb=/#.*$/,Ib=/([?&])_=[^&]*/,Jb=/^(.*?):[ \t]*([^\r\n]*)\r?$/gm,Kb=/^(?:about|app|app-storage|.+-extension|file|res|widget):$/,Lb=/^(?:GET|HEAD)$/,Mb=/^\/\//,Nb=/^([\w.+-]+:)(?:\/\/(?:[^\/?#]*@|)([^\/?#:]*)(?::(\d+)|)|)/,Ob={},Pb={},Qb="*/".concat("*"),Rb=Db.href,Sb=Nb.exec(Rb.toLowerCase())||[];function Tb(a){return function(b,c){"string"!=typeof b&&(c=b,b="*");var d,e=0,f=b.toLowerCase().match(G)||[];if(n.isFunction(c))while(d=f[e++])"+"===d.charAt(0)?(d=d.slice(1)||"*",(a[d]=a[d]||[]).unshift(c)):(a[d]=a[d]||[]).push(c)}}function Ub(a,b,c,d){var e={},f=a===Pb;function g(h){var i;return e[h]=!0,n.each(a[h]||[],function(a,h){var j=h(b,c,d);return"string"!=typeof j||f||e[j]?f?!(i=j):void 0:(b.dataTypes.unshift(j),g(j),!1)}),i}return g(b.dataTypes[0])||!e["*"]&&g("*")}function Vb(a,b){var c,d,e=n.ajaxSettings.flatOptions||{};for(d in b)void 0!==b[d]&&((e[d]?a:c||(c={}))[d]=b[d]);return c&&n.extend(!0,a,c),a}function Wb(a,b,c){var d,e,f,g,h=a.contents,i=a.dataTypes;while("*"===i[0])i.shift(),void 0===e&&(e=a.mimeType||b.getResponseHeader("Content-Type"));if(e)for(g in h)if(h[g]&&h[g].test(e)){i.unshift(g);break}if(i[0]in c)f=i[0];else{for(g in c){if(!i[0]||a.converters[g+" "+i[0]]){f=g;break}d||(d=g)}f=f||d}return f?(f!==i[0]&&i.unshift(f),c[f]):void 0}function Xb(a,b,c,d){var e,f,g,h,i,j={},k=a.dataTypes.slice();if(k[1])for(g in a.converters)j[g.toLowerCase()]=a.converters[g];f=k.shift();while(f)if(a.responseFields[f]&&(c[a.responseFields[f]]=b),!i&&d&&a.dataFilter&&(b=a.dataFilter(b,a.dataType)),i=f,f=k.shift())if("*"===f)f=i;else if("*"!==i&&i!==f){if(g=j[i+" "+f]||j["* "+f],!g)for(e in j)if(h=e.split(" "),h[1]===f&&(g=j[i+" "+h[0]]||j["* "+h[0]])){g===!0?g=j[e]:j[e]!==!0&&(f=h[0],k.unshift(h[1]));break}if(g!==!0)if(g&&a["throws"])b=g(b);else try{b=g(b)}catch(l){return{state:"parsererror",error:g?l:"No conversion from "+i+" to "+f}}}return{state:"success",data:b}}n.extend({active:0,lastModified:{},etag:{},ajaxSettings:{url:Rb,type:"GET",isLocal:Kb.test(Sb[1]),global:!0,processData:!0,async:!0,contentType:"application/x-www-form-urlencoded; charset=UTF-8",accepts:{"*":Qb,text:"text/plain",html:"text/html",xml:"application/xml, text/xml",json:"application/json, text/javascript"},contents:{xml:/\bxml\b/,html:/\bhtml/,json:/\bjson\b/},responseFields:{xml:"responseXML",text:"responseText",json:"responseJSON"},converters:{"* text":String,"text html":!0,"text json":n.parseJSON,"text xml":n.parseXML},flatOptions:{url:!0,context:!0}},ajaxSetup:function(a,b){return b?Vb(Vb(a,n.ajaxSettings),b):Vb(n.ajaxSettings,a)},ajaxPrefilter:Tb(Ob),ajaxTransport:Tb(Pb),ajax:function(b,c){"object"==typeof b&&(c=b,b=void 0),c=c||{};var d,e,f,g,h,i,j,k,l=n.ajaxSetup({},c),m=l.context||l,o=l.context&&(m.nodeType||m.jquery)?n(m):n.event,p=n.Deferred(),q=n.Callbacks("once memory"),r=l.statusCode||{},s={},t={},u=0,v="canceled",w={readyState:0,getResponseHeader:function(a){var b;if(2===u){if(!k){k={};while(b=Jb.exec(g))k[b[1].toLowerCase()]=b[2]}b=k[a.toLowerCase()]}return null==b?null:b},getAllResponseHeaders:function(){return 2===u?g:null},setRequestHeader:function(a,b){var c=a.toLowerCase();return u||(a=t[c]=t[c]||a,s[a]=b),this},overrideMimeType:function(a){return u||(l.mimeType=a),this},statusCode:function(a){var b;if(a)if(2>u)for(b in a)r[b]=[r[b],a[b]];else w.always(a[w.status]);return this},abort:function(a){var b=a||v;return j&&j.abort(b),y(0,b),this}};if(p.promise(w).complete=q.add,w.success=w.done,w.error=w.fail,l.url=((b||l.url||Rb)+"").replace(Hb,"").replace(Mb,Sb[1]+"//"),l.type=c.method||c.type||l.method||l.type,l.dataTypes=n.trim(l.dataType||"*").toLowerCase().match(G)||[""],null==l.crossDomain&&(d=Nb.exec(l.url.toLowerCase()),l.crossDomain=!(!d||d[1]===Sb[1]&&d[2]===Sb[2]&&(d[3]||("http:"===d[1]?"80":"443"))===(Sb[3]||("http:"===Sb[1]?"80":"443")))),l.data&&l.processData&&"string"!=typeof l.data&&(l.data=n.param(l.data,l.traditional)),Ub(Ob,l,c,w),2===u)return w;i=n.event&&l.global,i&&0===n.active++&&n.event.trigger("ajaxStart"),l.type=l.type.toUpperCase(),l.hasContent=!Lb.test(l.type),f=l.url,l.hasContent||(l.data&&(f=l.url+=(Fb.test(f)?"&":"?")+l.data,delete l.data),l.cache===!1&&(l.url=Ib.test(f)?f.replace(Ib,"$1_="+Eb++):f+(Fb.test(f)?"&":"?")+"_="+Eb++)),l.ifModified&&(n.lastModified[f]&&w.setRequestHeader("If-Modified-Since",n.lastModified[f]),n.etag[f]&&w.setRequestHeader("If-None-Match",n.etag[f])),(l.data&&l.hasContent&&l.contentType!==!1||c.contentType)&&w.setRequestHeader("Content-Type",l.contentType),w.setRequestHeader("Accept",l.dataTypes[0]&&l.accepts[l.dataTypes[0]]?l.accepts[l.dataTypes[0]]+("*"!==l.dataTypes[0]?", "+Qb+"; q=0.01":""):l.accepts["*"]);for(e in l.headers)w.setRequestHeader(e,l.headers[e]);if(l.beforeSend&&(l.beforeSend.call(m,w,l)===!1||2===u))return w.abort();v="abort";for(e in{success:1,error:1,complete:1})w[e](l[e]);if(j=Ub(Pb,l,c,w)){if(w.readyState=1,i&&o.trigger("ajaxSend",[w,l]),2===u)return w;l.async&&l.timeout>0&&(h=a.setTimeout(function(){w.abort("timeout")},l.timeout));try{u=1,j.send(s,y)}catch(x){if(!(2>u))throw x;y(-1,x)}}else y(-1,"No Transport");function y(b,c,d,e){var k,s,t,v,x,y=c;2!==u&&(u=2,h&&a.clearTimeout(h),j=void 0,g=e||"",w.readyState=b>0?4:0,k=b>=200&&300>b||304===b,d&&(v=Wb(l,w,d)),v=Xb(l,v,w,k),k?(l.ifModified&&(x=w.getResponseHeader("Last-Modified"),x&&(n.lastModified[f]=x),x=w.getResponseHeader("etag"),x&&(n.etag[f]=x)),204===b||"HEAD"===l.type?y="nocontent":304===b?y="notmodified":(y=v.state,s=v.data,t=v.error,k=!t)):(t=y,!b&&y||(y="error",0>b&&(b=0))),w.status=b,w.statusText=(c||y)+"",k?p.resolveWith(m,[s,y,w]):p.rejectWith(m,[w,y,t]),w.statusCode(r),r=void 0,i&&o.trigger(k?"ajaxSuccess":"ajaxError",[w,l,k?s:t]),q.fireWith(m,[w,y]),i&&(o.trigger("ajaxComplete",[w,l]),--n.active||n.event.trigger("ajaxStop")))}return w},getJSON:function(a,b,c){return n.get(a,b,c,"json")},getScript:function(a,b){return n.get(a,void 0,b,"script")}}),n.each(["get","post"],function(a,b){n[b]=function(a,c,d,e){return n.isFunction(c)&&(e=e||d,d=c,c=void 0),n.ajax(n.extend({url:a,type:b,dataType:e,data:c,success:d},n.isPlainObject(a)&&a))}}),n._evalUrl=function(a){return n.ajax({url:a,type:"GET",dataType:"script",cache:!0,async:!1,global:!1,"throws":!0})},n.fn.extend({wrapAll:function(a){if(n.isFunction(a))return this.each(function(b){n(this).wrapAll(a.call(this,b))});if(this[0]){var b=n(a,this[0].ownerDocument).eq(0).clone(!0);this[0].parentNode&&b.insertBefore(this[0]),b.map(function(){var a=this;while(a.firstChild&&1===a.firstChild.nodeType)a=a.firstChild;return a}).append(this)}return this},wrapInner:function(a){return n.isFunction(a)?this.each(function(b){n(this).wrapInner(a.call(this,b))}):this.each(function(){var b=n(this),c=b.contents();c.length?c.wrapAll(a):b.append(a)})},wrap:function(a){var b=n.isFunction(a);return this.each(function(c){n(this).wrapAll(b?a.call(this,c):a)})},unwrap:function(){return this.parent().each(function(){n.nodeName(this,"body")||n(this).replaceWith(this.childNodes)}).end()}});function Yb(a){return a.style&&a.style.display||n.css(a,"display")}function Zb(a){if(!n.contains(a.ownerDocument||d,a))return!0;while(a&&1===a.nodeType){if("none"===Yb(a)||"hidden"===a.type)return!0;a=a.parentNode}return!1}n.expr.filters.hidden=function(a){return l.reliableHiddenOffsets()?a.offsetWidth<=0&&a.offsetHeight<=0&&!a.getClientRects().length:Zb(a)},n.expr.filters.visible=function(a){return!n.expr.filters.hidden(a)};var $b=/%20/g,_b=/\[\]$/,ac=/\r?\n/g,bc=/^(?:submit|button|image|reset|file)$/i,cc=/^(?:input|select|textarea|keygen)/i;function dc(a,b,c,d){var e;if(n.isArray(b))n.each(b,function(b,e){c||_b.test(a)?d(a,e):dc(a+"["+("object"==typeof e&&null!=e?b:"")+"]",e,c,d)});else if(c||"object"!==n.type(b))d(a,b);else for(e in b)dc(a+"["+e+"]",b[e],c,d)}n.param=function(a,b){var c,d=[],e=function(a,b){b=n.isFunction(b)?b():null==b?"":b,d[d.length]=encodeURIComponent(a)+"="+encodeURIComponent(b)};if(void 0===b&&(b=n.ajaxSettings&&n.ajaxSettings.traditional),n.isArray(a)||a.jquery&&!n.isPlainObject(a))n.each(a,function(){e(this.name,this.value)});else for(c in a)dc(c,a[c],b,e);return d.join("&").replace($b,"+")},n.fn.extend({serialize:function(){return n.param(this.serializeArray())},serializeArray:function(){return this.map(function(){var a=n.prop(this,"elements");return a?n.makeArray(a):this}).filter(function(){var a=this.type;return this.name&&!n(this).is(":disabled")&&cc.test(this.nodeName)&&!bc.test(a)&&(this.checked||!Z.test(a))}).map(function(a,b){var c=n(this).val();return null==c?null:n.isArray(c)?n.map(c,function(a){return{name:b.name,value:a.replace(ac,"\r\n")}}):{name:b.name,value:c.replace(ac,"\r\n")}}).get()}}),n.ajaxSettings.xhr=void 0!==a.ActiveXObject?function(){return this.isLocal?ic():d.documentMode>8?hc():/^(get|post|head|put|delete|options)$/i.test(this.type)&&hc()||ic()}:hc;var ec=0,fc={},gc=n.ajaxSettings.xhr();a.attachEvent&&a.attachEvent("onunload",function(){for(var a in fc)fc[a](void 0,!0)}),l.cors=!!gc&&"withCredentials"in gc,gc=l.ajax=!!gc,gc&&n.ajaxTransport(function(b){if(!b.crossDomain||l.cors){var c;return{send:function(d,e){var f,g=b.xhr(),h=++ec;if(g.open(b.type,b.url,b.async,b.username,b.password),b.xhrFields)for(f in b.xhrFields)g[f]=b.xhrFields[f];b.mimeType&&g.overrideMimeType&&g.overrideMimeType(b.mimeType),b.crossDomain||d["X-Requested-With"]||(d["X-Requested-With"]="XMLHttpRequest");for(f in d)void 0!==d[f]&&g.setRequestHeader(f,d[f]+"");g.send(b.hasContent&&b.data||null),c=function(a,d){var f,i,j;if(c&&(d||4===g.readyState))if(delete fc[h],c=void 0,g.onreadystatechange=n.noop,d)4!==g.readyState&&g.abort();else{j={},f=g.status,"string"==typeof g.responseText&&(j.text=g.responseText);try{i=g.statusText}catch(k){i=""}f||!b.isLocal||b.crossDomain?1223===f&&(f=204):f=j.text?200:404}j&&e(f,i,j,g.getAllResponseHeaders())},b.async?4===g.readyState?a.setTimeout(c):g.onreadystatechange=fc[h]=c:c()},abort:function(){c&&c(void 0,!0)}}}});function hc(){try{return new a.XMLHttpRequest}catch(b){}}function ic(){try{return new a.ActiveXObject("Microsoft.XMLHTTP")}catch(b){}}n.ajaxSetup({accepts:{script:"text/javascript, application/javascript, application/ecmascript, application/x-ecmascript"},contents:{script:/\b(?:java|ecma)script\b/},converters:{"text script":function(a){return n.globalEval(a),a}}}),n.ajaxPrefilter("script",function(a){void 0===a.cache&&(a.cache=!1),a.crossDomain&&(a.type="GET",a.global=!1)}),n.ajaxTransport("script",function(a){if(a.crossDomain){var b,c=d.head||n("head")[0]||d.documentElement;return{send:function(e,f){b=d.createElement("script"),b.async=!0,a.scriptCharset&&(b.charset=a.scriptCharset),b.src=a.url,b.onload=b.onreadystatechange=function(a,c){(c||!b.readyState||/loaded|complete/.test(b.readyState))&&(b.onload=b.onreadystatechange=null,b.parentNode&&b.parentNode.removeChild(b),b=null,c||f(200,"success"))},c.insertBefore(b,c.firstChild)},abort:function(){b&&b.onload(void 0,!0)}}}});var jc=[],kc=/(=)\?(?=&|$)|\?\?/;n.ajaxSetup({jsonp:"callback",jsonpCallback:function(){var a=jc.pop()||n.expando+"_"+Eb++;return this[a]=!0,a}}),n.ajaxPrefilter("json jsonp",function(b,c,d){var e,f,g,h=b.jsonp!==!1&&(kc.test(b.url)?"url":"string"==typeof b.data&&0===(b.contentType||"").indexOf("application/x-www-form-urlencoded")&&kc.test(b.data)&&"data");return h||"jsonp"===b.dataTypes[0]?(e=b.jsonpCallback=n.isFunction(b.jsonpCallback)?b.jsonpCallback():b.jsonpCallback,h?b[h]=b[h].replace(kc,"$1"+e):b.jsonp!==!1&&(b.url+=(Fb.test(b.url)?"&":"?")+b.jsonp+"="+e),b.converters["script json"]=function(){return g||n.error(e+" was not called"),g[0]},b.dataTypes[0]="json",f=a[e],a[e]=function(){g=arguments},d.always(function(){void 0===f?n(a).removeProp(e):a[e]=f,b[e]&&(b.jsonpCallback=c.jsonpCallback,jc.push(e)),g&&n.isFunction(f)&&f(g[0]),g=f=void 0}),"script"):void 0}),n.parseHTML=function(a,b,c){if(!a||"string"!=typeof a)return null;"boolean"==typeof b&&(c=b,b=!1),b=b||d;var e=x.exec(a),f=!c&&[];return e?[b.createElement(e[1])]:(e=ja([a],b,f),f&&f.length&&n(f).remove(),n.merge([],e.childNodes))};var lc=n.fn.load;n.fn.load=function(a,b,c){if("string"!=typeof a&&lc)return lc.apply(this,arguments);var d,e,f,g=this,h=a.indexOf(" ");return h>-1&&(d=n.trim(a.slice(h,a.length)),a=a.slice(0,h)),n.isFunction(b)?(c=b,b=void 0):b&&"object"==typeof b&&(e="POST"),g.length>0&&n.ajax({url:a,type:e||"GET",dataType:"html",data:b}).done(function(a){f=arguments,g.html(d?n("<div>").append(n.parseHTML(a)).find(d):a)}).always(c&&function(a,b){g.each(function(){c.apply(this,f||[a.responseText,b,a])})}),this},n.each(["ajaxStart","ajaxStop","ajaxComplete","ajaxError","ajaxSuccess","ajaxSend"],function(a,b){n.fn[b]=function(a){return this.on(b,a)}}),n.expr.filters.animated=function(a){return n.grep(n.timers,function(b){return a===b.elem}).length};function mc(a){return n.isWindow(a)?a:9===a.nodeType?a.defaultView||a.parentWindow:!1}n.offset={setOffset:function(a,b,c){var d,e,f,g,h,i,j,k=n.css(a,"position"),l=n(a),m={};"static"===k&&(a.style.position="relative"),h=l.offset(),f=n.css(a,"top"),i=n.css(a,"left"),j=("absolute"===k||"fixed"===k)&&n.inArray("auto",[f,i])>-1,j?(d=l.position(),g=d.top,e=d.left):(g=parseFloat(f)||0,e=parseFloat(i)||0),n.isFunction(b)&&(b=b.call(a,c,n.extend({},h))),null!=b.top&&(m.top=b.top-h.top+g),null!=b.left&&(m.left=b.left-h.left+e),"using"in b?b.using.call(a,m):l.css(m)}},n.fn.extend({offset:function(a){if(arguments.length)return void 0===a?this:this.each(function(b){n.offset.setOffset(this,a,b)});var b,c,d={top:0,left:0},e=this[0],f=e&&e.ownerDocument;if(f)return b=f.documentElement,n.contains(b,e)?("undefined"!=typeof e.getBoundingClientRect&&(d=e.getBoundingClientRect()),c=mc(f),{top:d.top+(c.pageYOffset||b.scrollTop)-(b.clientTop||0),left:d.left+(c.pageXOffset||b.scrollLeft)-(b.clientLeft||0)}):d},position:function(){if(this[0]){var a,b,c={top:0,left:0},d=this[0];return"fixed"===n.css(d,"position")?b=d.getBoundingClientRect():(a=this.offsetParent(),b=this.offset(),n.nodeName(a[0],"html")||(c=a.offset()),c.top+=n.css(a[0],"borderTopWidth",!0),c.left+=n.css(a[0],"borderLeftWidth",!0)),{top:b.top-c.top-n.css(d,"marginTop",!0),left:b.left-c.left-n.css(d,"marginLeft",!0)}}},offsetParent:function(){return this.map(function(){var a=this.offsetParent;while(a&&!n.nodeName(a,"html")&&"static"===n.css(a,"position"))a=a.offsetParent;return a||Qa})}}),n.each({scrollLeft:"pageXOffset",scrollTop:"pageYOffset"},function(a,b){var c=/Y/.test(b);n.fn[a]=function(d){return Y(this,function(a,d,e){var f=mc(a);return void 0===e?f?b in f?f[b]:f.document.documentElement[d]:a[d]:void(f?f.scrollTo(c?n(f).scrollLeft():e,c?e:n(f).scrollTop()):a[d]=e)},a,d,arguments.length,null)}}),n.each(["top","left"],function(a,b){n.cssHooks[b]=Ua(l.pixelPosition,function(a,c){return c?(c=Sa(a,b),Oa.test(c)?n(a).position()[b]+"px":c):void 0})}),n.each({Height:"height",Width:"width"},function(a,b){n.each({
padding:"inner"+a,content:b,"":"outer"+a},function(c,d){n.fn[d]=function(d,e){var f=arguments.length&&(c||"boolean"!=typeof d),g=c||(d===!0||e===!0?"margin":"border");return Y(this,function(b,c,d){var e;return n.isWindow(b)?b.document.documentElement["client"+a]:9===b.nodeType?(e=b.documentElement,Math.max(b.body["scroll"+a],e["scroll"+a],b.body["offset"+a],e["offset"+a],e["client"+a])):void 0===d?n.css(b,c,g):n.style(b,c,d,g)},b,f?d:void 0,f,null)}})}),n.fn.extend({bind:function(a,b,c){return this.on(a,null,b,c)},unbind:function(a,b){return this.off(a,null,b)},delegate:function(a,b,c,d){return this.on(b,a,c,d)},undelegate:function(a,b,c){return 1===arguments.length?this.off(a,"**"):this.off(b,a||"**",c)}}),n.fn.size=function(){return this.length},n.fn.andSelf=n.fn.addBack,"function"==typeof define&&define.amd&&define("jquery",[],function(){return n});var nc=a.jQuery,oc=a.$;return n.noConflict=function(b){return a.$===n&&(a.$=oc),b&&a.jQuery===n&&(a.jQuery=nc),n},b||(a.jQuery=a.$=n),n});/*!
 * Bootstrap v3.3.7 (http://getbootstrap.com)
 * Copyright 2011-2016 Twitter, Inc.
 * Licensed under the MIT license
 */
if("undefined"==typeof jQuery)throw new Error("Bootstrap's JavaScript requires jQuery");+function(a){"use strict";var b=a.fn.jquery.split(" ")[0].split(".");if(b[0]<2&&b[1]<9||1==b[0]&&9==b[1]&&b[2]<1||b[0]>3)throw new Error("Bootstrap's JavaScript requires jQuery version 1.9.1 or higher, but lower than version 4")}(jQuery),+function(a){"use strict";function b(){var a=document.createElement("bootstrap"),b={WebkitTransition:"webkitTransitionEnd",MozTransition:"transitionend",OTransition:"oTransitionEnd otransitionend",transition:"transitionend"};for(var c in b)if(void 0!==a.style[c])return{end:b[c]};return!1}a.fn.emulateTransitionEnd=function(b){var c=!1,d=this;a(this).one("bsTransitionEnd",function(){c=!0});var e=function(){c||a(d).trigger(a.support.transition.end)};return setTimeout(e,b),this},a(function(){a.support.transition=b(),a.support.transition&&(a.event.special.bsTransitionEnd={bindType:a.support.transition.end,delegateType:a.support.transition.end,handle:function(b){if(a(b.target).is(this))return b.handleObj.handler.apply(this,arguments)}})})}(jQuery),+function(a){"use strict";function b(b){return this.each(function(){var c=a(this),e=c.data("bs.alert");e||c.data("bs.alert",e=new d(this)),"string"==typeof b&&e[b].call(c)})}var c='[data-dismiss="alert"]',d=function(b){a(b).on("click",c,this.close)};d.VERSION="3.3.7",d.TRANSITION_DURATION=150,d.prototype.close=function(b){function c(){g.detach().trigger("closed.bs.alert").remove()}var e=a(this),f=e.attr("data-target");f||(f=e.attr("href"),f=f&&f.replace(/.*(?=#[^\s]*$)/,""));var g=a("#"===f?[]:f);b&&b.preventDefault(),g.length||(g=e.closest(".alert")),g.trigger(b=a.Event("close.bs.alert")),b.isDefaultPrevented()||(g.removeClass("in"),a.support.transition&&g.hasClass("fade")?g.one("bsTransitionEnd",c).emulateTransitionEnd(d.TRANSITION_DURATION):c())};var e=a.fn.alert;a.fn.alert=b,a.fn.alert.Constructor=d,a.fn.alert.noConflict=function(){return a.fn.alert=e,this},a(document).on("click.bs.alert.data-api",c,d.prototype.close)}(jQuery),+function(a){"use strict";function b(b){return this.each(function(){var d=a(this),e=d.data("bs.button"),f="object"==typeof b&&b;e||d.data("bs.button",e=new c(this,f)),"toggle"==b?e.toggle():b&&e.setState(b)})}var c=function(b,d){this.$element=a(b),this.options=a.extend({},c.DEFAULTS,d),this.isLoading=!1};c.VERSION="3.3.7",c.DEFAULTS={loadingText:"loading..."},c.prototype.setState=function(b){var c="disabled",d=this.$element,e=d.is("input")?"val":"html",f=d.data();b+="Text",null==f.resetText&&d.data("resetText",d[e]()),setTimeout(a.proxy(function(){d[e](null==f[b]?this.options[b]:f[b]),"loadingText"==b?(this.isLoading=!0,d.addClass(c).attr(c,c).prop(c,!0)):this.isLoading&&(this.isLoading=!1,d.removeClass(c).removeAttr(c).prop(c,!1))},this),0)},c.prototype.toggle=function(){var a=!0,b=this.$element.closest('[data-toggle="buttons"]');if(b.length){var c=this.$element.find("input");"radio"==c.prop("type")?(c.prop("checked")&&(a=!1),b.find(".active").removeClass("active"),this.$element.addClass("active")):"checkbox"==c.prop("type")&&(c.prop("checked")!==this.$element.hasClass("active")&&(a=!1),this.$element.toggleClass("active")),c.prop("checked",this.$element.hasClass("active")),a&&c.trigger("change")}else this.$element.attr("aria-pressed",!this.$element.hasClass("active")),this.$element.toggleClass("active")};var d=a.fn.button;a.fn.button=b,a.fn.button.Constructor=c,a.fn.button.noConflict=function(){return a.fn.button=d,this},a(document).on("click.bs.button.data-api",'[data-toggle^="button"]',function(c){var d=a(c.target).closest(".btn");b.call(d,"toggle"),a(c.target).is('input[type="radio"], input[type="checkbox"]')||(c.preventDefault(),d.is("input,button")?d.trigger("focus"):d.find("input:visible,button:visible").first().trigger("focus"))}).on("focus.bs.button.data-api blur.bs.button.data-api",'[data-toggle^="button"]',function(b){a(b.target).closest(".btn").toggleClass("focus",/^focus(in)?$/.test(b.type))})}(jQuery),+function(a){"use strict";function b(b){return this.each(function(){var d=a(this),e=d.data("bs.carousel"),f=a.extend({},c.DEFAULTS,d.data(),"object"==typeof b&&b),g="string"==typeof b?b:f.slide;e||d.data("bs.carousel",e=new c(this,f)),"number"==typeof b?e.to(b):g?e[g]():f.interval&&e.pause().cycle()})}var c=function(b,c){this.$element=a(b),this.$indicators=this.$element.find(".carousel-indicators"),this.options=c,this.paused=null,this.sliding=null,this.interval=null,this.$active=null,this.$items=null,this.options.keyboard&&this.$element.on("keydown.bs.carousel",a.proxy(this.keydown,this)),"hover"==this.options.pause&&!("ontouchstart"in document.documentElement)&&this.$element.on("mouseenter.bs.carousel",a.proxy(this.pause,this)).on("mouseleave.bs.carousel",a.proxy(this.cycle,this))};c.VERSION="3.3.7",c.TRANSITION_DURATION=600,c.DEFAULTS={interval:5e3,pause:"hover",wrap:!0,keyboard:!0},c.prototype.keydown=function(a){if(!/input|textarea/i.test(a.target.tagName)){switch(a.which){case 37:this.prev();break;case 39:this.next();break;default:return}a.preventDefault()}},c.prototype.cycle=function(b){return b||(this.paused=!1),this.interval&&clearInterval(this.interval),this.options.interval&&!this.paused&&(this.interval=setInterval(a.proxy(this.next,this),this.options.interval)),this},c.prototype.getItemIndex=function(a){return this.$items=a.parent().children(".item"),this.$items.index(a||this.$active)},c.prototype.getItemForDirection=function(a,b){var c=this.getItemIndex(b),d="prev"==a&&0===c||"next"==a&&c==this.$items.length-1;if(d&&!this.options.wrap)return b;var e="prev"==a?-1:1,f=(c+e)%this.$items.length;return this.$items.eq(f)},c.prototype.to=function(a){var b=this,c=this.getItemIndex(this.$active=this.$element.find(".item.active"));if(!(a>this.$items.length-1||a<0))return this.sliding?this.$element.one("slid.bs.carousel",function(){b.to(a)}):c==a?this.pause().cycle():this.slide(a>c?"next":"prev",this.$items.eq(a))},c.prototype.pause=function(b){return b||(this.paused=!0),this.$element.find(".next, .prev").length&&a.support.transition&&(this.$element.trigger(a.support.transition.end),this.cycle(!0)),this.interval=clearInterval(this.interval),this},c.prototype.next=function(){if(!this.sliding)return this.slide("next")},c.prototype.prev=function(){if(!this.sliding)return this.slide("prev")},c.prototype.slide=function(b,d){var e=this.$element.find(".item.active"),f=d||this.getItemForDirection(b,e),g=this.interval,h="next"==b?"left":"right",i=this;if(f.hasClass("active"))return this.sliding=!1;var j=f[0],k=a.Event("slide.bs.carousel",{relatedTarget:j,direction:h});if(this.$element.trigger(k),!k.isDefaultPrevented()){if(this.sliding=!0,g&&this.pause(),this.$indicators.length){this.$indicators.find(".active").removeClass("active");var l=a(this.$indicators.children()[this.getItemIndex(f)]);l&&l.addClass("active")}var m=a.Event("slid.bs.carousel",{relatedTarget:j,direction:h});return a.support.transition&&this.$element.hasClass("slide")?(f.addClass(b),f[0].offsetWidth,e.addClass(h),f.addClass(h),e.one("bsTransitionEnd",function(){f.removeClass([b,h].join(" ")).addClass("active"),e.removeClass(["active",h].join(" ")),i.sliding=!1,setTimeout(function(){i.$element.trigger(m)},0)}).emulateTransitionEnd(c.TRANSITION_DURATION)):(e.removeClass("active"),f.addClass("active"),this.sliding=!1,this.$element.trigger(m)),g&&this.cycle(),this}};var d=a.fn.carousel;a.fn.carousel=b,a.fn.carousel.Constructor=c,a.fn.carousel.noConflict=function(){return a.fn.carousel=d,this};var e=function(c){var d,e=a(this),f=a(e.attr("data-target")||(d=e.attr("href"))&&d.replace(/.*(?=#[^\s]+$)/,""));if(f.hasClass("carousel")){var g=a.extend({},f.data(),e.data()),h=e.attr("data-slide-to");h&&(g.interval=!1),b.call(f,g),h&&f.data("bs.carousel").to(h),c.preventDefault()}};a(document).on("click.bs.carousel.data-api","[data-slide]",e).on("click.bs.carousel.data-api","[data-slide-to]",e),a(window).on("load",function(){a('[data-ride="carousel"]').each(function(){var c=a(this);b.call(c,c.data())})})}(jQuery),+function(a){"use strict";function b(b){var c,d=b.attr("data-target")||(c=b.attr("href"))&&c.replace(/.*(?=#[^\s]+$)/,"");return a(d)}function c(b){return this.each(function(){var c=a(this),e=c.data("bs.collapse"),f=a.extend({},d.DEFAULTS,c.data(),"object"==typeof b&&b);!e&&f.toggle&&/show|hide/.test(b)&&(f.toggle=!1),e||c.data("bs.collapse",e=new d(this,f)),"string"==typeof b&&e[b]()})}var d=function(b,c){this.$element=a(b),this.options=a.extend({},d.DEFAULTS,c),this.$trigger=a('[data-toggle="collapse"][href="#'+b.id+'"],[data-toggle="collapse"][data-target="#'+b.id+'"]'),this.transitioning=null,this.options.parent?this.$parent=this.getParent():this.addAriaAndCollapsedClass(this.$element,this.$trigger),this.options.toggle&&this.toggle()};d.VERSION="3.3.7",d.TRANSITION_DURATION=350,d.DEFAULTS={toggle:!0},d.prototype.dimension=function(){var a=this.$element.hasClass("width");return a?"width":"height"},d.prototype.show=function(){if(!this.transitioning&&!this.$element.hasClass("in")){var b,e=this.$parent&&this.$parent.children(".panel").children(".in, .collapsing");if(!(e&&e.length&&(b=e.data("bs.collapse"),b&&b.transitioning))){var f=a.Event("show.bs.collapse");if(this.$element.trigger(f),!f.isDefaultPrevented()){e&&e.length&&(c.call(e,"hide"),b||e.data("bs.collapse",null));var g=this.dimension();this.$element.removeClass("collapse").addClass("collapsing")[g](0).attr("aria-expanded",!0),this.$trigger.removeClass("collapsed").attr("aria-expanded",!0),this.transitioning=1;var h=function(){this.$element.removeClass("collapsing").addClass("collapse in")[g](""),this.transitioning=0,this.$element.trigger("shown.bs.collapse")};if(!a.support.transition)return h.call(this);var i=a.camelCase(["scroll",g].join("-"));this.$element.one("bsTransitionEnd",a.proxy(h,this)).emulateTransitionEnd(d.TRANSITION_DURATION)[g](this.$element[0][i])}}}},d.prototype.hide=function(){if(!this.transitioning&&this.$element.hasClass("in")){var b=a.Event("hide.bs.collapse");if(this.$element.trigger(b),!b.isDefaultPrevented()){var c=this.dimension();this.$element[c](this.$element[c]())[0].offsetHeight,this.$element.addClass("collapsing").removeClass("collapse in").attr("aria-expanded",!1),this.$trigger.addClass("collapsed").attr("aria-expanded",!1),this.transitioning=1;var e=function(){this.transitioning=0,this.$element.removeClass("collapsing").addClass("collapse").trigger("hidden.bs.collapse")};return a.support.transition?void this.$element[c](0).one("bsTransitionEnd",a.proxy(e,this)).emulateTransitionEnd(d.TRANSITION_DURATION):e.call(this)}}},d.prototype.toggle=function(){this[this.$element.hasClass("in")?"hide":"show"]()},d.prototype.getParent=function(){return a(this.options.parent).find('[data-toggle="collapse"][data-parent="'+this.options.parent+'"]').each(a.proxy(function(c,d){var e=a(d);this.addAriaAndCollapsedClass(b(e),e)},this)).end()},d.prototype.addAriaAndCollapsedClass=function(a,b){var c=a.hasClass("in");a.attr("aria-expanded",c),b.toggleClass("collapsed",!c).attr("aria-expanded",c)};var e=a.fn.collapse;a.fn.collapse=c,a.fn.collapse.Constructor=d,a.fn.collapse.noConflict=function(){return a.fn.collapse=e,this},a(document).on("click.bs.collapse.data-api",'[data-toggle="collapse"]',function(d){var e=a(this);e.attr("data-target")||d.preventDefault();var f=b(e),g=f.data("bs.collapse"),h=g?"toggle":e.data();c.call(f,h)})}(jQuery),+function(a){"use strict";function b(b){var c=b.attr("data-target");c||(c=b.attr("href"),c=c&&/#[A-Za-z]/.test(c)&&c.replace(/.*(?=#[^\s]*$)/,""));var d=c&&a(c);return d&&d.length?d:b.parent()}function c(c){c&&3===c.which||(a(e).remove(),a(f).each(function(){var d=a(this),e=b(d),f={relatedTarget:this};e.hasClass("open")&&(c&&"click"==c.type&&/input|textarea/i.test(c.target.tagName)&&a.contains(e[0],c.target)||(e.trigger(c=a.Event("hide.bs.dropdown",f)),c.isDefaultPrevented()||(d.attr("aria-expanded","false"),e.removeClass("open").trigger(a.Event("hidden.bs.dropdown",f)))))}))}function d(b){return this.each(function(){var c=a(this),d=c.data("bs.dropdown");d||c.data("bs.dropdown",d=new g(this)),"string"==typeof b&&d[b].call(c)})}var e=".dropdown-backdrop",f='[data-toggle="dropdown"]',g=function(b){a(b).on("click.bs.dropdown",this.toggle)};g.VERSION="3.3.7",g.prototype.toggle=function(d){var e=a(this);if(!e.is(".disabled, :disabled")){var f=b(e),g=f.hasClass("open");if(c(),!g){"ontouchstart"in document.documentElement&&!f.closest(".navbar-nav").length&&a(document.createElement("div")).addClass("dropdown-backdrop").insertAfter(a(this)).on("click",c);var h={relatedTarget:this};if(f.trigger(d=a.Event("show.bs.dropdown",h)),d.isDefaultPrevented())return;e.trigger("focus").attr("aria-expanded","true"),f.toggleClass("open").trigger(a.Event("shown.bs.dropdown",h))}return!1}},g.prototype.keydown=function(c){if(/(38|40|27|32)/.test(c.which)&&!/input|textarea/i.test(c.target.tagName)){var d=a(this);if(c.preventDefault(),c.stopPropagation(),!d.is(".disabled, :disabled")){var e=b(d),g=e.hasClass("open");if(!g&&27!=c.which||g&&27==c.which)return 27==c.which&&e.find(f).trigger("focus"),d.trigger("click");var h=" li:not(.disabled):visible a",i=e.find(".dropdown-menu"+h);if(i.length){var j=i.index(c.target);38==c.which&&j>0&&j--,40==c.which&&j<i.length-1&&j++,~j||(j=0),i.eq(j).trigger("focus")}}}};var h=a.fn.dropdown;a.fn.dropdown=d,a.fn.dropdown.Constructor=g,a.fn.dropdown.noConflict=function(){return a.fn.dropdown=h,this},a(document).on("click.bs.dropdown.data-api",c).on("click.bs.dropdown.data-api",".dropdown form",function(a){a.stopPropagation()}).on("click.bs.dropdown.data-api",f,g.prototype.toggle).on("keydown.bs.dropdown.data-api",f,g.prototype.keydown).on("keydown.bs.dropdown.data-api",".dropdown-menu",g.prototype.keydown)}(jQuery),+function(a){"use strict";function b(b,d){return this.each(function(){var e=a(this),f=e.data("bs.modal"),g=a.extend({},c.DEFAULTS,e.data(),"object"==typeof b&&b);f||e.data("bs.modal",f=new c(this,g)),"string"==typeof b?f[b](d):g.show&&f.show(d)})}var c=function(b,c){this.options=c,this.$body=a(document.body),this.$element=a(b),this.$dialog=this.$element.find(".modal-dialog"),this.$backdrop=null,this.isShown=null,this.originalBodyPad=null,this.scrollbarWidth=0,this.ignoreBackdropClick=!1,this.options.remote&&this.$element.find(".modal-content").load(this.options.remote,a.proxy(function(){this.$element.trigger("loaded.bs.modal")},this))};c.VERSION="3.3.7",c.TRANSITION_DURATION=300,c.BACKDROP_TRANSITION_DURATION=150,c.DEFAULTS={backdrop:!0,keyboard:!0,show:!0},c.prototype.toggle=function(a){return this.isShown?this.hide():this.show(a)},c.prototype.show=function(b){var d=this,e=a.Event("show.bs.modal",{relatedTarget:b});this.$element.trigger(e),this.isShown||e.isDefaultPrevented()||(this.isShown=!0,this.checkScrollbar(),this.setScrollbar(),this.$body.addClass("modal-open"),this.escape(),this.resize(),this.$element.on("click.dismiss.bs.modal",'[data-dismiss="modal"]',a.proxy(this.hide,this)),this.$dialog.on("mousedown.dismiss.bs.modal",function(){d.$element.one("mouseup.dismiss.bs.modal",function(b){a(b.target).is(d.$element)&&(d.ignoreBackdropClick=!0)})}),this.backdrop(function(){var e=a.support.transition&&d.$element.hasClass("fade");d.$element.parent().length||d.$element.appendTo(d.$body),d.$element.show().scrollTop(0),d.adjustDialog(),e&&d.$element[0].offsetWidth,d.$element.addClass("in"),d.enforceFocus();var f=a.Event("shown.bs.modal",{relatedTarget:b});e?d.$dialog.one("bsTransitionEnd",function(){d.$element.trigger("focus").trigger(f)}).emulateTransitionEnd(c.TRANSITION_DURATION):d.$element.trigger("focus").trigger(f)}))},c.prototype.hide=function(b){b&&b.preventDefault(),b=a.Event("hide.bs.modal"),this.$element.trigger(b),this.isShown&&!b.isDefaultPrevented()&&(this.isShown=!1,this.escape(),this.resize(),a(document).off("focusin.bs.modal"),this.$element.removeClass("in").off("click.dismiss.bs.modal").off("mouseup.dismiss.bs.modal"),this.$dialog.off("mousedown.dismiss.bs.modal"),a.support.transition&&this.$element.hasClass("fade")?this.$element.one("bsTransitionEnd",a.proxy(this.hideModal,this)).emulateTransitionEnd(c.TRANSITION_DURATION):this.hideModal())},c.prototype.enforceFocus=function(){a(document).off("focusin.bs.modal").on("focusin.bs.modal",a.proxy(function(a){document===a.target||this.$element[0]===a.target||this.$element.has(a.target).length||this.$element.trigger("focus")},this))},c.prototype.escape=function(){this.isShown&&this.options.keyboard?this.$element.on("keydown.dismiss.bs.modal",a.proxy(function(a){27==a.which&&this.hide()},this)):this.isShown||this.$element.off("keydown.dismiss.bs.modal")},c.prototype.resize=function(){this.isShown?a(window).on("resize.bs.modal",a.proxy(this.handleUpdate,this)):a(window).off("resize.bs.modal")},c.prototype.hideModal=function(){var a=this;this.$element.hide(),this.backdrop(function(){a.$body.removeClass("modal-open"),a.resetAdjustments(),a.resetScrollbar(),a.$element.trigger("hidden.bs.modal")})},c.prototype.removeBackdrop=function(){this.$backdrop&&this.$backdrop.remove(),this.$backdrop=null},c.prototype.backdrop=function(b){var d=this,e=this.$element.hasClass("fade")?"fade":"";if(this.isShown&&this.options.backdrop){var f=a.support.transition&&e;if(this.$backdrop=a(document.createElement("div")).addClass("modal-backdrop "+e).appendTo(this.$body),this.$element.on("click.dismiss.bs.modal",a.proxy(function(a){return this.ignoreBackdropClick?void(this.ignoreBackdropClick=!1):void(a.target===a.currentTarget&&("static"==this.options.backdrop?this.$element[0].focus():this.hide()))},this)),f&&this.$backdrop[0].offsetWidth,this.$backdrop.addClass("in"),!b)return;f?this.$backdrop.one("bsTransitionEnd",b).emulateTransitionEnd(c.BACKDROP_TRANSITION_DURATION):b()}else if(!this.isShown&&this.$backdrop){this.$backdrop.removeClass("in");var g=function(){d.removeBackdrop(),b&&b()};a.support.transition&&this.$element.hasClass("fade")?this.$backdrop.one("bsTransitionEnd",g).emulateTransitionEnd(c.BACKDROP_TRANSITION_DURATION):g()}else b&&b()},c.prototype.handleUpdate=function(){this.adjustDialog()},c.prototype.adjustDialog=function(){var a=this.$element[0].scrollHeight>document.documentElement.clientHeight;this.$element.css({paddingLeft:!this.bodyIsOverflowing&&a?this.scrollbarWidth:"",paddingRight:this.bodyIsOverflowing&&!a?this.scrollbarWidth:""})},c.prototype.resetAdjustments=function(){this.$element.css({paddingLeft:"",paddingRight:""})},c.prototype.checkScrollbar=function(){var a=window.innerWidth;if(!a){var b=document.documentElement.getBoundingClientRect();a=b.right-Math.abs(b.left)}this.bodyIsOverflowing=document.body.clientWidth<a,this.scrollbarWidth=this.measureScrollbar()},c.prototype.setScrollbar=function(){var a=parseInt(this.$body.css("padding-right")||0,10);this.originalBodyPad=document.body.style.paddingRight||"",this.bodyIsOverflowing&&this.$body.css("padding-right",a+this.scrollbarWidth)},c.prototype.resetScrollbar=function(){this.$body.css("padding-right",this.originalBodyPad)},c.prototype.measureScrollbar=function(){var a=document.createElement("div");a.className="modal-scrollbar-measure",this.$body.append(a);var b=a.offsetWidth-a.clientWidth;return this.$body[0].removeChild(a),b};var d=a.fn.modal;a.fn.modal=b,a.fn.modal.Constructor=c,a.fn.modal.noConflict=function(){return a.fn.modal=d,this},a(document).on("click.bs.modal.data-api",'[data-toggle="modal"]',function(c){var d=a(this),e=d.attr("href"),f=a(d.attr("data-target")||e&&e.replace(/.*(?=#[^\s]+$)/,"")),g=f.data("bs.modal")?"toggle":a.extend({remote:!/#/.test(e)&&e},f.data(),d.data());d.is("a")&&c.preventDefault(),f.one("show.bs.modal",function(a){a.isDefaultPrevented()||f.one("hidden.bs.modal",function(){d.is(":visible")&&d.trigger("focus")})}),b.call(f,g,this)})}(jQuery),+function(a){"use strict";function b(b){return this.each(function(){var d=a(this),e=d.data("bs.tooltip"),f="object"==typeof b&&b;!e&&/destroy|hide/.test(b)||(e||d.data("bs.tooltip",e=new c(this,f)),"string"==typeof b&&e[b]())})}var c=function(a,b){this.type=null,this.options=null,this.enabled=null,this.timeout=null,this.hoverState=null,this.$element=null,this.inState=null,this.init("tooltip",a,b)};c.VERSION="3.3.7",c.TRANSITION_DURATION=150,c.DEFAULTS={animation:!0,placement:"top",selector:!1,template:'<div class="tooltip" role="tooltip"><div class="tooltip-arrow"></div><div class="tooltip-inner"></div></div>',trigger:"hover focus",title:"",delay:0,html:!1,container:!1,viewport:{selector:"body",padding:0}},c.prototype.init=function(b,c,d){if(this.enabled=!0,this.type=b,this.$element=a(c),this.options=this.getOptions(d),this.$viewport=this.options.viewport&&a(a.isFunction(this.options.viewport)?this.options.viewport.call(this,this.$element):this.options.viewport.selector||this.options.viewport),this.inState={click:!1,hover:!1,focus:!1},this.$element[0]instanceof document.constructor&&!this.options.selector)throw new Error("`selector` option must be specified when initializing "+this.type+" on the window.document object!");for(var e=this.options.trigger.split(" "),f=e.length;f--;){var g=e[f];if("click"==g)this.$element.on("click."+this.type,this.options.selector,a.proxy(this.toggle,this));else if("manual"!=g){var h="hover"==g?"mouseenter":"focusin",i="hover"==g?"mouseleave":"focusout";this.$element.on(h+"."+this.type,this.options.selector,a.proxy(this.enter,this)),this.$element.on(i+"."+this.type,this.options.selector,a.proxy(this.leave,this))}}this.options.selector?this._options=a.extend({},this.options,{trigger:"manual",selector:""}):this.fixTitle()},c.prototype.getDefaults=function(){return c.DEFAULTS},c.prototype.getOptions=function(b){return b=a.extend({},this.getDefaults(),this.$element.data(),b),b.delay&&"number"==typeof b.delay&&(b.delay={show:b.delay,hide:b.delay}),b},c.prototype.getDelegateOptions=function(){var b={},c=this.getDefaults();return this._options&&a.each(this._options,function(a,d){c[a]!=d&&(b[a]=d)}),b},c.prototype.enter=function(b){var c=b instanceof this.constructor?b:a(b.currentTarget).data("bs."+this.type);return c||(c=new this.constructor(b.currentTarget,this.getDelegateOptions()),a(b.currentTarget).data("bs."+this.type,c)),b instanceof a.Event&&(c.inState["focusin"==b.type?"focus":"hover"]=!0),c.tip().hasClass("in")||"in"==c.hoverState?void(c.hoverState="in"):(clearTimeout(c.timeout),c.hoverState="in",c.options.delay&&c.options.delay.show?void(c.timeout=setTimeout(function(){"in"==c.hoverState&&c.show()},c.options.delay.show)):c.show())},c.prototype.isInStateTrue=function(){for(var a in this.inState)if(this.inState[a])return!0;return!1},c.prototype.leave=function(b){var c=b instanceof this.constructor?b:a(b.currentTarget).data("bs."+this.type);if(c||(c=new this.constructor(b.currentTarget,this.getDelegateOptions()),a(b.currentTarget).data("bs."+this.type,c)),b instanceof a.Event&&(c.inState["focusout"==b.type?"focus":"hover"]=!1),!c.isInStateTrue())return clearTimeout(c.timeout),c.hoverState="out",c.options.delay&&c.options.delay.hide?void(c.timeout=setTimeout(function(){"out"==c.hoverState&&c.hide()},c.options.delay.hide)):c.hide()},c.prototype.show=function(){var b=a.Event("show.bs."+this.type);if(this.hasContent()&&this.enabled){this.$element.trigger(b);var d=a.contains(this.$element[0].ownerDocument.documentElement,this.$element[0]);if(b.isDefaultPrevented()||!d)return;var e=this,f=this.tip(),g=this.getUID(this.type);this.setContent(),f.attr("id",g),this.$element.attr("aria-describedby",g),this.options.animation&&f.addClass("fade");var h="function"==typeof this.options.placement?this.options.placement.call(this,f[0],this.$element[0]):this.options.placement,i=/\s?auto?\s?/i,j=i.test(h);j&&(h=h.replace(i,"")||"top"),f.detach().css({top:0,left:0,display:"block"}).addClass(h).data("bs."+this.type,this),this.options.container?f.appendTo(this.options.container):f.insertAfter(this.$element),this.$element.trigger("inserted.bs."+this.type);var k=this.getPosition(),l=f[0].offsetWidth,m=f[0].offsetHeight;if(j){var n=h,o=this.getPosition(this.$viewport);h="bottom"==h&&k.bottom+m>o.bottom?"top":"top"==h&&k.top-m<o.top?"bottom":"right"==h&&k.right+l>o.width?"left":"left"==h&&k.left-l<o.left?"right":h,f.removeClass(n).addClass(h)}var p=this.getCalculatedOffset(h,k,l,m);this.applyPlacement(p,h);var q=function(){var a=e.hoverState;e.$element.trigger("shown.bs."+e.type),e.hoverState=null,"out"==a&&e.leave(e)};a.support.transition&&this.$tip.hasClass("fade")?f.one("bsTransitionEnd",q).emulateTransitionEnd(c.TRANSITION_DURATION):q()}},c.prototype.applyPlacement=function(b,c){var d=this.tip(),e=d[0].offsetWidth,f=d[0].offsetHeight,g=parseInt(d.css("margin-top"),10),h=parseInt(d.css("margin-left"),10);isNaN(g)&&(g=0),isNaN(h)&&(h=0),b.top+=g,b.left+=h,a.offset.setOffset(d[0],a.extend({using:function(a){d.css({top:Math.round(a.top),left:Math.round(a.left)})}},b),0),d.addClass("in");var i=d[0].offsetWidth,j=d[0].offsetHeight;"top"==c&&j!=f&&(b.top=b.top+f-j);var k=this.getViewportAdjustedDelta(c,b,i,j);k.left?b.left+=k.left:b.top+=k.top;var l=/top|bottom/.test(c),m=l?2*k.left-e+i:2*k.top-f+j,n=l?"offsetWidth":"offsetHeight";d.offset(b),this.replaceArrow(m,d[0][n],l)},c.prototype.replaceArrow=function(a,b,c){this.arrow().css(c?"left":"top",50*(1-a/b)+"%").css(c?"top":"left","")},c.prototype.setContent=function(){var a=this.tip(),b=this.getTitle();a.find(".tooltip-inner")[this.options.html?"html":"text"](b),a.removeClass("fade in top bottom left right")},c.prototype.hide=function(b){function d(){"in"!=e.hoverState&&f.detach(),e.$element&&e.$element.removeAttr("aria-describedby").trigger("hidden.bs."+e.type),b&&b()}var e=this,f=a(this.$tip),g=a.Event("hide.bs."+this.type);if(this.$element.trigger(g),!g.isDefaultPrevented())return f.removeClass("in"),a.support.transition&&f.hasClass("fade")?f.one("bsTransitionEnd",d).emulateTransitionEnd(c.TRANSITION_DURATION):d(),this.hoverState=null,this},c.prototype.fixTitle=function(){var a=this.$element;(a.attr("title")||"string"!=typeof a.attr("data-original-title"))&&a.attr("data-original-title",a.attr("title")||"").attr("title","")},c.prototype.hasContent=function(){return this.getTitle()},c.prototype.getPosition=function(b){b=b||this.$element;var c=b[0],d="BODY"==c.tagName,e=c.getBoundingClientRect();null==e.width&&(e=a.extend({},e,{width:e.right-e.left,height:e.bottom-e.top}));var f=window.SVGElement&&c instanceof window.SVGElement,g=d?{top:0,left:0}:f?null:b.offset(),h={scroll:d?document.documentElement.scrollTop||document.body.scrollTop:b.scrollTop()},i=d?{width:a(window).width(),height:a(window).height()}:null;return a.extend({},e,h,i,g)},c.prototype.getCalculatedOffset=function(a,b,c,d){return"bottom"==a?{top:b.top+b.height,left:b.left+b.width/2-c/2}:"top"==a?{top:b.top-d,left:b.left+b.width/2-c/2}:"left"==a?{top:b.top+b.height/2-d/2,left:b.left-c}:{top:b.top+b.height/2-d/2,left:b.left+b.width}},c.prototype.getViewportAdjustedDelta=function(a,b,c,d){var e={top:0,left:0};if(!this.$viewport)return e;var f=this.options.viewport&&this.options.viewport.padding||0,g=this.getPosition(this.$viewport);if(/right|left/.test(a)){var h=b.top-f-g.scroll,i=b.top+f-g.scroll+d;h<g.top?e.top=g.top-h:i>g.top+g.height&&(e.top=g.top+g.height-i)}else{var j=b.left-f,k=b.left+f+c;j<g.left?e.left=g.left-j:k>g.right&&(e.left=g.left+g.width-k)}return e},c.prototype.getTitle=function(){var a,b=this.$element,c=this.options;return a=b.attr("data-original-title")||("function"==typeof c.title?c.title.call(b[0]):c.title)},c.prototype.getUID=function(a){do a+=~~(1e6*Math.random());while(document.getElementById(a));return a},c.prototype.tip=function(){if(!this.$tip&&(this.$tip=a(this.options.template),1!=this.$tip.length))throw new Error(this.type+" `template` option must consist of exactly 1 top-level element!");return this.$tip},c.prototype.arrow=function(){return this.$arrow=this.$arrow||this.tip().find(".tooltip-arrow")},c.prototype.enable=function(){this.enabled=!0},c.prototype.disable=function(){this.enabled=!1},c.prototype.toggleEnabled=function(){this.enabled=!this.enabled},c.prototype.toggle=function(b){var c=this;b&&(c=a(b.currentTarget).data("bs."+this.type),c||(c=new this.constructor(b.currentTarget,this.getDelegateOptions()),a(b.currentTarget).data("bs."+this.type,c))),b?(c.inState.click=!c.inState.click,c.isInStateTrue()?c.enter(c):c.leave(c)):c.tip().hasClass("in")?c.leave(c):c.enter(c)},c.prototype.destroy=function(){var a=this;clearTimeout(this.timeout),this.hide(function(){a.$element.off("."+a.type).removeData("bs."+a.type),a.$tip&&a.$tip.detach(),a.$tip=null,a.$arrow=null,a.$viewport=null,a.$element=null})};var d=a.fn.tooltip;a.fn.tooltip=b,a.fn.tooltip.Constructor=c,a.fn.tooltip.noConflict=function(){return a.fn.tooltip=d,this}}(jQuery),+function(a){"use strict";function b(b){return this.each(function(){var d=a(this),e=d.data("bs.popover"),f="object"==typeof b&&b;!e&&/destroy|hide/.test(b)||(e||d.data("bs.popover",e=new c(this,f)),"string"==typeof b&&e[b]())})}var c=function(a,b){this.init("popover",a,b)};if(!a.fn.tooltip)throw new Error("Popover requires tooltip.js");c.VERSION="3.3.7",c.DEFAULTS=a.extend({},a.fn.tooltip.Constructor.DEFAULTS,{placement:"right",trigger:"click",content:"",template:'<div class="popover" role="tooltip"><div class="arrow"></div><h3 class="popover-title"></h3><div class="popover-content"></div></div>'}),c.prototype=a.extend({},a.fn.tooltip.Constructor.prototype),c.prototype.constructor=c,c.prototype.getDefaults=function(){return c.DEFAULTS},c.prototype.setContent=function(){var a=this.tip(),b=this.getTitle(),c=this.getContent();a.find(".popover-title")[this.options.html?"html":"text"](b),a.find(".popover-content").children().detach().end()[this.options.html?"string"==typeof c?"html":"append":"text"](c),a.removeClass("fade top bottom left right in"),a.find(".popover-title").html()||a.find(".popover-title").hide()},c.prototype.hasContent=function(){return this.getTitle()||this.getContent()},c.prototype.getContent=function(){var a=this.$element,b=this.options;return a.attr("data-content")||("function"==typeof b.content?b.content.call(a[0]):b.content)},c.prototype.arrow=function(){return this.$arrow=this.$arrow||this.tip().find(".arrow")};var d=a.fn.popover;a.fn.popover=b,a.fn.popover.Constructor=c,a.fn.popover.noConflict=function(){return a.fn.popover=d,this}}(jQuery),+function(a){"use strict";function b(c,d){this.$body=a(document.body),this.$scrollElement=a(a(c).is(document.body)?window:c),this.options=a.extend({},b.DEFAULTS,d),this.selector=(this.options.target||"")+" .nav li > a",this.offsets=[],this.targets=[],this.activeTarget=null,this.scrollHeight=0,this.$scrollElement.on("scroll.bs.scrollspy",a.proxy(this.process,this)),this.refresh(),this.process()}function c(c){return this.each(function(){var d=a(this),e=d.data("bs.scrollspy"),f="object"==typeof c&&c;e||d.data("bs.scrollspy",e=new b(this,f)),"string"==typeof c&&e[c]()})}b.VERSION="3.3.7",b.DEFAULTS={offset:10},b.prototype.getScrollHeight=function(){return this.$scrollElement[0].scrollHeight||Math.max(this.$body[0].scrollHeight,document.documentElement.scrollHeight)},b.prototype.refresh=function(){var b=this,c="offset",d=0;this.offsets=[],this.targets=[],this.scrollHeight=this.getScrollHeight(),a.isWindow(this.$scrollElement[0])||(c="position",d=this.$scrollElement.scrollTop()),this.$body.find(this.selector).map(function(){var b=a(this),e=b.data("target")||b.attr("href"),f=/^#./.test(e)&&a(e);return f&&f.length&&f.is(":visible")&&[[f[c]().top+d,e]]||null}).sort(function(a,b){return a[0]-b[0]}).each(function(){b.offsets.push(this[0]),b.targets.push(this[1])})},b.prototype.process=function(){var a,b=this.$scrollElement.scrollTop()+this.options.offset,c=this.getScrollHeight(),d=this.options.offset+c-this.$scrollElement.height(),e=this.offsets,f=this.targets,g=this.activeTarget;if(this.scrollHeight!=c&&this.refresh(),b>=d)return g!=(a=f[f.length-1])&&this.activate(a);if(g&&b<e[0])return this.activeTarget=null,this.clear();for(a=e.length;a--;)g!=f[a]&&b>=e[a]&&(void 0===e[a+1]||b<e[a+1])&&this.activate(f[a])},b.prototype.activate=function(b){
    this.activeTarget=b,this.clear();var c=this.selector+'[data-target="'+b+'"],'+this.selector+'[href="'+b+'"]',d=a(c).parents("li").addClass("active");d.parent(".dropdown-menu").length&&(d=d.closest("li.dropdown").addClass("active")),d.trigger("activate.bs.scrollspy")},b.prototype.clear=function(){a(this.selector).parentsUntil(this.options.target,".active").removeClass("active")};var d=a.fn.scrollspy;a.fn.scrollspy=c,a.fn.scrollspy.Constructor=b,a.fn.scrollspy.noConflict=function(){return a.fn.scrollspy=d,this},a(window).on("load.bs.scrollspy.data-api",function(){a('[data-spy="scroll"]').each(function(){var b=a(this);c.call(b,b.data())})})}(jQuery),+function(a){"use strict";function b(b){return this.each(function(){var d=a(this),e=d.data("bs.tab");e||d.data("bs.tab",e=new c(this)),"string"==typeof b&&e[b]()})}var c=function(b){this.element=a(b)};c.VERSION="3.3.7",c.TRANSITION_DURATION=150,c.prototype.show=function(){var b=this.element,c=b.closest("ul:not(.dropdown-menu)"),d=b.data("target");if(d||(d=b.attr("href"),d=d&&d.replace(/.*(?=#[^\s]*$)/,"")),!b.parent("li").hasClass("active")){var e=c.find(".active:last a"),f=a.Event("hide.bs.tab",{relatedTarget:b[0]}),g=a.Event("show.bs.tab",{relatedTarget:e[0]});if(e.trigger(f),b.trigger(g),!g.isDefaultPrevented()&&!f.isDefaultPrevented()){var h=a(d);this.activate(b.closest("li"),c),this.activate(h,h.parent(),function(){e.trigger({type:"hidden.bs.tab",relatedTarget:b[0]}),b.trigger({type:"shown.bs.tab",relatedTarget:e[0]})})}}},c.prototype.activate=function(b,d,e){function f(){g.removeClass("active").find("> .dropdown-menu > .active").removeClass("active").end().find('[data-toggle="tab"]').attr("aria-expanded",!1),b.addClass("active").find('[data-toggle="tab"]').attr("aria-expanded",!0),h?(b[0].offsetWidth,b.addClass("in")):b.removeClass("fade"),b.parent(".dropdown-menu").length&&b.closest("li.dropdown").addClass("active").end().find('[data-toggle="tab"]').attr("aria-expanded",!0),e&&e()}var g=d.find("> .active"),h=e&&a.support.transition&&(g.length&&g.hasClass("fade")||!!d.find("> .fade").length);g.length&&h?g.one("bsTransitionEnd",f).emulateTransitionEnd(c.TRANSITION_DURATION):f(),g.removeClass("in")};var d=a.fn.tab;a.fn.tab=b,a.fn.tab.Constructor=c,a.fn.tab.noConflict=function(){return a.fn.tab=d,this};var e=function(c){c.preventDefault(),b.call(a(this),"show")};a(document).on("click.bs.tab.data-api",'[data-toggle="tab"]',e).on("click.bs.tab.data-api",'[data-toggle="pill"]',e)}(jQuery),+function(a){"use strict";function b(b){return this.each(function(){var d=a(this),e=d.data("bs.affix"),f="object"==typeof b&&b;e||d.data("bs.affix",e=new c(this,f)),"string"==typeof b&&e[b]()})}var c=function(b,d){this.options=a.extend({},c.DEFAULTS,d),this.$target=a(this.options.target).on("scroll.bs.affix.data-api",a.proxy(this.checkPosition,this)).on("click.bs.affix.data-api",a.proxy(this.checkPositionWithEventLoop,this)),this.$element=a(b),this.affixed=null,this.unpin=null,this.pinnedOffset=null,this.checkPosition()};c.VERSION="3.3.7",c.RESET="affix affix-top affix-bottom",c.DEFAULTS={offset:0,target:window},c.prototype.getState=function(a,b,c,d){var e=this.$target.scrollTop(),f=this.$element.offset(),g=this.$target.height();if(null!=c&&"top"==this.affixed)return e<c&&"top";if("bottom"==this.affixed)return null!=c?!(e+this.unpin<=f.top)&&"bottom":!(e+g<=a-d)&&"bottom";var h=null==this.affixed,i=h?e:f.top,j=h?g:b;return null!=c&&e<=c?"top":null!=d&&i+j>=a-d&&"bottom"},c.prototype.getPinnedOffset=function(){if(this.pinnedOffset)return this.pinnedOffset;this.$element.removeClass(c.RESET).addClass("affix");var a=this.$target.scrollTop(),b=this.$element.offset();return this.pinnedOffset=b.top-a},c.prototype.checkPositionWithEventLoop=function(){setTimeout(a.proxy(this.checkPosition,this),1)},c.prototype.checkPosition=function(){if(this.$element.is(":visible")){var b=this.$element.height(),d=this.options.offset,e=d.top,f=d.bottom,g=Math.max(a(document).height(),a(document.body).height());"object"!=typeof d&&(f=e=d),"function"==typeof e&&(e=d.top(this.$element)),"function"==typeof f&&(f=d.bottom(this.$element));var h=this.getState(g,b,e,f);if(this.affixed!=h){null!=this.unpin&&this.$element.css("top","");var i="affix"+(h?"-"+h:""),j=a.Event(i+".bs.affix");if(this.$element.trigger(j),j.isDefaultPrevented())return;this.affixed=h,this.unpin="bottom"==h?this.getPinnedOffset():null,this.$element.removeClass(c.RESET).addClass(i).trigger(i.replace("affix","affixed")+".bs.affix")}"bottom"==h&&this.$element.offset({top:g-b-f})}};var d=a.fn.affix;a.fn.affix=b,a.fn.affix.Constructor=c,a.fn.affix.noConflict=function(){return a.fn.affix=d,this},a(window).on("load",function(){a('[data-spy="affix"]').each(function(){var c=a(this),d=c.data();d.offset=d.offset||{},null!=d.offsetBottom&&(d.offset.bottom=d.offsetBottom),null!=d.offsetTop&&(d.offset.top=d.offsetTop),b.call(c,d)})})}(jQuery);/*! jQuery Migrate v1.2.1 | (c) 2005, 2013 jQuery Foundation, Inc. and other contributors | jquery.org/license */
jQuery.migrateMute===void 0&&(jQuery.migrateMute=!0),function(e,t,n){function r(n){var r=t.console;i[n]||(i[n]=!0,e.migrateWarnings.push(n),r&&r.warn&&!e.migrateMute&&(r.warn("JQMIGRATE: "+n),e.migrateTrace&&r.trace&&r.trace()))}function a(t,a,i,o){if(Object.defineProperty)try{return Object.defineProperty(t,a,{configurable:!0,enumerable:!0,get:function(){return r(o),i},set:function(e){r(o),i=e}}),n}catch(s){}e._definePropertyBroken=!0,t[a]=i}var i={};e.migrateWarnings=[],!e.migrateMute&&t.console&&t.console.log&&t.console.log("JQMIGRATE: Logging is active"),e.migrateTrace===n&&(e.migrateTrace=!0),e.migrateReset=function(){i={},e.migrateWarnings.length=0},"BackCompat"===document.compatMode&&r("jQuery is not compatible with Quirks Mode");var o=e("<input/>",{size:1}).attr("size")&&e.attrFn,s=e.attr,u=e.attrHooks.value&&e.attrHooks.value.get||function(){return null},c=e.attrHooks.value&&e.attrHooks.value.set||function(){return n},l=/^(?:input|button)$/i,d=/^[238]$/,p=/^(?:autofocus|autoplay|async|checked|controls|defer|disabled|hidden|loop|multiple|open|readonly|required|scoped|selected)$/i,f=/^(?:checked|selected)$/i;a(e,"attrFn",o||{},"jQuery.attrFn is deprecated"),e.attr=function(t,a,i,u){var c=a.toLowerCase(),g=t&&t.nodeType;return u&&(4>s.length&&r("jQuery.fn.attr( props, pass ) is deprecated"),t&&!d.test(g)&&(o?a in o:e.isFunction(e.fn[a])))?e(t)[a](i):("type"===a&&i!==n&&l.test(t.nodeName)&&t.parentNode&&r("Can't change the 'type' of an input or button in IE 6/7/8"),!e.attrHooks[c]&&p.test(c)&&(e.attrHooks[c]={get:function(t,r){var a,i=e.prop(t,r);return i===!0||"boolean"!=typeof i&&(a=t.getAttributeNode(r))&&a.nodeValue!==!1?r.toLowerCase():n},set:function(t,n,r){var a;return n===!1?e.removeAttr(t,r):(a=e.propFix[r]||r,a in t&&(t[a]=!0),t.setAttribute(r,r.toLowerCase())),r}},f.test(c)&&r("jQuery.fn.attr('"+c+"') may use property instead of attribute")),s.call(e,t,a,i))},e.attrHooks.value={get:function(e,t){var n=(e.nodeName||"").toLowerCase();return"button"===n?u.apply(this,arguments):("input"!==n&&"option"!==n&&r("jQuery.fn.attr('value') no longer gets properties"),t in e?e.value:null)},set:function(e,t){var a=(e.nodeName||"").toLowerCase();return"button"===a?c.apply(this,arguments):("input"!==a&&"option"!==a&&r("jQuery.fn.attr('value', val) no longer sets properties"),e.value=t,n)}};var g,h,v=e.fn.init,m=e.parseJSON,y=/^([^<]*)(<[\w\W]+>)([^>]*)$/;e.fn.init=function(t,n,a){var i;return t&&"string"==typeof t&&!e.isPlainObject(n)&&(i=y.exec(e.trim(t)))&&i[0]&&("<"!==t.charAt(0)&&r("$(html) HTML strings must start with '<' character"),i[3]&&r("$(html) HTML text after last tag is ignored"),"#"===i[0].charAt(0)&&(r("HTML string cannot start with a '#' character"),e.error("JQMIGRATE: Invalid selector string (XSS)")),n&&n.context&&(n=n.context),e.parseHTML)?v.call(this,e.parseHTML(i[2],n,!0),n,a):v.apply(this,arguments)},e.fn.init.prototype=e.fn,e.parseJSON=function(e){return e||null===e?m.apply(this,arguments):(r("jQuery.parseJSON requires a valid JSON string"),null)},e.uaMatch=function(e){e=e.toLowerCase();var t=/(chrome)[ \/]([\w.]+)/.exec(e)||/(webkit)[ \/]([\w.]+)/.exec(e)||/(opera)(?:.*version|)[ \/]([\w.]+)/.exec(e)||/(msie) ([\w.]+)/.exec(e)||0>e.indexOf("compatible")&&/(mozilla)(?:.*? rv:([\w.]+)|)/.exec(e)||[];return{browser:t[1]||"",version:t[2]||"0"}},e.browser||(g=e.uaMatch(navigator.userAgent),h={},g.browser&&(h[g.browser]=!0,h.version=g.version),h.chrome?h.webkit=!0:h.webkit&&(h.safari=!0),e.browser=h),a(e,"browser",e.browser,"jQuery.browser is deprecated"),e.sub=function(){function t(e,n){return new t.fn.init(e,n)}e.extend(!0,t,this),t.superclass=this,t.fn=t.prototype=this(),t.fn.constructor=t,t.sub=this.sub,t.fn.init=function(r,a){return a&&a instanceof e&&!(a instanceof t)&&(a=t(a)),e.fn.init.call(this,r,a,n)},t.fn.init.prototype=t.fn;var n=t(document);return r("jQuery.sub() is deprecated"),t},e.ajaxSetup({converters:{"text json":e.parseJSON}});var b=e.fn.data;e.fn.data=function(t){var a,i,o=this[0];return!o||"events"!==t||1!==arguments.length||(a=e.data(o,t),i=e._data(o,t),a!==n&&a!==i||i===n)?b.apply(this,arguments):(r("Use of jQuery.fn.data('events') is deprecated"),i)};var j=/\/(java|ecma)script/i,w=e.fn.andSelf||e.fn.addBack;e.fn.andSelf=function(){return r("jQuery.fn.andSelf() replaced by jQuery.fn.addBack()"),w.apply(this,arguments)},e.clean||(e.clean=function(t,a,i,o){a=a||document,a=!a.nodeType&&a[0]||a,a=a.ownerDocument||a,r("jQuery.clean() is deprecated");var s,u,c,l,d=[];if(e.merge(d,e.buildFragment(t,a).childNodes),i)for(c=function(e){return!e.type||j.test(e.type)?o?o.push(e.parentNode?e.parentNode.removeChild(e):e):i.appendChild(e):n},s=0;null!=(u=d[s]);s++)e.nodeName(u,"script")&&c(u)||(i.appendChild(u),u.getElementsByTagName!==n&&(l=e.grep(e.merge([],u.getElementsByTagName("script")),c),d.splice.apply(d,[s+1,0].concat(l)),s+=l.length));return d});var Q=e.event.add,x=e.event.remove,k=e.event.trigger,N=e.fn.toggle,T=e.fn.live,M=e.fn.die,S="ajaxStart|ajaxStop|ajaxSend|ajaxComplete|ajaxError|ajaxSuccess",C=RegExp("\\b(?:"+S+")\\b"),H=/(?:^|\s)hover(\.\S+|)\b/,A=function(t){return"string"!=typeof t||e.event.special.hover?t:(H.test(t)&&r("'hover' pseudo-event is deprecated, use 'mouseenter mouseleave'"),t&&t.replace(H,"mouseenter$1 mouseleave$1"))};e.event.props&&"attrChange"!==e.event.props[0]&&e.event.props.unshift("attrChange","attrName","relatedNode","srcElement"),e.event.dispatch&&a(e.event,"handle",e.event.dispatch,"jQuery.event.handle is undocumented and deprecated"),e.event.add=function(e,t,n,a,i){e!==document&&C.test(t)&&r("AJAX events should be attached to document: "+t),Q.call(this,e,A(t||""),n,a,i)},e.event.remove=function(e,t,n,r,a){x.call(this,e,A(t)||"",n,r,a)},e.fn.error=function(){var e=Array.prototype.slice.call(arguments,0);return r("jQuery.fn.error() is deprecated"),e.splice(0,0,"error"),arguments.length?this.bind.apply(this,e):(this.triggerHandler.apply(this,e),this)},e.fn.toggle=function(t,n){if(!e.isFunction(t)||!e.isFunction(n))return N.apply(this,arguments);r("jQuery.fn.toggle(handler, handler...) is deprecated");var a=arguments,i=t.guid||e.guid++,o=0,s=function(n){var r=(e._data(this,"lastToggle"+t.guid)||0)%o;return e._data(this,"lastToggle"+t.guid,r+1),n.preventDefault(),a[r].apply(this,arguments)||!1};for(s.guid=i;a.length>o;)a[o++].guid=i;return this.click(s)},e.fn.live=function(t,n,a){return r("jQuery.fn.live() is deprecated"),T?T.apply(this,arguments):(e(this.context).on(t,this.selector,n,a),this)},e.fn.die=function(t,n){return r("jQuery.fn.die() is deprecated"),M?M.apply(this,arguments):(e(this.context).off(t,this.selector||"**",n),this)},e.event.trigger=function(e,t,n,a){return n||C.test(e)||r("Global events are undocumented and deprecated"),k.call(this,e,t,n||document,a)},e.each(S.split("|"),function(t,n){e.event.special[n]={setup:function(){var t=this;return t!==document&&(e.event.add(document,n+"."+e.guid,function(){e.event.trigger(n,null,t,!0)}),e._data(this,n,e.guid++)),!1},teardown:function(){return this!==document&&e.event.remove(document,n+"."+e._data(this,n)),!1}}})}(jQuery,window);/*! jQuery UI - v1.12.1 - 2016-09-14
* http://jqueryui.com
* Includes: widget.js, position.js, data.js, disable-selection.js, effect.js, effects/effect-blind.js, effects/effect-bounce.js, effects/effect-clip.js, effects/effect-drop.js, effects/effect-explode.js, effects/effect-fade.js, effects/effect-fold.js, effects/effect-highlight.js, effects/effect-puff.js, effects/effect-pulsate.js, effects/effect-scale.js, effects/effect-shake.js, effects/effect-size.js, effects/effect-slide.js, effects/effect-transfer.js, focusable.js, form-reset-mixin.js, jquery-1-7.js, keycode.js, labels.js, scroll-parent.js, tabbable.js, unique-id.js, widgets/accordion.js, widgets/autocomplete.js, widgets/button.js, widgets/checkboxradio.js, widgets/controlgroup.js, widgets/datepicker.js, widgets/dialog.js, widgets/draggable.js, widgets/droppable.js, widgets/menu.js, widgets/mouse.js, widgets/progressbar.js, widgets/resizable.js, widgets/selectable.js, widgets/selectmenu.js, widgets/slider.js, widgets/sortable.js, widgets/spinner.js, widgets/tabs.js, widgets/tooltip.js
* Copyright jQuery Foundation and other contributors; Licensed MIT */

(function(t){"function"==typeof define&&define.amd?define(["jquery"],t):t(jQuery)})(function(t){function e(t){for(var e=t.css("visibility");"inherit"===e;)t=t.parent(),e=t.css("visibility");return"hidden"!==e}function i(t){for(var e,i;t.length&&t[0]!==document;){if(e=t.css("position"),("absolute"===e||"relative"===e||"fixed"===e)&&(i=parseInt(t.css("zIndex"),10),!isNaN(i)&&0!==i))return i;t=t.parent()}return 0}function s(){this._curInst=null,this._keyEvent=!1,this._disabledInputs=[],this._datepickerShowing=!1,this._inDialog=!1,this._mainDivId="ui-datepicker-div",this._inlineClass="ui-datepicker-inline",this._appendClass="ui-datepicker-append",this._triggerClass="ui-datepicker-trigger",this._dialogClass="ui-datepicker-dialog",this._disableClass="ui-datepicker-disabled",this._unselectableClass="ui-datepicker-unselectable",this._currentClass="ui-datepicker-current-day",this._dayOverClass="ui-datepicker-days-cell-over",this.regional=[],this.regional[""]={closeText:"Done",prevText:"Prev",nextText:"Next",currentText:"Today",monthNames:["January","February","March","April","May","June","July","August","September","October","November","December"],monthNamesShort:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],dayNames:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],dayNamesShort:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],dayNamesMin:["Su","Mo","Tu","We","Th","Fr","Sa"],weekHeader:"Wk",dateFormat:"mm/dd/yy",firstDay:0,isRTL:!1,showMonthAfterYear:!1,yearSuffix:""},this._defaults={showOn:"focus",showAnim:"fadeIn",showOptions:{},defaultDate:null,appendText:"",buttonText:"...",buttonImage:"",buttonImageOnly:!1,hideIfNoPrevNext:!1,navigationAsDateFormat:!1,gotoCurrent:!1,changeMonth:!1,changeYear:!1,yearRange:"c-10:c+10",showOtherMonths:!1,selectOtherMonths:!1,showWeek:!1,calculateWeek:this.iso8601Week,shortYearCutoff:"+10",minDate:null,maxDate:null,duration:"fast",beforeShowDay:null,beforeShow:null,onSelect:null,onChangeMonthYear:null,onClose:null,numberOfMonths:1,showCurrentAtPos:0,stepMonths:1,stepBigMonths:12,altField:"",altFormat:"",constrainInput:!0,showButtonPanel:!1,autoSize:!1,disabled:!1},t.extend(this._defaults,this.regional[""]),this.regional.en=t.extend(!0,{},this.regional[""]),this.regional["en-US"]=t.extend(!0,{},this.regional.en),this.dpDiv=n(t("<div id='"+this._mainDivId+"' class='ui-datepicker ui-widget ui-widget-content ui-helper-clearfix ui-corner-all'></div>"))}function n(e){var i="button, .ui-datepicker-prev, .ui-datepicker-next, .ui-datepicker-calendar td a";return e.on("mouseout",i,function(){t(this).removeClass("ui-state-hover"),-1!==this.className.indexOf("ui-datepicker-prev")&&t(this).removeClass("ui-datepicker-prev-hover"),-1!==this.className.indexOf("ui-datepicker-next")&&t(this).removeClass("ui-datepicker-next-hover")}).on("mouseover",i,o)}function o(){t.datepicker._isDisabledDatepicker(m.inline?m.dpDiv.parent()[0]:m.input[0])||(t(this).parents(".ui-datepicker-calendar").find("a").removeClass("ui-state-hover"),t(this).addClass("ui-state-hover"),-1!==this.className.indexOf("ui-datepicker-prev")&&t(this).addClass("ui-datepicker-prev-hover"),-1!==this.className.indexOf("ui-datepicker-next")&&t(this).addClass("ui-datepicker-next-hover"))}function a(e,i){t.extend(e,i);for(var s in i)null==i[s]&&(e[s]=i[s]);return e}function r(t){return function(){var e=this.element.val();t.apply(this,arguments),this._refresh(),e!==this.element.val()&&this._trigger("change")}}t.ui=t.ui||{},t.ui.version="1.12.1";var h=0,l=Array.prototype.slice;t.cleanData=function(e){return function(i){var s,n,o;for(o=0;null!=(n=i[o]);o++)try{s=t._data(n,"events"),s&&s.remove&&t(n).triggerHandler("remove")}catch(a){}e(i)}}(t.cleanData),t.widget=function(e,i,s){var n,o,a,r={},h=e.split(".")[0];e=e.split(".")[1];var l=h+"-"+e;return s||(s=i,i=t.Widget),t.isArray(s)&&(s=t.extend.apply(null,[{}].concat(s))),t.expr[":"][l.toLowerCase()]=function(e){return!!t.data(e,l)},t[h]=t[h]||{},n=t[h][e],o=t[h][e]=function(t,e){return this._createWidget?(arguments.length&&this._createWidget(t,e),void 0):new o(t,e)},t.extend(o,n,{version:s.version,_proto:t.extend({},s),_childConstructors:[]}),a=new i,a.options=t.widget.extend({},a.options),t.each(s,function(e,s){return t.isFunction(s)?(r[e]=function(){function t(){return i.prototype[e].apply(this,arguments)}function n(t){return i.prototype[e].apply(this,t)}return function(){var e,i=this._super,o=this._superApply;return this._super=t,this._superApply=n,e=s.apply(this,arguments),this._super=i,this._superApply=o,e}}(),void 0):(r[e]=s,void 0)}),o.prototype=t.widget.extend(a,{widgetEventPrefix:n?a.widgetEventPrefix||e:e},r,{constructor:o,namespace:h,widgetName:e,widgetFullName:l}),n?(t.each(n._childConstructors,function(e,i){var s=i.prototype;t.widget(s.namespace+"."+s.widgetName,o,i._proto)}),delete n._childConstructors):i._childConstructors.push(o),t.widget.bridge(e,o),o},t.widget.extend=function(e){for(var i,s,n=l.call(arguments,1),o=0,a=n.length;a>o;o++)for(i in n[o])s=n[o][i],n[o].hasOwnProperty(i)&&void 0!==s&&(e[i]=t.isPlainObject(s)?t.isPlainObject(e[i])?t.widget.extend({},e[i],s):t.widget.extend({},s):s);return e},t.widget.bridge=function(e,i){var s=i.prototype.widgetFullName||e;t.fn[e]=function(n){var o="string"==typeof n,a=l.call(arguments,1),r=this;return o?this.length||"instance"!==n?this.each(function(){var i,o=t.data(this,s);return"instance"===n?(r=o,!1):o?t.isFunction(o[n])&&"_"!==n.charAt(0)?(i=o[n].apply(o,a),i!==o&&void 0!==i?(r=i&&i.jquery?r.pushStack(i.get()):i,!1):void 0):t.error("no such method '"+n+"' for "+e+" widget instance"):t.error("cannot call methods on "+e+" prior to initialization; "+"attempted to call method '"+n+"'")}):r=void 0:(a.length&&(n=t.widget.extend.apply(null,[n].concat(a))),this.each(function(){var e=t.data(this,s);e?(e.option(n||{}),e._init&&e._init()):t.data(this,s,new i(n,this))})),r}},t.Widget=function(){},t.Widget._childConstructors=[],t.Widget.prototype={widgetName:"widget",widgetEventPrefix:"",defaultElement:"<div>",options:{classes:{},disabled:!1,create:null},_createWidget:function(e,i){i=t(i||this.defaultElement||this)[0],this.element=t(i),this.uuid=h++,this.eventNamespace="."+this.widgetName+this.uuid,this.bindings=t(),this.hoverable=t(),this.focusable=t(),this.classesElementLookup={},i!==this&&(t.data(i,this.widgetFullName,this),this._on(!0,this.element,{remove:function(t){t.target===i&&this.destroy()}}),this.document=t(i.style?i.ownerDocument:i.document||i),this.window=t(this.document[0].defaultView||this.document[0].parentWindow)),this.options=t.widget.extend({},this.options,this._getCreateOptions(),e),this._create(),this.options.disabled&&this._setOptionDisabled(this.options.disabled),this._trigger("create",null,this._getCreateEventData()),this._init()},_getCreateOptions:function(){return{}},_getCreateEventData:t.noop,_create:t.noop,_init:t.noop,destroy:function(){var e=this;this._destroy(),t.each(this.classesElementLookup,function(t,i){e._removeClass(i,t)}),this.element.off(this.eventNamespace).removeData(this.widgetFullName),this.widget().off(this.eventNamespace).removeAttr("aria-disabled"),this.bindings.off(this.eventNamespace)},_destroy:t.noop,widget:function(){return this.element},option:function(e,i){var s,n,o,a=e;if(0===arguments.length)return t.widget.extend({},this.options);if("string"==typeof e)if(a={},s=e.split("."),e=s.shift(),s.length){for(n=a[e]=t.widget.extend({},this.options[e]),o=0;s.length-1>o;o++)n[s[o]]=n[s[o]]||{},n=n[s[o]];if(e=s.pop(),1===arguments.length)return void 0===n[e]?null:n[e];n[e]=i}else{if(1===arguments.length)return void 0===this.options[e]?null:this.options[e];a[e]=i}return this._setOptions(a),this},_setOptions:function(t){var e;for(e in t)this._setOption(e,t[e]);return this},_setOption:function(t,e){return"classes"===t&&this._setOptionClasses(e),this.options[t]=e,"disabled"===t&&this._setOptionDisabled(e),this},_setOptionClasses:function(e){var i,s,n;for(i in e)n=this.classesElementLookup[i],e[i]!==this.options.classes[i]&&n&&n.length&&(s=t(n.get()),this._removeClass(n,i),s.addClass(this._classes({element:s,keys:i,classes:e,add:!0})))},_setOptionDisabled:function(t){this._toggleClass(this.widget(),this.widgetFullName+"-disabled",null,!!t),t&&(this._removeClass(this.hoverable,null,"ui-state-hover"),this._removeClass(this.focusable,null,"ui-state-focus"))},enable:function(){return this._setOptions({disabled:!1})},disable:function(){return this._setOptions({disabled:!0})},_classes:function(e){function i(i,o){var a,r;for(r=0;i.length>r;r++)a=n.classesElementLookup[i[r]]||t(),a=e.add?t(t.unique(a.get().concat(e.element.get()))):t(a.not(e.element).get()),n.classesElementLookup[i[r]]=a,s.push(i[r]),o&&e.classes[i[r]]&&s.push(e.classes[i[r]])}var s=[],n=this;return e=t.extend({element:this.element,classes:this.options.classes||{}},e),this._on(e.element,{remove:"_untrackClassesElement"}),e.keys&&i(e.keys.match(/\S+/g)||[],!0),e.extra&&i(e.extra.match(/\S+/g)||[]),s.join(" ")},_untrackClassesElement:function(e){var i=this;t.each(i.classesElementLookup,function(s,n){-1!==t.inArray(e.target,n)&&(i.classesElementLookup[s]=t(n.not(e.target).get()))})},_removeClass:function(t,e,i){return this._toggleClass(t,e,i,!1)},_addClass:function(t,e,i){return this._toggleClass(t,e,i,!0)},_toggleClass:function(t,e,i,s){s="boolean"==typeof s?s:i;var n="string"==typeof t||null===t,o={extra:n?e:i,keys:n?t:e,element:n?this.element:t,add:s};return o.element.toggleClass(this._classes(o),s),this},_on:function(e,i,s){var n,o=this;"boolean"!=typeof e&&(s=i,i=e,e=!1),s?(i=n=t(i),this.bindings=this.bindings.add(i)):(s=i,i=this.element,n=this.widget()),t.each(s,function(s,a){function r(){return e||o.options.disabled!==!0&&!t(this).hasClass("ui-state-disabled")?("string"==typeof a?o[a]:a).apply(o,arguments):void 0}"string"!=typeof a&&(r.guid=a.guid=a.guid||r.guid||t.guid++);var h=s.match(/^([\w:-]*)\s*(.*)$/),l=h[1]+o.eventNamespace,c=h[2];c?n.on(l,c,r):i.on(l,r)})},_off:function(e,i){i=(i||"").split(" ").join(this.eventNamespace+" ")+this.eventNamespace,e.off(i).off(i),this.bindings=t(this.bindings.not(e).get()),this.focusable=t(this.focusable.not(e).get()),this.hoverable=t(this.hoverable.not(e).get())},_delay:function(t,e){function i(){return("string"==typeof t?s[t]:t).apply(s,arguments)}var s=this;return setTimeout(i,e||0)},_hoverable:function(e){this.hoverable=this.hoverable.add(e),this._on(e,{mouseenter:function(e){this._addClass(t(e.currentTarget),null,"ui-state-hover")},mouseleave:function(e){this._removeClass(t(e.currentTarget),null,"ui-state-hover")}})},_focusable:function(e){this.focusable=this.focusable.add(e),this._on(e,{focusin:function(e){this._addClass(t(e.currentTarget),null,"ui-state-focus")},focusout:function(e){this._removeClass(t(e.currentTarget),null,"ui-state-focus")}})},_trigger:function(e,i,s){var n,o,a=this.options[e];if(s=s||{},i=t.Event(i),i.type=(e===this.widgetEventPrefix?e:this.widgetEventPrefix+e).toLowerCase(),i.target=this.element[0],o=i.originalEvent)for(n in o)n in i||(i[n]=o[n]);return this.element.trigger(i,s),!(t.isFunction(a)&&a.apply(this.element[0],[i].concat(s))===!1||i.isDefaultPrevented())}},t.each({show:"fadeIn",hide:"fadeOut"},function(e,i){t.Widget.prototype["_"+e]=function(s,n,o){"string"==typeof n&&(n={effect:n});var a,r=n?n===!0||"number"==typeof n?i:n.effect||i:e;n=n||{},"number"==typeof n&&(n={duration:n}),a=!t.isEmptyObject(n),n.complete=o,n.delay&&s.delay(n.delay),a&&t.effects&&t.effects.effect[r]?s[e](n):r!==e&&s[r]?s[r](n.duration,n.easing,o):s.queue(function(i){t(this)[e](),o&&o.call(s[0]),i()})}}),t.widget,function(){function e(t,e,i){return[parseFloat(t[0])*(u.test(t[0])?e/100:1),parseFloat(t[1])*(u.test(t[1])?i/100:1)]}function i(e,i){return parseInt(t.css(e,i),10)||0}function s(e){var i=e[0];return 9===i.nodeType?{width:e.width(),height:e.height(),offset:{top:0,left:0}}:t.isWindow(i)?{width:e.width(),height:e.height(),offset:{top:e.scrollTop(),left:e.scrollLeft()}}:i.preventDefault?{width:0,height:0,offset:{top:i.pageY,left:i.pageX}}:{width:e.outerWidth(),height:e.outerHeight(),offset:e.offset()}}var n,o=Math.max,a=Math.abs,r=/left|center|right/,h=/top|center|bottom/,l=/[\+\-]\d+(\.[\d]+)?%?/,c=/^\w+/,u=/%$/,d=t.fn.position;t.position={scrollbarWidth:function(){if(void 0!==n)return n;var e,i,s=t("<div style='display:block;position:absolute;width:50px;height:50px;overflow:hidden;'><div style='height:100px;width:auto;'></div></div>"),o=s.children()[0];return t("body").append(s),e=o.offsetWidth,s.css("overflow","scroll"),i=o.offsetWidth,e===i&&(i=s[0].clientWidth),s.remove(),n=e-i},getScrollInfo:function(e){var i=e.isWindow||e.isDocument?"":e.element.css("overflow-x"),s=e.isWindow||e.isDocument?"":e.element.css("overflow-y"),n="scroll"===i||"auto"===i&&e.width<e.element[0].scrollWidth,o="scroll"===s||"auto"===s&&e.height<e.element[0].scrollHeight;return{width:o?t.position.scrollbarWidth():0,height:n?t.position.scrollbarWidth():0}},getWithinInfo:function(e){var i=t(e||window),s=t.isWindow(i[0]),n=!!i[0]&&9===i[0].nodeType,o=!s&&!n;return{element:i,isWindow:s,isDocument:n,offset:o?t(e).offset():{left:0,top:0},scrollLeft:i.scrollLeft(),scrollTop:i.scrollTop(),width:i.outerWidth(),height:i.outerHeight()}}},t.fn.position=function(n){if(!n||!n.of)return d.apply(this,arguments);n=t.extend({},n);var u,p,f,g,m,_,v=t(n.of),b=t.position.getWithinInfo(n.within),y=t.position.getScrollInfo(b),w=(n.collision||"flip").split(" "),k={};return _=s(v),v[0].preventDefault&&(n.at="left top"),p=_.width,f=_.height,g=_.offset,m=t.extend({},g),t.each(["my","at"],function(){var t,e,i=(n[this]||"").split(" ");1===i.length&&(i=r.test(i[0])?i.concat(["center"]):h.test(i[0])?["center"].concat(i):["center","center"]),i[0]=r.test(i[0])?i[0]:"center",i[1]=h.test(i[1])?i[1]:"center",t=l.exec(i[0]),e=l.exec(i[1]),k[this]=[t?t[0]:0,e?e[0]:0],n[this]=[c.exec(i[0])[0],c.exec(i[1])[0]]}),1===w.length&&(w[1]=w[0]),"right"===n.at[0]?m.left+=p:"center"===n.at[0]&&(m.left+=p/2),"bottom"===n.at[1]?m.top+=f:"center"===n.at[1]&&(m.top+=f/2),u=e(k.at,p,f),m.left+=u[0],m.top+=u[1],this.each(function(){var s,r,h=t(this),l=h.outerWidth(),c=h.outerHeight(),d=i(this,"marginLeft"),_=i(this,"marginTop"),x=l+d+i(this,"marginRight")+y.width,C=c+_+i(this,"marginBottom")+y.height,D=t.extend({},m),I=e(k.my,h.outerWidth(),h.outerHeight());"right"===n.my[0]?D.left-=l:"center"===n.my[0]&&(D.left-=l/2),"bottom"===n.my[1]?D.top-=c:"center"===n.my[1]&&(D.top-=c/2),D.left+=I[0],D.top+=I[1],s={marginLeft:d,marginTop:_},t.each(["left","top"],function(e,i){t.ui.position[w[e]]&&t.ui.position[w[e]][i](D,{targetWidth:p,targetHeight:f,elemWidth:l,elemHeight:c,collisionPosition:s,collisionWidth:x,collisionHeight:C,offset:[u[0]+I[0],u[1]+I[1]],my:n.my,at:n.at,within:b,elem:h})}),n.using&&(r=function(t){var e=g.left-D.left,i=e+p-l,s=g.top-D.top,r=s+f-c,u={target:{element:v,left:g.left,top:g.top,width:p,height:f},element:{element:h,left:D.left,top:D.top,width:l,height:c},horizontal:0>i?"left":e>0?"right":"center",vertical:0>r?"top":s>0?"bottom":"middle"};l>p&&p>a(e+i)&&(u.horizontal="center"),c>f&&f>a(s+r)&&(u.vertical="middle"),u.important=o(a(e),a(i))>o(a(s),a(r))?"horizontal":"vertical",n.using.call(this,t,u)}),h.offset(t.extend(D,{using:r}))})},t.ui.position={fit:{left:function(t,e){var i,s=e.within,n=s.isWindow?s.scrollLeft:s.offset.left,a=s.width,r=t.left-e.collisionPosition.marginLeft,h=n-r,l=r+e.collisionWidth-a-n;e.collisionWidth>a?h>0&&0>=l?(i=t.left+h+e.collisionWidth-a-n,t.left+=h-i):t.left=l>0&&0>=h?n:h>l?n+a-e.collisionWidth:n:h>0?t.left+=h:l>0?t.left-=l:t.left=o(t.left-r,t.left)},top:function(t,e){var i,s=e.within,n=s.isWindow?s.scrollTop:s.offset.top,a=e.within.height,r=t.top-e.collisionPosition.marginTop,h=n-r,l=r+e.collisionHeight-a-n;e.collisionHeight>a?h>0&&0>=l?(i=t.top+h+e.collisionHeight-a-n,t.top+=h-i):t.top=l>0&&0>=h?n:h>l?n+a-e.collisionHeight:n:h>0?t.top+=h:l>0?t.top-=l:t.top=o(t.top-r,t.top)}},flip:{left:function(t,e){var i,s,n=e.within,o=n.offset.left+n.scrollLeft,r=n.width,h=n.isWindow?n.scrollLeft:n.offset.left,l=t.left-e.collisionPosition.marginLeft,c=l-h,u=l+e.collisionWidth-r-h,d="left"===e.my[0]?-e.elemWidth:"right"===e.my[0]?e.elemWidth:0,p="left"===e.at[0]?e.targetWidth:"right"===e.at[0]?-e.targetWidth:0,f=-2*e.offset[0];0>c?(i=t.left+d+p+f+e.collisionWidth-r-o,(0>i||a(c)>i)&&(t.left+=d+p+f)):u>0&&(s=t.left-e.collisionPosition.marginLeft+d+p+f-h,(s>0||u>a(s))&&(t.left+=d+p+f))},top:function(t,e){var i,s,n=e.within,o=n.offset.top+n.scrollTop,r=n.height,h=n.isWindow?n.scrollTop:n.offset.top,l=t.top-e.collisionPosition.marginTop,c=l-h,u=l+e.collisionHeight-r-h,d="top"===e.my[1],p=d?-e.elemHeight:"bottom"===e.my[1]?e.elemHeight:0,f="top"===e.at[1]?e.targetHeight:"bottom"===e.at[1]?-e.targetHeight:0,g=-2*e.offset[1];0>c?(s=t.top+p+f+g+e.collisionHeight-r-o,(0>s||a(c)>s)&&(t.top+=p+f+g)):u>0&&(i=t.top-e.collisionPosition.marginTop+p+f+g-h,(i>0||u>a(i))&&(t.top+=p+f+g))}},flipfit:{left:function(){t.ui.position.flip.left.apply(this,arguments),t.ui.position.fit.left.apply(this,arguments)},top:function(){t.ui.position.flip.top.apply(this,arguments),t.ui.position.fit.top.apply(this,arguments)}}}}(),t.ui.position,t.extend(t.expr[":"],{data:t.expr.createPseudo?t.expr.createPseudo(function(e){return function(i){return!!t.data(i,e)}}):function(e,i,s){return!!t.data(e,s[3])}}),t.fn.extend({disableSelection:function(){var t="onselectstart"in document.createElement("div")?"selectstart":"mousedown";return function(){return this.on(t+".ui-disableSelection",function(t){t.preventDefault()})}}(),enableSelection:function(){return this.off(".ui-disableSelection")}});var c="ui-effects-",u="ui-effects-style",d="ui-effects-animated",p=t;t.effects={effect:{}},function(t,e){function i(t,e,i){var s=u[e.type]||{};return null==t?i||!e.def?null:e.def:(t=s.floor?~~t:parseFloat(t),isNaN(t)?e.def:s.mod?(t+s.mod)%s.mod:0>t?0:t>s.max?s.max:t)}function s(i){var s=l(),n=s._rgba=[];return i=i.toLowerCase(),f(h,function(t,o){var a,r=o.re.exec(i),h=r&&o.parse(r),l=o.space||"rgba";return h?(a=s[l](h),s[c[l].cache]=a[c[l].cache],n=s._rgba=a._rgba,!1):e}),n.length?("0,0,0,0"===n.join()&&t.extend(n,o.transparent),s):o[i]}function n(t,e,i){return i=(i+1)%1,1>6*i?t+6*(e-t)*i:1>2*i?e:2>3*i?t+6*(e-t)*(2/3-i):t}var o,a="backgroundColor borderBottomColor borderLeftColor borderRightColor borderTopColor color columnRuleColor outlineColor textDecorationColor textEmphasisColor",r=/^([\-+])=\s*(\d+\.?\d*)/,h=[{re:/rgba?\(\s*(\d{1,3})\s*,\s*(\d{1,3})\s*,\s*(\d{1,3})\s*(?:,\s*(\d?(?:\.\d+)?)\s*)?\)/,parse:function(t){return[t[1],t[2],t[3],t[4]]}},{re:/rgba?\(\s*(\d+(?:\.\d+)?)\%\s*,\s*(\d+(?:\.\d+)?)\%\s*,\s*(\d+(?:\.\d+)?)\%\s*(?:,\s*(\d?(?:\.\d+)?)\s*)?\)/,parse:function(t){return[2.55*t[1],2.55*t[2],2.55*t[3],t[4]]}},{re:/#([a-f0-9]{2})([a-f0-9]{2})([a-f0-9]{2})/,parse:function(t){return[parseInt(t[1],16),parseInt(t[2],16),parseInt(t[3],16)]}},{re:/#([a-f0-9])([a-f0-9])([a-f0-9])/,parse:function(t){return[parseInt(t[1]+t[1],16),parseInt(t[2]+t[2],16),parseInt(t[3]+t[3],16)]}},{re:/hsla?\(\s*(\d+(?:\.\d+)?)\s*,\s*(\d+(?:\.\d+)?)\%\s*,\s*(\d+(?:\.\d+)?)\%\s*(?:,\s*(\d?(?:\.\d+)?)\s*)?\)/,space:"hsla",parse:function(t){return[t[1],t[2]/100,t[3]/100,t[4]]}}],l=t.Color=function(e,i,s,n){return new t.Color.fn.parse(e,i,s,n)},c={rgba:{props:{red:{idx:0,type:"byte"},green:{idx:1,type:"byte"},blue:{idx:2,type:"byte"}}},hsla:{props:{hue:{idx:0,type:"degrees"},saturation:{idx:1,type:"percent"},lightness:{idx:2,type:"percent"}}}},u={"byte":{floor:!0,max:255},percent:{max:1},degrees:{mod:360,floor:!0}},d=l.support={},p=t("<p>")[0],f=t.each;p.style.cssText="background-color:rgba(1,1,1,.5)",d.rgba=p.style.backgroundColor.indexOf("rgba")>-1,f(c,function(t,e){e.cache="_"+t,e.props.alpha={idx:3,type:"percent",def:1}}),l.fn=t.extend(l.prototype,{parse:function(n,a,r,h){if(n===e)return this._rgba=[null,null,null,null],this;(n.jquery||n.nodeType)&&(n=t(n).css(a),a=e);var u=this,d=t.type(n),p=this._rgba=[];return a!==e&&(n=[n,a,r,h],d="array"),"string"===d?this.parse(s(n)||o._default):"array"===d?(f(c.rgba.props,function(t,e){p[e.idx]=i(n[e.idx],e)}),this):"object"===d?(n instanceof l?f(c,function(t,e){n[e.cache]&&(u[e.cache]=n[e.cache].slice())}):f(c,function(e,s){var o=s.cache;f(s.props,function(t,e){if(!u[o]&&s.to){if("alpha"===t||null==n[t])return;u[o]=s.to(u._rgba)}u[o][e.idx]=i(n[t],e,!0)}),u[o]&&0>t.inArray(null,u[o].slice(0,3))&&(u[o][3]=1,s.from&&(u._rgba=s.from(u[o])))}),this):e},is:function(t){var i=l(t),s=!0,n=this;return f(c,function(t,o){var a,r=i[o.cache];return r&&(a=n[o.cache]||o.to&&o.to(n._rgba)||[],f(o.props,function(t,i){return null!=r[i.idx]?s=r[i.idx]===a[i.idx]:e})),s}),s},_space:function(){var t=[],e=this;return f(c,function(i,s){e[s.cache]&&t.push(i)}),t.pop()},transition:function(t,e){var s=l(t),n=s._space(),o=c[n],a=0===this.alpha()?l("transparent"):this,r=a[o.cache]||o.to(a._rgba),h=r.slice();return s=s[o.cache],f(o.props,function(t,n){var o=n.idx,a=r[o],l=s[o],c=u[n.type]||{};null!==l&&(null===a?h[o]=l:(c.mod&&(l-a>c.mod/2?a+=c.mod:a-l>c.mod/2&&(a-=c.mod)),h[o]=i((l-a)*e+a,n)))}),this[n](h)},blend:function(e){if(1===this._rgba[3])return this;var i=this._rgba.slice(),s=i.pop(),n=l(e)._rgba;return l(t.map(i,function(t,e){return(1-s)*n[e]+s*t}))},toRgbaString:function(){var e="rgba(",i=t.map(this._rgba,function(t,e){return null==t?e>2?1:0:t});return 1===i[3]&&(i.pop(),e="rgb("),e+i.join()+")"},toHslaString:function(){var e="hsla(",i=t.map(this.hsla(),function(t,e){return null==t&&(t=e>2?1:0),e&&3>e&&(t=Math.round(100*t)+"%"),t});return 1===i[3]&&(i.pop(),e="hsl("),e+i.join()+")"},toHexString:function(e){var i=this._rgba.slice(),s=i.pop();return e&&i.push(~~(255*s)),"#"+t.map(i,function(t){return t=(t||0).toString(16),1===t.length?"0"+t:t}).join("")},toString:function(){return 0===this._rgba[3]?"transparent":this.toRgbaString()}}),l.fn.parse.prototype=l.fn,c.hsla.to=function(t){if(null==t[0]||null==t[1]||null==t[2])return[null,null,null,t[3]];var e,i,s=t[0]/255,n=t[1]/255,o=t[2]/255,a=t[3],r=Math.max(s,n,o),h=Math.min(s,n,o),l=r-h,c=r+h,u=.5*c;return e=h===r?0:s===r?60*(n-o)/l+360:n===r?60*(o-s)/l+120:60*(s-n)/l+240,i=0===l?0:.5>=u?l/c:l/(2-c),[Math.round(e)%360,i,u,null==a?1:a]},c.hsla.from=function(t){if(null==t[0]||null==t[1]||null==t[2])return[null,null,null,t[3]];var e=t[0]/360,i=t[1],s=t[2],o=t[3],a=.5>=s?s*(1+i):s+i-s*i,r=2*s-a;return[Math.round(255*n(r,a,e+1/3)),Math.round(255*n(r,a,e)),Math.round(255*n(r,a,e-1/3)),o]},f(c,function(s,n){var o=n.props,a=n.cache,h=n.to,c=n.from;l.fn[s]=function(s){if(h&&!this[a]&&(this[a]=h(this._rgba)),s===e)return this[a].slice();var n,r=t.type(s),u="array"===r||"object"===r?s:arguments,d=this[a].slice();return f(o,function(t,e){var s=u["object"===r?t:e.idx];null==s&&(s=d[e.idx]),d[e.idx]=i(s,e)}),c?(n=l(c(d)),n[a]=d,n):l(d)},f(o,function(e,i){l.fn[e]||(l.fn[e]=function(n){var o,a=t.type(n),h="alpha"===e?this._hsla?"hsla":"rgba":s,l=this[h](),c=l[i.idx];return"undefined"===a?c:("function"===a&&(n=n.call(this,c),a=t.type(n)),null==n&&i.empty?this:("string"===a&&(o=r.exec(n),o&&(n=c+parseFloat(o[2])*("+"===o[1]?1:-1))),l[i.idx]=n,this[h](l)))})})}),l.hook=function(e){var i=e.split(" ");f(i,function(e,i){t.cssHooks[i]={set:function(e,n){var o,a,r="";if("transparent"!==n&&("string"!==t.type(n)||(o=s(n)))){if(n=l(o||n),!d.rgba&&1!==n._rgba[3]){for(a="backgroundColor"===i?e.parentNode:e;(""===r||"transparent"===r)&&a&&a.style;)try{r=t.css(a,"backgroundColor"),a=a.parentNode}catch(h){}n=n.blend(r&&"transparent"!==r?r:"_default")}n=n.toRgbaString()}try{e.style[i]=n}catch(h){}}},t.fx.step[i]=function(e){e.colorInit||(e.start=l(e.elem,i),e.end=l(e.end),e.colorInit=!0),t.cssHooks[i].set(e.elem,e.start.transition(e.end,e.pos))}})},l.hook(a),t.cssHooks.borderColor={expand:function(t){var e={};return f(["Top","Right","Bottom","Left"],function(i,s){e["border"+s+"Color"]=t}),e}},o=t.Color.names={aqua:"#00ffff",black:"#000000",blue:"#0000ff",fuchsia:"#ff00ff",gray:"#808080",green:"#008000",lime:"#00ff00",maroon:"#800000",navy:"#000080",olive:"#808000",purple:"#800080",red:"#ff0000",silver:"#c0c0c0",teal:"#008080",white:"#ffffff",yellow:"#ffff00",transparent:[null,null,null,0],_default:"#ffffff"}}(p),function(){function e(e){var i,s,n=e.ownerDocument.defaultView?e.ownerDocument.defaultView.getComputedStyle(e,null):e.currentStyle,o={};if(n&&n.length&&n[0]&&n[n[0]])for(s=n.length;s--;)i=n[s],"string"==typeof n[i]&&(o[t.camelCase(i)]=n[i]);else for(i in n)"string"==typeof n[i]&&(o[i]=n[i]);return o}function i(e,i){var s,o,a={};for(s in i)o=i[s],e[s]!==o&&(n[s]||(t.fx.step[s]||!isNaN(parseFloat(o)))&&(a[s]=o));return a}var s=["add","remove","toggle"],n={border:1,borderBottom:1,borderColor:1,borderLeft:1,borderRight:1,borderTop:1,borderWidth:1,margin:1,padding:1};t.each(["borderLeftStyle","borderRightStyle","borderBottomStyle","borderTopStyle"],function(e,i){t.fx.step[i]=function(t){("none"!==t.end&&!t.setAttr||1===t.pos&&!t.setAttr)&&(p.style(t.elem,i,t.end),t.setAttr=!0)}}),t.fn.addBack||(t.fn.addBack=function(t){return this.add(null==t?this.prevObject:this.prevObject.filter(t))}),t.effects.animateClass=function(n,o,a,r){var h=t.speed(o,a,r);return this.queue(function(){var o,a=t(this),r=a.attr("class")||"",l=h.children?a.find("*").addBack():a;l=l.map(function(){var i=t(this);return{el:i,start:e(this)}}),o=function(){t.each(s,function(t,e){n[e]&&a[e+"Class"](n[e])})},o(),l=l.map(function(){return this.end=e(this.el[0]),this.diff=i(this.start,this.end),this}),a.attr("class",r),l=l.map(function(){var e=this,i=t.Deferred(),s=t.extend({},h,{queue:!1,complete:function(){i.resolve(e)}});return this.el.animate(this.diff,s),i.promise()}),t.when.apply(t,l.get()).done(function(){o(),t.each(arguments,function(){var e=this.el;t.each(this.diff,function(t){e.css(t,"")})}),h.complete.call(a[0])})})},t.fn.extend({addClass:function(e){return function(i,s,n,o){return s?t.effects.animateClass.call(this,{add:i},s,n,o):e.apply(this,arguments)}}(t.fn.addClass),removeClass:function(e){return function(i,s,n,o){return arguments.length>1?t.effects.animateClass.call(this,{remove:i},s,n,o):e.apply(this,arguments)}}(t.fn.removeClass),toggleClass:function(e){return function(i,s,n,o,a){return"boolean"==typeof s||void 0===s?n?t.effects.animateClass.call(this,s?{add:i}:{remove:i},n,o,a):e.apply(this,arguments):t.effects.animateClass.call(this,{toggle:i},s,n,o)}}(t.fn.toggleClass),switchClass:function(e,i,s,n,o){return t.effects.animateClass.call(this,{add:i,remove:e},s,n,o)}})}(),function(){function e(e,i,s,n){return t.isPlainObject(e)&&(i=e,e=e.effect),e={effect:e},null==i&&(i={}),t.isFunction(i)&&(n=i,s=null,i={}),("number"==typeof i||t.fx.speeds[i])&&(n=s,s=i,i={}),t.isFunction(s)&&(n=s,s=null),i&&t.extend(e,i),s=s||i.duration,e.duration=t.fx.off?0:"number"==typeof s?s:s in t.fx.speeds?t.fx.speeds[s]:t.fx.speeds._default,e.complete=n||i.complete,e}function i(e){return!e||"number"==typeof e||t.fx.speeds[e]?!0:"string"!=typeof e||t.effects.effect[e]?t.isFunction(e)?!0:"object"!=typeof e||e.effect?!1:!0:!0}function s(t,e){var i=e.outerWidth(),s=e.outerHeight(),n=/^rect\((-?\d*\.?\d*px|-?\d+%|auto),?\s*(-?\d*\.?\d*px|-?\d+%|auto),?\s*(-?\d*\.?\d*px|-?\d+%|auto),?\s*(-?\d*\.?\d*px|-?\d+%|auto)\)$/,o=n.exec(t)||["",0,i,s,0];return{top:parseFloat(o[1])||0,right:"auto"===o[2]?i:parseFloat(o[2]),bottom:"auto"===o[3]?s:parseFloat(o[3]),left:parseFloat(o[4])||0}}t.expr&&t.expr.filters&&t.expr.filters.animated&&(t.expr.filters.animated=function(e){return function(i){return!!t(i).data(d)||e(i)}}(t.expr.filters.animated)),t.uiBackCompat!==!1&&t.extend(t.effects,{save:function(t,e){for(var i=0,s=e.length;s>i;i++)null!==e[i]&&t.data(c+e[i],t[0].style[e[i]])},restore:function(t,e){for(var i,s=0,n=e.length;n>s;s++)null!==e[s]&&(i=t.data(c+e[s]),t.css(e[s],i))},setMode:function(t,e){return"toggle"===e&&(e=t.is(":hidden")?"show":"hide"),e},createWrapper:function(e){if(e.parent().is(".ui-effects-wrapper"))return e.parent();var i={width:e.outerWidth(!0),height:e.outerHeight(!0),"float":e.css("float")},s=t("<div></div>").addClass("ui-effects-wrapper").css({fontSize:"100%",background:"transparent",border:"none",margin:0,padding:0}),n={width:e.width(),height:e.height()},o=document.activeElement;try{o.id}catch(a){o=document.body}return e.wrap(s),(e[0]===o||t.contains(e[0],o))&&t(o).trigger("focus"),s=e.parent(),"static"===e.css("position")?(s.css({position:"relative"}),e.css({position:"relative"})):(t.extend(i,{position:e.css("position"),zIndex:e.css("z-index")}),t.each(["top","left","bottom","right"],function(t,s){i[s]=e.css(s),isNaN(parseInt(i[s],10))&&(i[s]="auto")}),e.css({position:"relative",top:0,left:0,right:"auto",bottom:"auto"})),e.css(n),s.css(i).show()},removeWrapper:function(e){var i=document.activeElement;return e.parent().is(".ui-effects-wrapper")&&(e.parent().replaceWith(e),(e[0]===i||t.contains(e[0],i))&&t(i).trigger("focus")),e}}),t.extend(t.effects,{version:"1.12.1",define:function(e,i,s){return s||(s=i,i="effect"),t.effects.effect[e]=s,t.effects.effect[e].mode=i,s},scaledDimensions:function(t,e,i){if(0===e)return{height:0,width:0,outerHeight:0,outerWidth:0};var s="horizontal"!==i?(e||100)/100:1,n="vertical"!==i?(e||100)/100:1;return{height:t.height()*n,width:t.width()*s,outerHeight:t.outerHeight()*n,outerWidth:t.outerWidth()*s}},clipToBox:function(t){return{width:t.clip.right-t.clip.left,height:t.clip.bottom-t.clip.top,left:t.clip.left,top:t.clip.top}},unshift:function(t,e,i){var s=t.queue();e>1&&s.splice.apply(s,[1,0].concat(s.splice(e,i))),t.dequeue()},saveStyle:function(t){t.data(u,t[0].style.cssText)},restoreStyle:function(t){t[0].style.cssText=t.data(u)||"",t.removeData(u)},mode:function(t,e){var i=t.is(":hidden");return"toggle"===e&&(e=i?"show":"hide"),(i?"hide"===e:"show"===e)&&(e="none"),e},getBaseline:function(t,e){var i,s;switch(t[0]){case"top":i=0;break;case"middle":i=.5;break;case"bottom":i=1;break;default:i=t[0]/e.height}switch(t[1]){case"left":s=0;break;case"center":s=.5;break;case"right":s=1;break;default:s=t[1]/e.width}return{x:s,y:i}},createPlaceholder:function(e){var i,s=e.css("position"),n=e.position();return e.css({marginTop:e.css("marginTop"),marginBottom:e.css("marginBottom"),marginLeft:e.css("marginLeft"),marginRight:e.css("marginRight")}).outerWidth(e.outerWidth()).outerHeight(e.outerHeight()),/^(static|relative)/.test(s)&&(s="absolute",i=t("<"+e[0].nodeName+">").insertAfter(e).css({display:/^(inline|ruby)/.test(e.css("display"))?"inline-block":"block",visibility:"hidden",marginTop:e.css("marginTop"),marginBottom:e.css("marginBottom"),marginLeft:e.css("marginLeft"),marginRight:e.css("marginRight"),"float":e.css("float")}).outerWidth(e.outerWidth()).outerHeight(e.outerHeight()).addClass("ui-effects-placeholder"),e.data(c+"placeholder",i)),e.css({position:s,left:n.left,top:n.top}),i},removePlaceholder:function(t){var e=c+"placeholder",i=t.data(e);i&&(i.remove(),t.removeData(e))},cleanUp:function(e){t.effects.restoreStyle(e),t.effects.removePlaceholder(e)},setTransition:function(e,i,s,n){return n=n||{},t.each(i,function(t,i){var o=e.cssUnit(i);o[0]>0&&(n[i]=o[0]*s+o[1])}),n}}),t.fn.extend({effect:function(){function i(e){function i(){r.removeData(d),t.effects.cleanUp(r),"hide"===s.mode&&r.hide(),a()}function a(){t.isFunction(h)&&h.call(r[0]),t.isFunction(e)&&e()}var r=t(this);s.mode=c.shift(),t.uiBackCompat===!1||o?"none"===s.mode?(r[l](),a()):n.call(r[0],s,i):(r.is(":hidden")?"hide"===l:"show"===l)?(r[l](),a()):n.call(r[0],s,a)}var s=e.apply(this,arguments),n=t.effects.effect[s.effect],o=n.mode,a=s.queue,r=a||"fx",h=s.complete,l=s.mode,c=[],u=function(e){var i=t(this),s=t.effects.mode(i,l)||o;i.data(d,!0),c.push(s),o&&("show"===s||s===o&&"hide"===s)&&i.show(),o&&"none"===s||t.effects.saveStyle(i),t.isFunction(e)&&e()};return t.fx.off||!n?l?this[l](s.duration,h):this.each(function(){h&&h.call(this)}):a===!1?this.each(u).each(i):this.queue(r,u).queue(r,i)},show:function(t){return function(s){if(i(s))return t.apply(this,arguments);var n=e.apply(this,arguments);return n.mode="show",this.effect.call(this,n)
}}(t.fn.show),hide:function(t){return function(s){if(i(s))return t.apply(this,arguments);var n=e.apply(this,arguments);return n.mode="hide",this.effect.call(this,n)}}(t.fn.hide),toggle:function(t){return function(s){if(i(s)||"boolean"==typeof s)return t.apply(this,arguments);var n=e.apply(this,arguments);return n.mode="toggle",this.effect.call(this,n)}}(t.fn.toggle),cssUnit:function(e){var i=this.css(e),s=[];return t.each(["em","px","%","pt"],function(t,e){i.indexOf(e)>0&&(s=[parseFloat(i),e])}),s},cssClip:function(t){return t?this.css("clip","rect("+t.top+"px "+t.right+"px "+t.bottom+"px "+t.left+"px)"):s(this.css("clip"),this)},transfer:function(e,i){var s=t(this),n=t(e.to),o="fixed"===n.css("position"),a=t("body"),r=o?a.scrollTop():0,h=o?a.scrollLeft():0,l=n.offset(),c={top:l.top-r,left:l.left-h,height:n.innerHeight(),width:n.innerWidth()},u=s.offset(),d=t("<div class='ui-effects-transfer'></div>").appendTo("body").addClass(e.className).css({top:u.top-r,left:u.left-h,height:s.innerHeight(),width:s.innerWidth(),position:o?"fixed":"absolute"}).animate(c,e.duration,e.easing,function(){d.remove(),t.isFunction(i)&&i()})}}),t.fx.step.clip=function(e){e.clipInit||(e.start=t(e.elem).cssClip(),"string"==typeof e.end&&(e.end=s(e.end,e.elem)),e.clipInit=!0),t(e.elem).cssClip({top:e.pos*(e.end.top-e.start.top)+e.start.top,right:e.pos*(e.end.right-e.start.right)+e.start.right,bottom:e.pos*(e.end.bottom-e.start.bottom)+e.start.bottom,left:e.pos*(e.end.left-e.start.left)+e.start.left})}}(),function(){var e={};t.each(["Quad","Cubic","Quart","Quint","Expo"],function(t,i){e[i]=function(e){return Math.pow(e,t+2)}}),t.extend(e,{Sine:function(t){return 1-Math.cos(t*Math.PI/2)},Circ:function(t){return 1-Math.sqrt(1-t*t)},Elastic:function(t){return 0===t||1===t?t:-Math.pow(2,8*(t-1))*Math.sin((80*(t-1)-7.5)*Math.PI/15)},Back:function(t){return t*t*(3*t-2)},Bounce:function(t){for(var e,i=4;((e=Math.pow(2,--i))-1)/11>t;);return 1/Math.pow(4,3-i)-7.5625*Math.pow((3*e-2)/22-t,2)}}),t.each(e,function(e,i){t.easing["easeIn"+e]=i,t.easing["easeOut"+e]=function(t){return 1-i(1-t)},t.easing["easeInOut"+e]=function(t){return.5>t?i(2*t)/2:1-i(-2*t+2)/2}})}();var f=t.effects;t.effects.define("blind","hide",function(e,i){var s={up:["bottom","top"],vertical:["bottom","top"],down:["top","bottom"],left:["right","left"],horizontal:["right","left"],right:["left","right"]},n=t(this),o=e.direction||"up",a=n.cssClip(),r={clip:t.extend({},a)},h=t.effects.createPlaceholder(n);r.clip[s[o][0]]=r.clip[s[o][1]],"show"===e.mode&&(n.cssClip(r.clip),h&&h.css(t.effects.clipToBox(r)),r.clip=a),h&&h.animate(t.effects.clipToBox(r),e.duration,e.easing),n.animate(r,{queue:!1,duration:e.duration,easing:e.easing,complete:i})}),t.effects.define("bounce",function(e,i){var s,n,o,a=t(this),r=e.mode,h="hide"===r,l="show"===r,c=e.direction||"up",u=e.distance,d=e.times||5,p=2*d+(l||h?1:0),f=e.duration/p,g=e.easing,m="up"===c||"down"===c?"top":"left",_="up"===c||"left"===c,v=0,b=a.queue().length;for(t.effects.createPlaceholder(a),o=a.css(m),u||(u=a["top"===m?"outerHeight":"outerWidth"]()/3),l&&(n={opacity:1},n[m]=o,a.css("opacity",0).css(m,_?2*-u:2*u).animate(n,f,g)),h&&(u/=Math.pow(2,d-1)),n={},n[m]=o;d>v;v++)s={},s[m]=(_?"-=":"+=")+u,a.animate(s,f,g).animate(n,f,g),u=h?2*u:u/2;h&&(s={opacity:0},s[m]=(_?"-=":"+=")+u,a.animate(s,f,g)),a.queue(i),t.effects.unshift(a,b,p+1)}),t.effects.define("clip","hide",function(e,i){var s,n={},o=t(this),a=e.direction||"vertical",r="both"===a,h=r||"horizontal"===a,l=r||"vertical"===a;s=o.cssClip(),n.clip={top:l?(s.bottom-s.top)/2:s.top,right:h?(s.right-s.left)/2:s.right,bottom:l?(s.bottom-s.top)/2:s.bottom,left:h?(s.right-s.left)/2:s.left},t.effects.createPlaceholder(o),"show"===e.mode&&(o.cssClip(n.clip),n.clip=s),o.animate(n,{queue:!1,duration:e.duration,easing:e.easing,complete:i})}),t.effects.define("drop","hide",function(e,i){var s,n=t(this),o=e.mode,a="show"===o,r=e.direction||"left",h="up"===r||"down"===r?"top":"left",l="up"===r||"left"===r?"-=":"+=",c="+="===l?"-=":"+=",u={opacity:0};t.effects.createPlaceholder(n),s=e.distance||n["top"===h?"outerHeight":"outerWidth"](!0)/2,u[h]=l+s,a&&(n.css(u),u[h]=c+s,u.opacity=1),n.animate(u,{queue:!1,duration:e.duration,easing:e.easing,complete:i})}),t.effects.define("explode","hide",function(e,i){function s(){b.push(this),b.length===u*d&&n()}function n(){p.css({visibility:"visible"}),t(b).remove(),i()}var o,a,r,h,l,c,u=e.pieces?Math.round(Math.sqrt(e.pieces)):3,d=u,p=t(this),f=e.mode,g="show"===f,m=p.show().css("visibility","hidden").offset(),_=Math.ceil(p.outerWidth()/d),v=Math.ceil(p.outerHeight()/u),b=[];for(o=0;u>o;o++)for(h=m.top+o*v,c=o-(u-1)/2,a=0;d>a;a++)r=m.left+a*_,l=a-(d-1)/2,p.clone().appendTo("body").wrap("<div></div>").css({position:"absolute",visibility:"visible",left:-a*_,top:-o*v}).parent().addClass("ui-effects-explode").css({position:"absolute",overflow:"hidden",width:_,height:v,left:r+(g?l*_:0),top:h+(g?c*v:0),opacity:g?0:1}).animate({left:r+(g?0:l*_),top:h+(g?0:c*v),opacity:g?1:0},e.duration||500,e.easing,s)}),t.effects.define("fade","toggle",function(e,i){var s="show"===e.mode;t(this).css("opacity",s?0:1).animate({opacity:s?1:0},{queue:!1,duration:e.duration,easing:e.easing,complete:i})}),t.effects.define("fold","hide",function(e,i){var s=t(this),n=e.mode,o="show"===n,a="hide"===n,r=e.size||15,h=/([0-9]+)%/.exec(r),l=!!e.horizFirst,c=l?["right","bottom"]:["bottom","right"],u=e.duration/2,d=t.effects.createPlaceholder(s),p=s.cssClip(),f={clip:t.extend({},p)},g={clip:t.extend({},p)},m=[p[c[0]],p[c[1]]],_=s.queue().length;h&&(r=parseInt(h[1],10)/100*m[a?0:1]),f.clip[c[0]]=r,g.clip[c[0]]=r,g.clip[c[1]]=0,o&&(s.cssClip(g.clip),d&&d.css(t.effects.clipToBox(g)),g.clip=p),s.queue(function(i){d&&d.animate(t.effects.clipToBox(f),u,e.easing).animate(t.effects.clipToBox(g),u,e.easing),i()}).animate(f,u,e.easing).animate(g,u,e.easing).queue(i),t.effects.unshift(s,_,4)}),t.effects.define("highlight","show",function(e,i){var s=t(this),n={backgroundColor:s.css("backgroundColor")};"hide"===e.mode&&(n.opacity=0),t.effects.saveStyle(s),s.css({backgroundImage:"none",backgroundColor:e.color||"#ffff99"}).animate(n,{queue:!1,duration:e.duration,easing:e.easing,complete:i})}),t.effects.define("size",function(e,i){var s,n,o,a=t(this),r=["fontSize"],h=["borderTopWidth","borderBottomWidth","paddingTop","paddingBottom"],l=["borderLeftWidth","borderRightWidth","paddingLeft","paddingRight"],c=e.mode,u="effect"!==c,d=e.scale||"both",p=e.origin||["middle","center"],f=a.css("position"),g=a.position(),m=t.effects.scaledDimensions(a),_=e.from||m,v=e.to||t.effects.scaledDimensions(a,0);t.effects.createPlaceholder(a),"show"===c&&(o=_,_=v,v=o),n={from:{y:_.height/m.height,x:_.width/m.width},to:{y:v.height/m.height,x:v.width/m.width}},("box"===d||"both"===d)&&(n.from.y!==n.to.y&&(_=t.effects.setTransition(a,h,n.from.y,_),v=t.effects.setTransition(a,h,n.to.y,v)),n.from.x!==n.to.x&&(_=t.effects.setTransition(a,l,n.from.x,_),v=t.effects.setTransition(a,l,n.to.x,v))),("content"===d||"both"===d)&&n.from.y!==n.to.y&&(_=t.effects.setTransition(a,r,n.from.y,_),v=t.effects.setTransition(a,r,n.to.y,v)),p&&(s=t.effects.getBaseline(p,m),_.top=(m.outerHeight-_.outerHeight)*s.y+g.top,_.left=(m.outerWidth-_.outerWidth)*s.x+g.left,v.top=(m.outerHeight-v.outerHeight)*s.y+g.top,v.left=(m.outerWidth-v.outerWidth)*s.x+g.left),a.css(_),("content"===d||"both"===d)&&(h=h.concat(["marginTop","marginBottom"]).concat(r),l=l.concat(["marginLeft","marginRight"]),a.find("*[width]").each(function(){var i=t(this),s=t.effects.scaledDimensions(i),o={height:s.height*n.from.y,width:s.width*n.from.x,outerHeight:s.outerHeight*n.from.y,outerWidth:s.outerWidth*n.from.x},a={height:s.height*n.to.y,width:s.width*n.to.x,outerHeight:s.height*n.to.y,outerWidth:s.width*n.to.x};n.from.y!==n.to.y&&(o=t.effects.setTransition(i,h,n.from.y,o),a=t.effects.setTransition(i,h,n.to.y,a)),n.from.x!==n.to.x&&(o=t.effects.setTransition(i,l,n.from.x,o),a=t.effects.setTransition(i,l,n.to.x,a)),u&&t.effects.saveStyle(i),i.css(o),i.animate(a,e.duration,e.easing,function(){u&&t.effects.restoreStyle(i)})})),a.animate(v,{queue:!1,duration:e.duration,easing:e.easing,complete:function(){var e=a.offset();0===v.opacity&&a.css("opacity",_.opacity),u||(a.css("position","static"===f?"relative":f).offset(e),t.effects.saveStyle(a)),i()}})}),t.effects.define("scale",function(e,i){var s=t(this),n=e.mode,o=parseInt(e.percent,10)||(0===parseInt(e.percent,10)?0:"effect"!==n?0:100),a=t.extend(!0,{from:t.effects.scaledDimensions(s),to:t.effects.scaledDimensions(s,o,e.direction||"both"),origin:e.origin||["middle","center"]},e);e.fade&&(a.from.opacity=1,a.to.opacity=0),t.effects.effect.size.call(this,a,i)}),t.effects.define("puff","hide",function(e,i){var s=t.extend(!0,{},e,{fade:!0,percent:parseInt(e.percent,10)||150});t.effects.effect.scale.call(this,s,i)}),t.effects.define("pulsate","show",function(e,i){var s=t(this),n=e.mode,o="show"===n,a="hide"===n,r=o||a,h=2*(e.times||5)+(r?1:0),l=e.duration/h,c=0,u=1,d=s.queue().length;for((o||!s.is(":visible"))&&(s.css("opacity",0).show(),c=1);h>u;u++)s.animate({opacity:c},l,e.easing),c=1-c;s.animate({opacity:c},l,e.easing),s.queue(i),t.effects.unshift(s,d,h+1)}),t.effects.define("shake",function(e,i){var s=1,n=t(this),o=e.direction||"left",a=e.distance||20,r=e.times||3,h=2*r+1,l=Math.round(e.duration/h),c="up"===o||"down"===o?"top":"left",u="up"===o||"left"===o,d={},p={},f={},g=n.queue().length;for(t.effects.createPlaceholder(n),d[c]=(u?"-=":"+=")+a,p[c]=(u?"+=":"-=")+2*a,f[c]=(u?"-=":"+=")+2*a,n.animate(d,l,e.easing);r>s;s++)n.animate(p,l,e.easing).animate(f,l,e.easing);n.animate(p,l,e.easing).animate(d,l/2,e.easing).queue(i),t.effects.unshift(n,g,h+1)}),t.effects.define("slide","show",function(e,i){var s,n,o=t(this),a={up:["bottom","top"],down:["top","bottom"],left:["right","left"],right:["left","right"]},r=e.mode,h=e.direction||"left",l="up"===h||"down"===h?"top":"left",c="up"===h||"left"===h,u=e.distance||o["top"===l?"outerHeight":"outerWidth"](!0),d={};t.effects.createPlaceholder(o),s=o.cssClip(),n=o.position()[l],d[l]=(c?-1:1)*u+n,d.clip=o.cssClip(),d.clip[a[h][1]]=d.clip[a[h][0]],"show"===r&&(o.cssClip(d.clip),o.css(l,d[l]),d.clip=s,d[l]=n),o.animate(d,{queue:!1,duration:e.duration,easing:e.easing,complete:i})});var f;t.uiBackCompat!==!1&&(f=t.effects.define("transfer",function(e,i){t(this).transfer(e,i)})),t.ui.focusable=function(i,s){var n,o,a,r,h,l=i.nodeName.toLowerCase();return"area"===l?(n=i.parentNode,o=n.name,i.href&&o&&"map"===n.nodeName.toLowerCase()?(a=t("img[usemap='#"+o+"']"),a.length>0&&a.is(":visible")):!1):(/^(input|select|textarea|button|object)$/.test(l)?(r=!i.disabled,r&&(h=t(i).closest("fieldset")[0],h&&(r=!h.disabled))):r="a"===l?i.href||s:s,r&&t(i).is(":visible")&&e(t(i)))},t.extend(t.expr[":"],{focusable:function(e){return t.ui.focusable(e,null!=t.attr(e,"tabindex"))}}),t.ui.focusable,t.fn.form=function(){return"string"==typeof this[0].form?this.closest("form"):t(this[0].form)},t.ui.formResetMixin={_formResetHandler:function(){var e=t(this);setTimeout(function(){var i=e.data("ui-form-reset-instances");t.each(i,function(){this.refresh()})})},_bindFormResetHandler:function(){if(this.form=this.element.form(),this.form.length){var t=this.form.data("ui-form-reset-instances")||[];t.length||this.form.on("reset.ui-form-reset",this._formResetHandler),t.push(this),this.form.data("ui-form-reset-instances",t)}},_unbindFormResetHandler:function(){if(this.form.length){var e=this.form.data("ui-form-reset-instances");e.splice(t.inArray(this,e),1),e.length?this.form.data("ui-form-reset-instances",e):this.form.removeData("ui-form-reset-instances").off("reset.ui-form-reset")}}},"1.7"===t.fn.jquery.substring(0,3)&&(t.each(["Width","Height"],function(e,i){function s(e,i,s,o){return t.each(n,function(){i-=parseFloat(t.css(e,"padding"+this))||0,s&&(i-=parseFloat(t.css(e,"border"+this+"Width"))||0),o&&(i-=parseFloat(t.css(e,"margin"+this))||0)}),i}var n="Width"===i?["Left","Right"]:["Top","Bottom"],o=i.toLowerCase(),a={innerWidth:t.fn.innerWidth,innerHeight:t.fn.innerHeight,outerWidth:t.fn.outerWidth,outerHeight:t.fn.outerHeight};t.fn["inner"+i]=function(e){return void 0===e?a["inner"+i].call(this):this.each(function(){t(this).css(o,s(this,e)+"px")})},t.fn["outer"+i]=function(e,n){return"number"!=typeof e?a["outer"+i].call(this,e):this.each(function(){t(this).css(o,s(this,e,!0,n)+"px")})}}),t.fn.addBack=function(t){return this.add(null==t?this.prevObject:this.prevObject.filter(t))}),t.ui.keyCode={BACKSPACE:8,COMMA:188,DELETE:46,DOWN:40,END:35,ENTER:13,ESCAPE:27,HOME:36,LEFT:37,PAGE_DOWN:34,PAGE_UP:33,PERIOD:190,RIGHT:39,SPACE:32,TAB:9,UP:38},t.ui.escapeSelector=function(){var t=/([!"#$%&'()*+,.\/:;<=>?@[\]^`{|}~])/g;return function(e){return e.replace(t,"\\$1")}}(),t.fn.labels=function(){var e,i,s,n,o;return this[0].labels&&this[0].labels.length?this.pushStack(this[0].labels):(n=this.eq(0).parents("label"),s=this.attr("id"),s&&(e=this.eq(0).parents().last(),o=e.add(e.length?e.siblings():this.siblings()),i="label[for='"+t.ui.escapeSelector(s)+"']",n=n.add(o.find(i).addBack(i))),this.pushStack(n))},t.fn.scrollParent=function(e){var i=this.css("position"),s="absolute"===i,n=e?/(auto|scroll|hidden)/:/(auto|scroll)/,o=this.parents().filter(function(){var e=t(this);return s&&"static"===e.css("position")?!1:n.test(e.css("overflow")+e.css("overflow-y")+e.css("overflow-x"))}).eq(0);return"fixed"!==i&&o.length?o:t(this[0].ownerDocument||document)},t.extend(t.expr[":"],{tabbable:function(e){var i=t.attr(e,"tabindex"),s=null!=i;return(!s||i>=0)&&t.ui.focusable(e,s)}}),t.fn.extend({uniqueId:function(){var t=0;return function(){return this.each(function(){this.id||(this.id="ui-id-"+ ++t)})}}(),removeUniqueId:function(){return this.each(function(){/^ui-id-\d+$/.test(this.id)&&t(this).removeAttr("id")})}}),t.widget("ui.accordion",{version:"1.12.1",options:{active:0,animate:{},classes:{"ui-accordion-header":"ui-corner-top","ui-accordion-header-collapsed":"ui-corner-all","ui-accordion-content":"ui-corner-bottom"},collapsible:!1,event:"click",header:"> li > :first-child, > :not(li):even",heightStyle:"auto",icons:{activeHeader:"ui-icon-triangle-1-s",header:"ui-icon-triangle-1-e"},activate:null,beforeActivate:null},hideProps:{borderTopWidth:"hide",borderBottomWidth:"hide",paddingTop:"hide",paddingBottom:"hide",height:"hide"},showProps:{borderTopWidth:"show",borderBottomWidth:"show",paddingTop:"show",paddingBottom:"show",height:"show"},_create:function(){var e=this.options;this.prevShow=this.prevHide=t(),this._addClass("ui-accordion","ui-widget ui-helper-reset"),this.element.attr("role","tablist"),e.collapsible||e.active!==!1&&null!=e.active||(e.active=0),this._processPanels(),0>e.active&&(e.active+=this.headers.length),this._refresh()},_getCreateEventData:function(){return{header:this.active,panel:this.active.length?this.active.next():t()}},_createIcons:function(){var e,i,s=this.options.icons;s&&(e=t("<span>"),this._addClass(e,"ui-accordion-header-icon","ui-icon "+s.header),e.prependTo(this.headers),i=this.active.children(".ui-accordion-header-icon"),this._removeClass(i,s.header)._addClass(i,null,s.activeHeader)._addClass(this.headers,"ui-accordion-icons"))},_destroyIcons:function(){this._removeClass(this.headers,"ui-accordion-icons"),this.headers.children(".ui-accordion-header-icon").remove()},_destroy:function(){var t;this.element.removeAttr("role"),this.headers.removeAttr("role aria-expanded aria-selected aria-controls tabIndex").removeUniqueId(),this._destroyIcons(),t=this.headers.next().css("display","").removeAttr("role aria-hidden aria-labelledby").removeUniqueId(),"content"!==this.options.heightStyle&&t.css("height","")},_setOption:function(t,e){return"active"===t?(this._activate(e),void 0):("event"===t&&(this.options.event&&this._off(this.headers,this.options.event),this._setupEvents(e)),this._super(t,e),"collapsible"!==t||e||this.options.active!==!1||this._activate(0),"icons"===t&&(this._destroyIcons(),e&&this._createIcons()),void 0)},_setOptionDisabled:function(t){this._super(t),this.element.attr("aria-disabled",t),this._toggleClass(null,"ui-state-disabled",!!t),this._toggleClass(this.headers.add(this.headers.next()),null,"ui-state-disabled",!!t)},_keydown:function(e){if(!e.altKey&&!e.ctrlKey){var i=t.ui.keyCode,s=this.headers.length,n=this.headers.index(e.target),o=!1;switch(e.keyCode){case i.RIGHT:case i.DOWN:o=this.headers[(n+1)%s];break;case i.LEFT:case i.UP:o=this.headers[(n-1+s)%s];break;case i.SPACE:case i.ENTER:this._eventHandler(e);break;case i.HOME:o=this.headers[0];break;case i.END:o=this.headers[s-1]}o&&(t(e.target).attr("tabIndex",-1),t(o).attr("tabIndex",0),t(o).trigger("focus"),e.preventDefault())}},_panelKeyDown:function(e){e.keyCode===t.ui.keyCode.UP&&e.ctrlKey&&t(e.currentTarget).prev().trigger("focus")},refresh:function(){var e=this.options;this._processPanels(),e.active===!1&&e.collapsible===!0||!this.headers.length?(e.active=!1,this.active=t()):e.active===!1?this._activate(0):this.active.length&&!t.contains(this.element[0],this.active[0])?this.headers.length===this.headers.find(".ui-state-disabled").length?(e.active=!1,this.active=t()):this._activate(Math.max(0,e.active-1)):e.active=this.headers.index(this.active),this._destroyIcons(),this._refresh()},_processPanels:function(){var t=this.headers,e=this.panels;this.headers=this.element.find(this.options.header),this._addClass(this.headers,"ui-accordion-header ui-accordion-header-collapsed","ui-state-default"),this.panels=this.headers.next().filter(":not(.ui-accordion-content-active)").hide(),this._addClass(this.panels,"ui-accordion-content","ui-helper-reset ui-widget-content"),e&&(this._off(t.not(this.headers)),this._off(e.not(this.panels)))},_refresh:function(){var e,i=this.options,s=i.heightStyle,n=this.element.parent();this.active=this._findActive(i.active),this._addClass(this.active,"ui-accordion-header-active","ui-state-active")._removeClass(this.active,"ui-accordion-header-collapsed"),this._addClass(this.active.next(),"ui-accordion-content-active"),this.active.next().show(),this.headers.attr("role","tab").each(function(){var e=t(this),i=e.uniqueId().attr("id"),s=e.next(),n=s.uniqueId().attr("id");e.attr("aria-controls",n),s.attr("aria-labelledby",i)}).next().attr("role","tabpanel"),this.headers.not(this.active).attr({"aria-selected":"false","aria-expanded":"false",tabIndex:-1}).next().attr({"aria-hidden":"true"}).hide(),this.active.length?this.active.attr({"aria-selected":"true","aria-expanded":"true",tabIndex:0}).next().attr({"aria-hidden":"false"}):this.headers.eq(0).attr("tabIndex",0),this._createIcons(),this._setupEvents(i.event),"fill"===s?(e=n.height(),this.element.siblings(":visible").each(function(){var i=t(this),s=i.css("position");"absolute"!==s&&"fixed"!==s&&(e-=i.outerHeight(!0))}),this.headers.each(function(){e-=t(this).outerHeight(!0)}),this.headers.next().each(function(){t(this).height(Math.max(0,e-t(this).innerHeight()+t(this).height()))}).css("overflow","auto")):"auto"===s&&(e=0,this.headers.next().each(function(){var i=t(this).is(":visible");i||t(this).show(),e=Math.max(e,t(this).css("height","").height()),i||t(this).hide()}).height(e))},_activate:function(e){var i=this._findActive(e)[0];i!==this.active[0]&&(i=i||this.active[0],this._eventHandler({target:i,currentTarget:i,preventDefault:t.noop}))},_findActive:function(e){return"number"==typeof e?this.headers.eq(e):t()},_setupEvents:function(e){var i={keydown:"_keydown"};e&&t.each(e.split(" "),function(t,e){i[e]="_eventHandler"}),this._off(this.headers.add(this.headers.next())),this._on(this.headers,i),this._on(this.headers.next(),{keydown:"_panelKeyDown"}),this._hoverable(this.headers),this._focusable(this.headers)},_eventHandler:function(e){var i,s,n=this.options,o=this.active,a=t(e.currentTarget),r=a[0]===o[0],h=r&&n.collapsible,l=h?t():a.next(),c=o.next(),u={oldHeader:o,oldPanel:c,newHeader:h?t():a,newPanel:l};e.preventDefault(),r&&!n.collapsible||this._trigger("beforeActivate",e,u)===!1||(n.active=h?!1:this.headers.index(a),this.active=r?t():a,this._toggle(u),this._removeClass(o,"ui-accordion-header-active","ui-state-active"),n.icons&&(i=o.children(".ui-accordion-header-icon"),this._removeClass(i,null,n.icons.activeHeader)._addClass(i,null,n.icons.header)),r||(this._removeClass(a,"ui-accordion-header-collapsed")._addClass(a,"ui-accordion-header-active","ui-state-active"),n.icons&&(s=a.children(".ui-accordion-header-icon"),this._removeClass(s,null,n.icons.header)._addClass(s,null,n.icons.activeHeader)),this._addClass(a.next(),"ui-accordion-content-active")))},_toggle:function(e){var i=e.newPanel,s=this.prevShow.length?this.prevShow:e.oldPanel;this.prevShow.add(this.prevHide).stop(!0,!0),this.prevShow=i,this.prevHide=s,this.options.animate?this._animate(i,s,e):(s.hide(),i.show(),this._toggleComplete(e)),s.attr({"aria-hidden":"true"}),s.prev().attr({"aria-selected":"false","aria-expanded":"false"}),i.length&&s.length?s.prev().attr({tabIndex:-1,"aria-expanded":"false"}):i.length&&this.headers.filter(function(){return 0===parseInt(t(this).attr("tabIndex"),10)}).attr("tabIndex",-1),i.attr("aria-hidden","false").prev().attr({"aria-selected":"true","aria-expanded":"true",tabIndex:0})},_animate:function(t,e,i){var s,n,o,a=this,r=0,h=t.css("box-sizing"),l=t.length&&(!e.length||t.index()<e.index()),c=this.options.animate||{},u=l&&c.down||c,d=function(){a._toggleComplete(i)};return"number"==typeof u&&(o=u),"string"==typeof u&&(n=u),n=n||u.easing||c.easing,o=o||u.duration||c.duration,e.length?t.length?(s=t.show().outerHeight(),e.animate(this.hideProps,{duration:o,easing:n,step:function(t,e){e.now=Math.round(t)}}),t.hide().animate(this.showProps,{duration:o,easing:n,complete:d,step:function(t,i){i.now=Math.round(t),"height"!==i.prop?"content-box"===h&&(r+=i.now):"content"!==a.options.heightStyle&&(i.now=Math.round(s-e.outerHeight()-r),r=0)}}),void 0):e.animate(this.hideProps,o,n,d):t.animate(this.showProps,o,n,d)},_toggleComplete:function(t){var e=t.oldPanel,i=e.prev();this._removeClass(e,"ui-accordion-content-active"),this._removeClass(i,"ui-accordion-header-active")._addClass(i,"ui-accordion-header-collapsed"),e.length&&(e.parent()[0].className=e.parent()[0].className),this._trigger("activate",null,t)}}),t.ui.safeActiveElement=function(t){var e;try{e=t.activeElement}catch(i){e=t.body}return e||(e=t.body),e.nodeName||(e=t.body),e},t.widget("ui.menu",{version:"1.12.1",defaultElement:"<ul>",delay:300,options:{icons:{submenu:"ui-icon-caret-1-e"},items:"> *",menus:"ul",position:{my:"left top",at:"right top"},role:"menu",blur:null,focus:null,select:null},_create:function(){this.activeMenu=this.element,this.mouseHandled=!1,this.element.uniqueId().attr({role:this.options.role,tabIndex:0}),this._addClass("ui-menu","ui-widget ui-widget-content"),this._on({"mousedown .ui-menu-item":function(t){t.preventDefault()},"click .ui-menu-item":function(e){var i=t(e.target),s=t(t.ui.safeActiveElement(this.document[0]));!this.mouseHandled&&i.not(".ui-state-disabled").length&&(this.select(e),e.isPropagationStopped()||(this.mouseHandled=!0),i.has(".ui-menu").length?this.expand(e):!this.element.is(":focus")&&s.closest(".ui-menu").length&&(this.element.trigger("focus",[!0]),this.active&&1===this.active.parents(".ui-menu").length&&clearTimeout(this.timer)))},"mouseenter .ui-menu-item":function(e){if(!this.previousFilter){var i=t(e.target).closest(".ui-menu-item"),s=t(e.currentTarget);i[0]===s[0]&&(this._removeClass(s.siblings().children(".ui-state-active"),null,"ui-state-active"),this.focus(e,s))}},mouseleave:"collapseAll","mouseleave .ui-menu":"collapseAll",focus:function(t,e){var i=this.active||this.element.find(this.options.items).eq(0);e||this.focus(t,i)},blur:function(e){this._delay(function(){var i=!t.contains(this.element[0],t.ui.safeActiveElement(this.document[0]));i&&this.collapseAll(e)})},keydown:"_keydown"}),this.refresh(),this._on(this.document,{click:function(t){this._closeOnDocumentClick(t)&&this.collapseAll(t),this.mouseHandled=!1}})},_destroy:function(){var e=this.element.find(".ui-menu-item").removeAttr("role aria-disabled"),i=e.children(".ui-menu-item-wrapper").removeUniqueId().removeAttr("tabIndex role aria-haspopup");this.element.removeAttr("aria-activedescendant").find(".ui-menu").addBack().removeAttr("role aria-labelledby aria-expanded aria-hidden aria-disabled tabIndex").removeUniqueId().show(),i.children().each(function(){var e=t(this);e.data("ui-menu-submenu-caret")&&e.remove()})},_keydown:function(e){var i,s,n,o,a=!0;switch(e.keyCode){case t.ui.keyCode.PAGE_UP:this.previousPage(e);break;case t.ui.keyCode.PAGE_DOWN:this.nextPage(e);break;case t.ui.keyCode.HOME:this._move("first","first",e);break;case t.ui.keyCode.END:this._move("last","last",e);break;case t.ui.keyCode.UP:this.previous(e);break;case t.ui.keyCode.DOWN:this.next(e);break;case t.ui.keyCode.LEFT:this.collapse(e);break;case t.ui.keyCode.RIGHT:this.active&&!this.active.is(".ui-state-disabled")&&this.expand(e);break;case t.ui.keyCode.ENTER:case t.ui.keyCode.SPACE:this._activate(e);break;case t.ui.keyCode.ESCAPE:this.collapse(e);break;default:a=!1,s=this.previousFilter||"",o=!1,n=e.keyCode>=96&&105>=e.keyCode?""+(e.keyCode-96):String.fromCharCode(e.keyCode),clearTimeout(this.filterTimer),n===s?o=!0:n=s+n,i=this._filterMenuItems(n),i=o&&-1!==i.index(this.active.next())?this.active.nextAll(".ui-menu-item"):i,i.length||(n=String.fromCharCode(e.keyCode),i=this._filterMenuItems(n)),i.length?(this.focus(e,i),this.previousFilter=n,this.filterTimer=this._delay(function(){delete this.previousFilter},1e3)):delete this.previousFilter}a&&e.preventDefault()},_activate:function(t){this.active&&!this.active.is(".ui-state-disabled")&&(this.active.children("[aria-haspopup='true']").length?this.expand(t):this.select(t))},refresh:function(){var e,i,s,n,o,a=this,r=this.options.icons.submenu,h=this.element.find(this.options.menus);this._toggleClass("ui-menu-icons",null,!!this.element.find(".ui-icon").length),s=h.filter(":not(.ui-menu)").hide().attr({role:this.options.role,"aria-hidden":"true","aria-expanded":"false"}).each(function(){var e=t(this),i=e.prev(),s=t("<span>").data("ui-menu-submenu-caret",!0);a._addClass(s,"ui-menu-icon","ui-icon "+r),i.attr("aria-haspopup","true").prepend(s),e.attr("aria-labelledby",i.attr("id"))}),this._addClass(s,"ui-menu","ui-widget ui-widget-content ui-front"),e=h.add(this.element),i=e.find(this.options.items),i.not(".ui-menu-item").each(function(){var e=t(this);a._isDivider(e)&&a._addClass(e,"ui-menu-divider","ui-widget-content")}),n=i.not(".ui-menu-item, .ui-menu-divider"),o=n.children().not(".ui-menu").uniqueId().attr({tabIndex:-1,role:this._itemRole()}),this._addClass(n,"ui-menu-item")._addClass(o,"ui-menu-item-wrapper"),i.filter(".ui-state-disabled").attr("aria-disabled","true"),this.active&&!t.contains(this.element[0],this.active[0])&&this.blur()},_itemRole:function(){return{menu:"menuitem",listbox:"option"}[this.options.role]},_setOption:function(t,e){if("icons"===t){var i=this.element.find(".ui-menu-icon");this._removeClass(i,null,this.options.icons.submenu)._addClass(i,null,e.submenu)}this._super(t,e)},_setOptionDisabled:function(t){this._super(t),this.element.attr("aria-disabled",t+""),this._toggleClass(null,"ui-state-disabled",!!t)},focus:function(t,e){var i,s,n;this.blur(t,t&&"focus"===t.type),this._scrollIntoView(e),this.active=e.first(),s=this.active.children(".ui-menu-item-wrapper"),this._addClass(s,null,"ui-state-active"),this.options.role&&this.element.attr("aria-activedescendant",s.attr("id")),n=this.active.parent().closest(".ui-menu-item").children(".ui-menu-item-wrapper"),this._addClass(n,null,"ui-state-active"),t&&"keydown"===t.type?this._close():this.timer=this._delay(function(){this._close()},this.delay),i=e.children(".ui-menu"),i.length&&t&&/^mouse/.test(t.type)&&this._startOpening(i),this.activeMenu=e.parent(),this._trigger("focus",t,{item:e})},_scrollIntoView:function(e){var i,s,n,o,a,r;this._hasScroll()&&(i=parseFloat(t.css(this.activeMenu[0],"borderTopWidth"))||0,s=parseFloat(t.css(this.activeMenu[0],"paddingTop"))||0,n=e.offset().top-this.activeMenu.offset().top-i-s,o=this.activeMenu.scrollTop(),a=this.activeMenu.height(),r=e.outerHeight(),0>n?this.activeMenu.scrollTop(o+n):n+r>a&&this.activeMenu.scrollTop(o+n-a+r))},blur:function(t,e){e||clearTimeout(this.timer),this.active&&(this._removeClass(this.active.children(".ui-menu-item-wrapper"),null,"ui-state-active"),this._trigger("blur",t,{item:this.active}),this.active=null)},_startOpening:function(t){clearTimeout(this.timer),"true"===t.attr("aria-hidden")&&(this.timer=this._delay(function(){this._close(),this._open(t)},this.delay))},_open:function(e){var i=t.extend({of:this.active},this.options.position);clearTimeout(this.timer),this.element.find(".ui-menu").not(e.parents(".ui-menu")).hide().attr("aria-hidden","true"),e.show().removeAttr("aria-hidden").attr("aria-expanded","true").position(i)},collapseAll:function(e,i){clearTimeout(this.timer),this.timer=this._delay(function(){var s=i?this.element:t(e&&e.target).closest(this.element.find(".ui-menu"));s.length||(s=this.element),this._close(s),this.blur(e),this._removeClass(s.find(".ui-state-active"),null,"ui-state-active"),this.activeMenu=s},this.delay)},_close:function(t){t||(t=this.active?this.active.parent():this.element),t.find(".ui-menu").hide().attr("aria-hidden","true").attr("aria-expanded","false")},_closeOnDocumentClick:function(e){return!t(e.target).closest(".ui-menu").length},_isDivider:function(t){return!/[^\-\u2014\u2013\s]/.test(t.text())},collapse:function(t){var e=this.active&&this.active.parent().closest(".ui-menu-item",this.element);e&&e.length&&(this._close(),this.focus(t,e))},expand:function(t){var e=this.active&&this.active.children(".ui-menu ").find(this.options.items).first();e&&e.length&&(this._open(e.parent()),this._delay(function(){this.focus(t,e)}))},next:function(t){this._move("next","first",t)},previous:function(t){this._move("prev","last",t)},isFirstItem:function(){return this.active&&!this.active.prevAll(".ui-menu-item").length},isLastItem:function(){return this.active&&!this.active.nextAll(".ui-menu-item").length},_move:function(t,e,i){var s;this.active&&(s="first"===t||"last"===t?this.active["first"===t?"prevAll":"nextAll"](".ui-menu-item").eq(-1):this.active[t+"All"](".ui-menu-item").eq(0)),s&&s.length&&this.active||(s=this.activeMenu.find(this.options.items)[e]()),this.focus(i,s)},nextPage:function(e){var i,s,n;return this.active?(this.isLastItem()||(this._hasScroll()?(s=this.active.offset().top,n=this.element.height(),this.active.nextAll(".ui-menu-item").each(function(){return i=t(this),0>i.offset().top-s-n}),this.focus(e,i)):this.focus(e,this.activeMenu.find(this.options.items)[this.active?"last":"first"]())),void 0):(this.next(e),void 0)},previousPage:function(e){var i,s,n;return this.active?(this.isFirstItem()||(this._hasScroll()?(s=this.active.offset().top,n=this.element.height(),this.active.prevAll(".ui-menu-item").each(function(){return i=t(this),i.offset().top-s+n>0}),this.focus(e,i)):this.focus(e,this.activeMenu.find(this.options.items).first())),void 0):(this.next(e),void 0)},_hasScroll:function(){return this.element.outerHeight()<this.element.prop("scrollHeight")},select:function(e){this.active=this.active||t(e.target).closest(".ui-menu-item");var i={item:this.active};this.active.has(".ui-menu").length||this.collapseAll(e,!0),this._trigger("select",e,i)},_filterMenuItems:function(e){var i=e.replace(/[\-\[\]{}()*+?.,\\\^$|#\s]/g,"\\$&"),s=RegExp("^"+i,"i");return this.activeMenu.find(this.options.items).filter(".ui-menu-item").filter(function(){return s.test(t.trim(t(this).children(".ui-menu-item-wrapper").text()))})}}),t.widget("ui.autocomplete",{version:"1.12.1",defaultElement:"<input>",options:{appendTo:null,autoFocus:!1,delay:300,minLength:1,position:{my:"left top",at:"left bottom",collision:"none"},source:null,change:null,close:null,focus:null,open:null,response:null,search:null,select:null},requestIndex:0,pending:0,_create:function(){var e,i,s,n=this.element[0].nodeName.toLowerCase(),o="textarea"===n,a="input"===n;
this.isMultiLine=o||!a&&this._isContentEditable(this.element),this.valueMethod=this.element[o||a?"val":"text"],this.isNewMenu=!0,this._addClass("ui-autocomplete-input"),this.element.attr("autocomplete","off"),this._on(this.element,{keydown:function(n){if(this.element.prop("readOnly"))return e=!0,s=!0,i=!0,void 0;e=!1,s=!1,i=!1;var o=t.ui.keyCode;switch(n.keyCode){case o.PAGE_UP:e=!0,this._move("previousPage",n);break;case o.PAGE_DOWN:e=!0,this._move("nextPage",n);break;case o.UP:e=!0,this._keyEvent("previous",n);break;case o.DOWN:e=!0,this._keyEvent("next",n);break;case o.ENTER:this.menu.active&&(e=!0,n.preventDefault(),this.menu.select(n));break;case o.TAB:this.menu.active&&this.menu.select(n);break;case o.ESCAPE:this.menu.element.is(":visible")&&(this.isMultiLine||this._value(this.term),this.close(n),n.preventDefault());break;default:i=!0,this._searchTimeout(n)}},keypress:function(s){if(e)return e=!1,(!this.isMultiLine||this.menu.element.is(":visible"))&&s.preventDefault(),void 0;if(!i){var n=t.ui.keyCode;switch(s.keyCode){case n.PAGE_UP:this._move("previousPage",s);break;case n.PAGE_DOWN:this._move("nextPage",s);break;case n.UP:this._keyEvent("previous",s);break;case n.DOWN:this._keyEvent("next",s)}}},input:function(t){return s?(s=!1,t.preventDefault(),void 0):(this._searchTimeout(t),void 0)},focus:function(){this.selectedItem=null,this.previous=this._value()},blur:function(t){return this.cancelBlur?(delete this.cancelBlur,void 0):(clearTimeout(this.searching),this.close(t),this._change(t),void 0)}}),this._initSource(),this.menu=t("<ul>").appendTo(this._appendTo()).menu({role:null}).hide().menu("instance"),this._addClass(this.menu.element,"ui-autocomplete","ui-front"),this._on(this.menu.element,{mousedown:function(e){e.preventDefault(),this.cancelBlur=!0,this._delay(function(){delete this.cancelBlur,this.element[0]!==t.ui.safeActiveElement(this.document[0])&&this.element.trigger("focus")})},menufocus:function(e,i){var s,n;return this.isNewMenu&&(this.isNewMenu=!1,e.originalEvent&&/^mouse/.test(e.originalEvent.type))?(this.menu.blur(),this.document.one("mousemove",function(){t(e.target).trigger(e.originalEvent)}),void 0):(n=i.item.data("ui-autocomplete-item"),!1!==this._trigger("focus",e,{item:n})&&e.originalEvent&&/^key/.test(e.originalEvent.type)&&this._value(n.value),s=i.item.attr("aria-label")||n.value,s&&t.trim(s).length&&(this.liveRegion.children().hide(),t("<div>").text(s).appendTo(this.liveRegion)),void 0)},menuselect:function(e,i){var s=i.item.data("ui-autocomplete-item"),n=this.previous;this.element[0]!==t.ui.safeActiveElement(this.document[0])&&(this.element.trigger("focus"),this.previous=n,this._delay(function(){this.previous=n,this.selectedItem=s})),!1!==this._trigger("select",e,{item:s})&&this._value(s.value),this.term=this._value(),this.close(e),this.selectedItem=s}}),this.liveRegion=t("<div>",{role:"status","aria-live":"assertive","aria-relevant":"additions"}).appendTo(this.document[0].body),this._addClass(this.liveRegion,null,"ui-helper-hidden-accessible"),this._on(this.window,{beforeunload:function(){this.element.removeAttr("autocomplete")}})},_destroy:function(){clearTimeout(this.searching),this.element.removeAttr("autocomplete"),this.menu.element.remove(),this.liveRegion.remove()},_setOption:function(t,e){this._super(t,e),"source"===t&&this._initSource(),"appendTo"===t&&this.menu.element.appendTo(this._appendTo()),"disabled"===t&&e&&this.xhr&&this.xhr.abort()},_isEventTargetInWidget:function(e){var i=this.menu.element[0];return e.target===this.element[0]||e.target===i||t.contains(i,e.target)},_closeOnClickOutside:function(t){this._isEventTargetInWidget(t)||this.close()},_appendTo:function(){var e=this.options.appendTo;return e&&(e=e.jquery||e.nodeType?t(e):this.document.find(e).eq(0)),e&&e[0]||(e=this.element.closest(".ui-front, dialog")),e.length||(e=this.document[0].body),e},_initSource:function(){var e,i,s=this;t.isArray(this.options.source)?(e=this.options.source,this.source=function(i,s){s(t.ui.autocomplete.filter(e,i.term))}):"string"==typeof this.options.source?(i=this.options.source,this.source=function(e,n){s.xhr&&s.xhr.abort(),s.xhr=t.ajax({url:i,data:e,dataType:"json",success:function(t){n(t)},error:function(){n([])}})}):this.source=this.options.source},_searchTimeout:function(t){clearTimeout(this.searching),this.searching=this._delay(function(){var e=this.term===this._value(),i=this.menu.element.is(":visible"),s=t.altKey||t.ctrlKey||t.metaKey||t.shiftKey;(!e||e&&!i&&!s)&&(this.selectedItem=null,this.search(null,t))},this.options.delay)},search:function(t,e){return t=null!=t?t:this._value(),this.term=this._value(),t.length<this.options.minLength?this.close(e):this._trigger("search",e)!==!1?this._search(t):void 0},_search:function(t){this.pending++,this._addClass("ui-autocomplete-loading"),this.cancelSearch=!1,this.source({term:t},this._response())},_response:function(){var e=++this.requestIndex;return t.proxy(function(t){e===this.requestIndex&&this.__response(t),this.pending--,this.pending||this._removeClass("ui-autocomplete-loading")},this)},__response:function(t){t&&(t=this._normalize(t)),this._trigger("response",null,{content:t}),!this.options.disabled&&t&&t.length&&!this.cancelSearch?(this._suggest(t),this._trigger("open")):this._close()},close:function(t){this.cancelSearch=!0,this._close(t)},_close:function(t){this._off(this.document,"mousedown"),this.menu.element.is(":visible")&&(this.menu.element.hide(),this.menu.blur(),this.isNewMenu=!0,this._trigger("close",t))},_change:function(t){this.previous!==this._value()&&this._trigger("change",t,{item:this.selectedItem})},_normalize:function(e){return e.length&&e[0].label&&e[0].value?e:t.map(e,function(e){return"string"==typeof e?{label:e,value:e}:t.extend({},e,{label:e.label||e.value,value:e.value||e.label})})},_suggest:function(e){var i=this.menu.element.empty();this._renderMenu(i,e),this.isNewMenu=!0,this.menu.refresh(),i.show(),this._resizeMenu(),i.position(t.extend({of:this.element},this.options.position)),this.options.autoFocus&&this.menu.next(),this._on(this.document,{mousedown:"_closeOnClickOutside"})},_resizeMenu:function(){var t=this.menu.element;t.outerWidth(Math.max(t.width("").outerWidth()+1,this.element.outerWidth()))},_renderMenu:function(e,i){var s=this;t.each(i,function(t,i){s._renderItemData(e,i)})},_renderItemData:function(t,e){return this._renderItem(t,e).data("ui-autocomplete-item",e)},_renderItem:function(e,i){return t("<li>").append(t("<div>").text(i.label)).appendTo(e)},_move:function(t,e){return this.menu.element.is(":visible")?this.menu.isFirstItem()&&/^previous/.test(t)||this.menu.isLastItem()&&/^next/.test(t)?(this.isMultiLine||this._value(this.term),this.menu.blur(),void 0):(this.menu[t](e),void 0):(this.search(null,e),void 0)},widget:function(){return this.menu.element},_value:function(){return this.valueMethod.apply(this.element,arguments)},_keyEvent:function(t,e){(!this.isMultiLine||this.menu.element.is(":visible"))&&(this._move(t,e),e.preventDefault())},_isContentEditable:function(t){if(!t.length)return!1;var e=t.prop("contentEditable");return"inherit"===e?this._isContentEditable(t.parent()):"true"===e}}),t.extend(t.ui.autocomplete,{escapeRegex:function(t){return t.replace(/[\-\[\]{}()*+?.,\\\^$|#\s]/g,"\\$&")},filter:function(e,i){var s=RegExp(t.ui.autocomplete.escapeRegex(i),"i");return t.grep(e,function(t){return s.test(t.label||t.value||t)})}}),t.widget("ui.autocomplete",t.ui.autocomplete,{options:{messages:{noResults:"No search results.",results:function(t){return t+(t>1?" results are":" result is")+" available, use up and down arrow keys to navigate."}}},__response:function(e){var i;this._superApply(arguments),this.options.disabled||this.cancelSearch||(i=e&&e.length?this.options.messages.results(e.length):this.options.messages.noResults,this.liveRegion.children().hide(),t("<div>").text(i).appendTo(this.liveRegion))}}),t.ui.autocomplete;var g=/ui-corner-([a-z]){2,6}/g;t.widget("ui.controlgroup",{version:"1.12.1",defaultElement:"<div>",options:{direction:"horizontal",disabled:null,onlyVisible:!0,items:{button:"input[type=button], input[type=submit], input[type=reset], button, a",controlgroupLabel:".ui-controlgroup-label",checkboxradio:"input[type='checkbox'], input[type='radio']",selectmenu:"select",spinner:".ui-spinner-input"}},_create:function(){this._enhance()},_enhance:function(){this.element.attr("role","toolbar"),this.refresh()},_destroy:function(){this._callChildMethod("destroy"),this.childWidgets.removeData("ui-controlgroup-data"),this.element.removeAttr("role"),this.options.items.controlgroupLabel&&this.element.find(this.options.items.controlgroupLabel).find(".ui-controlgroup-label-contents").contents().unwrap()},_initWidgets:function(){var e=this,i=[];t.each(this.options.items,function(s,n){var o,a={};return n?"controlgroupLabel"===s?(o=e.element.find(n),o.each(function(){var e=t(this);e.children(".ui-controlgroup-label-contents").length||e.contents().wrapAll("<span class='ui-controlgroup-label-contents'></span>")}),e._addClass(o,null,"ui-widget ui-widget-content ui-state-default"),i=i.concat(o.get()),void 0):(t.fn[s]&&(a=e["_"+s+"Options"]?e["_"+s+"Options"]("middle"):{classes:{}},e.element.find(n).each(function(){var n=t(this),o=n[s]("instance"),r=t.widget.extend({},a);if("button"!==s||!n.parent(".ui-spinner").length){o||(o=n[s]()[s]("instance")),o&&(r.classes=e._resolveClassesValues(r.classes,o)),n[s](r);var h=n[s]("widget");t.data(h[0],"ui-controlgroup-data",o?o:n[s]("instance")),i.push(h[0])}})),void 0):void 0}),this.childWidgets=t(t.unique(i)),this._addClass(this.childWidgets,"ui-controlgroup-item")},_callChildMethod:function(e){this.childWidgets.each(function(){var i=t(this),s=i.data("ui-controlgroup-data");s&&s[e]&&s[e]()})},_updateCornerClass:function(t,e){var i="ui-corner-top ui-corner-bottom ui-corner-left ui-corner-right ui-corner-all",s=this._buildSimpleOptions(e,"label").classes.label;this._removeClass(t,null,i),this._addClass(t,null,s)},_buildSimpleOptions:function(t,e){var i="vertical"===this.options.direction,s={classes:{}};return s.classes[e]={middle:"",first:"ui-corner-"+(i?"top":"left"),last:"ui-corner-"+(i?"bottom":"right"),only:"ui-corner-all"}[t],s},_spinnerOptions:function(t){var e=this._buildSimpleOptions(t,"ui-spinner");return e.classes["ui-spinner-up"]="",e.classes["ui-spinner-down"]="",e},_buttonOptions:function(t){return this._buildSimpleOptions(t,"ui-button")},_checkboxradioOptions:function(t){return this._buildSimpleOptions(t,"ui-checkboxradio-label")},_selectmenuOptions:function(t){var e="vertical"===this.options.direction;return{width:e?"auto":!1,classes:{middle:{"ui-selectmenu-button-open":"","ui-selectmenu-button-closed":""},first:{"ui-selectmenu-button-open":"ui-corner-"+(e?"top":"tl"),"ui-selectmenu-button-closed":"ui-corner-"+(e?"top":"left")},last:{"ui-selectmenu-button-open":e?"":"ui-corner-tr","ui-selectmenu-button-closed":"ui-corner-"+(e?"bottom":"right")},only:{"ui-selectmenu-button-open":"ui-corner-top","ui-selectmenu-button-closed":"ui-corner-all"}}[t]}},_resolveClassesValues:function(e,i){var s={};return t.each(e,function(n){var o=i.options.classes[n]||"";o=t.trim(o.replace(g,"")),s[n]=(o+" "+e[n]).replace(/\s+/g," ")}),s},_setOption:function(t,e){return"direction"===t&&this._removeClass("ui-controlgroup-"+this.options.direction),this._super(t,e),"disabled"===t?(this._callChildMethod(e?"disable":"enable"),void 0):(this.refresh(),void 0)},refresh:function(){var e,i=this;this._addClass("ui-controlgroup ui-controlgroup-"+this.options.direction),"horizontal"===this.options.direction&&this._addClass(null,"ui-helper-clearfix"),this._initWidgets(),e=this.childWidgets,this.options.onlyVisible&&(e=e.filter(":visible")),e.length&&(t.each(["first","last"],function(t,s){var n=e[s]().data("ui-controlgroup-data");if(n&&i["_"+n.widgetName+"Options"]){var o=i["_"+n.widgetName+"Options"](1===e.length?"only":s);o.classes=i._resolveClassesValues(o.classes,n),n.element[n.widgetName](o)}else i._updateCornerClass(e[s](),s)}),this._callChildMethod("refresh"))}}),t.widget("ui.checkboxradio",[t.ui.formResetMixin,{version:"1.12.1",options:{disabled:null,label:null,icon:!0,classes:{"ui-checkboxradio-label":"ui-corner-all","ui-checkboxradio-icon":"ui-corner-all"}},_getCreateOptions:function(){var e,i,s=this,n=this._super()||{};return this._readType(),i=this.element.labels(),this.label=t(i[i.length-1]),this.label.length||t.error("No label found for checkboxradio widget"),this.originalLabel="",this.label.contents().not(this.element[0]).each(function(){s.originalLabel+=3===this.nodeType?t(this).text():this.outerHTML}),this.originalLabel&&(n.label=this.originalLabel),e=this.element[0].disabled,null!=e&&(n.disabled=e),n},_create:function(){var t=this.element[0].checked;this._bindFormResetHandler(),null==this.options.disabled&&(this.options.disabled=this.element[0].disabled),this._setOption("disabled",this.options.disabled),this._addClass("ui-checkboxradio","ui-helper-hidden-accessible"),this._addClass(this.label,"ui-checkboxradio-label","ui-button ui-widget"),"radio"===this.type&&this._addClass(this.label,"ui-checkboxradio-radio-label"),this.options.label&&this.options.label!==this.originalLabel?this._updateLabel():this.originalLabel&&(this.options.label=this.originalLabel),this._enhance(),t&&(this._addClass(this.label,"ui-checkboxradio-checked","ui-state-active"),this.icon&&this._addClass(this.icon,null,"ui-state-hover")),this._on({change:"_toggleClasses",focus:function(){this._addClass(this.label,null,"ui-state-focus ui-visual-focus")},blur:function(){this._removeClass(this.label,null,"ui-state-focus ui-visual-focus")}})},_readType:function(){var e=this.element[0].nodeName.toLowerCase();this.type=this.element[0].type,"input"===e&&/radio|checkbox/.test(this.type)||t.error("Can't create checkboxradio on element.nodeName="+e+" and element.type="+this.type)},_enhance:function(){this._updateIcon(this.element[0].checked)},widget:function(){return this.label},_getRadioGroup:function(){var e,i=this.element[0].name,s="input[name='"+t.ui.escapeSelector(i)+"']";return i?(e=this.form.length?t(this.form[0].elements).filter(s):t(s).filter(function(){return 0===t(this).form().length}),e.not(this.element)):t([])},_toggleClasses:function(){var e=this.element[0].checked;this._toggleClass(this.label,"ui-checkboxradio-checked","ui-state-active",e),this.options.icon&&"checkbox"===this.type&&this._toggleClass(this.icon,null,"ui-icon-check ui-state-checked",e)._toggleClass(this.icon,null,"ui-icon-blank",!e),"radio"===this.type&&this._getRadioGroup().each(function(){var e=t(this).checkboxradio("instance");e&&e._removeClass(e.label,"ui-checkboxradio-checked","ui-state-active")})},_destroy:function(){this._unbindFormResetHandler(),this.icon&&(this.icon.remove(),this.iconSpace.remove())},_setOption:function(t,e){return"label"!==t||e?(this._super(t,e),"disabled"===t?(this._toggleClass(this.label,null,"ui-state-disabled",e),this.element[0].disabled=e,void 0):(this.refresh(),void 0)):void 0},_updateIcon:function(e){var i="ui-icon ui-icon-background ";this.options.icon?(this.icon||(this.icon=t("<span>"),this.iconSpace=t("<span> </span>"),this._addClass(this.iconSpace,"ui-checkboxradio-icon-space")),"checkbox"===this.type?(i+=e?"ui-icon-check ui-state-checked":"ui-icon-blank",this._removeClass(this.icon,null,e?"ui-icon-blank":"ui-icon-check")):i+="ui-icon-blank",this._addClass(this.icon,"ui-checkboxradio-icon",i),e||this._removeClass(this.icon,null,"ui-icon-check ui-state-checked"),this.icon.prependTo(this.label).after(this.iconSpace)):void 0!==this.icon&&(this.icon.remove(),this.iconSpace.remove(),delete this.icon)},_updateLabel:function(){var t=this.label.contents().not(this.element[0]);this.icon&&(t=t.not(this.icon[0])),this.iconSpace&&(t=t.not(this.iconSpace[0])),t.remove(),this.label.append(this.options.label)},refresh:function(){var t=this.element[0].checked,e=this.element[0].disabled;this._updateIcon(t),this._toggleClass(this.label,"ui-checkboxradio-checked","ui-state-active",t),null!==this.options.label&&this._updateLabel(),e!==this.options.disabled&&this._setOptions({disabled:e})}}]),t.ui.checkboxradio,t.widget("ui.button",{version:"1.12.1",defaultElement:"<button>",options:{classes:{"ui-button":"ui-corner-all"},disabled:null,icon:null,iconPosition:"beginning",label:null,showLabel:!0},_getCreateOptions:function(){var t,e=this._super()||{};return this.isInput=this.element.is("input"),t=this.element[0].disabled,null!=t&&(e.disabled=t),this.originalLabel=this.isInput?this.element.val():this.element.html(),this.originalLabel&&(e.label=this.originalLabel),e},_create:function(){!this.option.showLabel&!this.options.icon&&(this.options.showLabel=!0),null==this.options.disabled&&(this.options.disabled=this.element[0].disabled||!1),this.hasTitle=!!this.element.attr("title"),this.options.label&&this.options.label!==this.originalLabel&&(this.isInput?this.element.val(this.options.label):this.element.html(this.options.label)),this._addClass("ui-button","ui-widget"),this._setOption("disabled",this.options.disabled),this._enhance(),this.element.is("a")&&this._on({keyup:function(e){e.keyCode===t.ui.keyCode.SPACE&&(e.preventDefault(),this.element[0].click?this.element[0].click():this.element.trigger("click"))}})},_enhance:function(){this.element.is("button")||this.element.attr("role","button"),this.options.icon&&(this._updateIcon("icon",this.options.icon),this._updateTooltip())},_updateTooltip:function(){this.title=this.element.attr("title"),this.options.showLabel||this.title||this.element.attr("title",this.options.label)},_updateIcon:function(e,i){var s="iconPosition"!==e,n=s?this.options.iconPosition:i,o="top"===n||"bottom"===n;this.icon?s&&this._removeClass(this.icon,null,this.options.icon):(this.icon=t("<span>"),this._addClass(this.icon,"ui-button-icon","ui-icon"),this.options.showLabel||this._addClass("ui-button-icon-only")),s&&this._addClass(this.icon,null,i),this._attachIcon(n),o?(this._addClass(this.icon,null,"ui-widget-icon-block"),this.iconSpace&&this.iconSpace.remove()):(this.iconSpace||(this.iconSpace=t("<span> </span>"),this._addClass(this.iconSpace,"ui-button-icon-space")),this._removeClass(this.icon,null,"ui-wiget-icon-block"),this._attachIconSpace(n))},_destroy:function(){this.element.removeAttr("role"),this.icon&&this.icon.remove(),this.iconSpace&&this.iconSpace.remove(),this.hasTitle||this.element.removeAttr("title")},_attachIconSpace:function(t){this.icon[/^(?:end|bottom)/.test(t)?"before":"after"](this.iconSpace)},_attachIcon:function(t){this.element[/^(?:end|bottom)/.test(t)?"append":"prepend"](this.icon)},_setOptions:function(t){var e=void 0===t.showLabel?this.options.showLabel:t.showLabel,i=void 0===t.icon?this.options.icon:t.icon;e||i||(t.showLabel=!0),this._super(t)},_setOption:function(t,e){"icon"===t&&(e?this._updateIcon(t,e):this.icon&&(this.icon.remove(),this.iconSpace&&this.iconSpace.remove())),"iconPosition"===t&&this._updateIcon(t,e),"showLabel"===t&&(this._toggleClass("ui-button-icon-only",null,!e),this._updateTooltip()),"label"===t&&(this.isInput?this.element.val(e):(this.element.html(e),this.icon&&(this._attachIcon(this.options.iconPosition),this._attachIconSpace(this.options.iconPosition)))),this._super(t,e),"disabled"===t&&(this._toggleClass(null,"ui-state-disabled",e),this.element[0].disabled=e,e&&this.element.blur())},refresh:function(){var t=this.element.is("input, button")?this.element[0].disabled:this.element.hasClass("ui-button-disabled");t!==this.options.disabled&&this._setOptions({disabled:t}),this._updateTooltip()}}),t.uiBackCompat!==!1&&(t.widget("ui.button",t.ui.button,{options:{text:!0,icons:{primary:null,secondary:null}},_create:function(){this.options.showLabel&&!this.options.text&&(this.options.showLabel=this.options.text),!this.options.showLabel&&this.options.text&&(this.options.text=this.options.showLabel),this.options.icon||!this.options.icons.primary&&!this.options.icons.secondary?this.options.icon&&(this.options.icons.primary=this.options.icon):this.options.icons.primary?this.options.icon=this.options.icons.primary:(this.options.icon=this.options.icons.secondary,this.options.iconPosition="end"),this._super()},_setOption:function(t,e){return"text"===t?(this._super("showLabel",e),void 0):("showLabel"===t&&(this.options.text=e),"icon"===t&&(this.options.icons.primary=e),"icons"===t&&(e.primary?(this._super("icon",e.primary),this._super("iconPosition","beginning")):e.secondary&&(this._super("icon",e.secondary),this._super("iconPosition","end"))),this._superApply(arguments),void 0)}}),t.fn.button=function(e){return function(){return!this.length||this.length&&"INPUT"!==this[0].tagName||this.length&&"INPUT"===this[0].tagName&&"checkbox"!==this.attr("type")&&"radio"!==this.attr("type")?e.apply(this,arguments):(t.ui.checkboxradio||t.error("Checkboxradio widget missing"),0===arguments.length?this.checkboxradio({icon:!1}):this.checkboxradio.apply(this,arguments))}}(t.fn.button),t.fn.buttonset=function(){return t.ui.controlgroup||t.error("Controlgroup widget missing"),"option"===arguments[0]&&"items"===arguments[1]&&arguments[2]?this.controlgroup.apply(this,[arguments[0],"items.button",arguments[2]]):"option"===arguments[0]&&"items"===arguments[1]?this.controlgroup.apply(this,[arguments[0],"items.button"]):("object"==typeof arguments[0]&&arguments[0].items&&(arguments[0].items={button:arguments[0].items}),this.controlgroup.apply(this,arguments))}),t.ui.button,t.extend(t.ui,{datepicker:{version:"1.12.1"}});var m;t.extend(s.prototype,{markerClassName:"hasDatepicker",maxRows:4,_widgetDatepicker:function(){return this.dpDiv},setDefaults:function(t){return a(this._defaults,t||{}),this},_attachDatepicker:function(e,i){var s,n,o;s=e.nodeName.toLowerCase(),n="div"===s||"span"===s,e.id||(this.uuid+=1,e.id="dp"+this.uuid),o=this._newInst(t(e),n),o.settings=t.extend({},i||{}),"input"===s?this._connectDatepicker(e,o):n&&this._inlineDatepicker(e,o)},_newInst:function(e,i){var s=e[0].id.replace(/([^A-Za-z0-9_\-])/g,"\\\\$1");return{id:s,input:e,selectedDay:0,selectedMonth:0,selectedYear:0,drawMonth:0,drawYear:0,inline:i,dpDiv:i?n(t("<div class='"+this._inlineClass+" ui-datepicker ui-widget ui-widget-content ui-helper-clearfix ui-corner-all'></div>")):this.dpDiv}},_connectDatepicker:function(e,i){var s=t(e);i.append=t([]),i.trigger=t([]),s.hasClass(this.markerClassName)||(this._attachments(s,i),s.addClass(this.markerClassName).on("keydown",this._doKeyDown).on("keypress",this._doKeyPress).on("keyup",this._doKeyUp),this._autoSize(i),t.data(e,"datepicker",i),i.settings.disabled&&this._disableDatepicker(e))},_attachments:function(e,i){var s,n,o,a=this._get(i,"appendText"),r=this._get(i,"isRTL");i.append&&i.append.remove(),a&&(i.append=t("<span class='"+this._appendClass+"'>"+a+"</span>"),e[r?"before":"after"](i.append)),e.off("focus",this._showDatepicker),i.trigger&&i.trigger.remove(),s=this._get(i,"showOn"),("focus"===s||"both"===s)&&e.on("focus",this._showDatepicker),("button"===s||"both"===s)&&(n=this._get(i,"buttonText"),o=this._get(i,"buttonImage"),i.trigger=t(this._get(i,"buttonImageOnly")?t("<img/>").addClass(this._triggerClass).attr({src:o,alt:n,title:n}):t("<button type='button'></button>").addClass(this._triggerClass).html(o?t("<img/>").attr({src:o,alt:n,title:n}):n)),e[r?"before":"after"](i.trigger),i.trigger.on("click",function(){return t.datepicker._datepickerShowing&&t.datepicker._lastInput===e[0]?t.datepicker._hideDatepicker():t.datepicker._datepickerShowing&&t.datepicker._lastInput!==e[0]?(t.datepicker._hideDatepicker(),t.datepicker._showDatepicker(e[0])):t.datepicker._showDatepicker(e[0]),!1}))},_autoSize:function(t){if(this._get(t,"autoSize")&&!t.inline){var e,i,s,n,o=new Date(2009,11,20),a=this._get(t,"dateFormat");a.match(/[DM]/)&&(e=function(t){for(i=0,s=0,n=0;t.length>n;n++)t[n].length>i&&(i=t[n].length,s=n);return s},o.setMonth(e(this._get(t,a.match(/MM/)?"monthNames":"monthNamesShort"))),o.setDate(e(this._get(t,a.match(/DD/)?"dayNames":"dayNamesShort"))+20-o.getDay())),t.input.attr("size",this._formatDate(t,o).length)}},_inlineDatepicker:function(e,i){var s=t(e);s.hasClass(this.markerClassName)||(s.addClass(this.markerClassName).append(i.dpDiv),t.data(e,"datepicker",i),this._setDate(i,this._getDefaultDate(i),!0),this._updateDatepicker(i),this._updateAlternate(i),i.settings.disabled&&this._disableDatepicker(e),i.dpDiv.css("display","block"))},_dialogDatepicker:function(e,i,s,n,o){var r,h,l,c,u,d=this._dialogInst;return d||(this.uuid+=1,r="dp"+this.uuid,this._dialogInput=t("<input type='text' id='"+r+"' style='position: absolute; top: -100px; width: 0px;'/>"),this._dialogInput.on("keydown",this._doKeyDown),t("body").append(this._dialogInput),d=this._dialogInst=this._newInst(this._dialogInput,!1),d.settings={},t.data(this._dialogInput[0],"datepicker",d)),a(d.settings,n||{}),i=i&&i.constructor===Date?this._formatDate(d,i):i,this._dialogInput.val(i),this._pos=o?o.length?o:[o.pageX,o.pageY]:null,this._pos||(h=document.documentElement.clientWidth,l=document.documentElement.clientHeight,c=document.documentElement.scrollLeft||document.body.scrollLeft,u=document.documentElement.scrollTop||document.body.scrollTop,this._pos=[h/2-100+c,l/2-150+u]),this._dialogInput.css("left",this._pos[0]+20+"px").css("top",this._pos[1]+"px"),d.settings.onSelect=s,this._inDialog=!0,this.dpDiv.addClass(this._dialogClass),this._showDatepicker(this._dialogInput[0]),t.blockUI&&t.blockUI(this.dpDiv),t.data(this._dialogInput[0],"datepicker",d),this},_destroyDatepicker:function(e){var i,s=t(e),n=t.data(e,"datepicker");s.hasClass(this.markerClassName)&&(i=e.nodeName.toLowerCase(),t.removeData(e,"datepicker"),"input"===i?(n.append.remove(),n.trigger.remove(),s.removeClass(this.markerClassName).off("focus",this._showDatepicker).off("keydown",this._doKeyDown).off("keypress",this._doKeyPress).off("keyup",this._doKeyUp)):("div"===i||"span"===i)&&s.removeClass(this.markerClassName).empty(),m===n&&(m=null))},_enableDatepicker:function(e){var i,s,n=t(e),o=t.data(e,"datepicker");n.hasClass(this.markerClassName)&&(i=e.nodeName.toLowerCase(),"input"===i?(e.disabled=!1,o.trigger.filter("button").each(function(){this.disabled=!1}).end().filter("img").css({opacity:"1.0",cursor:""})):("div"===i||"span"===i)&&(s=n.children("."+this._inlineClass),s.children().removeClass("ui-state-disabled"),s.find("select.ui-datepicker-month, select.ui-datepicker-year").prop("disabled",!1)),this._disabledInputs=t.map(this._disabledInputs,function(t){return t===e?null:t}))},_disableDatepicker:function(e){var i,s,n=t(e),o=t.data(e,"datepicker");n.hasClass(this.markerClassName)&&(i=e.nodeName.toLowerCase(),"input"===i?(e.disabled=!0,o.trigger.filter("button").each(function(){this.disabled=!0}).end().filter("img").css({opacity:"0.5",cursor:"default"})):("div"===i||"span"===i)&&(s=n.children("."+this._inlineClass),s.children().addClass("ui-state-disabled"),s.find("select.ui-datepicker-month, select.ui-datepicker-year").prop("disabled",!0)),this._disabledInputs=t.map(this._disabledInputs,function(t){return t===e?null:t}),this._disabledInputs[this._disabledInputs.length]=e)},_isDisabledDatepicker:function(t){if(!t)return!1;for(var e=0;this._disabledInputs.length>e;e++)if(this._disabledInputs[e]===t)return!0;return!1},_getInst:function(e){try{return t.data(e,"datepicker")}catch(i){throw"Missing instance data for this datepicker"}},_optionDatepicker:function(e,i,s){var n,o,r,h,l=this._getInst(e);return 2===arguments.length&&"string"==typeof i?"defaults"===i?t.extend({},t.datepicker._defaults):l?"all"===i?t.extend({},l.settings):this._get(l,i):null:(n=i||{},"string"==typeof i&&(n={},n[i]=s),l&&(this._curInst===l&&this._hideDatepicker(),o=this._getDateDatepicker(e,!0),r=this._getMinMaxDate(l,"min"),h=this._getMinMaxDate(l,"max"),a(l.settings,n),null!==r&&void 0!==n.dateFormat&&void 0===n.minDate&&(l.settings.minDate=this._formatDate(l,r)),null!==h&&void 0!==n.dateFormat&&void 0===n.maxDate&&(l.settings.maxDate=this._formatDate(l,h)),"disabled"in n&&(n.disabled?this._disableDatepicker(e):this._enableDatepicker(e)),this._attachments(t(e),l),this._autoSize(l),this._setDate(l,o),this._updateAlternate(l),this._updateDatepicker(l)),void 0)},_changeDatepicker:function(t,e,i){this._optionDatepicker(t,e,i)},_refreshDatepicker:function(t){var e=this._getInst(t);e&&this._updateDatepicker(e)},_setDateDatepicker:function(t,e){var i=this._getInst(t);i&&(this._setDate(i,e),this._updateDatepicker(i),this._updateAlternate(i))},_getDateDatepicker:function(t,e){var i=this._getInst(t);return i&&!i.inline&&this._setDateFromField(i,e),i?this._getDate(i):null},_doKeyDown:function(e){var i,s,n,o=t.datepicker._getInst(e.target),a=!0,r=o.dpDiv.is(".ui-datepicker-rtl");if(o._keyEvent=!0,t.datepicker._datepickerShowing)switch(e.keyCode){case 9:t.datepicker._hideDatepicker(),a=!1;break;case 13:return n=t("td."+t.datepicker._dayOverClass+":not(."+t.datepicker._currentClass+")",o.dpDiv),n[0]&&t.datepicker._selectDay(e.target,o.selectedMonth,o.selectedYear,n[0]),i=t.datepicker._get(o,"onSelect"),i?(s=t.datepicker._formatDate(o),i.apply(o.input?o.input[0]:null,[s,o])):t.datepicker._hideDatepicker(),!1;case 27:t.datepicker._hideDatepicker();break;case 33:t.datepicker._adjustDate(e.target,e.ctrlKey?-t.datepicker._get(o,"stepBigMonths"):-t.datepicker._get(o,"stepMonths"),"M");break;case 34:t.datepicker._adjustDate(e.target,e.ctrlKey?+t.datepicker._get(o,"stepBigMonths"):+t.datepicker._get(o,"stepMonths"),"M");break;case 35:(e.ctrlKey||e.metaKey)&&t.datepicker._clearDate(e.target),a=e.ctrlKey||e.metaKey;break;case 36:(e.ctrlKey||e.metaKey)&&t.datepicker._gotoToday(e.target),a=e.ctrlKey||e.metaKey;break;case 37:(e.ctrlKey||e.metaKey)&&t.datepicker._adjustDate(e.target,r?1:-1,"D"),a=e.ctrlKey||e.metaKey,e.originalEvent.altKey&&t.datepicker._adjustDate(e.target,e.ctrlKey?-t.datepicker._get(o,"stepBigMonths"):-t.datepicker._get(o,"stepMonths"),"M");break;case 38:(e.ctrlKey||e.metaKey)&&t.datepicker._adjustDate(e.target,-7,"D"),a=e.ctrlKey||e.metaKey;break;case 39:(e.ctrlKey||e.metaKey)&&t.datepicker._adjustDate(e.target,r?-1:1,"D"),a=e.ctrlKey||e.metaKey,e.originalEvent.altKey&&t.datepicker._adjustDate(e.target,e.ctrlKey?+t.datepicker._get(o,"stepBigMonths"):+t.datepicker._get(o,"stepMonths"),"M");break;case 40:(e.ctrlKey||e.metaKey)&&t.datepicker._adjustDate(e.target,7,"D"),a=e.ctrlKey||e.metaKey;break;default:a=!1}else 36===e.keyCode&&e.ctrlKey?t.datepicker._showDatepicker(this):a=!1;a&&(e.preventDefault(),e.stopPropagation())},_doKeyPress:function(e){var i,s,n=t.datepicker._getInst(e.target);return t.datepicker._get(n,"constrainInput")?(i=t.datepicker._possibleChars(t.datepicker._get(n,"dateFormat")),s=String.fromCharCode(null==e.charCode?e.keyCode:e.charCode),e.ctrlKey||e.metaKey||" ">s||!i||i.indexOf(s)>-1):void 0},_doKeyUp:function(e){var i,s=t.datepicker._getInst(e.target);if(s.input.val()!==s.lastVal)try{i=t.datepicker.parseDate(t.datepicker._get(s,"dateFormat"),s.input?s.input.val():null,t.datepicker._getFormatConfig(s)),i&&(t.datepicker._setDateFromField(s),t.datepicker._updateAlternate(s),t.datepicker._updateDatepicker(s))}catch(n){}return!0},_showDatepicker:function(e){if(e=e.target||e,"input"!==e.nodeName.toLowerCase()&&(e=t("input",e.parentNode)[0]),!t.datepicker._isDisabledDatepicker(e)&&t.datepicker._lastInput!==e){var s,n,o,r,h,l,c;s=t.datepicker._getInst(e),t.datepicker._curInst&&t.datepicker._curInst!==s&&(t.datepicker._curInst.dpDiv.stop(!0,!0),s&&t.datepicker._datepickerShowing&&t.datepicker._hideDatepicker(t.datepicker._curInst.input[0])),n=t.datepicker._get(s,"beforeShow"),o=n?n.apply(e,[e,s]):{},o!==!1&&(a(s.settings,o),s.lastVal=null,t.datepicker._lastInput=e,t.datepicker._setDateFromField(s),t.datepicker._inDialog&&(e.value=""),t.datepicker._pos||(t.datepicker._pos=t.datepicker._findPos(e),t.datepicker._pos[1]+=e.offsetHeight),r=!1,t(e).parents().each(function(){return r|="fixed"===t(this).css("position"),!r}),h={left:t.datepicker._pos[0],top:t.datepicker._pos[1]},t.datepicker._pos=null,s.dpDiv.empty(),s.dpDiv.css({position:"absolute",display:"block",top:"-1000px"}),t.datepicker._updateDatepicker(s),h=t.datepicker._checkOffset(s,h,r),s.dpDiv.css({position:t.datepicker._inDialog&&t.blockUI?"static":r?"fixed":"absolute",display:"none",left:h.left+"px",top:h.top+"px"}),s.inline||(l=t.datepicker._get(s,"showAnim"),c=t.datepicker._get(s,"duration"),s.dpDiv.css("z-index",i(t(e))+1),t.datepicker._datepickerShowing=!0,t.effects&&t.effects.effect[l]?s.dpDiv.show(l,t.datepicker._get(s,"showOptions"),c):s.dpDiv[l||"show"](l?c:null),t.datepicker._shouldFocusInput(s)&&s.input.trigger("focus"),t.datepicker._curInst=s))
}},_updateDatepicker:function(e){this.maxRows=4,m=e,e.dpDiv.empty().append(this._generateHTML(e)),this._attachHandlers(e);var i,s=this._getNumberOfMonths(e),n=s[1],a=17,r=e.dpDiv.find("."+this._dayOverClass+" a");r.length>0&&o.apply(r.get(0)),e.dpDiv.removeClass("ui-datepicker-multi-2 ui-datepicker-multi-3 ui-datepicker-multi-4").width(""),n>1&&e.dpDiv.addClass("ui-datepicker-multi-"+n).css("width",a*n+"em"),e.dpDiv[(1!==s[0]||1!==s[1]?"add":"remove")+"Class"]("ui-datepicker-multi"),e.dpDiv[(this._get(e,"isRTL")?"add":"remove")+"Class"]("ui-datepicker-rtl"),e===t.datepicker._curInst&&t.datepicker._datepickerShowing&&t.datepicker._shouldFocusInput(e)&&e.input.trigger("focus"),e.yearshtml&&(i=e.yearshtml,setTimeout(function(){i===e.yearshtml&&e.yearshtml&&e.dpDiv.find("select.ui-datepicker-year:first").replaceWith(e.yearshtml),i=e.yearshtml=null},0))},_shouldFocusInput:function(t){return t.input&&t.input.is(":visible")&&!t.input.is(":disabled")&&!t.input.is(":focus")},_checkOffset:function(e,i,s){var n=e.dpDiv.outerWidth(),o=e.dpDiv.outerHeight(),a=e.input?e.input.outerWidth():0,r=e.input?e.input.outerHeight():0,h=document.documentElement.clientWidth+(s?0:t(document).scrollLeft()),l=document.documentElement.clientHeight+(s?0:t(document).scrollTop());return i.left-=this._get(e,"isRTL")?n-a:0,i.left-=s&&i.left===e.input.offset().left?t(document).scrollLeft():0,i.top-=s&&i.top===e.input.offset().top+r?t(document).scrollTop():0,i.left-=Math.min(i.left,i.left+n>h&&h>n?Math.abs(i.left+n-h):0),i.top-=Math.min(i.top,i.top+o>l&&l>o?Math.abs(o+r):0),i},_findPos:function(e){for(var i,s=this._getInst(e),n=this._get(s,"isRTL");e&&("hidden"===e.type||1!==e.nodeType||t.expr.filters.hidden(e));)e=e[n?"previousSibling":"nextSibling"];return i=t(e).offset(),[i.left,i.top]},_hideDatepicker:function(e){var i,s,n,o,a=this._curInst;!a||e&&a!==t.data(e,"datepicker")||this._datepickerShowing&&(i=this._get(a,"showAnim"),s=this._get(a,"duration"),n=function(){t.datepicker._tidyDialog(a)},t.effects&&(t.effects.effect[i]||t.effects[i])?a.dpDiv.hide(i,t.datepicker._get(a,"showOptions"),s,n):a.dpDiv["slideDown"===i?"slideUp":"fadeIn"===i?"fadeOut":"hide"](i?s:null,n),i||n(),this._datepickerShowing=!1,o=this._get(a,"onClose"),o&&o.apply(a.input?a.input[0]:null,[a.input?a.input.val():"",a]),this._lastInput=null,this._inDialog&&(this._dialogInput.css({position:"absolute",left:"0",top:"-100px"}),t.blockUI&&(t.unblockUI(),t("body").append(this.dpDiv))),this._inDialog=!1)},_tidyDialog:function(t){t.dpDiv.removeClass(this._dialogClass).off(".ui-datepicker-calendar")},_checkExternalClick:function(e){if(t.datepicker._curInst){var i=t(e.target),s=t.datepicker._getInst(i[0]);(i[0].id!==t.datepicker._mainDivId&&0===i.parents("#"+t.datepicker._mainDivId).length&&!i.hasClass(t.datepicker.markerClassName)&&!i.closest("."+t.datepicker._triggerClass).length&&t.datepicker._datepickerShowing&&(!t.datepicker._inDialog||!t.blockUI)||i.hasClass(t.datepicker.markerClassName)&&t.datepicker._curInst!==s)&&t.datepicker._hideDatepicker()}},_adjustDate:function(e,i,s){var n=t(e),o=this._getInst(n[0]);this._isDisabledDatepicker(n[0])||(this._adjustInstDate(o,i+("M"===s?this._get(o,"showCurrentAtPos"):0),s),this._updateDatepicker(o))},_gotoToday:function(e){var i,s=t(e),n=this._getInst(s[0]);this._get(n,"gotoCurrent")&&n.currentDay?(n.selectedDay=n.currentDay,n.drawMonth=n.selectedMonth=n.currentMonth,n.drawYear=n.selectedYear=n.currentYear):(i=new Date,n.selectedDay=i.getDate(),n.drawMonth=n.selectedMonth=i.getMonth(),n.drawYear=n.selectedYear=i.getFullYear()),this._notifyChange(n),this._adjustDate(s)},_selectMonthYear:function(e,i,s){var n=t(e),o=this._getInst(n[0]);o["selected"+("M"===s?"Month":"Year")]=o["draw"+("M"===s?"Month":"Year")]=parseInt(i.options[i.selectedIndex].value,10),this._notifyChange(o),this._adjustDate(n)},_selectDay:function(e,i,s,n){var o,a=t(e);t(n).hasClass(this._unselectableClass)||this._isDisabledDatepicker(a[0])||(o=this._getInst(a[0]),o.selectedDay=o.currentDay=t("a",n).html(),o.selectedMonth=o.currentMonth=i,o.selectedYear=o.currentYear=s,this._selectDate(e,this._formatDate(o,o.currentDay,o.currentMonth,o.currentYear)))},_clearDate:function(e){var i=t(e);this._selectDate(i,"")},_selectDate:function(e,i){var s,n=t(e),o=this._getInst(n[0]);i=null!=i?i:this._formatDate(o),o.input&&o.input.val(i),this._updateAlternate(o),s=this._get(o,"onSelect"),s?s.apply(o.input?o.input[0]:null,[i,o]):o.input&&o.input.trigger("change"),o.inline?this._updateDatepicker(o):(this._hideDatepicker(),this._lastInput=o.input[0],"object"!=typeof o.input[0]&&o.input.trigger("focus"),this._lastInput=null)},_updateAlternate:function(e){var i,s,n,o=this._get(e,"altField");o&&(i=this._get(e,"altFormat")||this._get(e,"dateFormat"),s=this._getDate(e),n=this.formatDate(i,s,this._getFormatConfig(e)),t(o).val(n))},noWeekends:function(t){var e=t.getDay();return[e>0&&6>e,""]},iso8601Week:function(t){var e,i=new Date(t.getTime());return i.setDate(i.getDate()+4-(i.getDay()||7)),e=i.getTime(),i.setMonth(0),i.setDate(1),Math.floor(Math.round((e-i)/864e5)/7)+1},parseDate:function(e,i,s){if(null==e||null==i)throw"Invalid arguments";if(i="object"==typeof i?""+i:i+"",""===i)return null;var n,o,a,r,h=0,l=(s?s.shortYearCutoff:null)||this._defaults.shortYearCutoff,c="string"!=typeof l?l:(new Date).getFullYear()%100+parseInt(l,10),u=(s?s.dayNamesShort:null)||this._defaults.dayNamesShort,d=(s?s.dayNames:null)||this._defaults.dayNames,p=(s?s.monthNamesShort:null)||this._defaults.monthNamesShort,f=(s?s.monthNames:null)||this._defaults.monthNames,g=-1,m=-1,_=-1,v=-1,b=!1,y=function(t){var i=e.length>n+1&&e.charAt(n+1)===t;return i&&n++,i},w=function(t){var e=y(t),s="@"===t?14:"!"===t?20:"y"===t&&e?4:"o"===t?3:2,n="y"===t?s:1,o=RegExp("^\\d{"+n+","+s+"}"),a=i.substring(h).match(o);if(!a)throw"Missing number at position "+h;return h+=a[0].length,parseInt(a[0],10)},k=function(e,s,n){var o=-1,a=t.map(y(e)?n:s,function(t,e){return[[e,t]]}).sort(function(t,e){return-(t[1].length-e[1].length)});if(t.each(a,function(t,e){var s=e[1];return i.substr(h,s.length).toLowerCase()===s.toLowerCase()?(o=e[0],h+=s.length,!1):void 0}),-1!==o)return o+1;throw"Unknown name at position "+h},x=function(){if(i.charAt(h)!==e.charAt(n))throw"Unexpected literal at position "+h;h++};for(n=0;e.length>n;n++)if(b)"'"!==e.charAt(n)||y("'")?x():b=!1;else switch(e.charAt(n)){case"d":_=w("d");break;case"D":k("D",u,d);break;case"o":v=w("o");break;case"m":m=w("m");break;case"M":m=k("M",p,f);break;case"y":g=w("y");break;case"@":r=new Date(w("@")),g=r.getFullYear(),m=r.getMonth()+1,_=r.getDate();break;case"!":r=new Date((w("!")-this._ticksTo1970)/1e4),g=r.getFullYear(),m=r.getMonth()+1,_=r.getDate();break;case"'":y("'")?x():b=!0;break;default:x()}if(i.length>h&&(a=i.substr(h),!/^\s+/.test(a)))throw"Extra/unparsed characters found in date: "+a;if(-1===g?g=(new Date).getFullYear():100>g&&(g+=(new Date).getFullYear()-(new Date).getFullYear()%100+(c>=g?0:-100)),v>-1)for(m=1,_=v;;){if(o=this._getDaysInMonth(g,m-1),o>=_)break;m++,_-=o}if(r=this._daylightSavingAdjust(new Date(g,m-1,_)),r.getFullYear()!==g||r.getMonth()+1!==m||r.getDate()!==_)throw"Invalid date";return r},ATOM:"yy-mm-dd",COOKIE:"D, dd M yy",ISO_8601:"yy-mm-dd",RFC_822:"D, d M y",RFC_850:"DD, dd-M-y",RFC_1036:"D, d M y",RFC_1123:"D, d M yy",RFC_2822:"D, d M yy",RSS:"D, d M y",TICKS:"!",TIMESTAMP:"@",W3C:"yy-mm-dd",_ticksTo1970:1e7*60*60*24*(718685+Math.floor(492.5)-Math.floor(19.7)+Math.floor(4.925)),formatDate:function(t,e,i){if(!e)return"";var s,n=(i?i.dayNamesShort:null)||this._defaults.dayNamesShort,o=(i?i.dayNames:null)||this._defaults.dayNames,a=(i?i.monthNamesShort:null)||this._defaults.monthNamesShort,r=(i?i.monthNames:null)||this._defaults.monthNames,h=function(e){var i=t.length>s+1&&t.charAt(s+1)===e;return i&&s++,i},l=function(t,e,i){var s=""+e;if(h(t))for(;i>s.length;)s="0"+s;return s},c=function(t,e,i,s){return h(t)?s[e]:i[e]},u="",d=!1;if(e)for(s=0;t.length>s;s++)if(d)"'"!==t.charAt(s)||h("'")?u+=t.charAt(s):d=!1;else switch(t.charAt(s)){case"d":u+=l("d",e.getDate(),2);break;case"D":u+=c("D",e.getDay(),n,o);break;case"o":u+=l("o",Math.round((new Date(e.getFullYear(),e.getMonth(),e.getDate()).getTime()-new Date(e.getFullYear(),0,0).getTime())/864e5),3);break;case"m":u+=l("m",e.getMonth()+1,2);break;case"M":u+=c("M",e.getMonth(),a,r);break;case"y":u+=h("y")?e.getFullYear():(10>e.getFullYear()%100?"0":"")+e.getFullYear()%100;break;case"@":u+=e.getTime();break;case"!":u+=1e4*e.getTime()+this._ticksTo1970;break;case"'":h("'")?u+="'":d=!0;break;default:u+=t.charAt(s)}return u},_possibleChars:function(t){var e,i="",s=!1,n=function(i){var s=t.length>e+1&&t.charAt(e+1)===i;return s&&e++,s};for(e=0;t.length>e;e++)if(s)"'"!==t.charAt(e)||n("'")?i+=t.charAt(e):s=!1;else switch(t.charAt(e)){case"d":case"m":case"y":case"@":i+="0123456789";break;case"D":case"M":return null;case"'":n("'")?i+="'":s=!0;break;default:i+=t.charAt(e)}return i},_get:function(t,e){return void 0!==t.settings[e]?t.settings[e]:this._defaults[e]},_setDateFromField:function(t,e){if(t.input.val()!==t.lastVal){var i=this._get(t,"dateFormat"),s=t.lastVal=t.input?t.input.val():null,n=this._getDefaultDate(t),o=n,a=this._getFormatConfig(t);try{o=this.parseDate(i,s,a)||n}catch(r){s=e?"":s}t.selectedDay=o.getDate(),t.drawMonth=t.selectedMonth=o.getMonth(),t.drawYear=t.selectedYear=o.getFullYear(),t.currentDay=s?o.getDate():0,t.currentMonth=s?o.getMonth():0,t.currentYear=s?o.getFullYear():0,this._adjustInstDate(t)}},_getDefaultDate:function(t){return this._restrictMinMax(t,this._determineDate(t,this._get(t,"defaultDate"),new Date))},_determineDate:function(e,i,s){var n=function(t){var e=new Date;return e.setDate(e.getDate()+t),e},o=function(i){try{return t.datepicker.parseDate(t.datepicker._get(e,"dateFormat"),i,t.datepicker._getFormatConfig(e))}catch(s){}for(var n=(i.toLowerCase().match(/^c/)?t.datepicker._getDate(e):null)||new Date,o=n.getFullYear(),a=n.getMonth(),r=n.getDate(),h=/([+\-]?[0-9]+)\s*(d|D|w|W|m|M|y|Y)?/g,l=h.exec(i);l;){switch(l[2]||"d"){case"d":case"D":r+=parseInt(l[1],10);break;case"w":case"W":r+=7*parseInt(l[1],10);break;case"m":case"M":a+=parseInt(l[1],10),r=Math.min(r,t.datepicker._getDaysInMonth(o,a));break;case"y":case"Y":o+=parseInt(l[1],10),r=Math.min(r,t.datepicker._getDaysInMonth(o,a))}l=h.exec(i)}return new Date(o,a,r)},a=null==i||""===i?s:"string"==typeof i?o(i):"number"==typeof i?isNaN(i)?s:n(i):new Date(i.getTime());return a=a&&"Invalid Date"==""+a?s:a,a&&(a.setHours(0),a.setMinutes(0),a.setSeconds(0),a.setMilliseconds(0)),this._daylightSavingAdjust(a)},_daylightSavingAdjust:function(t){return t?(t.setHours(t.getHours()>12?t.getHours()+2:0),t):null},_setDate:function(t,e,i){var s=!e,n=t.selectedMonth,o=t.selectedYear,a=this._restrictMinMax(t,this._determineDate(t,e,new Date));t.selectedDay=t.currentDay=a.getDate(),t.drawMonth=t.selectedMonth=t.currentMonth=a.getMonth(),t.drawYear=t.selectedYear=t.currentYear=a.getFullYear(),n===t.selectedMonth&&o===t.selectedYear||i||this._notifyChange(t),this._adjustInstDate(t),t.input&&t.input.val(s?"":this._formatDate(t))},_getDate:function(t){var e=!t.currentYear||t.input&&""===t.input.val()?null:this._daylightSavingAdjust(new Date(t.currentYear,t.currentMonth,t.currentDay));return e},_attachHandlers:function(e){var i=this._get(e,"stepMonths"),s="#"+e.id.replace(/\\\\/g,"\\");e.dpDiv.find("[data-handler]").map(function(){var e={prev:function(){t.datepicker._adjustDate(s,-i,"M")},next:function(){t.datepicker._adjustDate(s,+i,"M")},hide:function(){t.datepicker._hideDatepicker()},today:function(){t.datepicker._gotoToday(s)},selectDay:function(){return t.datepicker._selectDay(s,+this.getAttribute("data-month"),+this.getAttribute("data-year"),this),!1},selectMonth:function(){return t.datepicker._selectMonthYear(s,this,"M"),!1},selectYear:function(){return t.datepicker._selectMonthYear(s,this,"Y"),!1}};t(this).on(this.getAttribute("data-event"),e[this.getAttribute("data-handler")])})},_generateHTML:function(t){var e,i,s,n,o,a,r,h,l,c,u,d,p,f,g,m,_,v,b,y,w,k,x,C,D,I,T,P,M,S,H,z,O,A,N,W,E,F,L,R=new Date,B=this._daylightSavingAdjust(new Date(R.getFullYear(),R.getMonth(),R.getDate())),Y=this._get(t,"isRTL"),j=this._get(t,"showButtonPanel"),q=this._get(t,"hideIfNoPrevNext"),K=this._get(t,"navigationAsDateFormat"),U=this._getNumberOfMonths(t),V=this._get(t,"showCurrentAtPos"),$=this._get(t,"stepMonths"),X=1!==U[0]||1!==U[1],G=this._daylightSavingAdjust(t.currentDay?new Date(t.currentYear,t.currentMonth,t.currentDay):new Date(9999,9,9)),Q=this._getMinMaxDate(t,"min"),J=this._getMinMaxDate(t,"max"),Z=t.drawMonth-V,te=t.drawYear;if(0>Z&&(Z+=12,te--),J)for(e=this._daylightSavingAdjust(new Date(J.getFullYear(),J.getMonth()-U[0]*U[1]+1,J.getDate())),e=Q&&Q>e?Q:e;this._daylightSavingAdjust(new Date(te,Z,1))>e;)Z--,0>Z&&(Z=11,te--);for(t.drawMonth=Z,t.drawYear=te,i=this._get(t,"prevText"),i=K?this.formatDate(i,this._daylightSavingAdjust(new Date(te,Z-$,1)),this._getFormatConfig(t)):i,s=this._canAdjustMonth(t,-1,te,Z)?"<a class='ui-datepicker-prev ui-corner-all' data-handler='prev' data-event='click' title='"+i+"'><span class='ui-icon ui-icon-circle-triangle-"+(Y?"e":"w")+"'>"+i+"</span></a>":q?"":"<a class='ui-datepicker-prev ui-corner-all ui-state-disabled' title='"+i+"'><span class='ui-icon ui-icon-circle-triangle-"+(Y?"e":"w")+"'>"+i+"</span></a>",n=this._get(t,"nextText"),n=K?this.formatDate(n,this._daylightSavingAdjust(new Date(te,Z+$,1)),this._getFormatConfig(t)):n,o=this._canAdjustMonth(t,1,te,Z)?"<a class='ui-datepicker-next ui-corner-all' data-handler='next' data-event='click' title='"+n+"'><span class='ui-icon ui-icon-circle-triangle-"+(Y?"w":"e")+"'>"+n+"</span></a>":q?"":"<a class='ui-datepicker-next ui-corner-all ui-state-disabled' title='"+n+"'><span class='ui-icon ui-icon-circle-triangle-"+(Y?"w":"e")+"'>"+n+"</span></a>",a=this._get(t,"currentText"),r=this._get(t,"gotoCurrent")&&t.currentDay?G:B,a=K?this.formatDate(a,r,this._getFormatConfig(t)):a,h=t.inline?"":"<button type='button' class='ui-datepicker-close ui-state-default ui-priority-primary ui-corner-all' data-handler='hide' data-event='click'>"+this._get(t,"closeText")+"</button>",l=j?"<div class='ui-datepicker-buttonpane ui-widget-content'>"+(Y?h:"")+(this._isInRange(t,r)?"<button type='button' class='ui-datepicker-current ui-state-default ui-priority-secondary ui-corner-all' data-handler='today' data-event='click'>"+a+"</button>":"")+(Y?"":h)+"</div>":"",c=parseInt(this._get(t,"firstDay"),10),c=isNaN(c)?0:c,u=this._get(t,"showWeek"),d=this._get(t,"dayNames"),p=this._get(t,"dayNamesMin"),f=this._get(t,"monthNames"),g=this._get(t,"monthNamesShort"),m=this._get(t,"beforeShowDay"),_=this._get(t,"showOtherMonths"),v=this._get(t,"selectOtherMonths"),b=this._getDefaultDate(t),y="",k=0;U[0]>k;k++){for(x="",this.maxRows=4,C=0;U[1]>C;C++){if(D=this._daylightSavingAdjust(new Date(te,Z,t.selectedDay)),I=" ui-corner-all",T="",X){if(T+="<div class='ui-datepicker-group",U[1]>1)switch(C){case 0:T+=" ui-datepicker-group-first",I=" ui-corner-"+(Y?"right":"left");break;case U[1]-1:T+=" ui-datepicker-group-last",I=" ui-corner-"+(Y?"left":"right");break;default:T+=" ui-datepicker-group-middle",I=""}T+="'>"}for(T+="<div class='ui-datepicker-header ui-widget-header ui-helper-clearfix"+I+"'>"+(/all|left/.test(I)&&0===k?Y?o:s:"")+(/all|right/.test(I)&&0===k?Y?s:o:"")+this._generateMonthYearHeader(t,Z,te,Q,J,k>0||C>0,f,g)+"</div><table class='ui-datepicker-calendar'><thead>"+"<tr>",P=u?"<th class='ui-datepicker-week-col'>"+this._get(t,"weekHeader")+"</th>":"",w=0;7>w;w++)M=(w+c)%7,P+="<th scope='col'"+((w+c+6)%7>=5?" class='ui-datepicker-week-end'":"")+">"+"<span title='"+d[M]+"'>"+p[M]+"</span></th>";for(T+=P+"</tr></thead><tbody>",S=this._getDaysInMonth(te,Z),te===t.selectedYear&&Z===t.selectedMonth&&(t.selectedDay=Math.min(t.selectedDay,S)),H=(this._getFirstDayOfMonth(te,Z)-c+7)%7,z=Math.ceil((H+S)/7),O=X?this.maxRows>z?this.maxRows:z:z,this.maxRows=O,A=this._daylightSavingAdjust(new Date(te,Z,1-H)),N=0;O>N;N++){for(T+="<tr>",W=u?"<td class='ui-datepicker-week-col'>"+this._get(t,"calculateWeek")(A)+"</td>":"",w=0;7>w;w++)E=m?m.apply(t.input?t.input[0]:null,[A]):[!0,""],F=A.getMonth()!==Z,L=F&&!v||!E[0]||Q&&Q>A||J&&A>J,W+="<td class='"+((w+c+6)%7>=5?" ui-datepicker-week-end":"")+(F?" ui-datepicker-other-month":"")+(A.getTime()===D.getTime()&&Z===t.selectedMonth&&t._keyEvent||b.getTime()===A.getTime()&&b.getTime()===D.getTime()?" "+this._dayOverClass:"")+(L?" "+this._unselectableClass+" ui-state-disabled":"")+(F&&!_?"":" "+E[1]+(A.getTime()===G.getTime()?" "+this._currentClass:"")+(A.getTime()===B.getTime()?" ui-datepicker-today":""))+"'"+(F&&!_||!E[2]?"":" title='"+E[2].replace(/'/g,"&#39;")+"'")+(L?"":" data-handler='selectDay' data-event='click' data-month='"+A.getMonth()+"' data-year='"+A.getFullYear()+"'")+">"+(F&&!_?"&#xa0;":L?"<span class='ui-state-default'>"+A.getDate()+"</span>":"<a class='ui-state-default"+(A.getTime()===B.getTime()?" ui-state-highlight":"")+(A.getTime()===G.getTime()?" ui-state-active":"")+(F?" ui-priority-secondary":"")+"' href='#'>"+A.getDate()+"</a>")+"</td>",A.setDate(A.getDate()+1),A=this._daylightSavingAdjust(A);T+=W+"</tr>"}Z++,Z>11&&(Z=0,te++),T+="</tbody></table>"+(X?"</div>"+(U[0]>0&&C===U[1]-1?"<div class='ui-datepicker-row-break'></div>":""):""),x+=T}y+=x}return y+=l,t._keyEvent=!1,y},_generateMonthYearHeader:function(t,e,i,s,n,o,a,r){var h,l,c,u,d,p,f,g,m=this._get(t,"changeMonth"),_=this._get(t,"changeYear"),v=this._get(t,"showMonthAfterYear"),b="<div class='ui-datepicker-title'>",y="";if(o||!m)y+="<span class='ui-datepicker-month'>"+a[e]+"</span>";else{for(h=s&&s.getFullYear()===i,l=n&&n.getFullYear()===i,y+="<select class='ui-datepicker-month' data-handler='selectMonth' data-event='change'>",c=0;12>c;c++)(!h||c>=s.getMonth())&&(!l||n.getMonth()>=c)&&(y+="<option value='"+c+"'"+(c===e?" selected='selected'":"")+">"+r[c]+"</option>");y+="</select>"}if(v||(b+=y+(!o&&m&&_?"":"&#xa0;")),!t.yearshtml)if(t.yearshtml="",o||!_)b+="<span class='ui-datepicker-year'>"+i+"</span>";else{for(u=this._get(t,"yearRange").split(":"),d=(new Date).getFullYear(),p=function(t){var e=t.match(/c[+\-].*/)?i+parseInt(t.substring(1),10):t.match(/[+\-].*/)?d+parseInt(t,10):parseInt(t,10);return isNaN(e)?d:e},f=p(u[0]),g=Math.max(f,p(u[1]||"")),f=s?Math.max(f,s.getFullYear()):f,g=n?Math.min(g,n.getFullYear()):g,t.yearshtml+="<select class='ui-datepicker-year' data-handler='selectYear' data-event='change'>";g>=f;f++)t.yearshtml+="<option value='"+f+"'"+(f===i?" selected='selected'":"")+">"+f+"</option>";t.yearshtml+="</select>",b+=t.yearshtml,t.yearshtml=null}return b+=this._get(t,"yearSuffix"),v&&(b+=(!o&&m&&_?"":"&#xa0;")+y),b+="</div>"},_adjustInstDate:function(t,e,i){var s=t.selectedYear+("Y"===i?e:0),n=t.selectedMonth+("M"===i?e:0),o=Math.min(t.selectedDay,this._getDaysInMonth(s,n))+("D"===i?e:0),a=this._restrictMinMax(t,this._daylightSavingAdjust(new Date(s,n,o)));t.selectedDay=a.getDate(),t.drawMonth=t.selectedMonth=a.getMonth(),t.drawYear=t.selectedYear=a.getFullYear(),("M"===i||"Y"===i)&&this._notifyChange(t)},_restrictMinMax:function(t,e){var i=this._getMinMaxDate(t,"min"),s=this._getMinMaxDate(t,"max"),n=i&&i>e?i:e;return s&&n>s?s:n},_notifyChange:function(t){var e=this._get(t,"onChangeMonthYear");e&&e.apply(t.input?t.input[0]:null,[t.selectedYear,t.selectedMonth+1,t])},_getNumberOfMonths:function(t){var e=this._get(t,"numberOfMonths");return null==e?[1,1]:"number"==typeof e?[1,e]:e},_getMinMaxDate:function(t,e){return this._determineDate(t,this._get(t,e+"Date"),null)},_getDaysInMonth:function(t,e){return 32-this._daylightSavingAdjust(new Date(t,e,32)).getDate()},_getFirstDayOfMonth:function(t,e){return new Date(t,e,1).getDay()},_canAdjustMonth:function(t,e,i,s){var n=this._getNumberOfMonths(t),o=this._daylightSavingAdjust(new Date(i,s+(0>e?e:n[0]*n[1]),1));return 0>e&&o.setDate(this._getDaysInMonth(o.getFullYear(),o.getMonth())),this._isInRange(t,o)},_isInRange:function(t,e){var i,s,n=this._getMinMaxDate(t,"min"),o=this._getMinMaxDate(t,"max"),a=null,r=null,h=this._get(t,"yearRange");return h&&(i=h.split(":"),s=(new Date).getFullYear(),a=parseInt(i[0],10),r=parseInt(i[1],10),i[0].match(/[+\-].*/)&&(a+=s),i[1].match(/[+\-].*/)&&(r+=s)),(!n||e.getTime()>=n.getTime())&&(!o||e.getTime()<=o.getTime())&&(!a||e.getFullYear()>=a)&&(!r||r>=e.getFullYear())},_getFormatConfig:function(t){var e=this._get(t,"shortYearCutoff");return e="string"!=typeof e?e:(new Date).getFullYear()%100+parseInt(e,10),{shortYearCutoff:e,dayNamesShort:this._get(t,"dayNamesShort"),dayNames:this._get(t,"dayNames"),monthNamesShort:this._get(t,"monthNamesShort"),monthNames:this._get(t,"monthNames")}},_formatDate:function(t,e,i,s){e||(t.currentDay=t.selectedDay,t.currentMonth=t.selectedMonth,t.currentYear=t.selectedYear);var n=e?"object"==typeof e?e:this._daylightSavingAdjust(new Date(s,i,e)):this._daylightSavingAdjust(new Date(t.currentYear,t.currentMonth,t.currentDay));return this.formatDate(this._get(t,"dateFormat"),n,this._getFormatConfig(t))}}),t.fn.datepicker=function(e){if(!this.length)return this;t.datepicker.initialized||(t(document).on("mousedown",t.datepicker._checkExternalClick),t.datepicker.initialized=!0),0===t("#"+t.datepicker._mainDivId).length&&t("body").append(t.datepicker.dpDiv);var i=Array.prototype.slice.call(arguments,1);return"string"!=typeof e||"isDisabled"!==e&&"getDate"!==e&&"widget"!==e?"option"===e&&2===arguments.length&&"string"==typeof arguments[1]?t.datepicker["_"+e+"Datepicker"].apply(t.datepicker,[this[0]].concat(i)):this.each(function(){"string"==typeof e?t.datepicker["_"+e+"Datepicker"].apply(t.datepicker,[this].concat(i)):t.datepicker._attachDatepicker(this,e)}):t.datepicker["_"+e+"Datepicker"].apply(t.datepicker,[this[0]].concat(i))},t.datepicker=new s,t.datepicker.initialized=!1,t.datepicker.uuid=(new Date).getTime(),t.datepicker.version="1.12.1",t.datepicker,t.ui.ie=!!/msie [\w.]+/.exec(navigator.userAgent.toLowerCase());var _=!1;t(document).on("mouseup",function(){_=!1}),t.widget("ui.mouse",{version:"1.12.1",options:{cancel:"input, textarea, button, select, option",distance:1,delay:0},_mouseInit:function(){var e=this;this.element.on("mousedown."+this.widgetName,function(t){return e._mouseDown(t)}).on("click."+this.widgetName,function(i){return!0===t.data(i.target,e.widgetName+".preventClickEvent")?(t.removeData(i.target,e.widgetName+".preventClickEvent"),i.stopImmediatePropagation(),!1):void 0}),this.started=!1},_mouseDestroy:function(){this.element.off("."+this.widgetName),this._mouseMoveDelegate&&this.document.off("mousemove."+this.widgetName,this._mouseMoveDelegate).off("mouseup."+this.widgetName,this._mouseUpDelegate)},_mouseDown:function(e){if(!_){this._mouseMoved=!1,this._mouseStarted&&this._mouseUp(e),this._mouseDownEvent=e;var i=this,s=1===e.which,n="string"==typeof this.options.cancel&&e.target.nodeName?t(e.target).closest(this.options.cancel).length:!1;return s&&!n&&this._mouseCapture(e)?(this.mouseDelayMet=!this.options.delay,this.mouseDelayMet||(this._mouseDelayTimer=setTimeout(function(){i.mouseDelayMet=!0},this.options.delay)),this._mouseDistanceMet(e)&&this._mouseDelayMet(e)&&(this._mouseStarted=this._mouseStart(e)!==!1,!this._mouseStarted)?(e.preventDefault(),!0):(!0===t.data(e.target,this.widgetName+".preventClickEvent")&&t.removeData(e.target,this.widgetName+".preventClickEvent"),this._mouseMoveDelegate=function(t){return i._mouseMove(t)},this._mouseUpDelegate=function(t){return i._mouseUp(t)},this.document.on("mousemove."+this.widgetName,this._mouseMoveDelegate).on("mouseup."+this.widgetName,this._mouseUpDelegate),e.preventDefault(),_=!0,!0)):!0}},_mouseMove:function(e){if(this._mouseMoved){if(t.ui.ie&&(!document.documentMode||9>document.documentMode)&&!e.button)return this._mouseUp(e);if(!e.which)if(e.originalEvent.altKey||e.originalEvent.ctrlKey||e.originalEvent.metaKey||e.originalEvent.shiftKey)this.ignoreMissingWhich=!0;else if(!this.ignoreMissingWhich)return this._mouseUp(e)}return(e.which||e.button)&&(this._mouseMoved=!0),this._mouseStarted?(this._mouseDrag(e),e.preventDefault()):(this._mouseDistanceMet(e)&&this._mouseDelayMet(e)&&(this._mouseStarted=this._mouseStart(this._mouseDownEvent,e)!==!1,this._mouseStarted?this._mouseDrag(e):this._mouseUp(e)),!this._mouseStarted)},_mouseUp:function(e){this.document.off("mousemove."+this.widgetName,this._mouseMoveDelegate).off("mouseup."+this.widgetName,this._mouseUpDelegate),this._mouseStarted&&(this._mouseStarted=!1,e.target===this._mouseDownEvent.target&&t.data(e.target,this.widgetName+".preventClickEvent",!0),this._mouseStop(e)),this._mouseDelayTimer&&(clearTimeout(this._mouseDelayTimer),delete this._mouseDelayTimer),this.ignoreMissingWhich=!1,_=!1,e.preventDefault()},_mouseDistanceMet:function(t){return Math.max(Math.abs(this._mouseDownEvent.pageX-t.pageX),Math.abs(this._mouseDownEvent.pageY-t.pageY))>=this.options.distance},_mouseDelayMet:function(){return this.mouseDelayMet},_mouseStart:function(){},_mouseDrag:function(){},_mouseStop:function(){},_mouseCapture:function(){return!0}}),t.ui.plugin={add:function(e,i,s){var n,o=t.ui[e].prototype;for(n in s)o.plugins[n]=o.plugins[n]||[],o.plugins[n].push([i,s[n]])},call:function(t,e,i,s){var n,o=t.plugins[e];if(o&&(s||t.element[0].parentNode&&11!==t.element[0].parentNode.nodeType))for(n=0;o.length>n;n++)t.options[o[n][0]]&&o[n][1].apply(t.element,i)}},t.ui.safeBlur=function(e){e&&"body"!==e.nodeName.toLowerCase()&&t(e).trigger("blur")},t.widget("ui.draggable",t.ui.mouse,{version:"1.12.1",widgetEventPrefix:"drag",options:{addClasses:!0,appendTo:"parent",axis:!1,connectToSortable:!1,containment:!1,cursor:"auto",cursorAt:!1,grid:!1,handle:!1,helper:"original",iframeFix:!1,opacity:!1,refreshPositions:!1,revert:!1,revertDuration:500,scope:"default",scroll:!0,scrollSensitivity:20,scrollSpeed:20,snap:!1,snapMode:"both",snapTolerance:20,stack:!1,zIndex:!1,drag:null,start:null,stop:null},_create:function(){"original"===this.options.helper&&this._setPositionRelative(),this.options.addClasses&&this._addClass("ui-draggable"),this._setHandleClassName(),this._mouseInit()},_setOption:function(t,e){this._super(t,e),"handle"===t&&(this._removeHandleClassName(),this._setHandleClassName())},_destroy:function(){return(this.helper||this.element).is(".ui-draggable-dragging")?(this.destroyOnClear=!0,void 0):(this._removeHandleClassName(),this._mouseDestroy(),void 0)},_mouseCapture:function(e){var i=this.options;return this.helper||i.disabled||t(e.target).closest(".ui-resizable-handle").length>0?!1:(this.handle=this._getHandle(e),this.handle?(this._blurActiveElement(e),this._blockFrames(i.iframeFix===!0?"iframe":i.iframeFix),!0):!1)},_blockFrames:function(e){this.iframeBlocks=this.document.find(e).map(function(){var e=t(this);return t("<div>").css("position","absolute").appendTo(e.parent()).outerWidth(e.outerWidth()).outerHeight(e.outerHeight()).offset(e.offset())[0]})},_unblockFrames:function(){this.iframeBlocks&&(this.iframeBlocks.remove(),delete this.iframeBlocks)},_blurActiveElement:function(e){var i=t.ui.safeActiveElement(this.document[0]),s=t(e.target);s.closest(i).length||t.ui.safeBlur(i)},_mouseStart:function(e){var i=this.options;return this.helper=this._createHelper(e),this._addClass(this.helper,"ui-draggable-dragging"),this._cacheHelperProportions(),t.ui.ddmanager&&(t.ui.ddmanager.current=this),this._cacheMargins(),this.cssPosition=this.helper.css("position"),this.scrollParent=this.helper.scrollParent(!0),this.offsetParent=this.helper.offsetParent(),this.hasFixedAncestor=this.helper.parents().filter(function(){return"fixed"===t(this).css("position")}).length>0,this.positionAbs=this.element.offset(),this._refreshOffsets(e),this.originalPosition=this.position=this._generatePosition(e,!1),this.originalPageX=e.pageX,this.originalPageY=e.pageY,i.cursorAt&&this._adjustOffsetFromHelper(i.cursorAt),this._setContainment(),this._trigger("start",e)===!1?(this._clear(),!1):(this._cacheHelperProportions(),t.ui.ddmanager&&!i.dropBehaviour&&t.ui.ddmanager.prepareOffsets(this,e),this._mouseDrag(e,!0),t.ui.ddmanager&&t.ui.ddmanager.dragStart(this,e),!0)},_refreshOffsets:function(t){this.offset={top:this.positionAbs.top-this.margins.top,left:this.positionAbs.left-this.margins.left,scroll:!1,parent:this._getParentOffset(),relative:this._getRelativeOffset()},this.offset.click={left:t.pageX-this.offset.left,top:t.pageY-this.offset.top}},_mouseDrag:function(e,i){if(this.hasFixedAncestor&&(this.offset.parent=this._getParentOffset()),this.position=this._generatePosition(e,!0),this.positionAbs=this._convertPositionTo("absolute"),!i){var s=this._uiHash();if(this._trigger("drag",e,s)===!1)return this._mouseUp(new t.Event("mouseup",e)),!1;this.position=s.position}return this.helper[0].style.left=this.position.left+"px",this.helper[0].style.top=this.position.top+"px",t.ui.ddmanager&&t.ui.ddmanager.drag(this,e),!1},_mouseStop:function(e){var i=this,s=!1;return t.ui.ddmanager&&!this.options.dropBehaviour&&(s=t.ui.ddmanager.drop(this,e)),this.dropped&&(s=this.dropped,this.dropped=!1),"invalid"===this.options.revert&&!s||"valid"===this.options.revert&&s||this.options.revert===!0||t.isFunction(this.options.revert)&&this.options.revert.call(this.element,s)?t(this.helper).animate(this.originalPosition,parseInt(this.options.revertDuration,10),function(){i._trigger("stop",e)!==!1&&i._clear()}):this._trigger("stop",e)!==!1&&this._clear(),!1},_mouseUp:function(e){return this._unblockFrames(),t.ui.ddmanager&&t.ui.ddmanager.dragStop(this,e),this.handleElement.is(e.target)&&this.element.trigger("focus"),t.ui.mouse.prototype._mouseUp.call(this,e)},cancel:function(){return this.helper.is(".ui-draggable-dragging")?this._mouseUp(new t.Event("mouseup",{target:this.element[0]})):this._clear(),this},_getHandle:function(e){return this.options.handle?!!t(e.target).closest(this.element.find(this.options.handle)).length:!0},_setHandleClassName:function(){this.handleElement=this.options.handle?this.element.find(this.options.handle):this.element,this._addClass(this.handleElement,"ui-draggable-handle")},_removeHandleClassName:function(){this._removeClass(this.handleElement,"ui-draggable-handle")},_createHelper:function(e){var i=this.options,s=t.isFunction(i.helper),n=s?t(i.helper.apply(this.element[0],[e])):"clone"===i.helper?this.element.clone().removeAttr("id"):this.element;return n.parents("body").length||n.appendTo("parent"===i.appendTo?this.element[0].parentNode:i.appendTo),s&&n[0]===this.element[0]&&this._setPositionRelative(),n[0]===this.element[0]||/(fixed|absolute)/.test(n.css("position"))||n.css("position","absolute"),n},_setPositionRelative:function(){/^(?:r|a|f)/.test(this.element.css("position"))||(this.element[0].style.position="relative")},_adjustOffsetFromHelper:function(e){"string"==typeof e&&(e=e.split(" ")),t.isArray(e)&&(e={left:+e[0],top:+e[1]||0}),"left"in e&&(this.offset.click.left=e.left+this.margins.left),"right"in e&&(this.offset.click.left=this.helperProportions.width-e.right+this.margins.left),"top"in e&&(this.offset.click.top=e.top+this.margins.top),"bottom"in e&&(this.offset.click.top=this.helperProportions.height-e.bottom+this.margins.top)},_isRootNode:function(t){return/(html|body)/i.test(t.tagName)||t===this.document[0]},_getParentOffset:function(){var e=this.offsetParent.offset(),i=this.document[0];return"absolute"===this.cssPosition&&this.scrollParent[0]!==i&&t.contains(this.scrollParent[0],this.offsetParent[0])&&(e.left+=this.scrollParent.scrollLeft(),e.top+=this.scrollParent.scrollTop()),this._isRootNode(this.offsetParent[0])&&(e={top:0,left:0}),{top:e.top+(parseInt(this.offsetParent.css("borderTopWidth"),10)||0),left:e.left+(parseInt(this.offsetParent.css("borderLeftWidth"),10)||0)}},_getRelativeOffset:function(){if("relative"!==this.cssPosition)return{top:0,left:0};var t=this.element.position(),e=this._isRootNode(this.scrollParent[0]);return{top:t.top-(parseInt(this.helper.css("top"),10)||0)+(e?0:this.scrollParent.scrollTop()),left:t.left-(parseInt(this.helper.css("left"),10)||0)+(e?0:this.scrollParent.scrollLeft())}
},_cacheMargins:function(){this.margins={left:parseInt(this.element.css("marginLeft"),10)||0,top:parseInt(this.element.css("marginTop"),10)||0,right:parseInt(this.element.css("marginRight"),10)||0,bottom:parseInt(this.element.css("marginBottom"),10)||0}},_cacheHelperProportions:function(){this.helperProportions={width:this.helper.outerWidth(),height:this.helper.outerHeight()}},_setContainment:function(){var e,i,s,n=this.options,o=this.document[0];return this.relativeContainer=null,n.containment?"window"===n.containment?(this.containment=[t(window).scrollLeft()-this.offset.relative.left-this.offset.parent.left,t(window).scrollTop()-this.offset.relative.top-this.offset.parent.top,t(window).scrollLeft()+t(window).width()-this.helperProportions.width-this.margins.left,t(window).scrollTop()+(t(window).height()||o.body.parentNode.scrollHeight)-this.helperProportions.height-this.margins.top],void 0):"document"===n.containment?(this.containment=[0,0,t(o).width()-this.helperProportions.width-this.margins.left,999999],void 0):n.containment.constructor===Array?(this.containment=n.containment,void 0):("parent"===n.containment&&(n.containment=this.helper[0].parentNode),i=t(n.containment),s=i[0],s&&(e=/(scroll|auto)/.test(i.css("overflow")),this.containment=[(parseInt(i.css("borderLeftWidth"),10)||0)+(parseInt(i.css("paddingLeft"),10)||0),(parseInt(i.css("borderTopWidth"),10)||0)+(parseInt(i.css("paddingTop"),10)||0),(e?Math.max(s.scrollWidth,s.offsetWidth):s.offsetWidth)-(parseInt(i.css("borderRightWidth"),10)||0)-(parseInt(i.css("paddingRight"),10)||0)-this.helperProportions.width-this.margins.left-this.margins.right,(e?Math.max(s.scrollHeight,s.offsetHeight):s.offsetHeight)-(parseInt(i.css("borderBottomWidth"),10)||0)-(parseInt(i.css("paddingBottom"),10)||0)-this.helperProportions.height-this.margins.top-this.margins.bottom],this.relativeContainer=i),void 0):(this.containment=null,void 0)},_convertPositionTo:function(t,e){e||(e=this.position);var i="absolute"===t?1:-1,s=this._isRootNode(this.scrollParent[0]);return{top:e.top+this.offset.relative.top*i+this.offset.parent.top*i-("fixed"===this.cssPosition?-this.offset.scroll.top:s?0:this.offset.scroll.top)*i,left:e.left+this.offset.relative.left*i+this.offset.parent.left*i-("fixed"===this.cssPosition?-this.offset.scroll.left:s?0:this.offset.scroll.left)*i}},_generatePosition:function(t,e){var i,s,n,o,a=this.options,r=this._isRootNode(this.scrollParent[0]),h=t.pageX,l=t.pageY;return r&&this.offset.scroll||(this.offset.scroll={top:this.scrollParent.scrollTop(),left:this.scrollParent.scrollLeft()}),e&&(this.containment&&(this.relativeContainer?(s=this.relativeContainer.offset(),i=[this.containment[0]+s.left,this.containment[1]+s.top,this.containment[2]+s.left,this.containment[3]+s.top]):i=this.containment,t.pageX-this.offset.click.left<i[0]&&(h=i[0]+this.offset.click.left),t.pageY-this.offset.click.top<i[1]&&(l=i[1]+this.offset.click.top),t.pageX-this.offset.click.left>i[2]&&(h=i[2]+this.offset.click.left),t.pageY-this.offset.click.top>i[3]&&(l=i[3]+this.offset.click.top)),a.grid&&(n=a.grid[1]?this.originalPageY+Math.round((l-this.originalPageY)/a.grid[1])*a.grid[1]:this.originalPageY,l=i?n-this.offset.click.top>=i[1]||n-this.offset.click.top>i[3]?n:n-this.offset.click.top>=i[1]?n-a.grid[1]:n+a.grid[1]:n,o=a.grid[0]?this.originalPageX+Math.round((h-this.originalPageX)/a.grid[0])*a.grid[0]:this.originalPageX,h=i?o-this.offset.click.left>=i[0]||o-this.offset.click.left>i[2]?o:o-this.offset.click.left>=i[0]?o-a.grid[0]:o+a.grid[0]:o),"y"===a.axis&&(h=this.originalPageX),"x"===a.axis&&(l=this.originalPageY)),{top:l-this.offset.click.top-this.offset.relative.top-this.offset.parent.top+("fixed"===this.cssPosition?-this.offset.scroll.top:r?0:this.offset.scroll.top),left:h-this.offset.click.left-this.offset.relative.left-this.offset.parent.left+("fixed"===this.cssPosition?-this.offset.scroll.left:r?0:this.offset.scroll.left)}},_clear:function(){this._removeClass(this.helper,"ui-draggable-dragging"),this.helper[0]===this.element[0]||this.cancelHelperRemoval||this.helper.remove(),this.helper=null,this.cancelHelperRemoval=!1,this.destroyOnClear&&this.destroy()},_trigger:function(e,i,s){return s=s||this._uiHash(),t.ui.plugin.call(this,e,[i,s,this],!0),/^(drag|start|stop)/.test(e)&&(this.positionAbs=this._convertPositionTo("absolute"),s.offset=this.positionAbs),t.Widget.prototype._trigger.call(this,e,i,s)},plugins:{},_uiHash:function(){return{helper:this.helper,position:this.position,originalPosition:this.originalPosition,offset:this.positionAbs}}}),t.ui.plugin.add("draggable","connectToSortable",{start:function(e,i,s){var n=t.extend({},i,{item:s.element});s.sortables=[],t(s.options.connectToSortable).each(function(){var i=t(this).sortable("instance");i&&!i.options.disabled&&(s.sortables.push(i),i.refreshPositions(),i._trigger("activate",e,n))})},stop:function(e,i,s){var n=t.extend({},i,{item:s.element});s.cancelHelperRemoval=!1,t.each(s.sortables,function(){var t=this;t.isOver?(t.isOver=0,s.cancelHelperRemoval=!0,t.cancelHelperRemoval=!1,t._storedCSS={position:t.placeholder.css("position"),top:t.placeholder.css("top"),left:t.placeholder.css("left")},t._mouseStop(e),t.options.helper=t.options._helper):(t.cancelHelperRemoval=!0,t._trigger("deactivate",e,n))})},drag:function(e,i,s){t.each(s.sortables,function(){var n=!1,o=this;o.positionAbs=s.positionAbs,o.helperProportions=s.helperProportions,o.offset.click=s.offset.click,o._intersectsWith(o.containerCache)&&(n=!0,t.each(s.sortables,function(){return this.positionAbs=s.positionAbs,this.helperProportions=s.helperProportions,this.offset.click=s.offset.click,this!==o&&this._intersectsWith(this.containerCache)&&t.contains(o.element[0],this.element[0])&&(n=!1),n})),n?(o.isOver||(o.isOver=1,s._parent=i.helper.parent(),o.currentItem=i.helper.appendTo(o.element).data("ui-sortable-item",!0),o.options._helper=o.options.helper,o.options.helper=function(){return i.helper[0]},e.target=o.currentItem[0],o._mouseCapture(e,!0),o._mouseStart(e,!0,!0),o.offset.click.top=s.offset.click.top,o.offset.click.left=s.offset.click.left,o.offset.parent.left-=s.offset.parent.left-o.offset.parent.left,o.offset.parent.top-=s.offset.parent.top-o.offset.parent.top,s._trigger("toSortable",e),s.dropped=o.element,t.each(s.sortables,function(){this.refreshPositions()}),s.currentItem=s.element,o.fromOutside=s),o.currentItem&&(o._mouseDrag(e),i.position=o.position)):o.isOver&&(o.isOver=0,o.cancelHelperRemoval=!0,o.options._revert=o.options.revert,o.options.revert=!1,o._trigger("out",e,o._uiHash(o)),o._mouseStop(e,!0),o.options.revert=o.options._revert,o.options.helper=o.options._helper,o.placeholder&&o.placeholder.remove(),i.helper.appendTo(s._parent),s._refreshOffsets(e),i.position=s._generatePosition(e,!0),s._trigger("fromSortable",e),s.dropped=!1,t.each(s.sortables,function(){this.refreshPositions()}))})}}),t.ui.plugin.add("draggable","cursor",{start:function(e,i,s){var n=t("body"),o=s.options;n.css("cursor")&&(o._cursor=n.css("cursor")),n.css("cursor",o.cursor)},stop:function(e,i,s){var n=s.options;n._cursor&&t("body").css("cursor",n._cursor)}}),t.ui.plugin.add("draggable","opacity",{start:function(e,i,s){var n=t(i.helper),o=s.options;n.css("opacity")&&(o._opacity=n.css("opacity")),n.css("opacity",o.opacity)},stop:function(e,i,s){var n=s.options;n._opacity&&t(i.helper).css("opacity",n._opacity)}}),t.ui.plugin.add("draggable","scroll",{start:function(t,e,i){i.scrollParentNotHidden||(i.scrollParentNotHidden=i.helper.scrollParent(!1)),i.scrollParentNotHidden[0]!==i.document[0]&&"HTML"!==i.scrollParentNotHidden[0].tagName&&(i.overflowOffset=i.scrollParentNotHidden.offset())},drag:function(e,i,s){var n=s.options,o=!1,a=s.scrollParentNotHidden[0],r=s.document[0];a!==r&&"HTML"!==a.tagName?(n.axis&&"x"===n.axis||(s.overflowOffset.top+a.offsetHeight-e.pageY<n.scrollSensitivity?a.scrollTop=o=a.scrollTop+n.scrollSpeed:e.pageY-s.overflowOffset.top<n.scrollSensitivity&&(a.scrollTop=o=a.scrollTop-n.scrollSpeed)),n.axis&&"y"===n.axis||(s.overflowOffset.left+a.offsetWidth-e.pageX<n.scrollSensitivity?a.scrollLeft=o=a.scrollLeft+n.scrollSpeed:e.pageX-s.overflowOffset.left<n.scrollSensitivity&&(a.scrollLeft=o=a.scrollLeft-n.scrollSpeed))):(n.axis&&"x"===n.axis||(e.pageY-t(r).scrollTop()<n.scrollSensitivity?o=t(r).scrollTop(t(r).scrollTop()-n.scrollSpeed):t(window).height()-(e.pageY-t(r).scrollTop())<n.scrollSensitivity&&(o=t(r).scrollTop(t(r).scrollTop()+n.scrollSpeed))),n.axis&&"y"===n.axis||(e.pageX-t(r).scrollLeft()<n.scrollSensitivity?o=t(r).scrollLeft(t(r).scrollLeft()-n.scrollSpeed):t(window).width()-(e.pageX-t(r).scrollLeft())<n.scrollSensitivity&&(o=t(r).scrollLeft(t(r).scrollLeft()+n.scrollSpeed)))),o!==!1&&t.ui.ddmanager&&!n.dropBehaviour&&t.ui.ddmanager.prepareOffsets(s,e)}}),t.ui.plugin.add("draggable","snap",{start:function(e,i,s){var n=s.options;s.snapElements=[],t(n.snap.constructor!==String?n.snap.items||":data(ui-draggable)":n.snap).each(function(){var e=t(this),i=e.offset();this!==s.element[0]&&s.snapElements.push({item:this,width:e.outerWidth(),height:e.outerHeight(),top:i.top,left:i.left})})},drag:function(e,i,s){var n,o,a,r,h,l,c,u,d,p,f=s.options,g=f.snapTolerance,m=i.offset.left,_=m+s.helperProportions.width,v=i.offset.top,b=v+s.helperProportions.height;for(d=s.snapElements.length-1;d>=0;d--)h=s.snapElements[d].left-s.margins.left,l=h+s.snapElements[d].width,c=s.snapElements[d].top-s.margins.top,u=c+s.snapElements[d].height,h-g>_||m>l+g||c-g>b||v>u+g||!t.contains(s.snapElements[d].item.ownerDocument,s.snapElements[d].item)?(s.snapElements[d].snapping&&s.options.snap.release&&s.options.snap.release.call(s.element,e,t.extend(s._uiHash(),{snapItem:s.snapElements[d].item})),s.snapElements[d].snapping=!1):("inner"!==f.snapMode&&(n=g>=Math.abs(c-b),o=g>=Math.abs(u-v),a=g>=Math.abs(h-_),r=g>=Math.abs(l-m),n&&(i.position.top=s._convertPositionTo("relative",{top:c-s.helperProportions.height,left:0}).top),o&&(i.position.top=s._convertPositionTo("relative",{top:u,left:0}).top),a&&(i.position.left=s._convertPositionTo("relative",{top:0,left:h-s.helperProportions.width}).left),r&&(i.position.left=s._convertPositionTo("relative",{top:0,left:l}).left)),p=n||o||a||r,"outer"!==f.snapMode&&(n=g>=Math.abs(c-v),o=g>=Math.abs(u-b),a=g>=Math.abs(h-m),r=g>=Math.abs(l-_),n&&(i.position.top=s._convertPositionTo("relative",{top:c,left:0}).top),o&&(i.position.top=s._convertPositionTo("relative",{top:u-s.helperProportions.height,left:0}).top),a&&(i.position.left=s._convertPositionTo("relative",{top:0,left:h}).left),r&&(i.position.left=s._convertPositionTo("relative",{top:0,left:l-s.helperProportions.width}).left)),!s.snapElements[d].snapping&&(n||o||a||r||p)&&s.options.snap.snap&&s.options.snap.snap.call(s.element,e,t.extend(s._uiHash(),{snapItem:s.snapElements[d].item})),s.snapElements[d].snapping=n||o||a||r||p)}}),t.ui.plugin.add("draggable","stack",{start:function(e,i,s){var n,o=s.options,a=t.makeArray(t(o.stack)).sort(function(e,i){return(parseInt(t(e).css("zIndex"),10)||0)-(parseInt(t(i).css("zIndex"),10)||0)});a.length&&(n=parseInt(t(a[0]).css("zIndex"),10)||0,t(a).each(function(e){t(this).css("zIndex",n+e)}),this.css("zIndex",n+a.length))}}),t.ui.plugin.add("draggable","zIndex",{start:function(e,i,s){var n=t(i.helper),o=s.options;n.css("zIndex")&&(o._zIndex=n.css("zIndex")),n.css("zIndex",o.zIndex)},stop:function(e,i,s){var n=s.options;n._zIndex&&t(i.helper).css("zIndex",n._zIndex)}}),t.ui.draggable,t.widget("ui.resizable",t.ui.mouse,{version:"1.12.1",widgetEventPrefix:"resize",options:{alsoResize:!1,animate:!1,animateDuration:"slow",animateEasing:"swing",aspectRatio:!1,autoHide:!1,classes:{"ui-resizable-se":"ui-icon ui-icon-gripsmall-diagonal-se"},containment:!1,ghost:!1,grid:!1,handles:"e,s,se",helper:!1,maxHeight:null,maxWidth:null,minHeight:10,minWidth:10,zIndex:90,resize:null,start:null,stop:null},_num:function(t){return parseFloat(t)||0},_isNumber:function(t){return!isNaN(parseFloat(t))},_hasScroll:function(e,i){if("hidden"===t(e).css("overflow"))return!1;var s=i&&"left"===i?"scrollLeft":"scrollTop",n=!1;return e[s]>0?!0:(e[s]=1,n=e[s]>0,e[s]=0,n)},_create:function(){var e,i=this.options,s=this;this._addClass("ui-resizable"),t.extend(this,{_aspectRatio:!!i.aspectRatio,aspectRatio:i.aspectRatio,originalElement:this.element,_proportionallyResizeElements:[],_helper:i.helper||i.ghost||i.animate?i.helper||"ui-resizable-helper":null}),this.element[0].nodeName.match(/^(canvas|textarea|input|select|button|img)$/i)&&(this.element.wrap(t("<div class='ui-wrapper' style='overflow: hidden;'></div>").css({position:this.element.css("position"),width:this.element.outerWidth(),height:this.element.outerHeight(),top:this.element.css("top"),left:this.element.css("left")})),this.element=this.element.parent().data("ui-resizable",this.element.resizable("instance")),this.elementIsWrapper=!0,e={marginTop:this.originalElement.css("marginTop"),marginRight:this.originalElement.css("marginRight"),marginBottom:this.originalElement.css("marginBottom"),marginLeft:this.originalElement.css("marginLeft")},this.element.css(e),this.originalElement.css("margin",0),this.originalResizeStyle=this.originalElement.css("resize"),this.originalElement.css("resize","none"),this._proportionallyResizeElements.push(this.originalElement.css({position:"static",zoom:1,display:"block"})),this.originalElement.css(e),this._proportionallyResize()),this._setupHandles(),i.autoHide&&t(this.element).on("mouseenter",function(){i.disabled||(s._removeClass("ui-resizable-autohide"),s._handles.show())}).on("mouseleave",function(){i.disabled||s.resizing||(s._addClass("ui-resizable-autohide"),s._handles.hide())}),this._mouseInit()},_destroy:function(){this._mouseDestroy();var e,i=function(e){t(e).removeData("resizable").removeData("ui-resizable").off(".resizable").find(".ui-resizable-handle").remove()};return this.elementIsWrapper&&(i(this.element),e=this.element,this.originalElement.css({position:e.css("position"),width:e.outerWidth(),height:e.outerHeight(),top:e.css("top"),left:e.css("left")}).insertAfter(e),e.remove()),this.originalElement.css("resize",this.originalResizeStyle),i(this.originalElement),this},_setOption:function(t,e){switch(this._super(t,e),t){case"handles":this._removeHandles(),this._setupHandles();break;default:}},_setupHandles:function(){var e,i,s,n,o,a=this.options,r=this;if(this.handles=a.handles||(t(".ui-resizable-handle",this.element).length?{n:".ui-resizable-n",e:".ui-resizable-e",s:".ui-resizable-s",w:".ui-resizable-w",se:".ui-resizable-se",sw:".ui-resizable-sw",ne:".ui-resizable-ne",nw:".ui-resizable-nw"}:"e,s,se"),this._handles=t(),this.handles.constructor===String)for("all"===this.handles&&(this.handles="n,e,s,w,se,sw,ne,nw"),s=this.handles.split(","),this.handles={},i=0;s.length>i;i++)e=t.trim(s[i]),n="ui-resizable-"+e,o=t("<div>"),this._addClass(o,"ui-resizable-handle "+n),o.css({zIndex:a.zIndex}),this.handles[e]=".ui-resizable-"+e,this.element.append(o);this._renderAxis=function(e){var i,s,n,o;e=e||this.element;for(i in this.handles)this.handles[i].constructor===String?this.handles[i]=this.element.children(this.handles[i]).first().show():(this.handles[i].jquery||this.handles[i].nodeType)&&(this.handles[i]=t(this.handles[i]),this._on(this.handles[i],{mousedown:r._mouseDown})),this.elementIsWrapper&&this.originalElement[0].nodeName.match(/^(textarea|input|select|button)$/i)&&(s=t(this.handles[i],this.element),o=/sw|ne|nw|se|n|s/.test(i)?s.outerHeight():s.outerWidth(),n=["padding",/ne|nw|n/.test(i)?"Top":/se|sw|s/.test(i)?"Bottom":/^e$/.test(i)?"Right":"Left"].join(""),e.css(n,o),this._proportionallyResize()),this._handles=this._handles.add(this.handles[i])},this._renderAxis(this.element),this._handles=this._handles.add(this.element.find(".ui-resizable-handle")),this._handles.disableSelection(),this._handles.on("mouseover",function(){r.resizing||(this.className&&(o=this.className.match(/ui-resizable-(se|sw|ne|nw|n|e|s|w)/i)),r.axis=o&&o[1]?o[1]:"se")}),a.autoHide&&(this._handles.hide(),this._addClass("ui-resizable-autohide"))},_removeHandles:function(){this._handles.remove()},_mouseCapture:function(e){var i,s,n=!1;for(i in this.handles)s=t(this.handles[i])[0],(s===e.target||t.contains(s,e.target))&&(n=!0);return!this.options.disabled&&n},_mouseStart:function(e){var i,s,n,o=this.options,a=this.element;return this.resizing=!0,this._renderProxy(),i=this._num(this.helper.css("left")),s=this._num(this.helper.css("top")),o.containment&&(i+=t(o.containment).scrollLeft()||0,s+=t(o.containment).scrollTop()||0),this.offset=this.helper.offset(),this.position={left:i,top:s},this.size=this._helper?{width:this.helper.width(),height:this.helper.height()}:{width:a.width(),height:a.height()},this.originalSize=this._helper?{width:a.outerWidth(),height:a.outerHeight()}:{width:a.width(),height:a.height()},this.sizeDiff={width:a.outerWidth()-a.width(),height:a.outerHeight()-a.height()},this.originalPosition={left:i,top:s},this.originalMousePosition={left:e.pageX,top:e.pageY},this.aspectRatio="number"==typeof o.aspectRatio?o.aspectRatio:this.originalSize.width/this.originalSize.height||1,n=t(".ui-resizable-"+this.axis).css("cursor"),t("body").css("cursor","auto"===n?this.axis+"-resize":n),this._addClass("ui-resizable-resizing"),this._propagate("start",e),!0},_mouseDrag:function(e){var i,s,n=this.originalMousePosition,o=this.axis,a=e.pageX-n.left||0,r=e.pageY-n.top||0,h=this._change[o];return this._updatePrevProperties(),h?(i=h.apply(this,[e,a,r]),this._updateVirtualBoundaries(e.shiftKey),(this._aspectRatio||e.shiftKey)&&(i=this._updateRatio(i,e)),i=this._respectSize(i,e),this._updateCache(i),this._propagate("resize",e),s=this._applyChanges(),!this._helper&&this._proportionallyResizeElements.length&&this._proportionallyResize(),t.isEmptyObject(s)||(this._updatePrevProperties(),this._trigger("resize",e,this.ui()),this._applyChanges()),!1):!1},_mouseStop:function(e){this.resizing=!1;var i,s,n,o,a,r,h,l=this.options,c=this;return this._helper&&(i=this._proportionallyResizeElements,s=i.length&&/textarea/i.test(i[0].nodeName),n=s&&this._hasScroll(i[0],"left")?0:c.sizeDiff.height,o=s?0:c.sizeDiff.width,a={width:c.helper.width()-o,height:c.helper.height()-n},r=parseFloat(c.element.css("left"))+(c.position.left-c.originalPosition.left)||null,h=parseFloat(c.element.css("top"))+(c.position.top-c.originalPosition.top)||null,l.animate||this.element.css(t.extend(a,{top:h,left:r})),c.helper.height(c.size.height),c.helper.width(c.size.width),this._helper&&!l.animate&&this._proportionallyResize()),t("body").css("cursor","auto"),this._removeClass("ui-resizable-resizing"),this._propagate("stop",e),this._helper&&this.helper.remove(),!1},_updatePrevProperties:function(){this.prevPosition={top:this.position.top,left:this.position.left},this.prevSize={width:this.size.width,height:this.size.height}},_applyChanges:function(){var t={};return this.position.top!==this.prevPosition.top&&(t.top=this.position.top+"px"),this.position.left!==this.prevPosition.left&&(t.left=this.position.left+"px"),this.size.width!==this.prevSize.width&&(t.width=this.size.width+"px"),this.size.height!==this.prevSize.height&&(t.height=this.size.height+"px"),this.helper.css(t),t},_updateVirtualBoundaries:function(t){var e,i,s,n,o,a=this.options;o={minWidth:this._isNumber(a.minWidth)?a.minWidth:0,maxWidth:this._isNumber(a.maxWidth)?a.maxWidth:1/0,minHeight:this._isNumber(a.minHeight)?a.minHeight:0,maxHeight:this._isNumber(a.maxHeight)?a.maxHeight:1/0},(this._aspectRatio||t)&&(e=o.minHeight*this.aspectRatio,s=o.minWidth/this.aspectRatio,i=o.maxHeight*this.aspectRatio,n=o.maxWidth/this.aspectRatio,e>o.minWidth&&(o.minWidth=e),s>o.minHeight&&(o.minHeight=s),o.maxWidth>i&&(o.maxWidth=i),o.maxHeight>n&&(o.maxHeight=n)),this._vBoundaries=o},_updateCache:function(t){this.offset=this.helper.offset(),this._isNumber(t.left)&&(this.position.left=t.left),this._isNumber(t.top)&&(this.position.top=t.top),this._isNumber(t.height)&&(this.size.height=t.height),this._isNumber(t.width)&&(this.size.width=t.width)},_updateRatio:function(t){var e=this.position,i=this.size,s=this.axis;return this._isNumber(t.height)?t.width=t.height*this.aspectRatio:this._isNumber(t.width)&&(t.height=t.width/this.aspectRatio),"sw"===s&&(t.left=e.left+(i.width-t.width),t.top=null),"nw"===s&&(t.top=e.top+(i.height-t.height),t.left=e.left+(i.width-t.width)),t},_respectSize:function(t){var e=this._vBoundaries,i=this.axis,s=this._isNumber(t.width)&&e.maxWidth&&e.maxWidth<t.width,n=this._isNumber(t.height)&&e.maxHeight&&e.maxHeight<t.height,o=this._isNumber(t.width)&&e.minWidth&&e.minWidth>t.width,a=this._isNumber(t.height)&&e.minHeight&&e.minHeight>t.height,r=this.originalPosition.left+this.originalSize.width,h=this.originalPosition.top+this.originalSize.height,l=/sw|nw|w/.test(i),c=/nw|ne|n/.test(i);return o&&(t.width=e.minWidth),a&&(t.height=e.minHeight),s&&(t.width=e.maxWidth),n&&(t.height=e.maxHeight),o&&l&&(t.left=r-e.minWidth),s&&l&&(t.left=r-e.maxWidth),a&&c&&(t.top=h-e.minHeight),n&&c&&(t.top=h-e.maxHeight),t.width||t.height||t.left||!t.top?t.width||t.height||t.top||!t.left||(t.left=null):t.top=null,t},_getPaddingPlusBorderDimensions:function(t){for(var e=0,i=[],s=[t.css("borderTopWidth"),t.css("borderRightWidth"),t.css("borderBottomWidth"),t.css("borderLeftWidth")],n=[t.css("paddingTop"),t.css("paddingRight"),t.css("paddingBottom"),t.css("paddingLeft")];4>e;e++)i[e]=parseFloat(s[e])||0,i[e]+=parseFloat(n[e])||0;return{height:i[0]+i[2],width:i[1]+i[3]}},_proportionallyResize:function(){if(this._proportionallyResizeElements.length)for(var t,e=0,i=this.helper||this.element;this._proportionallyResizeElements.length>e;e++)t=this._proportionallyResizeElements[e],this.outerDimensions||(this.outerDimensions=this._getPaddingPlusBorderDimensions(t)),t.css({height:i.height()-this.outerDimensions.height||0,width:i.width()-this.outerDimensions.width||0})},_renderProxy:function(){var e=this.element,i=this.options;this.elementOffset=e.offset(),this._helper?(this.helper=this.helper||t("<div style='overflow:hidden;'></div>"),this._addClass(this.helper,this._helper),this.helper.css({width:this.element.outerWidth(),height:this.element.outerHeight(),position:"absolute",left:this.elementOffset.left+"px",top:this.elementOffset.top+"px",zIndex:++i.zIndex}),this.helper.appendTo("body").disableSelection()):this.helper=this.element},_change:{e:function(t,e){return{width:this.originalSize.width+e}},w:function(t,e){var i=this.originalSize,s=this.originalPosition;return{left:s.left+e,width:i.width-e}},n:function(t,e,i){var s=this.originalSize,n=this.originalPosition;return{top:n.top+i,height:s.height-i}},s:function(t,e,i){return{height:this.originalSize.height+i}},se:function(e,i,s){return t.extend(this._change.s.apply(this,arguments),this._change.e.apply(this,[e,i,s]))},sw:function(e,i,s){return t.extend(this._change.s.apply(this,arguments),this._change.w.apply(this,[e,i,s]))},ne:function(e,i,s){return t.extend(this._change.n.apply(this,arguments),this._change.e.apply(this,[e,i,s]))},nw:function(e,i,s){return t.extend(this._change.n.apply(this,arguments),this._change.w.apply(this,[e,i,s]))}},_propagate:function(e,i){t.ui.plugin.call(this,e,[i,this.ui()]),"resize"!==e&&this._trigger(e,i,this.ui())},plugins:{},ui:function(){return{originalElement:this.originalElement,element:this.element,helper:this.helper,position:this.position,size:this.size,originalSize:this.originalSize,originalPosition:this.originalPosition}}}),t.ui.plugin.add("resizable","animate",{stop:function(e){var i=t(this).resizable("instance"),s=i.options,n=i._proportionallyResizeElements,o=n.length&&/textarea/i.test(n[0].nodeName),a=o&&i._hasScroll(n[0],"left")?0:i.sizeDiff.height,r=o?0:i.sizeDiff.width,h={width:i.size.width-r,height:i.size.height-a},l=parseFloat(i.element.css("left"))+(i.position.left-i.originalPosition.left)||null,c=parseFloat(i.element.css("top"))+(i.position.top-i.originalPosition.top)||null;i.element.animate(t.extend(h,c&&l?{top:c,left:l}:{}),{duration:s.animateDuration,easing:s.animateEasing,step:function(){var s={width:parseFloat(i.element.css("width")),height:parseFloat(i.element.css("height")),top:parseFloat(i.element.css("top")),left:parseFloat(i.element.css("left"))};n&&n.length&&t(n[0]).css({width:s.width,height:s.height}),i._updateCache(s),i._propagate("resize",e)}})}}),t.ui.plugin.add("resizable","containment",{start:function(){var e,i,s,n,o,a,r,h=t(this).resizable("instance"),l=h.options,c=h.element,u=l.containment,d=u instanceof t?u.get(0):/parent/.test(u)?c.parent().get(0):u;d&&(h.containerElement=t(d),/document/.test(u)||u===document?(h.containerOffset={left:0,top:0},h.containerPosition={left:0,top:0},h.parentData={element:t(document),left:0,top:0,width:t(document).width(),height:t(document).height()||document.body.parentNode.scrollHeight}):(e=t(d),i=[],t(["Top","Right","Left","Bottom"]).each(function(t,s){i[t]=h._num(e.css("padding"+s))}),h.containerOffset=e.offset(),h.containerPosition=e.position(),h.containerSize={height:e.innerHeight()-i[3],width:e.innerWidth()-i[1]},s=h.containerOffset,n=h.containerSize.height,o=h.containerSize.width,a=h._hasScroll(d,"left")?d.scrollWidth:o,r=h._hasScroll(d)?d.scrollHeight:n,h.parentData={element:d,left:s.left,top:s.top,width:a,height:r}))},resize:function(e){var i,s,n,o,a=t(this).resizable("instance"),r=a.options,h=a.containerOffset,l=a.position,c=a._aspectRatio||e.shiftKey,u={top:0,left:0},d=a.containerElement,p=!0;d[0]!==document&&/static/.test(d.css("position"))&&(u=h),l.left<(a._helper?h.left:0)&&(a.size.width=a.size.width+(a._helper?a.position.left-h.left:a.position.left-u.left),c&&(a.size.height=a.size.width/a.aspectRatio,p=!1),a.position.left=r.helper?h.left:0),l.top<(a._helper?h.top:0)&&(a.size.height=a.size.height+(a._helper?a.position.top-h.top:a.position.top),c&&(a.size.width=a.size.height*a.aspectRatio,p=!1),a.position.top=a._helper?h.top:0),n=a.containerElement.get(0)===a.element.parent().get(0),o=/relative|absolute/.test(a.containerElement.css("position")),n&&o?(a.offset.left=a.parentData.left+a.position.left,a.offset.top=a.parentData.top+a.position.top):(a.offset.left=a.element.offset().left,a.offset.top=a.element.offset().top),i=Math.abs(a.sizeDiff.width+(a._helper?a.offset.left-u.left:a.offset.left-h.left)),s=Math.abs(a.sizeDiff.height+(a._helper?a.offset.top-u.top:a.offset.top-h.top)),i+a.size.width>=a.parentData.width&&(a.size.width=a.parentData.width-i,c&&(a.size.height=a.size.width/a.aspectRatio,p=!1)),s+a.size.height>=a.parentData.height&&(a.size.height=a.parentData.height-s,c&&(a.size.width=a.size.height*a.aspectRatio,p=!1)),p||(a.position.left=a.prevPosition.left,a.position.top=a.prevPosition.top,a.size.width=a.prevSize.width,a.size.height=a.prevSize.height)},stop:function(){var e=t(this).resizable("instance"),i=e.options,s=e.containerOffset,n=e.containerPosition,o=e.containerElement,a=t(e.helper),r=a.offset(),h=a.outerWidth()-e.sizeDiff.width,l=a.outerHeight()-e.sizeDiff.height;e._helper&&!i.animate&&/relative/.test(o.css("position"))&&t(this).css({left:r.left-n.left-s.left,width:h,height:l}),e._helper&&!i.animate&&/static/.test(o.css("position"))&&t(this).css({left:r.left-n.left-s.left,width:h,height:l})}}),t.ui.plugin.add("resizable","alsoResize",{start:function(){var e=t(this).resizable("instance"),i=e.options;t(i.alsoResize).each(function(){var e=t(this);e.data("ui-resizable-alsoresize",{width:parseFloat(e.width()),height:parseFloat(e.height()),left:parseFloat(e.css("left")),top:parseFloat(e.css("top"))})})},resize:function(e,i){var s=t(this).resizable("instance"),n=s.options,o=s.originalSize,a=s.originalPosition,r={height:s.size.height-o.height||0,width:s.size.width-o.width||0,top:s.position.top-a.top||0,left:s.position.left-a.left||0};t(n.alsoResize).each(function(){var e=t(this),s=t(this).data("ui-resizable-alsoresize"),n={},o=e.parents(i.originalElement[0]).length?["width","height"]:["width","height","top","left"];t.each(o,function(t,e){var i=(s[e]||0)+(r[e]||0);i&&i>=0&&(n[e]=i||null)}),e.css(n)})},stop:function(){t(this).removeData("ui-resizable-alsoresize")}}),t.ui.plugin.add("resizable","ghost",{start:function(){var e=t(this).resizable("instance"),i=e.size;e.ghost=e.originalElement.clone(),e.ghost.css({opacity:.25,display:"block",position:"relative",height:i.height,width:i.width,margin:0,left:0,top:0}),e._addClass(e.ghost,"ui-resizable-ghost"),t.uiBackCompat!==!1&&"string"==typeof e.options.ghost&&e.ghost.addClass(this.options.ghost),e.ghost.appendTo(e.helper)},resize:function(){var e=t(this).resizable("instance");e.ghost&&e.ghost.css({position:"relative",height:e.size.height,width:e.size.width})},stop:function(){var e=t(this).resizable("instance");e.ghost&&e.helper&&e.helper.get(0).removeChild(e.ghost.get(0))}}),t.ui.plugin.add("resizable","grid",{resize:function(){var e,i=t(this).resizable("instance"),s=i.options,n=i.size,o=i.originalSize,a=i.originalPosition,r=i.axis,h="number"==typeof s.grid?[s.grid,s.grid]:s.grid,l=h[0]||1,c=h[1]||1,u=Math.round((n.width-o.width)/l)*l,d=Math.round((n.height-o.height)/c)*c,p=o.width+u,f=o.height+d,g=s.maxWidth&&p>s.maxWidth,m=s.maxHeight&&f>s.maxHeight,_=s.minWidth&&s.minWidth>p,v=s.minHeight&&s.minHeight>f;s.grid=h,_&&(p+=l),v&&(f+=c),g&&(p-=l),m&&(f-=c),/^(se|s|e)$/.test(r)?(i.size.width=p,i.size.height=f):/^(ne)$/.test(r)?(i.size.width=p,i.size.height=f,i.position.top=a.top-d):/^(sw)$/.test(r)?(i.size.width=p,i.size.height=f,i.position.left=a.left-u):((0>=f-c||0>=p-l)&&(e=i._getPaddingPlusBorderDimensions(this)),f-c>0?(i.size.height=f,i.position.top=a.top-d):(f=c-e.height,i.size.height=f,i.position.top=a.top+o.height-f),p-l>0?(i.size.width=p,i.position.left=a.left-u):(p=l-e.width,i.size.width=p,i.position.left=a.left+o.width-p))}}),t.ui.resizable,t.widget("ui.dialog",{version:"1.12.1",options:{appendTo:"body",autoOpen:!0,buttons:[],classes:{"ui-dialog":"ui-corner-all","ui-dialog-titlebar":"ui-corner-all"},closeOnEscape:!0,closeText:"Close",draggable:!0,hide:null,height:"auto",maxHeight:null,maxWidth:null,minHeight:150,minWidth:150,modal:!1,position:{my:"center",at:"center",of:window,collision:"fit",using:function(e){var i=t(this).css(e).offset().top;0>i&&t(this).css("top",e.top-i)}},resizable:!0,show:null,title:null,width:300,beforeClose:null,close:null,drag:null,dragStart:null,dragStop:null,focus:null,open:null,resize:null,resizeStart:null,resizeStop:null},sizeRelatedOptions:{buttons:!0,height:!0,maxHeight:!0,maxWidth:!0,minHeight:!0,minWidth:!0,width:!0},resizableRelatedOptions:{maxHeight:!0,maxWidth:!0,minHeight:!0,minWidth:!0},_create:function(){this.originalCss={display:this.element[0].style.display,width:this.element[0].style.width,minHeight:this.element[0].style.minHeight,maxHeight:this.element[0].style.maxHeight,height:this.element[0].style.height},this.originalPosition={parent:this.element.parent(),index:this.element.parent().children().index(this.element)},this.originalTitle=this.element.attr("title"),null==this.options.title&&null!=this.originalTitle&&(this.options.title=this.originalTitle),this.options.disabled&&(this.options.disabled=!1),this._createWrapper(),this.element.show().removeAttr("title").appendTo(this.uiDialog),this._addClass("ui-dialog-content","ui-widget-content"),this._createTitlebar(),this._createButtonPane(),this.options.draggable&&t.fn.draggable&&this._makeDraggable(),this.options.resizable&&t.fn.resizable&&this._makeResizable(),this._isOpen=!1,this._trackFocus()},_init:function(){this.options.autoOpen&&this.open()},_appendTo:function(){var e=this.options.appendTo;return e&&(e.jquery||e.nodeType)?t(e):this.document.find(e||"body").eq(0)},_destroy:function(){var t,e=this.originalPosition;this._untrackInstance(),this._destroyOverlay(),this.element.removeUniqueId().css(this.originalCss).detach(),this.uiDialog.remove(),this.originalTitle&&this.element.attr("title",this.originalTitle),t=e.parent.children().eq(e.index),t.length&&t[0]!==this.element[0]?t.before(this.element):e.parent.append(this.element)},widget:function(){return this.uiDialog
},disable:t.noop,enable:t.noop,close:function(e){var i=this;this._isOpen&&this._trigger("beforeClose",e)!==!1&&(this._isOpen=!1,this._focusedElement=null,this._destroyOverlay(),this._untrackInstance(),this.opener.filter(":focusable").trigger("focus").length||t.ui.safeBlur(t.ui.safeActiveElement(this.document[0])),this._hide(this.uiDialog,this.options.hide,function(){i._trigger("close",e)}))},isOpen:function(){return this._isOpen},moveToTop:function(){this._moveToTop()},_moveToTop:function(e,i){var s=!1,n=this.uiDialog.siblings(".ui-front:visible").map(function(){return+t(this).css("z-index")}).get(),o=Math.max.apply(null,n);return o>=+this.uiDialog.css("z-index")&&(this.uiDialog.css("z-index",o+1),s=!0),s&&!i&&this._trigger("focus",e),s},open:function(){var e=this;return this._isOpen?(this._moveToTop()&&this._focusTabbable(),void 0):(this._isOpen=!0,this.opener=t(t.ui.safeActiveElement(this.document[0])),this._size(),this._position(),this._createOverlay(),this._moveToTop(null,!0),this.overlay&&this.overlay.css("z-index",this.uiDialog.css("z-index")-1),this._show(this.uiDialog,this.options.show,function(){e._focusTabbable(),e._trigger("focus")}),this._makeFocusTarget(),this._trigger("open"),void 0)},_focusTabbable:function(){var t=this._focusedElement;t||(t=this.element.find("[autofocus]")),t.length||(t=this.element.find(":tabbable")),t.length||(t=this.uiDialogButtonPane.find(":tabbable")),t.length||(t=this.uiDialogTitlebarClose.filter(":tabbable")),t.length||(t=this.uiDialog),t.eq(0).trigger("focus")},_keepFocus:function(e){function i(){var e=t.ui.safeActiveElement(this.document[0]),i=this.uiDialog[0]===e||t.contains(this.uiDialog[0],e);i||this._focusTabbable()}e.preventDefault(),i.call(this),this._delay(i)},_createWrapper:function(){this.uiDialog=t("<div>").hide().attr({tabIndex:-1,role:"dialog"}).appendTo(this._appendTo()),this._addClass(this.uiDialog,"ui-dialog","ui-widget ui-widget-content ui-front"),this._on(this.uiDialog,{keydown:function(e){if(this.options.closeOnEscape&&!e.isDefaultPrevented()&&e.keyCode&&e.keyCode===t.ui.keyCode.ESCAPE)return e.preventDefault(),this.close(e),void 0;if(e.keyCode===t.ui.keyCode.TAB&&!e.isDefaultPrevented()){var i=this.uiDialog.find(":tabbable"),s=i.filter(":first"),n=i.filter(":last");e.target!==n[0]&&e.target!==this.uiDialog[0]||e.shiftKey?e.target!==s[0]&&e.target!==this.uiDialog[0]||!e.shiftKey||(this._delay(function(){n.trigger("focus")}),e.preventDefault()):(this._delay(function(){s.trigger("focus")}),e.preventDefault())}},mousedown:function(t){this._moveToTop(t)&&this._focusTabbable()}}),this.element.find("[aria-describedby]").length||this.uiDialog.attr({"aria-describedby":this.element.uniqueId().attr("id")})},_createTitlebar:function(){var e;this.uiDialogTitlebar=t("<div>"),this._addClass(this.uiDialogTitlebar,"ui-dialog-titlebar","ui-widget-header ui-helper-clearfix"),this._on(this.uiDialogTitlebar,{mousedown:function(e){t(e.target).closest(".ui-dialog-titlebar-close")||this.uiDialog.trigger("focus")}}),this.uiDialogTitlebarClose=t("<button type='button'></button>").button({label:t("<a>").text(this.options.closeText).html(),icon:"ui-icon-closethick",showLabel:!1}).appendTo(this.uiDialogTitlebar),this._addClass(this.uiDialogTitlebarClose,"ui-dialog-titlebar-close"),this._on(this.uiDialogTitlebarClose,{click:function(t){t.preventDefault(),this.close(t)}}),e=t("<span>").uniqueId().prependTo(this.uiDialogTitlebar),this._addClass(e,"ui-dialog-title"),this._title(e),this.uiDialogTitlebar.prependTo(this.uiDialog),this.uiDialog.attr({"aria-labelledby":e.attr("id")})},_title:function(t){this.options.title?t.text(this.options.title):t.html("&#160;")},_createButtonPane:function(){this.uiDialogButtonPane=t("<div>"),this._addClass(this.uiDialogButtonPane,"ui-dialog-buttonpane","ui-widget-content ui-helper-clearfix"),this.uiButtonSet=t("<div>").appendTo(this.uiDialogButtonPane),this._addClass(this.uiButtonSet,"ui-dialog-buttonset"),this._createButtons()},_createButtons:function(){var e=this,i=this.options.buttons;return this.uiDialogButtonPane.remove(),this.uiButtonSet.empty(),t.isEmptyObject(i)||t.isArray(i)&&!i.length?(this._removeClass(this.uiDialog,"ui-dialog-buttons"),void 0):(t.each(i,function(i,s){var n,o;s=t.isFunction(s)?{click:s,text:i}:s,s=t.extend({type:"button"},s),n=s.click,o={icon:s.icon,iconPosition:s.iconPosition,showLabel:s.showLabel,icons:s.icons,text:s.text},delete s.click,delete s.icon,delete s.iconPosition,delete s.showLabel,delete s.icons,"boolean"==typeof s.text&&delete s.text,t("<button></button>",s).button(o).appendTo(e.uiButtonSet).on("click",function(){n.apply(e.element[0],arguments)})}),this._addClass(this.uiDialog,"ui-dialog-buttons"),this.uiDialogButtonPane.appendTo(this.uiDialog),void 0)},_makeDraggable:function(){function e(t){return{position:t.position,offset:t.offset}}var i=this,s=this.options;this.uiDialog.draggable({cancel:".ui-dialog-content, .ui-dialog-titlebar-close",handle:".ui-dialog-titlebar",containment:"document",start:function(s,n){i._addClass(t(this),"ui-dialog-dragging"),i._blockFrames(),i._trigger("dragStart",s,e(n))},drag:function(t,s){i._trigger("drag",t,e(s))},stop:function(n,o){var a=o.offset.left-i.document.scrollLeft(),r=o.offset.top-i.document.scrollTop();s.position={my:"left top",at:"left"+(a>=0?"+":"")+a+" "+"top"+(r>=0?"+":"")+r,of:i.window},i._removeClass(t(this),"ui-dialog-dragging"),i._unblockFrames(),i._trigger("dragStop",n,e(o))}})},_makeResizable:function(){function e(t){return{originalPosition:t.originalPosition,originalSize:t.originalSize,position:t.position,size:t.size}}var i=this,s=this.options,n=s.resizable,o=this.uiDialog.css("position"),a="string"==typeof n?n:"n,e,s,w,se,sw,ne,nw";this.uiDialog.resizable({cancel:".ui-dialog-content",containment:"document",alsoResize:this.element,maxWidth:s.maxWidth,maxHeight:s.maxHeight,minWidth:s.minWidth,minHeight:this._minHeight(),handles:a,start:function(s,n){i._addClass(t(this),"ui-dialog-resizing"),i._blockFrames(),i._trigger("resizeStart",s,e(n))},resize:function(t,s){i._trigger("resize",t,e(s))},stop:function(n,o){var a=i.uiDialog.offset(),r=a.left-i.document.scrollLeft(),h=a.top-i.document.scrollTop();s.height=i.uiDialog.height(),s.width=i.uiDialog.width(),s.position={my:"left top",at:"left"+(r>=0?"+":"")+r+" "+"top"+(h>=0?"+":"")+h,of:i.window},i._removeClass(t(this),"ui-dialog-resizing"),i._unblockFrames(),i._trigger("resizeStop",n,e(o))}}).css("position",o)},_trackFocus:function(){this._on(this.widget(),{focusin:function(e){this._makeFocusTarget(),this._focusedElement=t(e.target)}})},_makeFocusTarget:function(){this._untrackInstance(),this._trackingInstances().unshift(this)},_untrackInstance:function(){var e=this._trackingInstances(),i=t.inArray(this,e);-1!==i&&e.splice(i,1)},_trackingInstances:function(){var t=this.document.data("ui-dialog-instances");return t||(t=[],this.document.data("ui-dialog-instances",t)),t},_minHeight:function(){var t=this.options;return"auto"===t.height?t.minHeight:Math.min(t.minHeight,t.height)},_position:function(){var t=this.uiDialog.is(":visible");t||this.uiDialog.show(),this.uiDialog.position(this.options.position),t||this.uiDialog.hide()},_setOptions:function(e){var i=this,s=!1,n={};t.each(e,function(t,e){i._setOption(t,e),t in i.sizeRelatedOptions&&(s=!0),t in i.resizableRelatedOptions&&(n[t]=e)}),s&&(this._size(),this._position()),this.uiDialog.is(":data(ui-resizable)")&&this.uiDialog.resizable("option",n)},_setOption:function(e,i){var s,n,o=this.uiDialog;"disabled"!==e&&(this._super(e,i),"appendTo"===e&&this.uiDialog.appendTo(this._appendTo()),"buttons"===e&&this._createButtons(),"closeText"===e&&this.uiDialogTitlebarClose.button({label:t("<a>").text(""+this.options.closeText).html()}),"draggable"===e&&(s=o.is(":data(ui-draggable)"),s&&!i&&o.draggable("destroy"),!s&&i&&this._makeDraggable()),"position"===e&&this._position(),"resizable"===e&&(n=o.is(":data(ui-resizable)"),n&&!i&&o.resizable("destroy"),n&&"string"==typeof i&&o.resizable("option","handles",i),n||i===!1||this._makeResizable()),"title"===e&&this._title(this.uiDialogTitlebar.find(".ui-dialog-title")))},_size:function(){var t,e,i,s=this.options;this.element.show().css({width:"auto",minHeight:0,maxHeight:"none",height:0}),s.minWidth>s.width&&(s.width=s.minWidth),t=this.uiDialog.css({height:"auto",width:s.width}).outerHeight(),e=Math.max(0,s.minHeight-t),i="number"==typeof s.maxHeight?Math.max(0,s.maxHeight-t):"none","auto"===s.height?this.element.css({minHeight:e,maxHeight:i,height:"auto"}):this.element.height(Math.max(0,s.height-t)),this.uiDialog.is(":data(ui-resizable)")&&this.uiDialog.resizable("option","minHeight",this._minHeight())},_blockFrames:function(){this.iframeBlocks=this.document.find("iframe").map(function(){var e=t(this);return t("<div>").css({position:"absolute",width:e.outerWidth(),height:e.outerHeight()}).appendTo(e.parent()).offset(e.offset())[0]})},_unblockFrames:function(){this.iframeBlocks&&(this.iframeBlocks.remove(),delete this.iframeBlocks)},_allowInteraction:function(e){return t(e.target).closest(".ui-dialog").length?!0:!!t(e.target).closest(".ui-datepicker").length},_createOverlay:function(){if(this.options.modal){var e=!0;this._delay(function(){e=!1}),this.document.data("ui-dialog-overlays")||this._on(this.document,{focusin:function(t){e||this._allowInteraction(t)||(t.preventDefault(),this._trackingInstances()[0]._focusTabbable())}}),this.overlay=t("<div>").appendTo(this._appendTo()),this._addClass(this.overlay,null,"ui-widget-overlay ui-front"),this._on(this.overlay,{mousedown:"_keepFocus"}),this.document.data("ui-dialog-overlays",(this.document.data("ui-dialog-overlays")||0)+1)}},_destroyOverlay:function(){if(this.options.modal&&this.overlay){var t=this.document.data("ui-dialog-overlays")-1;t?this.document.data("ui-dialog-overlays",t):(this._off(this.document,"focusin"),this.document.removeData("ui-dialog-overlays")),this.overlay.remove(),this.overlay=null}}}),t.uiBackCompat!==!1&&t.widget("ui.dialog",t.ui.dialog,{options:{dialogClass:""},_createWrapper:function(){this._super(),this.uiDialog.addClass(this.options.dialogClass)},_setOption:function(t,e){"dialogClass"===t&&this.uiDialog.removeClass(this.options.dialogClass).addClass(e),this._superApply(arguments)}}),t.ui.dialog,t.widget("ui.droppable",{version:"1.12.1",widgetEventPrefix:"drop",options:{accept:"*",addClasses:!0,greedy:!1,scope:"default",tolerance:"intersect",activate:null,deactivate:null,drop:null,out:null,over:null},_create:function(){var e,i=this.options,s=i.accept;this.isover=!1,this.isout=!0,this.accept=t.isFunction(s)?s:function(t){return t.is(s)},this.proportions=function(){return arguments.length?(e=arguments[0],void 0):e?e:e={width:this.element[0].offsetWidth,height:this.element[0].offsetHeight}},this._addToManager(i.scope),i.addClasses&&this._addClass("ui-droppable")},_addToManager:function(e){t.ui.ddmanager.droppables[e]=t.ui.ddmanager.droppables[e]||[],t.ui.ddmanager.droppables[e].push(this)},_splice:function(t){for(var e=0;t.length>e;e++)t[e]===this&&t.splice(e,1)},_destroy:function(){var e=t.ui.ddmanager.droppables[this.options.scope];this._splice(e)},_setOption:function(e,i){if("accept"===e)this.accept=t.isFunction(i)?i:function(t){return t.is(i)};else if("scope"===e){var s=t.ui.ddmanager.droppables[this.options.scope];this._splice(s),this._addToManager(i)}this._super(e,i)},_activate:function(e){var i=t.ui.ddmanager.current;this._addActiveClass(),i&&this._trigger("activate",e,this.ui(i))},_deactivate:function(e){var i=t.ui.ddmanager.current;this._removeActiveClass(),i&&this._trigger("deactivate",e,this.ui(i))},_over:function(e){var i=t.ui.ddmanager.current;i&&(i.currentItem||i.element)[0]!==this.element[0]&&this.accept.call(this.element[0],i.currentItem||i.element)&&(this._addHoverClass(),this._trigger("over",e,this.ui(i)))},_out:function(e){var i=t.ui.ddmanager.current;i&&(i.currentItem||i.element)[0]!==this.element[0]&&this.accept.call(this.element[0],i.currentItem||i.element)&&(this._removeHoverClass(),this._trigger("out",e,this.ui(i)))},_drop:function(e,i){var s=i||t.ui.ddmanager.current,n=!1;return s&&(s.currentItem||s.element)[0]!==this.element[0]?(this.element.find(":data(ui-droppable)").not(".ui-draggable-dragging").each(function(){var i=t(this).droppable("instance");return i.options.greedy&&!i.options.disabled&&i.options.scope===s.options.scope&&i.accept.call(i.element[0],s.currentItem||s.element)&&v(s,t.extend(i,{offset:i.element.offset()}),i.options.tolerance,e)?(n=!0,!1):void 0}),n?!1:this.accept.call(this.element[0],s.currentItem||s.element)?(this._removeActiveClass(),this._removeHoverClass(),this._trigger("drop",e,this.ui(s)),this.element):!1):!1},ui:function(t){return{draggable:t.currentItem||t.element,helper:t.helper,position:t.position,offset:t.positionAbs}},_addHoverClass:function(){this._addClass("ui-droppable-hover")},_removeHoverClass:function(){this._removeClass("ui-droppable-hover")},_addActiveClass:function(){this._addClass("ui-droppable-active")},_removeActiveClass:function(){this._removeClass("ui-droppable-active")}});var v=t.ui.intersect=function(){function t(t,e,i){return t>=e&&e+i>t}return function(e,i,s,n){if(!i.offset)return!1;var o=(e.positionAbs||e.position.absolute).left+e.margins.left,a=(e.positionAbs||e.position.absolute).top+e.margins.top,r=o+e.helperProportions.width,h=a+e.helperProportions.height,l=i.offset.left,c=i.offset.top,u=l+i.proportions().width,d=c+i.proportions().height;switch(s){case"fit":return o>=l&&u>=r&&a>=c&&d>=h;case"intersect":return o+e.helperProportions.width/2>l&&u>r-e.helperProportions.width/2&&a+e.helperProportions.height/2>c&&d>h-e.helperProportions.height/2;case"pointer":return t(n.pageY,c,i.proportions().height)&&t(n.pageX,l,i.proportions().width);case"touch":return(a>=c&&d>=a||h>=c&&d>=h||c>a&&h>d)&&(o>=l&&u>=o||r>=l&&u>=r||l>o&&r>u);default:return!1}}}();t.ui.ddmanager={current:null,droppables:{"default":[]},prepareOffsets:function(e,i){var s,n,o=t.ui.ddmanager.droppables[e.options.scope]||[],a=i?i.type:null,r=(e.currentItem||e.element).find(":data(ui-droppable)").addBack();t:for(s=0;o.length>s;s++)if(!(o[s].options.disabled||e&&!o[s].accept.call(o[s].element[0],e.currentItem||e.element))){for(n=0;r.length>n;n++)if(r[n]===o[s].element[0]){o[s].proportions().height=0;continue t}o[s].visible="none"!==o[s].element.css("display"),o[s].visible&&("mousedown"===a&&o[s]._activate.call(o[s],i),o[s].offset=o[s].element.offset(),o[s].proportions({width:o[s].element[0].offsetWidth,height:o[s].element[0].offsetHeight}))}},drop:function(e,i){var s=!1;return t.each((t.ui.ddmanager.droppables[e.options.scope]||[]).slice(),function(){this.options&&(!this.options.disabled&&this.visible&&v(e,this,this.options.tolerance,i)&&(s=this._drop.call(this,i)||s),!this.options.disabled&&this.visible&&this.accept.call(this.element[0],e.currentItem||e.element)&&(this.isout=!0,this.isover=!1,this._deactivate.call(this,i)))}),s},dragStart:function(e,i){e.element.parentsUntil("body").on("scroll.droppable",function(){e.options.refreshPositions||t.ui.ddmanager.prepareOffsets(e,i)})},drag:function(e,i){e.options.refreshPositions&&t.ui.ddmanager.prepareOffsets(e,i),t.each(t.ui.ddmanager.droppables[e.options.scope]||[],function(){if(!this.options.disabled&&!this.greedyChild&&this.visible){var s,n,o,a=v(e,this,this.options.tolerance,i),r=!a&&this.isover?"isout":a&&!this.isover?"isover":null;r&&(this.options.greedy&&(n=this.options.scope,o=this.element.parents(":data(ui-droppable)").filter(function(){return t(this).droppable("instance").options.scope===n}),o.length&&(s=t(o[0]).droppable("instance"),s.greedyChild="isover"===r)),s&&"isover"===r&&(s.isover=!1,s.isout=!0,s._out.call(s,i)),this[r]=!0,this["isout"===r?"isover":"isout"]=!1,this["isover"===r?"_over":"_out"].call(this,i),s&&"isout"===r&&(s.isout=!1,s.isover=!0,s._over.call(s,i)))}})},dragStop:function(e,i){e.element.parentsUntil("body").off("scroll.droppable"),e.options.refreshPositions||t.ui.ddmanager.prepareOffsets(e,i)}},t.uiBackCompat!==!1&&t.widget("ui.droppable",t.ui.droppable,{options:{hoverClass:!1,activeClass:!1},_addActiveClass:function(){this._super(),this.options.activeClass&&this.element.addClass(this.options.activeClass)},_removeActiveClass:function(){this._super(),this.options.activeClass&&this.element.removeClass(this.options.activeClass)},_addHoverClass:function(){this._super(),this.options.hoverClass&&this.element.addClass(this.options.hoverClass)},_removeHoverClass:function(){this._super(),this.options.hoverClass&&this.element.removeClass(this.options.hoverClass)}}),t.ui.droppable,t.widget("ui.progressbar",{version:"1.12.1",options:{classes:{"ui-progressbar":"ui-corner-all","ui-progressbar-value":"ui-corner-left","ui-progressbar-complete":"ui-corner-right"},max:100,value:0,change:null,complete:null},min:0,_create:function(){this.oldValue=this.options.value=this._constrainedValue(),this.element.attr({role:"progressbar","aria-valuemin":this.min}),this._addClass("ui-progressbar","ui-widget ui-widget-content"),this.valueDiv=t("<div>").appendTo(this.element),this._addClass(this.valueDiv,"ui-progressbar-value","ui-widget-header"),this._refreshValue()},_destroy:function(){this.element.removeAttr("role aria-valuemin aria-valuemax aria-valuenow"),this.valueDiv.remove()},value:function(t){return void 0===t?this.options.value:(this.options.value=this._constrainedValue(t),this._refreshValue(),void 0)},_constrainedValue:function(t){return void 0===t&&(t=this.options.value),this.indeterminate=t===!1,"number"!=typeof t&&(t=0),this.indeterminate?!1:Math.min(this.options.max,Math.max(this.min,t))},_setOptions:function(t){var e=t.value;delete t.value,this._super(t),this.options.value=this._constrainedValue(e),this._refreshValue()},_setOption:function(t,e){"max"===t&&(e=Math.max(this.min,e)),this._super(t,e)},_setOptionDisabled:function(t){this._super(t),this.element.attr("aria-disabled",t),this._toggleClass(null,"ui-state-disabled",!!t)},_percentage:function(){return this.indeterminate?100:100*(this.options.value-this.min)/(this.options.max-this.min)},_refreshValue:function(){var e=this.options.value,i=this._percentage();this.valueDiv.toggle(this.indeterminate||e>this.min).width(i.toFixed(0)+"%"),this._toggleClass(this.valueDiv,"ui-progressbar-complete",null,e===this.options.max)._toggleClass("ui-progressbar-indeterminate",null,this.indeterminate),this.indeterminate?(this.element.removeAttr("aria-valuenow"),this.overlayDiv||(this.overlayDiv=t("<div>").appendTo(this.valueDiv),this._addClass(this.overlayDiv,"ui-progressbar-overlay"))):(this.element.attr({"aria-valuemax":this.options.max,"aria-valuenow":e}),this.overlayDiv&&(this.overlayDiv.remove(),this.overlayDiv=null)),this.oldValue!==e&&(this.oldValue=e,this._trigger("change")),e===this.options.max&&this._trigger("complete")}}),t.widget("ui.selectable",t.ui.mouse,{version:"1.12.1",options:{appendTo:"body",autoRefresh:!0,distance:0,filter:"*",tolerance:"touch",selected:null,selecting:null,start:null,stop:null,unselected:null,unselecting:null},_create:function(){var e=this;this._addClass("ui-selectable"),this.dragged=!1,this.refresh=function(){e.elementPos=t(e.element[0]).offset(),e.selectees=t(e.options.filter,e.element[0]),e._addClass(e.selectees,"ui-selectee"),e.selectees.each(function(){var i=t(this),s=i.offset(),n={left:s.left-e.elementPos.left,top:s.top-e.elementPos.top};t.data(this,"selectable-item",{element:this,$element:i,left:n.left,top:n.top,right:n.left+i.outerWidth(),bottom:n.top+i.outerHeight(),startselected:!1,selected:i.hasClass("ui-selected"),selecting:i.hasClass("ui-selecting"),unselecting:i.hasClass("ui-unselecting")})})},this.refresh(),this._mouseInit(),this.helper=t("<div>"),this._addClass(this.helper,"ui-selectable-helper")},_destroy:function(){this.selectees.removeData("selectable-item"),this._mouseDestroy()},_mouseStart:function(e){var i=this,s=this.options;this.opos=[e.pageX,e.pageY],this.elementPos=t(this.element[0]).offset(),this.options.disabled||(this.selectees=t(s.filter,this.element[0]),this._trigger("start",e),t(s.appendTo).append(this.helper),this.helper.css({left:e.pageX,top:e.pageY,width:0,height:0}),s.autoRefresh&&this.refresh(),this.selectees.filter(".ui-selected").each(function(){var s=t.data(this,"selectable-item");s.startselected=!0,e.metaKey||e.ctrlKey||(i._removeClass(s.$element,"ui-selected"),s.selected=!1,i._addClass(s.$element,"ui-unselecting"),s.unselecting=!0,i._trigger("unselecting",e,{unselecting:s.element}))}),t(e.target).parents().addBack().each(function(){var s,n=t.data(this,"selectable-item");return n?(s=!e.metaKey&&!e.ctrlKey||!n.$element.hasClass("ui-selected"),i._removeClass(n.$element,s?"ui-unselecting":"ui-selected")._addClass(n.$element,s?"ui-selecting":"ui-unselecting"),n.unselecting=!s,n.selecting=s,n.selected=s,s?i._trigger("selecting",e,{selecting:n.element}):i._trigger("unselecting",e,{unselecting:n.element}),!1):void 0}))},_mouseDrag:function(e){if(this.dragged=!0,!this.options.disabled){var i,s=this,n=this.options,o=this.opos[0],a=this.opos[1],r=e.pageX,h=e.pageY;return o>r&&(i=r,r=o,o=i),a>h&&(i=h,h=a,a=i),this.helper.css({left:o,top:a,width:r-o,height:h-a}),this.selectees.each(function(){var i=t.data(this,"selectable-item"),l=!1,c={};i&&i.element!==s.element[0]&&(c.left=i.left+s.elementPos.left,c.right=i.right+s.elementPos.left,c.top=i.top+s.elementPos.top,c.bottom=i.bottom+s.elementPos.top,"touch"===n.tolerance?l=!(c.left>r||o>c.right||c.top>h||a>c.bottom):"fit"===n.tolerance&&(l=c.left>o&&r>c.right&&c.top>a&&h>c.bottom),l?(i.selected&&(s._removeClass(i.$element,"ui-selected"),i.selected=!1),i.unselecting&&(s._removeClass(i.$element,"ui-unselecting"),i.unselecting=!1),i.selecting||(s._addClass(i.$element,"ui-selecting"),i.selecting=!0,s._trigger("selecting",e,{selecting:i.element}))):(i.selecting&&((e.metaKey||e.ctrlKey)&&i.startselected?(s._removeClass(i.$element,"ui-selecting"),i.selecting=!1,s._addClass(i.$element,"ui-selected"),i.selected=!0):(s._removeClass(i.$element,"ui-selecting"),i.selecting=!1,i.startselected&&(s._addClass(i.$element,"ui-unselecting"),i.unselecting=!0),s._trigger("unselecting",e,{unselecting:i.element}))),i.selected&&(e.metaKey||e.ctrlKey||i.startselected||(s._removeClass(i.$element,"ui-selected"),i.selected=!1,s._addClass(i.$element,"ui-unselecting"),i.unselecting=!0,s._trigger("unselecting",e,{unselecting:i.element})))))}),!1}},_mouseStop:function(e){var i=this;return this.dragged=!1,t(".ui-unselecting",this.element[0]).each(function(){var s=t.data(this,"selectable-item");i._removeClass(s.$element,"ui-unselecting"),s.unselecting=!1,s.startselected=!1,i._trigger("unselected",e,{unselected:s.element})}),t(".ui-selecting",this.element[0]).each(function(){var s=t.data(this,"selectable-item");i._removeClass(s.$element,"ui-selecting")._addClass(s.$element,"ui-selected"),s.selecting=!1,s.selected=!0,s.startselected=!0,i._trigger("selected",e,{selected:s.element})}),this._trigger("stop",e),this.helper.remove(),!1}}),t.widget("ui.selectmenu",[t.ui.formResetMixin,{version:"1.12.1",defaultElement:"<select>",options:{appendTo:null,classes:{"ui-selectmenu-button-open":"ui-corner-top","ui-selectmenu-button-closed":"ui-corner-all"},disabled:null,icons:{button:"ui-icon-triangle-1-s"},position:{my:"left top",at:"left bottom",collision:"none"},width:!1,change:null,close:null,focus:null,open:null,select:null},_create:function(){var e=this.element.uniqueId().attr("id");this.ids={element:e,button:e+"-button",menu:e+"-menu"},this._drawButton(),this._drawMenu(),this._bindFormResetHandler(),this._rendered=!1,this.menuItems=t()},_drawButton:function(){var e,i=this,s=this._parseOption(this.element.find("option:selected"),this.element[0].selectedIndex);this.labels=this.element.labels().attr("for",this.ids.button),this._on(this.labels,{click:function(t){this.button.focus(),t.preventDefault()}}),this.element.hide(),this.button=t("<span>",{tabindex:this.options.disabled?-1:0,id:this.ids.button,role:"combobox","aria-expanded":"false","aria-autocomplete":"list","aria-owns":this.ids.menu,"aria-haspopup":"true",title:this.element.attr("title")}).insertAfter(this.element),this._addClass(this.button,"ui-selectmenu-button ui-selectmenu-button-closed","ui-button ui-widget"),e=t("<span>").appendTo(this.button),this._addClass(e,"ui-selectmenu-icon","ui-icon "+this.options.icons.button),this.buttonItem=this._renderButtonItem(s).appendTo(this.button),this.options.width!==!1&&this._resizeButton(),this._on(this.button,this._buttonEvents),this.button.one("focusin",function(){i._rendered||i._refreshMenu()})},_drawMenu:function(){var e=this;this.menu=t("<ul>",{"aria-hidden":"true","aria-labelledby":this.ids.button,id:this.ids.menu}),this.menuWrap=t("<div>").append(this.menu),this._addClass(this.menuWrap,"ui-selectmenu-menu","ui-front"),this.menuWrap.appendTo(this._appendTo()),this.menuInstance=this.menu.menu({classes:{"ui-menu":"ui-corner-bottom"},role:"listbox",select:function(t,i){t.preventDefault(),e._setSelection(),e._select(i.item.data("ui-selectmenu-item"),t)},focus:function(t,i){var s=i.item.data("ui-selectmenu-item");null!=e.focusIndex&&s.index!==e.focusIndex&&(e._trigger("focus",t,{item:s}),e.isOpen||e._select(s,t)),e.focusIndex=s.index,e.button.attr("aria-activedescendant",e.menuItems.eq(s.index).attr("id"))}}).menu("instance"),this.menuInstance._off(this.menu,"mouseleave"),this.menuInstance._closeOnDocumentClick=function(){return!1},this.menuInstance._isDivider=function(){return!1}},refresh:function(){this._refreshMenu(),this.buttonItem.replaceWith(this.buttonItem=this._renderButtonItem(this._getSelectedItem().data("ui-selectmenu-item")||{})),null===this.options.width&&this._resizeButton()},_refreshMenu:function(){var t,e=this.element.find("option");this.menu.empty(),this._parseOptions(e),this._renderMenu(this.menu,this.items),this.menuInstance.refresh(),this.menuItems=this.menu.find("li").not(".ui-selectmenu-optgroup").find(".ui-menu-item-wrapper"),this._rendered=!0,e.length&&(t=this._getSelectedItem(),this.menuInstance.focus(null,t),this._setAria(t.data("ui-selectmenu-item")),this._setOption("disabled",this.element.prop("disabled")))},open:function(t){this.options.disabled||(this._rendered?(this._removeClass(this.menu.find(".ui-state-active"),null,"ui-state-active"),this.menuInstance.focus(null,this._getSelectedItem())):this._refreshMenu(),this.menuItems.length&&(this.isOpen=!0,this._toggleAttr(),this._resizeMenu(),this._position(),this._on(this.document,this._documentClick),this._trigger("open",t)))},_position:function(){this.menuWrap.position(t.extend({of:this.button},this.options.position))},close:function(t){this.isOpen&&(this.isOpen=!1,this._toggleAttr(),this.range=null,this._off(this.document),this._trigger("close",t))},widget:function(){return this.button},menuWidget:function(){return this.menu},_renderButtonItem:function(e){var i=t("<span>");return this._setText(i,e.label),this._addClass(i,"ui-selectmenu-text"),i},_renderMenu:function(e,i){var s=this,n="";t.each(i,function(i,o){var a;o.optgroup!==n&&(a=t("<li>",{text:o.optgroup}),s._addClass(a,"ui-selectmenu-optgroup","ui-menu-divider"+(o.element.parent("optgroup").prop("disabled")?" ui-state-disabled":"")),a.appendTo(e),n=o.optgroup),s._renderItemData(e,o)})},_renderItemData:function(t,e){return this._renderItem(t,e).data("ui-selectmenu-item",e)},_renderItem:function(e,i){var s=t("<li>"),n=t("<div>",{title:i.element.attr("title")});return i.disabled&&this._addClass(s,null,"ui-state-disabled"),this._setText(n,i.label),s.append(n).appendTo(e)},_setText:function(t,e){e?t.text(e):t.html("&#160;")},_move:function(t,e){var i,s,n=".ui-menu-item";this.isOpen?i=this.menuItems.eq(this.focusIndex).parent("li"):(i=this.menuItems.eq(this.element[0].selectedIndex).parent("li"),n+=":not(.ui-state-disabled)"),s="first"===t||"last"===t?i["first"===t?"prevAll":"nextAll"](n).eq(-1):i[t+"All"](n).eq(0),s.length&&this.menuInstance.focus(e,s)},_getSelectedItem:function(){return this.menuItems.eq(this.element[0].selectedIndex).parent("li")},_toggle:function(t){this[this.isOpen?"close":"open"](t)},_setSelection:function(){var t;this.range&&(window.getSelection?(t=window.getSelection(),t.removeAllRanges(),t.addRange(this.range)):this.range.select(),this.button.focus())},_documentClick:{mousedown:function(e){this.isOpen&&(t(e.target).closest(".ui-selectmenu-menu, #"+t.ui.escapeSelector(this.ids.button)).length||this.close(e))}},_buttonEvents:{mousedown:function(){var t;window.getSelection?(t=window.getSelection(),t.rangeCount&&(this.range=t.getRangeAt(0))):this.range=document.selection.createRange()},click:function(t){this._setSelection(),this._toggle(t)},keydown:function(e){var i=!0;switch(e.keyCode){case t.ui.keyCode.TAB:case t.ui.keyCode.ESCAPE:this.close(e),i=!1;break;case t.ui.keyCode.ENTER:this.isOpen&&this._selectFocusedItem(e);break;case t.ui.keyCode.UP:e.altKey?this._toggle(e):this._move("prev",e);break;case t.ui.keyCode.DOWN:e.altKey?this._toggle(e):this._move("next",e);break;case t.ui.keyCode.SPACE:this.isOpen?this._selectFocusedItem(e):this._toggle(e);break;case t.ui.keyCode.LEFT:this._move("prev",e);break;case t.ui.keyCode.RIGHT:this._move("next",e);break;case t.ui.keyCode.HOME:case t.ui.keyCode.PAGE_UP:this._move("first",e);break;case t.ui.keyCode.END:case t.ui.keyCode.PAGE_DOWN:this._move("last",e);break;default:this.menu.trigger(e),i=!1}i&&e.preventDefault()}},_selectFocusedItem:function(t){var e=this.menuItems.eq(this.focusIndex).parent("li");e.hasClass("ui-state-disabled")||this._select(e.data("ui-selectmenu-item"),t)},_select:function(t,e){var i=this.element[0].selectedIndex;this.element[0].selectedIndex=t.index,this.buttonItem.replaceWith(this.buttonItem=this._renderButtonItem(t)),this._setAria(t),this._trigger("select",e,{item:t}),t.index!==i&&this._trigger("change",e,{item:t}),this.close(e)},_setAria:function(t){var e=this.menuItems.eq(t.index).attr("id");this.button.attr({"aria-labelledby":e,"aria-activedescendant":e}),this.menu.attr("aria-activedescendant",e)},_setOption:function(t,e){if("icons"===t){var i=this.button.find("span.ui-icon");this._removeClass(i,null,this.options.icons.button)._addClass(i,null,e.button)}this._super(t,e),"appendTo"===t&&this.menuWrap.appendTo(this._appendTo()),"width"===t&&this._resizeButton()},_setOptionDisabled:function(t){this._super(t),this.menuInstance.option("disabled",t),this.button.attr("aria-disabled",t),this._toggleClass(this.button,null,"ui-state-disabled",t),this.element.prop("disabled",t),t?(this.button.attr("tabindex",-1),this.close()):this.button.attr("tabindex",0)},_appendTo:function(){var e=this.options.appendTo;return e&&(e=e.jquery||e.nodeType?t(e):this.document.find(e).eq(0)),e&&e[0]||(e=this.element.closest(".ui-front, dialog")),e.length||(e=this.document[0].body),e},_toggleAttr:function(){this.button.attr("aria-expanded",this.isOpen),this._removeClass(this.button,"ui-selectmenu-button-"+(this.isOpen?"closed":"open"))._addClass(this.button,"ui-selectmenu-button-"+(this.isOpen?"open":"closed"))._toggleClass(this.menuWrap,"ui-selectmenu-open",null,this.isOpen),this.menu.attr("aria-hidden",!this.isOpen)},_resizeButton:function(){var t=this.options.width;return t===!1?(this.button.css("width",""),void 0):(null===t&&(t=this.element.show().outerWidth(),this.element.hide()),this.button.outerWidth(t),void 0)},_resizeMenu:function(){this.menu.outerWidth(Math.max(this.button.outerWidth(),this.menu.width("").outerWidth()+1))},_getCreateOptions:function(){var t=this._super();return t.disabled=this.element.prop("disabled"),t},_parseOptions:function(e){var i=this,s=[];e.each(function(e,n){s.push(i._parseOption(t(n),e))}),this.items=s},_parseOption:function(t,e){var i=t.parent("optgroup");return{element:t,index:e,value:t.val(),label:t.text(),optgroup:i.attr("label")||"",disabled:i.prop("disabled")||t.prop("disabled")}},_destroy:function(){this._unbindFormResetHandler(),this.menuWrap.remove(),this.button.remove(),this.element.show(),this.element.removeUniqueId(),this.labels.attr("for",this.ids.element)}}]),t.widget("ui.slider",t.ui.mouse,{version:"1.12.1",widgetEventPrefix:"slide",options:{animate:!1,classes:{"ui-slider":"ui-corner-all","ui-slider-handle":"ui-corner-all","ui-slider-range":"ui-corner-all ui-widget-header"},distance:0,max:100,min:0,orientation:"horizontal",range:!1,step:1,value:0,values:null,change:null,slide:null,start:null,stop:null},numPages:5,_create:function(){this._keySliding=!1,this._mouseSliding=!1,this._animateOff=!0,this._handleIndex=null,this._detectOrientation(),this._mouseInit(),this._calculateNewMax(),this._addClass("ui-slider ui-slider-"+this.orientation,"ui-widget ui-widget-content"),this._refresh(),this._animateOff=!1
},_refresh:function(){this._createRange(),this._createHandles(),this._setupEvents(),this._refreshValue()},_createHandles:function(){var e,i,s=this.options,n=this.element.find(".ui-slider-handle"),o="<span tabindex='0'></span>",a=[];for(i=s.values&&s.values.length||1,n.length>i&&(n.slice(i).remove(),n=n.slice(0,i)),e=n.length;i>e;e++)a.push(o);this.handles=n.add(t(a.join("")).appendTo(this.element)),this._addClass(this.handles,"ui-slider-handle","ui-state-default"),this.handle=this.handles.eq(0),this.handles.each(function(e){t(this).data("ui-slider-handle-index",e).attr("tabIndex",0)})},_createRange:function(){var e=this.options;e.range?(e.range===!0&&(e.values?e.values.length&&2!==e.values.length?e.values=[e.values[0],e.values[0]]:t.isArray(e.values)&&(e.values=e.values.slice(0)):e.values=[this._valueMin(),this._valueMin()]),this.range&&this.range.length?(this._removeClass(this.range,"ui-slider-range-min ui-slider-range-max"),this.range.css({left:"",bottom:""})):(this.range=t("<div>").appendTo(this.element),this._addClass(this.range,"ui-slider-range")),("min"===e.range||"max"===e.range)&&this._addClass(this.range,"ui-slider-range-"+e.range)):(this.range&&this.range.remove(),this.range=null)},_setupEvents:function(){this._off(this.handles),this._on(this.handles,this._handleEvents),this._hoverable(this.handles),this._focusable(this.handles)},_destroy:function(){this.handles.remove(),this.range&&this.range.remove(),this._mouseDestroy()},_mouseCapture:function(e){var i,s,n,o,a,r,h,l,c=this,u=this.options;return u.disabled?!1:(this.elementSize={width:this.element.outerWidth(),height:this.element.outerHeight()},this.elementOffset=this.element.offset(),i={x:e.pageX,y:e.pageY},s=this._normValueFromMouse(i),n=this._valueMax()-this._valueMin()+1,this.handles.each(function(e){var i=Math.abs(s-c.values(e));(n>i||n===i&&(e===c._lastChangedValue||c.values(e)===u.min))&&(n=i,o=t(this),a=e)}),r=this._start(e,a),r===!1?!1:(this._mouseSliding=!0,this._handleIndex=a,this._addClass(o,null,"ui-state-active"),o.trigger("focus"),h=o.offset(),l=!t(e.target).parents().addBack().is(".ui-slider-handle"),this._clickOffset=l?{left:0,top:0}:{left:e.pageX-h.left-o.width()/2,top:e.pageY-h.top-o.height()/2-(parseInt(o.css("borderTopWidth"),10)||0)-(parseInt(o.css("borderBottomWidth"),10)||0)+(parseInt(o.css("marginTop"),10)||0)},this.handles.hasClass("ui-state-hover")||this._slide(e,a,s),this._animateOff=!0,!0))},_mouseStart:function(){return!0},_mouseDrag:function(t){var e={x:t.pageX,y:t.pageY},i=this._normValueFromMouse(e);return this._slide(t,this._handleIndex,i),!1},_mouseStop:function(t){return this._removeClass(this.handles,null,"ui-state-active"),this._mouseSliding=!1,this._stop(t,this._handleIndex),this._change(t,this._handleIndex),this._handleIndex=null,this._clickOffset=null,this._animateOff=!1,!1},_detectOrientation:function(){this.orientation="vertical"===this.options.orientation?"vertical":"horizontal"},_normValueFromMouse:function(t){var e,i,s,n,o;return"horizontal"===this.orientation?(e=this.elementSize.width,i=t.x-this.elementOffset.left-(this._clickOffset?this._clickOffset.left:0)):(e=this.elementSize.height,i=t.y-this.elementOffset.top-(this._clickOffset?this._clickOffset.top:0)),s=i/e,s>1&&(s=1),0>s&&(s=0),"vertical"===this.orientation&&(s=1-s),n=this._valueMax()-this._valueMin(),o=this._valueMin()+s*n,this._trimAlignValue(o)},_uiHash:function(t,e,i){var s={handle:this.handles[t],handleIndex:t,value:void 0!==e?e:this.value()};return this._hasMultipleValues()&&(s.value=void 0!==e?e:this.values(t),s.values=i||this.values()),s},_hasMultipleValues:function(){return this.options.values&&this.options.values.length},_start:function(t,e){return this._trigger("start",t,this._uiHash(e))},_slide:function(t,e,i){var s,n,o=this.value(),a=this.values();this._hasMultipleValues()&&(n=this.values(e?0:1),o=this.values(e),2===this.options.values.length&&this.options.range===!0&&(i=0===e?Math.min(n,i):Math.max(n,i)),a[e]=i),i!==o&&(s=this._trigger("slide",t,this._uiHash(e,i,a)),s!==!1&&(this._hasMultipleValues()?this.values(e,i):this.value(i)))},_stop:function(t,e){this._trigger("stop",t,this._uiHash(e))},_change:function(t,e){this._keySliding||this._mouseSliding||(this._lastChangedValue=e,this._trigger("change",t,this._uiHash(e)))},value:function(t){return arguments.length?(this.options.value=this._trimAlignValue(t),this._refreshValue(),this._change(null,0),void 0):this._value()},values:function(e,i){var s,n,o;if(arguments.length>1)return this.options.values[e]=this._trimAlignValue(i),this._refreshValue(),this._change(null,e),void 0;if(!arguments.length)return this._values();if(!t.isArray(arguments[0]))return this._hasMultipleValues()?this._values(e):this.value();for(s=this.options.values,n=arguments[0],o=0;s.length>o;o+=1)s[o]=this._trimAlignValue(n[o]),this._change(null,o);this._refreshValue()},_setOption:function(e,i){var s,n=0;switch("range"===e&&this.options.range===!0&&("min"===i?(this.options.value=this._values(0),this.options.values=null):"max"===i&&(this.options.value=this._values(this.options.values.length-1),this.options.values=null)),t.isArray(this.options.values)&&(n=this.options.values.length),this._super(e,i),e){case"orientation":this._detectOrientation(),this._removeClass("ui-slider-horizontal ui-slider-vertical")._addClass("ui-slider-"+this.orientation),this._refreshValue(),this.options.range&&this._refreshRange(i),this.handles.css("horizontal"===i?"bottom":"left","");break;case"value":this._animateOff=!0,this._refreshValue(),this._change(null,0),this._animateOff=!1;break;case"values":for(this._animateOff=!0,this._refreshValue(),s=n-1;s>=0;s--)this._change(null,s);this._animateOff=!1;break;case"step":case"min":case"max":this._animateOff=!0,this._calculateNewMax(),this._refreshValue(),this._animateOff=!1;break;case"range":this._animateOff=!0,this._refresh(),this._animateOff=!1}},_setOptionDisabled:function(t){this._super(t),this._toggleClass(null,"ui-state-disabled",!!t)},_value:function(){var t=this.options.value;return t=this._trimAlignValue(t)},_values:function(t){var e,i,s;if(arguments.length)return e=this.options.values[t],e=this._trimAlignValue(e);if(this._hasMultipleValues()){for(i=this.options.values.slice(),s=0;i.length>s;s+=1)i[s]=this._trimAlignValue(i[s]);return i}return[]},_trimAlignValue:function(t){if(this._valueMin()>=t)return this._valueMin();if(t>=this._valueMax())return this._valueMax();var e=this.options.step>0?this.options.step:1,i=(t-this._valueMin())%e,s=t-i;return 2*Math.abs(i)>=e&&(s+=i>0?e:-e),parseFloat(s.toFixed(5))},_calculateNewMax:function(){var t=this.options.max,e=this._valueMin(),i=this.options.step,s=Math.round((t-e)/i)*i;t=s+e,t>this.options.max&&(t-=i),this.max=parseFloat(t.toFixed(this._precision()))},_precision:function(){var t=this._precisionOf(this.options.step);return null!==this.options.min&&(t=Math.max(t,this._precisionOf(this.options.min))),t},_precisionOf:function(t){var e=""+t,i=e.indexOf(".");return-1===i?0:e.length-i-1},_valueMin:function(){return this.options.min},_valueMax:function(){return this.max},_refreshRange:function(t){"vertical"===t&&this.range.css({width:"",left:""}),"horizontal"===t&&this.range.css({height:"",bottom:""})},_refreshValue:function(){var e,i,s,n,o,a=this.options.range,r=this.options,h=this,l=this._animateOff?!1:r.animate,c={};this._hasMultipleValues()?this.handles.each(function(s){i=100*((h.values(s)-h._valueMin())/(h._valueMax()-h._valueMin())),c["horizontal"===h.orientation?"left":"bottom"]=i+"%",t(this).stop(1,1)[l?"animate":"css"](c,r.animate),h.options.range===!0&&("horizontal"===h.orientation?(0===s&&h.range.stop(1,1)[l?"animate":"css"]({left:i+"%"},r.animate),1===s&&h.range[l?"animate":"css"]({width:i-e+"%"},{queue:!1,duration:r.animate})):(0===s&&h.range.stop(1,1)[l?"animate":"css"]({bottom:i+"%"},r.animate),1===s&&h.range[l?"animate":"css"]({height:i-e+"%"},{queue:!1,duration:r.animate}))),e=i}):(s=this.value(),n=this._valueMin(),o=this._valueMax(),i=o!==n?100*((s-n)/(o-n)):0,c["horizontal"===this.orientation?"left":"bottom"]=i+"%",this.handle.stop(1,1)[l?"animate":"css"](c,r.animate),"min"===a&&"horizontal"===this.orientation&&this.range.stop(1,1)[l?"animate":"css"]({width:i+"%"},r.animate),"max"===a&&"horizontal"===this.orientation&&this.range.stop(1,1)[l?"animate":"css"]({width:100-i+"%"},r.animate),"min"===a&&"vertical"===this.orientation&&this.range.stop(1,1)[l?"animate":"css"]({height:i+"%"},r.animate),"max"===a&&"vertical"===this.orientation&&this.range.stop(1,1)[l?"animate":"css"]({height:100-i+"%"},r.animate))},_handleEvents:{keydown:function(e){var i,s,n,o,a=t(e.target).data("ui-slider-handle-index");switch(e.keyCode){case t.ui.keyCode.HOME:case t.ui.keyCode.END:case t.ui.keyCode.PAGE_UP:case t.ui.keyCode.PAGE_DOWN:case t.ui.keyCode.UP:case t.ui.keyCode.RIGHT:case t.ui.keyCode.DOWN:case t.ui.keyCode.LEFT:if(e.preventDefault(),!this._keySliding&&(this._keySliding=!0,this._addClass(t(e.target),null,"ui-state-active"),i=this._start(e,a),i===!1))return}switch(o=this.options.step,s=n=this._hasMultipleValues()?this.values(a):this.value(),e.keyCode){case t.ui.keyCode.HOME:n=this._valueMin();break;case t.ui.keyCode.END:n=this._valueMax();break;case t.ui.keyCode.PAGE_UP:n=this._trimAlignValue(s+(this._valueMax()-this._valueMin())/this.numPages);break;case t.ui.keyCode.PAGE_DOWN:n=this._trimAlignValue(s-(this._valueMax()-this._valueMin())/this.numPages);break;case t.ui.keyCode.UP:case t.ui.keyCode.RIGHT:if(s===this._valueMax())return;n=this._trimAlignValue(s+o);break;case t.ui.keyCode.DOWN:case t.ui.keyCode.LEFT:if(s===this._valueMin())return;n=this._trimAlignValue(s-o)}this._slide(e,a,n)},keyup:function(e){var i=t(e.target).data("ui-slider-handle-index");this._keySliding&&(this._keySliding=!1,this._stop(e,i),this._change(e,i),this._removeClass(t(e.target),null,"ui-state-active"))}}}),t.widget("ui.sortable",t.ui.mouse,{version:"1.12.1",widgetEventPrefix:"sort",ready:!1,options:{appendTo:"parent",axis:!1,connectWith:!1,containment:!1,cursor:"auto",cursorAt:!1,dropOnEmpty:!0,forcePlaceholderSize:!1,forceHelperSize:!1,grid:!1,handle:!1,helper:"original",items:"> *",opacity:!1,placeholder:!1,revert:!1,scroll:!0,scrollSensitivity:20,scrollSpeed:20,scope:"default",tolerance:"intersect",zIndex:1e3,activate:null,beforeStop:null,change:null,deactivate:null,out:null,over:null,receive:null,remove:null,sort:null,start:null,stop:null,update:null},_isOverAxis:function(t,e,i){return t>=e&&e+i>t},_isFloating:function(t){return/left|right/.test(t.css("float"))||/inline|table-cell/.test(t.css("display"))},_create:function(){this.containerCache={},this._addClass("ui-sortable"),this.refresh(),this.offset=this.element.offset(),this._mouseInit(),this._setHandleClassName(),this.ready=!0},_setOption:function(t,e){this._super(t,e),"handle"===t&&this._setHandleClassName()},_setHandleClassName:function(){var e=this;this._removeClass(this.element.find(".ui-sortable-handle"),"ui-sortable-handle"),t.each(this.items,function(){e._addClass(this.instance.options.handle?this.item.find(this.instance.options.handle):this.item,"ui-sortable-handle")})},_destroy:function(){this._mouseDestroy();for(var t=this.items.length-1;t>=0;t--)this.items[t].item.removeData(this.widgetName+"-item");return this},_mouseCapture:function(e,i){var s=null,n=!1,o=this;return this.reverting?!1:this.options.disabled||"static"===this.options.type?!1:(this._refreshItems(e),t(e.target).parents().each(function(){return t.data(this,o.widgetName+"-item")===o?(s=t(this),!1):void 0}),t.data(e.target,o.widgetName+"-item")===o&&(s=t(e.target)),s?!this.options.handle||i||(t(this.options.handle,s).find("*").addBack().each(function(){this===e.target&&(n=!0)}),n)?(this.currentItem=s,this._removeCurrentsFromItems(),!0):!1:!1)},_mouseStart:function(e,i,s){var n,o,a=this.options;if(this.currentContainer=this,this.refreshPositions(),this.helper=this._createHelper(e),this._cacheHelperProportions(),this._cacheMargins(),this.scrollParent=this.helper.scrollParent(),this.offset=this.currentItem.offset(),this.offset={top:this.offset.top-this.margins.top,left:this.offset.left-this.margins.left},t.extend(this.offset,{click:{left:e.pageX-this.offset.left,top:e.pageY-this.offset.top},parent:this._getParentOffset(),relative:this._getRelativeOffset()}),this.helper.css("position","absolute"),this.cssPosition=this.helper.css("position"),this.originalPosition=this._generatePosition(e),this.originalPageX=e.pageX,this.originalPageY=e.pageY,a.cursorAt&&this._adjustOffsetFromHelper(a.cursorAt),this.domPosition={prev:this.currentItem.prev()[0],parent:this.currentItem.parent()[0]},this.helper[0]!==this.currentItem[0]&&this.currentItem.hide(),this._createPlaceholder(),a.containment&&this._setContainment(),a.cursor&&"auto"!==a.cursor&&(o=this.document.find("body"),this.storedCursor=o.css("cursor"),o.css("cursor",a.cursor),this.storedStylesheet=t("<style>*{ cursor: "+a.cursor+" !important; }</style>").appendTo(o)),a.opacity&&(this.helper.css("opacity")&&(this._storedOpacity=this.helper.css("opacity")),this.helper.css("opacity",a.opacity)),a.zIndex&&(this.helper.css("zIndex")&&(this._storedZIndex=this.helper.css("zIndex")),this.helper.css("zIndex",a.zIndex)),this.scrollParent[0]!==this.document[0]&&"HTML"!==this.scrollParent[0].tagName&&(this.overflowOffset=this.scrollParent.offset()),this._trigger("start",e,this._uiHash()),this._preserveHelperProportions||this._cacheHelperProportions(),!s)for(n=this.containers.length-1;n>=0;n--)this.containers[n]._trigger("activate",e,this._uiHash(this));return t.ui.ddmanager&&(t.ui.ddmanager.current=this),t.ui.ddmanager&&!a.dropBehaviour&&t.ui.ddmanager.prepareOffsets(this,e),this.dragging=!0,this._addClass(this.helper,"ui-sortable-helper"),this._mouseDrag(e),!0},_mouseDrag:function(e){var i,s,n,o,a=this.options,r=!1;for(this.position=this._generatePosition(e),this.positionAbs=this._convertPositionTo("absolute"),this.lastPositionAbs||(this.lastPositionAbs=this.positionAbs),this.options.scroll&&(this.scrollParent[0]!==this.document[0]&&"HTML"!==this.scrollParent[0].tagName?(this.overflowOffset.top+this.scrollParent[0].offsetHeight-e.pageY<a.scrollSensitivity?this.scrollParent[0].scrollTop=r=this.scrollParent[0].scrollTop+a.scrollSpeed:e.pageY-this.overflowOffset.top<a.scrollSensitivity&&(this.scrollParent[0].scrollTop=r=this.scrollParent[0].scrollTop-a.scrollSpeed),this.overflowOffset.left+this.scrollParent[0].offsetWidth-e.pageX<a.scrollSensitivity?this.scrollParent[0].scrollLeft=r=this.scrollParent[0].scrollLeft+a.scrollSpeed:e.pageX-this.overflowOffset.left<a.scrollSensitivity&&(this.scrollParent[0].scrollLeft=r=this.scrollParent[0].scrollLeft-a.scrollSpeed)):(e.pageY-this.document.scrollTop()<a.scrollSensitivity?r=this.document.scrollTop(this.document.scrollTop()-a.scrollSpeed):this.window.height()-(e.pageY-this.document.scrollTop())<a.scrollSensitivity&&(r=this.document.scrollTop(this.document.scrollTop()+a.scrollSpeed)),e.pageX-this.document.scrollLeft()<a.scrollSensitivity?r=this.document.scrollLeft(this.document.scrollLeft()-a.scrollSpeed):this.window.width()-(e.pageX-this.document.scrollLeft())<a.scrollSensitivity&&(r=this.document.scrollLeft(this.document.scrollLeft()+a.scrollSpeed))),r!==!1&&t.ui.ddmanager&&!a.dropBehaviour&&t.ui.ddmanager.prepareOffsets(this,e)),this.positionAbs=this._convertPositionTo("absolute"),this.options.axis&&"y"===this.options.axis||(this.helper[0].style.left=this.position.left+"px"),this.options.axis&&"x"===this.options.axis||(this.helper[0].style.top=this.position.top+"px"),i=this.items.length-1;i>=0;i--)if(s=this.items[i],n=s.item[0],o=this._intersectsWithPointer(s),o&&s.instance===this.currentContainer&&n!==this.currentItem[0]&&this.placeholder[1===o?"next":"prev"]()[0]!==n&&!t.contains(this.placeholder[0],n)&&("semi-dynamic"===this.options.type?!t.contains(this.element[0],n):!0)){if(this.direction=1===o?"down":"up","pointer"!==this.options.tolerance&&!this._intersectsWithSides(s))break;this._rearrange(e,s),this._trigger("change",e,this._uiHash());break}return this._contactContainers(e),t.ui.ddmanager&&t.ui.ddmanager.drag(this,e),this._trigger("sort",e,this._uiHash()),this.lastPositionAbs=this.positionAbs,!1},_mouseStop:function(e,i){if(e){if(t.ui.ddmanager&&!this.options.dropBehaviour&&t.ui.ddmanager.drop(this,e),this.options.revert){var s=this,n=this.placeholder.offset(),o=this.options.axis,a={};o&&"x"!==o||(a.left=n.left-this.offset.parent.left-this.margins.left+(this.offsetParent[0]===this.document[0].body?0:this.offsetParent[0].scrollLeft)),o&&"y"!==o||(a.top=n.top-this.offset.parent.top-this.margins.top+(this.offsetParent[0]===this.document[0].body?0:this.offsetParent[0].scrollTop)),this.reverting=!0,t(this.helper).animate(a,parseInt(this.options.revert,10)||500,function(){s._clear(e)})}else this._clear(e,i);return!1}},cancel:function(){if(this.dragging){this._mouseUp(new t.Event("mouseup",{target:null})),"original"===this.options.helper?(this.currentItem.css(this._storedCSS),this._removeClass(this.currentItem,"ui-sortable-helper")):this.currentItem.show();for(var e=this.containers.length-1;e>=0;e--)this.containers[e]._trigger("deactivate",null,this._uiHash(this)),this.containers[e].containerCache.over&&(this.containers[e]._trigger("out",null,this._uiHash(this)),this.containers[e].containerCache.over=0)}return this.placeholder&&(this.placeholder[0].parentNode&&this.placeholder[0].parentNode.removeChild(this.placeholder[0]),"original"!==this.options.helper&&this.helper&&this.helper[0].parentNode&&this.helper.remove(),t.extend(this,{helper:null,dragging:!1,reverting:!1,_noFinalSort:null}),this.domPosition.prev?t(this.domPosition.prev).after(this.currentItem):t(this.domPosition.parent).prepend(this.currentItem)),this},serialize:function(e){var i=this._getItemsAsjQuery(e&&e.connected),s=[];return e=e||{},t(i).each(function(){var i=(t(e.item||this).attr(e.attribute||"id")||"").match(e.expression||/(.+)[\-=_](.+)/);i&&s.push((e.key||i[1]+"[]")+"="+(e.key&&e.expression?i[1]:i[2]))}),!s.length&&e.key&&s.push(e.key+"="),s.join("&")},toArray:function(e){var i=this._getItemsAsjQuery(e&&e.connected),s=[];return e=e||{},i.each(function(){s.push(t(e.item||this).attr(e.attribute||"id")||"")}),s},_intersectsWith:function(t){var e=this.positionAbs.left,i=e+this.helperProportions.width,s=this.positionAbs.top,n=s+this.helperProportions.height,o=t.left,a=o+t.width,r=t.top,h=r+t.height,l=this.offset.click.top,c=this.offset.click.left,u="x"===this.options.axis||s+l>r&&h>s+l,d="y"===this.options.axis||e+c>o&&a>e+c,p=u&&d;return"pointer"===this.options.tolerance||this.options.forcePointerForContainers||"pointer"!==this.options.tolerance&&this.helperProportions[this.floating?"width":"height"]>t[this.floating?"width":"height"]?p:e+this.helperProportions.width/2>o&&a>i-this.helperProportions.width/2&&s+this.helperProportions.height/2>r&&h>n-this.helperProportions.height/2},_intersectsWithPointer:function(t){var e,i,s="x"===this.options.axis||this._isOverAxis(this.positionAbs.top+this.offset.click.top,t.top,t.height),n="y"===this.options.axis||this._isOverAxis(this.positionAbs.left+this.offset.click.left,t.left,t.width),o=s&&n;return o?(e=this._getDragVerticalDirection(),i=this._getDragHorizontalDirection(),this.floating?"right"===i||"down"===e?2:1:e&&("down"===e?2:1)):!1},_intersectsWithSides:function(t){var e=this._isOverAxis(this.positionAbs.top+this.offset.click.top,t.top+t.height/2,t.height),i=this._isOverAxis(this.positionAbs.left+this.offset.click.left,t.left+t.width/2,t.width),s=this._getDragVerticalDirection(),n=this._getDragHorizontalDirection();return this.floating&&n?"right"===n&&i||"left"===n&&!i:s&&("down"===s&&e||"up"===s&&!e)},_getDragVerticalDirection:function(){var t=this.positionAbs.top-this.lastPositionAbs.top;return 0!==t&&(t>0?"down":"up")},_getDragHorizontalDirection:function(){var t=this.positionAbs.left-this.lastPositionAbs.left;return 0!==t&&(t>0?"right":"left")},refresh:function(t){return this._refreshItems(t),this._setHandleClassName(),this.refreshPositions(),this},_connectWith:function(){var t=this.options;return t.connectWith.constructor===String?[t.connectWith]:t.connectWith},_getItemsAsjQuery:function(e){function i(){r.push(this)}var s,n,o,a,r=[],h=[],l=this._connectWith();if(l&&e)for(s=l.length-1;s>=0;s--)for(o=t(l[s],this.document[0]),n=o.length-1;n>=0;n--)a=t.data(o[n],this.widgetFullName),a&&a!==this&&!a.options.disabled&&h.push([t.isFunction(a.options.items)?a.options.items.call(a.element):t(a.options.items,a.element).not(".ui-sortable-helper").not(".ui-sortable-placeholder"),a]);for(h.push([t.isFunction(this.options.items)?this.options.items.call(this.element,null,{options:this.options,item:this.currentItem}):t(this.options.items,this.element).not(".ui-sortable-helper").not(".ui-sortable-placeholder"),this]),s=h.length-1;s>=0;s--)h[s][0].each(i);return t(r)},_removeCurrentsFromItems:function(){var e=this.currentItem.find(":data("+this.widgetName+"-item)");this.items=t.grep(this.items,function(t){for(var i=0;e.length>i;i++)if(e[i]===t.item[0])return!1;return!0})},_refreshItems:function(e){this.items=[],this.containers=[this];var i,s,n,o,a,r,h,l,c=this.items,u=[[t.isFunction(this.options.items)?this.options.items.call(this.element[0],e,{item:this.currentItem}):t(this.options.items,this.element),this]],d=this._connectWith();if(d&&this.ready)for(i=d.length-1;i>=0;i--)for(n=t(d[i],this.document[0]),s=n.length-1;s>=0;s--)o=t.data(n[s],this.widgetFullName),o&&o!==this&&!o.options.disabled&&(u.push([t.isFunction(o.options.items)?o.options.items.call(o.element[0],e,{item:this.currentItem}):t(o.options.items,o.element),o]),this.containers.push(o));for(i=u.length-1;i>=0;i--)for(a=u[i][1],r=u[i][0],s=0,l=r.length;l>s;s++)h=t(r[s]),h.data(this.widgetName+"-item",a),c.push({item:h,instance:a,width:0,height:0,left:0,top:0})},refreshPositions:function(e){this.floating=this.items.length?"x"===this.options.axis||this._isFloating(this.items[0].item):!1,this.offsetParent&&this.helper&&(this.offset.parent=this._getParentOffset());var i,s,n,o;for(i=this.items.length-1;i>=0;i--)s=this.items[i],s.instance!==this.currentContainer&&this.currentContainer&&s.item[0]!==this.currentItem[0]||(n=this.options.toleranceElement?t(this.options.toleranceElement,s.item):s.item,e||(s.width=n.outerWidth(),s.height=n.outerHeight()),o=n.offset(),s.left=o.left,s.top=o.top);if(this.options.custom&&this.options.custom.refreshContainers)this.options.custom.refreshContainers.call(this);else for(i=this.containers.length-1;i>=0;i--)o=this.containers[i].element.offset(),this.containers[i].containerCache.left=o.left,this.containers[i].containerCache.top=o.top,this.containers[i].containerCache.width=this.containers[i].element.outerWidth(),this.containers[i].containerCache.height=this.containers[i].element.outerHeight();return this},_createPlaceholder:function(e){e=e||this;var i,s=e.options;s.placeholder&&s.placeholder.constructor!==String||(i=s.placeholder,s.placeholder={element:function(){var s=e.currentItem[0].nodeName.toLowerCase(),n=t("<"+s+">",e.document[0]);return e._addClass(n,"ui-sortable-placeholder",i||e.currentItem[0].className)._removeClass(n,"ui-sortable-helper"),"tbody"===s?e._createTrPlaceholder(e.currentItem.find("tr").eq(0),t("<tr>",e.document[0]).appendTo(n)):"tr"===s?e._createTrPlaceholder(e.currentItem,n):"img"===s&&n.attr("src",e.currentItem.attr("src")),i||n.css("visibility","hidden"),n},update:function(t,n){(!i||s.forcePlaceholderSize)&&(n.height()||n.height(e.currentItem.innerHeight()-parseInt(e.currentItem.css("paddingTop")||0,10)-parseInt(e.currentItem.css("paddingBottom")||0,10)),n.width()||n.width(e.currentItem.innerWidth()-parseInt(e.currentItem.css("paddingLeft")||0,10)-parseInt(e.currentItem.css("paddingRight")||0,10)))}}),e.placeholder=t(s.placeholder.element.call(e.element,e.currentItem)),e.currentItem.after(e.placeholder),s.placeholder.update(e,e.placeholder)},_createTrPlaceholder:function(e,i){var s=this;e.children().each(function(){t("<td>&#160;</td>",s.document[0]).attr("colspan",t(this).attr("colspan")||1).appendTo(i)})},_contactContainers:function(e){var i,s,n,o,a,r,h,l,c,u,d=null,p=null;for(i=this.containers.length-1;i>=0;i--)if(!t.contains(this.currentItem[0],this.containers[i].element[0]))if(this._intersectsWith(this.containers[i].containerCache)){if(d&&t.contains(this.containers[i].element[0],d.element[0]))continue;d=this.containers[i],p=i}else this.containers[i].containerCache.over&&(this.containers[i]._trigger("out",e,this._uiHash(this)),this.containers[i].containerCache.over=0);if(d)if(1===this.containers.length)this.containers[p].containerCache.over||(this.containers[p]._trigger("over",e,this._uiHash(this)),this.containers[p].containerCache.over=1);else{for(n=1e4,o=null,c=d.floating||this._isFloating(this.currentItem),a=c?"left":"top",r=c?"width":"height",u=c?"pageX":"pageY",s=this.items.length-1;s>=0;s--)t.contains(this.containers[p].element[0],this.items[s].item[0])&&this.items[s].item[0]!==this.currentItem[0]&&(h=this.items[s].item.offset()[a],l=!1,e[u]-h>this.items[s][r]/2&&(l=!0),n>Math.abs(e[u]-h)&&(n=Math.abs(e[u]-h),o=this.items[s],this.direction=l?"up":"down"));if(!o&&!this.options.dropOnEmpty)return;if(this.currentContainer===this.containers[p])return this.currentContainer.containerCache.over||(this.containers[p]._trigger("over",e,this._uiHash()),this.currentContainer.containerCache.over=1),void 0;o?this._rearrange(e,o,null,!0):this._rearrange(e,null,this.containers[p].element,!0),this._trigger("change",e,this._uiHash()),this.containers[p]._trigger("change",e,this._uiHash(this)),this.currentContainer=this.containers[p],this.options.placeholder.update(this.currentContainer,this.placeholder),this.containers[p]._trigger("over",e,this._uiHash(this)),this.containers[p].containerCache.over=1}},_createHelper:function(e){var i=this.options,s=t.isFunction(i.helper)?t(i.helper.apply(this.element[0],[e,this.currentItem])):"clone"===i.helper?this.currentItem.clone():this.currentItem;return s.parents("body").length||t("parent"!==i.appendTo?i.appendTo:this.currentItem[0].parentNode)[0].appendChild(s[0]),s[0]===this.currentItem[0]&&(this._storedCSS={width:this.currentItem[0].style.width,height:this.currentItem[0].style.height,position:this.currentItem.css("position"),top:this.currentItem.css("top"),left:this.currentItem.css("left")}),(!s[0].style.width||i.forceHelperSize)&&s.width(this.currentItem.width()),(!s[0].style.height||i.forceHelperSize)&&s.height(this.currentItem.height()),s},_adjustOffsetFromHelper:function(e){"string"==typeof e&&(e=e.split(" ")),t.isArray(e)&&(e={left:+e[0],top:+e[1]||0}),"left"in e&&(this.offset.click.left=e.left+this.margins.left),"right"in e&&(this.offset.click.left=this.helperProportions.width-e.right+this.margins.left),"top"in e&&(this.offset.click.top=e.top+this.margins.top),"bottom"in e&&(this.offset.click.top=this.helperProportions.height-e.bottom+this.margins.top)},_getParentOffset:function(){this.offsetParent=this.helper.offsetParent();var e=this.offsetParent.offset();return"absolute"===this.cssPosition&&this.scrollParent[0]!==this.document[0]&&t.contains(this.scrollParent[0],this.offsetParent[0])&&(e.left+=this.scrollParent.scrollLeft(),e.top+=this.scrollParent.scrollTop()),(this.offsetParent[0]===this.document[0].body||this.offsetParent[0].tagName&&"html"===this.offsetParent[0].tagName.toLowerCase()&&t.ui.ie)&&(e={top:0,left:0}),{top:e.top+(parseInt(this.offsetParent.css("borderTopWidth"),10)||0),left:e.left+(parseInt(this.offsetParent.css("borderLeftWidth"),10)||0)}},_getRelativeOffset:function(){if("relative"===this.cssPosition){var t=this.currentItem.position();return{top:t.top-(parseInt(this.helper.css("top"),10)||0)+this.scrollParent.scrollTop(),left:t.left-(parseInt(this.helper.css("left"),10)||0)+this.scrollParent.scrollLeft()}}return{top:0,left:0}},_cacheMargins:function(){this.margins={left:parseInt(this.currentItem.css("marginLeft"),10)||0,top:parseInt(this.currentItem.css("marginTop"),10)||0}},_cacheHelperProportions:function(){this.helperProportions={width:this.helper.outerWidth(),height:this.helper.outerHeight()}},_setContainment:function(){var e,i,s,n=this.options;"parent"===n.containment&&(n.containment=this.helper[0].parentNode),("document"===n.containment||"window"===n.containment)&&(this.containment=[0-this.offset.relative.left-this.offset.parent.left,0-this.offset.relative.top-this.offset.parent.top,"document"===n.containment?this.document.width():this.window.width()-this.helperProportions.width-this.margins.left,("document"===n.containment?this.document.height()||document.body.parentNode.scrollHeight:this.window.height()||this.document[0].body.parentNode.scrollHeight)-this.helperProportions.height-this.margins.top]),/^(document|window|parent)$/.test(n.containment)||(e=t(n.containment)[0],i=t(n.containment).offset(),s="hidden"!==t(e).css("overflow"),this.containment=[i.left+(parseInt(t(e).css("borderLeftWidth"),10)||0)+(parseInt(t(e).css("paddingLeft"),10)||0)-this.margins.left,i.top+(parseInt(t(e).css("borderTopWidth"),10)||0)+(parseInt(t(e).css("paddingTop"),10)||0)-this.margins.top,i.left+(s?Math.max(e.scrollWidth,e.offsetWidth):e.offsetWidth)-(parseInt(t(e).css("borderLeftWidth"),10)||0)-(parseInt(t(e).css("paddingRight"),10)||0)-this.helperProportions.width-this.margins.left,i.top+(s?Math.max(e.scrollHeight,e.offsetHeight):e.offsetHeight)-(parseInt(t(e).css("borderTopWidth"),10)||0)-(parseInt(t(e).css("paddingBottom"),10)||0)-this.helperProportions.height-this.margins.top])},_convertPositionTo:function(e,i){i||(i=this.position);var s="absolute"===e?1:-1,n="absolute"!==this.cssPosition||this.scrollParent[0]!==this.document[0]&&t.contains(this.scrollParent[0],this.offsetParent[0])?this.scrollParent:this.offsetParent,o=/(html|body)/i.test(n[0].tagName);return{top:i.top+this.offset.relative.top*s+this.offset.parent.top*s-("fixed"===this.cssPosition?-this.scrollParent.scrollTop():o?0:n.scrollTop())*s,left:i.left+this.offset.relative.left*s+this.offset.parent.left*s-("fixed"===this.cssPosition?-this.scrollParent.scrollLeft():o?0:n.scrollLeft())*s}},_generatePosition:function(e){var i,s,n=this.options,o=e.pageX,a=e.pageY,r="absolute"!==this.cssPosition||this.scrollParent[0]!==this.document[0]&&t.contains(this.scrollParent[0],this.offsetParent[0])?this.scrollParent:this.offsetParent,h=/(html|body)/i.test(r[0].tagName);return"relative"!==this.cssPosition||this.scrollParent[0]!==this.document[0]&&this.scrollParent[0]!==this.offsetParent[0]||(this.offset.relative=this._getRelativeOffset()),this.originalPosition&&(this.containment&&(e.pageX-this.offset.click.left<this.containment[0]&&(o=this.containment[0]+this.offset.click.left),e.pageY-this.offset.click.top<this.containment[1]&&(a=this.containment[1]+this.offset.click.top),e.pageX-this.offset.click.left>this.containment[2]&&(o=this.containment[2]+this.offset.click.left),e.pageY-this.offset.click.top>this.containment[3]&&(a=this.containment[3]+this.offset.click.top)),n.grid&&(i=this.originalPageY+Math.round((a-this.originalPageY)/n.grid[1])*n.grid[1],a=this.containment?i-this.offset.click.top>=this.containment[1]&&i-this.offset.click.top<=this.containment[3]?i:i-this.offset.click.top>=this.containment[1]?i-n.grid[1]:i+n.grid[1]:i,s=this.originalPageX+Math.round((o-this.originalPageX)/n.grid[0])*n.grid[0],o=this.containment?s-this.offset.click.left>=this.containment[0]&&s-this.offset.click.left<=this.containment[2]?s:s-this.offset.click.left>=this.containment[0]?s-n.grid[0]:s+n.grid[0]:s)),{top:a-this.offset.click.top-this.offset.relative.top-this.offset.parent.top+("fixed"===this.cssPosition?-this.scrollParent.scrollTop():h?0:r.scrollTop()),left:o-this.offset.click.left-this.offset.relative.left-this.offset.parent.left+("fixed"===this.cssPosition?-this.scrollParent.scrollLeft():h?0:r.scrollLeft())}},_rearrange:function(t,e,i,s){i?i[0].appendChild(this.placeholder[0]):e.item[0].parentNode.insertBefore(this.placeholder[0],"down"===this.direction?e.item[0]:e.item[0].nextSibling),this.counter=this.counter?++this.counter:1;var n=this.counter;
this._delay(function(){n===this.counter&&this.refreshPositions(!s)})},_clear:function(t,e){function i(t,e,i){return function(s){i._trigger(t,s,e._uiHash(e))}}this.reverting=!1;var s,n=[];if(!this._noFinalSort&&this.currentItem.parent().length&&this.placeholder.before(this.currentItem),this._noFinalSort=null,this.helper[0]===this.currentItem[0]){for(s in this._storedCSS)("auto"===this._storedCSS[s]||"static"===this._storedCSS[s])&&(this._storedCSS[s]="");this.currentItem.css(this._storedCSS),this._removeClass(this.currentItem,"ui-sortable-helper")}else this.currentItem.show();for(this.fromOutside&&!e&&n.push(function(t){this._trigger("receive",t,this._uiHash(this.fromOutside))}),!this.fromOutside&&this.domPosition.prev===this.currentItem.prev().not(".ui-sortable-helper")[0]&&this.domPosition.parent===this.currentItem.parent()[0]||e||n.push(function(t){this._trigger("update",t,this._uiHash())}),this!==this.currentContainer&&(e||(n.push(function(t){this._trigger("remove",t,this._uiHash())}),n.push(function(t){return function(e){t._trigger("receive",e,this._uiHash(this))}}.call(this,this.currentContainer)),n.push(function(t){return function(e){t._trigger("update",e,this._uiHash(this))}}.call(this,this.currentContainer)))),s=this.containers.length-1;s>=0;s--)e||n.push(i("deactivate",this,this.containers[s])),this.containers[s].containerCache.over&&(n.push(i("out",this,this.containers[s])),this.containers[s].containerCache.over=0);if(this.storedCursor&&(this.document.find("body").css("cursor",this.storedCursor),this.storedStylesheet.remove()),this._storedOpacity&&this.helper.css("opacity",this._storedOpacity),this._storedZIndex&&this.helper.css("zIndex","auto"===this._storedZIndex?"":this._storedZIndex),this.dragging=!1,e||this._trigger("beforeStop",t,this._uiHash()),this.placeholder[0].parentNode.removeChild(this.placeholder[0]),this.cancelHelperRemoval||(this.helper[0]!==this.currentItem[0]&&this.helper.remove(),this.helper=null),!e){for(s=0;n.length>s;s++)n[s].call(this,t);this._trigger("stop",t,this._uiHash())}return this.fromOutside=!1,!this.cancelHelperRemoval},_trigger:function(){t.Widget.prototype._trigger.apply(this,arguments)===!1&&this.cancel()},_uiHash:function(e){var i=e||this;return{helper:i.helper,placeholder:i.placeholder||t([]),position:i.position,originalPosition:i.originalPosition,offset:i.positionAbs,item:i.currentItem,sender:e?e.element:null}}}),t.widget("ui.spinner",{version:"1.12.1",defaultElement:"<input>",widgetEventPrefix:"spin",options:{classes:{"ui-spinner":"ui-corner-all","ui-spinner-down":"ui-corner-br","ui-spinner-up":"ui-corner-tr"},culture:null,icons:{down:"ui-icon-triangle-1-s",up:"ui-icon-triangle-1-n"},incremental:!0,max:null,min:null,numberFormat:null,page:10,step:1,change:null,spin:null,start:null,stop:null},_create:function(){this._setOption("max",this.options.max),this._setOption("min",this.options.min),this._setOption("step",this.options.step),""!==this.value()&&this._value(this.element.val(),!0),this._draw(),this._on(this._events),this._refresh(),this._on(this.window,{beforeunload:function(){this.element.removeAttr("autocomplete")}})},_getCreateOptions:function(){var e=this._super(),i=this.element;return t.each(["min","max","step"],function(t,s){var n=i.attr(s);null!=n&&n.length&&(e[s]=n)}),e},_events:{keydown:function(t){this._start(t)&&this._keydown(t)&&t.preventDefault()},keyup:"_stop",focus:function(){this.previous=this.element.val()},blur:function(t){return this.cancelBlur?(delete this.cancelBlur,void 0):(this._stop(),this._refresh(),this.previous!==this.element.val()&&this._trigger("change",t),void 0)},mousewheel:function(t,e){if(e){if(!this.spinning&&!this._start(t))return!1;this._spin((e>0?1:-1)*this.options.step,t),clearTimeout(this.mousewheelTimer),this.mousewheelTimer=this._delay(function(){this.spinning&&this._stop(t)},100),t.preventDefault()}},"mousedown .ui-spinner-button":function(e){function i(){var e=this.element[0]===t.ui.safeActiveElement(this.document[0]);e||(this.element.trigger("focus"),this.previous=s,this._delay(function(){this.previous=s}))}var s;s=this.element[0]===t.ui.safeActiveElement(this.document[0])?this.previous:this.element.val(),e.preventDefault(),i.call(this),this.cancelBlur=!0,this._delay(function(){delete this.cancelBlur,i.call(this)}),this._start(e)!==!1&&this._repeat(null,t(e.currentTarget).hasClass("ui-spinner-up")?1:-1,e)},"mouseup .ui-spinner-button":"_stop","mouseenter .ui-spinner-button":function(e){return t(e.currentTarget).hasClass("ui-state-active")?this._start(e)===!1?!1:(this._repeat(null,t(e.currentTarget).hasClass("ui-spinner-up")?1:-1,e),void 0):void 0},"mouseleave .ui-spinner-button":"_stop"},_enhance:function(){this.uiSpinner=this.element.attr("autocomplete","off").wrap("<span>").parent().append("<a></a><a></a>")},_draw:function(){this._enhance(),this._addClass(this.uiSpinner,"ui-spinner","ui-widget ui-widget-content"),this._addClass("ui-spinner-input"),this.element.attr("role","spinbutton"),this.buttons=this.uiSpinner.children("a").attr("tabIndex",-1).attr("aria-hidden",!0).button({classes:{"ui-button":""}}),this._removeClass(this.buttons,"ui-corner-all"),this._addClass(this.buttons.first(),"ui-spinner-button ui-spinner-up"),this._addClass(this.buttons.last(),"ui-spinner-button ui-spinner-down"),this.buttons.first().button({icon:this.options.icons.up,showLabel:!1}),this.buttons.last().button({icon:this.options.icons.down,showLabel:!1}),this.buttons.height()>Math.ceil(.5*this.uiSpinner.height())&&this.uiSpinner.height()>0&&this.uiSpinner.height(this.uiSpinner.height())},_keydown:function(e){var i=this.options,s=t.ui.keyCode;switch(e.keyCode){case s.UP:return this._repeat(null,1,e),!0;case s.DOWN:return this._repeat(null,-1,e),!0;case s.PAGE_UP:return this._repeat(null,i.page,e),!0;case s.PAGE_DOWN:return this._repeat(null,-i.page,e),!0}return!1},_start:function(t){return this.spinning||this._trigger("start",t)!==!1?(this.counter||(this.counter=1),this.spinning=!0,!0):!1},_repeat:function(t,e,i){t=t||500,clearTimeout(this.timer),this.timer=this._delay(function(){this._repeat(40,e,i)},t),this._spin(e*this.options.step,i)},_spin:function(t,e){var i=this.value()||0;this.counter||(this.counter=1),i=this._adjustValue(i+t*this._increment(this.counter)),this.spinning&&this._trigger("spin",e,{value:i})===!1||(this._value(i),this.counter++)},_increment:function(e){var i=this.options.incremental;return i?t.isFunction(i)?i(e):Math.floor(e*e*e/5e4-e*e/500+17*e/200+1):1},_precision:function(){var t=this._precisionOf(this.options.step);return null!==this.options.min&&(t=Math.max(t,this._precisionOf(this.options.min))),t},_precisionOf:function(t){var e=""+t,i=e.indexOf(".");return-1===i?0:e.length-i-1},_adjustValue:function(t){var e,i,s=this.options;return e=null!==s.min?s.min:0,i=t-e,i=Math.round(i/s.step)*s.step,t=e+i,t=parseFloat(t.toFixed(this._precision())),null!==s.max&&t>s.max?s.max:null!==s.min&&s.min>t?s.min:t},_stop:function(t){this.spinning&&(clearTimeout(this.timer),clearTimeout(this.mousewheelTimer),this.counter=0,this.spinning=!1,this._trigger("stop",t))},_setOption:function(t,e){var i,s,n;return"culture"===t||"numberFormat"===t?(i=this._parse(this.element.val()),this.options[t]=e,this.element.val(this._format(i)),void 0):(("max"===t||"min"===t||"step"===t)&&"string"==typeof e&&(e=this._parse(e)),"icons"===t&&(s=this.buttons.first().find(".ui-icon"),this._removeClass(s,null,this.options.icons.up),this._addClass(s,null,e.up),n=this.buttons.last().find(".ui-icon"),this._removeClass(n,null,this.options.icons.down),this._addClass(n,null,e.down)),this._super(t,e),void 0)},_setOptionDisabled:function(t){this._super(t),this._toggleClass(this.uiSpinner,null,"ui-state-disabled",!!t),this.element.prop("disabled",!!t),this.buttons.button(t?"disable":"enable")},_setOptions:r(function(t){this._super(t)}),_parse:function(t){return"string"==typeof t&&""!==t&&(t=window.Globalize&&this.options.numberFormat?Globalize.parseFloat(t,10,this.options.culture):+t),""===t||isNaN(t)?null:t},_format:function(t){return""===t?"":window.Globalize&&this.options.numberFormat?Globalize.format(t,this.options.numberFormat,this.options.culture):t},_refresh:function(){this.element.attr({"aria-valuemin":this.options.min,"aria-valuemax":this.options.max,"aria-valuenow":this._parse(this.element.val())})},isValid:function(){var t=this.value();return null===t?!1:t===this._adjustValue(t)},_value:function(t,e){var i;""!==t&&(i=this._parse(t),null!==i&&(e||(i=this._adjustValue(i)),t=this._format(i))),this.element.val(t),this._refresh()},_destroy:function(){this.element.prop("disabled",!1).removeAttr("autocomplete role aria-valuemin aria-valuemax aria-valuenow"),this.uiSpinner.replaceWith(this.element)},stepUp:r(function(t){this._stepUp(t)}),_stepUp:function(t){this._start()&&(this._spin((t||1)*this.options.step),this._stop())},stepDown:r(function(t){this._stepDown(t)}),_stepDown:function(t){this._start()&&(this._spin((t||1)*-this.options.step),this._stop())},pageUp:r(function(t){this._stepUp((t||1)*this.options.page)}),pageDown:r(function(t){this._stepDown((t||1)*this.options.page)}),value:function(t){return arguments.length?(r(this._value).call(this,t),void 0):this._parse(this.element.val())},widget:function(){return this.uiSpinner}}),t.uiBackCompat!==!1&&t.widget("ui.spinner",t.ui.spinner,{_enhance:function(){this.uiSpinner=this.element.attr("autocomplete","off").wrap(this._uiSpinnerHtml()).parent().append(this._buttonHtml())},_uiSpinnerHtml:function(){return"<span>"},_buttonHtml:function(){return"<a></a><a></a>"}}),t.ui.spinner,t.widget("ui.tabs",{version:"1.12.1",delay:300,options:{active:null,classes:{"ui-tabs":"ui-corner-all","ui-tabs-nav":"ui-corner-all","ui-tabs-panel":"ui-corner-bottom","ui-tabs-tab":"ui-corner-top"},collapsible:!1,event:"click",heightStyle:"content",hide:null,show:null,activate:null,beforeActivate:null,beforeLoad:null,load:null},_isLocal:function(){var t=/#.*$/;return function(e){var i,s;i=e.href.replace(t,""),s=location.href.replace(t,"");try{i=decodeURIComponent(i)}catch(n){}try{s=decodeURIComponent(s)}catch(n){}return e.hash.length>1&&i===s}}(),_create:function(){var e=this,i=this.options;this.running=!1,this._addClass("ui-tabs","ui-widget ui-widget-content"),this._toggleClass("ui-tabs-collapsible",null,i.collapsible),this._processTabs(),i.active=this._initialActive(),t.isArray(i.disabled)&&(i.disabled=t.unique(i.disabled.concat(t.map(this.tabs.filter(".ui-state-disabled"),function(t){return e.tabs.index(t)}))).sort()),this.active=this.options.active!==!1&&this.anchors.length?this._findActive(i.active):t(),this._refresh(),this.active.length&&this.load(i.active)},_initialActive:function(){var e=this.options.active,i=this.options.collapsible,s=location.hash.substring(1);return null===e&&(s&&this.tabs.each(function(i,n){return t(n).attr("aria-controls")===s?(e=i,!1):void 0}),null===e&&(e=this.tabs.index(this.tabs.filter(".ui-tabs-active"))),(null===e||-1===e)&&(e=this.tabs.length?0:!1)),e!==!1&&(e=this.tabs.index(this.tabs.eq(e)),-1===e&&(e=i?!1:0)),!i&&e===!1&&this.anchors.length&&(e=0),e},_getCreateEventData:function(){return{tab:this.active,panel:this.active.length?this._getPanelForTab(this.active):t()}},_tabKeydown:function(e){var i=t(t.ui.safeActiveElement(this.document[0])).closest("li"),s=this.tabs.index(i),n=!0;if(!this._handlePageNav(e)){switch(e.keyCode){case t.ui.keyCode.RIGHT:case t.ui.keyCode.DOWN:s++;break;case t.ui.keyCode.UP:case t.ui.keyCode.LEFT:n=!1,s--;break;case t.ui.keyCode.END:s=this.anchors.length-1;break;case t.ui.keyCode.HOME:s=0;break;case t.ui.keyCode.SPACE:return e.preventDefault(),clearTimeout(this.activating),this._activate(s),void 0;case t.ui.keyCode.ENTER:return e.preventDefault(),clearTimeout(this.activating),this._activate(s===this.options.active?!1:s),void 0;default:return}e.preventDefault(),clearTimeout(this.activating),s=this._focusNextTab(s,n),e.ctrlKey||e.metaKey||(i.attr("aria-selected","false"),this.tabs.eq(s).attr("aria-selected","true"),this.activating=this._delay(function(){this.option("active",s)},this.delay))}},_panelKeydown:function(e){this._handlePageNav(e)||e.ctrlKey&&e.keyCode===t.ui.keyCode.UP&&(e.preventDefault(),this.active.trigger("focus"))},_handlePageNav:function(e){return e.altKey&&e.keyCode===t.ui.keyCode.PAGE_UP?(this._activate(this._focusNextTab(this.options.active-1,!1)),!0):e.altKey&&e.keyCode===t.ui.keyCode.PAGE_DOWN?(this._activate(this._focusNextTab(this.options.active+1,!0)),!0):void 0},_findNextTab:function(e,i){function s(){return e>n&&(e=0),0>e&&(e=n),e}for(var n=this.tabs.length-1;-1!==t.inArray(s(),this.options.disabled);)e=i?e+1:e-1;return e},_focusNextTab:function(t,e){return t=this._findNextTab(t,e),this.tabs.eq(t).trigger("focus"),t},_setOption:function(t,e){return"active"===t?(this._activate(e),void 0):(this._super(t,e),"collapsible"===t&&(this._toggleClass("ui-tabs-collapsible",null,e),e||this.options.active!==!1||this._activate(0)),"event"===t&&this._setupEvents(e),"heightStyle"===t&&this._setupHeightStyle(e),void 0)},_sanitizeSelector:function(t){return t?t.replace(/[!"$%&'()*+,.\/:;<=>?@\[\]\^`{|}~]/g,"\\$&"):""},refresh:function(){var e=this.options,i=this.tablist.children(":has(a[href])");e.disabled=t.map(i.filter(".ui-state-disabled"),function(t){return i.index(t)}),this._processTabs(),e.active!==!1&&this.anchors.length?this.active.length&&!t.contains(this.tablist[0],this.active[0])?this.tabs.length===e.disabled.length?(e.active=!1,this.active=t()):this._activate(this._findNextTab(Math.max(0,e.active-1),!1)):e.active=this.tabs.index(this.active):(e.active=!1,this.active=t()),this._refresh()},_refresh:function(){this._setOptionDisabled(this.options.disabled),this._setupEvents(this.options.event),this._setupHeightStyle(this.options.heightStyle),this.tabs.not(this.active).attr({"aria-selected":"false","aria-expanded":"false",tabIndex:-1}),this.panels.not(this._getPanelForTab(this.active)).hide().attr({"aria-hidden":"true"}),this.active.length?(this.active.attr({"aria-selected":"true","aria-expanded":"true",tabIndex:0}),this._addClass(this.active,"ui-tabs-active","ui-state-active"),this._getPanelForTab(this.active).show().attr({"aria-hidden":"false"})):this.tabs.eq(0).attr("tabIndex",0)},_processTabs:function(){var e=this,i=this.tabs,s=this.anchors,n=this.panels;this.tablist=this._getList().attr("role","tablist"),this._addClass(this.tablist,"ui-tabs-nav","ui-helper-reset ui-helper-clearfix ui-widget-header"),this.tablist.on("mousedown"+this.eventNamespace,"> li",function(e){t(this).is(".ui-state-disabled")&&e.preventDefault()}).on("focus"+this.eventNamespace,".ui-tabs-anchor",function(){t(this).closest("li").is(".ui-state-disabled")&&this.blur()}),this.tabs=this.tablist.find("> li:has(a[href])").attr({role:"tab",tabIndex:-1}),this._addClass(this.tabs,"ui-tabs-tab","ui-state-default"),this.anchors=this.tabs.map(function(){return t("a",this)[0]}).attr({role:"presentation",tabIndex:-1}),this._addClass(this.anchors,"ui-tabs-anchor"),this.panels=t(),this.anchors.each(function(i,s){var n,o,a,r=t(s).uniqueId().attr("id"),h=t(s).closest("li"),l=h.attr("aria-controls");e._isLocal(s)?(n=s.hash,a=n.substring(1),o=e.element.find(e._sanitizeSelector(n))):(a=h.attr("aria-controls")||t({}).uniqueId()[0].id,n="#"+a,o=e.element.find(n),o.length||(o=e._createPanel(a),o.insertAfter(e.panels[i-1]||e.tablist)),o.attr("aria-live","polite")),o.length&&(e.panels=e.panels.add(o)),l&&h.data("ui-tabs-aria-controls",l),h.attr({"aria-controls":a,"aria-labelledby":r}),o.attr("aria-labelledby",r)}),this.panels.attr("role","tabpanel"),this._addClass(this.panels,"ui-tabs-panel","ui-widget-content"),i&&(this._off(i.not(this.tabs)),this._off(s.not(this.anchors)),this._off(n.not(this.panels)))},_getList:function(){return this.tablist||this.element.find("ol, ul").eq(0)},_createPanel:function(e){return t("<div>").attr("id",e).data("ui-tabs-destroy",!0)},_setOptionDisabled:function(e){var i,s,n;for(t.isArray(e)&&(e.length?e.length===this.anchors.length&&(e=!0):e=!1),n=0;s=this.tabs[n];n++)i=t(s),e===!0||-1!==t.inArray(n,e)?(i.attr("aria-disabled","true"),this._addClass(i,null,"ui-state-disabled")):(i.removeAttr("aria-disabled"),this._removeClass(i,null,"ui-state-disabled"));this.options.disabled=e,this._toggleClass(this.widget(),this.widgetFullName+"-disabled",null,e===!0)},_setupEvents:function(e){var i={};e&&t.each(e.split(" "),function(t,e){i[e]="_eventHandler"}),this._off(this.anchors.add(this.tabs).add(this.panels)),this._on(!0,this.anchors,{click:function(t){t.preventDefault()}}),this._on(this.anchors,i),this._on(this.tabs,{keydown:"_tabKeydown"}),this._on(this.panels,{keydown:"_panelKeydown"}),this._focusable(this.tabs),this._hoverable(this.tabs)},_setupHeightStyle:function(e){var i,s=this.element.parent();"fill"===e?(i=s.height(),i-=this.element.outerHeight()-this.element.height(),this.element.siblings(":visible").each(function(){var e=t(this),s=e.css("position");"absolute"!==s&&"fixed"!==s&&(i-=e.outerHeight(!0))}),this.element.children().not(this.panels).each(function(){i-=t(this).outerHeight(!0)}),this.panels.each(function(){t(this).height(Math.max(0,i-t(this).innerHeight()+t(this).height()))}).css("overflow","auto")):"auto"===e&&(i=0,this.panels.each(function(){i=Math.max(i,t(this).height("").height())}).height(i))},_eventHandler:function(e){var i=this.options,s=this.active,n=t(e.currentTarget),o=n.closest("li"),a=o[0]===s[0],r=a&&i.collapsible,h=r?t():this._getPanelForTab(o),l=s.length?this._getPanelForTab(s):t(),c={oldTab:s,oldPanel:l,newTab:r?t():o,newPanel:h};e.preventDefault(),o.hasClass("ui-state-disabled")||o.hasClass("ui-tabs-loading")||this.running||a&&!i.collapsible||this._trigger("beforeActivate",e,c)===!1||(i.active=r?!1:this.tabs.index(o),this.active=a?t():o,this.xhr&&this.xhr.abort(),l.length||h.length||t.error("jQuery UI Tabs: Mismatching fragment identifier."),h.length&&this.load(this.tabs.index(o),e),this._toggle(e,c))},_toggle:function(e,i){function s(){o.running=!1,o._trigger("activate",e,i)}function n(){o._addClass(i.newTab.closest("li"),"ui-tabs-active","ui-state-active"),a.length&&o.options.show?o._show(a,o.options.show,s):(a.show(),s())}var o=this,a=i.newPanel,r=i.oldPanel;this.running=!0,r.length&&this.options.hide?this._hide(r,this.options.hide,function(){o._removeClass(i.oldTab.closest("li"),"ui-tabs-active","ui-state-active"),n()}):(this._removeClass(i.oldTab.closest("li"),"ui-tabs-active","ui-state-active"),r.hide(),n()),r.attr("aria-hidden","true"),i.oldTab.attr({"aria-selected":"false","aria-expanded":"false"}),a.length&&r.length?i.oldTab.attr("tabIndex",-1):a.length&&this.tabs.filter(function(){return 0===t(this).attr("tabIndex")}).attr("tabIndex",-1),a.attr("aria-hidden","false"),i.newTab.attr({"aria-selected":"true","aria-expanded":"true",tabIndex:0})},_activate:function(e){var i,s=this._findActive(e);s[0]!==this.active[0]&&(s.length||(s=this.active),i=s.find(".ui-tabs-anchor")[0],this._eventHandler({target:i,currentTarget:i,preventDefault:t.noop}))},_findActive:function(e){return e===!1?t():this.tabs.eq(e)},_getIndex:function(e){return"string"==typeof e&&(e=this.anchors.index(this.anchors.filter("[href$='"+t.ui.escapeSelector(e)+"']"))),e},_destroy:function(){this.xhr&&this.xhr.abort(),this.tablist.removeAttr("role").off(this.eventNamespace),this.anchors.removeAttr("role tabIndex").removeUniqueId(),this.tabs.add(this.panels).each(function(){t.data(this,"ui-tabs-destroy")?t(this).remove():t(this).removeAttr("role tabIndex aria-live aria-busy aria-selected aria-labelledby aria-hidden aria-expanded")}),this.tabs.each(function(){var e=t(this),i=e.data("ui-tabs-aria-controls");i?e.attr("aria-controls",i).removeData("ui-tabs-aria-controls"):e.removeAttr("aria-controls")}),this.panels.show(),"content"!==this.options.heightStyle&&this.panels.css("height","")},enable:function(e){var i=this.options.disabled;i!==!1&&(void 0===e?i=!1:(e=this._getIndex(e),i=t.isArray(i)?t.map(i,function(t){return t!==e?t:null}):t.map(this.tabs,function(t,i){return i!==e?i:null})),this._setOptionDisabled(i))},disable:function(e){var i=this.options.disabled;if(i!==!0){if(void 0===e)i=!0;else{if(e=this._getIndex(e),-1!==t.inArray(e,i))return;i=t.isArray(i)?t.merge([e],i).sort():[e]}this._setOptionDisabled(i)}},load:function(e,i){e=this._getIndex(e);var s=this,n=this.tabs.eq(e),o=n.find(".ui-tabs-anchor"),a=this._getPanelForTab(n),r={tab:n,panel:a},h=function(t,e){"abort"===e&&s.panels.stop(!1,!0),s._removeClass(n,"ui-tabs-loading"),a.removeAttr("aria-busy"),t===s.xhr&&delete s.xhr};this._isLocal(o[0])||(this.xhr=t.ajax(this._ajaxSettings(o,i,r)),this.xhr&&"canceled"!==this.xhr.statusText&&(this._addClass(n,"ui-tabs-loading"),a.attr("aria-busy","true"),this.xhr.done(function(t,e,n){setTimeout(function(){a.html(t),s._trigger("load",i,r),h(n,e)},1)}).fail(function(t,e){setTimeout(function(){h(t,e)},1)})))},_ajaxSettings:function(e,i,s){var n=this;return{url:e.attr("href").replace(/#.*$/,""),beforeSend:function(e,o){return n._trigger("beforeLoad",i,t.extend({jqXHR:e,ajaxSettings:o},s))}}},_getPanelForTab:function(e){var i=t(e).attr("aria-controls");return this.element.find(this._sanitizeSelector("#"+i))}}),t.uiBackCompat!==!1&&t.widget("ui.tabs",t.ui.tabs,{_processTabs:function(){this._superApply(arguments),this._addClass(this.tabs,"ui-tab")}}),t.ui.tabs,t.widget("ui.tooltip",{version:"1.12.1",options:{classes:{"ui-tooltip":"ui-corner-all ui-widget-shadow"},content:function(){var e=t(this).attr("title")||"";return t("<a>").text(e).html()},hide:!0,items:"[title]:not([disabled])",position:{my:"left top+15",at:"left bottom",collision:"flipfit flip"},show:!0,track:!1,close:null,open:null},_addDescribedBy:function(e,i){var s=(e.attr("aria-describedby")||"").split(/\s+/);s.push(i),e.data("ui-tooltip-id",i).attr("aria-describedby",t.trim(s.join(" ")))},_removeDescribedBy:function(e){var i=e.data("ui-tooltip-id"),s=(e.attr("aria-describedby")||"").split(/\s+/),n=t.inArray(i,s);-1!==n&&s.splice(n,1),e.removeData("ui-tooltip-id"),s=t.trim(s.join(" ")),s?e.attr("aria-describedby",s):e.removeAttr("aria-describedby")},_create:function(){this._on({mouseover:"open",focusin:"open"}),this.tooltips={},this.parents={},this.liveRegion=t("<div>").attr({role:"log","aria-live":"assertive","aria-relevant":"additions"}).appendTo(this.document[0].body),this._addClass(this.liveRegion,null,"ui-helper-hidden-accessible"),this.disabledTitles=t([])},_setOption:function(e,i){var s=this;this._super(e,i),"content"===e&&t.each(this.tooltips,function(t,e){s._updateContent(e.element)})},_setOptionDisabled:function(t){this[t?"_disable":"_enable"]()},_disable:function(){var e=this;t.each(this.tooltips,function(i,s){var n=t.Event("blur");n.target=n.currentTarget=s.element[0],e.close(n,!0)}),this.disabledTitles=this.disabledTitles.add(this.element.find(this.options.items).addBack().filter(function(){var e=t(this);return e.is("[title]")?e.data("ui-tooltip-title",e.attr("title")).removeAttr("title"):void 0}))},_enable:function(){this.disabledTitles.each(function(){var e=t(this);e.data("ui-tooltip-title")&&e.attr("title",e.data("ui-tooltip-title"))}),this.disabledTitles=t([])},open:function(e){var i=this,s=t(e?e.target:this.element).closest(this.options.items);s.length&&!s.data("ui-tooltip-id")&&(s.attr("title")&&s.data("ui-tooltip-title",s.attr("title")),s.data("ui-tooltip-open",!0),e&&"mouseover"===e.type&&s.parents().each(function(){var e,s=t(this);s.data("ui-tooltip-open")&&(e=t.Event("blur"),e.target=e.currentTarget=this,i.close(e,!0)),s.attr("title")&&(s.uniqueId(),i.parents[this.id]={element:this,title:s.attr("title")},s.attr("title",""))}),this._registerCloseHandlers(e,s),this._updateContent(s,e))},_updateContent:function(t,e){var i,s=this.options.content,n=this,o=e?e.type:null;return"string"==typeof s||s.nodeType||s.jquery?this._open(e,t,s):(i=s.call(t[0],function(i){n._delay(function(){t.data("ui-tooltip-open")&&(e&&(e.type=o),this._open(e,t,i))})}),i&&this._open(e,t,i),void 0)},_open:function(e,i,s){function n(t){l.of=t,a.is(":hidden")||a.position(l)}var o,a,r,h,l=t.extend({},this.options.position);if(s){if(o=this._find(i))return o.tooltip.find(".ui-tooltip-content").html(s),void 0;i.is("[title]")&&(e&&"mouseover"===e.type?i.attr("title",""):i.removeAttr("title")),o=this._tooltip(i),a=o.tooltip,this._addDescribedBy(i,a.attr("id")),a.find(".ui-tooltip-content").html(s),this.liveRegion.children().hide(),h=t("<div>").html(a.find(".ui-tooltip-content").html()),h.removeAttr("name").find("[name]").removeAttr("name"),h.removeAttr("id").find("[id]").removeAttr("id"),h.appendTo(this.liveRegion),this.options.track&&e&&/^mouse/.test(e.type)?(this._on(this.document,{mousemove:n}),n(e)):a.position(t.extend({of:i},this.options.position)),a.hide(),this._show(a,this.options.show),this.options.track&&this.options.show&&this.options.show.delay&&(r=this.delayedShow=setInterval(function(){a.is(":visible")&&(n(l.of),clearInterval(r))},t.fx.interval)),this._trigger("open",e,{tooltip:a})}},_registerCloseHandlers:function(e,i){var s={keyup:function(e){if(e.keyCode===t.ui.keyCode.ESCAPE){var s=t.Event(e);s.currentTarget=i[0],this.close(s,!0)}}};i[0]!==this.element[0]&&(s.remove=function(){this._removeTooltip(this._find(i).tooltip)}),e&&"mouseover"!==e.type||(s.mouseleave="close"),e&&"focusin"!==e.type||(s.focusout="close"),this._on(!0,i,s)},close:function(e){var i,s=this,n=t(e?e.currentTarget:this.element),o=this._find(n);return o?(i=o.tooltip,o.closing||(clearInterval(this.delayedShow),n.data("ui-tooltip-title")&&!n.attr("title")&&n.attr("title",n.data("ui-tooltip-title")),this._removeDescribedBy(n),o.hiding=!0,i.stop(!0),this._hide(i,this.options.hide,function(){s._removeTooltip(t(this))}),n.removeData("ui-tooltip-open"),this._off(n,"mouseleave focusout keyup"),n[0]!==this.element[0]&&this._off(n,"remove"),this._off(this.document,"mousemove"),e&&"mouseleave"===e.type&&t.each(this.parents,function(e,i){t(i.element).attr("title",i.title),delete s.parents[e]}),o.closing=!0,this._trigger("close",e,{tooltip:i}),o.hiding||(o.closing=!1)),void 0):(n.removeData("ui-tooltip-open"),void 0)},_tooltip:function(e){var i=t("<div>").attr("role","tooltip"),s=t("<div>").appendTo(i),n=i.uniqueId().attr("id");return this._addClass(s,"ui-tooltip-content"),this._addClass(i,"ui-tooltip","ui-widget ui-widget-content"),i.appendTo(this._appendTo(e)),this.tooltips[n]={element:e,tooltip:i}},_find:function(t){var e=t.data("ui-tooltip-id");return e?this.tooltips[e]:null},_removeTooltip:function(t){t.remove(),delete this.tooltips[t.attr("id")]},_appendTo:function(t){var e=t.closest(".ui-front, dialog");return e.length||(e=this.document[0].body),e},_destroy:function(){var e=this;t.each(this.tooltips,function(i,s){var n=t.Event("blur"),o=s.element;n.target=n.currentTarget=o[0],e.close(n,!0),t("#"+i).remove(),o.data("ui-tooltip-title")&&(o.attr("title")||o.attr("title",o.data("ui-tooltip-title")),o.removeData("ui-tooltip-title"))}),this.liveRegion.remove()}}),t.uiBackCompat!==!1&&t.widget("ui.tooltip",t.ui.tooltip,{options:{tooltipClass:null},_tooltip:function(){var t=this._superApply(arguments);return this.options.tooltipClass&&t.tooltip.addClass(this.options.tooltipClass),t}}),t.ui.tooltip});!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):e.moment=t()}(this,function(){"use strict";var e,t;function n(){return e.apply(null,arguments)}function s(e){return e instanceof Array||"[object Array]"===Object.prototype.toString.call(e)}function i(e){return null!=e&&"[object Object]"===Object.prototype.toString.call(e)}function r(e){return void 0===e}function a(e){return"number"==typeof e||"[object Number]"===Object.prototype.toString.call(e)}function o(e){return e instanceof Date||"[object Date]"===Object.prototype.toString.call(e)}function u(e,t){var n,s=[];for(n=0;n<e.length;++n)s.push(t(e[n],n));return s}function l(e,t){return Object.prototype.hasOwnProperty.call(e,t)}function d(e,t){for(var n in t)l(t,n)&&(e[n]=t[n]);return l(t,"toString")&&(e.toString=t.toString),l(t,"valueOf")&&(e.valueOf=t.valueOf),e}function h(e,t,n,s){return Ot(e,t,n,s,!0).utc()}function c(e){return null==e._pf&&(e._pf={empty:!1,unusedTokens:[],unusedInput:[],overflow:-2,charsLeftOver:0,nullInput:!1,invalidMonth:null,invalidFormat:!1,userInvalidated:!1,iso:!1,parsedDateParts:[],meridiem:null,rfc2822:!1,weekdayMismatch:!1}),e._pf}function f(e){if(null==e._isValid){var n=c(e),s=t.call(n.parsedDateParts,function(e){return null!=e}),i=!isNaN(e._d.getTime())&&n.overflow<0&&!n.empty&&!n.invalidMonth&&!n.invalidWeekday&&!n.weekdayMismatch&&!n.nullInput&&!n.invalidFormat&&!n.userInvalidated&&(!n.meridiem||n.meridiem&&s);if(e._strict&&(i=i&&0===n.charsLeftOver&&0===n.unusedTokens.length&&void 0===n.bigHour),null!=Object.isFrozen&&Object.isFrozen(e))return i;e._isValid=i}return e._isValid}function m(e){var t=h(NaN);return null!=e?d(c(t),e):c(t).userInvalidated=!0,t}t=Array.prototype.some?Array.prototype.some:function(e){for(var t=Object(this),n=t.length>>>0,s=0;s<n;s++)if(s in t&&e.call(this,t[s],s,t))return!0;return!1};var _=n.momentProperties=[];function y(e,t){var n,s,i;if(r(t._isAMomentObject)||(e._isAMomentObject=t._isAMomentObject),r(t._i)||(e._i=t._i),r(t._f)||(e._f=t._f),r(t._l)||(e._l=t._l),r(t._strict)||(e._strict=t._strict),r(t._tzm)||(e._tzm=t._tzm),r(t._isUTC)||(e._isUTC=t._isUTC),r(t._offset)||(e._offset=t._offset),r(t._pf)||(e._pf=c(t)),r(t._locale)||(e._locale=t._locale),_.length>0)for(n=0;n<_.length;n++)r(i=t[s=_[n]])||(e[s]=i);return e}var g=!1;function p(e){y(this,e),this._d=new Date(null!=e._d?e._d.getTime():NaN),this.isValid()||(this._d=new Date(NaN)),!1===g&&(g=!0,n.updateOffset(this),g=!1)}function v(e){return e instanceof p||null!=e&&null!=e._isAMomentObject}function w(e){return e<0?Math.ceil(e)||0:Math.floor(e)}function M(e){var t=+e,n=0;return 0!==t&&isFinite(t)&&(n=w(t)),n}function S(e,t,n){var s,i=Math.min(e.length,t.length),r=Math.abs(e.length-t.length),a=0;for(s=0;s<i;s++)(n&&e[s]!==t[s]||!n&&M(e[s])!==M(t[s]))&&a++;return a+r}function D(e){!1===n.suppressDeprecationWarnings&&"undefined"!=typeof console&&console.warn&&console.warn("Deprecation warning: "+e)}function k(e,t){var s=!0;return d(function(){if(null!=n.deprecationHandler&&n.deprecationHandler(null,e),s){for(var i,r=[],a=0;a<arguments.length;a++){if(i="","object"==typeof arguments[a]){for(var o in i+="\n["+a+"] ",arguments[0])i+=o+": "+arguments[0][o]+", ";i=i.slice(0,-2)}else i=arguments[a];r.push(i)}D(e+"\nArguments: "+Array.prototype.slice.call(r).join("")+"\n"+(new Error).stack),s=!1}return t.apply(this,arguments)},t)}var Y,O={};function T(e,t){null!=n.deprecationHandler&&n.deprecationHandler(e,t),O[e]||(D(t),O[e]=!0)}function x(e){return e instanceof Function||"[object Function]"===Object.prototype.toString.call(e)}function b(e,t){var n,s=d({},e);for(n in t)l(t,n)&&(i(e[n])&&i(t[n])?(s[n]={},d(s[n],e[n]),d(s[n],t[n])):null!=t[n]?s[n]=t[n]:delete s[n]);for(n in e)l(e,n)&&!l(t,n)&&i(e[n])&&(s[n]=d({},s[n]));return s}function P(e){null!=e&&this.set(e)}n.suppressDeprecationWarnings=!1,n.deprecationHandler=null,Y=Object.keys?Object.keys:function(e){var t,n=[];for(t in e)l(e,t)&&n.push(t);return n};var W={};function H(e,t){var n=e.toLowerCase();W[n]=W[n+"s"]=W[t]=e}function R(e){return"string"==typeof e?W[e]||W[e.toLowerCase()]:void 0}function C(e){var t,n,s={};for(n in e)l(e,n)&&(t=R(n))&&(s[t]=e[n]);return s}var F={};function L(e,t){F[e]=t}function U(e,t,n){var s=""+Math.abs(e),i=t-s.length;return(e>=0?n?"+":"":"-")+Math.pow(10,Math.max(0,i)).toString().substr(1)+s}var N=/(\[[^\[]*\])|(\\)?([Hh]mm(ss)?|Mo|MM?M?M?|Do|DDDo|DD?D?D?|ddd?d?|do?|w[o|w]?|W[o|W]?|Qo?|YYYYYY|YYYYY|YYYY|YY|gg(ggg?)?|GG(GGG?)?|e|E|a|A|hh?|HH?|kk?|mm?|ss?|S{1,9}|x|X|zz?|ZZ?|.)/g,G=/(\[[^\[]*\])|(\\)?(LTS|LT|LL?L?L?|l{1,4})/g,V={},E={};function I(e,t,n,s){var i=s;"string"==typeof s&&(i=function(){return this[s]()}),e&&(E[e]=i),t&&(E[t[0]]=function(){return U(i.apply(this,arguments),t[1],t[2])}),n&&(E[n]=function(){return this.localeData().ordinal(i.apply(this,arguments),e)})}function A(e,t){return e.isValid()?(t=j(t,e.localeData()),V[t]=V[t]||function(e){var t,n,s,i=e.match(N);for(t=0,n=i.length;t<n;t++)E[i[t]]?i[t]=E[i[t]]:i[t]=(s=i[t]).match(/\[[\s\S]/)?s.replace(/^\[|\]$/g,""):s.replace(/\\/g,"");return function(t){var s,r="";for(s=0;s<n;s++)r+=x(i[s])?i[s].call(t,e):i[s];return r}}(t),V[t](e)):e.localeData().invalidDate()}function j(e,t){var n=5;function s(e){return t.longDateFormat(e)||e}for(G.lastIndex=0;n>=0&&G.test(e);)e=e.replace(G,s),G.lastIndex=0,n-=1;return e}var Z=/\d/,z=/\d\d/,$=/\d{3}/,q=/\d{4}/,J=/[+-]?\d{6}/,B=/\d\d?/,Q=/\d\d\d\d?/,X=/\d\d\d\d\d\d?/,K=/\d{1,3}/,ee=/\d{1,4}/,te=/[+-]?\d{1,6}/,ne=/\d+/,se=/[+-]?\d+/,ie=/Z|[+-]\d\d:?\d\d/gi,re=/Z|[+-]\d\d(?::?\d\d)?/gi,ae=/[0-9]{0,256}['a-z\u00A0-\u05FF\u0700-\uD7FF\uF900-\uFDCF\uFDF0-\uFF07\uFF10-\uFFEF]{1,256}|[\u0600-\u06FF\/]{1,256}(\s*?[\u0600-\u06FF]{1,256}){1,2}/i,oe={};function ue(e,t,n){oe[e]=x(t)?t:function(e,s){return e&&n?n:t}}function le(e,t){return l(oe,e)?oe[e](t._strict,t._locale):new RegExp(de(e.replace("\\","").replace(/\\(\[)|\\(\])|\[([^\]\[]*)\]|\\(.)/g,function(e,t,n,s,i){return t||n||s||i})))}function de(e){return e.replace(/[-\/\\^$*+?.()|[\]{}]/g,"\\$&")}var he={};function ce(e,t){var n,s=t;for("string"==typeof e&&(e=[e]),a(t)&&(s=function(e,n){n[t]=M(e)}),n=0;n<e.length;n++)he[e[n]]=s}function fe(e,t){ce(e,function(e,n,s,i){s._w=s._w||{},t(e,s._w,s,i)})}var me=0,_e=1,ye=2,ge=3,pe=4,ve=5,we=6,Me=7,Se=8;function De(e){return ke(e)?366:365}function ke(e){return e%4==0&&e%100!=0||e%400==0}I("Y",0,0,function(){var e=this.year();return e<=9999?""+e:"+"+e}),I(0,["YY",2],0,function(){return this.year()%100}),I(0,["YYYY",4],0,"year"),I(0,["YYYYY",5],0,"year"),I(0,["YYYYYY",6,!0],0,"year"),H("year","y"),L("year",1),ue("Y",se),ue("YY",B,z),ue("YYYY",ee,q),ue("YYYYY",te,J),ue("YYYYYY",te,J),ce(["YYYYY","YYYYYY"],me),ce("YYYY",function(e,t){t[me]=2===e.length?n.parseTwoDigitYear(e):M(e)}),ce("YY",function(e,t){t[me]=n.parseTwoDigitYear(e)}),ce("Y",function(e,t){t[me]=parseInt(e,10)}),n.parseTwoDigitYear=function(e){return M(e)+(M(e)>68?1900:2e3)};var Ye,Oe=Te("FullYear",!0);function Te(e,t){return function(s){return null!=s?(be(this,e,s),n.updateOffset(this,t),this):xe(this,e)}}function xe(e,t){return e.isValid()?e._d["get"+(e._isUTC?"UTC":"")+t]():NaN}function be(e,t,n){e.isValid()&&!isNaN(n)&&("FullYear"===t&&ke(e.year())&&1===e.month()&&29===e.date()?e._d["set"+(e._isUTC?"UTC":"")+t](n,e.month(),Pe(n,e.month())):e._d["set"+(e._isUTC?"UTC":"")+t](n))}function Pe(e,t){if(isNaN(e)||isNaN(t))return NaN;var n,s=(t%(n=12)+n)%n;return e+=(t-s)/12,1===s?ke(e)?29:28:31-s%7%2}Ye=Array.prototype.indexOf?Array.prototype.indexOf:function(e){var t;for(t=0;t<this.length;++t)if(this[t]===e)return t;return-1},I("M",["MM",2],"Mo",function(){return this.month()+1}),I("MMM",0,0,function(e){return this.localeData().monthsShort(this,e)}),I("MMMM",0,0,function(e){return this.localeData().months(this,e)}),H("month","M"),L("month",8),ue("M",B),ue("MM",B,z),ue("MMM",function(e,t){return t.monthsShortRegex(e)}),ue("MMMM",function(e,t){return t.monthsRegex(e)}),ce(["M","MM"],function(e,t){t[_e]=M(e)-1}),ce(["MMM","MMMM"],function(e,t,n,s){var i=n._locale.monthsParse(e,s,n._strict);null!=i?t[_e]=i:c(n).invalidMonth=e});var We=/D[oD]?(\[[^\[\]]*\]|\s)+MMMM?/,He="January_February_March_April_May_June_July_August_September_October_November_December".split("_");var Re="Jan_Feb_Mar_Apr_May_Jun_Jul_Aug_Sep_Oct_Nov_Dec".split("_");function Ce(e,t){var n;if(!e.isValid())return e;if("string"==typeof t)if(/^\d+$/.test(t))t=M(t);else if(!a(t=e.localeData().monthsParse(t)))return e;return n=Math.min(e.date(),Pe(e.year(),t)),e._d["set"+(e._isUTC?"UTC":"")+"Month"](t,n),e}function Fe(e){return null!=e?(Ce(this,e),n.updateOffset(this,!0),this):xe(this,"Month")}var Le=ae;var Ue=ae;function Ne(){function e(e,t){return t.length-e.length}var t,n,s=[],i=[],r=[];for(t=0;t<12;t++)n=h([2e3,t]),s.push(this.monthsShort(n,"")),i.push(this.months(n,"")),r.push(this.months(n,"")),r.push(this.monthsShort(n,""));for(s.sort(e),i.sort(e),r.sort(e),t=0;t<12;t++)s[t]=de(s[t]),i[t]=de(i[t]);for(t=0;t<24;t++)r[t]=de(r[t]);this._monthsRegex=new RegExp("^("+r.join("|")+")","i"),this._monthsShortRegex=this._monthsRegex,this._monthsStrictRegex=new RegExp("^("+i.join("|")+")","i"),this._monthsShortStrictRegex=new RegExp("^("+s.join("|")+")","i")}function Ge(e){var t=new Date(Date.UTC.apply(null,arguments));return e<100&&e>=0&&isFinite(t.getUTCFullYear())&&t.setUTCFullYear(e),t}function Ve(e,t,n){var s=7+t-n;return-((7+Ge(e,0,s).getUTCDay()-t)%7)+s-1}function Ee(e,t,n,s,i){var r,a,o=1+7*(t-1)+(7+n-s)%7+Ve(e,s,i);return o<=0?a=De(r=e-1)+o:o>De(e)?(r=e+1,a=o-De(e)):(r=e,a=o),{year:r,dayOfYear:a}}function Ie(e,t,n){var s,i,r=Ve(e.year(),t,n),a=Math.floor((e.dayOfYear()-r-1)/7)+1;return a<1?s=a+Ae(i=e.year()-1,t,n):a>Ae(e.year(),t,n)?(s=a-Ae(e.year(),t,n),i=e.year()+1):(i=e.year(),s=a),{week:s,year:i}}function Ae(e,t,n){var s=Ve(e,t,n),i=Ve(e+1,t,n);return(De(e)-s+i)/7}I("w",["ww",2],"wo","week"),I("W",["WW",2],"Wo","isoWeek"),H("week","w"),H("isoWeek","W"),L("week",5),L("isoWeek",5),ue("w",B),ue("ww",B,z),ue("W",B),ue("WW",B,z),fe(["w","ww","W","WW"],function(e,t,n,s){t[s.substr(0,1)]=M(e)});I("d",0,"do","day"),I("dd",0,0,function(e){return this.localeData().weekdaysMin(this,e)}),I("ddd",0,0,function(e){return this.localeData().weekdaysShort(this,e)}),I("dddd",0,0,function(e){return this.localeData().weekdays(this,e)}),I("e",0,0,"weekday"),I("E",0,0,"isoWeekday"),H("day","d"),H("weekday","e"),H("isoWeekday","E"),L("day",11),L("weekday",11),L("isoWeekday",11),ue("d",B),ue("e",B),ue("E",B),ue("dd",function(e,t){return t.weekdaysMinRegex(e)}),ue("ddd",function(e,t){return t.weekdaysShortRegex(e)}),ue("dddd",function(e,t){return t.weekdaysRegex(e)}),fe(["dd","ddd","dddd"],function(e,t,n,s){var i=n._locale.weekdaysParse(e,s,n._strict);null!=i?t.d=i:c(n).invalidWeekday=e}),fe(["d","e","E"],function(e,t,n,s){t[s]=M(e)});var je="Sunday_Monday_Tuesday_Wednesday_Thursday_Friday_Saturday".split("_");var Ze="Sun_Mon_Tue_Wed_Thu_Fri_Sat".split("_");var ze="Su_Mo_Tu_We_Th_Fr_Sa".split("_");var $e=ae;var qe=ae;var Je=ae;function Be(){function e(e,t){return t.length-e.length}var t,n,s,i,r,a=[],o=[],u=[],l=[];for(t=0;t<7;t++)n=h([2e3,1]).day(t),s=this.weekdaysMin(n,""),i=this.weekdaysShort(n,""),r=this.weekdays(n,""),a.push(s),o.push(i),u.push(r),l.push(s),l.push(i),l.push(r);for(a.sort(e),o.sort(e),u.sort(e),l.sort(e),t=0;t<7;t++)o[t]=de(o[t]),u[t]=de(u[t]),l[t]=de(l[t]);this._weekdaysRegex=new RegExp("^("+l.join("|")+")","i"),this._weekdaysShortRegex=this._weekdaysRegex,this._weekdaysMinRegex=this._weekdaysRegex,this._weekdaysStrictRegex=new RegExp("^("+u.join("|")+")","i"),this._weekdaysShortStrictRegex=new RegExp("^("+o.join("|")+")","i"),this._weekdaysMinStrictRegex=new RegExp("^("+a.join("|")+")","i")}function Qe(){return this.hours()%12||12}function Xe(e,t){I(e,0,0,function(){return this.localeData().meridiem(this.hours(),this.minutes(),t)})}function Ke(e,t){return t._meridiemParse}I("H",["HH",2],0,"hour"),I("h",["hh",2],0,Qe),I("k",["kk",2],0,function(){return this.hours()||24}),I("hmm",0,0,function(){return""+Qe.apply(this)+U(this.minutes(),2)}),I("hmmss",0,0,function(){return""+Qe.apply(this)+U(this.minutes(),2)+U(this.seconds(),2)}),I("Hmm",0,0,function(){return""+this.hours()+U(this.minutes(),2)}),I("Hmmss",0,0,function(){return""+this.hours()+U(this.minutes(),2)+U(this.seconds(),2)}),Xe("a",!0),Xe("A",!1),H("hour","h"),L("hour",13),ue("a",Ke),ue("A",Ke),ue("H",B),ue("h",B),ue("k",B),ue("HH",B,z),ue("hh",B,z),ue("kk",B,z),ue("hmm",Q),ue("hmmss",X),ue("Hmm",Q),ue("Hmmss",X),ce(["H","HH"],ge),ce(["k","kk"],function(e,t,n){var s=M(e);t[ge]=24===s?0:s}),ce(["a","A"],function(e,t,n){n._isPm=n._locale.isPM(e),n._meridiem=e}),ce(["h","hh"],function(e,t,n){t[ge]=M(e),c(n).bigHour=!0}),ce("hmm",function(e,t,n){var s=e.length-2;t[ge]=M(e.substr(0,s)),t[pe]=M(e.substr(s)),c(n).bigHour=!0}),ce("hmmss",function(e,t,n){var s=e.length-4,i=e.length-2;t[ge]=M(e.substr(0,s)),t[pe]=M(e.substr(s,2)),t[ve]=M(e.substr(i)),c(n).bigHour=!0}),ce("Hmm",function(e,t,n){var s=e.length-2;t[ge]=M(e.substr(0,s)),t[pe]=M(e.substr(s))}),ce("Hmmss",function(e,t,n){var s=e.length-4,i=e.length-2;t[ge]=M(e.substr(0,s)),t[pe]=M(e.substr(s,2)),t[ve]=M(e.substr(i))});var et,tt=Te("Hours",!0),nt={calendar:{sameDay:"[Today at] LT",nextDay:"[Tomorrow at] LT",nextWeek:"dddd [at] LT",lastDay:"[Yesterday at] LT",lastWeek:"[Last] dddd [at] LT",sameElse:"L"},longDateFormat:{LTS:"h:mm:ss A",LT:"h:mm A",L:"MM/DD/YYYY",LL:"MMMM D, YYYY",LLL:"MMMM D, YYYY h:mm A",LLLL:"dddd, MMMM D, YYYY h:mm A"},invalidDate:"Invalid date",ordinal:"%d",dayOfMonthOrdinalParse:/\d{1,2}/,relativeTime:{future:"in %s",past:"%s ago",s:"a few seconds",ss:"%d seconds",m:"a minute",mm:"%d minutes",h:"an hour",hh:"%d hours",d:"a day",dd:"%d days",M:"a month",MM:"%d months",y:"a year",yy:"%d years"},months:He,monthsShort:Re,week:{dow:0,doy:6},weekdays:je,weekdaysMin:ze,weekdaysShort:Ze,meridiemParse:/[ap]\.?m?\.?/i},st={},it={};function rt(e){return e?e.toLowerCase().replace("_","-"):e}function at(e){var t=null;if(!st[e]&&"undefined"!=typeof module&&module&&module.exports)try{t=et._abbr,require("./locale/"+e),ot(t)}catch(e){}return st[e]}function ot(e,t){var n;return e&&((n=r(t)?lt(e):ut(e,t))?et=n:"undefined"!=typeof console&&console.warn&&console.warn("Locale "+e+" not found. Did you forget to load it?")),et._abbr}function ut(e,t){if(null!==t){var n,s=nt;if(t.abbr=e,null!=st[e])T("defineLocaleOverride","use moment.updateLocale(localeName, config) to change an existing locale. moment.defineLocale(localeName, config) should only be used for creating a new locale See http://momentjs.com/guides/#/warnings/define-locale/ for more info."),s=st[e]._config;else if(null!=t.parentLocale)if(null!=st[t.parentLocale])s=st[t.parentLocale]._config;else{if(null==(n=at(t.parentLocale)))return it[t.parentLocale]||(it[t.parentLocale]=[]),it[t.parentLocale].push({name:e,config:t}),null;s=n._config}return st[e]=new P(b(s,t)),it[e]&&it[e].forEach(function(e){ut(e.name,e.config)}),ot(e),st[e]}return delete st[e],null}function lt(e){var t;if(e&&e._locale&&e._locale._abbr&&(e=e._locale._abbr),!e)return et;if(!s(e)){if(t=at(e))return t;e=[e]}return function(e){for(var t,n,s,i,r=0;r<e.length;){for(t=(i=rt(e[r]).split("-")).length,n=(n=rt(e[r+1]))?n.split("-"):null;t>0;){if(s=at(i.slice(0,t).join("-")))return s;if(n&&n.length>=t&&S(i,n,!0)>=t-1)break;t--}r++}return et}(e)}function dt(e){var t,n=e._a;return n&&-2===c(e).overflow&&(t=n[_e]<0||n[_e]>11?_e:n[ye]<1||n[ye]>Pe(n[me],n[_e])?ye:n[ge]<0||n[ge]>24||24===n[ge]&&(0!==n[pe]||0!==n[ve]||0!==n[we])?ge:n[pe]<0||n[pe]>59?pe:n[ve]<0||n[ve]>59?ve:n[we]<0||n[we]>999?we:-1,c(e)._overflowDayOfYear&&(t<me||t>ye)&&(t=ye),c(e)._overflowWeeks&&-1===t&&(t=Me),c(e)._overflowWeekday&&-1===t&&(t=Se),c(e).overflow=t),e}function ht(e,t,n){return null!=e?e:null!=t?t:n}function ct(e){var t,s,i,r,a,o=[];if(!e._d){var u,l;for(u=e,l=new Date(n.now()),i=u._useUTC?[l.getUTCFullYear(),l.getUTCMonth(),l.getUTCDate()]:[l.getFullYear(),l.getMonth(),l.getDate()],e._w&&null==e._a[ye]&&null==e._a[_e]&&function(e){var t,n,s,i,r,a,o,u;if(null!=(t=e._w).GG||null!=t.W||null!=t.E)r=1,a=4,n=ht(t.GG,e._a[me],Ie(Tt(),1,4).year),s=ht(t.W,1),((i=ht(t.E,1))<1||i>7)&&(u=!0);else{r=e._locale._week.dow,a=e._locale._week.doy;var l=Ie(Tt(),r,a);n=ht(t.gg,e._a[me],l.year),s=ht(t.w,l.week),null!=t.d?((i=t.d)<0||i>6)&&(u=!0):null!=t.e?(i=t.e+r,(t.e<0||t.e>6)&&(u=!0)):i=r}s<1||s>Ae(n,r,a)?c(e)._overflowWeeks=!0:null!=u?c(e)._overflowWeekday=!0:(o=Ee(n,s,i,r,a),e._a[me]=o.year,e._dayOfYear=o.dayOfYear)}(e),null!=e._dayOfYear&&(a=ht(e._a[me],i[me]),(e._dayOfYear>De(a)||0===e._dayOfYear)&&(c(e)._overflowDayOfYear=!0),s=Ge(a,0,e._dayOfYear),e._a[_e]=s.getUTCMonth(),e._a[ye]=s.getUTCDate()),t=0;t<3&&null==e._a[t];++t)e._a[t]=o[t]=i[t];for(;t<7;t++)e._a[t]=o[t]=null==e._a[t]?2===t?1:0:e._a[t];24===e._a[ge]&&0===e._a[pe]&&0===e._a[ve]&&0===e._a[we]&&(e._nextDay=!0,e._a[ge]=0),e._d=(e._useUTC?Ge:function(e,t,n,s,i,r,a){var o=new Date(e,t,n,s,i,r,a);return e<100&&e>=0&&isFinite(o.getFullYear())&&o.setFullYear(e),o}).apply(null,o),r=e._useUTC?e._d.getUTCDay():e._d.getDay(),null!=e._tzm&&e._d.setUTCMinutes(e._d.getUTCMinutes()-e._tzm),e._nextDay&&(e._a[ge]=24),e._w&&void 0!==e._w.d&&e._w.d!==r&&(c(e).weekdayMismatch=!0)}}var ft=/^\s*((?:[+-]\d{6}|\d{4})-(?:\d\d-\d\d|W\d\d-\d|W\d\d|\d\d\d|\d\d))(?:(T| )(\d\d(?::\d\d(?::\d\d(?:[.,]\d+)?)?)?)([\+\-]\d\d(?::?\d\d)?|\s*Z)?)?$/,mt=/^\s*((?:[+-]\d{6}|\d{4})(?:\d\d\d\d|W\d\d\d|W\d\d|\d\d\d|\d\d))(?:(T| )(\d\d(?:\d\d(?:\d\d(?:[.,]\d+)?)?)?)([\+\-]\d\d(?::?\d\d)?|\s*Z)?)?$/,_t=/Z|[+-]\d\d(?::?\d\d)?/,yt=[["YYYYYY-MM-DD",/[+-]\d{6}-\d\d-\d\d/],["YYYY-MM-DD",/\d{4}-\d\d-\d\d/],["GGGG-[W]WW-E",/\d{4}-W\d\d-\d/],["GGGG-[W]WW",/\d{4}-W\d\d/,!1],["YYYY-DDD",/\d{4}-\d{3}/],["YYYY-MM",/\d{4}-\d\d/,!1],["YYYYYYMMDD",/[+-]\d{10}/],["YYYYMMDD",/\d{8}/],["GGGG[W]WWE",/\d{4}W\d{3}/],["GGGG[W]WW",/\d{4}W\d{2}/,!1],["YYYYDDD",/\d{7}/]],gt=[["HH:mm:ss.SSSS",/\d\d:\d\d:\d\d\.\d+/],["HH:mm:ss,SSSS",/\d\d:\d\d:\d\d,\d+/],["HH:mm:ss",/\d\d:\d\d:\d\d/],["HH:mm",/\d\d:\d\d/],["HHmmss.SSSS",/\d\d\d\d\d\d\.\d+/],["HHmmss,SSSS",/\d\d\d\d\d\d,\d+/],["HHmmss",/\d\d\d\d\d\d/],["HHmm",/\d\d\d\d/],["HH",/\d\d/]],pt=/^\/?Date\((\-?\d+)/i;function vt(e){var t,n,s,i,r,a,o=e._i,u=ft.exec(o)||mt.exec(o);if(u){for(c(e).iso=!0,t=0,n=yt.length;t<n;t++)if(yt[t][1].exec(u[1])){i=yt[t][0],s=!1!==yt[t][2];break}if(null==i)return void(e._isValid=!1);if(u[3]){for(t=0,n=gt.length;t<n;t++)if(gt[t][1].exec(u[3])){r=(u[2]||" ")+gt[t][0];break}if(null==r)return void(e._isValid=!1)}if(!s&&null!=r)return void(e._isValid=!1);if(u[4]){if(!_t.exec(u[4]))return void(e._isValid=!1);a="Z"}e._f=i+(r||"")+(a||""),kt(e)}else e._isValid=!1}var wt=/^(?:(Mon|Tue|Wed|Thu|Fri|Sat|Sun),?\s)?(\d{1,2})\s(Jan|Feb|Mar|Apr|May|Jun|Jul|Aug|Sep|Oct|Nov|Dec)\s(\d{2,4})\s(\d\d):(\d\d)(?::(\d\d))?\s(?:(UT|GMT|[ECMP][SD]T)|([Zz])|([+-]\d{4}))$/;function Mt(e,t,n,s,i,r){var a=[function(e){var t=parseInt(e,10);{if(t<=49)return 2e3+t;if(t<=999)return 1900+t}return t}(e),Re.indexOf(t),parseInt(n,10),parseInt(s,10),parseInt(i,10)];return r&&a.push(parseInt(r,10)),a}var St={UT:0,GMT:0,EDT:-240,EST:-300,CDT:-300,CST:-360,MDT:-360,MST:-420,PDT:-420,PST:-480};function Dt(e){var t,n,s,i=wt.exec(e._i.replace(/\([^)]*\)|[\n\t]/g," ").replace(/(\s\s+)/g," ").trim());if(i){var r=Mt(i[4],i[3],i[2],i[5],i[6],i[7]);if(t=i[1],n=r,s=e,t&&Ze.indexOf(t)!==new Date(n[0],n[1],n[2]).getDay()&&(c(s).weekdayMismatch=!0,s._isValid=!1,1))return;e._a=r,e._tzm=function(e,t,n){if(e)return St[e];if(t)return 0;var s=parseInt(n,10),i=s%100;return(s-i)/100*60+i}(i[8],i[9],i[10]),e._d=Ge.apply(null,e._a),e._d.setUTCMinutes(e._d.getUTCMinutes()-e._tzm),c(e).rfc2822=!0}else e._isValid=!1}function kt(e){if(e._f!==n.ISO_8601)if(e._f!==n.RFC_2822){e._a=[],c(e).empty=!0;var t,s,i,r,a,o,u,d,h=""+e._i,f=h.length,m=0;for(i=j(e._f,e._locale).match(N)||[],t=0;t<i.length;t++)r=i[t],(s=(h.match(le(r,e))||[])[0])&&((a=h.substr(0,h.indexOf(s))).length>0&&c(e).unusedInput.push(a),h=h.slice(h.indexOf(s)+s.length),m+=s.length),E[r]?(s?c(e).empty=!1:c(e).unusedTokens.push(r),o=r,d=e,null!=(u=s)&&l(he,o)&&he[o](u,d._a,d,o)):e._strict&&!s&&c(e).unusedTokens.push(r);c(e).charsLeftOver=f-m,h.length>0&&c(e).unusedInput.push(h),e._a[ge]<=12&&!0===c(e).bigHour&&e._a[ge]>0&&(c(e).bigHour=void 0),c(e).parsedDateParts=e._a.slice(0),c(e).meridiem=e._meridiem,e._a[ge]=function(e,t,n){var s;if(null==n)return t;return null!=e.meridiemHour?e.meridiemHour(t,n):null!=e.isPM?((s=e.isPM(n))&&t<12&&(t+=12),s||12!==t||(t=0),t):t}(e._locale,e._a[ge],e._meridiem),ct(e),dt(e)}else Dt(e);else vt(e)}function Yt(e){var t,l,h,_,g=e._i,w=e._f;return e._locale=e._locale||lt(e._l),null===g||void 0===w&&""===g?m({nullInput:!0}):("string"==typeof g&&(e._i=g=e._locale.preparse(g)),v(g)?new p(dt(g)):(o(g)?e._d=g:s(w)?function(e){var t,n,s,i,r;if(0===e._f.length)return c(e).invalidFormat=!0,void(e._d=new Date(NaN));for(i=0;i<e._f.length;i++)r=0,t=y({},e),null!=e._useUTC&&(t._useUTC=e._useUTC),t._f=e._f[i],kt(t),f(t)&&(r+=c(t).charsLeftOver,r+=10*c(t).unusedTokens.length,c(t).score=r,(null==s||r<s)&&(s=r,n=t));d(e,n||t)}(e):w?kt(e):r(l=(t=e)._i)?t._d=new Date(n.now()):o(l)?t._d=new Date(l.valueOf()):"string"==typeof l?(h=t,null===(_=pt.exec(h._i))?(vt(h),!1===h._isValid&&(delete h._isValid,Dt(h),!1===h._isValid&&(delete h._isValid,n.createFromInputFallback(h)))):h._d=new Date(+_[1])):s(l)?(t._a=u(l.slice(0),function(e){return parseInt(e,10)}),ct(t)):i(l)?function(e){if(!e._d){var t=C(e._i);e._a=u([t.year,t.month,t.day||t.date,t.hour,t.minute,t.second,t.millisecond],function(e){return e&&parseInt(e,10)}),ct(e)}}(t):a(l)?t._d=new Date(l):n.createFromInputFallback(t),f(e)||(e._d=null),e))}function Ot(e,t,n,r,a){var o,u={};return!0!==n&&!1!==n||(r=n,n=void 0),(i(e)&&function(e){if(Object.getOwnPropertyNames)return 0===Object.getOwnPropertyNames(e).length;var t;for(t in e)if(e.hasOwnProperty(t))return!1;return!0}(e)||s(e)&&0===e.length)&&(e=void 0),u._isAMomentObject=!0,u._useUTC=u._isUTC=a,u._l=n,u._i=e,u._f=t,u._strict=r,(o=new p(dt(Yt(u))))._nextDay&&(o.add(1,"d"),o._nextDay=void 0),o}function Tt(e,t,n,s){return Ot(e,t,n,s,!1)}n.createFromInputFallback=k("value provided is not in a recognized RFC2822 or ISO format. moment construction falls back to js Date(), which is not reliable across all browsers and versions. Non RFC2822/ISO date formats are discouraged and will be removed in an upcoming major release. Please refer to http://momentjs.com/guides/#/warnings/js-date/ for more info.",function(e){e._d=new Date(e._i+(e._useUTC?" UTC":""))}),n.ISO_8601=function(){},n.RFC_2822=function(){};var xt=k("moment().min is deprecated, use moment.max instead. http://momentjs.com/guides/#/warnings/min-max/",function(){var e=Tt.apply(null,arguments);return this.isValid()&&e.isValid()?e<this?this:e:m()}),bt=k("moment().max is deprecated, use moment.min instead. http://momentjs.com/guides/#/warnings/min-max/",function(){var e=Tt.apply(null,arguments);return this.isValid()&&e.isValid()?e>this?this:e:m()});function Pt(e,t){var n,i;if(1===t.length&&s(t[0])&&(t=t[0]),!t.length)return Tt();for(n=t[0],i=1;i<t.length;++i)t[i].isValid()&&!t[i][e](n)||(n=t[i]);return n}var Wt=["year","quarter","month","week","day","hour","minute","second","millisecond"];function Ht(e){var t=C(e),n=t.year||0,s=t.quarter||0,i=t.month||0,r=t.week||0,a=t.day||0,o=t.hour||0,u=t.minute||0,l=t.second||0,d=t.millisecond||0;this._isValid=function(e){for(var t in e)if(-1===Ye.call(Wt,t)||null!=e[t]&&isNaN(e[t]))return!1;for(var n=!1,s=0;s<Wt.length;++s)if(e[Wt[s]]){if(n)return!1;parseFloat(e[Wt[s]])!==M(e[Wt[s]])&&(n=!0)}return!0}(t),this._milliseconds=+d+1e3*l+6e4*u+1e3*o*60*60,this._days=+a+7*r,this._months=+i+3*s+12*n,this._data={},this._locale=lt(),this._bubble()}function Rt(e){return e instanceof Ht}function Ct(e){return e<0?-1*Math.round(-1*e):Math.round(e)}function Ft(e,t){I(e,0,0,function(){var e=this.utcOffset(),n="+";return e<0&&(e=-e,n="-"),n+U(~~(e/60),2)+t+U(~~e%60,2)})}Ft("Z",":"),Ft("ZZ",""),ue("Z",re),ue("ZZ",re),ce(["Z","ZZ"],function(e,t,n){n._useUTC=!0,n._tzm=Ut(re,e)});var Lt=/([\+\-]|\d\d)/gi;function Ut(e,t){var n=(t||"").match(e);if(null===n)return null;var s=((n[n.length-1]||[])+"").match(Lt)||["-",0,0],i=60*s[1]+M(s[2]);return 0===i?0:"+"===s[0]?i:-i}function Nt(e,t){var s,i;return t._isUTC?(s=t.clone(),i=(v(e)||o(e)?e.valueOf():Tt(e).valueOf())-s.valueOf(),s._d.setTime(s._d.valueOf()+i),n.updateOffset(s,!1),s):Tt(e).local()}function Gt(e){return 15*-Math.round(e._d.getTimezoneOffset()/15)}function Vt(){return!!this.isValid()&&(this._isUTC&&0===this._offset)}n.updateOffset=function(){};var Et=/^(\-|\+)?(?:(\d*)[. ])?(\d+)\:(\d+)(?:\:(\d+)(\.\d*)?)?$/,It=/^(-|\+)?P(?:([-+]?[0-9,.]*)Y)?(?:([-+]?[0-9,.]*)M)?(?:([-+]?[0-9,.]*)W)?(?:([-+]?[0-9,.]*)D)?(?:T(?:([-+]?[0-9,.]*)H)?(?:([-+]?[0-9,.]*)M)?(?:([-+]?[0-9,.]*)S)?)?$/;function At(e,t){var n,s,i,r=e,o=null;return Rt(e)?r={ms:e._milliseconds,d:e._days,M:e._months}:a(e)?(r={},t?r[t]=e:r.milliseconds=e):(o=Et.exec(e))?(n="-"===o[1]?-1:1,r={y:0,d:M(o[ye])*n,h:M(o[ge])*n,m:M(o[pe])*n,s:M(o[ve])*n,ms:M(Ct(1e3*o[we]))*n}):(o=It.exec(e))?(n="-"===o[1]?-1:(o[1],1),r={y:jt(o[2],n),M:jt(o[3],n),w:jt(o[4],n),d:jt(o[5],n),h:jt(o[6],n),m:jt(o[7],n),s:jt(o[8],n)}):null==r?r={}:"object"==typeof r&&("from"in r||"to"in r)&&(i=function(e,t){var n;if(!e.isValid()||!t.isValid())return{milliseconds:0,months:0};t=Nt(t,e),e.isBefore(t)?n=Zt(e,t):((n=Zt(t,e)).milliseconds=-n.milliseconds,n.months=-n.months);return n}(Tt(r.from),Tt(r.to)),(r={}).ms=i.milliseconds,r.M=i.months),s=new Ht(r),Rt(e)&&l(e,"_locale")&&(s._locale=e._locale),s}function jt(e,t){var n=e&&parseFloat(e.replace(",","."));return(isNaN(n)?0:n)*t}function Zt(e,t){var n={milliseconds:0,months:0};return n.months=t.month()-e.month()+12*(t.year()-e.year()),e.clone().add(n.months,"M").isAfter(t)&&--n.months,n.milliseconds=+t-+e.clone().add(n.months,"M"),n}function zt(e,t){return function(n,s){var i;return null===s||isNaN(+s)||(T(t,"moment()."+t+"(period, number) is deprecated. Please use moment()."+t+"(number, period). See http://momentjs.com/guides/#/warnings/add-inverted-param/ for more info."),i=n,n=s,s=i),$t(this,At(n="string"==typeof n?+n:n,s),e),this}}function $t(e,t,s,i){var r=t._milliseconds,a=Ct(t._days),o=Ct(t._months);e.isValid()&&(i=null==i||i,o&&Ce(e,xe(e,"Month")+o*s),a&&be(e,"Date",xe(e,"Date")+a*s),r&&e._d.setTime(e._d.valueOf()+r*s),i&&n.updateOffset(e,a||o))}At.fn=Ht.prototype,At.invalid=function(){return At(NaN)};var qt=zt(1,"add"),Jt=zt(-1,"subtract");function Bt(e,t){var n=12*(t.year()-e.year())+(t.month()-e.month()),s=e.clone().add(n,"months");return-(n+(t-s<0?(t-s)/(s-e.clone().add(n-1,"months")):(t-s)/(e.clone().add(n+1,"months")-s)))||0}function Qt(e){var t;return void 0===e?this._locale._abbr:(null!=(t=lt(e))&&(this._locale=t),this)}n.defaultFormat="YYYY-MM-DDTHH:mm:ssZ",n.defaultFormatUtc="YYYY-MM-DDTHH:mm:ss[Z]";var Xt=k("moment().lang() is deprecated. Instead, use moment().localeData() to get the language configuration. Use moment().locale() to change languages.",function(e){return void 0===e?this.localeData():this.locale(e)});function Kt(){return this._locale}function en(e,t){I(0,[e,e.length],0,t)}function tn(e,t,n,s,i){var r;return null==e?Ie(this,s,i).year:(t>(r=Ae(e,s,i))&&(t=r),function(e,t,n,s,i){var r=Ee(e,t,n,s,i),a=Ge(r.year,0,r.dayOfYear);return this.year(a.getUTCFullYear()),this.month(a.getUTCMonth()),this.date(a.getUTCDate()),this}.call(this,e,t,n,s,i))}I(0,["gg",2],0,function(){return this.weekYear()%100}),I(0,["GG",2],0,function(){return this.isoWeekYear()%100}),en("gggg","weekYear"),en("ggggg","weekYear"),en("GGGG","isoWeekYear"),en("GGGGG","isoWeekYear"),H("weekYear","gg"),H("isoWeekYear","GG"),L("weekYear",1),L("isoWeekYear",1),ue("G",se),ue("g",se),ue("GG",B,z),ue("gg",B,z),ue("GGGG",ee,q),ue("gggg",ee,q),ue("GGGGG",te,J),ue("ggggg",te,J),fe(["gggg","ggggg","GGGG","GGGGG"],function(e,t,n,s){t[s.substr(0,2)]=M(e)}),fe(["gg","GG"],function(e,t,s,i){t[i]=n.parseTwoDigitYear(e)}),I("Q",0,"Qo","quarter"),H("quarter","Q"),L("quarter",7),ue("Q",Z),ce("Q",function(e,t){t[_e]=3*(M(e)-1)}),I("D",["DD",2],"Do","date"),H("date","D"),L("date",9),ue("D",B),ue("DD",B,z),ue("Do",function(e,t){return e?t._dayOfMonthOrdinalParse||t._ordinalParse:t._dayOfMonthOrdinalParseLenient}),ce(["D","DD"],ye),ce("Do",function(e,t){t[ye]=M(e.match(B)[0])});var nn=Te("Date",!0);I("DDD",["DDDD",3],"DDDo","dayOfYear"),H("dayOfYear","DDD"),L("dayOfYear",4),ue("DDD",K),ue("DDDD",$),ce(["DDD","DDDD"],function(e,t,n){n._dayOfYear=M(e)}),I("m",["mm",2],0,"minute"),H("minute","m"),L("minute",14),ue("m",B),ue("mm",B,z),ce(["m","mm"],pe);var sn=Te("Minutes",!1);I("s",["ss",2],0,"second"),H("second","s"),L("second",15),ue("s",B),ue("ss",B,z),ce(["s","ss"],ve);var rn,an=Te("Seconds",!1);for(I("S",0,0,function(){return~~(this.millisecond()/100)}),I(0,["SS",2],0,function(){return~~(this.millisecond()/10)}),I(0,["SSS",3],0,"millisecond"),I(0,["SSSS",4],0,function(){return 10*this.millisecond()}),I(0,["SSSSS",5],0,function(){return 100*this.millisecond()}),I(0,["SSSSSS",6],0,function(){return 1e3*this.millisecond()}),I(0,["SSSSSSS",7],0,function(){return 1e4*this.millisecond()}),I(0,["SSSSSSSS",8],0,function(){return 1e5*this.millisecond()}),I(0,["SSSSSSSSS",9],0,function(){return 1e6*this.millisecond()}),H("millisecond","ms"),L("millisecond",16),ue("S",K,Z),ue("SS",K,z),ue("SSS",K,$),rn="SSSS";rn.length<=9;rn+="S")ue(rn,ne);function on(e,t){t[we]=M(1e3*("0."+e))}for(rn="S";rn.length<=9;rn+="S")ce(rn,on);var un=Te("Milliseconds",!1);I("z",0,0,"zoneAbbr"),I("zz",0,0,"zoneName");var ln=p.prototype;function dn(e){return e}ln.add=qt,ln.calendar=function(e,t){var s=e||Tt(),i=Nt(s,this).startOf("day"),r=n.calendarFormat(this,i)||"sameElse",a=t&&(x(t[r])?t[r].call(this,s):t[r]);return this.format(a||this.localeData().calendar(r,this,Tt(s)))},ln.clone=function(){return new p(this)},ln.diff=function(e,t,n){var s,i,r;if(!this.isValid())return NaN;if(!(s=Nt(e,this)).isValid())return NaN;switch(i=6e4*(s.utcOffset()-this.utcOffset()),t=R(t)){case"year":r=Bt(this,s)/12;break;case"month":r=Bt(this,s);break;case"quarter":r=Bt(this,s)/3;break;case"second":r=(this-s)/1e3;break;case"minute":r=(this-s)/6e4;break;case"hour":r=(this-s)/36e5;break;case"day":r=(this-s-i)/864e5;break;case"week":r=(this-s-i)/6048e5;break;default:r=this-s}return n?r:w(r)},ln.endOf=function(e){return void 0===(e=R(e))||"millisecond"===e?this:("date"===e&&(e="day"),this.startOf(e).add(1,"isoWeek"===e?"week":e).subtract(1,"ms"))},ln.format=function(e){e||(e=this.isUtc()?n.defaultFormatUtc:n.defaultFormat);var t=A(this,e);return this.localeData().postformat(t)},ln.from=function(e,t){return this.isValid()&&(v(e)&&e.isValid()||Tt(e).isValid())?At({to:this,from:e}).locale(this.locale()).humanize(!t):this.localeData().invalidDate()},ln.fromNow=function(e){return this.from(Tt(),e)},ln.to=function(e,t){return this.isValid()&&(v(e)&&e.isValid()||Tt(e).isValid())?At({from:this,to:e}).locale(this.locale()).humanize(!t):this.localeData().invalidDate()},ln.toNow=function(e){return this.to(Tt(),e)},ln.get=function(e){return x(this[e=R(e)])?this[e]():this},ln.invalidAt=function(){return c(this).overflow},ln.isAfter=function(e,t){var n=v(e)?e:Tt(e);return!(!this.isValid()||!n.isValid())&&("millisecond"===(t=R(r(t)?"millisecond":t))?this.valueOf()>n.valueOf():n.valueOf()<this.clone().startOf(t).valueOf())},ln.isBefore=function(e,t){var n=v(e)?e:Tt(e);return!(!this.isValid()||!n.isValid())&&("millisecond"===(t=R(r(t)?"millisecond":t))?this.valueOf()<n.valueOf():this.clone().endOf(t).valueOf()<n.valueOf())},ln.isBetween=function(e,t,n,s){return("("===(s=s||"()")[0]?this.isAfter(e,n):!this.isBefore(e,n))&&(")"===s[1]?this.isBefore(t,n):!this.isAfter(t,n))},ln.isSame=function(e,t){var n,s=v(e)?e:Tt(e);return!(!this.isValid()||!s.isValid())&&("millisecond"===(t=R(t||"millisecond"))?this.valueOf()===s.valueOf():(n=s.valueOf(),this.clone().startOf(t).valueOf()<=n&&n<=this.clone().endOf(t).valueOf()))},ln.isSameOrAfter=function(e,t){return this.isSame(e,t)||this.isAfter(e,t)},ln.isSameOrBefore=function(e,t){return this.isSame(e,t)||this.isBefore(e,t)},ln.isValid=function(){return f(this)},ln.lang=Xt,ln.locale=Qt,ln.localeData=Kt,ln.max=bt,ln.min=xt,ln.parsingFlags=function(){return d({},c(this))},ln.set=function(e,t){if("object"==typeof e)for(var n=function(e){var t=[];for(var n in e)t.push({unit:n,priority:F[n]});return t.sort(function(e,t){return e.priority-t.priority}),t}(e=C(e)),s=0;s<n.length;s++)this[n[s].unit](e[n[s].unit]);else if(x(this[e=R(e)]))return this[e](t);return this},ln.startOf=function(e){switch(e=R(e)){case"year":this.month(0);case"quarter":case"month":this.date(1);case"week":case"isoWeek":case"day":case"date":this.hours(0);case"hour":this.minutes(0);case"minute":this.seconds(0);case"second":this.milliseconds(0)}return"week"===e&&this.weekday(0),"isoWeek"===e&&this.isoWeekday(1),"quarter"===e&&this.month(3*Math.floor(this.month()/3)),this},ln.subtract=Jt,ln.toArray=function(){var e=this;return[e.year(),e.month(),e.date(),e.hour(),e.minute(),e.second(),e.millisecond()]},ln.toObject=function(){var e=this;return{years:e.year(),months:e.month(),date:e.date(),hours:e.hours(),minutes:e.minutes(),seconds:e.seconds(),milliseconds:e.milliseconds()}},ln.toDate=function(){return new Date(this.valueOf())},ln.toISOString=function(e){if(!this.isValid())return null;var t=!0!==e,n=t?this.clone().utc():this;return n.year()<0||n.year()>9999?A(n,t?"YYYYYY-MM-DD[T]HH:mm:ss.SSS[Z]":"YYYYYY-MM-DD[T]HH:mm:ss.SSSZ"):x(Date.prototype.toISOString)?t?this.toDate().toISOString():new Date(this.valueOf()+60*this.utcOffset()*1e3).toISOString().replace("Z",A(n,"Z")):A(n,t?"YYYY-MM-DD[T]HH:mm:ss.SSS[Z]":"YYYY-MM-DD[T]HH:mm:ss.SSSZ")},ln.inspect=function(){if(!this.isValid())return"moment.invalid(/* "+this._i+" */)";var e="moment",t="";this.isLocal()||(e=0===this.utcOffset()?"moment.utc":"moment.parseZone",t="Z");var n="["+e+'("]',s=0<=this.year()&&this.year()<=9999?"YYYY":"YYYYYY",i=t+'[")]';return this.format(n+s+"-MM-DD[T]HH:mm:ss.SSS"+i)},ln.toJSON=function(){return this.isValid()?this.toISOString():null},ln.toString=function(){return this.clone().locale("en").format("ddd MMM DD YYYY HH:mm:ss [GMT]ZZ")},ln.unix=function(){return Math.floor(this.valueOf()/1e3)},ln.valueOf=function(){return this._d.valueOf()-6e4*(this._offset||0)},ln.creationData=function(){return{input:this._i,format:this._f,locale:this._locale,isUTC:this._isUTC,strict:this._strict}},ln.year=Oe,ln.isLeapYear=function(){return ke(this.year())},ln.weekYear=function(e){return tn.call(this,e,this.week(),this.weekday(),this.localeData()._week.dow,this.localeData()._week.doy)},ln.isoWeekYear=function(e){return tn.call(this,e,this.isoWeek(),this.isoWeekday(),1,4)},ln.quarter=ln.quarters=function(e){return null==e?Math.ceil((this.month()+1)/3):this.month(3*(e-1)+this.month()%3)},ln.month=Fe,ln.daysInMonth=function(){return Pe(this.year(),this.month())},ln.week=ln.weeks=function(e){var t=this.localeData().week(this);return null==e?t:this.add(7*(e-t),"d")},ln.isoWeek=ln.isoWeeks=function(e){var t=Ie(this,1,4).week;return null==e?t:this.add(7*(e-t),"d")},ln.weeksInYear=function(){var e=this.localeData()._week;return Ae(this.year(),e.dow,e.doy)},ln.isoWeeksInYear=function(){return Ae(this.year(),1,4)},ln.date=nn,ln.day=ln.days=function(e){if(!this.isValid())return null!=e?this:NaN;var t,n,s=this._isUTC?this._d.getUTCDay():this._d.getDay();return null!=e?(t=e,n=this.localeData(),e="string"!=typeof t?t:isNaN(t)?"number"==typeof(t=n.weekdaysParse(t))?t:null:parseInt(t,10),this.add(e-s,"d")):s},ln.weekday=function(e){if(!this.isValid())return null!=e?this:NaN;var t=(this.day()+7-this.localeData()._week.dow)%7;return null==e?t:this.add(e-t,"d")},ln.isoWeekday=function(e){if(!this.isValid())return null!=e?this:NaN;if(null!=e){var t=(n=e,s=this.localeData(),"string"==typeof n?s.weekdaysParse(n)%7||7:isNaN(n)?null:n);return this.day(this.day()%7?t:t-7)}return this.day()||7;var n,s},ln.dayOfYear=function(e){var t=Math.round((this.clone().startOf("day")-this.clone().startOf("year"))/864e5)+1;return null==e?t:this.add(e-t,"d")},ln.hour=ln.hours=tt,ln.minute=ln.minutes=sn,ln.second=ln.seconds=an,ln.millisecond=ln.milliseconds=un,ln.utcOffset=function(e,t,s){var i,r=this._offset||0;if(!this.isValid())return null!=e?this:NaN;if(null!=e){if("string"==typeof e){if(null===(e=Ut(re,e)))return this}else Math.abs(e)<16&&!s&&(e*=60);return!this._isUTC&&t&&(i=Gt(this)),this._offset=e,this._isUTC=!0,null!=i&&this.add(i,"m"),r!==e&&(!t||this._changeInProgress?$t(this,At(e-r,"m"),1,!1):this._changeInProgress||(this._changeInProgress=!0,n.updateOffset(this,!0),this._changeInProgress=null)),this}return this._isUTC?r:Gt(this)},ln.utc=function(e){return this.utcOffset(0,e)},ln.local=function(e){return this._isUTC&&(this.utcOffset(0,e),this._isUTC=!1,e&&this.subtract(Gt(this),"m")),this},ln.parseZone=function(){if(null!=this._tzm)this.utcOffset(this._tzm,!1,!0);else if("string"==typeof this._i){var e=Ut(ie,this._i);null!=e?this.utcOffset(e):this.utcOffset(0,!0)}return this},ln.hasAlignedHourOffset=function(e){return!!this.isValid()&&(e=e?Tt(e).utcOffset():0,(this.utcOffset()-e)%60==0)},ln.isDST=function(){return this.utcOffset()>this.clone().month(0).utcOffset()||this.utcOffset()>this.clone().month(5).utcOffset()},ln.isLocal=function(){return!!this.isValid()&&!this._isUTC},ln.isUtcOffset=function(){return!!this.isValid()&&this._isUTC},ln.isUtc=Vt,ln.isUTC=Vt,ln.zoneAbbr=function(){return this._isUTC?"UTC":""},ln.zoneName=function(){return this._isUTC?"Coordinated Universal Time":""},ln.dates=k("dates accessor is deprecated. Use date instead.",nn),ln.months=k("months accessor is deprecated. Use month instead",Fe),ln.years=k("years accessor is deprecated. Use year instead",Oe),ln.zone=k("moment().zone is deprecated, use moment().utcOffset instead. http://momentjs.com/guides/#/warnings/zone/",function(e,t){return null!=e?("string"!=typeof e&&(e=-e),this.utcOffset(e,t),this):-this.utcOffset()}),ln.isDSTShifted=k("isDSTShifted is deprecated. See http://momentjs.com/guides/#/warnings/dst-shifted/ for more information",function(){if(!r(this._isDSTShifted))return this._isDSTShifted;var e={};if(y(e,this),(e=Yt(e))._a){var t=e._isUTC?h(e._a):Tt(e._a);this._isDSTShifted=this.isValid()&&S(e._a,t.toArray())>0}else this._isDSTShifted=!1;return this._isDSTShifted});var hn=P.prototype;function cn(e,t,n,s){var i=lt(),r=h().set(s,t);return i[n](r,e)}function fn(e,t,n){if(a(e)&&(t=e,e=void 0),e=e||"",null!=t)return cn(e,t,n,"month");var s,i=[];for(s=0;s<12;s++)i[s]=cn(e,s,n,"month");return i}function mn(e,t,n,s){"boolean"==typeof e?(a(t)&&(n=t,t=void 0),t=t||""):(n=t=e,e=!1,a(t)&&(n=t,t=void 0),t=t||"");var i,r=lt(),o=e?r._week.dow:0;if(null!=n)return cn(t,(n+o)%7,s,"day");var u=[];for(i=0;i<7;i++)u[i]=cn(t,(i+o)%7,s,"day");return u}hn.calendar=function(e,t,n){var s=this._calendar[e]||this._calendar.sameElse;return x(s)?s.call(t,n):s},hn.longDateFormat=function(e){var t=this._longDateFormat[e],n=this._longDateFormat[e.toUpperCase()];return t||!n?t:(this._longDateFormat[e]=n.replace(/MMMM|MM|DD|dddd/g,function(e){return e.slice(1)}),this._longDateFormat[e])},hn.invalidDate=function(){return this._invalidDate},hn.ordinal=function(e){return this._ordinal.replace("%d",e)},hn.preparse=dn,hn.postformat=dn,hn.relativeTime=function(e,t,n,s){var i=this._relativeTime[n];return x(i)?i(e,t,n,s):i.replace(/%d/i,e)},hn.pastFuture=function(e,t){var n=this._relativeTime[e>0?"future":"past"];return x(n)?n(t):n.replace(/%s/i,t)},hn.set=function(e){var t,n;for(n in e)x(t=e[n])?this[n]=t:this["_"+n]=t;this._config=e,this._dayOfMonthOrdinalParseLenient=new RegExp((this._dayOfMonthOrdinalParse.source||this._ordinalParse.source)+"|"+/\d{1,2}/.source)},hn.months=function(e,t){return e?s(this._months)?this._months[e.month()]:this._months[(this._months.isFormat||We).test(t)?"format":"standalone"][e.month()]:s(this._months)?this._months:this._months.standalone},hn.monthsShort=function(e,t){return e?s(this._monthsShort)?this._monthsShort[e.month()]:this._monthsShort[We.test(t)?"format":"standalone"][e.month()]:s(this._monthsShort)?this._monthsShort:this._monthsShort.standalone},hn.monthsParse=function(e,t,n){var s,i,r;if(this._monthsParseExact)return function(e,t,n){var s,i,r,a=e.toLocaleLowerCase();if(!this._monthsParse)for(this._monthsParse=[],this._longMonthsParse=[],this._shortMonthsParse=[],s=0;s<12;++s)r=h([2e3,s]),this._shortMonthsParse[s]=this.monthsShort(r,"").toLocaleLowerCase(),this._longMonthsParse[s]=this.months(r,"").toLocaleLowerCase();return n?"MMM"===t?-1!==(i=Ye.call(this._shortMonthsParse,a))?i:null:-1!==(i=Ye.call(this._longMonthsParse,a))?i:null:"MMM"===t?-1!==(i=Ye.call(this._shortMonthsParse,a))?i:-1!==(i=Ye.call(this._longMonthsParse,a))?i:null:-1!==(i=Ye.call(this._longMonthsParse,a))?i:-1!==(i=Ye.call(this._shortMonthsParse,a))?i:null}.call(this,e,t,n);for(this._monthsParse||(this._monthsParse=[],this._longMonthsParse=[],this._shortMonthsParse=[]),s=0;s<12;s++){if(i=h([2e3,s]),n&&!this._longMonthsParse[s]&&(this._longMonthsParse[s]=new RegExp("^"+this.months(i,"").replace(".","")+"$","i"),this._shortMonthsParse[s]=new RegExp("^"+this.monthsShort(i,"").replace(".","")+"$","i")),n||this._monthsParse[s]||(r="^"+this.months(i,"")+"|^"+this.monthsShort(i,""),this._monthsParse[s]=new RegExp(r.replace(".",""),"i")),n&&"MMMM"===t&&this._longMonthsParse[s].test(e))return s;if(n&&"MMM"===t&&this._shortMonthsParse[s].test(e))return s;if(!n&&this._monthsParse[s].test(e))return s}},hn.monthsRegex=function(e){return this._monthsParseExact?(l(this,"_monthsRegex")||Ne.call(this),e?this._monthsStrictRegex:this._monthsRegex):(l(this,"_monthsRegex")||(this._monthsRegex=Ue),this._monthsStrictRegex&&e?this._monthsStrictRegex:this._monthsRegex)},hn.monthsShortRegex=function(e){return this._monthsParseExact?(l(this,"_monthsRegex")||Ne.call(this),e?this._monthsShortStrictRegex:this._monthsShortRegex):(l(this,"_monthsShortRegex")||(this._monthsShortRegex=Le),this._monthsShortStrictRegex&&e?this._monthsShortStrictRegex:this._monthsShortRegex)},hn.week=function(e){return Ie(e,this._week.dow,this._week.doy).week},hn.firstDayOfYear=function(){return this._week.doy},hn.firstDayOfWeek=function(){return this._week.dow},hn.weekdays=function(e,t){return e?s(this._weekdays)?this._weekdays[e.day()]:this._weekdays[this._weekdays.isFormat.test(t)?"format":"standalone"][e.day()]:s(this._weekdays)?this._weekdays:this._weekdays.standalone},hn.weekdaysMin=function(e){return e?this._weekdaysMin[e.day()]:this._weekdaysMin},hn.weekdaysShort=function(e){return e?this._weekdaysShort[e.day()]:this._weekdaysShort},hn.weekdaysParse=function(e,t,n){var s,i,r;if(this._weekdaysParseExact)return function(e,t,n){var s,i,r,a=e.toLocaleLowerCase();if(!this._weekdaysParse)for(this._weekdaysParse=[],this._shortWeekdaysParse=[],this._minWeekdaysParse=[],s=0;s<7;++s)r=h([2e3,1]).day(s),this._minWeekdaysParse[s]=this.weekdaysMin(r,"").toLocaleLowerCase(),this._shortWeekdaysParse[s]=this.weekdaysShort(r,"").toLocaleLowerCase(),this._weekdaysParse[s]=this.weekdays(r,"").toLocaleLowerCase();return n?"dddd"===t?-1!==(i=Ye.call(this._weekdaysParse,a))?i:null:"ddd"===t?-1!==(i=Ye.call(this._shortWeekdaysParse,a))?i:null:-1!==(i=Ye.call(this._minWeekdaysParse,a))?i:null:"dddd"===t?-1!==(i=Ye.call(this._weekdaysParse,a))?i:-1!==(i=Ye.call(this._shortWeekdaysParse,a))?i:-1!==(i=Ye.call(this._minWeekdaysParse,a))?i:null:"ddd"===t?-1!==(i=Ye.call(this._shortWeekdaysParse,a))?i:-1!==(i=Ye.call(this._weekdaysParse,a))?i:-1!==(i=Ye.call(this._minWeekdaysParse,a))?i:null:-1!==(i=Ye.call(this._minWeekdaysParse,a))?i:-1!==(i=Ye.call(this._weekdaysParse,a))?i:-1!==(i=Ye.call(this._shortWeekdaysParse,a))?i:null}.call(this,e,t,n);for(this._weekdaysParse||(this._weekdaysParse=[],this._minWeekdaysParse=[],this._shortWeekdaysParse=[],this._fullWeekdaysParse=[]),s=0;s<7;s++){if(i=h([2e3,1]).day(s),n&&!this._fullWeekdaysParse[s]&&(this._fullWeekdaysParse[s]=new RegExp("^"+this.weekdays(i,"").replace(".",".?")+"$","i"),this._shortWeekdaysParse[s]=new RegExp("^"+this.weekdaysShort(i,"").replace(".",".?")+"$","i"),this._minWeekdaysParse[s]=new RegExp("^"+this.weekdaysMin(i,"").replace(".",".?")+"$","i")),this._weekdaysParse[s]||(r="^"+this.weekdays(i,"")+"|^"+this.weekdaysShort(i,"")+"|^"+this.weekdaysMin(i,""),this._weekdaysParse[s]=new RegExp(r.replace(".",""),"i")),n&&"dddd"===t&&this._fullWeekdaysParse[s].test(e))return s;if(n&&"ddd"===t&&this._shortWeekdaysParse[s].test(e))return s;if(n&&"dd"===t&&this._minWeekdaysParse[s].test(e))return s;if(!n&&this._weekdaysParse[s].test(e))return s}},hn.weekdaysRegex=function(e){return this._weekdaysParseExact?(l(this,"_weekdaysRegex")||Be.call(this),e?this._weekdaysStrictRegex:this._weekdaysRegex):(l(this,"_weekdaysRegex")||(this._weekdaysRegex=$e),this._weekdaysStrictRegex&&e?this._weekdaysStrictRegex:this._weekdaysRegex)},hn.weekdaysShortRegex=function(e){return this._weekdaysParseExact?(l(this,"_weekdaysRegex")||Be.call(this),e?this._weekdaysShortStrictRegex:this._weekdaysShortRegex):(l(this,"_weekdaysShortRegex")||(this._weekdaysShortRegex=qe),this._weekdaysShortStrictRegex&&e?this._weekdaysShortStrictRegex:this._weekdaysShortRegex)},hn.weekdaysMinRegex=function(e){return this._weekdaysParseExact?(l(this,"_weekdaysRegex")||Be.call(this),e?this._weekdaysMinStrictRegex:this._weekdaysMinRegex):(l(this,"_weekdaysMinRegex")||(this._weekdaysMinRegex=Je),this._weekdaysMinStrictRegex&&e?this._weekdaysMinStrictRegex:this._weekdaysMinRegex)},hn.isPM=function(e){return"p"===(e+"").toLowerCase().charAt(0)},hn.meridiem=function(e,t,n){return e>11?n?"pm":"PM":n?"am":"AM"},ot("en",{dayOfMonthOrdinalParse:/\d{1,2}(th|st|nd|rd)/,ordinal:function(e){var t=e%10;return e+(1===M(e%100/10)?"th":1===t?"st":2===t?"nd":3===t?"rd":"th")}}),n.lang=k("moment.lang is deprecated. Use moment.locale instead.",ot),n.langData=k("moment.langData is deprecated. Use moment.localeData instead.",lt);var _n=Math.abs;function yn(e,t,n,s){var i=At(t,n);return e._milliseconds+=s*i._milliseconds,e._days+=s*i._days,e._months+=s*i._months,e._bubble()}function gn(e){return e<0?Math.floor(e):Math.ceil(e)}function pn(e){return 4800*e/146097}function vn(e){return 146097*e/4800}function wn(e){return function(){return this.as(e)}}var Mn=wn("ms"),Sn=wn("s"),Dn=wn("m"),kn=wn("h"),Yn=wn("d"),On=wn("w"),Tn=wn("M"),xn=wn("y");function bn(e){return function(){return this.isValid()?this._data[e]:NaN}}var Pn=bn("milliseconds"),Wn=bn("seconds"),Hn=bn("minutes"),Rn=bn("hours"),Cn=bn("days"),Fn=bn("months"),Ln=bn("years");var Un=Math.round,Nn={ss:44,s:45,m:45,h:22,d:26,M:11};var Gn=Math.abs;function Vn(e){return(e>0)-(e<0)||+e}function En(){if(!this.isValid())return this.localeData().invalidDate();var e,t,n=Gn(this._milliseconds)/1e3,s=Gn(this._days),i=Gn(this._months);t=w((e=w(n/60))/60),n%=60,e%=60;var r=w(i/12),a=i%=12,o=s,u=t,l=e,d=n?n.toFixed(3).replace(/\.?0+$/,""):"",h=this.asSeconds();if(!h)return"P0D";var c=h<0?"-":"",f=Vn(this._months)!==Vn(h)?"-":"",m=Vn(this._days)!==Vn(h)?"-":"",_=Vn(this._milliseconds)!==Vn(h)?"-":"";return c+"P"+(r?f+r+"Y":"")+(a?f+a+"M":"")+(o?m+o+"D":"")+(u||l||d?"T":"")+(u?_+u+"H":"")+(l?_+l+"M":"")+(d?_+d+"S":"")}var In=Ht.prototype;return In.isValid=function(){return this._isValid},In.abs=function(){var e=this._data;return this._milliseconds=_n(this._milliseconds),this._days=_n(this._days),this._months=_n(this._months),e.milliseconds=_n(e.milliseconds),e.seconds=_n(e.seconds),e.minutes=_n(e.minutes),e.hours=_n(e.hours),e.months=_n(e.months),e.years=_n(e.years),this},In.add=function(e,t){return yn(this,e,t,1)},In.subtract=function(e,t){return yn(this,e,t,-1)},In.as=function(e){if(!this.isValid())return NaN;var t,n,s=this._milliseconds;if("month"===(e=R(e))||"year"===e)return t=this._days+s/864e5,n=this._months+pn(t),"month"===e?n:n/12;switch(t=this._days+Math.round(vn(this._months)),e){case"week":return t/7+s/6048e5;case"day":return t+s/864e5;case"hour":return 24*t+s/36e5;case"minute":return 1440*t+s/6e4;case"second":return 86400*t+s/1e3;case"millisecond":return Math.floor(864e5*t)+s;default:throw new Error("Unknown unit "+e)}},In.asMilliseconds=Mn,In.asSeconds=Sn,In.asMinutes=Dn,In.asHours=kn,In.asDays=Yn,In.asWeeks=On,In.asMonths=Tn,In.asYears=xn,In.valueOf=function(){return this.isValid()?this._milliseconds+864e5*this._days+this._months%12*2592e6+31536e6*M(this._months/12):NaN},In._bubble=function(){var e,t,n,s,i,r=this._milliseconds,a=this._days,o=this._months,u=this._data;return r>=0&&a>=0&&o>=0||r<=0&&a<=0&&o<=0||(r+=864e5*gn(vn(o)+a),a=0,o=0),u.milliseconds=r%1e3,e=w(r/1e3),u.seconds=e%60,t=w(e/60),u.minutes=t%60,n=w(t/60),u.hours=n%24,o+=i=w(pn(a+=w(n/24))),a-=gn(vn(i)),s=w(o/12),o%=12,u.days=a,u.months=o,u.years=s,this},In.clone=function(){return At(this)},In.get=function(e){return e=R(e),this.isValid()?this[e+"s"]():NaN},In.milliseconds=Pn,In.seconds=Wn,In.minutes=Hn,In.hours=Rn,In.days=Cn,In.weeks=function(){return w(this.days()/7)},In.months=Fn,In.years=Ln,In.humanize=function(e){if(!this.isValid())return this.localeData().invalidDate();var t,n,s,i,r,a,o,u,l,d,h,c=this.localeData(),f=(n=!e,s=c,i=At(t=this).abs(),r=Un(i.as("s")),a=Un(i.as("m")),o=Un(i.as("h")),u=Un(i.as("d")),l=Un(i.as("M")),d=Un(i.as("y")),(h=r<=Nn.ss&&["s",r]||r<Nn.s&&["ss",r]||a<=1&&["m"]||a<Nn.m&&["mm",a]||o<=1&&["h"]||o<Nn.h&&["hh",o]||u<=1&&["d"]||u<Nn.d&&["dd",u]||l<=1&&["M"]||l<Nn.M&&["MM",l]||d<=1&&["y"]||["yy",d])[2]=n,h[3]=+t>0,h[4]=s,function(e,t,n,s,i){return i.relativeTime(t||1,!!n,e,s)}.apply(null,h));return e&&(f=c.pastFuture(+this,f)),c.postformat(f)},In.toISOString=En,In.toString=En,In.toJSON=En,In.locale=Qt,In.localeData=Kt,In.toIsoString=k("toIsoString() is deprecated. Please use toISOString() instead (notice the capitals)",En),In.lang=Xt,I("X",0,0,"unix"),I("x",0,0,"valueOf"),ue("x",se),ue("X",/[+-]?\d+(\.\d{1,3})?/),ce("X",function(e,t,n){n._d=new Date(1e3*parseFloat(e,10))}),ce("x",function(e,t,n){n._d=new Date(M(e))}),n.version="2.21.0",e=Tt,n.fn=ln,n.min=function(){return Pt("isBefore",[].slice.call(arguments,0))},n.max=function(){return Pt("isAfter",[].slice.call(arguments,0))},n.now=function(){return Date.now?Date.now():+new Date},n.utc=h,n.unix=function(e){return Tt(1e3*e)},n.months=function(e,t){return fn(e,t,"months")},n.isDate=o,n.locale=ot,n.invalid=m,n.duration=At,n.isMoment=v,n.weekdays=function(e,t,n){return mn(e,t,n,"weekdays")},n.parseZone=function(){return Tt.apply(null,arguments).parseZone()},n.localeData=lt,n.isDuration=Rt,n.monthsShort=function(e,t){return fn(e,t,"monthsShort")},n.weekdaysMin=function(e,t,n){return mn(e,t,n,"weekdaysMin")},n.defineLocale=ut,n.updateLocale=function(e,t){if(null!=t){var n,s,i=nt;null!=(s=at(e))&&(i=s._config),(n=new P(t=b(i,t))).parentLocale=st[e],st[e]=n,ot(e)}else null!=st[e]&&(null!=st[e].parentLocale?st[e]=st[e].parentLocale:null!=st[e]&&delete st[e]);return st[e]},n.locales=function(){return Y(st)},n.weekdaysShort=function(e,t,n){return mn(e,t,n,"weekdaysShort")},n.normalizeUnits=R,n.relativeTimeRounding=function(e){return void 0===e?Un:"function"==typeof e&&(Un=e,!0)},n.relativeTimeThreshold=function(e,t){return void 0!==Nn[e]&&(void 0===t?Nn[e]:(Nn[e]=t,"s"===e&&(Nn.ss=t-1),!0))},n.calendarFormat=function(e,t){var n=e.diff(t,"days",!0);return n<-6?"sameElse":n<-1?"lastWeek":n<0?"lastDay":n<1?"sameDay":n<2?"nextDay":n<7?"nextWeek":"sameElse"},n.prototype=ln,n.HTML5_FMT={DATETIME_LOCAL:"YYYY-MM-DDTHH:mm",DATETIME_LOCAL_SECONDS:"YYYY-MM-DDTHH:mm:ss",DATETIME_LOCAL_MS:"YYYY-MM-DDTHH:mm:ss.SSS",DATE:"YYYY-MM-DD",TIME:"HH:mm",TIME_SECONDS:"HH:mm:ss",TIME_MS:"HH:mm:ss.SSS",WEEK:"YYYY-[W]WW",MONTH:"YYYY-MM"},n});/*!
 * FullCalendar v3.9.0
 * Docs & License: https://fullcalendar.io/
 * (c) 2018 Adam Shaw
 */
!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e(require("moment"),require("jquery")):"function"==typeof define&&define.amd?define(["moment","jquery"],e):"object"==typeof exports?exports.FullCalendar=e(require("moment"),require("jquery")):t.FullCalendar=e(t.moment,t.jQuery)}("undefined"!=typeof self?self:this,function(t,e){return function(t){function e(i){if(n[i])return n[i].exports;var r=n[i]={i:i,l:!1,exports:{}};return t[i].call(r.exports,r,r.exports,e),r.l=!0,r.exports}var n={};return e.m=t,e.c=n,e.d=function(t,n,i){e.o(t,n)||Object.defineProperty(t,n,{configurable:!1,enumerable:!0,get:i})},e.n=function(t){var n=t&&t.__esModule?function(){return t.default}:function(){return t};return e.d(n,"a",n),n},e.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},e.p="",e(e.s=236)}([function(e,n){e.exports=t},,function(t,e){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])};e.__extends=function(t,e){function i(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}},function(t,n){t.exports=e},function(t,e,n){function i(t,e){e.left&&t.css({"border-left-width":1,"margin-left":e.left-1}),e.right&&t.css({"border-right-width":1,"margin-right":e.right-1})}function r(t){t.css({"margin-left":"","margin-right":"","border-left-width":"","border-right-width":""})}function o(){ht("body").addClass("fc-not-allowed")}function s(){ht("body").removeClass("fc-not-allowed")}function a(t,e,n){var i=Math.floor(e/t.length),r=Math.floor(e-i*(t.length-1)),o=[],s=[],a=[],u=0;l(t),t.each(function(e,n){var l=e===t.length-1?r:i,d=ht(n).outerHeight(!0);d<l?(o.push(n),s.push(d),a.push(ht(n).height())):u+=d}),n&&(e-=u,i=Math.floor(e/o.length),r=Math.floor(e-i*(o.length-1))),ht(o).each(function(t,e){var n=t===o.length-1?r:i,l=s[t],u=a[t],d=n-(l-u);l<n&&ht(e).height(d)})}function l(t){t.height("")}function u(t){var e=0;return t.find("> *").each(function(t,n){var i=ht(n).outerWidth();i>e&&(e=i)}),e++,t.width(e),e}function d(t,e){var n,i=t.add(e);return i.css({position:"relative",left:-1}),n=t.outerHeight()-e.outerHeight(),i.css({position:"",left:""}),n}function c(t){var e=t.css("position"),n=t.parents().filter(function(){var t=ht(this);return/(auto|scroll)/.test(t.css("overflow")+t.css("overflow-y")+t.css("overflow-x"))}).eq(0);return"fixed"!==e&&n.length?n:ht(t[0].ownerDocument||document)}function p(t,e){var n=t.offset(),i=n.left-(e?e.left:0),r=n.top-(e?e.top:0);return{left:i,right:i+t.outerWidth(),top:r,bottom:r+t.outerHeight()}}function h(t,e){var n=t.offset(),i=g(t),r=n.left+b(t,"border-left-width")+i.left-(e?e.left:0),o=n.top+b(t,"border-top-width")+i.top-(e?e.top:0);return{left:r,right:r+t[0].clientWidth,top:o,bottom:o+t[0].clientHeight}}function f(t,e){var n=t.offset(),i=n.left+b(t,"border-left-width")+b(t,"padding-left")-(e?e.left:0),r=n.top+b(t,"border-top-width")+b(t,"padding-top")-(e?e.top:0);return{left:i,right:i+t.width(),top:r,bottom:r+t.height()}}function g(t){var e,n=t[0].offsetWidth-t[0].clientWidth,i=t[0].offsetHeight-t[0].clientHeight;return n=v(n),i=v(i),e={left:0,right:0,top:0,bottom:i},y()&&"rtl"===t.css("direction")?e.left=n:e.right=n,e}function v(t){return t=Math.max(0,t),t=Math.round(t)}function y(){return null===ft&&(ft=m()),ft}function m(){var t=ht("<div><div/></div>").css({position:"absolute",top:-1e3,left:0,border:0,padding:0,overflow:"scroll",direction:"rtl"}).appendTo("body"),e=t.children(),n=e.offset().left>t.offset().left;return t.remove(),n}function b(t,e){return parseFloat(t.css(e))||0}function w(t){return 1===t.which&&!t.ctrlKey}function D(t){var e=t.originalEvent.touches;return e&&e.length?e[0].pageX:t.pageX}function E(t){var e=t.originalEvent.touches;return e&&e.length?e[0].pageY:t.pageY}function S(t){return/^touch/.test(t.type)}function C(t){t.addClass("fc-unselectable").on("selectstart",T)}function R(t){t.removeClass("fc-unselectable").off("selectstart",T)}function T(t){t.preventDefault()}function M(t,e){var n={left:Math.max(t.left,e.left),right:Math.min(t.right,e.right),top:Math.max(t.top,e.top),bottom:Math.min(t.bottom,e.bottom)};return n.left<n.right&&n.top<n.bottom&&n}function I(t,e){return{left:Math.min(Math.max(t.left,e.left),e.right),top:Math.min(Math.max(t.top,e.top),e.bottom)}}function H(t){return{left:(t.left+t.right)/2,top:(t.top+t.bottom)/2}}function P(t,e){return{left:t.left-e.left,top:t.top-e.top}}function _(t){var e,n,i=[],r=[];for("string"==typeof t?r=t.split(/\s*,\s*/):"function"==typeof t?r=[t]:ht.isArray(t)&&(r=t),e=0;e<r.length;e++)n=r[e],"string"==typeof n?i.push("-"===n.charAt(0)?{field:n.substring(1),order:-1}:{field:n,order:1}):"function"==typeof n&&i.push({func:n});return i}function x(t,e,n,i,r){var o,s;for(o=0;o<n.length;o++)if(s=O(t,e,n[o],i,r))return s;return 0}function O(t,e,n,i,r){if(n.func)return n.func(t,e);var o=t[n.field],s=e[n.field];return null==o&&i&&(o=i[n.field]),null==s&&r&&(s=r[n.field]),F(o,s)*(n.order||1)}function F(t,e){return t||e?null==e?-1:null==t?1:"string"===ht.type(t)||"string"===ht.type(e)?String(t).localeCompare(String(e)):t-e:0}function z(t,e){return pt.duration({days:t.clone().stripTime().diff(e.clone().stripTime(),"days"),ms:t.time()-e.time()})}function B(t,e){return pt.duration({days:t.clone().stripTime().diff(e.clone().stripTime(),"days")})}function A(t,e,n){return pt.duration(Math.round(t.diff(e,n,!0)),n)}function k(t,n){var i,r,o;for(i=0;i<e.unitsDesc.length&&(r=e.unitsDesc[i],!((o=V(r,t,n))>=1&&ut(o)));i++);return r}function L(t,e){var n=k(t);return"week"===n&&"object"==typeof e&&e.days&&(n="day"),n}function V(t,e,n){return null!=n?n.diff(e,t,!0):pt.isDuration(e)?e.as(t):e.end.diff(e.start,t,!0)}function G(t,e,n){var i;return U(n)?(e-t)/n:(i=n.asMonths(),Math.abs(i)>=1&&ut(i)?e.diff(t,"months",!0)/i:e.diff(t,"days",!0)/n.asDays())}function N(t,e){var n,i;return U(t)||U(e)?t/e:(n=t.asMonths(),i=e.asMonths(),Math.abs(n)>=1&&ut(n)&&Math.abs(i)>=1&&ut(i)?n/i:t.asDays()/e.asDays())}function j(t,e){var n;return U(t)?pt.duration(t*e):(n=t.asMonths(),Math.abs(n)>=1&&ut(n)?pt.duration({months:n*e}):pt.duration({days:t.asDays()*e}))}function U(t){return Boolean(t.hours()||t.minutes()||t.seconds()||t.milliseconds())}function W(t){return"[object Date]"===Object.prototype.toString.call(t)||t instanceof Date}function q(t){return"string"==typeof t&&/^\d+\:\d+(?:\:\d+\.?(?:\d{3})?)?$/.test(t)}function Y(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var n=window.console;if(n&&n.log)return n.log.apply(n,t)}function Z(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var n=window.console;return n&&n.warn?n.warn.apply(n,t):Y.apply(null,t)}function Q(t,e){var n,i,r,o,s,a,l={};if(e)for(n=0;n<e.length;n++){for(i=e[n],r=[],o=t.length-1;o>=0;o--)if("object"==typeof(s=t[o][i]))r.unshift(s);else if(void 0!==s){l[i]=s;break}r.length&&(l[i]=Q(r))}for(n=t.length-1;n>=0;n--){a=t[n];for(i in a)i in l||(l[i]=a[i])}return l}function X(t,e){for(var n in t)$(t,n)&&(e[n]=t[n])}function $(t,e){return gt.call(t,e)}function K(t,e,n){if(ht.isFunction(t)&&(t=[t]),t){var i=void 0,r=void 0;for(i=0;i<t.length;i++)r=t[i].apply(e,n)||r;return r}}function J(t,e){for(var n=0,i=0;i<t.length;)e(t[i])?(t.splice(i,1),n++):i++;return n}function tt(t,e){for(var n=0,i=0;i<t.length;)t[i]===e?(t.splice(i,1),n++):i++;return n}function et(t,e){var n,i=t.length;if(null==i||i!==e.length)return!1;for(n=0;n<i;n++)if(t[n]!==e[n])return!1;return!0}function nt(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];for(var n=0;n<t.length;n++)if(void 0!==t[n])return t[n]}function it(t){return(t+"").replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/'/g,"&#039;").replace(/"/g,"&quot;").replace(/\n/g,"<br />")}function rt(t){return t.replace(/&.*?;/g,"")}function ot(t){var e=[];return ht.each(t,function(t,n){null!=n&&e.push(t+":"+n)}),e.join(";")}function st(t){var e=[];return ht.each(t,function(t,n){null!=n&&e.push(t+'="'+it(n)+'"')}),e.join(" ")}function at(t){return t.charAt(0).toUpperCase()+t.slice(1)}function lt(t,e){return t-e}function ut(t){return t%1==0}function dt(t,e){var n=t[e];return function(){return n.apply(t,arguments)}}function ct(t,e,n){void 0===n&&(n=!1);var i,r,o,s,a,l=function(){var u=+new Date-s;u<e?i=setTimeout(l,e-u):(i=null,n||(a=t.apply(o,r),o=r=null))};return function(){o=this,r=arguments,s=+new Date;var u=n&&!i;return i||(i=setTimeout(l,e)),u&&(a=t.apply(o,r),o=r=null),a}}Object.defineProperty(e,"__esModule",{value:!0});var pt=n(0),ht=n(3);e.compensateScroll=i,e.uncompensateScroll=r,e.disableCursor=o,e.enableCursor=s,e.distributeHeight=a,e.undistributeHeight=l,e.matchCellWidths=u,e.subtractInnerElHeight=d,e.getScrollParent=c,e.getOuterRect=p,e.getClientRect=h,e.getContentRect=f,e.getScrollbarWidths=g;var ft=null;e.isPrimaryMouseButton=w,e.getEvX=D,e.getEvY=E,e.getEvIsTouch=S,e.preventSelection=C,e.allowSelection=R,e.preventDefault=T,e.intersectRects=M,e.constrainPoint=I,e.getRectCenter=H,e.diffPoints=P,e.parseFieldSpecs=_,e.compareByFieldSpecs=x,e.compareByFieldSpec=O,e.flexibleCompare=F,e.dayIDs=["sun","mon","tue","wed","thu","fri","sat"],e.unitsDesc=["year","month","week","day","hour","minute","second","millisecond"],e.diffDayTime=z,e.diffDay=B,e.diffByUnit=A,e.computeGreatestUnit=k,e.computeDurationGreatestUnit=L,e.divideRangeByDuration=G,e.divideDurationByDuration=N,e.multiplyDuration=j,e.durationHasTime=U,e.isNativeDate=W,e.isTimeString=q,e.log=Y,e.warn=Z;var gt={}.hasOwnProperty;e.mergeProps=Q,e.copyOwnProps=X,e.hasOwnProp=$,e.applyAll=K,e.removeMatching=J,e.removeExact=tt,e.isArraysEqual=et,e.firstDefined=nt,e.htmlEscape=it,e.stripHtmlEntities=rt,e.cssToStr=ot,e.attrsToStr=st,e.capitaliseFirstLetter=at,e.compareNumbers=lt,e.isInt=ut,e.proxy=dt,e.debounce=ct},function(t,e,n){function i(t,e){return t.startMs-e.startMs}Object.defineProperty(e,"__esModule",{value:!0});var r=n(0),o=n(10),s=function(){function t(t,e){this.isStart=!0,this.isEnd=!0,r.isMoment(t)&&(t=t.clone().stripZone()),r.isMoment(e)&&(e=e.clone().stripZone()),t&&(this.startMs=t.valueOf()),e&&(this.endMs=e.valueOf())}return t.invertRanges=function(e,n){var r,o,s=[],a=n.startMs;for(e.sort(i),r=0;r<e.length;r++)o=e[r],o.startMs>a&&s.push(new t(a,o.startMs)),o.endMs>a&&(a=o.endMs);return a<n.endMs&&s.push(new t(a,n.endMs)),s},t.prototype.intersect=function(e){var n=this.startMs,i=this.endMs,r=null;return null!=e.startMs&&(n=null==n?e.startMs:Math.max(n,e.startMs)),null!=e.endMs&&(i=null==i?e.endMs:Math.min(i,e.endMs)),(null==n||null==i||n<i)&&(r=new t(n,i),r.isStart=this.isStart&&n===this.startMs,r.isEnd=this.isEnd&&i===this.endMs),r},t.prototype.intersectsWith=function(t){return(null==this.endMs||null==t.startMs||this.endMs>t.startMs)&&(null==this.startMs||null==t.endMs||this.startMs<t.endMs)},t.prototype.containsRange=function(t){return(null==this.startMs||null!=t.startMs&&t.startMs>=this.startMs)&&(null==this.endMs||null!=t.endMs&&t.endMs<=this.endMs)},t.prototype.containsDate=function(t){var e=t.valueOf();return(null==this.startMs||e>=this.startMs)&&(null==this.endMs||e<this.endMs)},t.prototype.constrainDate=function(t){var e=t.valueOf();return null!=this.startMs&&e<this.startMs&&(e=this.startMs),null!=this.endMs&&e>=this.endMs&&(e=this.endMs-1),e},t.prototype.equals=function(t){return this.startMs===t.startMs&&this.endMs===t.endMs},t.prototype.clone=function(){var e=new t(this.startMs,this.endMs);return e.isStart=this.isStart,e.isEnd=this.isEnd,e},t.prototype.getStart=function(){return null!=this.startMs?o.default.utc(this.startMs).stripZone():null},t.prototype.getEnd=function(){return null!=this.endMs?o.default.utc(this.endMs).stripZone():null},t.prototype.as=function(t){return r.utc(this.endMs).diff(r.utc(this.startMs),t,!0)},t}();e.default=s},function(t,e,n){Object.defineProperty(e,"__esModule",{value:!0});var i=n(2),r=n(3),o=n(208),s=n(33),a=n(49),l=function(t){function e(n){var i=t.call(this)||this;return i.calendar=n,i.className=[],i.uid=String(e.uuid++),i}return i.__extends(e,t),e.parse=function(t,e){var n=new this(e);return!("object"!=typeof t||!n.applyProps(t))&&n},e.normalizeId=function(t){return t?String(t):null},e.prototype.fetch=function(t,e,n){},e.prototype.removeEventDefsById=function(t){},e.prototype.removeAllEventDefs=function(){},e.prototype.getPrimitive=function(t){},e.prototype.parseEventDefs=function(t){var e,n,i=[];for(e=0;e<t.length;e++)(n=this.parseEventDef(t[e]))&&i.push(n);return i},e.prototype.parseEventDef=function(t){var e=this.calendar.opt("eventDataTransform"),n=this.eventDataTransform;return e&&(t=e(t,this.calendar)),n&&(t=n(t,this.calendar)),a.default.parse(t,this)},e.prototype.applyManualStandardProps=function(t){return null!=t.id&&(this.id=e.normalizeId(t.id)),r.isArray(t.className)?this.className=t.className:"string"==typeof t.className&&(this.className=t.className.split(/\s+/)),!0},e.uuid=0,e.defineStandardProps=o.default.defineStandardProps,e.copyVerbatimStandardProps=o.default.copyVerbatimStandardProps,e}(s.default);e.default=l,o.default.mixInto(l),l.defineStandardProps({id:!1,className:!1,color:!0,backgroundColor:!0,borderColor:!0,textColor:!0,editable:!0,startEditable:!0,durationEditable:!0,rendering:!0,overlap:!0,constraint:!0,allDayDefault:!0,eventDataTransform:!0})},function(t,e,n){Object.defineProperty(e,"__esModule",{value:!0});var i=n(2),r=n(3),o=n(14),s=0,a=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return i.__extends(e,t),e.prototype.listenTo=function(t,e,n){if("object"==typeof e)for(var i in e)e.hasOwnProperty(i)&&this.listenTo(t,i,e[i]);else"string"==typeof e&&t.on(e+"."+this.getListenerNamespace(),r.proxy(n,this))},e.prototype.stopListeningTo=function(t,e){t.off((e||"")+"."+this.getListenerNamespace())},e.prototype.getListenerNamespace=function(){return null==this.listenerId&&(this.listenerId=s++),"_listener"+this.listenerId},e}(o.default);e.default=a},,,function(t,e,n){function i(t,e){return c.format.call(t,e)}function r(t,e,n){void 0===e&&(e=!1),void 0===n&&(n=!1);var i,r,d,c,p=t[0],h=1===t.length&&"string"==typeof p;return o.isMoment(p)||a.isNativeDate(p)||void 0===p?c=o.apply(null,t):(i=!1,r=!1,h?l.test(p)?(p+="-01",t=[p],i=!0,r=!0):(d=u.exec(p))&&(i=!d[5],r=!0):s.isArray(p)&&(r=!0),c=e||i?o.utc.apply(o,t):o.apply(null,t),i?(c._ambigTime=!0,c._ambigZone=!0):n&&(r?c._ambigZone=!0:h&&c.utcOffset(p))),c._fullCalendar=!0,c}Object.defineProperty(e,"__esModule",{value:!0});var o=n(0),s=n(3),a=n(4),l=/^\s*\d{4}-\d\d$/,u=/^\s*\d{4}-(?:(\d\d-\d\d)|(W\d\d$)|(W\d\d-\d)|(\d\d\d))((T| )(\d\d(:\d\d(:\d\d(\.\d+)?)?)?)?)?$/,d=o.fn;e.newMomentProto=d;var c=s.extend({},d);e.oldMomentProto=c;var p=o.momentProperties;p.push("_fullCalendar"),p.push("_ambigTime"),p.push("_ambigZone"),e.oldMomentFormat=i;var h=function(){return r(arguments)};e.default=h,h.utc=function(){var t=r(arguments,!0);return t.hasTime()&&t.utc(),t},h.parseZone=function(){return r(arguments,!0,!0)},d.week=d.weeks=function(t){var e=this._locale._fullCalendar_weekCalc;return null==t&&"function"==typeof e?e(this):"ISO"===e?c.isoWeek.apply(this,arguments):c.week.apply(this,arguments)},d.time=function(t){if(!this._fullCalendar)return c.time.apply(this,arguments);if(null==t)return o.duration({hours:this.hours(),minutes:this.minutes(),seconds:this.seconds(),milliseconds:this.milliseconds()});this._ambigTime=!1,o.isDuration(t)||o.isMoment(t)||(t=o.duration(t));var e=0;return o.isDuration(t)&&(e=24*Math.floor(t.asDays())),this.hours(e+t.hours()).minutes(t.minutes()).seconds(t.seconds()).milliseconds(t.milliseconds())},d.stripTime=function(){return this._ambigTime||(this.utc(!0),this.set({hours:0,minutes:0,seconds:0,ms:0}),this._ambigTime=!0,this._ambigZone=!0),this},d.hasTime=function(){return!this._ambigTime},d.stripZone=function(){var t;return this._ambigZone||(t=this._ambigTime,this.utc(!0),this._ambigTime=t||!1,this._ambigZone=!0),this},d.hasZone=function(){return!this._ambigZone},d.local=function(t){return c.local.call(this,this._ambigZone||t),this._ambigTime=!1,this._ambigZone=!1,this},d.utc=function(t){return c.utc.call(this,t),this._ambigTime=!1,this._ambigZone=!1,this},d.utcOffset=function(t){return null!=t&&(this._ambigTime=!1,this._ambigZone=!1),c.utcOffset.apply(this,arguments)}},function(t,e,n){Object.defineProperty(e,"__esModule",{value:!0});var i=n(2),r=n(3),o=n(14),s=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return i.__extends(e,t),e.prototype.on=function(t,e){return r(this).on(t,this._prepareIntercept(e)),this},e.prototype.one=function(t,e){return r(this).one(t,this._prepareIntercept(e)),this},e.prototype._prepareIntercept=function(t){var e=function(e,n){return t.apply(n.context||this,n.args||[])};return t.guid||(t.guid=r.guid++),e.guid=t.guid,e},e.prototype.off=function(t,e){return r(this).off(t,e),this},e.prototype.trigger=function(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];return r(this).triggerHandler(t,{args:e}),this},e.prototype.triggerWith=function(t,e,n){return r(this).triggerHandler(t,{context:e,args:n}),this},e.prototype.hasHandlers=function(t){var e=r._data(this,"events");return e&&e[t]&&e[t].length>0},e}(o.default);e.default=s},function(t,e){Object.defineProperty(e,"__esModule",{value:!0});var n=function(){function t(t,e){this.isAllDay=!1,this.unzonedRange=t,this.isAllDay=e}return t.prototype.toLegacy=function(t){return{start:t.msToMoment(this.unzonedRange.startMs,this.isAllDay),end:t.msToMoment(this.unzonedRange.endMs,this.isAllDay)}},t}();e.default=n},function(t,e,n){Object.defineProperty(e,"__esModule",{value:!0});var i=n(2),r=n(34),o=n(209),s=n(17),a=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return i.__extends(e,t),e.prototype.buildInstances=function(){return[this.buildInstance()]},e.prototype.buildInstance=function(){return new o.default(this,this.dateProfile)},e.prototype.isAllDay=function(){return this.dateProfile.isAllDay()},e.prototype.clone=function(){var e=t.prototype.clone.call(this);return e.dateProfile=this.dateProfile,e},e.prototype.rezone=function(){var t=this.source.calendar,e=this.dateProfile;this.dateProfile=new s.default(t.moment(e.start),e.end?t.moment(e.end):null,t)},e.prototype.applyManualStandardProps=function(e){var n=t.prototype.applyManualStandardProps.call(this,e),i=s.default.parse(e,this.source);return!!i&&(this.dateProfile=i,null!=e.date&&(this.miscProps.date=e.date),n)},e}(r.default);e.default=a,a.defineStandardProps({start:!1,date:!1,end:!1,allDay:!1})},function(t,e){Object.defineProperty(e,"__esModule",{value:!0});var n=function(){function t(){}return t.mixInto=function(t){var e=this;Object.getOwnPropertyNames(this.prototype).forEach(function(n){t.prototype[n]||(t.prototype[n]=e.prototype[n])})},t.mixOver=function(t){var e=this;Object.getOwnPropertyNames(this.prototype).forEach(function(n){t.prototype[n]=e.prototype[n]})},t}();e.default=n},function(t,e){Object.defineProperty(e,"__esModule",{value:!0});var n=function(){function t(t){this.view=t._getView(),this.component=t}return t.prototype.opt=function(t){return this.view.opt(t)},t.prototype.end=function(){},t}();e.default=n},function(t,e,n){Object.defineProperty(e,"__esModule",{value:!0}),e.version="3.9.0",e.internalApiVersion=12;var i=n(4);e.applyAll=i.applyAll,e.debounce=i.debounce,e.isInt=i.isInt,e.htmlEscape=i.htmlEscape,e.cssToStr=i.cssToStr,e.proxy=i.proxy,e.capitaliseFirstLetter=i.capitaliseFirstLetter,e.getOuterRect=i.getOuterRect,e.getClientRect=i.getClientRect,e.getContentRect=i.getContentRect,e.getScrollbarWidths=i.getScrollbarWidths,e.preventDefault=i.preventDefault,e.parseFieldSpecs=i.parseFieldSpecs,e.compareByFieldSpecs=i.compareByFieldSpecs,e.compareByFieldSpec=i.compareByFieldSpec,e.flexibleCompare=i.flexibleCompare,e.computeGreatestUnit=i.computeGreatestUnit,e.divideRangeByDuration=i.divideRangeByDuration,e.divideDurationByDuration=i.divideDurationByDuration,e.multiplyDuration=i.multiplyDuration,e.durationHasTime=i.durationHasTime,e.log=i.log,e.warn=i.warn,e.removeExact=i.removeExact,e.intersectRects=i.intersectRects;var r=n(47);e.formatDate=r.formatDate,e.formatRange=r.formatRange,e.queryMostGranularFormatUnit=r.queryMostGranularFormatUnit;var o=n(31);e.datepickerLocale=o.datepickerLocale,e.locale=o.locale;var s=n(10);e.moment=s.default;var a=n(11);e.EmitterMixin=a.default;var l=n(7);e.ListenerMixin=l.default;var u=n(48);e.Model=u.default;var d=n(207);e.Constraints=d.default;var c=n(5);e.UnzonedRange=c.default;var p=n(12);e.ComponentFootprint=p.default;var h=n(212);e.BusinessHourGenerator=h.default;var f=n(34);e.EventDef=f.default;var g=n(37);e.EventDefMutation=g.default;var v=n(38);e.EventSourceParser=v.default;var y=n(6);e.EventSource=y.default;var m=n(51);e.defineThemeSystem=m.defineThemeSystem;var b=n(18);e.EventInstanceGroup=b.default;var w=n(52);e.ArrayEventSource=w.default;var D=n(215);e.FuncEventSource=D.default;var E=n(216);e.JsonFeedEventSource=E.default;var S=n(36);e.EventFootprint=S.default;var C=n(33);e.Class=C.default;var R=n(14);e.Mixin=R.default;var T=n(53);e.CoordCache=T.default;var M=n(54);e.DragListener=M.default;var I=n(20);e.Promise=I.default;var H=n(217);e.TaskQueue=H.default;var P=n(218);e.RenderQueue=P.default;var _=n(39);e.Scroller=_.default;var x=n(19);e.Theme=x.default;var O=n(219);e.DateComponent=O.default;var F=n(40);e.InteractiveDateComponent=F.default;var z=n(220);e.Calendar=z.default;var B=n(41);e.View=B.default;var A=n(22);e.defineView=A.defineView,e.getViewConfig=A.getViewConfig;var k=n(55);e.DayTableMixin=k.default;var L=n(56);e.BusinessHourRenderer=L.default;var V=n(42);e.EventRenderer=V.default;var G=n(57);e.FillRenderer=G.default;var N=n(58);e.HelperRenderer=N.default;var j=n(222);e.ExternalDropping=j.default;var U=n(223);e.EventResizing=U.default;var W=n(59);e.EventPointing=W.default;var q=n(224);e.EventDragging=q.default;var Y=n(225);e.DateSelecting=Y.default;var Z=n(60);e.StandardInteractionsMixin=Z.default;var Q=n(226);e.AgendaView=Q.default;var X=n(227);e.TimeGrid=X.default;var $=n(61);e.DayGrid=$.default;var K=n(62);e.BasicView=K.default;var J=n(229);e.MonthView=J.default;var tt=n(230);e.ListView=tt.default},function(t,e,n){Object.defineProperty(e,"__esModule",{value:!0});var i=n(5),r=function(){function t(t,e,n){this.start=t,this.end=e||null,this.unzonedRange=this.buildUnzonedRange(n)}return t.parse=function(e,n){var i=e.start||e.date,r=e.end;if(!i)return!1;var o=n.calendar,s=o.moment(i),a=r?o.moment(r):null,l=e.allDay,u=o.opt("forceEventDuration");return!!s.isValid()&&(!a||a.isValid()&&a.isAfter(s)||(a=null),null==l&&null==(l=n.allDayDefault)&&(l=o.opt("allDayDefault")),!0===l?(s.stripTime(),a&&a.stripTime()):!1===l&&(s.hasTime()||s.time(0),a&&!a.hasTime()&&a.time(0)),!a&&u&&(a=o.getDefaultEventEnd(!s.hasTime(),s)),new t(s,a,o))},t.isStandardProp=function(t){return"start"===t||"date"===t||"end"===t||"allDay"===t},t.prototype.isAllDay=function(){return!(this.start.hasTime()||this.end&&this.end.hasTime())},t.prototype.buildUnzonedRange=function(t){var e=this.start.clone().stripZone().valueOf(),n=this.getEnd(t).stripZone().valueOf();return new i.default(e,n)},t.prototype.getEnd=function(t){return this.end?this.end.clone():t.getDefaultEventEnd(this.isAllDay(),this.start)},t}();e.default=r},function(t,e,n){Object.defineProperty(e,"__esModule",{value:!0});var i=n(5),r=n(35),o=n(211),s=function(){function t(t){this.eventInstances=t||[]}return t.prototype.getAllEventRanges=function(t){return t?this.sliceNormalRenderRanges(t):this.eventInstances.map(r.eventInstanceToEventRange)},t.prototype.sliceRenderRanges=function(t){return this.isInverse()?this.sliceInverseRenderRanges(t):this.sliceNormalRenderRanges(t)},t.prototype.sliceNormalRenderRanges=function(t){var e,n,i,r=this.eventInstances,s=[];for(e=0;e<r.length;e++)n=r[e],(i=n.dateProfile.unzonedRange.intersect(t))&&s.push(new o.default(i,n.def,n));return s},t.prototype.sliceInverseRenderRanges=function(t){var e=this.eventInstances.map(r.eventInstanceToUnzonedRange),n=this.getEventDef();return e=i.default.invertRanges(e,t),e.map(function(t){return new o.default(t,n)})},t.prototype.isInverse=function(){return this.getEventDef().hasInverseRendering()},t.prototype.getEventDef=function(){return this.explicitEventDef||this.eventInstances[0].def},t}();e.default=s},function(t,e,n){Object.defineProperty(e,"__esModule",{value:!0});var i=n(3),r=function(){function t(t){this.optionsManager=t,this.processIconOverride()}return t.prototype.processIconOverride=function(){this.iconOverrideOption&&this.setIconOverride(this.optionsManager.get(this.iconOverrideOption))},t.prototype.setIconOverride=function(t){var e,n;if(i.isPlainObject(t)){e=i.extend({},this.iconClasses);for(n in t)e[n]=this.applyIconOverridePrefix(t[n]);this.iconClasses=e}else!1===t&&(this.iconClasses={})},t.prototype.applyIconOverridePrefix=function(t){var e=this.iconOverridePrefix;return e&&0!==t.indexOf(e)&&(t=e+t),t},t.prototype.getClass=function(t){return this.classes[t]||""},t.prototype.getIconClass=function(t){var e=this.iconClasses[t];return e?this.baseIconClass+" "+e:""},t.prototype.getCustomButtonIconClass=function(t){var e;return this.iconOverrideCustomButtonOption&&(e=t[this.iconOverrideCustomButtonOption])?this.baseIconClass+" "+this.applyIconOverridePrefix(e):""},t}();e.default=r,r.prototype.classes={},r.prototype.iconClasses={},r.prototype.baseIconClass="",r.prototype.iconOverridePrefix=""},function(t,e,n){function i(t,e){t.then=function(n){return"function"==typeof n?s.resolve(n(e)):t}}function r(t){t.then=function(e,n){return"function"==typeof n&&n(),t}}Object.defineProperty(e,"__esModule",{value:!0});var o=n(3),s={construct:function(t){var e=o.Deferred(),n=e.promise();return"function"==typeof t&&t(function(t){e.resolve(t),i(n,t)},function(){e.reject(),r(n)}),n},resolve:function(t){var e=o.Deferred().resolve(t),n=e.promise();return i(n,t),n},reject:function(){var t=o.Deferred().reject(),e=t.promise();return r(e),e}};e.default=s},function(t,e,n){Object.defineProperty(e,"__esModule",{value:!0});var i=n(3),r=n(16),o=n(11),s=n(7);r.touchMouseIgnoreWait=500;var a=null,l=0,u=function(){function t(){this.isTouching=!1,this.mouseIgnoreDepth=0}return t.get=function(){return a||(a=new t,a.bind()),a},t.needed=function(){t.get(),l++},t.unneeded=function(){--l||(a.unbind(),a=null)},t.prototype.bind=function(){var t=this;this.listenTo(i(document),{touchstart:this.handleTouchStart,touchcancel:this.handleTouchCancel,touchend:this.handleTouchEnd,mousedown:this.handleMouseDown,mousemove:this.handleMouseMove,mouseup:this.handleMouseUp,click:this.handleClick,selectstart:this.handleSelectStart,contextmenu:this.handleContextMenu}),window.addEventListener("touchmove",this.handleTouchMoveProxy=function(e){t.handleTouchMove(i.Event(e))},{passive:!1}),window.addEventListener("scroll",this.handleScrollProxy=function(e){t.handleScroll(i.Event(e))},!0)},t.prototype.unbind=function(){this.stopListeningTo(i(document)),window.removeEventListener("touchmove",this.handleTouchMoveProxy),window.removeEventListener("scroll",this.handleScrollProxy,!0)},t.prototype.handleTouchStart=function(t){this.stopTouch(t,!0),this.isTouching=!0,this.trigger("touchstart",t)},t.prototype.handleTouchMove=function(t){this.isTouching&&this.trigger("touchmove",t)},t.prototype.handleTouchCancel=function(t){this.isTouching&&(this.trigger("touchcancel",t),this.stopTouch(t))},t.prototype.handleTouchEnd=function(t){this.stopTouch(t)},t.prototype.handleMouseDown=function(t){this.shouldIgnoreMouse()||this.trigger("mousedown",t)},t.prototype.handleMouseMove=function(t){this.shouldIgnoreMouse()||this.trigger("mousemove",t)},t.prototype.handleMouseUp=function(t){this.shouldIgnoreMouse()||this.trigger("mouseup",t)},t.prototype.handleClick=function(t){this.shouldIgnoreMouse()||this.trigger("click",t)},t.prototype.handleSelectStart=function(t){this.trigger("selectstart",t)},t.prototype.handleContextMenu=function(t){this.trigger("contextmenu",t)},t.prototype.handleScroll=function(t){this.trigger("scroll",t)},t.prototype.stopTouch=function(t,e){void 0===e&&(e=!1),this.isTouching&&(this.isTouching=!1,this.trigger("touchend",t),e||this.startTouchMouseIgnore())},t.prototype.startTouchMouseIgnore=function(){var t=this,e=r.touchMouseIgnoreWait;e&&(this.mouseIgnoreDepth++,setTimeout(function(){t.mouseIgnoreDepth--},e))},t.prototype.shouldIgnoreMouse=function(){return this.isTouching||Boolean(this.mouseIgnoreDepth)},t}();e.default=u,s.default.mixInto(u),o.default.mixInto(u)},function(t,e,n){function i(t,n){e.viewHash[t]=n}function r(t){return e.viewHash[t]}Object.defineProperty(e,"__esModule",{value:!0});var o=n(16);e.viewHash={},o.views=e.viewHash,e.defineView=i,e.getViewConfig=r},function(t,e,n){function i(t,e){return!t&&!e||!(!t||!e)&&(t.component===e.component&&r(t,e)&&r(e,t))}function r(t,e){for(var n in t)if(!/^(component|left|right|top|bottom)$/.test(n)&&t[n]!==e[n])return!1;return!0}Object.defineProperty(e,"__esModule",{value:!0});var o=n(2),s=n(4),a=n(54),l=function(t){function e(e,n){var i=t.call(this,n)||this;return i.component=e,i}return o.__extends(e,t),e.prototype.handleInteractionStart=function(e){var n,i,r,o=this.subjectEl;this.component.hitsNeeded(),this.computeScrollBounds(),e?(i={left:s.getEvX(e),top:s.getEvY(e)},r=i,o&&(n=s.getOuterRect(o),r=s.constrainPoint(r,n)),this.origHit=this.queryHit(r.left,r.top),o&&this.options.subjectCenter&&(this.origHit&&(n=s.intersectRects(this.origHit,n)||n),r=s.getRectCenter(n)),this.coordAdjust=s.diffPoints(r,i)):(this.origHit=null,this.coordAdjust=null),t.prototype.handleInteractionStart.call(this,e)},e.prototype.handleDragStart=function(e){var n;t.prototype.handleDragStart.call(this,e),(n=this.queryHit(s.getEvX(e),s.getEvY(e)))&&this.handleHitOver(n)},e.prototype.handleDrag=function(e,n,r){var o;t.prototype.handleDrag.call(this,e,n,r),o=this.queryHit(s.getEvX(r),s.getEvY(r)),i(o,this.hit)||(this.hit&&this.handleHitOut(),o&&this.handleHitOver(o))},e.prototype.handleDragEnd=function(e){this.handleHitDone(),t.prototype.handleDragEnd.call(this,e)},e.prototype.handleHitOver=function(t){var e=i(t,this.origHit);this.hit=t,this.trigger("hitOver",this.hit,e,this.origHit)},e.prototype.handleHitOut=function(){this.hit&&(this.trigger("hitOut",this.hit),this.handleHitDone(),this.hit=null)},e.prototype.handleHitDone=function(){this.hit&&this.trigger("hitDone",this.hit)},e.prototype.handleInteractionEnd=function(e,n){t.prototype.handleInteractionEnd.call(this,e,n),this.origHit=null,this.hit=null,this.component.hitsNotNeeded()},e.prototype.handleScrollEnd=function(){t.prototype.handleScrollEnd.call(this),this.isDragging&&(this.component.releaseHits(),this.component.prepareHits())},e.prototype.queryHit=function(t,e){return this.coordAdjust&&(t+=this.coordAdjust.left,e+=this.coordAdjust.top),this.component.queryHit(t,e)},e}(a.default);e.default=l},,,,,,,,function(t,e,n){function i(t){a.each(f,function(e,n){null==t[e]&&(t[e]=n(t))})}function r(t,n,i){var r=e.localeOptionHash[t]||(e.localeOptionHash[t]={});r.isRTL=i.isRTL,r.weekNumberTitle=i.weekHeader,a.each(p,function(t,e){r[t]=e(i)});var o=a.datepicker;o&&(o.regional[n]=o.regional[t]=i,o.regional.en=o.regional[""],o.setDefaults(i))}function o(t,n){var i,r;i=e.localeOptionHash[t]||(e.localeOptionHash[t]={}),n&&(i=e.localeOptionHash[t]=d.mergeOptions([i,n])),r=s(t),a.each(h,function(t,e){null==i[t]&&(i[t]=e(r,i))}),d.globalDefaults.locale=t}function s(t){return l.localeData(t)||l.localeData("en")}Object.defineProperty(e,"__esModule",{value:!0});var a=n(3),l=n(0),u=n(16),d=n(32),c=n(4);e.localeOptionHash={},u.locales=e.localeOptionHash;var p={buttonText:function(t){return{prev:c.stripHtmlEntities(t.prevText),next:c.stripHtmlEntities(t.nextText),today:c.stripHtmlEntities(t.currentText)}},monthYearFormat:function(t){return t.showMonthAfterYear?"YYYY["+t.yearSuffix+"] MMMM":"MMMM YYYY["+t.yearSuffix+"]"}},h={dayOfMonthFormat:function(t,e){var n=t.longDateFormat("l");return n=n.replace(/^Y+[^\w\s]*|[^\w\s]*Y+$/g,""),e.isRTL?n+=" ddd":n="ddd "+n,n},
mediumTimeFormat:function(t){return t.longDateFormat("LT").replace(/\s*a$/i,"a")},smallTimeFormat:function(t){return t.longDateFormat("LT").replace(":mm","(:mm)").replace(/(\Wmm)$/,"($1)").replace(/\s*a$/i,"a")},extraSmallTimeFormat:function(t){return t.longDateFormat("LT").replace(":mm","(:mm)").replace(/(\Wmm)$/,"($1)").replace(/\s*a$/i,"t")},hourFormat:function(t){return t.longDateFormat("LT").replace(":mm","").replace(/(\Wmm)$/,"").replace(/\s*a$/i,"a")},noMeridiemTimeFormat:function(t){return t.longDateFormat("LT").replace(/\s*a$/i,"")}},f={smallDayDateFormat:function(t){return t.isRTL?"D dd":"dd D"},weekFormat:function(t){return t.isRTL?"w[ "+t.weekNumberTitle+"]":"["+t.weekNumberTitle+" ]w"},smallWeekFormat:function(t){return t.isRTL?"w["+t.weekNumberTitle+"]":"["+t.weekNumberTitle+"]w"}};e.populateInstanceComputableOptions=i,e.datepickerLocale=r,e.locale=o,e.getMomentLocaleData=s,o("en",d.englishDefaults)},function(t,e,n){function i(t){return r.mergeProps(t,o)}Object.defineProperty(e,"__esModule",{value:!0});var r=n(4);e.globalDefaults={titleRangeSeparator:" – ",monthYearFormat:"MMMM YYYY",defaultTimedEventDuration:"02:00:00",defaultAllDayEventDuration:{days:1},forceEventDuration:!1,nextDayThreshold:"09:00:00",columnHeader:!0,defaultView:"month",aspectRatio:1.35,header:{left:"title",center:"",right:"today prev,next"},weekends:!0,weekNumbers:!1,weekNumberTitle:"W",weekNumberCalculation:"local",scrollTime:"06:00:00",minTime:"00:00:00",maxTime:"24:00:00",showNonCurrentDates:!0,lazyFetching:!0,startParam:"start",endParam:"end",timezoneParam:"timezone",timezone:!1,locale:null,isRTL:!1,buttonText:{prev:"prev",next:"next",prevYear:"prev year",nextYear:"next year",year:"year",today:"today",month:"month",week:"week",day:"day"},allDayText:"all-day",agendaEventMinHeight:0,theme:!1,dragOpacity:.75,dragRevertDuration:500,dragScroll:!0,unselectAuto:!0,dropAccept:"*",eventOrder:"title",eventLimit:!1,eventLimitText:"more",eventLimitClick:"popover",dayPopoverFormat:"LL",handleWindowResize:!0,windowResizeDelay:100,longPressDelay:1e3},e.englishDefaults={dayPopoverFormat:"dddd, MMMM D"},e.rtlDefaults={header:{left:"next,prev today",center:"",right:"title"},buttonIcons:{prev:"right-single-arrow",next:"left-single-arrow",prevYear:"right-double-arrow",nextYear:"left-double-arrow"},themeButtonIcons:{prev:"circle-triangle-e",next:"circle-triangle-w",nextYear:"seek-prev",prevYear:"seek-next"}};var o=["header","footer","buttonText","buttonIcons","themeButtonIcons"];e.mergeOptions=i},function(t,e,n){Object.defineProperty(e,"__esModule",{value:!0});var i=n(2),r=n(4),o=function(){function t(){}return t.extend=function(t){var e=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return i.__extends(e,t),e}(this);return r.copyOwnProps(t,e.prototype),e},t.mixin=function(t){r.copyOwnProps(t,this.prototype)},t}();e.default=o},function(t,e,n){Object.defineProperty(e,"__esModule",{value:!0});var i=n(3),r=n(208),o=function(){function t(t){this.source=t,this.className=[],this.miscProps={}}return t.parse=function(t,e){var n=new this(e);return!!n.applyProps(t)&&n},t.normalizeId=function(t){return String(t)},t.generateId=function(){return"_fc"+t.uuid++},t.prototype.clone=function(){var e=new this.constructor(this.source);return e.id=this.id,e.rawId=this.rawId,e.uid=this.uid,t.copyVerbatimStandardProps(this,e),e.className=this.className.slice(),e.miscProps=i.extend({},this.miscProps),e},t.prototype.hasInverseRendering=function(){return"inverse-background"===this.getRendering()},t.prototype.hasBgRendering=function(){var t=this.getRendering();return"inverse-background"===t||"background"===t},t.prototype.getRendering=function(){return null!=this.rendering?this.rendering:this.source.rendering},t.prototype.getConstraint=function(){return null!=this.constraint?this.constraint:null!=this.source.constraint?this.source.constraint:this.source.calendar.opt("eventConstraint")},t.prototype.getOverlap=function(){return null!=this.overlap?this.overlap:null!=this.source.overlap?this.source.overlap:this.source.calendar.opt("eventOverlap")},t.prototype.isStartExplicitlyEditable=function(){return null!=this.startEditable?this.startEditable:this.source.startEditable},t.prototype.isDurationExplicitlyEditable=function(){return null!=this.durationEditable?this.durationEditable:this.source.durationEditable},t.prototype.isExplicitlyEditable=function(){return null!=this.editable?this.editable:this.source.editable},t.prototype.toLegacy=function(){var e=i.extend({},this.miscProps);return e._id=this.uid,e.source=this.source,e.className=this.className.slice(),e.allDay=this.isAllDay(),null!=this.rawId&&(e.id=this.rawId),t.copyVerbatimStandardProps(this,e),e},t.prototype.applyManualStandardProps=function(e){return null!=e.id?this.id=t.normalizeId(this.rawId=e.id):this.id=t.generateId(),null!=e._id?this.uid=String(e._id):this.uid=t.generateId(),i.isArray(e.className)&&(this.className=e.className),"string"==typeof e.className&&(this.className=e.className.split(/\s+/)),!0},t.prototype.applyMiscProps=function(t){i.extend(this.miscProps,t)},t.uuid=0,t.defineStandardProps=r.default.defineStandardProps,t.copyVerbatimStandardProps=r.default.copyVerbatimStandardProps,t}();e.default=o,r.default.mixInto(o),o.defineStandardProps({_id:!1,id:!1,className:!1,source:!1,title:!0,url:!0,rendering:!0,constraint:!0,overlap:!0,editable:!0,startEditable:!0,durationEditable:!0,color:!0,backgroundColor:!0,borderColor:!0,textColor:!0})},function(t,e,n){function i(t,e){var n,i=[];for(n=0;n<t.length;n++)i.push.apply(i,t[n].buildInstances(e));return i}function r(t){return new l.default(t.dateProfile.unzonedRange,t.def,t)}function o(t){return new u.default(new d.default(t.unzonedRange,t.eventDef.isAllDay()),t.eventDef,t.eventInstance)}function s(t){return t.dateProfile.unzonedRange}function a(t){return t.componentFootprint}Object.defineProperty(e,"__esModule",{value:!0});var l=n(211),u=n(36),d=n(12);e.eventDefsToEventInstances=i,e.eventInstanceToEventRange=r,e.eventRangeToEventFootprint=o,e.eventInstanceToUnzonedRange=s,e.eventFootprintToComponentFootprint=a},function(t,e){Object.defineProperty(e,"__esModule",{value:!0});var n=function(){function t(t,e,n){this.componentFootprint=t,this.eventDef=e,n&&(this.eventInstance=n)}return t.prototype.getEventLegacy=function(){return(this.eventInstance||this.eventDef).toLegacy()},t}();e.default=n},function(t,e,n){Object.defineProperty(e,"__esModule",{value:!0});var i=n(4),r=n(17),o=n(34),s=n(50),a=n(13),l=function(){function t(){}return t.createFromRawProps=function(e,n,a){var l,u,d,c,p=e.def,h={},f={},g={},v={},y=null,m=null;for(l in n)r.default.isStandardProp(l)?h[l]=n[l]:p.isStandardProp(l)?f[l]=n[l]:p.miscProps[l]!==n[l]&&(g[l]=n[l]);return u=r.default.parse(h,p.source),u&&(d=s.default.createFromDiff(e.dateProfile,u,a)),f.id!==p.id&&(y=f.id),i.isArraysEqual(f.className,p.className)||(m=f.className),o.default.copyVerbatimStandardProps(f,v),c=new t,c.eventDefId=y,c.className=m,c.verbatimStandardProps=v,c.miscProps=g,d&&(c.dateMutation=d),c},t.prototype.mutateSingle=function(t){var e;return this.dateMutation&&(e=t.dateProfile,t.dateProfile=this.dateMutation.buildNewDateProfile(e,t.source.calendar)),null!=this.eventDefId&&(t.id=o.default.normalizeId(t.rawId=this.eventDefId)),this.className&&(t.className=this.className),this.verbatimStandardProps&&a.default.copyVerbatimStandardProps(this.verbatimStandardProps,t),this.miscProps&&t.applyMiscProps(this.miscProps),e?function(){t.dateProfile=e}:function(){}},t.prototype.setDateMutation=function(t){t&&!t.isEmpty()?this.dateMutation=t:this.dateMutation=null},t.prototype.isEmpty=function(){return!this.dateMutation},t}();e.default=l},function(t,e){Object.defineProperty(e,"__esModule",{value:!0}),e.default={sourceClasses:[],registerClass:function(t){this.sourceClasses.unshift(t)},parse:function(t,e){var n,i,r=this.sourceClasses;for(n=0;n<r.length;n++)if(i=r[n].parse(t,e))return i}}},function(t,e,n){Object.defineProperty(e,"__esModule",{value:!0});var i=n(2),r=n(3),o=n(4),s=n(33),a=function(t){function e(e){var n=t.call(this)||this;return e=e||{},n.overflowX=e.overflowX||e.overflow||"auto",n.overflowY=e.overflowY||e.overflow||"auto",n}return i.__extends(e,t),e.prototype.render=function(){this.el=this.renderEl(),this.applyOverflow()},e.prototype.renderEl=function(){return this.scrollEl=r('<div class="fc-scroller"></div>')},e.prototype.clear=function(){this.setHeight("auto"),this.applyOverflow()},e.prototype.destroy=function(){this.el.remove()},e.prototype.applyOverflow=function(){this.scrollEl.css({"overflow-x":this.overflowX,"overflow-y":this.overflowY})},e.prototype.lockOverflow=function(t){var e=this.overflowX,n=this.overflowY;t=t||this.getScrollbarWidths(),"auto"===e&&(e=t.top||t.bottom||this.scrollEl[0].scrollWidth-1>this.scrollEl[0].clientWidth?"scroll":"hidden"),"auto"===n&&(n=t.left||t.right||this.scrollEl[0].scrollHeight-1>this.scrollEl[0].clientHeight?"scroll":"hidden"),this.scrollEl.css({"overflow-x":e,"overflow-y":n})},e.prototype.setHeight=function(t){this.scrollEl.height(t)},e.prototype.getScrollTop=function(){return this.scrollEl.scrollTop()},e.prototype.setScrollTop=function(t){this.scrollEl.scrollTop(t)},e.prototype.getClientWidth=function(){return this.scrollEl[0].clientWidth},e.prototype.getClientHeight=function(){return this.scrollEl[0].clientHeight},e.prototype.getScrollbarWidths=function(){return o.getScrollbarWidths(this.scrollEl)},e}(s.default);e.default=a},function(t,e,n){Object.defineProperty(e,"__esModule",{value:!0});var i=n(2),r=n(3),o=n(4),s=n(219),a=n(21),l=function(t){function e(e,n){var i=t.call(this,e,n)||this;return i.segSelector=".fc-event-container > *",i.dateSelectingClass&&(i.dateClicking=new i.dateClickingClass(i)),i.dateSelectingClass&&(i.dateSelecting=new i.dateSelectingClass(i)),i.eventPointingClass&&(i.eventPointing=new i.eventPointingClass(i)),i.eventDraggingClass&&i.eventPointing&&(i.eventDragging=new i.eventDraggingClass(i,i.eventPointing)),i.eventResizingClass&&i.eventPointing&&(i.eventResizing=new i.eventResizingClass(i,i.eventPointing)),i.externalDroppingClass&&(i.externalDropping=new i.externalDroppingClass(i)),i}return i.__extends(e,t),e.prototype.setElement=function(e){t.prototype.setElement.call(this,e),this.dateClicking&&this.dateClicking.bindToEl(e),this.dateSelecting&&this.dateSelecting.bindToEl(e),this.bindAllSegHandlersToEl(e)},e.prototype.removeElement=function(){this.endInteractions(),t.prototype.removeElement.call(this)},e.prototype.executeEventUnrender=function(){this.endInteractions(),t.prototype.executeEventUnrender.call(this)},e.prototype.bindGlobalHandlers=function(){t.prototype.bindGlobalHandlers.call(this),this.externalDropping&&this.externalDropping.bindToDocument()},e.prototype.unbindGlobalHandlers=function(){t.prototype.unbindGlobalHandlers.call(this),this.externalDropping&&this.externalDropping.unbindFromDocument()},e.prototype.bindDateHandlerToEl=function(t,e,n){var i=this;this.el.on(e,function(t){if(!r(t.target).is(i.segSelector+":not(.fc-helper),"+i.segSelector+":not(.fc-helper) *,.fc-more,a[data-goto]"))return n.call(i,t)})},e.prototype.bindAllSegHandlersToEl=function(t){[this.eventPointing,this.eventDragging,this.eventResizing].forEach(function(e){e&&e.bindToEl(t)})},e.prototype.bindSegHandlerToEl=function(t,e,n){var i=this;t.on(e,this.segSelector,function(t){var e=r(t.currentTarget);if(!e.is(".fc-helper")){var o=e.data("fc-seg");if(o&&!i.shouldIgnoreEventPointing())return n.call(i,o,t)}})},e.prototype.shouldIgnoreMouse=function(){return a.default.get().shouldIgnoreMouse()},e.prototype.shouldIgnoreTouch=function(){var t=this._getView();return t.isSelected||t.selectedEvent},e.prototype.shouldIgnoreEventPointing=function(){return this.eventDragging&&this.eventDragging.isDragging||this.eventResizing&&this.eventResizing.isResizing},e.prototype.canStartSelection=function(t,e){return o.getEvIsTouch(e)&&!this.canStartResize(t,e)&&(this.isEventDefDraggable(t.footprint.eventDef)||this.isEventDefResizable(t.footprint.eventDef))},e.prototype.canStartDrag=function(t,e){return!this.canStartResize(t,e)&&this.isEventDefDraggable(t.footprint.eventDef)},e.prototype.canStartResize=function(t,e){var n=this._getView(),i=t.footprint.eventDef;return(!o.getEvIsTouch(e)||n.isEventDefSelected(i))&&this.isEventDefResizable(i)&&r(e.target).is(".fc-resizer")},e.prototype.endInteractions=function(){[this.dateClicking,this.dateSelecting,this.eventPointing,this.eventDragging,this.eventResizing].forEach(function(t){t&&t.end()})},e.prototype.isEventDefDraggable=function(t){return this.isEventDefStartEditable(t)},e.prototype.isEventDefStartEditable=function(t){var e=t.isStartExplicitlyEditable();return null==e&&null==(e=this.opt("eventStartEditable"))&&(e=this.isEventDefGenerallyEditable(t)),e},e.prototype.isEventDefGenerallyEditable=function(t){var e=t.isExplicitlyEditable();return null==e&&(e=this.opt("editable")),e},e.prototype.isEventDefResizableFromStart=function(t){return this.opt("eventResizableFromStart")&&this.isEventDefResizable(t)},e.prototype.isEventDefResizableFromEnd=function(t){return this.isEventDefResizable(t)},e.prototype.isEventDefResizable=function(t){var e=t.isDurationExplicitlyEditable();return null==e&&null==(e=this.opt("eventDurationEditable"))&&(e=this.isEventDefGenerallyEditable(t)),e},e.prototype.diffDates=function(t,e){return this.largeUnit?o.diffByUnit(t,e,this.largeUnit):o.diffDayTime(t,e)},e.prototype.isEventInstanceGroupAllowed=function(t){var e,n=this._getView(),i=this.dateProfile,r=this.eventRangesToEventFootprints(t.getAllEventRanges());for(e=0;e<r.length;e++)if(!i.validUnzonedRange.containsRange(r[e].componentFootprint.unzonedRange))return!1;return n.calendar.constraints.isEventInstanceGroupAllowed(t)},e.prototype.isExternalInstanceGroupAllowed=function(t){var e,n=this._getView(),i=this.dateProfile,r=this.eventRangesToEventFootprints(t.getAllEventRanges());for(e=0;e<r.length;e++)if(!i.validUnzonedRange.containsRange(r[e].componentFootprint.unzonedRange))return!1;for(e=0;e<r.length;e++)if(!n.calendar.constraints.isSelectionFootprintAllowed(r[e].componentFootprint))return!1;return!0},e}(s.default);e.default=l},function(t,e,n){Object.defineProperty(e,"__esModule",{value:!0});var i=n(2),r=n(3),o=n(0),s=n(4),a=n(218),l=n(221),u=n(40),d=n(21),c=n(5),p=function(t){function e(e,n){var i=t.call(this,null,n.options)||this;return i.batchRenderDepth=0,i.isSelected=!1,i.calendar=e,i.viewSpec=n,i.type=n.type,i.name=i.type,i.initRenderQueue(),i.initHiddenDays(),i.dateProfileGenerator=new i.dateProfileGeneratorClass(i),i.bindBaseRenderHandlers(),i.eventOrderSpecs=s.parseFieldSpecs(i.opt("eventOrder")),i.initialize&&i.initialize(),i}return i.__extends(e,t),e.prototype._getView=function(){return this},e.prototype.opt=function(t){return this.options[t]},e.prototype.initRenderQueue=function(){this.renderQueue=new a.default({event:this.opt("eventRenderWait")}),this.renderQueue.on("start",this.onRenderQueueStart.bind(this)),this.renderQueue.on("stop",this.onRenderQueueStop.bind(this)),this.on("before:change",this.startBatchRender),this.on("change",this.stopBatchRender)},e.prototype.onRenderQueueStart=function(){this.calendar.freezeContentHeight(),this.addScroll(this.queryScroll())},e.prototype.onRenderQueueStop=function(){this.calendar.updateViewSize()&&this.popScroll(),this.calendar.thawContentHeight()},e.prototype.startBatchRender=function(){this.batchRenderDepth++||this.renderQueue.pause()},e.prototype.stopBatchRender=function(){--this.batchRenderDepth||this.renderQueue.resume()},e.prototype.requestRender=function(t,e,n){this.renderQueue.queue(t,e,n)},e.prototype.whenSizeUpdated=function(t){this.renderQueue.isRunning?this.renderQueue.one("stop",t.bind(this)):t.call(this)},e.prototype.computeTitle=function(t){var e;return e=/^(year|month)$/.test(t.currentRangeUnit)?t.currentUnzonedRange:t.activeUnzonedRange,this.formatRange({start:this.calendar.msToMoment(e.startMs,t.isRangeAllDay),end:this.calendar.msToMoment(e.endMs,t.isRangeAllDay)},t.isRangeAllDay,this.opt("titleFormat")||this.computeTitleFormat(t),this.opt("titleRangeSeparator"))},e.prototype.computeTitleFormat=function(t){var e=t.currentRangeUnit;return"year"===e?"YYYY":"month"===e?this.opt("monthYearFormat"):t.currentUnzonedRange.as("days")>1?"ll":"LL"},e.prototype.setDate=function(t){var e=this.get("dateProfile"),n=this.dateProfileGenerator.build(t,void 0,!0);e&&e.activeUnzonedRange.equals(n.activeUnzonedRange)||this.set("dateProfile",n)},e.prototype.unsetDate=function(){this.unset("dateProfile")},e.prototype.fetchInitialEvents=function(t){var e=this.calendar,n=t.isRangeAllDay&&!this.usesMinMaxTime;return e.requestEvents(e.msToMoment(t.activeUnzonedRange.startMs,n),e.msToMoment(t.activeUnzonedRange.endMs,n))},e.prototype.bindEventChanges=function(){this.listenTo(this.calendar,"eventsReset",this.resetEvents)},e.prototype.unbindEventChanges=function(){this.stopListeningTo(this.calendar,"eventsReset")},e.prototype.setEvents=function(t){this.set("currentEvents",t),this.set("hasEvents",!0)},e.prototype.unsetEvents=function(){this.unset("currentEvents"),this.unset("hasEvents")},e.prototype.resetEvents=function(t){this.startBatchRender(),this.unsetEvents(),this.setEvents(t),this.stopBatchRender()},e.prototype.requestDateRender=function(t){var e=this;this.requestRender(function(){e.executeDateRender(t)},"date","init")},e.prototype.requestDateUnrender=function(){var t=this;this.requestRender(function(){t.executeDateUnrender()},"date","destroy")},e.prototype.executeDateRender=function(e){t.prototype.executeDateRender.call(this,e),this.render&&this.render(),this.trigger("datesRendered"),this.addScroll({isDateInit:!0}),this.startNowIndicator()},e.prototype.executeDateUnrender=function(){this.unselect(),this.stopNowIndicator(),this.trigger("before:datesUnrendered"),this.destroy&&this.destroy(),t.prototype.executeDateUnrender.call(this)},e.prototype.bindBaseRenderHandlers=function(){var t=this;this.on("datesRendered",function(){t.whenSizeUpdated(t.triggerViewRender)}),this.on("before:datesUnrendered",function(){t.triggerViewDestroy()})},e.prototype.triggerViewRender=function(){this.publiclyTrigger("viewRender",{context:this,args:[this,this.el]})},e.prototype.triggerViewDestroy=function(){this.publiclyTrigger("viewDestroy",{context:this,args:[this,this.el]})},e.prototype.requestEventsRender=function(t){var e=this;this.requestRender(function(){e.executeEventRender(t),e.whenSizeUpdated(e.triggerAfterEventsRendered)},"event","init")},e.prototype.requestEventsUnrender=function(){var t=this;this.requestRender(function(){t.triggerBeforeEventsDestroyed(),t.executeEventUnrender()},"event","destroy")},e.prototype.requestBusinessHoursRender=function(t){var e=this;this.requestRender(function(){e.renderBusinessHours(t)},"businessHours","init")},e.prototype.requestBusinessHoursUnrender=function(){var t=this;this.requestRender(function(){t.unrenderBusinessHours()},"businessHours","destroy")},e.prototype.bindGlobalHandlers=function(){t.prototype.bindGlobalHandlers.call(this),this.listenTo(d.default.get(),{touchstart:this.processUnselect,mousedown:this.handleDocumentMousedown})},e.prototype.unbindGlobalHandlers=function(){t.prototype.unbindGlobalHandlers.call(this),this.stopListeningTo(d.default.get())},e.prototype.startNowIndicator=function(){var t,e,n,i=this;this.opt("nowIndicator")&&(t=this.getNowIndicatorUnit())&&(e=s.proxy(this,"updateNowIndicator"),this.initialNowDate=this.calendar.getNow(),this.initialNowQueriedMs=(new Date).valueOf(),n=this.initialNowDate.clone().startOf(t).add(1,t).valueOf()-this.initialNowDate.valueOf(),this.nowIndicatorTimeoutID=setTimeout(function(){i.nowIndicatorTimeoutID=null,e(),n=+o.duration(1,t),n=Math.max(100,n),i.nowIndicatorIntervalID=setInterval(e,n)},n))},e.prototype.updateNowIndicator=function(){this.isDatesRendered&&this.initialNowDate&&(this.unrenderNowIndicator(),this.renderNowIndicator(this.initialNowDate.clone().add((new Date).valueOf()-this.initialNowQueriedMs)),this.isNowIndicatorRendered=!0)},e.prototype.stopNowIndicator=function(){this.isNowIndicatorRendered&&(this.nowIndicatorTimeoutID&&(clearTimeout(this.nowIndicatorTimeoutID),this.nowIndicatorTimeoutID=null),this.nowIndicatorIntervalID&&(clearInterval(this.nowIndicatorIntervalID),this.nowIndicatorIntervalID=null),this.unrenderNowIndicator(),this.isNowIndicatorRendered=!1)},e.prototype.updateSize=function(e,n,i){this.setHeight?this.setHeight(e,n):t.prototype.updateSize.call(this,e,n,i),this.updateNowIndicator()},e.prototype.addScroll=function(t){var e=this.queuedScroll||(this.queuedScroll={});r.extend(e,t)},e.prototype.popScroll=function(){this.applyQueuedScroll(),this.queuedScroll=null},e.prototype.applyQueuedScroll=function(){this.queuedScroll&&this.applyScroll(this.queuedScroll)},e.prototype.queryScroll=function(){var t={};return this.isDatesRendered&&r.extend(t,this.queryDateScroll()),t},e.prototype.applyScroll=function(t){t.isDateInit&&this.isDatesRendered&&r.extend(t,this.computeInitialDateScroll()),this.isDatesRendered&&this.applyDateScroll(t)},e.prototype.computeInitialDateScroll=function(){return{}},e.prototype.queryDateScroll=function(){return{}},e.prototype.applyDateScroll=function(t){},e.prototype.reportEventDrop=function(t,e,n,i){var r=this.calendar.eventManager,s=r.mutateEventsWithId(t.def.id,e),a=e.dateMutation;a&&(t.dateProfile=a.buildNewDateProfile(t.dateProfile,this.calendar)),this.triggerEventDrop(t,a&&a.dateDelta||o.duration(),s,n,i)},e.prototype.triggerEventDrop=function(t,e,n,i,r){this.publiclyTrigger("eventDrop",{context:i[0],args:[t.toLegacy(),e,n,r,{},this]})},e.prototype.reportExternalDrop=function(t,e,n,i,r,o){e&&this.calendar.eventManager.addEventDef(t,n),this.triggerExternalDrop(t,e,i,r,o)},e.prototype.triggerExternalDrop=function(t,e,n,i,r){this.publiclyTrigger("drop",{context:n[0],args:[t.dateProfile.start.clone(),i,r,this]}),e&&this.publiclyTrigger("eventReceive",{context:this,args:[t.buildInstance().toLegacy(),this]})},e.prototype.reportEventResize=function(t,e,n,i){var r=this.calendar.eventManager,o=r.mutateEventsWithId(t.def.id,e);t.dateProfile=e.dateMutation.buildNewDateProfile(t.dateProfile,this.calendar),this.triggerEventResize(t,e.dateMutation.endDelta,o,n,i)},e.prototype.triggerEventResize=function(t,e,n,i,r){this.publiclyTrigger("eventResize",{context:i[0],args:[t.toLegacy(),e,n,r,{},this]})},e.prototype.select=function(t,e){this.unselect(e),this.renderSelectionFootprint(t),this.reportSelection(t,e)},e.prototype.renderSelectionFootprint=function(e){this.renderSelection?this.renderSelection(e.toLegacy(this.calendar)):t.prototype.renderSelectionFootprint.call(this,e)},e.prototype.reportSelection=function(t,e){this.isSelected=!0,this.triggerSelect(t,e)},e.prototype.triggerSelect=function(t,e){var n=this.calendar.footprintToDateProfile(t);this.publiclyTrigger("select",{context:this,args:[n.start,n.end,e,this]})},e.prototype.unselect=function(t){this.isSelected&&(this.isSelected=!1,this.destroySelection&&this.destroySelection(),this.unrenderSelection(),this.publiclyTrigger("unselect",{context:this,args:[t,this]}))},e.prototype.selectEventInstance=function(t){this.selectedEventInstance&&this.selectedEventInstance===t||(this.unselectEventInstance(),this.getEventSegs().forEach(function(e){e.footprint.eventInstance===t&&e.el&&e.el.addClass("fc-selected")}),this.selectedEventInstance=t)},e.prototype.unselectEventInstance=function(){this.selectedEventInstance&&(this.getEventSegs().forEach(function(t){t.el&&t.el.removeClass("fc-selected")}),this.selectedEventInstance=null)},e.prototype.isEventDefSelected=function(t){return this.selectedEventInstance&&this.selectedEventInstance.def.id===t.id},e.prototype.handleDocumentMousedown=function(t){s.isPrimaryMouseButton(t)&&this.processUnselect(t)},e.prototype.processUnselect=function(t){this.processRangeUnselect(t),this.processEventUnselect(t)},e.prototype.processRangeUnselect=function(t){var e;this.isSelected&&this.opt("unselectAuto")&&((e=this.opt("unselectCancel"))&&r(t.target).closest(e).length||this.unselect(t))},e.prototype.processEventUnselect=function(t){this.selectedEventInstance&&(r(t.target).closest(".fc-selected").length||this.unselectEventInstance())},e.prototype.triggerBaseRendered=function(){this.publiclyTrigger("viewRender",{context:this,args:[this,this.el]})},e.prototype.triggerBaseUnrendered=function(){this.publiclyTrigger("viewDestroy",{context:this,args:[this,this.el]})},e.prototype.triggerDayClick=function(t,e,n){var i=this.calendar.footprintToDateProfile(t);this.publiclyTrigger("dayClick",{context:e,args:[i.start,n,this]})},e.prototype.isDateInOtherMonth=function(t,e){return!1},e.prototype.getUnzonedRangeOption=function(t){var e=this.opt(t);if("function"==typeof e&&(e=e.apply(null,Array.prototype.slice.call(arguments,1))),e)return this.calendar.parseUnzonedRange(e)},e.prototype.initHiddenDays=function(){var t,e=this.opt("hiddenDays")||[],n=[],i=0;for(!1===this.opt("weekends")&&e.push(0,6),t=0;t<7;t++)(n[t]=-1!==r.inArray(t,e))||i++;if(!i)throw new Error("invalid hiddenDays");this.isHiddenDayHash=n},e.prototype.trimHiddenDays=function(t){var e=t.getStart(),n=t.getEnd();return e&&(e=this.skipHiddenDays(e)),n&&(n=this.skipHiddenDays(n,-1,!0)),null===e||null===n||e<n?new c.default(e,n):null},e.prototype.isHiddenDay=function(t){return o.isMoment(t)&&(t=t.day()),this.isHiddenDayHash[t]},e.prototype.skipHiddenDays=function(t,e,n){void 0===e&&(e=1),void 0===n&&(n=!1);for(var i=t.clone();this.isHiddenDayHash[(i.day()+(n?e:0)+7)%7];)i.add(e,"days");return i},e}(u.default);e.default=p,p.prototype.usesMinMaxTime=!1,p.prototype.dateProfileGeneratorClass=l.default,p.watch("displayingDates",["isInDom","dateProfile"],function(t){this.requestDateRender(t.dateProfile)},function(){this.requestDateUnrender()}),p.watch("displayingBusinessHours",["displayingDates","businessHourGenerator"],function(t){this.requestBusinessHoursRender(t.businessHourGenerator)},function(){this.requestBusinessHoursUnrender()}),p.watch("initialEvents",["dateProfile"],function(t){return this.fetchInitialEvents(t.dateProfile)}),p.watch("bindingEvents",["initialEvents"],function(t){this.setEvents(t.initialEvents),this.bindEventChanges()},function(){this.unbindEventChanges(),this.unsetEvents()}),p.watch("displayingEvents",["displayingDates","hasEvents"],function(){this.requestEventsRender(this.get("currentEvents"))},function(){this.requestEventsUnrender()}),p.watch("title",["dateProfile"],function(t){return this.title=this.computeTitle(t.dateProfile)}),p.watch("legacyDateProps",["dateProfile"],function(t){var e=this.calendar,n=t.dateProfile;this.start=e.msToMoment(n.activeUnzonedRange.startMs,n.isRangeAllDay),this.end=e.msToMoment(n.activeUnzonedRange.endMs,n.isRangeAllDay),this.intervalStart=e.msToMoment(n.currentUnzonedRange.startMs,n.isRangeAllDay),this.intervalEnd=e.msToMoment(n.currentUnzonedRange.endMs,n.isRangeAllDay)})},function(t,e,n){Object.defineProperty(e,"__esModule",{value:!0});var i=n(3),r=n(4),o=function(){function t(t,e){this.view=t._getView(),this.component=t,this.fillRenderer=e}return t.prototype.opt=function(t){return this.view.opt(t)},t.prototype.rangeUpdated=function(){var t,e;this.eventTimeFormat=this.opt("eventTimeFormat")||this.opt("timeFormat")||this.computeEventTimeFormat(),t=this.opt("displayEventTime"),null==t&&(t=this.computeDisplayEventTime()),e=this.opt("displayEventEnd"),null==e&&(e=this.computeDisplayEventEnd()),this.displayEventTime=t,this.displayEventEnd=e},t.prototype.render=function(t){var e,n,i,r=this.component._getDateProfile(),o=[],s=[];for(e in t)n=t[e],i=n.sliceRenderRanges(r.activeUnzonedRange),n.getEventDef().hasBgRendering()?o.push.apply(o,i):s.push.apply(s,i);this.renderBgRanges(o),this.renderFgRanges(s)},t.prototype.unrender=function(){this.unrenderBgRanges(),this.unrenderFgRanges()},t.prototype.renderFgRanges=function(t){var e=this.component.eventRangesToEventFootprints(t),n=this.component.eventFootprintsToSegs(e);n=this.renderFgSegEls(n),!1!==this.renderFgSegs(n)&&(this.fgSegs=n)},t.prototype.unrenderFgRanges=function(){this.unrenderFgSegs(this.fgSegs||[]),this.fgSegs=null},t.prototype.renderBgRanges=function(t){var e=this.component.eventRangesToEventFootprints(t),n=this.component.eventFootprintsToSegs(e);!1!==this.renderBgSegs(n)&&(this.bgSegs=n)},t.prototype.unrenderBgRanges=function(){this.unrenderBgSegs(),this.bgSegs=null},t.prototype.getSegs=function(){return(this.bgSegs||[]).concat(this.fgSegs||[])},t.prototype.renderFgSegs=function(t){return!1},t.prototype.unrenderFgSegs=function(t){},t.prototype.renderBgSegs=function(t){var e=this;if(!this.fillRenderer)return!1;this.fillRenderer.renderSegs("bgEvent",t,{getClasses:function(t){return e.getBgClasses(t.footprint.eventDef)},getCss:function(t){return{"background-color":e.getBgColor(t.footprint.eventDef)}},filterEl:function(t,n){return e.filterEventRenderEl(t.footprint,n)}})},t.prototype.unrenderBgSegs=function(){this.fillRenderer&&this.fillRenderer.unrender("bgEvent")},t.prototype.renderFgSegEls=function(t,e){var n=this;void 0===e&&(e=!1);var r,o=this.view.hasPublicHandlers("eventRender"),s="",a=[];if(t.length){for(r=0;r<t.length;r++)this.beforeFgSegHtml(t[r]),s+=this.fgSegHtml(t[r],e);i(s).each(function(e,r){var s=t[e],l=i(r);o&&(l=n.filterEventRenderEl(s.footprint,l)),l&&(l.data("fc-seg",s),s.el=l,a.push(s))})}return a},t.prototype.beforeFgSegHtml=function(t){},t.prototype.fgSegHtml=function(t,e){},t.prototype.getSegClasses=function(t,e,n){var i=["fc-event",t.isStart?"fc-start":"fc-not-start",t.isEnd?"fc-end":"fc-not-end"].concat(this.getClasses(t.footprint.eventDef));return e&&i.push("fc-draggable"),n&&i.push("fc-resizable"),this.view.isEventDefSelected(t.footprint.eventDef)&&i.push("fc-selected"),i},t.prototype.filterEventRenderEl=function(t,e){var n=t.getEventLegacy(),r=this.view.publiclyTrigger("eventRender",{context:n,args:[n,e,this.view]});return!1===r?e=null:r&&!0!==r&&(e=i(r)),e},t.prototype.getTimeText=function(t,e,n){return this._getTimeText(t.eventInstance.dateProfile.start,t.eventInstance.dateProfile.end,t.componentFootprint.isAllDay,e,n)},t.prototype._getTimeText=function(t,e,n,i,r){return null==i&&(i=this.eventTimeFormat),null==r&&(r=this.displayEventEnd),this.displayEventTime&&!n?r&&e?this.view.formatRange({start:t,end:e},!1,i):t.format(i):""},t.prototype.computeEventTimeFormat=function(){return this.opt("smallTimeFormat")},t.prototype.computeDisplayEventTime=function(){return!0},t.prototype.computeDisplayEventEnd=function(){return!0},t.prototype.getBgClasses=function(t){var e=this.getClasses(t);return e.push("fc-bgevent"),e},t.prototype.getClasses=function(t){var e,n=this.getStylingObjs(t),i=[];for(e=0;e<n.length;e++)i.push.apply(i,n[e].eventClassName||n[e].className||[]);return i},t.prototype.getSkinCss=function(t){return{"background-color":this.getBgColor(t),"border-color":this.getBorderColor(t),color:this.getTextColor(t)}},t.prototype.getBgColor=function(t){var e,n,i=this.getStylingObjs(t);for(e=0;e<i.length&&!n;e++)n=i[e].eventBackgroundColor||i[e].eventColor||i[e].backgroundColor||i[e].color;return n||(n=this.opt("eventBackgroundColor")||this.opt("eventColor")),n},t.prototype.getBorderColor=function(t){var e,n,i=this.getStylingObjs(t);for(e=0;e<i.length&&!n;e++)n=i[e].eventBorderColor||i[e].eventColor||i[e].borderColor||i[e].color;return n||(n=this.opt("eventBorderColor")||this.opt("eventColor")),n},t.prototype.getTextColor=function(t){var e,n,i=this.getStylingObjs(t);for(e=0;e<i.length&&!n;e++)n=i[e].eventTextColor||i[e].textColor;return n||(n=this.opt("eventTextColor")),n},t.prototype.getStylingObjs=function(t){var e=this.getFallbackStylingObjs(t);return e.unshift(t),e},t.prototype.getFallbackStylingObjs=function(t){return[t.source]},t.prototype.sortEventSegs=function(t){t.sort(r.proxy(this,"compareEventSegs"))},t.prototype.compareEventSegs=function(t,e){var n=t.footprint,i=e.footprint,o=n.componentFootprint,s=i.componentFootprint,a=o.unzonedRange,l=s.unzonedRange
;return a.startMs-l.startMs||l.endMs-l.startMs-(a.endMs-a.startMs)||s.isAllDay-o.isAllDay||r.compareByFieldSpecs(n.eventDef,i.eventDef,this.view.eventOrderSpecs,n.eventDef.miscProps,i.eventDef.miscProps)},t}();e.default=o},,,,,function(t,e,n){function i(t){return"en"!==t.locale()?t.clone().locale("en"):t}function r(t,e){return h(a(e).fakeFormatString,t)}function o(t,e,n,i,r){var o;return t=y.default.parseZone(t),e=y.default.parseZone(e),o=t.localeData(),n=o.longDateFormat(n)||n,s(a(n),t,e,i||" - ",r)}function s(t,e,n,i,r){var o,s,a,l=t.sameUnits,u=e.clone().stripZone(),d=n.clone().stripZone(),c=f(t.fakeFormatString,e),p=f(t.fakeFormatString,n),h="",v="",y="",m="",b="";for(o=0;o<l.length&&(!l[o]||u.isSame(d,l[o]));o++)h+=c[o];for(s=l.length-1;s>o&&(!l[s]||u.isSame(d,l[s]))&&(s-1!==o||"."!==c[s]);s--)v=c[s]+v;for(a=o;a<=s;a++)y+=c[a],m+=p[a];return(y||m)&&(b=r?m+i+y:y+i+m),g(h+b+v)}function a(t){return C[t]||(C[t]=l(t))}function l(t){var e=u(t);return{fakeFormatString:c(e),sameUnits:p(e)}}function u(t){for(var e,n=[],i=/\[([^\]]*)\]|\(([^\)]*)\)|(LTS|LT|(\w)\4*o?)|([^\w\[\(]+)/g;e=i.exec(t);)e[1]?n.push.apply(n,d(e[1])):e[2]?n.push({maybe:u(e[2])}):e[3]?n.push({token:e[3]}):e[5]&&n.push.apply(n,d(e[5]));return n}function d(t){return". "===t?["."," "]:[t]}function c(t){var e,n,i=[];for(e=0;e<t.length;e++)n=t[e],"string"==typeof n?i.push("["+n+"]"):n.token?n.token in E?i.push(b+"["+n.token+"]"):i.push(n.token):n.maybe&&i.push(w+c(n.maybe)+w);return i.join(m)}function p(t){var e,n,i,r=[];for(e=0;e<t.length;e++)n=t[e],n.token?(i=S[n.token.charAt(0)],r.push(i?i.unit:"second")):n.maybe?r.push.apply(r,p(n.maybe)):r.push(null);return r}function h(t,e){return g(f(t,e).join(""))}function f(t,e){var n,i,r=[],o=y.oldMomentFormat(e,t),s=o.split(m);for(n=0;n<s.length;n++)i=s[n],i.charAt(0)===b?r.push(E[i.substring(1)](e)):r.push(i);return r}function g(t){return t.replace(D,function(t,e){return e.match(/[1-9]/)?e:""})}function v(t){var e,n,i,r,o=u(t);for(e=0;e<o.length;e++)n=o[e],n.token&&(i=S[n.token.charAt(0)])&&(!r||i.value>r.value)&&(r=i);return r?r.unit:null}Object.defineProperty(e,"__esModule",{value:!0});var y=n(10);y.newMomentProto.format=function(){return this._fullCalendar&&arguments[0]?r(this,arguments[0]):this._ambigTime?y.oldMomentFormat(i(this),"YYYY-MM-DD"):this._ambigZone?y.oldMomentFormat(i(this),"YYYY-MM-DD[T]HH:mm:ss"):this._fullCalendar?y.oldMomentFormat(i(this)):y.oldMomentProto.format.apply(this,arguments)},y.newMomentProto.toISOString=function(){return this._ambigTime?y.oldMomentFormat(i(this),"YYYY-MM-DD"):this._ambigZone?y.oldMomentFormat(i(this),"YYYY-MM-DD[T]HH:mm:ss"):this._fullCalendar?y.oldMomentProto.toISOString.apply(i(this),arguments):y.oldMomentProto.toISOString.apply(this,arguments)};var m="\v",b="",w="",D=new RegExp(w+"([^"+w+"]*)"+w,"g"),E={t:function(t){return y.oldMomentFormat(t,"a").charAt(0)},T:function(t){return y.oldMomentFormat(t,"A").charAt(0)}},S={Y:{value:1,unit:"year"},M:{value:2,unit:"month"},W:{value:3,unit:"week"},w:{value:3,unit:"week"},D:{value:4,unit:"day"},d:{value:4,unit:"day"}};e.formatDate=r,e.formatRange=o;var C={};e.queryMostGranularFormatUnit=v},function(t,e,n){Object.defineProperty(e,"__esModule",{value:!0});var i=n(2),r=n(33),o=n(11),s=n(7),a=function(t){function e(){var e=t.call(this)||this;return e._watchers={},e._props={},e.applyGlobalWatchers(),e.constructed(),e}return i.__extends(e,t),e.watch=function(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];this.prototype.hasOwnProperty("_globalWatchArgs")||(this.prototype._globalWatchArgs=Object.create(this.prototype._globalWatchArgs)),this.prototype._globalWatchArgs[t]=e},e.prototype.constructed=function(){},e.prototype.applyGlobalWatchers=function(){var t,e=this._globalWatchArgs;for(t in e)this.watch.apply(this,[t].concat(e[t]))},e.prototype.has=function(t){return t in this._props},e.prototype.get=function(t){return void 0===t?this._props:this._props[t]},e.prototype.set=function(t,e){var n;"string"==typeof t?(n={},n[t]=void 0===e?null:e):n=t,this.setProps(n)},e.prototype.reset=function(t){var e,n=this._props,i={};for(e in n)i[e]=void 0;for(e in t)i[e]=t[e];this.setProps(i)},e.prototype.unset=function(t){var e,n,i={};for(e="string"==typeof t?[t]:t,n=0;n<e.length;n++)i[e[n]]=void 0;this.setProps(i)},e.prototype.setProps=function(t){var e,n,i={},r=0;for(e in t)"object"!=typeof(n=t[e])&&n===this._props[e]||(i[e]=n,r++);if(r){this.trigger("before:batchChange",i);for(e in i)n=i[e],this.trigger("before:change",e,n),this.trigger("before:change:"+e,n);for(e in i)n=i[e],void 0===n?delete this._props[e]:this._props[e]=n,this.trigger("change:"+e,n),this.trigger("change",e,n);this.trigger("batchChange",i)}},e.prototype.watch=function(t,e,n,i){var r=this;this.unwatch(t),this._watchers[t]=this._watchDeps(e,function(e){var i=n.call(r,e);i&&i.then?(r.unset(t),i.then(function(e){r.set(t,e)})):r.set(t,i)},function(e){r.unset(t),i&&i.call(r,e)})},e.prototype.unwatch=function(t){var e=this._watchers[t];e&&(delete this._watchers[t],e.teardown())},e.prototype._watchDeps=function(t,e,n){var i=this,r=0,o=t.length,s=0,a={},l=[],u=!1,d=function(t,e,i){1===++r&&s===o&&(u=!0,n(a),u=!1)},c=function(t,n,i){void 0===n?(i||void 0===a[t]||s--,delete a[t]):(i||void 0!==a[t]||s++,a[t]=n),--r||s===o&&(u||e(a))},p=function(t,e){i.on(t,e),l.push([t,e])};return t.forEach(function(t){var e=!1;"?"===t.charAt(0)&&(t=t.substring(1),e=!0),p("before:change:"+t,function(t){d()}),p("change:"+t,function(n){c(t,n,e)})}),t.forEach(function(t){var e=!1;"?"===t.charAt(0)&&(t=t.substring(1),e=!0),i.has(t)?(a[t]=i.get(t),s++):e&&s++}),s===o&&e(a),{teardown:function(){for(var t=0;t<l.length;t++)i.off(l[t][0],l[t][1]);l=null,s===o&&n()},flash:function(){s===o&&(n(),e(a))}}},e.prototype.flash=function(t){var e=this._watchers[t];e&&e.flash()},e}(r.default);e.default=a,a.prototype._globalWatchArgs={},o.default.mixInto(a),s.default.mixInto(a)},function(t,e,n){Object.defineProperty(e,"__esModule",{value:!0});var i=n(0),r=n(4),o=n(13),s=n(210);e.default={parse:function(t,e){return r.isTimeString(t.start)||i.isDuration(t.start)||r.isTimeString(t.end)||i.isDuration(t.end)?s.default.parse(t,e):o.default.parse(t,e)}}},function(t,e,n){Object.defineProperty(e,"__esModule",{value:!0});var i=n(4),r=n(17),o=function(){function t(){this.clearEnd=!1,this.forceTimed=!1,this.forceAllDay=!1}return t.createFromDiff=function(e,n,r){function o(t,e){return r?i.diffByUnit(t,e,r):n.isAllDay()?i.diffDay(t,e):i.diffDayTime(t,e)}var s,a,l,u,d=e.end&&!n.end,c=e.isAllDay()&&!n.isAllDay(),p=!e.isAllDay()&&n.isAllDay();return s=o(n.start,e.start),n.end&&(a=o(n.unzonedRange.getEnd(),e.unzonedRange.getEnd()),l=a.subtract(s)),u=new t,u.clearEnd=d,u.forceTimed=c,u.forceAllDay=p,u.setDateDelta(s),u.setEndDelta(l),u},t.prototype.buildNewDateProfile=function(t,e){var n=t.start.clone(),i=null,o=!1;return t.end&&!this.clearEnd?i=t.end.clone():this.endDelta&&!i&&(i=e.getDefaultEventEnd(t.isAllDay(),n)),this.forceTimed?(o=!0,n.hasTime()||n.time(0),i&&!i.hasTime()&&i.time(0)):this.forceAllDay&&(n.hasTime()&&n.stripTime(),i&&i.hasTime()&&i.stripTime()),this.dateDelta&&(o=!0,n.add(this.dateDelta),i&&i.add(this.dateDelta)),this.endDelta&&(o=!0,i.add(this.endDelta)),this.startDelta&&(o=!0,n.add(this.startDelta)),o&&(n=e.applyTimezone(n),i&&(i=e.applyTimezone(i))),!i&&e.opt("forceEventDuration")&&(i=e.getDefaultEventEnd(t.isAllDay(),n)),new r.default(n,i,e)},t.prototype.setDateDelta=function(t){t&&t.valueOf()?this.dateDelta=t:this.dateDelta=null},t.prototype.setStartDelta=function(t){t&&t.valueOf()?this.startDelta=t:this.startDelta=null},t.prototype.setEndDelta=function(t){t&&t.valueOf()?this.endDelta=t:this.endDelta=null},t.prototype.isEmpty=function(){return!(this.clearEnd||this.forceTimed||this.forceAllDay||this.dateDelta||this.startDelta||this.endDelta)},t}();e.default=o},function(t,e,n){function i(t,e){a[t]=e}function r(t){return t?!0===t?s.default:a[t]:o.default}Object.defineProperty(e,"__esModule",{value:!0});var o=n(213),s=n(214),a={};e.defineThemeSystem=i,e.getThemeSystemClass=r},function(t,e,n){Object.defineProperty(e,"__esModule",{value:!0});var i=n(2),r=n(3),o=n(4),s=n(20),a=n(6),l=n(13),u=function(t){function e(e){var n=t.call(this,e)||this;return n.eventDefs=[],n}return i.__extends(e,t),e.parse=function(t,e){var n;return r.isArray(t.events)?n=t:r.isArray(t)&&(n={events:t}),!!n&&a.default.parse.call(this,n,e)},e.prototype.setRawEventDefs=function(t){this.rawEventDefs=t,this.eventDefs=this.parseEventDefs(t)},e.prototype.fetch=function(t,e,n){var i,r=this.eventDefs;if(null!=this.currentTimezone&&this.currentTimezone!==n)for(i=0;i<r.length;i++)r[i]instanceof l.default&&r[i].rezone();return this.currentTimezone=n,s.default.resolve(r)},e.prototype.addEventDef=function(t){this.eventDefs.push(t)},e.prototype.removeEventDefsById=function(t){return o.removeMatching(this.eventDefs,function(e){return e.id===t})},e.prototype.removeAllEventDefs=function(){this.eventDefs=[]},e.prototype.getPrimitive=function(){return this.rawEventDefs},e.prototype.applyManualStandardProps=function(e){var n=t.prototype.applyManualStandardProps.call(this,e);return this.setRawEventDefs(e.events),n},e}(a.default);e.default=u,u.defineStandardProps({events:!1})},function(t,e,n){Object.defineProperty(e,"__esModule",{value:!0});var i=n(3),r=n(4),o=function(){function t(t){this.isHorizontal=!1,this.isVertical=!1,this.els=i(t.els),this.isHorizontal=t.isHorizontal,this.isVertical=t.isVertical,this.forcedOffsetParentEl=t.offsetParent?i(t.offsetParent):null}return t.prototype.build=function(){var t=this.forcedOffsetParentEl;!t&&this.els.length>0&&(t=this.els.eq(0).offsetParent()),this.origin=t?t.offset():null,this.boundingRect=this.queryBoundingRect(),this.isHorizontal&&this.buildElHorizontals(),this.isVertical&&this.buildElVerticals()},t.prototype.clear=function(){this.origin=null,this.boundingRect=null,this.lefts=null,this.rights=null,this.tops=null,this.bottoms=null},t.prototype.ensureBuilt=function(){this.origin||this.build()},t.prototype.buildElHorizontals=function(){var t=[],e=[];this.els.each(function(n,r){var o=i(r),s=o.offset().left,a=o.outerWidth();t.push(s),e.push(s+a)}),this.lefts=t,this.rights=e},t.prototype.buildElVerticals=function(){var t=[],e=[];this.els.each(function(n,r){var o=i(r),s=o.offset().top,a=o.outerHeight();t.push(s),e.push(s+a)}),this.tops=t,this.bottoms=e},t.prototype.getHorizontalIndex=function(t){this.ensureBuilt();var e,n=this.lefts,i=this.rights,r=n.length;for(e=0;e<r;e++)if(t>=n[e]&&t<i[e])return e},t.prototype.getVerticalIndex=function(t){this.ensureBuilt();var e,n=this.tops,i=this.bottoms,r=n.length;for(e=0;e<r;e++)if(t>=n[e]&&t<i[e])return e},t.prototype.getLeftOffset=function(t){return this.ensureBuilt(),this.lefts[t]},t.prototype.getLeftPosition=function(t){return this.ensureBuilt(),this.lefts[t]-this.origin.left},t.prototype.getRightOffset=function(t){return this.ensureBuilt(),this.rights[t]},t.prototype.getRightPosition=function(t){return this.ensureBuilt(),this.rights[t]-this.origin.left},t.prototype.getWidth=function(t){return this.ensureBuilt(),this.rights[t]-this.lefts[t]},t.prototype.getTopOffset=function(t){return this.ensureBuilt(),this.tops[t]},t.prototype.getTopPosition=function(t){return this.ensureBuilt(),this.tops[t]-this.origin.top},t.prototype.getBottomOffset=function(t){return this.ensureBuilt(),this.bottoms[t]},t.prototype.getBottomPosition=function(t){return this.ensureBuilt(),this.bottoms[t]-this.origin.top},t.prototype.getHeight=function(t){return this.ensureBuilt(),this.bottoms[t]-this.tops[t]},t.prototype.queryBoundingRect=function(){var t;return this.els.length>0&&(t=r.getScrollParent(this.els.eq(0)),!t.is(document))?r.getClientRect(t):null},t.prototype.isPointInBounds=function(t,e){return this.isLeftInBounds(t)&&this.isTopInBounds(e)},t.prototype.isLeftInBounds=function(t){return!this.boundingRect||t>=this.boundingRect.left&&t<this.boundingRect.right},t.prototype.isTopInBounds=function(t){return!this.boundingRect||t>=this.boundingRect.top&&t<this.boundingRect.bottom},t}();e.default=o},function(t,e,n){Object.defineProperty(e,"__esModule",{value:!0});var i=n(3),r=n(4),o=n(7),s=n(21),a=function(){function t(t){this.isInteracting=!1,this.isDistanceSurpassed=!1,this.isDelayEnded=!1,this.isDragging=!1,this.isTouch=!1,this.isGeneric=!1,this.shouldCancelTouchScroll=!0,this.scrollAlwaysKills=!1,this.isAutoScroll=!1,this.scrollSensitivity=30,this.scrollSpeed=200,this.scrollIntervalMs=50,this.options=t||{}}return t.prototype.startInteraction=function(t,e){if(void 0===e&&(e={}),"mousedown"===t.type){if(s.default.get().shouldIgnoreMouse())return;if(!r.isPrimaryMouseButton(t))return;t.preventDefault()}this.isInteracting||(this.delay=r.firstDefined(e.delay,this.options.delay,0),this.minDistance=r.firstDefined(e.distance,this.options.distance,0),this.subjectEl=this.options.subjectEl,r.preventSelection(i("body")),this.isInteracting=!0,this.isTouch=r.getEvIsTouch(t),this.isGeneric="dragstart"===t.type,this.isDelayEnded=!1,this.isDistanceSurpassed=!1,this.originX=r.getEvX(t),this.originY=r.getEvY(t),this.scrollEl=r.getScrollParent(i(t.target)),this.bindHandlers(),this.initAutoScroll(),this.handleInteractionStart(t),this.startDelay(t),this.minDistance||this.handleDistanceSurpassed(t))},t.prototype.handleInteractionStart=function(t){this.trigger("interactionStart",t)},t.prototype.endInteraction=function(t,e){this.isInteracting&&(this.endDrag(t),this.delayTimeoutId&&(clearTimeout(this.delayTimeoutId),this.delayTimeoutId=null),this.destroyAutoScroll(),this.unbindHandlers(),this.isInteracting=!1,this.handleInteractionEnd(t,e),r.allowSelection(i("body")))},t.prototype.handleInteractionEnd=function(t,e){this.trigger("interactionEnd",t,e||!1)},t.prototype.bindHandlers=function(){var t=s.default.get();this.isGeneric?this.listenTo(i(document),{drag:this.handleMove,dragstop:this.endInteraction}):this.isTouch?this.listenTo(t,{touchmove:this.handleTouchMove,touchend:this.endInteraction,scroll:this.handleTouchScroll}):this.listenTo(t,{mousemove:this.handleMouseMove,mouseup:this.endInteraction}),this.listenTo(t,{selectstart:r.preventDefault,contextmenu:r.preventDefault})},t.prototype.unbindHandlers=function(){this.stopListeningTo(s.default.get()),this.stopListeningTo(i(document))},t.prototype.startDrag=function(t,e){this.startInteraction(t,e),this.isDragging||(this.isDragging=!0,this.handleDragStart(t))},t.prototype.handleDragStart=function(t){this.trigger("dragStart",t)},t.prototype.handleMove=function(t){var e=r.getEvX(t)-this.originX,n=r.getEvY(t)-this.originY,i=this.minDistance;this.isDistanceSurpassed||e*e+n*n>=i*i&&this.handleDistanceSurpassed(t),this.isDragging&&this.handleDrag(e,n,t)},t.prototype.handleDrag=function(t,e,n){this.trigger("drag",t,e,n),this.updateAutoScroll(n)},t.prototype.endDrag=function(t){this.isDragging&&(this.isDragging=!1,this.handleDragEnd(t))},t.prototype.handleDragEnd=function(t){this.trigger("dragEnd",t)},t.prototype.startDelay=function(t){var e=this;this.delay?this.delayTimeoutId=setTimeout(function(){e.handleDelayEnd(t)},this.delay):this.handleDelayEnd(t)},t.prototype.handleDelayEnd=function(t){this.isDelayEnded=!0,this.isDistanceSurpassed&&this.startDrag(t)},t.prototype.handleDistanceSurpassed=function(t){this.isDistanceSurpassed=!0,this.isDelayEnded&&this.startDrag(t)},t.prototype.handleTouchMove=function(t){this.isDragging&&this.shouldCancelTouchScroll&&t.preventDefault(),this.handleMove(t)},t.prototype.handleMouseMove=function(t){this.handleMove(t)},t.prototype.handleTouchScroll=function(t){this.isDragging&&!this.scrollAlwaysKills||this.endInteraction(t,!0)},t.prototype.trigger=function(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];this.options[t]&&this.options[t].apply(this,e),this["_"+t]&&this["_"+t].apply(this,e)},t.prototype.initAutoScroll=function(){var t=this.scrollEl;this.isAutoScroll=this.options.scroll&&t&&!t.is(window)&&!t.is(document),this.isAutoScroll&&this.listenTo(t,"scroll",r.debounce(this.handleDebouncedScroll,100))},t.prototype.destroyAutoScroll=function(){this.endAutoScroll(),this.isAutoScroll&&this.stopListeningTo(this.scrollEl,"scroll")},t.prototype.computeScrollBounds=function(){this.isAutoScroll&&(this.scrollBounds=r.getOuterRect(this.scrollEl))},t.prototype.updateAutoScroll=function(t){var e,n,i,o,s=this.scrollSensitivity,a=this.scrollBounds,l=0,u=0;a&&(e=(s-(r.getEvY(t)-a.top))/s,n=(s-(a.bottom-r.getEvY(t)))/s,i=(s-(r.getEvX(t)-a.left))/s,o=(s-(a.right-r.getEvX(t)))/s,e>=0&&e<=1?l=e*this.scrollSpeed*-1:n>=0&&n<=1&&(l=n*this.scrollSpeed),i>=0&&i<=1?u=i*this.scrollSpeed*-1:o>=0&&o<=1&&(u=o*this.scrollSpeed)),this.setScrollVel(l,u)},t.prototype.setScrollVel=function(t,e){this.scrollTopVel=t,this.scrollLeftVel=e,this.constrainScrollVel(),!this.scrollTopVel&&!this.scrollLeftVel||this.scrollIntervalId||(this.scrollIntervalId=setInterval(r.proxy(this,"scrollIntervalFunc"),this.scrollIntervalMs))},t.prototype.constrainScrollVel=function(){var t=this.scrollEl;this.scrollTopVel<0?t.scrollTop()<=0&&(this.scrollTopVel=0):this.scrollTopVel>0&&t.scrollTop()+t[0].clientHeight>=t[0].scrollHeight&&(this.scrollTopVel=0),this.scrollLeftVel<0?t.scrollLeft()<=0&&(this.scrollLeftVel=0):this.scrollLeftVel>0&&t.scrollLeft()+t[0].clientWidth>=t[0].scrollWidth&&(this.scrollLeftVel=0)},t.prototype.scrollIntervalFunc=function(){var t=this.scrollEl,e=this.scrollIntervalMs/1e3;this.scrollTopVel&&t.scrollTop(t.scrollTop()+this.scrollTopVel*e),this.scrollLeftVel&&t.scrollLeft(t.scrollLeft()+this.scrollLeftVel*e),this.constrainScrollVel(),this.scrollTopVel||this.scrollLeftVel||this.endAutoScroll()},t.prototype.endAutoScroll=function(){this.scrollIntervalId&&(clearInterval(this.scrollIntervalId),this.scrollIntervalId=null,this.handleScrollEnd())},t.prototype.handleDebouncedScroll=function(){this.scrollIntervalId||this.handleScrollEnd()},t.prototype.handleScrollEnd=function(){},t}();e.default=a,o.default.mixInto(a)},function(t,e,n){Object.defineProperty(e,"__esModule",{value:!0});var i=n(2),r=n(4),o=n(14),s=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return i.__extends(e,t),e.prototype.updateDayTable=function(){for(var t,e,n,i=this,r=i.view,o=r.calendar,s=o.msToUtcMoment(i.dateProfile.renderUnzonedRange.startMs,!0),a=o.msToUtcMoment(i.dateProfile.renderUnzonedRange.endMs,!0),l=-1,u=[],d=[];s.isBefore(a);)r.isHiddenDay(s)?u.push(l+.5):(l++,u.push(l),d.push(s.clone())),s.add(1,"days");if(this.breakOnWeeks){for(e=d[0].day(),t=1;t<d.length&&d[t].day()!==e;t++);n=Math.ceil(d.length/t)}else n=1,t=d.length;this.dayDates=d,this.dayIndices=u,this.daysPerRow=t,this.rowCnt=n,this.updateDayTableCols()},e.prototype.updateDayTableCols=function(){this.colCnt=this.computeColCnt(),this.colHeadFormat=this.opt("columnHeaderFormat")||this.opt("columnFormat")||this.computeColHeadFormat()},e.prototype.computeColCnt=function(){return this.daysPerRow},e.prototype.getCellDate=function(t,e){return this.dayDates[this.getCellDayIndex(t,e)].clone()},e.prototype.getCellRange=function(t,e){var n=this.getCellDate(t,e);return{start:n,end:n.clone().add(1,"days")}},e.prototype.getCellDayIndex=function(t,e){return t*this.daysPerRow+this.getColDayIndex(e)},e.prototype.getColDayIndex=function(t){return this.isRTL?this.colCnt-1-t:t},e.prototype.getDateDayIndex=function(t){var e=this.dayIndices,n=t.diff(this.dayDates[0],"days");return n<0?e[0]-1:n>=e.length?e[e.length-1]+1:e[n]},e.prototype.computeColHeadFormat=function(){return this.rowCnt>1||this.colCnt>10?"ddd":this.colCnt>1?this.opt("dayOfMonthFormat"):"dddd"},e.prototype.sliceRangeByRow=function(t){var e,n,i,r,o,s=this.daysPerRow,a=this.view.computeDayRange(t),l=this.getDateDayIndex(a.start),u=this.getDateDayIndex(a.end.clone().subtract(1,"days")),d=[];for(e=0;e<this.rowCnt;e++)n=e*s,i=n+s-1,r=Math.max(l,n),o=Math.min(u,i),r=Math.ceil(r),o=Math.floor(o),r<=o&&d.push({row:e,firstRowDayIndex:r-n,lastRowDayIndex:o-n,isStart:r===l,isEnd:o===u});return d},e.prototype.sliceRangeByDay=function(t){var e,n,i,r,o,s,a=this.daysPerRow,l=this.view.computeDayRange(t),u=this.getDateDayIndex(l.start),d=this.getDateDayIndex(l.end.clone().subtract(1,"days")),c=[];for(e=0;e<this.rowCnt;e++)for(n=e*a,i=n+a-1,r=n;r<=i;r++)o=Math.max(u,r),s=Math.min(d,r),o=Math.ceil(o),s=Math.floor(s),o<=s&&c.push({row:e,firstRowDayIndex:o-n,lastRowDayIndex:s-n,isStart:o===u,isEnd:s===d});return c},e.prototype.renderHeadHtml=function(){var t=this.view.calendar.theme;return'<div class="fc-row '+t.getClass("headerRow")+'"><table class="'+t.getClass("tableGrid")+'"><thead>'+this.renderHeadTrHtml()+"</thead></table></div>"},e.prototype.renderHeadIntroHtml=function(){return this.renderIntroHtml()},e.prototype.renderHeadTrHtml=function(){return"<tr>"+(this.isRTL?"":this.renderHeadIntroHtml())+this.renderHeadDateCellsHtml()+(this.isRTL?this.renderHeadIntroHtml():"")+"</tr>"},e.prototype.renderHeadDateCellsHtml=function(){var t,e,n=[];for(t=0;t<this.colCnt;t++)e=this.getCellDate(0,t),n.push(this.renderHeadDateCellHtml(e));return n.join("")},e.prototype.renderHeadDateCellHtml=function(t,e,n){var i,o=this,s=o.view,a=o.dateProfile.activeUnzonedRange.containsDate(t),l=["fc-day-header",s.calendar.theme.getClass("widgetHeader")];return i="function"==typeof o.opt("columnHeaderHtml")?o.opt("columnHeaderHtml")(t):"function"==typeof o.opt("columnHeaderText")?r.htmlEscape(o.opt("columnHeaderText")(t)):r.htmlEscape(t.format(o.colHeadFormat)),1===o.rowCnt?l=l.concat(o.getDayClasses(t,!0)):l.push("fc-"+r.dayIDs[t.day()]),'<th class="'+l.join(" ")+'"'+(1===(a&&o.rowCnt)?' data-date="'+t.format("YYYY-MM-DD")+'"':"")+(e>1?' colspan="'+e+'"':"")+(n?" "+n:"")+">"+(a?s.buildGotoAnchorHtml({date:t,forceOff:o.rowCnt>1||1===o.colCnt},i):i)+"</th>"},e.prototype.renderBgTrHtml=function(t){return"<tr>"+(this.isRTL?"":this.renderBgIntroHtml(t))+this.renderBgCellsHtml(t)+(this.isRTL?this.renderBgIntroHtml(t):"")+"</tr>"},e.prototype.renderBgIntroHtml=function(t){return this.renderIntroHtml()},e.prototype.renderBgCellsHtml=function(t){var e,n,i=[];for(e=0;e<this.colCnt;e++)n=this.getCellDate(t,e),i.push(this.renderBgCellHtml(n));return i.join("")},e.prototype.renderBgCellHtml=function(t,e){var n=this,i=n.view,r=n.dateProfile.activeUnzonedRange.containsDate(t),o=n.getDayClasses(t);return o.unshift("fc-day",i.calendar.theme.getClass("widgetContent")),'<td class="'+o.join(" ")+'"'+(r?' data-date="'+t.format("YYYY-MM-DD")+'"':"")+(e?" "+e:"")+"></td>"},e.prototype.renderIntroHtml=function(){},e.prototype.bookendCells=function(t){var e=this.renderIntroHtml();e&&(this.isRTL?t.append(e):t.prepend(e))},e}(o.default);e.default=s},function(t,e){Object.defineProperty(e,"__esModule",{value:!0});var n=function(){function t(t,e){this.component=t,this.fillRenderer=e}return t.prototype.render=function(t){var e=this.component,n=e._getDateProfile().activeUnzonedRange,i=t.buildEventInstanceGroup(e.hasAllDayBusinessHours,n),r=i?e.eventRangesToEventFootprints(i.sliceRenderRanges(n)):[];this.renderEventFootprints(r)},t.prototype.renderEventFootprints=function(t){var e=this.component.eventFootprintsToSegs(t);this.renderSegs(e),this.segs=e},t.prototype.renderSegs=function(t){this.fillRenderer&&this.fillRenderer.renderSegs("businessHours",t,{getClasses:function(t){return["fc-nonbusiness","fc-bgevent"]}})},t.prototype.unrender=function(){this.fillRenderer&&this.fillRenderer.unrender("businessHours"),this.segs=null},t.prototype.getSegs=function(){return this.segs||[]},t}();e.default=n},function(t,e,n){Object.defineProperty(e,"__esModule",{value:!0});var i=n(3),r=n(4),o=function(){function t(t){this.fillSegTag="div",this.component=t,this.elsByFill={}}return t.prototype.renderFootprint=function(t,e,n){this.renderSegs(t,this.component.componentFootprintToSegs(e),n)},t.prototype.renderSegs=function(t,e,n){var i;return e=this.buildSegEls(t,e,n),i=this.attachSegEls(t,e),i&&this.reportEls(t,i),e},t.prototype.unrender=function(t){var e=this.elsByFill[t];e&&(e.remove(),delete this.elsByFill[t])},t.prototype.buildSegEls=function(t,e,n){var r,o=this,s="",a=[];if(e.length){for(r=0;r<e.length;r++)s+=this.buildSegHtml(t,e[r],n);i(s).each(function(t,r){var s=e[t],l=i(r);n.filterEl&&(l=n.filterEl(s,l)),l&&(l=i(l),l.is(o.fillSegTag)&&(s.el=l,a.push(s)))})}return a},t.prototype.buildSegHtml=function(t,e,n){var i=n.getClasses?n.getClasses(e):[],o=r.cssToStr(n.getCss?n.getCss(e):{});return"<"+this.fillSegTag+(i.length?' class="'+i.join(" ")+'"':"")+(o?' style="'+o+'"':"")+" />"},t.prototype.attachSegEls=function(t,e){},t.prototype.reportEls=function(t,e){this.elsByFill[t]?this.elsByFill[t]=this.elsByFill[t].add(e):this.elsByFill[t]=i(e)},t}();e.default=o},function(t,e,n){Object.defineProperty(e,"__esModule",{value:!0});var i=n(13),r=n(36),o=n(6),s=function(){function t(t,e){this.view=t._getView(),this.component=t,this.eventRenderer=e}return t.prototype.renderComponentFootprint=function(t){this.renderEventFootprints([this.fabricateEventFootprint(t)])},t.prototype.renderEventDraggingFootprints=function(t,e,n){this.renderEventFootprints(t,e,"fc-dragging",n?null:this.view.opt("dragOpacity"))},t.prototype.renderEventResizingFootprints=function(t,e,n){this.renderEventFootprints(t,e,"fc-resizing")},t.prototype.renderEventFootprints=function(t,e,n,i){var r,o=this.component.eventFootprintsToSegs(t),s="fc-helper "+(n||"");for(o=this.eventRenderer.renderFgSegEls(o),r=0;r<o.length;r++)o[r].el.addClass(s);if(null!=i)for(r=0;r<o.length;r++)o[r].el.css("opacity",i);this.helperEls=this.renderSegs(o,e)},t.prototype.renderSegs=function(t,e){},t.prototype.unrender=function(){this.helperEls&&(this.helperEls.remove(),this.helperEls=null)},t.prototype.fabricateEventFootprint=function(t){var e,n=this.view.calendar,s=n.footprintToDateProfile(t),a=new i.default(new o.default(n));return a.dateProfile=s,e=a.buildInstance(),new r.default(t,a,e)},t}();e.default=s},function(t,e,n){Object.defineProperty(e,"__esModule",{value:!0});var i=n(2),r=n(21),o=n(15),s=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return i.__extends(e,t),e.prototype.bindToEl=function(t){var e=this.component;e.bindSegHandlerToEl(t,"click",this.handleClick.bind(this)),e.bindSegHandlerToEl(t,"mouseenter",this.handleMouseover.bind(this)),e.bindSegHandlerToEl(t,"mouseleave",this.handleMouseout.bind(this))},e.prototype.handleClick=function(t,e){!1===this.component.publiclyTrigger("eventClick",{context:t.el[0],args:[t.footprint.getEventLegacy(),e,this.view]})&&e.preventDefault()},e.prototype.handleMouseover=function(t,e){r.default.get().shouldIgnoreMouse()||this.mousedOverSeg||(this.mousedOverSeg=t,this.view.isEventDefResizable(t.footprint.eventDef)&&t.el.addClass("fc-allow-mouse-resize"),this.component.publiclyTrigger("eventMouseover",{context:t.el[0],args:[t.footprint.getEventLegacy(),e,this.view]}))},e.prototype.handleMouseout=function(t,e){this.mousedOverSeg&&(this.mousedOverSeg=null,this.view.isEventDefResizable(t.footprint.eventDef)&&t.el.removeClass("fc-allow-mouse-resize"),this.component.publiclyTrigger("eventMouseout",{context:t.el[0],args:[t.footprint.getEventLegacy(),e||{},this.view]}))},e.prototype.end=function(){this.mousedOverSeg&&this.handleMouseout(this.mousedOverSeg)},e}(o.default);e.default=s},function(t,e,n){Object.defineProperty(e,"__esModule",{value:!0});var i=n(2),r=n(14),o=n(245),s=n(225),a=n(59),l=n(224),u=n(223),d=n(222),c=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return i.__extends(e,t),e}(r.default);e.default=c,c.prototype.dateClickingClass=o.default,c.prototype.dateSelectingClass=s.default,c.prototype.eventPointingClass=a.default,c.prototype.eventDraggingClass=l.default,c.prototype.eventResizingClass=u.default,c.prototype.externalDroppingClass=d.default},function(t,e,n){Object.defineProperty(e,"__esModule",{value:!0});var i=n(2),r=n(3),o=n(4),s=n(53),a=n(249),l=n(5),u=n(12),d=n(36),c=n(56),p=n(60),h=n(40),f=n(55),g=n(250),v=n(251),y=n(252),m=function(t){function e(e){var n=t.call(this,e)||this;return n.cellWeekNumbersVisible=!1,n.bottomCoordPadding=0,n.isRigid=!1,n.hasAllDayBusinessHours=!0,n}return i.__extends(e,t),e.prototype.componentFootprintToSegs=function(t){var e,n,i=this.sliceRangeByRow(t.unzonedRange);for(e=0;e<i.length;e++)n=i[e],this.isRTL?(n.leftCol=this.daysPerRow-1-n.lastRowDayIndex,n.rightCol=this.daysPerRow-1-n.firstRowDayIndex):(n.leftCol=n.firstRowDayIndex,n.rightCol=n.lastRowDayIndex);return i},e.prototype.renderDates=function(t){this.dateProfile=t,this.updateDayTable(),this.renderGrid()},e.prototype.unrenderDates=function(){this.removeSegPopover()},e.prototype.renderGrid=function(){var t,e,n=this.view,i=this.rowCnt,r=this.colCnt,o="";for(this.headContainerEl&&this.headContainerEl.html(this.renderHeadHtml()),t=0;t<i;t++)o+=this.renderDayRowHtml(t,this.isRigid);for(this.el.html(o),this.rowEls=this.el.find(".fc-row"),this.cellEls=this.el.find(".fc-day, .fc-disabled-day"),this.rowCoordCache=new s.default({els:this.rowEls,isVertical:!0}),this.colCoordCache=new s.default({els:this.cellEls.slice(0,this.colCnt),isHorizontal:!0}),t=0;t<i;t++)for(e=0;e<r;e++)this.publiclyTrigger("dayRender",{context:n,args:[this.getCellDate(t,e),this.getCellEl(t,e),n]})},e.prototype.renderDayRowHtml=function(t,e){var n=this.view.calendar.theme,i=["fc-row","fc-week",n.getClass("dayRow")];return e&&i.push("fc-rigid"),'<div class="'+i.join(" ")+'"><div class="fc-bg"><table class="'+n.getClass("tableGrid")+'">'+this.renderBgTrHtml(t)+'</table></div><div class="fc-content-skeleton"><table>'+(this.getIsNumbersVisible()?"<thead>"+this.renderNumberTrHtml(t)+"</thead>":"")+"</table></div></div>"},e.prototype.getIsNumbersVisible=function(){return this.getIsDayNumbersVisible()||this.cellWeekNumbersVisible},e.prototype.getIsDayNumbersVisible=function(){return this.rowCnt>1},e.prototype.renderNumberTrHtml=function(t){return"<tr>"+(this.isRTL?"":this.renderNumberIntroHtml(t))+this.renderNumberCellsHtml(t)+(this.isRTL?this.renderNumberIntroHtml(t):"")+"</tr>"},e.prototype.renderNumberIntroHtml=function(t){return this.renderIntroHtml()},e.prototype.renderNumberCellsHtml=function(t){var e,n,i=[];for(e=0;e<this.colCnt;e++)n=this.getCellDate(t,e),i.push(this.renderNumberCellHtml(n));return i.join("")},e.prototype.renderNumberCellHtml=function(t){var e,n,i=this.view,r="",o=this.dateProfile.activeUnzonedRange.containsDate(t),s=this.getIsDayNumbersVisible()&&o;return s||this.cellWeekNumbersVisible?(e=this.getDayClasses(t),e.unshift("fc-day-top"),this.cellWeekNumbersVisible&&(n="ISO"===t._locale._fullCalendar_weekCalc?1:t._locale.firstDayOfWeek()),r+='<td class="'+e.join(" ")+'"'+(o?' data-date="'+t.format()+'"':"")+">",this.cellWeekNumbersVisible&&t.day()===n&&(r+=i.buildGotoAnchorHtml({date:t,type:"week"},{class:"fc-week-number"},t.format("w"))),s&&(r+=i.buildGotoAnchorHtml(t,{class:"fc-day-number"},t.format("D"))),r+="</td>"):"<td/>"},e.prototype.prepareHits=function(){this.colCoordCache.build(),this.rowCoordCache.build(),this.rowCoordCache.bottoms[this.rowCnt-1]+=this.bottomCoordPadding},e.prototype.releaseHits=function(){this.colCoordCache.clear(),this.rowCoordCache.clear()},e.prototype.queryHit=function(t,e){if(this.colCoordCache.isLeftInBounds(t)&&this.rowCoordCache.isTopInBounds(e)){var n=this.colCoordCache.getHorizontalIndex(t),i=this.rowCoordCache.getVerticalIndex(e);if(null!=i&&null!=n)return this.getCellHit(i,n)}},e.prototype.getHitFootprint=function(t){var e=this.getCellRange(t.row,t.col);return new u.default(new l.default(e.start,e.end),!0)},e.prototype.getHitEl=function(t){return this.getCellEl(t.row,t.col)},e.prototype.getCellHit=function(t,e){return{row:t,col:e,component:this,left:this.colCoordCache.getLeftOffset(e),right:this.colCoordCache.getRightOffset(e),top:this.rowCoordCache.getTopOffset(t),bottom:this.rowCoordCache.getBottomOffset(t)}},e.prototype.getCellEl=function(t,e){return this.cellEls.eq(t*this.colCnt+e)},e.prototype.executeEventUnrender=function(){this.removeSegPopover(),t.prototype.executeEventUnrender.call(this)},e.prototype.getOwnEventSegs=function(){
return t.prototype.getOwnEventSegs.call(this).concat(this.popoverSegs||[])},e.prototype.renderDrag=function(t,e,n){var i;for(i=0;i<t.length;i++)this.renderHighlight(t[i].componentFootprint);if(t.length&&e&&e.component!==this)return this.helperRenderer.renderEventDraggingFootprints(t,e,n),!0},e.prototype.unrenderDrag=function(){this.unrenderHighlight(),this.helperRenderer.unrender()},e.prototype.renderEventResize=function(t,e,n){var i;for(i=0;i<t.length;i++)this.renderHighlight(t[i].componentFootprint);this.helperRenderer.renderEventResizingFootprints(t,e,n)},e.prototype.unrenderEventResize=function(){this.unrenderHighlight(),this.helperRenderer.unrender()},e.prototype.removeSegPopover=function(){this.segPopover&&this.segPopover.hide()},e.prototype.limitRows=function(t){var e,n,i=this.eventRenderer.rowStructs||[];for(e=0;e<i.length;e++)this.unlimitRow(e),!1!==(n=!!t&&("number"==typeof t?t:this.computeRowLevelLimit(e)))&&this.limitRow(e,n)},e.prototype.computeRowLevelLimit=function(t){function e(t,e){o=Math.max(o,r(e).outerHeight())}var n,i,o,s=this.rowEls.eq(t),a=s.height(),l=this.eventRenderer.rowStructs[t].tbodyEl.children();for(n=0;n<l.length;n++)if(i=l.eq(n).removeClass("fc-limited"),o=0,i.find("> td > :first-child").each(e),i.position().top+o>a)return n;return!1},e.prototype.limitRow=function(t,e){var n,i,o,s,a,l,u,d,c,p,h,f,g,v,y,m=this,b=this.eventRenderer.rowStructs[t],w=[],D=0,E=function(n){for(;D<n;)l=m.getCellSegs(t,D,e),l.length&&(c=i[e-1][D],y=m.renderMoreLink(t,D,l),v=r("<div/>").append(y),c.append(v),w.push(v[0])),D++};if(e&&e<b.segLevels.length){for(n=b.segLevels[e-1],i=b.cellMatrix,o=b.tbodyEl.children().slice(e).addClass("fc-limited").get(),s=0;s<n.length;s++){for(a=n[s],E(a.leftCol),d=[],u=0;D<=a.rightCol;)l=this.getCellSegs(t,D,e),d.push(l),u+=l.length,D++;if(u){for(c=i[e-1][a.leftCol],p=c.attr("rowspan")||1,h=[],f=0;f<d.length;f++)g=r('<td class="fc-more-cell"/>').attr("rowspan",p),l=d[f],y=this.renderMoreLink(t,a.leftCol+f,[a].concat(l)),v=r("<div/>").append(y),g.append(v),h.push(g[0]),w.push(g[0]);c.addClass("fc-limited").after(r(h)),o.push(c[0])}}E(this.colCnt),b.moreEls=r(w),b.limitedEls=r(o)}},e.prototype.unlimitRow=function(t){var e=this.eventRenderer.rowStructs[t];e.moreEls&&(e.moreEls.remove(),e.moreEls=null),e.limitedEls&&(e.limitedEls.removeClass("fc-limited"),e.limitedEls=null)},e.prototype.renderMoreLink=function(t,e,n){var i=this,o=this.view;return r('<a class="fc-more"/>').text(this.getMoreLinkText(n.length)).on("click",function(s){var a=i.opt("eventLimitClick"),l=i.getCellDate(t,e),u=r(s.currentTarget),d=i.getCellEl(t,e),c=i.getCellSegs(t,e),p=i.resliceDaySegs(c,l),h=i.resliceDaySegs(n,l);"function"==typeof a&&(a=i.publiclyTrigger("eventLimitClick",{context:o,args:[{date:l.clone(),dayEl:d,moreEl:u,segs:p,hiddenSegs:h},s,o]})),"popover"===a?i.showSegPopover(t,e,u,p):"string"==typeof a&&o.calendar.zoomTo(l,a)})},e.prototype.showSegPopover=function(t,e,n,i){var r,o,s=this,l=this.view,u=n.parent();r=1===this.rowCnt?l.el:this.rowEls.eq(t),o={className:"fc-more-popover "+l.calendar.theme.getClass("popover"),content:this.renderSegPopoverContent(t,e,i),parentEl:l.el,top:r.offset().top,autoHide:!0,viewportConstrain:this.opt("popoverViewportConstrain"),hide:function(){s.popoverSegs&&s.triggerBeforeEventSegsDestroyed(s.popoverSegs),s.segPopover.removeElement(),s.segPopover=null,s.popoverSegs=null}},this.isRTL?o.right=u.offset().left+u.outerWidth()+1:o.left=u.offset().left-1,this.segPopover=new a.default(o),this.segPopover.show(),this.bindAllSegHandlersToEl(this.segPopover.el),this.triggerAfterEventSegsRendered(i)},e.prototype.renderSegPopoverContent=function(t,e,n){var i,s=this.view,a=s.calendar.theme,l=this.getCellDate(t,e).format(this.opt("dayPopoverFormat")),u=r('<div class="fc-header '+a.getClass("popoverHeader")+'"><span class="fc-close '+a.getIconClass("close")+'"></span><span class="fc-title">'+o.htmlEscape(l)+'</span><div class="fc-clear"/></div><div class="fc-body '+a.getClass("popoverContent")+'"><div class="fc-event-container"></div></div>'),d=u.find(".fc-event-container");for(n=this.eventRenderer.renderFgSegEls(n,!0),this.popoverSegs=n,i=0;i<n.length;i++)this.hitsNeeded(),n[i].hit=this.getCellHit(t,e),this.hitsNotNeeded(),d.append(n[i].el);return u},e.prototype.resliceDaySegs=function(t,e){var n,i,o,s=e.clone(),a=s.clone().add(1,"days"),c=new l.default(s,a),p=[];for(n=0;n<t.length;n++)i=t[n],(o=i.footprint.componentFootprint.unzonedRange.intersect(c))&&p.push(r.extend({},i,{footprint:new d.default(new u.default(o,i.footprint.componentFootprint.isAllDay),i.footprint.eventDef,i.footprint.eventInstance),isStart:i.isStart&&o.isStart,isEnd:i.isEnd&&o.isEnd}));return this.eventRenderer.sortEventSegs(p),p},e.prototype.getMoreLinkText=function(t){var e=this.opt("eventLimitText");return"function"==typeof e?e(t):"+"+t+" "+e},e.prototype.getCellSegs=function(t,e,n){for(var i,r=this.eventRenderer.rowStructs[t].segMatrix,o=n||0,s=[];o<r.length;)i=r[o][e],i&&s.push(i),o++;return s},e}(h.default);e.default=m,m.prototype.eventRendererClass=g.default,m.prototype.businessHourRendererClass=c.default,m.prototype.helperRendererClass=v.default,m.prototype.fillRendererClass=y.default,p.default.mixInto(m),f.default.mixInto(m)},function(t,e,n){function i(t){return function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.colWeekNumbersVisible=!1,e}return r.__extends(e,t),e.prototype.renderHeadIntroHtml=function(){var t=this.view;return this.colWeekNumbersVisible?'<th class="fc-week-number '+t.calendar.theme.getClass("widgetHeader")+'" '+t.weekNumberStyleAttr()+"><span>"+s.htmlEscape(this.opt("weekNumberTitle"))+"</span></th>":""},e.prototype.renderNumberIntroHtml=function(t){var e=this.view,n=this.getCellDate(t,0);return this.colWeekNumbersVisible?'<td class="fc-week-number" '+e.weekNumberStyleAttr()+">"+e.buildGotoAnchorHtml({date:n,type:"week",forceOff:1===this.colCnt},n.format("w"))+"</td>":""},e.prototype.renderBgIntroHtml=function(){var t=this.view;return this.colWeekNumbersVisible?'<td class="fc-week-number '+t.calendar.theme.getClass("widgetContent")+'" '+t.weekNumberStyleAttr()+"></td>":""},e.prototype.renderIntroHtml=function(){var t=this.view;return this.colWeekNumbersVisible?'<td class="fc-week-number" '+t.weekNumberStyleAttr()+"></td>":""},e.prototype.getIsNumbersVisible=function(){return d.default.prototype.getIsNumbersVisible.apply(this,arguments)||this.colWeekNumbersVisible},e}(t)}Object.defineProperty(e,"__esModule",{value:!0});var r=n(2),o=n(3),s=n(4),a=n(39),l=n(41),u=n(228),d=n(61),c=function(t){function e(e,n){var i=t.call(this,e,n)||this;return i.dayGrid=i.instantiateDayGrid(),i.dayGrid.isRigid=i.hasRigidRows(),i.opt("weekNumbers")&&(i.opt("weekNumbersWithinDays")?(i.dayGrid.cellWeekNumbersVisible=!0,i.dayGrid.colWeekNumbersVisible=!1):(i.dayGrid.cellWeekNumbersVisible=!1,i.dayGrid.colWeekNumbersVisible=!0)),i.addChild(i.dayGrid),i.scroller=new a.default({overflowX:"hidden",overflowY:"auto"}),i}return r.__extends(e,t),e.prototype.instantiateDayGrid=function(){return new(i(this.dayGridClass))(this)},e.prototype.executeDateRender=function(e){this.dayGrid.breakOnWeeks=/year|month|week/.test(e.currentRangeUnit),t.prototype.executeDateRender.call(this,e)},e.prototype.renderSkeleton=function(){var t,e;this.el.addClass("fc-basic-view").html(this.renderSkeletonHtml()),this.scroller.render(),t=this.scroller.el.addClass("fc-day-grid-container"),e=o('<div class="fc-day-grid" />').appendTo(t),this.el.find(".fc-body > tr > td").append(t),this.dayGrid.headContainerEl=this.el.find(".fc-head-container"),this.dayGrid.setElement(e)},e.prototype.unrenderSkeleton=function(){this.dayGrid.removeElement(),this.scroller.destroy()},e.prototype.renderSkeletonHtml=function(){var t=this.calendar.theme;return'<table class="'+t.getClass("tableGrid")+'">'+(this.opt("columnHeader")?'<thead class="fc-head"><tr><td class="fc-head-container '+t.getClass("widgetHeader")+'">&nbsp;</td></tr></thead>':"")+'<tbody class="fc-body"><tr><td class="'+t.getClass("widgetContent")+'"></td></tr></tbody></table>'},e.prototype.weekNumberStyleAttr=function(){return null!=this.weekNumberWidth?'style="width:'+this.weekNumberWidth+'px"':""},e.prototype.hasRigidRows=function(){var t=this.opt("eventLimit");return t&&"number"!=typeof t},e.prototype.updateSize=function(e,n,i){var r,o,a=this.opt("eventLimit"),l=this.dayGrid.headContainerEl.find(".fc-row");if(!this.dayGrid.rowEls)return void(n||(r=this.computeScrollerHeight(e),this.scroller.setHeight(r)));t.prototype.updateSize.call(this,e,n,i),this.dayGrid.colWeekNumbersVisible&&(this.weekNumberWidth=s.matchCellWidths(this.el.find(".fc-week-number"))),this.scroller.clear(),s.uncompensateScroll(l),this.dayGrid.removeSegPopover(),a&&"number"==typeof a&&this.dayGrid.limitRows(a),r=this.computeScrollerHeight(e),this.setGridHeight(r,n),a&&"number"!=typeof a&&this.dayGrid.limitRows(a),n||(this.scroller.setHeight(r),o=this.scroller.getScrollbarWidths(),(o.left||o.right)&&(s.compensateScroll(l,o),r=this.computeScrollerHeight(e),this.scroller.setHeight(r)),this.scroller.lockOverflow(o))},e.prototype.computeScrollerHeight=function(t){return t-s.subtractInnerElHeight(this.el,this.scroller.el)},e.prototype.setGridHeight=function(t,e){e?s.undistributeHeight(this.dayGrid.rowEls):s.distributeHeight(this.dayGrid.rowEls,t,!0)},e.prototype.computeInitialDateScroll=function(){return{top:0}},e.prototype.queryDateScroll=function(){return{top:this.scroller.getScrollTop()}},e.prototype.applyDateScroll=function(t){void 0!==t.top&&this.scroller.setScrollTop(t.top)},e}(l.default);e.default=c,c.prototype.dateProfileGeneratorClass=u.default,c.prototype.dayGridClass=d.default},,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,function(t,e,n){function i(t,e,n){var i;for(i=0;i<t.length;i++)if(!e(t[i].eventInstance.toLegacy(),n?n.toLegacy():null))return!1;return!0}function r(t,e){var n,i,r,o,s=e.toLegacy();for(n=0;n<t.length;n++){if(i=t[n].eventInstance,r=i.def,!1===(o=r.getOverlap()))return!1;if("function"==typeof o&&!o(i.toLegacy(),s))return!1}return!0}Object.defineProperty(e,"__esModule",{value:!0});var o=n(5),s=n(12),a=n(49),l=n(6),u=n(35),d=function(){function t(t,e){this.eventManager=t,this._calendar=e}return t.prototype.opt=function(t){return this._calendar.opt(t)},t.prototype.isEventInstanceGroupAllowed=function(t){var e,n=t.getEventDef(),i=this.eventRangesToEventFootprints(t.getAllEventRanges()),r=this.getPeerEventInstances(n),o=r.map(u.eventInstanceToEventRange),s=this.eventRangesToEventFootprints(o),a=n.getConstraint(),l=n.getOverlap(),d=this.opt("eventAllow");for(e=0;e<i.length;e++)if(!this.isFootprintAllowed(i[e].componentFootprint,s,a,l,i[e].eventInstance))return!1;if(d)for(e=0;e<i.length;e++)if(!1===d(i[e].componentFootprint.toLegacy(this._calendar),i[e].getEventLegacy()))return!1;return!0},t.prototype.getPeerEventInstances=function(t){return this.eventManager.getEventInstancesWithoutId(t.id)},t.prototype.isSelectionFootprintAllowed=function(t){var e,n=this.eventManager.getEventInstances(),i=n.map(u.eventInstanceToEventRange),r=this.eventRangesToEventFootprints(i);return!!this.isFootprintAllowed(t,r,this.opt("selectConstraint"),this.opt("selectOverlap"))&&(!(e=this.opt("selectAllow"))||!1!==e(t.toLegacy(this._calendar)))},t.prototype.isFootprintAllowed=function(t,e,n,o,s){var a,l;if(null!=n&&(a=this.constraintValToFootprints(n,t.isAllDay),!this.isFootprintWithinConstraints(t,a)))return!1;if(l=this.collectOverlapEventFootprints(e,t),!1===o){if(l.length)return!1}else if("function"==typeof o&&!i(l,o,s))return!1;return!(s&&!r(l,s))},t.prototype.isFootprintWithinConstraints=function(t,e){var n;for(n=0;n<e.length;n++)if(this.footprintContainsFootprint(e[n],t))return!0;return!1},t.prototype.constraintValToFootprints=function(t,e){var n;return"businessHours"===t?this.buildCurrentBusinessFootprints(e):"object"==typeof t?(n=this.parseEventDefToInstances(t),n?this.eventInstancesToFootprints(n):this.parseFootprints(t)):null!=t?(n=this.eventManager.getEventInstancesWithId(t),this.eventInstancesToFootprints(n)):void 0},t.prototype.buildCurrentBusinessFootprints=function(t){var e=this._calendar.view,n=e.get("businessHourGenerator"),i=e.dateProfile.activeUnzonedRange,r=n.buildEventInstanceGroup(t,i);return r?this.eventInstancesToFootprints(r.eventInstances):[]},t.prototype.eventInstancesToFootprints=function(t){var e=t.map(u.eventInstanceToEventRange);return this.eventRangesToEventFootprints(e).map(u.eventFootprintToComponentFootprint)},t.prototype.collectOverlapEventFootprints=function(t,e){var n,i=[];for(n=0;n<t.length;n++)this.footprintsIntersect(e,t[n].componentFootprint)&&i.push(t[n]);return i},t.prototype.parseEventDefToInstances=function(t){var e=this.eventManager,n=a.default.parse(t,new l.default(this._calendar));return!!n&&n.buildInstances(e.currentPeriod.unzonedRange)},t.prototype.eventRangesToEventFootprints=function(t){var e,n=[];for(e=0;e<t.length;e++)n.push.apply(n,this.eventRangeToEventFootprints(t[e]));return n},t.prototype.eventRangeToEventFootprints=function(t){return[u.eventRangeToEventFootprint(t)]},t.prototype.parseFootprints=function(t){var e,n;return t.start&&(e=this._calendar.moment(t.start),e.isValid()||(e=null)),t.end&&(n=this._calendar.moment(t.end),n.isValid()||(n=null)),[new s.default(new o.default(e,n),e&&!e.hasTime()||n&&!n.hasTime())]},t.prototype.footprintContainsFootprint=function(t,e){return t.unzonedRange.containsRange(e.unzonedRange)},t.prototype.footprintsIntersect=function(t,e){return t.unzonedRange.intersectsWith(e.unzonedRange)},t}();e.default=d},function(t,e,n){Object.defineProperty(e,"__esModule",{value:!0});var i=n(2),r=n(4),o=n(14),s=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return i.__extends(e,t),e.defineStandardProps=function(t){var e=this.prototype;e.hasOwnProperty("standardPropMap")||(e.standardPropMap=Object.create(e.standardPropMap)),r.copyOwnProps(t,e.standardPropMap)},e.copyVerbatimStandardProps=function(t,e){var n,i=this.prototype.standardPropMap;for(n in i)null!=t[n]&&!0===i[n]&&(e[n]=t[n])},e.prototype.applyProps=function(t){var e,n=this.standardPropMap,i={},r={};for(e in t)!0===n[e]?this[e]=t[e]:!1===n[e]?i[e]=t[e]:r[e]=t[e];return this.applyMiscProps(r),this.applyManualStandardProps(i)},e.prototype.applyManualStandardProps=function(t){return!0},e.prototype.applyMiscProps=function(t){},e.prototype.isStandardProp=function(t){return t in this.standardPropMap},e}(o.default);e.default=s,s.prototype.standardPropMap={}},function(t,e){Object.defineProperty(e,"__esModule",{value:!0});var n=function(){function t(t,e){this.def=t,this.dateProfile=e}return t.prototype.toLegacy=function(){var t=this.dateProfile,e=this.def.toLegacy();return e.start=t.start.clone(),e.end=t.end?t.end.clone():null,e},t}();e.default=n},function(t,e,n){Object.defineProperty(e,"__esModule",{value:!0});var i=n(2),r=n(3),o=n(0),s=n(34),a=n(209),l=n(17),u=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return i.__extends(e,t),e.prototype.isAllDay=function(){return!this.startTime&&!this.endTime},e.prototype.buildInstances=function(t){for(var e,n,i,r=this.source.calendar,o=t.getStart(),s=t.getEnd(),u=[];o.isBefore(s);)this.dowHash&&!this.dowHash[o.day()]||(e=r.applyTimezone(o),n=e.clone(),i=null,this.startTime?n.time(this.startTime):n.stripTime(),this.endTime&&(i=e.clone().time(this.endTime)),u.push(new a.default(this,new l.default(n,i,r)))),o.add(1,"days");return u},e.prototype.setDow=function(t){this.dowHash||(this.dowHash={});for(var e=0;e<t.length;e++)this.dowHash[t[e]]=!0},e.prototype.clone=function(){var e=t.prototype.clone.call(this);return e.startTime&&(e.startTime=o.duration(this.startTime)),e.endTime&&(e.endTime=o.duration(this.endTime)),this.dowHash&&(e.dowHash=r.extend({},this.dowHash)),e},e}(s.default);e.default=u,u.prototype.applyProps=function(t){var e=s.default.prototype.applyProps.call(this,t);return t.start&&(this.startTime=o.duration(t.start)),t.end&&(this.endTime=o.duration(t.end)),t.dow&&this.setDow(t.dow),e},u.defineStandardProps({start:!1,end:!1,dow:!1})},function(t,e){Object.defineProperty(e,"__esModule",{value:!0});var n=function(){function t(t,e,n){this.unzonedRange=t,this.eventDef=e,n&&(this.eventInstance=n)}return t}();e.default=n},function(t,e,n){Object.defineProperty(e,"__esModule",{value:!0});var i=n(3),r=n(35),o=n(18),s=n(210),a=n(6),l={start:"09:00",end:"17:00",dow:[1,2,3,4,5],rendering:"inverse-background"},u=function(){function t(t,e){this.rawComplexDef=t,this.calendar=e}return t.prototype.buildEventInstanceGroup=function(t,e){var n,i=this.buildEventDefs(t);if(i.length)return n=new o.default(r.eventDefsToEventInstances(i,e)),n.explicitEventDef=i[0],n},t.prototype.buildEventDefs=function(t){var e,n=this.rawComplexDef,r=[],o=!1,s=[];for(!0===n?r=[{}]:i.isPlainObject(n)?r=[n]:i.isArray(n)&&(r=n,o=!0),e=0;e<r.length;e++)o&&!r[e].dow||s.push(this.buildEventDef(t,r[e]));return s},t.prototype.buildEventDef=function(t,e){var n=i.extend({},l,e);return t&&(n.start=null,n.end=null),s.default.parse(n,new a.default(this.calendar))},t}();e.default=u},function(t,e,n){Object.defineProperty(e,"__esModule",{value:!0});var i=n(2),r=n(19),o=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return i.__extends(e,t),e}(r.default);e.default=o,o.prototype.classes={widget:"fc-unthemed",widgetHeader:"fc-widget-header",widgetContent:"fc-widget-content",buttonGroup:"fc-button-group",button:"fc-button",cornerLeft:"fc-corner-left",cornerRight:"fc-corner-right",stateDefault:"fc-state-default",stateActive:"fc-state-active",stateDisabled:"fc-state-disabled",stateHover:"fc-state-hover",stateDown:"fc-state-down",popoverHeader:"fc-widget-header",popoverContent:"fc-widget-content",headerRow:"fc-widget-header",dayRow:"fc-widget-content",listView:"fc-widget-content"},o.prototype.baseIconClass="fc-icon",o.prototype.iconClasses={close:"fc-icon-x",prev:"fc-icon-left-single-arrow",next:"fc-icon-right-single-arrow",prevYear:"fc-icon-left-double-arrow",nextYear:"fc-icon-right-double-arrow"},o.prototype.iconOverrideOption="buttonIcons",o.prototype.iconOverrideCustomButtonOption="icon",o.prototype.iconOverridePrefix="fc-icon-"},function(t,e,n){Object.defineProperty(e,"__esModule",{value:!0});var i=n(2),r=n(19),o=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return i.__extends(e,t),e}(r.default);e.default=o,o.prototype.classes={widget:"ui-widget",widgetHeader:"ui-widget-header",widgetContent:"ui-widget-content",buttonGroup:"fc-button-group",button:"ui-button",cornerLeft:"ui-corner-left",cornerRight:"ui-corner-right",stateDefault:"ui-state-default",stateActive:"ui-state-active",stateDisabled:"ui-state-disabled",stateHover:"ui-state-hover",stateDown:"ui-state-down",today:"ui-state-highlight",popoverHeader:"ui-widget-header",popoverContent:"ui-widget-content",headerRow:"ui-widget-header",dayRow:"ui-widget-content",listView:"ui-widget-content"},o.prototype.baseIconClass="ui-icon",o.prototype.iconClasses={close:"ui-icon-closethick",prev:"ui-icon-circle-triangle-w",next:"ui-icon-circle-triangle-e",prevYear:"ui-icon-seek-prev",nextYear:"ui-icon-seek-next"},o.prototype.iconOverrideOption="themeButtonIcons",o.prototype.iconOverrideCustomButtonOption="themeIcon",o.prototype.iconOverridePrefix="ui-icon-"},function(t,e,n){Object.defineProperty(e,"__esModule",{value:!0});var i=n(2),r=n(3),o=n(20),s=n(6),a=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return i.__extends(e,t),e.parse=function(t,e){var n;return r.isFunction(t.events)?n=t:r.isFunction(t)&&(n={events:t}),!!n&&s.default.parse.call(this,n,e)},e.prototype.fetch=function(t,e,n){var i=this;return this.calendar.pushLoading(),o.default.construct(function(r){i.func.call(i.calendar,t.clone(),e.clone(),n,function(t){i.calendar.popLoading(),r(i.parseEventDefs(t))})})},e.prototype.getPrimitive=function(){return this.func},e.prototype.applyManualStandardProps=function(e){var n=t.prototype.applyManualStandardProps.call(this,e);return this.func=e.events,n},e}(s.default);e.default=a,a.defineStandardProps({events:!1})},function(t,e,n){Object.defineProperty(e,"__esModule",{value:!0});var i=n(2),r=n(3),o=n(4),s=n(20),a=n(6),l=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return i.__extends(e,t),e.parse=function(t,e){var n;return"string"==typeof t.url?n=t:"string"==typeof t&&(n={url:t}),!!n&&a.default.parse.call(this,n,e)},e.prototype.fetch=function(t,n,i){var a=this,l=this.ajaxSettings,u=l.success,d=l.error,c=this.buildRequestParams(t,n,i);return this.calendar.pushLoading(),s.default.construct(function(t,n){r.ajax(r.extend({},e.AJAX_DEFAULTS,l,{url:a.url,data:c,success:function(e,i,s){var l;a.calendar.popLoading(),e?(l=o.applyAll(u,a,[e,i,s]),r.isArray(l)&&(e=l),t(a.parseEventDefs(e))):n()},error:function(t,e,i){a.calendar.popLoading(),o.applyAll(d,a,[t,e,i]),n()}}))})},e.prototype.buildRequestParams=function(t,e,n){var i,o,s,a,l=this.calendar,u=this.ajaxSettings,d={};return i=this.startParam,null==i&&(i=l.opt("startParam")),o=this.endParam,null==o&&(o=l.opt("endParam")),s=this.timezoneParam,null==s&&(s=l.opt("timezoneParam")),a=r.isFunction(u.data)?u.data():u.data||{},r.extend(d,a),d[i]=t.format(),d[o]=e.format(),n&&"local"!==n&&(d[s]=n),d},e.prototype.getPrimitive=function(){return this.url},e.prototype.applyMiscProps=function(t){this.ajaxSettings=t},e.AJAX_DEFAULTS={dataType:"json",cache:!1},e}(a.default);e.default=l,l.defineStandardProps({url:!0,startParam:!0,endParam:!0,timezoneParam:!0})},function(t,e,n){Object.defineProperty(e,"__esModule",{value:!0});var i=n(11),r=function(){function t(){this.q=[],this.isPaused=!1,this.isRunning=!1}return t.prototype.queue=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.q.push.apply(this.q,t),this.tryStart()},t.prototype.pause=function(){this.isPaused=!0},t.prototype.resume=function(){this.isPaused=!1,this.tryStart()},t.prototype.getIsIdle=function(){return!this.isRunning&&!this.isPaused},t.prototype.tryStart=function(){!this.isRunning&&this.canRunNext()&&(this.isRunning=!0,this.trigger("start"),this.runRemaining())},t.prototype.canRunNext=function(){return!this.isPaused&&this.q.length},t.prototype.runRemaining=function(){var t,e,n=this;do{if(t=this.q.shift(),(e=this.runTask(t))&&e.then)return void e.then(function(){n.canRunNext()&&n.runRemaining()})}while(this.canRunNext());this.trigger("stop"),this.isRunning=!1,this.tryStart()},t.prototype.runTask=function(t){return t()},t}();e.default=r,i.default.mixInto(r)},function(t,e,n){Object.defineProperty(e,"__esModule",{value:!0});var i=n(2),r=n(217),o=function(t){function e(e){var n=t.call(this)||this;return n.waitsByNamespace=e||{},n}return i.__extends(e,t),e.prototype.queue=function(t,e,n){var i,r={func:t,namespace:e,type:n};e&&(i=this.waitsByNamespace[e]),this.waitNamespace&&(e===this.waitNamespace&&null!=i?this.delayWait(i):(this.clearWait(),this.tryStart())),this.compoundTask(r)&&(this.waitNamespace||null==i?this.tryStart():this.startWait(e,i))},e.prototype.startWait=function(t,e){this.waitNamespace=t,this.spawnWait(e)},e.prototype.delayWait=function(t){clearTimeout(this.waitId),this.spawnWait(t)},e.prototype.spawnWait=function(t){var e=this;this.waitId=setTimeout(function(){e.waitNamespace=null,e.tryStart()},t)},e.prototype.clearWait=function(){this.waitNamespace&&(clearTimeout(this.waitId),this.waitId=null,this.waitNamespace=null)},e.prototype.canRunNext=function(){if(!t.prototype.canRunNext.call(this))return!1;if(this.waitNamespace){for(var e=this.q,n=0;n<e.length;n++)if(e[n].namespace!==this.waitNamespace)return!0;return!1}return!0},e.prototype.runTask=function(t){t.func()},e.prototype.compoundTask=function(t){var e,n,i=this.q,r=!0;if(t.namespace&&"destroy"===t.type)for(e=i.length-1;e>=0;e--)switch(n=i[e],n.type){case"init":r=!1;case"add":case"remove":i.splice(e,1)}return r&&i.push(t),r},e}(r.default);e.default=o},function(t,e,n){function i(t){var e,n,i,r=[];for(e in t)for(n=t[e].eventInstances,i=0;i<n.length;i++)r.push(n[i].toLegacy());return r}Object.defineProperty(e,"__esModule",{value:!0});var r=n(2),o=n(3),s=n(0),a=n(4),l=n(10),u=n(47),d=n(237),c=n(35),p=function(t){function e(n,i){var r=t.call(this)||this;return r.isRTL=!1,r.hitsNeededDepth=0,r.hasAllDayBusinessHours=!1,r.isDatesRendered=!1,n&&(r.view=n),i&&(r.options=i),r.uid=String(e.guid++),r.childrenByUid={},r.nextDayThreshold=s.duration(r.opt("nextDayThreshold")),r.isRTL=r.opt("isRTL"),r.fillRendererClass&&(r.fillRenderer=new r.fillRendererClass(r)),r.eventRendererClass&&(r.eventRenderer=new r.eventRendererClass(r,r.fillRenderer)),r.helperRendererClass&&r.eventRenderer&&(r.helperRenderer=new r.helperRendererClass(r,r.eventRenderer)),r.businessHourRendererClass&&r.fillRenderer&&(r.businessHourRenderer=new r.businessHourRendererClass(r,r.fillRenderer)),r}return r.__extends(e,t),e.prototype.addChild=function(t){return!this.childrenByUid[t.uid]&&(this.childrenByUid[t.uid]=t,!0)},e.prototype.removeChild=function(t){return!!this.childrenByUid[t.uid]&&(delete this.childrenByUid[t.uid],!0)},e.prototype.updateSize=function(t,e,n){this.callChildren("updateSize",arguments)},e.prototype.opt=function(t){return this._getView().opt(t)},e.prototype.publiclyTrigger=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var n=this._getCalendar();return n.publiclyTrigger.apply(n,t)},e.prototype.hasPublicHandlers=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var n=this._getCalendar();return n.hasPublicHandlers.apply(n,t)},e.prototype.executeDateRender=function(t){this.dateProfile=t,this.renderDates(t),this.isDatesRendered=!0,this.callChildren("executeDateRender",arguments)},e.prototype.executeDateUnrender=function(){this.callChildren("executeDateUnrender",arguments),this.dateProfile=null,this.unrenderDates(),this.isDatesRendered=!1},e.prototype.renderDates=function(t){},e.prototype.unrenderDates=function(){},e.prototype.getNowIndicatorUnit=function(){},e.prototype.renderNowIndicator=function(t){this.callChildren("renderNowIndicator",arguments)},e.prototype.unrenderNowIndicator=function(){this.callChildren("unrenderNowIndicator",arguments)},e.prototype.renderBusinessHours=function(t){this.businessHourRenderer&&this.businessHourRenderer.render(t),this.callChildren("renderBusinessHours",arguments)},e.prototype.unrenderBusinessHours=function(){this.callChildren("unrenderBusinessHours",arguments),this.businessHourRenderer&&this.businessHourRenderer.unrender()},e.prototype.executeEventRender=function(t){this.eventRenderer?(this.eventRenderer.rangeUpdated(),this.eventRenderer.render(t)):this.renderEvents&&this.renderEvents(i(t)),this.callChildren("executeEventRender",arguments)},e.prototype.executeEventUnrender=function(){this.callChildren("executeEventUnrender",arguments),this.eventRenderer?this.eventRenderer.unrender():this.destroyEvents&&this.destroyEvents()},e.prototype.getBusinessHourSegs=function(){var t=this.getOwnBusinessHourSegs();return this.iterChildren(function(e){t.push.apply(t,e.getBusinessHourSegs())}),t},e.prototype.getOwnBusinessHourSegs=function(){return this.businessHourRenderer?this.businessHourRenderer.getSegs():[]},e.prototype.getEventSegs=function(){var t=this.getOwnEventSegs();return this.iterChildren(function(e){t.push.apply(t,e.getEventSegs())}),t},e.prototype.getOwnEventSegs=function(){return this.eventRenderer?this.eventRenderer.getSegs():[]},e.prototype.triggerAfterEventsRendered=function(){this.triggerAfterEventSegsRendered(this.getEventSegs()),this.publiclyTrigger("eventAfterAllRender",{context:this,args:[this]})},e.prototype.triggerAfterEventSegsRendered=function(t){var e=this;this.hasPublicHandlers("eventAfterRender")&&t.forEach(function(t){var n;t.el&&(n=t.footprint.getEventLegacy(),e.publiclyTrigger("eventAfterRender",{context:n,args:[n,t.el,e]}))})},e.prototype.triggerBeforeEventsDestroyed=function(){this.triggerBeforeEventSegsDestroyed(this.getEventSegs())},e.prototype.triggerBeforeEventSegsDestroyed=function(t){var e=this;this.hasPublicHandlers("eventDestroy")&&t.forEach(function(t){var n;t.el&&(n=t.footprint.getEventLegacy(),e.publiclyTrigger("eventDestroy",{context:n,args:[n,t.el,e]}))})},e.prototype.showEventsWithId=function(t){this.getEventSegs().forEach(function(e){e.footprint.eventDef.id===t&&e.el&&e.el.css("visibility","")}),this.callChildren("showEventsWithId",arguments)},e.prototype.hideEventsWithId=function(t){this.getEventSegs().forEach(function(e){e.footprint.eventDef.id===t&&e.el&&e.el.css("visibility","hidden")}),this.callChildren("hideEventsWithId",arguments)},e.prototype.renderDrag=function(t,e,n){var i=!1;return this.iterChildren(function(r){r.renderDrag(t,e,n)&&(i=!0)}),i},e.prototype.unrenderDrag=function(){this.callChildren("unrenderDrag",arguments)},e.prototype.renderEventResize=function(t,e,n){this.callChildren("renderEventResize",arguments)},e.prototype.unrenderEventResize=function(){this.callChildren("unrenderEventResize",arguments)},e.prototype.renderSelectionFootprint=function(t){this.renderHighlight(t),this.callChildren("renderSelectionFootprint",arguments)},e.prototype.unrenderSelection=function(){this.unrenderHighlight(),this.callChildren("unrenderSelection",arguments)},e.prototype.renderHighlight=function(t){this.fillRenderer&&this.fillRenderer.renderFootprint("highlight",t,{getClasses:function(){return["fc-highlight"]}}),this.callChildren("renderHighlight",arguments)},e.prototype.unrenderHighlight=function(){this.fillRenderer&&this.fillRenderer.unrender("highlight"),this.callChildren("unrenderHighlight",arguments)},e.prototype.hitsNeeded=function(){this.hitsNeededDepth++||this.prepareHits(),this.callChildren("hitsNeeded",arguments)},e.prototype.hitsNotNeeded=function(){this.hitsNeededDepth&&!--this.hitsNeededDepth&&this.releaseHits(),this.callChildren("hitsNotNeeded",arguments)},e.prototype.prepareHits=function(){},e.prototype.releaseHits=function(){},e.prototype.queryHit=function(t,e){var n,i,r=this.childrenByUid;for(n in r)if(i=r[n].queryHit(t,e))break;return i},e.prototype.getSafeHitFootprint=function(t){var e=this.getHitFootprint(t);return this.dateProfile.activeUnzonedRange.containsRange(e.unzonedRange)?e:null},e.prototype.getHitFootprint=function(t){},e.prototype.getHitEl=function(t){},e.prototype.eventRangesToEventFootprints=function(t){var e,n=[];for(e=0;e<t.length;e++)n.push.apply(n,this.eventRangeToEventFootprints(t[e]));return n},e.prototype.eventRangeToEventFootprints=function(t){return[c.eventRangeToEventFootprint(t)]},e.prototype.eventFootprintsToSegs=function(t){var e,n=[];for(e=0;e<t.length;e++)n.push.apply(n,this.eventFootprintToSegs(t[e]));return n},e.prototype.eventFootprintToSegs=function(t){var e,n,i,r=t.componentFootprint.unzonedRange;for(e=this.componentFootprintToSegs(t.componentFootprint),n=0;n<e.length;n++)i=e[n],r.isStart||(i.isStart=!1),r.isEnd||(i.isEnd=!1),i.footprint=t;return e},e.prototype.componentFootprintToSegs=function(t){return[]},e.prototype.callChildren=function(t,e){this.iterChildren(function(n){n[t].apply(n,e)})},e.prototype.iterChildren=function(t){var e,n=this.childrenByUid;for(e in n)t(n[e])},e.prototype._getCalendar=function(){var t=this;return t.calendar||t.view.calendar},e.prototype._getView=function(){return this.view},e.prototype._getDateProfile=function(){return this._getView().get("dateProfile")},e.prototype.buildGotoAnchorHtml=function(t,e,n){var i,r,s,u;return o.isPlainObject(t)?(i=t.date,r=t.type,s=t.forceOff):i=t,i=l.default(i),u={date:i.format("YYYY-MM-DD"),type:r||"day"},"string"==typeof e&&(n=e,e=null),e=e?" "+a.attrsToStr(e):"",n=n||"",!s&&this.opt("navLinks")?"<a"+e+' data-goto="'+a.htmlEscape(JSON.stringify(u))+'">'+n+"</a>":"<span"+e+">"+n+"</span>"},e.prototype.getAllDayHtml=function(){return this.opt("allDayHtml")||a.htmlEscape(this.opt("allDayText"))},e.prototype.getDayClasses=function(t,e){var n,i=this._getView(),r=[]
;return this.dateProfile.activeUnzonedRange.containsDate(t)?(r.push("fc-"+a.dayIDs[t.day()]),i.isDateInOtherMonth(t,this.dateProfile)&&r.push("fc-other-month"),n=i.calendar.getNow(),t.isSame(n,"day")?(r.push("fc-today"),!0!==e&&r.push(i.calendar.theme.getClass("today"))):t<n?r.push("fc-past"):r.push("fc-future")):r.push("fc-disabled-day"),r},e.prototype.formatRange=function(t,e,n,i){var r=t.end;return e&&(r=r.clone().subtract(1)),u.formatRange(t.start,r,n,i,this.isRTL)},e.prototype.currentRangeAs=function(t){return this._getDateProfile().currentUnzonedRange.as(t)},e.prototype.computeDayRange=function(t){var e=this._getCalendar(),n=e.msToUtcMoment(t.startMs,!0),i=e.msToUtcMoment(t.endMs),r=+i.time(),o=i.clone().stripTime();return r&&r>=this.nextDayThreshold&&o.add(1,"days"),o<=n&&(o=n.clone().add(1,"days")),{start:n,end:o}},e.prototype.isMultiDayRange=function(t){var e=this.computeDayRange(t);return e.end.diff(e.start,"days")>1},e.guid=0,e}(d.default);e.default=p},function(t,e,n){function i(t,e){return null==e?t:r.isFunction(e)?t.filter(e):(e+="",t.filter(function(t){return t.id==e||t._id===e}))}Object.defineProperty(e,"__esModule",{value:!0});var r=n(3),o=n(0),s=n(4),a=n(32),l=n(238),u=n(21),d=n(11),c=n(7),p=n(239),h=n(240),f=n(241),g=n(207),v=n(31),y=n(10),m=n(5),b=n(12),w=n(17),D=n(242),E=n(212),S=n(38),C=n(49),R=n(13),T=n(37),M=n(6),I=n(51),H=function(){function t(t,e){this.loadingLevel=0,this.ignoreUpdateViewSize=0,this.freezeContentHeightDepth=0,u.default.needed(),this.el=t,this.viewsByType={},this.optionsManager=new h.default(this,e),this.viewSpecManager=new f.default(this.optionsManager,this),this.initMomentInternals(),this.initCurrentDate(),this.initEventManager(),this.constraints=new g.default(this.eventManager,this),this.constructed()}return t.prototype.constructed=function(){},t.prototype.getView=function(){return this.view},t.prototype.publiclyTrigger=function(t,e){var n,i,o=this.opt(t);if(r.isPlainObject(e)?(n=e.context,i=e.args):r.isArray(e)&&(i=e),null==n&&(n=this.el[0]),i||(i=[]),this.triggerWith(t,n,i),o)return o.apply(n,i)},t.prototype.hasPublicHandlers=function(t){return this.hasHandlers(t)||this.opt(t)},t.prototype.option=function(t,e){var n;if("string"==typeof t){if(void 0===e)return this.optionsManager.get(t);n={},n[t]=e,this.optionsManager.add(n)}else"object"==typeof t&&this.optionsManager.add(t)},t.prototype.opt=function(t){return this.optionsManager.get(t)},t.prototype.instantiateView=function(t){var e=this.viewSpecManager.getViewSpec(t);if(!e)throw new Error('View type "'+t+'" is not valid');return new e.class(this,e)},t.prototype.isValidViewType=function(t){return Boolean(this.viewSpecManager.getViewSpec(t))},t.prototype.changeView=function(t,e){e&&(e.start&&e.end?this.optionsManager.recordOverrides({visibleRange:e}):this.currentDate=this.moment(e).stripZone()),this.renderView(t)},t.prototype.zoomTo=function(t,e){var n;e=e||"day",n=this.viewSpecManager.getViewSpec(e)||this.viewSpecManager.getUnitViewSpec(e),this.currentDate=t.clone(),this.renderView(n?n.type:null)},t.prototype.initCurrentDate=function(){var t=this.opt("defaultDate");this.currentDate=null!=t?this.moment(t).stripZone():this.getNow()},t.prototype.prev=function(){var t=this.view,e=t.dateProfileGenerator.buildPrev(t.get("dateProfile"));e.isValid&&(this.currentDate=e.date,this.renderView())},t.prototype.next=function(){var t=this.view,e=t.dateProfileGenerator.buildNext(t.get("dateProfile"));e.isValid&&(this.currentDate=e.date,this.renderView())},t.prototype.prevYear=function(){this.currentDate.add(-1,"years"),this.renderView()},t.prototype.nextYear=function(){this.currentDate.add(1,"years"),this.renderView()},t.prototype.today=function(){this.currentDate=this.getNow(),this.renderView()},t.prototype.gotoDate=function(t){this.currentDate=this.moment(t).stripZone(),this.renderView()},t.prototype.incrementDate=function(t){this.currentDate.add(o.duration(t)),this.renderView()},t.prototype.getDate=function(){return this.applyTimezone(this.currentDate)},t.prototype.pushLoading=function(){this.loadingLevel++||this.publiclyTrigger("loading",[!0,this.view])},t.prototype.popLoading=function(){--this.loadingLevel||this.publiclyTrigger("loading",[!1,this.view])},t.prototype.render=function(){this.contentEl?this.elementVisible()&&(this.calcSize(),this.updateViewSize()):this.initialRender()},t.prototype.initialRender=function(){var t=this,e=this.el;e.addClass("fc"),e.on("click.fc","a[data-goto]",function(e){var n=r(e.currentTarget),i=n.data("goto"),o=t.moment(i.date),a=i.type,l=t.view.opt("navLink"+s.capitaliseFirstLetter(a)+"Click");"function"==typeof l?l(o,e):("string"==typeof l&&(a=l),t.zoomTo(o,a))}),this.optionsManager.watch("settingTheme",["?theme","?themeSystem"],function(n){var i=I.getThemeSystemClass(n.themeSystem||n.theme),r=new i(t.optionsManager),o=r.getClass("widget");t.theme=r,o&&e.addClass(o)},function(){var n=t.theme.getClass("widget");t.theme=null,n&&e.removeClass(n)}),this.optionsManager.watch("settingBusinessHourGenerator",["?businessHours"],function(e){t.businessHourGenerator=new E.default(e.businessHours,t),t.view&&t.view.set("businessHourGenerator",t.businessHourGenerator)},function(){t.businessHourGenerator=null}),this.optionsManager.watch("applyingDirClasses",["?isRTL","?locale"],function(t){e.toggleClass("fc-ltr",!t.isRTL),e.toggleClass("fc-rtl",t.isRTL)}),this.contentEl=r("<div class='fc-view-container'/>").prependTo(e),this.initToolbars(),this.renderHeader(),this.renderFooter(),this.renderView(this.opt("defaultView")),this.opt("handleWindowResize")&&r(window).resize(this.windowResizeProxy=s.debounce(this.windowResize.bind(this),this.opt("windowResizeDelay")))},t.prototype.destroy=function(){this.view&&this.clearView(),this.toolbarsManager.proxyCall("removeElement"),this.contentEl.remove(),this.el.removeClass("fc fc-ltr fc-rtl"),this.optionsManager.unwatch("settingTheme"),this.optionsManager.unwatch("settingBusinessHourGenerator"),this.el.off(".fc"),this.windowResizeProxy&&(r(window).unbind("resize",this.windowResizeProxy),this.windowResizeProxy=null),u.default.unneeded()},t.prototype.elementVisible=function(){return this.el.is(":visible")},t.prototype.bindViewHandlers=function(t){var e=this;t.watch("titleForCalendar",["title"],function(n){t===e.view&&e.setToolbarsTitle(n.title)}),t.watch("dateProfileForCalendar",["dateProfile"],function(n){t===e.view&&(e.currentDate=n.dateProfile.date,e.updateToolbarButtons(n.dateProfile))})},t.prototype.unbindViewHandlers=function(t){t.unwatch("titleForCalendar"),t.unwatch("dateProfileForCalendar")},t.prototype.renderView=function(t){var e,n=this.view;this.freezeContentHeight(),n&&t&&n.type!==t&&this.clearView(),!this.view&&t&&(e=this.view=this.viewsByType[t]||(this.viewsByType[t]=this.instantiateView(t)),this.bindViewHandlers(e),e.startBatchRender(),e.setElement(r("<div class='fc-view fc-"+t+"-view' />").appendTo(this.contentEl)),this.toolbarsManager.proxyCall("activateButton",t)),this.view&&(this.view.get("businessHourGenerator")!==this.businessHourGenerator&&this.view.set("businessHourGenerator",this.businessHourGenerator),this.view.setDate(this.currentDate),e&&e.stopBatchRender()),this.thawContentHeight()},t.prototype.clearView=function(){var t=this.view;this.toolbarsManager.proxyCall("deactivateButton",t.type),this.unbindViewHandlers(t),t.removeElement(),t.unsetDate(),this.view=null},t.prototype.reinitView=function(){var t=this.view,e=t.queryScroll();this.freezeContentHeight(),this.clearView(),this.calcSize(),this.renderView(t.type),this.view.applyScroll(e),this.thawContentHeight()},t.prototype.getSuggestedViewHeight=function(){return null==this.suggestedViewHeight&&this.calcSize(),this.suggestedViewHeight},t.prototype.isHeightAuto=function(){return"auto"===this.opt("contentHeight")||"auto"===this.opt("height")},t.prototype.updateViewSize=function(t){void 0===t&&(t=!1);var e,n=this.view;if(!this.ignoreUpdateViewSize&&n)return t&&(this.calcSize(),e=n.queryScroll()),this.ignoreUpdateViewSize++,n.updateSize(this.getSuggestedViewHeight(),this.isHeightAuto(),t),this.ignoreUpdateViewSize--,t&&n.applyScroll(e),!0},t.prototype.calcSize=function(){this.elementVisible()&&this._calcSize()},t.prototype._calcSize=function(){var t=this.opt("contentHeight"),e=this.opt("height");this.suggestedViewHeight="number"==typeof t?t:"function"==typeof t?t():"number"==typeof e?e-this.queryToolbarsHeight():"function"==typeof e?e()-this.queryToolbarsHeight():"parent"===e?this.el.parent().height()-this.queryToolbarsHeight():Math.round(this.contentEl.width()/Math.max(this.opt("aspectRatio"),.5))},t.prototype.windowResize=function(t){t.target===window&&this.view&&this.view.isDatesRendered&&this.updateViewSize(!0)&&this.publiclyTrigger("windowResize",[this.view])},t.prototype.freezeContentHeight=function(){this.freezeContentHeightDepth++||this.forceFreezeContentHeight()},t.prototype.forceFreezeContentHeight=function(){this.contentEl.css({width:"100%",height:this.contentEl.height(),overflow:"hidden"})},t.prototype.thawContentHeight=function(){this.freezeContentHeightDepth--,this.contentEl.css({width:"",height:"",overflow:""}),this.freezeContentHeightDepth&&this.forceFreezeContentHeight()},t.prototype.initToolbars=function(){this.header=new p.default(this,this.computeHeaderOptions()),this.footer=new p.default(this,this.computeFooterOptions()),this.toolbarsManager=new l.default([this.header,this.footer])},t.prototype.computeHeaderOptions=function(){return{extraClasses:"fc-header-toolbar",layout:this.opt("header")}},t.prototype.computeFooterOptions=function(){return{extraClasses:"fc-footer-toolbar",layout:this.opt("footer")}},t.prototype.renderHeader=function(){var t=this.header;t.setToolbarOptions(this.computeHeaderOptions()),t.render(),t.el&&this.el.prepend(t.el)},t.prototype.renderFooter=function(){var t=this.footer;t.setToolbarOptions(this.computeFooterOptions()),t.render(),t.el&&this.el.append(t.el)},t.prototype.setToolbarsTitle=function(t){this.toolbarsManager.proxyCall("updateTitle",t)},t.prototype.updateToolbarButtons=function(t){var e=this.getNow(),n=this.view,i=n.dateProfileGenerator.build(e),r=n.dateProfileGenerator.buildPrev(n.get("dateProfile")),o=n.dateProfileGenerator.buildNext(n.get("dateProfile"));this.toolbarsManager.proxyCall(i.isValid&&!t.currentUnzonedRange.containsDate(e)?"enableButton":"disableButton","today"),this.toolbarsManager.proxyCall(r.isValid?"enableButton":"disableButton","prev"),this.toolbarsManager.proxyCall(o.isValid?"enableButton":"disableButton","next")},t.prototype.queryToolbarsHeight=function(){return this.toolbarsManager.items.reduce(function(t,e){return t+(e.el?e.el.outerHeight(!0):0)},0)},t.prototype.select=function(t,e){this.view.select(this.buildSelectFootprint.apply(this,arguments))},t.prototype.unselect=function(){this.view&&this.view.unselect()},t.prototype.buildSelectFootprint=function(t,e){var n,i=this.moment(t).stripZone();return n=e?this.moment(e).stripZone():i.hasTime()?i.clone().add(this.defaultTimedEventDuration):i.clone().add(this.defaultAllDayEventDuration),new b.default(new m.default(i,n),!i.hasTime())},t.prototype.initMomentInternals=function(){var t=this;this.defaultAllDayEventDuration=o.duration(this.opt("defaultAllDayEventDuration")),this.defaultTimedEventDuration=o.duration(this.opt("defaultTimedEventDuration")),this.optionsManager.watch("buildingMomentLocale",["?locale","?monthNames","?monthNamesShort","?dayNames","?dayNamesShort","?firstDay","?weekNumberCalculation"],function(e){var n,i=e.weekNumberCalculation,r=e.firstDay;"iso"===i&&(i="ISO");var o=Object.create(v.getMomentLocaleData(e.locale));e.monthNames&&(o._months=e.monthNames),e.monthNamesShort&&(o._monthsShort=e.monthNamesShort),e.dayNames&&(o._weekdays=e.dayNames),e.dayNamesShort&&(o._weekdaysShort=e.dayNamesShort),null==r&&"ISO"===i&&(r=1),null!=r&&(n=Object.create(o._week),n.dow=r,o._week=n),"ISO"!==i&&"local"!==i&&"function"!=typeof i||(o._fullCalendar_weekCalc=i),t.localeData=o,t.currentDate&&t.localizeMoment(t.currentDate)})},t.prototype.moment=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var n;return"local"===this.opt("timezone")?(n=y.default.apply(null,t),n.hasTime()&&n.local()):n="UTC"===this.opt("timezone")?y.default.utc.apply(null,t):y.default.parseZone.apply(null,t),this.localizeMoment(n),n},t.prototype.msToMoment=function(t,e){var n=y.default.utc(t);return e?n.stripTime():n=this.applyTimezone(n),this.localizeMoment(n),n},t.prototype.msToUtcMoment=function(t,e){var n=y.default.utc(t);return e&&n.stripTime(),this.localizeMoment(n),n},t.prototype.localizeMoment=function(t){t._locale=this.localeData},t.prototype.getIsAmbigTimezone=function(){return"local"!==this.opt("timezone")&&"UTC"!==this.opt("timezone")},t.prototype.applyTimezone=function(t){if(!t.hasTime())return t.clone();var e,n=this.moment(t.toArray()),i=t.time().asMilliseconds()-n.time().asMilliseconds();return i&&(e=n.clone().add(i),t.time().asMilliseconds()-e.time().asMilliseconds()==0&&(n=e)),n},t.prototype.footprintToDateProfile=function(t,e){void 0===e&&(e=!1);var n,i=y.default.utc(t.unzonedRange.startMs);return e||(n=y.default.utc(t.unzonedRange.endMs)),t.isAllDay?(i.stripTime(),n&&n.stripTime()):(i=this.applyTimezone(i),n&&(n=this.applyTimezone(n))),new w.default(i,n,this)},t.prototype.getNow=function(){var t=this.opt("now");return"function"==typeof t&&(t=t()),this.moment(t).stripZone()},t.prototype.humanizeDuration=function(t){return t.locale(this.opt("locale")).humanize()},t.prototype.parseUnzonedRange=function(t){var e=null,n=null;return t.start&&(e=this.moment(t.start).stripZone()),t.end&&(n=this.moment(t.end).stripZone()),e||n?e&&n&&n.isBefore(e)?null:new m.default(e,n):null},t.prototype.initEventManager=function(){var t=this,e=new D.default(this),n=this.opt("eventSources")||[],i=this.opt("events");this.eventManager=e,i&&n.unshift(i),e.on("release",function(e){t.trigger("eventsReset",e)}),e.freeze(),n.forEach(function(n){var i=S.default.parse(n,t);i&&e.addSource(i)}),e.thaw()},t.prototype.requestEvents=function(t,e){return this.eventManager.requestEvents(t,e,this.opt("timezone"),!this.opt("lazyFetching"))},t.prototype.getEventEnd=function(t){return t.end?t.end.clone():this.getDefaultEventEnd(t.allDay,t.start)},t.prototype.getDefaultEventEnd=function(t,e){var n=e.clone();return t?n.stripTime().add(this.defaultAllDayEventDuration):n.add(this.defaultTimedEventDuration),this.getIsAmbigTimezone()&&n.stripZone(),n},t.prototype.rerenderEvents=function(){this.view.flash("displayingEvents")},t.prototype.refetchEvents=function(){this.eventManager.refetchAllSources()},t.prototype.renderEvents=function(t,e){this.eventManager.freeze();for(var n=0;n<t.length;n++)this.renderEvent(t[n],e);this.eventManager.thaw()},t.prototype.renderEvent=function(t,e){void 0===e&&(e=!1);var n=this.eventManager,i=C.default.parse(t,t.source||n.stickySource);i&&n.addEventDef(i,e)},t.prototype.removeEvents=function(t){var e,n,r=this.eventManager,o=[],s={};if(null==t)r.removeAllEventDefs();else{for(r.getEventInstances().forEach(function(t){o.push(t.toLegacy())}),o=i(o,t),n=0;n<o.length;n++)e=this.eventManager.getEventDefByUid(o[n]._id),s[e.id]=!0;r.freeze();for(n in s)r.removeEventDefsById(n);r.thaw()}},t.prototype.clientEvents=function(t){var e=[];return this.eventManager.getEventInstances().forEach(function(t){e.push(t.toLegacy())}),i(e,t)},t.prototype.updateEvents=function(t){this.eventManager.freeze();for(var e=0;e<t.length;e++)this.updateEvent(t[e]);this.eventManager.thaw()},t.prototype.updateEvent=function(t){var e,n,i=this.eventManager.getEventDefByUid(t._id);i instanceof R.default&&(e=i.buildInstance(),n=T.default.createFromRawProps(e,t,null),this.eventManager.mutateEventsWithId(i.id,n))},t.prototype.getEventSources=function(){return this.eventManager.otherSources.slice()},t.prototype.getEventSourceById=function(t){return this.eventManager.getSourceById(M.default.normalizeId(t))},t.prototype.addEventSource=function(t){var e=S.default.parse(t,this);e&&this.eventManager.addSource(e)},t.prototype.removeEventSources=function(t){var e,n,i=this.eventManager;if(null==t)this.eventManager.removeAllSources();else{for(e=i.multiQuerySources(t),i.freeze(),n=0;n<e.length;n++)i.removeSource(e[n]);i.thaw()}},t.prototype.removeEventSource=function(t){var e,n=this.eventManager,i=n.querySources(t);for(n.freeze(),e=0;e<i.length;e++)n.removeSource(i[e]);n.thaw()},t.prototype.refetchEventSources=function(t){var e,n=this.eventManager,i=n.multiQuerySources(t);for(n.freeze(),e=0;e<i.length;e++)n.refetchSource(i[e]);n.thaw()},t.defaults=a.globalDefaults,t.englishDefaults=a.englishDefaults,t.rtlDefaults=a.rtlDefaults,t}();e.default=H,d.default.mixInto(H),c.default.mixInto(H)},function(t,e,n){Object.defineProperty(e,"__esModule",{value:!0});var i=n(0),r=n(4),o=n(5),s=function(){function t(t){this._view=t}return t.prototype.opt=function(t){return this._view.opt(t)},t.prototype.trimHiddenDays=function(t){return this._view.trimHiddenDays(t)},t.prototype.msToUtcMoment=function(t,e){return this._view.calendar.msToUtcMoment(t,e)},t.prototype.buildPrev=function(t){var e=t.date.clone().startOf(t.currentRangeUnit).subtract(t.dateIncrement);return this.build(e,-1)},t.prototype.buildNext=function(t){var e=t.date.clone().startOf(t.currentRangeUnit).add(t.dateIncrement);return this.build(e,1)},t.prototype.build=function(t,e,n){void 0===n&&(n=!1);var r,o,s,a,l,u,d=!t.hasTime(),c=null,p=null;return r=this.buildValidRange(),r=this.trimHiddenDays(r),n&&(t=this.msToUtcMoment(r.constrainDate(t),d)),o=this.buildCurrentRangeInfo(t,e),s=/^(year|month|week|day)$/.test(o.unit),a=this.buildRenderRange(this.trimHiddenDays(o.unzonedRange),o.unit,s),a=this.trimHiddenDays(a),l=a.clone(),this.opt("showNonCurrentDates")||(l=l.intersect(o.unzonedRange)),c=i.duration(this.opt("minTime")),p=i.duration(this.opt("maxTime")),l=this.adjustActiveRange(l,c,p),l=l.intersect(r),l&&(t=this.msToUtcMoment(l.constrainDate(t),d)),u=o.unzonedRange.intersectsWith(r),{validUnzonedRange:r,currentUnzonedRange:o.unzonedRange,currentRangeUnit:o.unit,isRangeAllDay:s,activeUnzonedRange:l,renderUnzonedRange:a,minTime:c,maxTime:p,isValid:u,date:t,dateIncrement:this.buildDateIncrement(o.duration)}},t.prototype.buildValidRange=function(){return this._view.getUnzonedRangeOption("validRange",this._view.calendar.getNow())||new o.default},t.prototype.buildCurrentRangeInfo=function(t,e){var n,i=this._view.viewSpec,o=null,s=null,a=null;return i.duration?(o=i.duration,s=i.durationUnit,a=this.buildRangeFromDuration(t,e,o,s)):(n=this.opt("dayCount"))?(s="day",a=this.buildRangeFromDayCount(t,e,n)):(a=this.buildCustomVisibleRange(t))?s=r.computeGreatestUnit(a.getStart(),a.getEnd()):(o=this.getFallbackDuration(),s=r.computeGreatestUnit(o),a=this.buildRangeFromDuration(t,e,o,s)),{duration:o,unit:s,unzonedRange:a}},t.prototype.getFallbackDuration=function(){return i.duration({days:1})},t.prototype.adjustActiveRange=function(t,e,n){var i=t.getStart(),r=t.getEnd();return this._view.usesMinMaxTime&&(e<0&&i.time(0).add(e),n>864e5&&r.time(n-864e5)),new o.default(i,r)},t.prototype.buildRangeFromDuration=function(t,e,n,s){function a(){d=t.clone().startOf(h),c=d.clone().add(n),p=new o.default(d,c)}var l,u,d,c,p,h=this.opt("dateAlignment");return h||(l=this.opt("dateIncrement"),l?(u=i.duration(l),h=u<n?r.computeDurationGreatestUnit(u,l):s):h=s),n.as("days")<=1&&this._view.isHiddenDay(d)&&(d=this._view.skipHiddenDays(d,e),d.startOf("day")),a(),this.trimHiddenDays(p)||(t=this._view.skipHiddenDays(t,e),a()),p},t.prototype.buildRangeFromDayCount=function(t,e,n){var i,r=this.opt("dateAlignment"),s=0,a=t.clone();r&&a.startOf(r),a.startOf("day"),a=this._view.skipHiddenDays(a,e),i=a.clone();do{i.add(1,"day"),this._view.isHiddenDay(i)||s++}while(s<n);return new o.default(a,i)},t.prototype.buildCustomVisibleRange=function(t){var e=this._view.getUnzonedRangeOption("visibleRange",this._view.calendar.applyTimezone(t));return!e||null!=e.startMs&&null!=e.endMs?e:null},t.prototype.buildRenderRange=function(t,e,n){return t.clone()},t.prototype.buildDateIncrement=function(t){var e,n=this.opt("dateIncrement");return n?i.duration(n):(e=this.opt("dateAlignment"))?i.duration(1,e):t||i.duration({days:1})},t}();e.default=s},function(t,e,n){function i(t){var e,n,i,r,l=a.dataAttrPrefix;return l&&(l+="-"),e=t.data(l+"event")||null,e&&(e="object"==typeof e?o.extend({},e):{},n=e.start,null==n&&(n=e.time),i=e.duration,r=e.stick,delete e.start,delete e.time,delete e.duration,delete e.stick),null==n&&(n=t.data(l+"start")),null==n&&(n=t.data(l+"time")),null==i&&(i=t.data(l+"duration")),null==r&&(r=t.data(l+"stick")),n=null!=n?s.duration(n):null,i=null!=i?s.duration(i):null,r=Boolean(r),{eventProps:e,startTime:n,duration:i,stick:r}}Object.defineProperty(e,"__esModule",{value:!0});var r=n(2),o=n(3),s=n(0),a=n(16),l=n(4),u=n(10),d=n(7),c=n(23),p=n(13),h=n(18),f=n(6),g=n(15),v=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.isDragging=!1,e}return r.__extends(e,t),e.prototype.end=function(){this.dragListener&&this.dragListener.endInteraction()},e.prototype.bindToDocument=function(){this.listenTo(o(document),{dragstart:this.handleDragStart,sortstart:this.handleDragStart})},e.prototype.unbindFromDocument=function(){this.stopListeningTo(o(document))},e.prototype.handleDragStart=function(t,e){var n,i;this.opt("droppable")&&(n=o((e?e.item:null)||t.target),i=this.opt("dropAccept"),(o.isFunction(i)?i.call(n[0],n):n.is(i))&&(this.isDragging||this.listenToExternalDrag(n,t,e)))},e.prototype.listenToExternalDrag=function(t,e,n){var r,o=this,s=this.component,a=this.view,u=i(t);(this.dragListener=new c.default(s,{interactionStart:function(){o.isDragging=!0},hitOver:function(t){var e,n=!0,i=t.component.getSafeHitFootprint(t);i?(r=o.computeExternalDrop(i,u),r?(e=new h.default(r.buildInstances()),n=u.eventProps?s.isEventInstanceGroupAllowed(e):s.isExternalInstanceGroupAllowed(e)):n=!1):n=!1,n||(r=null,l.disableCursor()),r&&s.renderDrag(s.eventRangesToEventFootprints(e.sliceRenderRanges(s.dateProfile.renderUnzonedRange,a.calendar)))},hitOut:function(){r=null},hitDone:function(){l.enableCursor(),s.unrenderDrag()},interactionEnd:function(e){r&&a.reportExternalDrop(r,Boolean(u.eventProps),Boolean(u.stick),t,e,n),o.isDragging=!1,o.dragListener=null}})).startDrag(e)},e.prototype.computeExternalDrop=function(t,e){var n,i=this.view.calendar,r=u.default.utc(t.unzonedRange.startMs).stripZone();return t.isAllDay&&(e.startTime?r.time(e.startTime):r.stripTime()),e.duration&&(n=r.clone().add(e.duration)),r=i.applyTimezone(r),n&&(n=i.applyTimezone(n)),p.default.parse(o.extend({},e.eventProps,{start:r,end:n}),new f.default(i))},e}(g.default);e.default=v,d.default.mixInto(v),a.dataAttrPrefix=""},function(t,e,n){Object.defineProperty(e,"__esModule",{value:!0});var i=n(2),r=n(3),o=n(4),s=n(37),a=n(50),l=n(23),u=n(15),d=function(t){function e(e,n){var i=t.call(this,e)||this;return i.isResizing=!1,i.eventPointing=n,i}return i.__extends(e,t),e.prototype.end=function(){this.dragListener&&this.dragListener.endInteraction()},e.prototype.bindToEl=function(t){var e=this.component;e.bindSegHandlerToEl(t,"mousedown",this.handleMouseDown.bind(this)),e.bindSegHandlerToEl(t,"touchstart",this.handleTouchStart.bind(this))},e.prototype.handleMouseDown=function(t,e){this.component.canStartResize(t,e)&&this.buildDragListener(t,r(e.target).is(".fc-start-resizer")).startInteraction(e,{distance:5})},e.prototype.handleTouchStart=function(t,e){this.component.canStartResize(t,e)&&this.buildDragListener(t,r(e.target).is(".fc-start-resizer")).startInteraction(e)},e.prototype.buildDragListener=function(t,e){var n,i,r=this,s=this.component,a=this.view,u=a.calendar,d=u.eventManager,c=t.el,p=t.footprint.eventDef,h=t.footprint.eventInstance;return this.dragListener=new l.default(s,{scroll:this.opt("dragScroll"),subjectEl:c,interactionStart:function(){n=!1},dragStart:function(e){n=!0,r.eventPointing.handleMouseout(t,e),r.segResizeStart(t,e)},hitOver:function(n,l,c){var h,f=!0,g=s.getSafeHitFootprint(c),v=s.getSafeHitFootprint(n);g&&v?(i=e?r.computeEventStartResizeMutation(g,v,t.footprint):r.computeEventEndResizeMutation(g,v,t.footprint),i?(h=d.buildMutatedEventInstanceGroup(p.id,i),f=s.isEventInstanceGroupAllowed(h)):f=!1):f=!1,f?i.isEmpty()&&(i=null):(i=null,o.disableCursor()),i&&(a.hideEventsWithId(t.footprint.eventDef.id),a.renderEventResize(s.eventRangesToEventFootprints(h.sliceRenderRanges(s.dateProfile.renderUnzonedRange,u)),t))},hitOut:function(){i=null},hitDone:function(){a.unrenderEventResize(t),a.showEventsWithId(t.footprint.eventDef.id),o.enableCursor()},interactionEnd:function(e){n&&r.segResizeStop(t,e),i&&a.reportEventResize(h,i,c,e),r.dragListener=null}})},e.prototype.segResizeStart=function(t,e){this.isResizing=!0,this.component.publiclyTrigger("eventResizeStart",{context:t.el[0],args:[t.footprint.getEventLegacy(),e,{},this.view]})},e.prototype.segResizeStop=function(t,e){this.isResizing=!1,this.component.publiclyTrigger("eventResizeStop",{context:t.el[0],args:[t.footprint.getEventLegacy(),e,{},this.view]})},e.prototype.computeEventStartResizeMutation=function(t,e,n){var i,r,o=n.componentFootprint.unzonedRange,l=this.component.diffDates(e.unzonedRange.getStart(),t.unzonedRange.getStart());return o.getStart().add(l)<o.getEnd()&&(i=new a.default,i.setStartDelta(l),r=new s.default,r.setDateMutation(i),r)},e.prototype.computeEventEndResizeMutation=function(t,e,n){var i,r,o=n.componentFootprint.unzonedRange,l=this.component.diffDates(e.unzonedRange.getEnd(),t.unzonedRange.getEnd());return o.getEnd().add(l)>o.getStart()&&(i=new a.default,i.setEndDelta(l),r=new s.default,r.setDateMutation(i),r)},e}(u.default);e.default=d},function(t,e,n){Object.defineProperty(e,"__esModule",{value:!0});var i=n(2),r=n(4),o=n(37),s=n(50),a=n(54),l=n(23),u=n(244),d=n(15),c=function(t){function e(e,n){var i=t.call(this,e)||this;return i.isDragging=!1,i.eventPointing=n,i}return i.__extends(e,t),e.prototype.end=function(){this.dragListener&&this.dragListener.endInteraction()},e.prototype.getSelectionDelay=function(){var t=this.opt("eventLongPressDelay");return null==t&&(t=this.opt("longPressDelay")),t},e.prototype.bindToEl=function(t){var e=this.component;e.bindSegHandlerToEl(t,"mousedown",this.handleMousedown.bind(this)),e.bindSegHandlerToEl(t,"touchstart",this.handleTouchStart.bind(this))},e.prototype.handleMousedown=function(t,e){!this.component.shouldIgnoreMouse()&&this.component.canStartDrag(t,e)&&this.buildDragListener(t).startInteraction(e,{distance:5})},e.prototype.handleTouchStart=function(t,e){var n=this.component,i={delay:this.view.isEventDefSelected(t.footprint.eventDef)?0:this.getSelectionDelay()};n.canStartDrag(t,e)?this.buildDragListener(t).startInteraction(e,i):n.canStartSelection(t,e)&&this.buildSelectListener(t).startInteraction(e,i)},e.prototype.buildSelectListener=function(t){var e=this,n=this.view,i=t.footprint.eventDef,r=t.footprint.eventInstance;if(this.dragListener)return this.dragListener;var o=this.dragListener=new a.default({dragStart:function(t){o.isTouch&&!n.isEventDefSelected(i)&&r&&n.selectEventInstance(r)},interactionEnd:function(t){e.dragListener=null}});return o},e.prototype.buildDragListener=function(t){var e,n,i,o=this,s=this.component,a=this.view,d=a.calendar,c=d.eventManager,p=t.el,h=t.footprint.eventDef,f=t.footprint.eventInstance;if(this.dragListener)return this.dragListener;var g=this.dragListener=new l.default(a,{scroll:this.opt("dragScroll"),subjectEl:p,subjectCenter:!0,interactionStart:function(i){t.component=s,e=!1,n=new u.default(t.el,{additionalClass:"fc-dragging",parentEl:a.el,opacity:g.isTouch?null:o.opt("dragOpacity"),revertDuration:o.opt("dragRevertDuration"),zIndex:2}),n.hide(),n.start(i)},dragStart:function(n){g.isTouch&&!a.isEventDefSelected(h)&&f&&a.selectEventInstance(f),e=!0,o.eventPointing.handleMouseout(t,n),o.segDragStart(t,n),a.hideEventsWithId(t.footprint.eventDef.id)},hitOver:function(e,l,u){var p,f,v,y=!0;t.hit&&(u=t.hit),p=u.component.getSafeHitFootprint(u),f=e.component.getSafeHitFootprint(e),p&&f?(i=o.computeEventDropMutation(p,f,h),i?(v=c.buildMutatedEventInstanceGroup(h.id,i),y=s.isEventInstanceGroupAllowed(v)):y=!1):y=!1,y||(i=null,r.disableCursor()),i&&a.renderDrag(s.eventRangesToEventFootprints(v.sliceRenderRanges(s.dateProfile.renderUnzonedRange,d)),t,g.isTouch)?n.hide():n.show(),l&&(i=null)},hitOut:function(){a.unrenderDrag(t),n.show(),i=null},hitDone:function(){r.enableCursor()},interactionEnd:function(r){delete t.component,n.stop(!i,function(){e&&(a.unrenderDrag(t),o.segDragStop(t,r)),a.showEventsWithId(t.footprint.eventDef.id),i&&a.reportEventDrop(f,i,p,r)}),o.dragListener=null}});return g},e.prototype.segDragStart=function(t,e){this.isDragging=!0,this.component.publiclyTrigger("eventDragStart",{context:t.el[0],args:[t.footprint.getEventLegacy(),e,{},this.view]})},e.prototype.segDragStop=function(t,e){this.isDragging=!1,this.component.publiclyTrigger("eventDragStop",{context:t.el[0],args:[t.footprint.getEventLegacy(),e,{},this.view]})},e.prototype.computeEventDropMutation=function(t,e,n){var i=new o.default;return i.setDateMutation(this.computeEventDateMutation(t,e)),i},e.prototype.computeEventDateMutation=function(t,e){var n,i,r=t.unzonedRange.getStart(),o=e.unzonedRange.getStart(),a=!1,l=!1,u=!1;return t.isAllDay!==e.isAllDay&&(a=!0,e.isAllDay?(u=!0,r.stripTime()):l=!0),n=this.component.diffDates(o,r),i=new s.default,i.clearEnd=a,i.forceTimed=l,i.forceAllDay=u,i.setDateDelta(n),i},e}(d.default);e.default=c},function(t,e,n){Object.defineProperty(e,"__esModule",{value:!0});var i=n(2),r=n(4),o=n(23),s=n(12),a=n(5),l=n(15),u=function(t){function e(e){var n=t.call(this,e)||this;return n.dragListener=n.buildDragListener(),n}return i.__extends(e,t),e.prototype.end=function(){this.dragListener.endInteraction()},e.prototype.getDelay=function(){var t=this.opt("selectLongPressDelay");return null==t&&(t=this.opt("longPressDelay")),t},e.prototype.bindToEl=function(t){var e=this,n=this.component,i=this.dragListener;n.bindDateHandlerToEl(t,"mousedown",function(t){e.opt("selectable")&&!n.shouldIgnoreMouse()&&i.startInteraction(t,{distance:e.opt("selectMinDistance")})}),n.bindDateHandlerToEl(t,"touchstart",function(t){e.opt("selectable")&&!n.shouldIgnoreTouch()&&i.startInteraction(t,{delay:e.getDelay()})}),r.preventSelection(t)},e.prototype.buildDragListener=function(){var t,e=this,n=this.component;return new o.default(n,{scroll:this.opt("dragScroll"),interactionStart:function(){t=null},dragStart:function(t){e.view.unselect(t)},hitOver:function(i,o,s){var a,l;s&&(a=n.getSafeHitFootprint(s),l=n.getSafeHitFootprint(i),t=a&&l?e.computeSelection(a,l):null,t?n.renderSelectionFootprint(t):!1===t&&r.disableCursor())},hitOut:function(){t=null,n.unrenderSelection()},hitDone:function(){r.enableCursor()},interactionEnd:function(n,i){!i&&t&&e.view.reportSelection(t,n)}})},e.prototype.computeSelection=function(t,e){var n=this.computeSelectionFootprint(t,e);return!(n&&!this.isSelectionFootprintAllowed(n))&&n},e.prototype.computeSelectionFootprint=function(t,e){var n=[t.unzonedRange.startMs,t.unzonedRange.endMs,e.unzonedRange.startMs,e.unzonedRange.endMs];return n.sort(r.compareNumbers),new s.default(new a.default(n[0],n[3]),t.isAllDay)},e.prototype.isSelectionFootprintAllowed=function(t){return this.component.dateProfile.validUnzonedRange.containsRange(t.unzonedRange)&&this.view.calendar.constraints.isSelectionFootprintAllowed(t)},e}(l.default);e.default=u},function(t,e,n){function i(t){var e,n=[],i=[];for(e=0;e<t.length;e++)t[e].componentFootprint.isAllDay?n.push(t[e]):i.push(t[e]);return{allDay:n,timed:i}}Object.defineProperty(e,"__esModule",{value:!0});var r,o,s=n(2),a=n(0),l=n(3),u=n(4),d=n(39),c=n(41),p=n(227),h=n(61),f=function(t){function e(e,n){var i=t.call(this,e,n)||this;return i.usesMinMaxTime=!0,i.timeGrid=i.instantiateTimeGrid(),i.addChild(i.timeGrid),i.opt("allDaySlot")&&(i.dayGrid=i.instantiateDayGrid(),i.addChild(i.dayGrid)),i.scroller=new d.default({overflowX:"hidden",overflowY:"auto"}),i}
return s.__extends(e,t),e.prototype.instantiateTimeGrid=function(){var t=new this.timeGridClass(this);return u.copyOwnProps(r,t),t},e.prototype.instantiateDayGrid=function(){var t=new this.dayGridClass(this);return u.copyOwnProps(o,t),t},e.prototype.renderSkeleton=function(){var t,e;this.el.addClass("fc-agenda-view").html(this.renderSkeletonHtml()),this.scroller.render(),t=this.scroller.el.addClass("fc-time-grid-container"),e=l('<div class="fc-time-grid" />').appendTo(t),this.el.find(".fc-body > tr > td").append(t),this.timeGrid.headContainerEl=this.el.find(".fc-head-container"),this.timeGrid.setElement(e),this.dayGrid&&(this.dayGrid.setElement(this.el.find(".fc-day-grid")),this.dayGrid.bottomCoordPadding=this.dayGrid.el.next("hr").outerHeight())},e.prototype.unrenderSkeleton=function(){this.timeGrid.removeElement(),this.dayGrid&&this.dayGrid.removeElement(),this.scroller.destroy()},e.prototype.renderSkeletonHtml=function(){var t=this.calendar.theme;return'<table class="'+t.getClass("tableGrid")+'">'+(this.opt("columnHeader")?'<thead class="fc-head"><tr><td class="fc-head-container '+t.getClass("widgetHeader")+'">&nbsp;</td></tr></thead>':"")+'<tbody class="fc-body"><tr><td class="'+t.getClass("widgetContent")+'">'+(this.dayGrid?'<div class="fc-day-grid"/><hr class="fc-divider '+t.getClass("widgetHeader")+'"/>':"")+"</td></tr></tbody></table>"},e.prototype.axisStyleAttr=function(){return null!=this.axisWidth?'style="width:'+this.axisWidth+'px"':""},e.prototype.getNowIndicatorUnit=function(){return this.timeGrid.getNowIndicatorUnit()},e.prototype.updateSize=function(e,n,i){var r,o,s;if(t.prototype.updateSize.call(this,e,n,i),this.axisWidth=u.matchCellWidths(this.el.find(".fc-axis")),!this.timeGrid.colEls)return void(n||(o=this.computeScrollerHeight(e),this.scroller.setHeight(o)));var a=this.el.find(".fc-row:not(.fc-scroller *)");this.timeGrid.bottomRuleEl.hide(),this.scroller.clear(),u.uncompensateScroll(a),this.dayGrid&&(this.dayGrid.removeSegPopover(),r=this.opt("eventLimit"),r&&"number"!=typeof r&&(r=5),r&&this.dayGrid.limitRows(r)),n||(o=this.computeScrollerHeight(e),this.scroller.setHeight(o),s=this.scroller.getScrollbarWidths(),(s.left||s.right)&&(u.compensateScroll(a,s),o=this.computeScrollerHeight(e),this.scroller.setHeight(o)),this.scroller.lockOverflow(s),this.timeGrid.getTotalSlatHeight()<o&&this.timeGrid.bottomRuleEl.show())},e.prototype.computeScrollerHeight=function(t){return t-u.subtractInnerElHeight(this.el,this.scroller.el)},e.prototype.computeInitialDateScroll=function(){var t=a.duration(this.opt("scrollTime")),e=this.timeGrid.computeTimeTop(t);return e=Math.ceil(e),e&&e++,{top:e}},e.prototype.queryDateScroll=function(){return{top:this.scroller.getScrollTop()}},e.prototype.applyDateScroll=function(t){void 0!==t.top&&this.scroller.setScrollTop(t.top)},e.prototype.getHitFootprint=function(t){return t.component.getHitFootprint(t)},e.prototype.getHitEl=function(t){return t.component.getHitEl(t)},e.prototype.executeEventRender=function(t){var e,n,i={},r={};for(e in t)n=t[e],n.getEventDef().isAllDay()?i[e]=n:r[e]=n;this.timeGrid.executeEventRender(r),this.dayGrid&&this.dayGrid.executeEventRender(i)},e.prototype.renderDrag=function(t,e,n){var r=i(t),o=!1;return o=this.timeGrid.renderDrag(r.timed,e,n),this.dayGrid&&(o=this.dayGrid.renderDrag(r.allDay,e,n)||o),o},e.prototype.renderEventResize=function(t,e,n){var r=i(t);this.timeGrid.renderEventResize(r.timed,e,n),this.dayGrid&&this.dayGrid.renderEventResize(r.allDay,e,n)},e.prototype.renderSelectionFootprint=function(t){t.isAllDay?this.dayGrid&&this.dayGrid.renderSelectionFootprint(t):this.timeGrid.renderSelectionFootprint(t)},e}(c.default);e.default=f,f.prototype.timeGridClass=p.default,f.prototype.dayGridClass=h.default,r={renderHeadIntroHtml:function(){var t,e=this.view,n=e.calendar,i=n.msToUtcMoment(this.dateProfile.renderUnzonedRange.startMs,!0);return this.opt("weekNumbers")?(t=i.format(this.opt("smallWeekFormat")),'<th class="fc-axis fc-week-number '+n.theme.getClass("widgetHeader")+'" '+e.axisStyleAttr()+">"+e.buildGotoAnchorHtml({date:i,type:"week",forceOff:this.colCnt>1},u.htmlEscape(t))+"</th>"):'<th class="fc-axis '+n.theme.getClass("widgetHeader")+'" '+e.axisStyleAttr()+"></th>"},renderBgIntroHtml:function(){var t=this.view;return'<td class="fc-axis '+t.calendar.theme.getClass("widgetContent")+'" '+t.axisStyleAttr()+"></td>"},renderIntroHtml:function(){return'<td class="fc-axis" '+this.view.axisStyleAttr()+"></td>"}},o={renderBgIntroHtml:function(){var t=this.view;return'<td class="fc-axis '+t.calendar.theme.getClass("widgetContent")+'" '+t.axisStyleAttr()+"><span>"+t.getAllDayHtml()+"</span></td>"},renderIntroHtml:function(){return'<td class="fc-axis" '+this.view.axisStyleAttr()+"></td>"}}},function(t,e,n){Object.defineProperty(e,"__esModule",{value:!0});var i=n(2),r=n(3),o=n(0),s=n(4),a=n(40),l=n(56),u=n(60),d=n(55),c=n(53),p=n(5),h=n(12),f=n(246),g=n(247),v=n(248),y=[{hours:1},{minutes:30},{minutes:15},{seconds:30},{seconds:15}],m=function(t){function e(e){var n=t.call(this,e)||this;return n.processOptions(),n}return i.__extends(e,t),e.prototype.componentFootprintToSegs=function(t){var e,n=this.sliceRangeByTimes(t.unzonedRange);for(e=0;e<n.length;e++)this.isRTL?n[e].col=this.daysPerRow-1-n[e].dayIndex:n[e].col=n[e].dayIndex;return n},e.prototype.sliceRangeByTimes=function(t){var e,n,i=[];for(n=0;n<this.daysPerRow;n++)(e=t.intersect(this.dayRanges[n]))&&i.push({startMs:e.startMs,endMs:e.endMs,isStart:e.isStart,isEnd:e.isEnd,dayIndex:n});return i},e.prototype.processOptions=function(){var t,e=this.opt("slotDuration"),n=this.opt("snapDuration");e=o.duration(e),n=n?o.duration(n):e,this.slotDuration=e,this.snapDuration=n,this.snapsPerSlot=e/n,t=this.opt("slotLabelFormat"),r.isArray(t)&&(t=t[t.length-1]),this.labelFormat=t||this.opt("smallTimeFormat"),t=this.opt("slotLabelInterval"),this.labelInterval=t?o.duration(t):this.computeLabelInterval(e)},e.prototype.computeLabelInterval=function(t){var e,n,i;for(e=y.length-1;e>=0;e--)if(n=o.duration(y[e]),i=s.divideDurationByDuration(n,t),s.isInt(i)&&i>1)return n;return o.duration(t)},e.prototype.renderDates=function(t){this.dateProfile=t,this.updateDayTable(),this.renderSlats(),this.renderColumns()},e.prototype.unrenderDates=function(){this.unrenderColumns()},e.prototype.renderSkeleton=function(){var t=this.view.calendar.theme;this.el.html('<div class="fc-bg"></div><div class="fc-slats"></div><hr class="fc-divider '+t.getClass("widgetHeader")+'" style="display:none" />'),this.bottomRuleEl=this.el.find("hr")},e.prototype.renderSlats=function(){var t=this.view.calendar.theme;this.slatContainerEl=this.el.find("> .fc-slats").html('<table class="'+t.getClass("tableGrid")+'">'+this.renderSlatRowHtml()+"</table>"),this.slatEls=this.slatContainerEl.find("tr"),this.slatCoordCache=new c.default({els:this.slatEls,isVertical:!0})},e.prototype.renderSlatRowHtml=function(){for(var t,e,n,i=this.view,r=i.calendar,a=r.theme,l=this.isRTL,u=this.dateProfile,d="",c=o.duration(+u.minTime),p=o.duration(0);c<u.maxTime;)t=r.msToUtcMoment(u.renderUnzonedRange.startMs).time(c),e=s.isInt(s.divideDurationByDuration(p,this.labelInterval)),n='<td class="fc-axis fc-time '+a.getClass("widgetContent")+'" '+i.axisStyleAttr()+">"+(e?"<span>"+s.htmlEscape(t.format(this.labelFormat))+"</span>":"")+"</td>",d+='<tr data-time="'+t.format("HH:mm:ss")+'"'+(e?"":' class="fc-minor"')+">"+(l?"":n)+'<td class="'+a.getClass("widgetContent")+'"/>'+(l?n:"")+"</tr>",c.add(this.slotDuration),p.add(this.slotDuration);return d},e.prototype.renderColumns=function(){var t=this.dateProfile,e=this.view.calendar.theme;this.dayRanges=this.dayDates.map(function(e){return new p.default(e.clone().add(t.minTime),e.clone().add(t.maxTime))}),this.headContainerEl&&this.headContainerEl.html(this.renderHeadHtml()),this.el.find("> .fc-bg").html('<table class="'+e.getClass("tableGrid")+'">'+this.renderBgTrHtml(0)+"</table>"),this.colEls=this.el.find(".fc-day, .fc-disabled-day"),this.colCoordCache=new c.default({els:this.colEls,isHorizontal:!0}),this.renderContentSkeleton()},e.prototype.unrenderColumns=function(){this.unrenderContentSkeleton()},e.prototype.renderContentSkeleton=function(){var t,e,n="";for(t=0;t<this.colCnt;t++)n+='<td><div class="fc-content-col"><div class="fc-event-container fc-helper-container"></div><div class="fc-event-container"></div><div class="fc-highlight-container"></div><div class="fc-bgevent-container"></div><div class="fc-business-container"></div></div></td>';e=this.contentSkeletonEl=r('<div class="fc-content-skeleton"><table><tr>'+n+"</tr></table></div>"),this.colContainerEls=e.find(".fc-content-col"),this.helperContainerEls=e.find(".fc-helper-container"),this.fgContainerEls=e.find(".fc-event-container:not(.fc-helper-container)"),this.bgContainerEls=e.find(".fc-bgevent-container"),this.highlightContainerEls=e.find(".fc-highlight-container"),this.businessContainerEls=e.find(".fc-business-container"),this.bookendCells(e.find("tr")),this.el.append(e)},e.prototype.unrenderContentSkeleton=function(){this.contentSkeletonEl&&(this.contentSkeletonEl.remove(),this.contentSkeletonEl=null,this.colContainerEls=null,this.helperContainerEls=null,this.fgContainerEls=null,this.bgContainerEls=null,this.highlightContainerEls=null,this.businessContainerEls=null)},e.prototype.groupSegsByCol=function(t){var e,n=[];for(e=0;e<this.colCnt;e++)n.push([]);for(e=0;e<t.length;e++)n[t[e].col].push(t[e]);return n},e.prototype.attachSegsByCol=function(t,e){var n,i,r;for(n=0;n<this.colCnt;n++)for(i=t[n],r=0;r<i.length;r++)e.eq(n).append(i[r].el)},e.prototype.getNowIndicatorUnit=function(){return"minute"},e.prototype.renderNowIndicator=function(t){if(this.colContainerEls){var e,n=this.componentFootprintToSegs(new h.default(new p.default(t,t.valueOf()+1),!1)),i=this.computeDateTop(t,t),o=[];for(e=0;e<n.length;e++)o.push(r('<div class="fc-now-indicator fc-now-indicator-line"></div>').css("top",i).appendTo(this.colContainerEls.eq(n[e].col))[0]);n.length>0&&o.push(r('<div class="fc-now-indicator fc-now-indicator-arrow"></div>').css("top",i).appendTo(this.el.find(".fc-content-skeleton"))[0]),this.nowIndicatorEls=r(o)}},e.prototype.unrenderNowIndicator=function(){this.nowIndicatorEls&&(this.nowIndicatorEls.remove(),this.nowIndicatorEls=null)},e.prototype.updateSize=function(e,n,i){t.prototype.updateSize.call(this,e,n,i),this.slatCoordCache.build(),i&&this.updateSegVerticals([].concat(this.eventRenderer.getSegs(),this.businessSegs||[]))},e.prototype.getTotalSlatHeight=function(){return this.slatContainerEl.outerHeight()},e.prototype.computeDateTop=function(t,e){return this.computeTimeTop(o.duration(t-e.clone().stripTime()))},e.prototype.computeTimeTop=function(t){var e,n,i=this.slatEls.length,r=this.dateProfile,o=(t-r.minTime)/this.slotDuration;return o=Math.max(0,o),o=Math.min(i,o),e=Math.floor(o),e=Math.min(e,i-1),n=o-e,this.slatCoordCache.getTopPosition(e)+this.slatCoordCache.getHeight(e)*n},e.prototype.updateSegVerticals=function(t){this.computeSegVerticals(t),this.assignSegVerticals(t)},e.prototype.computeSegVerticals=function(t){var e,n,i,r=this.opt("agendaEventMinHeight");for(e=0;e<t.length;e++)n=t[e],i=this.dayDates[n.dayIndex],n.top=this.computeDateTop(n.startMs,i),n.bottom=Math.max(n.top+r,this.computeDateTop(n.endMs,i))},e.prototype.assignSegVerticals=function(t){var e,n;for(e=0;e<t.length;e++)n=t[e],n.el.css(this.generateSegVerticalCss(n))},e.prototype.generateSegVerticalCss=function(t){return{top:t.top,bottom:-t.bottom}},e.prototype.prepareHits=function(){this.colCoordCache.build(),this.slatCoordCache.build()},e.prototype.releaseHits=function(){this.colCoordCache.clear()},e.prototype.queryHit=function(t,e){var n=this.snapsPerSlot,i=this.colCoordCache,r=this.slatCoordCache;if(i.isLeftInBounds(t)&&r.isTopInBounds(e)){var o=i.getHorizontalIndex(t),s=r.getVerticalIndex(e);if(null!=o&&null!=s){var a=r.getTopOffset(s),l=r.getHeight(s),u=(e-a)/l,d=Math.floor(u*n),c=s*n+d,p=a+d/n*l,h=a+(d+1)/n*l;return{col:o,snap:c,component:this,left:i.getLeftOffset(o),right:i.getRightOffset(o),top:p,bottom:h}}}},e.prototype.getHitFootprint=function(t){var e,n=this.getCellDate(0,t.col),i=this.computeSnapTime(t.snap);return n.time(i),e=n.clone().add(this.snapDuration),new h.default(new p.default(n,e),!1)},e.prototype.computeSnapTime=function(t){return o.duration(this.dateProfile.minTime+this.snapDuration*t)},e.prototype.getHitEl=function(t){return this.colEls.eq(t.col)},e.prototype.renderDrag=function(t,e,n){var i;if(e){if(t.length)return this.helperRenderer.renderEventDraggingFootprints(t,e,n),!0}else for(i=0;i<t.length;i++)this.renderHighlight(t[i].componentFootprint)},e.prototype.unrenderDrag=function(){this.unrenderHighlight(),this.helperRenderer.unrender()},e.prototype.renderEventResize=function(t,e,n){this.helperRenderer.renderEventResizingFootprints(t,e,n)},e.prototype.unrenderEventResize=function(){this.helperRenderer.unrender()},e.prototype.renderSelectionFootprint=function(t){this.opt("selectHelper")?this.helperRenderer.renderComponentFootprint(t):this.renderHighlight(t)},e.prototype.unrenderSelection=function(){this.helperRenderer.unrender(),this.unrenderHighlight()},e}(a.default);e.default=m,m.prototype.eventRendererClass=f.default,m.prototype.businessHourRendererClass=l.default,m.prototype.helperRendererClass=g.default,m.prototype.fillRendererClass=v.default,u.default.mixInto(m),d.default.mixInto(m)},function(t,e,n){Object.defineProperty(e,"__esModule",{value:!0});var i=n(2),r=n(5),o=n(221),s=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return i.__extends(e,t),e.prototype.buildRenderRange=function(e,n,i){var o=t.prototype.buildRenderRange.call(this,e,n,i),s=this.msToUtcMoment(o.startMs,i),a=this.msToUtcMoment(o.endMs,i);return/^(year|month)$/.test(n)&&(s.startOf("week"),a.weekday()&&a.add(1,"week").startOf("week")),new r.default(s,a)},e}(o.default);e.default=s},function(t,e,n){Object.defineProperty(e,"__esModule",{value:!0});var i=n(2),r=n(0),o=n(4),s=n(62),a=n(253),l=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return i.__extends(e,t),e.prototype.setGridHeight=function(t,e){e&&(t*=this.dayGrid.rowCnt/6),o.distributeHeight(this.dayGrid.rowEls,t,!e)},e.prototype.isDateInOtherMonth=function(t,e){return t.month()!==r.utc(e.currentUnzonedRange.startMs).month()},e}(s.default);e.default=l,l.prototype.dateProfileGeneratorClass=a.default},function(t,e,n){Object.defineProperty(e,"__esModule",{value:!0});var i=n(2),r=n(3),o=n(4),s=n(5),a=n(41),l=n(39),u=n(254),d=n(255),c=function(t){function e(e,n){var i=t.call(this,e,n)||this;return i.segSelector=".fc-list-item",i.scroller=new l.default({overflowX:"hidden",overflowY:"auto"}),i}return i.__extends(e,t),e.prototype.renderSkeleton=function(){this.el.addClass("fc-list-view "+this.calendar.theme.getClass("listView")),this.scroller.render(),this.scroller.el.appendTo(this.el),this.contentEl=this.scroller.scrollEl},e.prototype.unrenderSkeleton=function(){this.scroller.destroy()},e.prototype.updateSize=function(e,n,i){t.prototype.updateSize.call(this,e,n,i),this.scroller.clear(),n||this.scroller.setHeight(this.computeScrollerHeight(e))},e.prototype.computeScrollerHeight=function(t){return t-o.subtractInnerElHeight(this.el,this.scroller.el)},e.prototype.renderDates=function(t){for(var e=this.calendar,n=e.msToUtcMoment(t.renderUnzonedRange.startMs,!0),i=e.msToUtcMoment(t.renderUnzonedRange.endMs,!0),r=[],o=[];n<i;)r.push(n.clone()),o.push(new s.default(n,n.clone().add(1,"day"))),n.add(1,"day");this.dayDates=r,this.dayRanges=o},e.prototype.componentFootprintToSegs=function(t){var e,n,i,r=this.dayRanges,o=[];for(e=0;e<r.length;e++)if((n=t.unzonedRange.intersect(r[e]))&&(i={startMs:n.startMs,endMs:n.endMs,isStart:n.isStart,isEnd:n.isEnd,dayIndex:e},o.push(i),!i.isEnd&&!t.isAllDay&&e+1<r.length&&t.unzonedRange.endMs<r[e+1].startMs+this.nextDayThreshold)){i.endMs=t.unzonedRange.endMs,i.isEnd=!0;break}return o},e.prototype.renderEmptyMessage=function(){this.contentEl.html('<div class="fc-list-empty-wrap2"><div class="fc-list-empty-wrap1"><div class="fc-list-empty">'+o.htmlEscape(this.opt("noEventsMessage"))+"</div></div></div>")},e.prototype.renderSegList=function(t){var e,n,i,o=this.groupSegsByDay(t),s=r('<table class="fc-list-table '+this.calendar.theme.getClass("tableList")+'"><tbody/></table>'),a=s.find("tbody");for(e=0;e<o.length;e++)if(n=o[e])for(a.append(this.dayHeaderHtml(this.dayDates[e])),this.eventRenderer.sortEventSegs(n),i=0;i<n.length;i++)a.append(n[i].el);this.contentEl.empty().append(s)},e.prototype.groupSegsByDay=function(t){var e,n,i=[];for(e=0;e<t.length;e++)n=t[e],(i[n.dayIndex]||(i[n.dayIndex]=[])).push(n);return i},e.prototype.dayHeaderHtml=function(t){var e=this.opt("listDayFormat"),n=this.opt("listDayAltFormat");return'<tr class="fc-list-heading" data-date="'+t.format("YYYY-MM-DD")+'"><td class="'+(this.calendar.theme.getClass("tableListHeading")||this.calendar.theme.getClass("widgetHeader"))+'" colspan="3">'+(e?this.buildGotoAnchorHtml(t,{class:"fc-list-heading-main"},o.htmlEscape(t.format(e))):"")+(n?this.buildGotoAnchorHtml(t,{class:"fc-list-heading-alt"},o.htmlEscape(t.format(n))):"")+"</td></tr>"},e}(a.default);e.default=c,c.prototype.eventRendererClass=u.default,c.prototype.eventPointingClass=d.default},,,,,,function(t,e,n){var i=n(3),r=n(16),o=n(4),s=n(220);n(10),n(47),n(256),n(257),n(260),n(261),n(262),n(263),i.fullCalendar=r,i.fn.fullCalendar=function(t){var e=Array.prototype.slice.call(arguments,1),n=this;return this.each(function(r,a){var l,u=i(a),d=u.data("fullCalendar");"string"==typeof t?"getCalendar"===t?r||(n=d):"destroy"===t?d&&(d.destroy(),u.removeData("fullCalendar")):d?i.isFunction(d[t])?(l=d[t].apply(d,e),r||(n=l),"destroy"===t&&u.removeData("fullCalendar")):o.warn("'"+t+"' is an unknown FullCalendar method."):o.warn("Attempting to call a FullCalendar method on an element with no calendar."):d||(d=new s.default(u,t),u.data("fullCalendar",d),d.render())}),n},t.exports=r},function(t,e,n){Object.defineProperty(e,"__esModule",{value:!0});var i=n(2),r=n(48),o=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return i.__extends(e,t),e.prototype.setElement=function(t){this.el=t,this.bindGlobalHandlers(),this.renderSkeleton(),this.set("isInDom",!0)},e.prototype.removeElement=function(){this.unset("isInDom"),this.unrenderSkeleton(),this.unbindGlobalHandlers(),this.el.remove()},e.prototype.bindGlobalHandlers=function(){},e.prototype.unbindGlobalHandlers=function(){},e.prototype.renderSkeleton=function(){},e.prototype.unrenderSkeleton=function(){},e}(r.default);e.default=o},function(t,e){Object.defineProperty(e,"__esModule",{value:!0});var n=function(){function t(t){this.items=t||[]}return t.prototype.proxyCall=function(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];var i=[];return this.items.forEach(function(n){i.push(n[t].apply(n,e))}),i},t}();e.default=n},function(t,e,n){Object.defineProperty(e,"__esModule",{value:!0});var i=n(3),r=n(4),o=function(){function t(t,e){this.el=null,this.viewsWithButtons=[],this.calendar=t,this.toolbarOptions=e}return t.prototype.setToolbarOptions=function(t){this.toolbarOptions=t},t.prototype.render=function(){var t=this.toolbarOptions.layout,e=this.el;t?(e?e.empty():e=this.el=i("<div class='fc-toolbar "+this.toolbarOptions.extraClasses+"'/>"),e.append(this.renderSection("left")).append(this.renderSection("right")).append(this.renderSection("center")).append('<div class="fc-clear"/>')):this.removeElement()},t.prototype.removeElement=function(){this.el&&(this.el.remove(),this.el=null)},t.prototype.renderSection=function(t){var e=this,n=this.calendar,o=n.theme,s=n.optionsManager,a=n.viewSpecManager,l=i('<div class="fc-'+t+'"/>'),u=this.toolbarOptions.layout[t],d=s.get("customButtons")||{},c=s.overrides.buttonText||{},p=s.get("buttonText")||{};return u&&i.each(u.split(" "),function(t,s){var u,h=i(),f=!0;i.each(s.split(","),function(t,s){var l,u,g,v,y,m,b,w,D;"title"===s?(h=h.add(i("<h2>&nbsp;</h2>")),f=!1):((l=d[s])?(g=function(t){l.click&&l.click.call(w[0],t)},(v=o.getCustomButtonIconClass(l))||(v=o.getIconClass(s))||(y=l.text)):(u=a.getViewSpec(s))?(e.viewsWithButtons.push(s),g=function(){n.changeView(s)},(y=u.buttonTextOverride)||(v=o.getIconClass(s))||(y=u.buttonTextDefault)):n[s]&&(g=function(){n[s]()},(y=c[s])||(v=o.getIconClass(s))||(y=p[s])),g&&(b=["fc-"+s+"-button",o.getClass("button"),o.getClass("stateDefault")],y?(m=r.htmlEscape(y),D=""):v&&(m="<span class='"+v+"'></span>",D=' aria-label="'+s+'"'),w=i('<button type="button" class="'+b.join(" ")+'"'+D+">"+m+"</button>").click(function(t){w.hasClass(o.getClass("stateDisabled"))||(g(t),(w.hasClass(o.getClass("stateActive"))||w.hasClass(o.getClass("stateDisabled")))&&w.removeClass(o.getClass("stateHover")))}).mousedown(function(){w.not("."+o.getClass("stateActive")).not("."+o.getClass("stateDisabled")).addClass(o.getClass("stateDown"))}).mouseup(function(){w.removeClass(o.getClass("stateDown"))}).hover(function(){w.not("."+o.getClass("stateActive")).not("."+o.getClass("stateDisabled")).addClass(o.getClass("stateHover"))},function(){w.removeClass(o.getClass("stateHover")).removeClass(o.getClass("stateDown"))}),h=h.add(w)))}),f&&h.first().addClass(o.getClass("cornerLeft")).end().last().addClass(o.getClass("cornerRight")).end(),h.length>1?(u=i("<div/>"),f&&u.addClass(o.getClass("buttonGroup")),u.append(h),l.append(u)):l.append(h)}),l},t.prototype.updateTitle=function(t){this.el&&this.el.find("h2").text(t)},t.prototype.activateButton=function(t){this.el&&this.el.find(".fc-"+t+"-button").addClass(this.calendar.theme.getClass("stateActive"))},t.prototype.deactivateButton=function(t){this.el&&this.el.find(".fc-"+t+"-button").removeClass(this.calendar.theme.getClass("stateActive"))},t.prototype.disableButton=function(t){this.el&&this.el.find(".fc-"+t+"-button").prop("disabled",!0).addClass(this.calendar.theme.getClass("stateDisabled"))},t.prototype.enableButton=function(t){this.el&&this.el.find(".fc-"+t+"-button").prop("disabled",!1).removeClass(this.calendar.theme.getClass("stateDisabled"))},t.prototype.getViewsWithButtons=function(){return this.viewsWithButtons},t}();e.default=o},function(t,e,n){Object.defineProperty(e,"__esModule",{value:!0});var i=n(2),r=n(3),o=n(4),s=n(32),a=n(31),l=n(48),u=function(t){function e(e,n){var i=t.call(this)||this;return i._calendar=e,i.overrides=r.extend({},n),i.dynamicOverrides={},i.compute(),i}return i.__extends(e,t),e.prototype.add=function(t){var e,n=0;this.recordOverrides(t);for(e in t)n++;if(1===n){if("height"===e||"contentHeight"===e||"aspectRatio"===e)return void this._calendar.updateViewSize(!0);if("defaultDate"===e)return;if("businessHours"===e)return;if(/^(event|select)(Overlap|Constraint|Allow)$/.test(e))return;if("timezone"===e)return void this._calendar.view.flash("initialEvents")}this._calendar.renderHeader(),this._calendar.renderFooter(),this._calendar.viewsByType={},this._calendar.reinitView()},e.prototype.compute=function(){var t,e,n,i,r;t=o.firstDefined(this.dynamicOverrides.locale,this.overrides.locale),e=a.localeOptionHash[t],e||(t=s.globalDefaults.locale,e=a.localeOptionHash[t]||{}),n=o.firstDefined(this.dynamicOverrides.isRTL,this.overrides.isRTL,e.isRTL,s.globalDefaults.isRTL),i=n?s.rtlDefaults:{},this.dirDefaults=i,this.localeDefaults=e,r=s.mergeOptions([s.globalDefaults,i,e,this.overrides,this.dynamicOverrides]),a.populateInstanceComputableOptions(r),this.reset(r)},e.prototype.recordOverrides=function(t){var e;for(e in t)this.dynamicOverrides[e]=t[e];this._calendar.viewSpecManager.clearCache(),this.compute()},e}(l.default);e.default=u},function(t,e,n){Object.defineProperty(e,"__esModule",{value:!0});var i=n(0),r=n(3),o=n(22),s=n(4),a=n(32),l=n(31),u=function(){function t(t,e){this.optionsManager=t,this._calendar=e,this.clearCache()}return t.prototype.clearCache=function(){this.viewSpecCache={}},t.prototype.getViewSpec=function(t){var e=this.viewSpecCache;return e[t]||(e[t]=this.buildViewSpec(t))},t.prototype.getUnitViewSpec=function(t){var e,n,i;if(-1!==r.inArray(t,s.unitsDesc))for(e=this._calendar.header.getViewsWithButtons(),r.each(o.viewHash,function(t){e.push(t)}),n=0;n<e.length;n++)if((i=this.getViewSpec(e[n]))&&i.singleUnit===t)return i},t.prototype.buildViewSpec=function(t){for(var e,n,r,l,u,d=this.optionsManager.overrides.views||{},c=[],p=[],h=[],f=t;f;)e=o.viewHash[f],n=d[f],f=null,"function"==typeof e&&(e={class:e}),e&&(c.unshift(e),p.unshift(e.defaults||{}),r=r||e.duration,f=f||e.type),n&&(h.unshift(n),r=r||n.duration,f=f||n.type);return e=s.mergeProps(c),e.type=t,!!e.class&&(r=r||this.optionsManager.dynamicOverrides.duration||this.optionsManager.overrides.duration,r&&(l=i.duration(r),l.valueOf()&&(u=s.computeDurationGreatestUnit(l,r),e.duration=l,e.durationUnit=u,1===l.as(u)&&(e.singleUnit=u,h.unshift(d[u]||{})))),e.defaults=a.mergeOptions(p),e.overrides=a.mergeOptions(h),this.buildViewSpecOptions(e),this.buildViewSpecButtonText(e,t),e)},t.prototype.buildViewSpecOptions=function(t){var e=this.optionsManager;t.options=a.mergeOptions([a.globalDefaults,t.defaults,e.dirDefaults,e.localeDefaults,e.overrides,t.overrides,e.dynamicOverrides]),l.populateInstanceComputableOptions(t.options)},t.prototype.buildViewSpecButtonText=function(t,e){function n(n){var i=n.buttonText||{};return i[e]||(t.buttonTextKey?i[t.buttonTextKey]:null)||(t.singleUnit?i[t.singleUnit]:null)}var i=this.optionsManager;t.buttonTextOverride=n(i.dynamicOverrides)||n(i.overrides)||t.overrides.buttonText,t.buttonTextDefault=n(i.localeDefaults)||n(i.dirDefaults)||t.defaults.buttonText||n(a.globalDefaults)||(t.duration?this._calendar.humanizeDuration(t.duration):null)||e},t}();e.default=u},function(t,e,n){function i(t,e){return t.getPrimitive()===e.getPrimitive()}Object.defineProperty(e,"__esModule",{value:!0});var r=n(3),o=n(4),s=n(243),a=n(52),l=n(6),u=n(38),d=n(13),c=n(18),p=n(11),h=n(7),f=function(){function t(t){this.calendar=t,this.stickySource=new a.default(t),this.otherSources=[]}return t.prototype.requestEvents=function(t,e,n,i){return!i&&this.currentPeriod&&this.currentPeriod.isWithinRange(t,e)&&n===this.currentPeriod.timezone||this.setPeriod(new s.default(t,e,n)),this.currentPeriod.whenReleased()},t.prototype.addSource=function(t){this.otherSources.push(t),this.currentPeriod&&this.currentPeriod.requestSource(t)},t.prototype.removeSource=function(t){o.removeExact(this.otherSources,t),this.currentPeriod&&this.currentPeriod.purgeSource(t)},t.prototype.removeAllSources=function(){this.otherSources=[],this.currentPeriod&&this.currentPeriod.purgeAllSources()},t.prototype.refetchSource=function(t){var e=this.currentPeriod;e&&(e.freeze(),e.purgeSource(t),e.requestSource(t),e.thaw())},t.prototype.refetchAllSources=function(){var t=this.currentPeriod;t&&(t.freeze(),t.purgeAllSources(),t.requestSources(this.getSources()),t.thaw())},t.prototype.getSources=function(){return[this.stickySource].concat(this.otherSources)},t.prototype.multiQuerySources=function(t){t?r.isArray(t)||(t=[t]):t=[];var e,n=[];for(e=0;e<t.length;e++)n.push.apply(n,this.querySources(t[e]));return n},t.prototype.querySources=function(t){var e,n,o=this.otherSources;for(e=0;e<o.length;e++)if((n=o[e])===t)return[n];return(n=this.getSourceById(l.default.normalizeId(t)))?[n]:(t=u.default.parse(t,this.calendar),t?r.grep(o,function(e){return i(t,e)}):void 0)},t.prototype.getSourceById=function(t){return r.grep(this.otherSources,function(e){return e.id&&e.id===t})[0]},t.prototype.setPeriod=function(t){this.currentPeriod&&(this.unbindPeriod(this.currentPeriod),this.currentPeriod=null),this.currentPeriod=t,this.bindPeriod(t),t.requestSources(this.getSources())},t.prototype.bindPeriod=function(t){this.listenTo(t,"release",function(t){this.trigger("release",t)})},t.prototype.unbindPeriod=function(t){this.stopListeningTo(t)},t.prototype.getEventDefByUid=function(t){if(this.currentPeriod)return this.currentPeriod.getEventDefByUid(t)},t.prototype.addEventDef=function(t,e){e&&this.stickySource.addEventDef(t),this.currentPeriod&&this.currentPeriod.addEventDef(t)},t.prototype.removeEventDefsById=function(t){this.getSources().forEach(function(e){e.removeEventDefsById(t)}),this.currentPeriod&&this.currentPeriod.removeEventDefsById(t)},t.prototype.removeAllEventDefs=function(){this.getSources().forEach(function(t){t.removeAllEventDefs()}),this.currentPeriod&&this.currentPeriod.removeAllEventDefs()},t.prototype.mutateEventsWithId=function(t,e){var n,i=this.currentPeriod,r=[];return i?(i.freeze(),n=i.getEventDefsById(t),n.forEach(function(t){i.removeEventDef(t),r.push(e.mutateSingle(t)),i.addEventDef(t)}),i.thaw(),function(){i.freeze();for(var t=0;t<n.length;t++)i.removeEventDef(n[t]),r[t](),i.addEventDef(n[t]);i.thaw()}):function(){}},t.prototype.buildMutatedEventInstanceGroup=function(t,e){var n,i,r=this.getEventDefsById(t),o=[];for(n=0;n<r.length;n++)(i=r[n].clone())instanceof d.default&&(e.mutateSingle(i),o.push.apply(o,i.buildInstances()));return new c.default(o)},t.prototype.freeze=function(){this.currentPeriod&&this.currentPeriod.freeze()},t.prototype.thaw=function(){this.currentPeriod&&this.currentPeriod.thaw()},t.prototype.getEventDefsById=function(t){return this.currentPeriod.getEventDefsById(t)},t.prototype.getEventInstances=function(){return this.currentPeriod.getEventInstances()},t.prototype.getEventInstancesWithId=function(t){return this.currentPeriod.getEventInstancesWithId(t)},t.prototype.getEventInstancesWithoutId=function(t){return this.currentPeriod.getEventInstancesWithoutId(t)},t}();e.default=f,p.default.mixInto(f),h.default.mixInto(f)},function(t,e,n){Object.defineProperty(e,"__esModule",{value:!0});var i=n(3),r=n(4),o=n(20),s=n(11),a=n(5),l=n(18),u=function(){function t(t,e,n){this.pendingCnt=0,this.freezeDepth=0,this.stuntedReleaseCnt=0,this.releaseCnt=0,this.start=t,this.end=e,this.timezone=n,this.unzonedRange=new a.default(t.clone().stripZone(),e.clone().stripZone()),this.requestsByUid={},this.eventDefsByUid={},this.eventDefsById={},this.eventInstanceGroupsById={}}return t.prototype.isWithinRange=function(t,e){return!t.isBefore(this.start)&&!e.isAfter(this.end)},t.prototype.requestSources=function(t){this.freeze();for(var e=0;e<t.length;e++)this.requestSource(t[e]);this.thaw()},t.prototype.requestSource=function(t){var e=this,n={source:t,status:"pending",eventDefs:null};this.requestsByUid[t.uid]=n,this.pendingCnt+=1,t.fetch(this.start,this.end,this.timezone).then(function(t){"cancelled"!==n.status&&(n.status="completed",n.eventDefs=t,e.addEventDefs(t),e.pendingCnt--,e.tryRelease())},function(){"cancelled"!==n.status&&(n.status="failed",e.pendingCnt--,e.tryRelease())})},t.prototype.purgeSource=function(t){var e=this.requestsByUid[t.uid];e&&(delete this.requestsByUid[t.uid],"pending"===e.status?(e.status="cancelled",this.pendingCnt--,this.tryRelease()):"completed"===e.status&&e.eventDefs.forEach(this.removeEventDef.bind(this)))},t.prototype.purgeAllSources=function(){var t,e,n=this.requestsByUid,i=0;for(t in n)e=n[t],"pending"===e.status?e.status="cancelled":"completed"===e.status&&i++;this.requestsByUid={},this.pendingCnt=0,i&&this.removeAllEventDefs()},t.prototype.getEventDefByUid=function(t){return this.eventDefsByUid[t]},t.prototype.getEventDefsById=function(t){var e=this.eventDefsById[t];return e?e.slice():[]},t.prototype.addEventDefs=function(t){for(var e=0;e<t.length;e++)this.addEventDef(t[e])},t.prototype.addEventDef=function(t){var e,n=this.eventDefsById,i=t.id,r=n[i]||(n[i]=[]),o=t.buildInstances(this.unzonedRange);for(r.push(t),this.eventDefsByUid[t.uid]=t,e=0;e<o.length;e++)this.addEventInstance(o[e],i)},t.prototype.removeEventDefsById=function(t){var e=this;this.getEventDefsById(t).forEach(function(t){e.removeEventDef(t)})},t.prototype.removeAllEventDefs=function(){var t=i.isEmptyObject(this.eventDefsByUid);this.eventDefsByUid={},this.eventDefsById={},this.eventInstanceGroupsById={},t||this.tryRelease()},t.prototype.removeEventDef=function(t){var e=this.eventDefsById,n=e[t.id]
;delete this.eventDefsByUid[t.uid],n&&(r.removeExact(n,t),n.length||delete e[t.id],this.removeEventInstancesForDef(t))},t.prototype.getEventInstances=function(){var t,e=this.eventInstanceGroupsById,n=[];for(t in e)n.push.apply(n,e[t].eventInstances);return n},t.prototype.getEventInstancesWithId=function(t){var e=this.eventInstanceGroupsById[t];return e?e.eventInstances.slice():[]},t.prototype.getEventInstancesWithoutId=function(t){var e,n=this.eventInstanceGroupsById,i=[];for(e in n)e!==t&&i.push.apply(i,n[e].eventInstances);return i},t.prototype.addEventInstance=function(t,e){var n=this.eventInstanceGroupsById;(n[e]||(n[e]=new l.default)).eventInstances.push(t),this.tryRelease()},t.prototype.removeEventInstancesForDef=function(t){var e,n=this.eventInstanceGroupsById,i=n[t.id];i&&(e=r.removeMatching(i.eventInstances,function(e){return e.def===t}),i.eventInstances.length||delete n[t.id],e&&this.tryRelease())},t.prototype.tryRelease=function(){this.pendingCnt||(this.freezeDepth?this.stuntedReleaseCnt++:this.release())},t.prototype.release=function(){this.releaseCnt++,this.trigger("release",this.eventInstanceGroupsById)},t.prototype.whenReleased=function(){var t=this;return this.releaseCnt?o.default.resolve(this.eventInstanceGroupsById):o.default.construct(function(e){t.one("release",e)})},t.prototype.freeze=function(){this.freezeDepth++||(this.stuntedReleaseCnt=0)},t.prototype.thaw=function(){--this.freezeDepth||!this.stuntedReleaseCnt||this.pendingCnt||this.release()},t}();e.default=u,s.default.mixInto(u)},function(t,e,n){Object.defineProperty(e,"__esModule",{value:!0});var i=n(3),r=n(4),o=n(7),s=function(){function t(t,e){this.isFollowing=!1,this.isHidden=!1,this.isAnimating=!1,this.options=e=e||{},this.sourceEl=t,this.parentEl=e.parentEl?i(e.parentEl):t.parent()}return t.prototype.start=function(t){this.isFollowing||(this.isFollowing=!0,this.y0=r.getEvY(t),this.x0=r.getEvX(t),this.topDelta=0,this.leftDelta=0,this.isHidden||this.updatePosition(),r.getEvIsTouch(t)?this.listenTo(i(document),"touchmove",this.handleMove):this.listenTo(i(document),"mousemove",this.handleMove))},t.prototype.stop=function(t,e){var n=this,r=this.options.revertDuration,o=function(){n.isAnimating=!1,n.removeElement(),n.top0=n.left0=null,e&&e()};this.isFollowing&&!this.isAnimating&&(this.isFollowing=!1,this.stopListeningTo(i(document)),t&&r&&!this.isHidden?(this.isAnimating=!0,this.el.animate({top:this.top0,left:this.left0},{duration:r,complete:o})):o())},t.prototype.getEl=function(){var t=this.el;return t||(t=this.el=this.sourceEl.clone().addClass(this.options.additionalClass||"").css({position:"absolute",visibility:"",display:this.isHidden?"none":"",margin:0,right:"auto",bottom:"auto",width:this.sourceEl.width(),height:this.sourceEl.height(),opacity:this.options.opacity||"",zIndex:this.options.zIndex}),t.addClass("fc-unselectable"),t.appendTo(this.parentEl)),t},t.prototype.removeElement=function(){this.el&&(this.el.remove(),this.el=null)},t.prototype.updatePosition=function(){var t,e;this.getEl(),null==this.top0&&(t=this.sourceEl.offset(),e=this.el.offsetParent().offset(),this.top0=t.top-e.top,this.left0=t.left-e.left),this.el.css({top:this.top0+this.topDelta,left:this.left0+this.leftDelta})},t.prototype.handleMove=function(t){this.topDelta=r.getEvY(t)-this.y0,this.leftDelta=r.getEvX(t)-this.x0,this.isHidden||this.updatePosition()},t.prototype.hide=function(){this.isHidden||(this.isHidden=!0,this.el&&this.el.hide())},t.prototype.show=function(){this.isHidden&&(this.isHidden=!1,this.updatePosition(),this.getEl().show())},t}();e.default=s,o.default.mixInto(s)},function(t,e,n){Object.defineProperty(e,"__esModule",{value:!0});var i=n(2),r=n(23),o=n(15),s=function(t){function e(e){var n=t.call(this,e)||this;return n.dragListener=n.buildDragListener(),n}return i.__extends(e,t),e.prototype.end=function(){this.dragListener.endInteraction()},e.prototype.bindToEl=function(t){var e=this.component,n=this.dragListener;e.bindDateHandlerToEl(t,"mousedown",function(t){e.shouldIgnoreMouse()||n.startInteraction(t)}),e.bindDateHandlerToEl(t,"touchstart",function(t){e.shouldIgnoreTouch()||n.startInteraction(t)})},e.prototype.buildDragListener=function(){var t,e=this,n=this.component,i=new r.default(n,{scroll:this.opt("dragScroll"),interactionStart:function(){t=i.origHit},hitOver:function(e,n,i){n||(t=null)},hitOut:function(){t=null},interactionEnd:function(i,r){var o;!r&&t&&(o=n.getSafeHitFootprint(t))&&e.view.triggerDayClick(o,n.getHitEl(t),i)}});return i.shouldCancelTouchScroll=!1,i.scrollAlwaysKills=!0,i},e}(o.default);e.default=s},function(t,e,n){function i(t){var e,n,i,r=[];for(e=0;e<t.length;e++){for(n=t[e],i=0;i<r.length&&s(n,r[i]).length;i++);n.level=i,(r[i]||(r[i]=[])).push(n)}return r}function r(t){var e,n,i,r,o;for(e=0;e<t.length;e++)for(n=t[e],i=0;i<n.length;i++)for(r=n[i],r.forwardSegs=[],o=e+1;o<t.length;o++)s(r,t[o],r.forwardSegs)}function o(t){var e,n,i=t.forwardSegs,r=0;if(void 0===t.forwardPressure){for(e=0;e<i.length;e++)n=i[e],o(n),r=Math.max(r,1+n.forwardPressure);t.forwardPressure=r}}function s(t,e,n){void 0===n&&(n=[]);for(var i=0;i<e.length;i++)a(t,e[i])&&n.push(e[i]);return n}function a(t,e){return t.bottom>e.top&&t.top<e.bottom}Object.defineProperty(e,"__esModule",{value:!0});var l=n(2),u=n(4),d=n(42),c=function(t){function e(e,n){var i=t.call(this,e,n)||this;return i.timeGrid=e,i}return l.__extends(e,t),e.prototype.renderFgSegs=function(t){this.renderFgSegsIntoContainers(t,this.timeGrid.fgContainerEls)},e.prototype.renderFgSegsIntoContainers=function(t,e){var n,i;for(n=this.timeGrid.groupSegsByCol(t),i=0;i<this.timeGrid.colCnt;i++)this.updateFgSegCoords(n[i]);this.timeGrid.attachSegsByCol(n,e)},e.prototype.unrenderFgSegs=function(){this.fgSegs&&this.fgSegs.forEach(function(t){t.el.remove()})},e.prototype.computeEventTimeFormat=function(){return this.opt("noMeridiemTimeFormat")},e.prototype.computeDisplayEventEnd=function(){return!0},e.prototype.fgSegHtml=function(t,e){var n,i,r,o=this.view,s=o.calendar,a=t.footprint.componentFootprint,l=a.isAllDay,d=t.footprint.eventDef,c=o.isEventDefDraggable(d),p=!e&&t.isStart&&o.isEventDefResizableFromStart(d),h=!e&&t.isEnd&&o.isEventDefResizableFromEnd(d),f=this.getSegClasses(t,c,p||h),g=u.cssToStr(this.getSkinCss(d));if(f.unshift("fc-time-grid-event","fc-v-event"),o.isMultiDayRange(a.unzonedRange)){if(t.isStart||t.isEnd){var v=s.msToMoment(t.startMs),y=s.msToMoment(t.endMs);n=this._getTimeText(v,y,l),i=this._getTimeText(v,y,l,"LT"),r=this._getTimeText(v,y,l,null,!1)}}else n=this.getTimeText(t.footprint),i=this.getTimeText(t.footprint,"LT"),r=this.getTimeText(t.footprint,null,!1);return'<a class="'+f.join(" ")+'"'+(d.url?' href="'+u.htmlEscape(d.url)+'"':"")+(g?' style="'+g+'"':"")+'><div class="fc-content">'+(n?'<div class="fc-time" data-start="'+u.htmlEscape(r)+'" data-full="'+u.htmlEscape(i)+'"><span>'+u.htmlEscape(n)+"</span></div>":"")+(d.title?'<div class="fc-title">'+u.htmlEscape(d.title)+"</div>":"")+'</div><div class="fc-bg"/>'+(h?'<div class="fc-resizer fc-end-resizer" />':"")+"</a>"},e.prototype.updateFgSegCoords=function(t){this.timeGrid.computeSegVerticals(t),this.computeFgSegHorizontals(t),this.timeGrid.assignSegVerticals(t),this.assignFgSegHorizontals(t)},e.prototype.computeFgSegHorizontals=function(t){var e,n,s;if(this.sortEventSegs(t),e=i(t),r(e),n=e[0]){for(s=0;s<n.length;s++)o(n[s]);for(s=0;s<n.length;s++)this.computeFgSegForwardBack(n[s],0,0)}},e.prototype.computeFgSegForwardBack=function(t,e,n){var i,r=t.forwardSegs;if(void 0===t.forwardCoord)for(r.length?(this.sortForwardSegs(r),this.computeFgSegForwardBack(r[0],e+1,n),t.forwardCoord=r[0].backwardCoord):t.forwardCoord=1,t.backwardCoord=t.forwardCoord-(t.forwardCoord-n)/(e+1),i=0;i<r.length;i++)this.computeFgSegForwardBack(r[i],0,t.forwardCoord)},e.prototype.sortForwardSegs=function(t){t.sort(u.proxy(this,"compareForwardSegs"))},e.prototype.compareForwardSegs=function(t,e){return e.forwardPressure-t.forwardPressure||(t.backwardCoord||0)-(e.backwardCoord||0)||this.compareEventSegs(t,e)},e.prototype.assignFgSegHorizontals=function(t){var e,n;for(e=0;e<t.length;e++)n=t[e],n.el.css(this.generateFgSegHorizontalCss(n)),n.bottom-n.top<30&&n.el.addClass("fc-short")},e.prototype.generateFgSegHorizontalCss=function(t){var e,n,i=this.opt("slotEventOverlap"),r=t.backwardCoord,o=t.forwardCoord,s=this.timeGrid.generateSegVerticalCss(t),a=this.timeGrid.isRTL;return i&&(o=Math.min(1,r+2*(o-r))),a?(e=1-o,n=r):(e=r,n=1-o),s.zIndex=t.level+1,s.left=100*e+"%",s.right=100*n+"%",i&&t.forwardPressure&&(s[a?"marginLeft":"marginRight"]=20),s},e}(d.default);e.default=c},function(t,e,n){Object.defineProperty(e,"__esModule",{value:!0});var i=n(2),r=n(3),o=n(58),s=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return i.__extends(e,t),e.prototype.renderSegs=function(t,e){var n,i,o,s=[];for(this.eventRenderer.renderFgSegsIntoContainers(t,this.component.helperContainerEls),n=0;n<t.length;n++)i=t[n],e&&e.col===i.col&&(o=e.el,i.el.css({left:o.css("left"),right:o.css("right"),"margin-left":o.css("margin-left"),"margin-right":o.css("margin-right")})),s.push(i.el[0]);return r(s)},e}(o.default);e.default=s},function(t,e,n){Object.defineProperty(e,"__esModule",{value:!0});var i=n(2),r=n(57),o=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return i.__extends(e,t),e.prototype.attachSegEls=function(t,e){var n,i=this.component;return"bgEvent"===t?n=i.bgContainerEls:"businessHours"===t?n=i.businessContainerEls:"highlight"===t&&(n=i.highlightContainerEls),i.updateSegVerticals(e),i.attachSegsByCol(i.groupSegsByCol(e),n),e.map(function(t){return t.el[0]})},e}(r.default);e.default=o},function(t,e,n){Object.defineProperty(e,"__esModule",{value:!0});var i=n(3),r=n(4),o=n(7),s=function(){function t(t){this.isHidden=!0,this.margin=10,this.options=t||{}}return t.prototype.show=function(){this.isHidden&&(this.el||this.render(),this.el.show(),this.position(),this.isHidden=!1,this.trigger("show"))},t.prototype.hide=function(){this.isHidden||(this.el.hide(),this.isHidden=!0,this.trigger("hide"))},t.prototype.render=function(){var t=this,e=this.options;this.el=i('<div class="fc-popover"/>').addClass(e.className||"").css({top:0,left:0}).append(e.content).appendTo(e.parentEl),this.el.on("click",".fc-close",function(){t.hide()}),e.autoHide&&this.listenTo(i(document),"mousedown",this.documentMousedown)},t.prototype.documentMousedown=function(t){this.el&&!i(t.target).closest(this.el).length&&this.hide()},t.prototype.removeElement=function(){this.hide(),this.el&&(this.el.remove(),this.el=null),this.stopListeningTo(i(document),"mousedown")},t.prototype.position=function(){var t,e,n,o,s,a=this.options,l=this.el.offsetParent().offset(),u=this.el.outerWidth(),d=this.el.outerHeight(),c=i(window),p=r.getScrollParent(this.el);o=a.top||0,s=void 0!==a.left?a.left:void 0!==a.right?a.right-u:0,p.is(window)||p.is(document)?(p=c,t=0,e=0):(n=p.offset(),t=n.top,e=n.left),t+=c.scrollTop(),e+=c.scrollLeft(),!1!==a.viewportConstrain&&(o=Math.min(o,t+p.outerHeight()-d-this.margin),o=Math.max(o,t+this.margin),s=Math.min(s,e+p.outerWidth()-u-this.margin),s=Math.max(s,e+this.margin)),this.el.css({top:o-l.top,left:s-l.left})},t.prototype.trigger=function(t){this.options[t]&&this.options[t].apply(this,Array.prototype.slice.call(arguments,1))},t}();e.default=s,o.default.mixInto(s)},function(t,e,n){function i(t,e){var n,i;for(n=0;n<e.length;n++)if(i=e[n],i.leftCol<=t.rightCol&&i.rightCol>=t.leftCol)return!0;return!1}function r(t,e){return t.leftCol-e.leftCol}Object.defineProperty(e,"__esModule",{value:!0});var o=n(2),s=n(3),a=n(4),l=n(42),u=function(t){function e(e,n){var i=t.call(this,e,n)||this;return i.dayGrid=e,i}return o.__extends(e,t),e.prototype.renderBgRanges=function(e){e=s.grep(e,function(t){return t.eventDef.isAllDay()}),t.prototype.renderBgRanges.call(this,e)},e.prototype.renderFgSegs=function(t){var e=this.rowStructs=this.renderSegRows(t);this.dayGrid.rowEls.each(function(t,n){s(n).find(".fc-content-skeleton > table").append(e[t].tbodyEl)})},e.prototype.unrenderFgSegs=function(){for(var t,e=this.rowStructs||[];t=e.pop();)t.tbodyEl.remove();this.rowStructs=null},e.prototype.renderSegRows=function(t){var e,n,i=[];for(e=this.groupSegRows(t),n=0;n<e.length;n++)i.push(this.renderSegRow(n,e[n]));return i},e.prototype.renderSegRow=function(t,e){function n(t){for(;o<t;)d=(y[i-1]||[])[o],d?d.attr("rowspan",parseInt(d.attr("rowspan")||1,10)+1):(d=s("<td/>"),a.append(d)),v[i][o]=d,y[i][o]=d,o++}var i,r,o,a,l,u,d,c=this.dayGrid.colCnt,p=this.buildSegLevels(e),h=Math.max(1,p.length),f=s("<tbody/>"),g=[],v=[],y=[];for(i=0;i<h;i++){if(r=p[i],o=0,a=s("<tr/>"),g.push([]),v.push([]),y.push([]),r)for(l=0;l<r.length;l++){for(u=r[l],n(u.leftCol),d=s('<td class="fc-event-container"/>').append(u.el),u.leftCol!==u.rightCol?d.attr("colspan",u.rightCol-u.leftCol+1):y[i][o]=d;o<=u.rightCol;)v[i][o]=d,g[i][o]=u,o++;a.append(d)}n(c),this.dayGrid.bookendCells(a),f.append(a)}return{row:t,tbodyEl:f,cellMatrix:v,segMatrix:g,segLevels:p,segs:e}},e.prototype.buildSegLevels=function(t){var e,n,o,s=[];for(this.sortEventSegs(t),e=0;e<t.length;e++){for(n=t[e],o=0;o<s.length&&i(n,s[o]);o++);n.level=o,(s[o]||(s[o]=[])).push(n)}for(o=0;o<s.length;o++)s[o].sort(r);return s},e.prototype.groupSegRows=function(t){var e,n=[];for(e=0;e<this.dayGrid.rowCnt;e++)n.push([]);for(e=0;e<t.length;e++)n[t[e].row].push(t[e]);return n},e.prototype.computeEventTimeFormat=function(){return this.opt("extraSmallTimeFormat")},e.prototype.computeDisplayEventEnd=function(){return 1===this.dayGrid.colCnt},e.prototype.fgSegHtml=function(t,e){var n,i,r=this.view,o=t.footprint.eventDef,s=t.footprint.componentFootprint.isAllDay,l=r.isEventDefDraggable(o),u=!e&&s&&t.isStart&&r.isEventDefResizableFromStart(o),d=!e&&s&&t.isEnd&&r.isEventDefResizableFromEnd(o),c=this.getSegClasses(t,l,u||d),p=a.cssToStr(this.getSkinCss(o)),h="";return c.unshift("fc-day-grid-event","fc-h-event"),t.isStart&&(n=this.getTimeText(t.footprint))&&(h='<span class="fc-time">'+a.htmlEscape(n)+"</span>"),i='<span class="fc-title">'+(a.htmlEscape(o.title||"")||"&nbsp;")+"</span>",'<a class="'+c.join(" ")+'"'+(o.url?' href="'+a.htmlEscape(o.url)+'"':"")+(p?' style="'+p+'"':"")+'><div class="fc-content">'+(this.dayGrid.isRTL?i+" "+h:h+" "+i)+"</div>"+(u?'<div class="fc-resizer fc-start-resizer" />':"")+(d?'<div class="fc-resizer fc-end-resizer" />':"")+"</a>"},e}(l.default);e.default=u},function(t,e,n){Object.defineProperty(e,"__esModule",{value:!0});var i=n(2),r=n(3),o=n(58),s=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return i.__extends(e,t),e.prototype.renderSegs=function(t,e){var n,i=[];return n=this.eventRenderer.renderSegRows(t),this.component.rowEls.each(function(t,o){var s,a,l=r(o),u=r('<div class="fc-helper-skeleton"><table/></div>');e&&e.row===t?a=e.el.position().top:(s=l.find(".fc-content-skeleton tbody"),s.length||(s=l.find(".fc-content-skeleton table")),a=s.position().top),u.css("top",a).find("table").append(n[t].tbodyEl),l.append(u),i.push(u[0])}),r(i)},e}(o.default);e.default=s},function(t,e,n){Object.defineProperty(e,"__esModule",{value:!0});var i=n(2),r=n(3),o=n(57),s=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.fillSegTag="td",e}return i.__extends(e,t),e.prototype.attachSegEls=function(t,e){var n,i,r,o=[];for(n=0;n<e.length;n++)i=e[n],r=this.renderFillRow(t,i),this.component.rowEls.eq(i.row).append(r),o.push(r[0]);return o},e.prototype.renderFillRow=function(t,e){var n,i,o,s=this.component.colCnt,a=e.leftCol,l=e.rightCol+1;return n="businessHours"===t?"bgevent":t.toLowerCase(),i=r('<div class="fc-'+n+'-skeleton"><table><tr/></table></div>'),o=i.find("tr"),a>0&&o.append('<td colspan="'+a+'"/>'),o.append(e.el.attr("colspan",l-a)),l<s&&o.append('<td colspan="'+(s-l)+'"/>'),this.component.bookendCells(o),i},e}(o.default);e.default=s},function(t,e,n){Object.defineProperty(e,"__esModule",{value:!0});var i=n(2),r=n(228),o=n(5),s=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return i.__extends(e,t),e.prototype.buildRenderRange=function(e,n,i){var r,s=t.prototype.buildRenderRange.call(this,e,n,i),a=this.msToUtcMoment(s.startMs,i),l=this.msToUtcMoment(s.endMs,i);return this.opt("fixedWeekCount")&&(r=Math.ceil(l.diff(a,"weeks",!0)),l.add(6-r,"weeks")),new o.default(a,l)},e}(r.default);e.default=s},function(t,e,n){Object.defineProperty(e,"__esModule",{value:!0});var i=n(2),r=n(4),o=n(42),s=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return i.__extends(e,t),e.prototype.renderFgSegs=function(t){t.length?this.component.renderSegList(t):this.component.renderEmptyMessage()},e.prototype.fgSegHtml=function(t){var e,n=this.view,i=n.calendar,o=i.theme,s=t.footprint,a=s.eventDef,l=s.componentFootprint,u=a.url,d=["fc-list-item"].concat(this.getClasses(a)),c=this.getBgColor(a);return e=l.isAllDay?n.getAllDayHtml():n.isMultiDayRange(l.unzonedRange)?t.isStart||t.isEnd?r.htmlEscape(this._getTimeText(i.msToMoment(t.startMs),i.msToMoment(t.endMs),l.isAllDay)):n.getAllDayHtml():r.htmlEscape(this.getTimeText(s)),u&&d.push("fc-has-url"),'<tr class="'+d.join(" ")+'">'+(this.displayEventTime?'<td class="fc-list-item-time '+o.getClass("widgetContent")+'">'+(e||"")+"</td>":"")+'<td class="fc-list-item-marker '+o.getClass("widgetContent")+'"><span class="fc-event-dot"'+(c?' style="background-color:'+c+'"':"")+'></span></td><td class="fc-list-item-title '+o.getClass("widgetContent")+'"><a'+(u?' href="'+r.htmlEscape(u)+'"':"")+">"+r.htmlEscape(a.title||"")+"</a></td></tr>"},e.prototype.computeEventTimeFormat=function(){return this.opt("mediumTimeFormat")},e}(o.default);e.default=s},function(t,e,n){Object.defineProperty(e,"__esModule",{value:!0});var i=n(2),r=n(3),o=n(59),s=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return i.__extends(e,t),e.prototype.handleClick=function(e,n){var i;t.prototype.handleClick.call(this,e,n),r(n.target).closest("a[href]").length||(i=e.footprint.eventDef.url)&&!n.isDefaultPrevented()&&(window.location.href=i)},e}(o.default);e.default=s},function(t,e,n){Object.defineProperty(e,"__esModule",{value:!0});var i=n(38),r=n(52),o=n(215),s=n(216);i.default.registerClass(r.default),i.default.registerClass(o.default),i.default.registerClass(s.default)},function(t,e,n){Object.defineProperty(e,"__esModule",{value:!0});var i=n(51),r=n(213),o=n(214),s=n(258),a=n(259);i.defineThemeSystem("standard",r.default),i.defineThemeSystem("jquery-ui",o.default),i.defineThemeSystem("bootstrap3",s.default),i.defineThemeSystem("bootstrap4",a.default)},function(t,e,n){Object.defineProperty(e,"__esModule",{value:!0});var i=n(2),r=n(19),o=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return i.__extends(e,t),e}(r.default);e.default=o,o.prototype.classes={widget:"fc-bootstrap3",tableGrid:"table-bordered",tableList:"table",tableListHeading:"active",buttonGroup:"btn-group",button:"btn btn-default",stateActive:"active",stateDisabled:"disabled",today:"alert alert-info",popover:"panel panel-default",popoverHeader:"panel-heading",popoverContent:"panel-body",headerRow:"panel-default",dayRow:"panel-default",listView:"panel panel-default"},o.prototype.baseIconClass="glyphicon",o.prototype.iconClasses={close:"glyphicon-remove",prev:"glyphicon-chevron-left",next:"glyphicon-chevron-right",prevYear:"glyphicon-backward",nextYear:"glyphicon-forward"},o.prototype.iconOverrideOption="bootstrapGlyphicons",o.prototype.iconOverrideCustomButtonOption="bootstrapGlyphicon",o.prototype.iconOverridePrefix="glyphicon-"},function(t,e,n){Object.defineProperty(e,"__esModule",{value:!0});var i=n(2),r=n(19),o=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return i.__extends(e,t),e}(r.default);e.default=o,o.prototype.classes={widget:"fc-bootstrap4",tableGrid:"table-bordered",tableList:"table",tableListHeading:"table-active",buttonGroup:"btn-group",button:"btn btn-primary",stateActive:"active",stateDisabled:"disabled",today:"alert alert-info",popover:"card card-primary",popoverHeader:"card-header",popoverContent:"card-body",headerRow:"table-bordered",dayRow:"table-bordered",listView:"card card-primary"},o.prototype.baseIconClass="fa",o.prototype.iconClasses={close:"fa-times",prev:"fa-chevron-left",next:"fa-chevron-right",prevYear:"fa-angle-double-left",nextYear:"fa-angle-double-right"},o.prototype.iconOverrideOption="bootstrapFontAwesome",o.prototype.iconOverrideCustomButtonOption="bootstrapFontAwesome",o.prototype.iconOverridePrefix="fa-"},function(t,e,n){Object.defineProperty(e,"__esModule",{value:!0});var i=n(22),r=n(62),o=n(229);i.defineView("basic",{class:r.default}),i.defineView("basicDay",{type:"basic",duration:{days:1}}),i.defineView("basicWeek",{type:"basic",duration:{weeks:1}}),i.defineView("month",{class:o.default,duration:{months:1},defaults:{fixedWeekCount:!0}})},function(t,e,n){Object.defineProperty(e,"__esModule",{value:!0});var i=n(22),r=n(226);i.defineView("agenda",{class:r.default,defaults:{allDaySlot:!0,slotDuration:"00:30:00",slotEventOverlap:!0}}),i.defineView("agendaDay",{type:"agenda",duration:{days:1}}),i.defineView("agendaWeek",{type:"agenda",duration:{weeks:1}})},function(t,e,n){Object.defineProperty(e,"__esModule",{value:!0});var i=n(22),r=n(230);i.defineView("list",{class:r.default,buttonTextKey:"list",defaults:{buttonText:"list",listDayFormat:"LL",noEventsMessage:"No events to display"}}),i.defineView("listDay",{type:"list",duration:{days:1},defaults:{listDayFormat:"dddd"}}),i.defineView("listWeek",{type:"list",duration:{weeks:1},defaults:{listDayFormat:"dddd",listDayAltFormat:"LL"}}),i.defineView("listMonth",{type:"list",duration:{month:1},defaults:{listDayAltFormat:"dddd"}}),i.defineView("listYear",{type:"list",duration:{year:1},defaults:{listDayAltFormat:"dddd"}})},function(t,e){Object.defineProperty(e,"__esModule",{value:!0})}])});!function(e,r){"object"==typeof exports&&"object"==typeof module?module.exports=r(require("moment"),require("fullcalendar")):"function"==typeof define&&define.amd?define(["moment","fullcalendar"],r):"object"==typeof exports?r(require("moment"),require("fullcalendar")):r(e.moment,e.FullCalendar)}("undefined"!=typeof self?self:this,function(e,r){return function(e){function r(t){if(n[t])return n[t].exports;var a=n[t]={i:t,l:!1,exports:{}};return e[t].call(a.exports,a,a.exports,r),a.l=!0,a.exports}var n={};return r.m=e,r.c=n,r.d=function(e,n,t){r.o(e,n)||Object.defineProperty(e,n,{configurable:!1,enumerable:!0,get:t})},r.n=function(e){var n=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(n,"a",n),n},r.o=function(e,r){return Object.prototype.hasOwnProperty.call(e,r)},r.p="",r(r.s=127)}({0:function(r,n){r.exports=e},1:function(e,n){e.exports=r},127:function(e,r,n){Object.defineProperty(r,"__esModule",{value:!0}),n(128);var t=n(1);t.datepickerLocale("fr","fr",{closeText:"Fermer",prevText:"Précédent",nextText:"Suivant",currentText:"Aujourd'hui",monthNames:["janvier","février","mars","avril","mai","juin","juillet","août","septembre","octobre","novembre","décembre"],monthNamesShort:["janv.","févr.","mars","avr.","mai","juin","juil.","août","sept.","oct.","nov.","déc."],dayNames:["dimanche","lundi","mardi","mercredi","jeudi","vendredi","samedi"],dayNamesShort:["dim.","lun.","mar.","mer.","jeu.","ven.","sam."],dayNamesMin:["D","L","M","M","J","V","S"],weekHeader:"Sem.",dateFormat:"dd/mm/yy",firstDay:1,isRTL:!1,showMonthAfterYear:!1,yearSuffix:""}),t.locale("fr",{buttonText:{year:"Année",month:"Mois",week:"Semaine",day:"Jour",list:"Mon planning"},allDayHtml:"Toute la<br/>journée",eventLimitText:"en plus",noEventsMessage:"Aucun événement à afficher"})},128:function(e,r,n){!function(e,r){r(n(0))}(0,function(e){return e.defineLocale("fr",{months:"janvier_février_mars_avril_mai_juin_juillet_août_septembre_octobre_novembre_décembre".split("_"),monthsShort:"janv._févr._mars_avr._mai_juin_juil._août_sept._oct._nov._déc.".split("_"),monthsParseExact:!0,weekdays:"dimanche_lundi_mardi_mercredi_jeudi_vendredi_samedi".split("_"),weekdaysShort:"dim._lun._mar._mer._jeu._ven._sam.".split("_"),weekdaysMin:"di_lu_ma_me_je_ve_sa".split("_"),weekdaysParseExact:!0,longDateFormat:{LT:"HH:mm",LTS:"HH:mm:ss",L:"DD/MM/YYYY",LL:"D MMMM YYYY",LLL:"D MMMM YYYY HH:mm",LLLL:"dddd D MMMM YYYY HH:mm"},calendar:{sameDay:"[Aujourd’hui à] LT",nextDay:"[Demain à] LT",nextWeek:"dddd [à] LT",lastDay:"[Hier à] LT",lastWeek:"dddd [dernier à] LT",sameElse:"L"},relativeTime:{future:"dans %s",past:"il y a %s",s:"quelques secondes",ss:"%d secondes",m:"une minute",mm:"%d minutes",h:"une heure",hh:"%d heures",d:"un jour",dd:"%d jours",M:"un mois",MM:"%d mois",y:"un an",yy:"%d ans"},dayOfMonthOrdinalParse:/\d{1,2}(er|)/,ordinal:function(e,r){switch(r){case"D":return e+(1===e?"er":"");default:case"M":case"Q":case"DDD":case"d":return e+(1===e?"er":"e");case"w":case"W":return e+(1===e?"re":"e")}},week:{dow:1,doy:4}})})}})});// jQuery Alert Dialogs Plugin
//
// Version 1.1
//
// Cory S.N. LaViska
// A Beautiful Site (http://abeautifulsite.net/)
// 14 May 2009
//
// Visit http://abeautifulsite.net/notebook/87 for more information
//
// Usage:
//		jAlert( message, [title, callback] )
//		jConfirm( message, [title, callback] )
//		jPrompt( message, [value, title, callback] )
// 
// History:
//
//		1.00 - Released (29 December 2008)
//
//		1.01 - Fixed bug where unbinding would destroy all resize events
//
//
// License:
// 
// This plugin is dual-licensed under the GNU General Public License and the MIT License and
// is copyright 2008 A Beautiful Site, LLC. 
//

//global variables for translation, defined in the index.php file
//defined them if not to ensure no error if using the librairie as is.
if(typeof DIALOG_okLabel === "undefined"){DIALOG_okLabel='ok';}
if(typeof DIALOG_noLabel === "undefined"){DIALOG_noLabel='no';}
if(typeof DIALOG_cancelLabel === "undefined"){DIALOG_cancelLabel='cancel';}
if(typeof DIALOG_closeLabel === "undefined"){DIALOG_closeLabel='close';}

/**
 * changes done by LWR to adapt for WigiiProject
 * add yescancel
 * 
 * 14.03.2017 - Changed done by Medair (LMA) Remove check using Browser
 */
(function($) {
	
	$.alerts = {
		
		// These properties can be read/written by accessing $.alerts.propertyName from your scripts at any time
		
		verticalOffset: -75,                // vertical offset of the dialog from center screen, in pixels
		horizontalOffset: 0,                // horizontal offset of the dialog from center screen, in pixels/
		repositionOnResize: true,           // re-centers the dialog on window resize
		overlayOpacity: 0.4,                // transparency level of overlay
		overlayColor: '#000',               // base color of overlay
		draggable: true,                    // make the dialogs draggable (requires UI Draggables plugin)
		okButton: '&nbsp;'+DIALOG_okLabel+'&nbsp;',         // text for the OK button
		noButton: '&nbsp;'+DIALOG_noLabel+'&nbsp;', //'&nbsp;No&nbsp;',         // text for the NO button
		cancelButton: '&nbsp;'+DIALOG_cancelLabel+'&nbsp;', //'&nbsp;Cancel&nbsp;', // text for the Cancel button
		dialogClass: 'ui-dialog ui-widget ui-corner-all', // if specified, this class will be applied to all dialogs
		
		// Public methods
		
		alert: function(message, title, callback) {
			if( title == null ) title = 'Alert';
			$.alerts._show(title, message, null, 'alert', function(result) {
				if( callback ) callback(result);
			});
		},
		
		yescancel: function(message, title, callback) {
			if( title == null ) title = 'Confirm';
			$.alerts._show(title, message, null, 'yescancel', function(result) {
				if( callback ) callback(result);
			});
		},
		
		confirm: function(message, title, callback) {
			if( title == null ) title = 'Confirm';
			$.alerts._show(title, message, null, 'confirm', function(result) {
				if( callback ) callback(result);
			});
		},
			
		prompt: function(message, value, title, callback) {
			if( title == null ) title = 'Prompt';
			$.alerts._show(title, message, value, 'prompt', function(result) {
				if( callback ) callback(result);
			});
		},
		
		// Private methods
		
		_show: function(title, msg, value, type, callback) {
			
			$.alerts._hide();
			$.alerts._overlay('show');
			
			$("BODY").append(
			  '<div id="popup_container">' +
			    '<div id="popup_title" class="ui-dialog-titlebar ui-widget-header ui-corner-all"></div>' +
			    '<div id="popup_content" class="ui-dialog-content ui-widget-content">' +
			      '<div id="popup_message"></div>' +
				'</div>' +
			  '</div>');
			
			if( $.alerts.dialogClass ) $("#popup_container").addClass($.alerts.dialogClass);
			
			// IE6 Fix
			var pos = 'fixed'; 
			
			$("#popup_container").css({
				position: pos,
				zIndex: 99999
			});
			
			$("#popup_title").text(title);
			$("#popup_content").addClass(type);
			$("#popup_message").text(msg);
			$("#popup_message").html( $("#popup_message").text().replace(/\n/g, '<br />') );
			
			$("#popup_container").css({
				minWidth: $("#popup_container").outerWidth(),
				maxWidth: $("#popup_container").outerWidth()
			});
			
			$.alerts._reposition();
			$.alerts._maintainPosition(true);
			
			switch( type ) {
				case 'alert':
					$("#popup_message").after('<div id="popup_panel"><input type="button" value="' + $.alerts.okButton + '" id="popup_ok" /></div>');
					$("#popup_ok").click( function() {
						$.alerts._hide();
						callback(true);
					});
					$("#popup_ok").focus().keypress( function(e) {
						if( e.keyCode == 13 || e.keyCode == 27 ) $("#popup_ok").trigger('click');
					});
				break;
				case 'yescancel':
					$("#popup_message").after('<div id="popup_panel"><input type="button" value="' + $.alerts.okButton + '" id="popup_ok" /> <input type="button" value="' + $.alerts.cancelButton + '" id="popup_cancel" /></div>');
					$("#popup_ok").click( function() {
						$.alerts._hide();
						if( callback ) callback(true);
					});
					$("#popup_cancel").click( function() {
						$.alerts._hide();
						if( callback ) callback(null);
					});
					$("#popup_ok").focus();
					$("#popup_ok, #popup_cancel").keypress( function(e) {
						if( e.keyCode == 13 ) $(this).trigger('click');
						if( e.keyCode == 27 ) $("#popup_cancel").trigger('click');
					});
				break;
				case 'confirm':
					$("#popup_message").after('<div id="popup_panel"><input type="button" value="' + $.alerts.okButton + '" id="popup_ok" /> <input type="button" value="' + $.alerts.noButton + '" id="popup_no" /> <input type="button" value="' + $.alerts.cancelButton + '" id="popup_cancel" /></div>');
					$("#popup_ok").click( function() {
						$.alerts._hide();
						if( callback ) callback(true);
					});
					$("#popup_no").click( function() {
						$.alerts._hide();
						if( callback ) callback(false);
					});
					$("#popup_cancel").click( function() {
						$.alerts._hide();
						if( callback ) callback(null);
					});
					$("#popup_ok").focus();
					$("#popup_ok, #popup_no, #popup_cancel").keypress( function(e) {
						if( e.keyCode == 13 ) $(this).trigger('click');
						if( e.keyCode == 27 ) $("#popup_cancel").trigger('click');
					});
				break;
				case 'prompt':
					$("#popup_message").append('<br /><input type="text" size="30" id="popup_prompt" />').after('<div id="popup_panel"><input type="button" value="' + $.alerts.okButton + '" id="popup_ok" /> <input type="button" value="' + $.alerts.cancelButton + '" id="popup_cancel" /></div>');
					$("#popup_prompt").width( $("#popup_message").width() );
					$("#popup_ok").click( function() {
						var val = $("#popup_prompt").val();
						$.alerts._hide();
						if( callback ) callback( val );
					});
					$("#popup_cancel").click( function() {
						$.alerts._hide();
						if( callback ) callback( null );
					});
					$("#popup_prompt, #popup_ok, #popup_cancel").keypress( function(e) {
						if( e.keyCode == 13 ) $("#popup_ok").trigger('click');
						if( e.keyCode == 27 ) $("#popup_cancel").trigger('click');
					});
					if( value ) $("#popup_prompt").val(value);
					$("#popup_prompt").focus().select();
				break;
			}
			
			// Make draggable
			if( $.alerts.draggable ) {
				try {
					$("#popup_container").draggable({ handle: $("#popup_title") });
					$("#popup_title").css({ cursor: 'move' });
				} catch(e) { /* requires jQuery UI draggables */ }
			}
		},
		
		_hide: function() {
			$("#popup_container").remove();
			$.alerts._overlay('hide');
			$.alerts._maintainPosition(false);
		},
		
		_overlay: function(status) {
			switch( status ) {
				case 'show':
					$.alerts._overlay('hide');
					$("BODY").append('<div id="popup_overlay"></div>');
					$("#popup_overlay").css({
						position: 'absolute',
						zIndex: 99998,
						top: '0px',
						left: '0px',
						width: '100%',
						height: $(document).height(),
						background: $.alerts.overlayColor,
						opacity: $.alerts.overlayOpacity
					});
				break;
				case 'hide':
					$("#popup_overlay").remove();
				break;
			}
		},
		
		_reposition: function() {
			var top = (($(window).height() / 2) - ($("#popup_container").outerHeight() / 2)) + $.alerts.verticalOffset;
			var left = (($(window).width() / 2) - ($("#popup_container").outerWidth() / 2)) + $.alerts.horizontalOffset;
			if( top < 0 ) top = 0;
			if( left < 0 ) left = 0;
			
			
			$("#popup_container").css({
				top: top + 'px',
				left: left + 'px'
			});
			$("#popup_overlay").height( $(document).height() );
		},
		
		_maintainPosition: function(status) {
			if( $.alerts.repositionOnResize ) {
				switch(status) {
					case true:
						$(window).bind('resize', $.alerts._reposition);
					break;
					case false:
						$(window).unbind('resize', $.alerts._reposition);
					break;
				}
			}
		}
		
	}
	
	// Shortuct functions
	jAlert = function(message, title, callback) {
		$.alerts.alert(message, title, callback);
	}
	
	jYescancel = function(message, title, callback) {
		return $.alerts.yescancel(message, title, callback);
	};
	
	jConfirm = function(message, title, callback) {
		return $.alerts.confirm(message, title, callback);
	};
		
	jPrompt = function(message, value, title, callback) {
		return $.alerts.prompt(message, value, title, callback);
	};
	
})(jQuery);/*! Select2 4.0.1 | https://github.com/select2/select2/blob/master/LICENSE.md */!function(a){"function"==typeof define&&define.amd?define(["jquery"],a):a("object"==typeof exports?require("jquery"):jQuery)}(function(a){var b=function(){if(a&&a.fn&&a.fn.select2&&a.fn.select2.amd)var b=a.fn.select2.amd;var b;return function(){if(!b||!b.requirejs){b?c=b:b={};var a,c,d;!function(b){function e(a,b){return u.call(a,b)}function f(a,b){var c,d,e,f,g,h,i,j,k,l,m,n=b&&b.split("/"),o=s.map,p=o&&o["*"]||{};if(a&&"."===a.charAt(0))if(b){for(a=a.split("/"),g=a.length-1,s.nodeIdCompat&&w.test(a[g])&&(a[g]=a[g].replace(w,"")),a=n.slice(0,n.length-1).concat(a),k=0;k<a.length;k+=1)if(m=a[k],"."===m)a.splice(k,1),k-=1;else if(".."===m){if(1===k&&(".."===a[2]||".."===a[0]))break;k>0&&(a.splice(k-1,2),k-=2)}a=a.join("/")}else 0===a.indexOf("./")&&(a=a.substring(2));if((n||p)&&o){for(c=a.split("/"),k=c.length;k>0;k-=1){if(d=c.slice(0,k).join("/"),n)for(l=n.length;l>0;l-=1)if(e=o[n.slice(0,l).join("/")],e&&(e=e[d])){f=e,h=k;break}if(f)break;!i&&p&&p[d]&&(i=p[d],j=k)}!f&&i&&(f=i,h=j),f&&(c.splice(0,h,f),a=c.join("/"))}return a}function g(a,c){return function(){var d=v.call(arguments,0);return"string"!=typeof d[0]&&1===d.length&&d.push(null),n.apply(b,d.concat([a,c]))}}function h(a){return function(b){return f(b,a)}}function i(a){return function(b){q[a]=b}}function j(a){if(e(r,a)){var c=r[a];delete r[a],t[a]=!0,m.apply(b,c)}if(!e(q,a)&&!e(t,a))throw new Error("No "+a);return q[a]}function k(a){var b,c=a?a.indexOf("!"):-1;return c>-1&&(b=a.substring(0,c),a=a.substring(c+1,a.length)),[b,a]}function l(a){return function(){return s&&s.config&&s.config[a]||{}}}var m,n,o,p,q={},r={},s={},t={},u=Object.prototype.hasOwnProperty,v=[].slice,w=/\.js$/;o=function(a,b){var c,d=k(a),e=d[0];return a=d[1],e&&(e=f(e,b),c=j(e)),e?a=c&&c.normalize?c.normalize(a,h(b)):f(a,b):(a=f(a,b),d=k(a),e=d[0],a=d[1],e&&(c=j(e))),{f:e?e+"!"+a:a,n:a,pr:e,p:c}},p={require:function(a){return g(a)},exports:function(a){var b=q[a];return"undefined"!=typeof b?b:q[a]={}},module:function(a){return{id:a,uri:"",exports:q[a],config:l(a)}}},m=function(a,c,d,f){var h,k,l,m,n,s,u=[],v=typeof d;if(f=f||a,"undefined"===v||"function"===v){for(c=!c.length&&d.length?["require","exports","module"]:c,n=0;n<c.length;n+=1)if(m=o(c[n],f),k=m.f,"require"===k)u[n]=p.require(a);else if("exports"===k)u[n]=p.exports(a),s=!0;else if("module"===k)h=u[n]=p.module(a);else if(e(q,k)||e(r,k)||e(t,k))u[n]=j(k);else{if(!m.p)throw new Error(a+" missing "+k);m.p.load(m.n,g(f,!0),i(k),{}),u[n]=q[k]}l=d?d.apply(q[a],u):void 0,a&&(h&&h.exports!==b&&h.exports!==q[a]?q[a]=h.exports:l===b&&s||(q[a]=l))}else a&&(q[a]=d)},a=c=n=function(a,c,d,e,f){if("string"==typeof a)return p[a]?p[a](c):j(o(a,c).f);if(!a.splice){if(s=a,s.deps&&n(s.deps,s.callback),!c)return;c.splice?(a=c,c=d,d=null):a=b}return c=c||function(){},"function"==typeof d&&(d=e,e=f),e?m(b,a,c,d):setTimeout(function(){m(b,a,c,d)},4),n},n.config=function(a){return n(a)},a._defined=q,d=function(a,b,c){if("string"!=typeof a)throw new Error("See almond README: incorrect module build, no module name");b.splice||(c=b,b=[]),e(q,a)||e(r,a)||(r[a]=[a,b,c])},d.amd={jQuery:!0}}(),b.requirejs=a,b.require=c,b.define=d}}(),b.define("almond",function(){}),b.define("jquery",[],function(){var b=a||$;return null==b&&console&&console.error&&console.error("Select2: An instance of jQuery or a jQuery-compatible library was not found. Make sure that you are including jQuery before Select2 on your web page."),b}),b.define("select2/utils",["jquery"],function(a){function b(a){var b=a.prototype,c=[];for(var d in b){var e=b[d];"function"==typeof e&&"constructor"!==d&&c.push(d)}return c}var c={};c.Extend=function(a,b){function c(){this.constructor=a}var d={}.hasOwnProperty;for(var e in b)d.call(b,e)&&(a[e]=b[e]);return c.prototype=b.prototype,a.prototype=new c,a.__super__=b.prototype,a},c.Decorate=function(a,c){function d(){var b=Array.prototype.unshift,d=c.prototype.constructor.length,e=a.prototype.constructor;d>0&&(b.call(arguments,a.prototype.constructor),e=c.prototype.constructor),e.apply(this,arguments)}function e(){this.constructor=d}var f=b(c),g=b(a);c.displayName=a.displayName,d.prototype=new e;for(var h=0;h<g.length;h++){var i=g[h];d.prototype[i]=a.prototype[i]}for(var j=(function(a){var b=function(){};a in d.prototype&&(b=d.prototype[a]);var e=c.prototype[a];return function(){var a=Array.prototype.unshift;return a.call(arguments,b),e.apply(this,arguments)}}),k=0;k<f.length;k++){var l=f[k];d.prototype[l]=j(l)}return d};var d=function(){this.listeners={}};return d.prototype.on=function(a,b){this.listeners=this.listeners||{},a in this.listeners?this.listeners[a].push(b):this.listeners[a]=[b]},d.prototype.trigger=function(a){var b=Array.prototype.slice;this.listeners=this.listeners||{},a in this.listeners&&this.invoke(this.listeners[a],b.call(arguments,1)),"*"in this.listeners&&this.invoke(this.listeners["*"],arguments)},d.prototype.invoke=function(a,b){for(var c=0,d=a.length;d>c;c++)a[c].apply(this,b)},c.Observable=d,c.generateChars=function(a){for(var b="",c=0;a>c;c++){var d=Math.floor(36*Math.random());b+=d.toString(36)}return b},c.bind=function(a,b){return function(){a.apply(b,arguments)}},c._convertData=function(a){for(var b in a){var c=b.split("-"),d=a;if(1!==c.length){for(var e=0;e<c.length;e++){var f=c[e];f=f.substring(0,1).toLowerCase()+f.substring(1),f in d||(d[f]={}),e==c.length-1&&(d[f]=a[b]),d=d[f]}delete a[b]}}return a},c.hasScroll=function(b,c){var d=a(c),e=c.style.overflowX,f=c.style.overflowY;return e!==f||"hidden"!==f&&"visible"!==f?"scroll"===e||"scroll"===f?!0:d.innerHeight()<c.scrollHeight||d.innerWidth()<c.scrollWidth:!1},c.escapeMarkup=function(a){var b={"\\":"&#92;","&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;","/":"&#47;"};return"string"!=typeof a?a:String(a).replace(/[&<>"'\/\\]/g,function(a){return b[a]})},c.appendMany=function(b,c){if("1.7"===a.fn.jquery.substr(0,3)){var d=a();a.map(c,function(a){d=d.add(a)}),c=d}b.append(c)},c}),b.define("select2/results",["jquery","./utils"],function(a,b){function c(a,b,d){this.$element=a,this.data=d,this.options=b,c.__super__.constructor.call(this)}return b.Extend(c,b.Observable),c.prototype.render=function(){var b=a('<ul class="select2-results__options" role="tree"></ul>');return this.options.get("multiple")&&b.attr("aria-multiselectable","true"),this.$results=b,b},c.prototype.clear=function(){this.$results.empty()},c.prototype.displayMessage=function(b){var c=this.options.get("escapeMarkup");this.clear(),this.hideLoading();var d=a('<li role="treeitem" aria-live="assertive" class="select2-results__option"></li>'),e=this.options.get("translations").get(b.message);d.append(c(e(b.args))),d[0].className+=" select2-results__message",this.$results.append(d)},c.prototype.hideMessages=function(){this.$results.find(".select2-results__message").remove()},c.prototype.append=function(a){this.hideLoading();var b=[];if(null==a.results||0===a.results.length)return void(0===this.$results.children().length&&this.trigger("results:message",{message:"noResults"}));a.results=this.sort(a.results);for(var c=0;c<a.results.length;c++){var d=a.results[c],e=this.option(d);b.push(e)}this.$results.append(b)},c.prototype.position=function(a,b){var c=b.find(".select2-results");c.append(a)},c.prototype.sort=function(a){var b=this.options.get("sorter");return b(a)},c.prototype.setClasses=function(){var b=this;this.data.current(function(c){var d=a.map(c,function(a){return a.id.toString()}),e=b.$results.find(".select2-results__option[aria-selected]");e.each(function(){var b=a(this),c=a.data(this,"data"),e=""+c.id;null!=c.element&&c.element.selected||null==c.element&&a.inArray(e,d)>-1?b.attr("aria-selected","true"):b.attr("aria-selected","false")});var f=e.filter("[aria-selected=true]");f.length>0?f.first().trigger("mouseenter"):e.first().trigger("mouseenter")})},c.prototype.showLoading=function(a){this.hideLoading();var b=this.options.get("translations").get("searching"),c={disabled:!0,loading:!0,text:b(a)},d=this.option(c);d.className+=" loading-results",this.$results.prepend(d)},c.prototype.hideLoading=function(){this.$results.find(".loading-results").remove()},c.prototype.option=function(b){var c=document.createElement("li");c.className="select2-results__option";var d={role:"treeitem","aria-selected":"false"};b.disabled&&(delete d["aria-selected"],d["aria-disabled"]="true"),null==b.id&&delete d["aria-selected"],null!=b._resultId&&(c.id=b._resultId),b.title&&(c.title=b.title),b.children&&(d.role="group",d["aria-label"]=b.text,delete d["aria-selected"]);for(var e in d){var f=d[e];c.setAttribute(e,f)}if(b.children){var g=a(c),h=document.createElement("strong");h.className="select2-results__group";a(h);this.template(b,h);for(var i=[],j=0;j<b.children.length;j++){var k=b.children[j],l=this.option(k);i.push(l)}var m=a("<ul></ul>",{"class":"select2-results__options select2-results__options--nested"});m.append(i),g.append(h),g.append(m)}else this.template(b,c);return a.data(c,"data",b),c},c.prototype.bind=function(b,c){var d=this,e=b.id+"-results";this.$results.attr("id",e),b.on("results:all",function(a){d.clear(),d.append(a.data),b.isOpen()&&d.setClasses()}),b.on("results:append",function(a){d.append(a.data),b.isOpen()&&d.setClasses()}),b.on("query",function(a){d.hideMessages(),d.showLoading(a)}),b.on("select",function(){b.isOpen()&&d.setClasses()}),b.on("unselect",function(){b.isOpen()&&d.setClasses()}),b.on("open",function(){d.$results.attr("aria-expanded","true"),d.$results.attr("aria-hidden","false"),d.setClasses(),d.ensureHighlightVisible()}),b.on("close",function(){d.$results.attr("aria-expanded","false"),d.$results.attr("aria-hidden","true"),d.$results.removeAttr("aria-activedescendant")}),b.on("results:toggle",function(){var a=d.getHighlightedResults();0!==a.length&&a.trigger("mouseup")}),b.on("results:select",function(){var a=d.getHighlightedResults();if(0!==a.length){var b=a.data("data");"true"==a.attr("aria-selected")?d.trigger("close",{}):d.trigger("select",{data:b})}}),b.on("results:previous",function(){var a=d.getHighlightedResults(),b=d.$results.find("[aria-selected]"),c=b.index(a);if(0!==c){var e=c-1;0===a.length&&(e=0);var f=b.eq(e);f.trigger("mouseenter");var g=d.$results.offset().top,h=f.offset().top,i=d.$results.scrollTop()+(h-g);0===e?d.$results.scrollTop(0):0>h-g&&d.$results.scrollTop(i)}}),b.on("results:next",function(){var a=d.getHighlightedResults(),b=d.$results.find("[aria-selected]"),c=b.index(a),e=c+1;if(!(e>=b.length)){var f=b.eq(e);f.trigger("mouseenter");var g=d.$results.offset().top+d.$results.outerHeight(!1),h=f.offset().top+f.outerHeight(!1),i=d.$results.scrollTop()+h-g;0===e?d.$results.scrollTop(0):h>g&&d.$results.scrollTop(i)}}),b.on("results:focus",function(a){a.element.addClass("select2-results__option--highlighted")}),b.on("results:message",function(a){d.displayMessage(a)}),a.fn.mousewheel&&this.$results.on("mousewheel",function(a){var b=d.$results.scrollTop(),c=d.$results.get(0).scrollHeight-d.$results.scrollTop()+a.deltaY,e=a.deltaY>0&&b-a.deltaY<=0,f=a.deltaY<0&&c<=d.$results.height();e?(d.$results.scrollTop(0),a.preventDefault(),a.stopPropagation()):f&&(d.$results.scrollTop(d.$results.get(0).scrollHeight-d.$results.height()),a.preventDefault(),a.stopPropagation())}),this.$results.on("mouseup",".select2-results__option[aria-selected]",function(b){var c=a(this),e=c.data("data");return"true"===c.attr("aria-selected")?void(d.options.get("multiple")?d.trigger("unselect",{originalEvent:b,data:e}):d.trigger("close",{})):void d.trigger("select",{originalEvent:b,data:e})}),this.$results.on("mouseenter",".select2-results__option[aria-selected]",function(b){var c=a(this).data("data");d.getHighlightedResults().removeClass("select2-results__option--highlighted"),d.trigger("results:focus",{data:c,element:a(this)})})},c.prototype.getHighlightedResults=function(){var a=this.$results.find(".select2-results__option--highlighted");return a},c.prototype.destroy=function(){this.$results.remove()},c.prototype.ensureHighlightVisible=function(){var a=this.getHighlightedResults();if(0!==a.length){var b=this.$results.find("[aria-selected]"),c=b.index(a),d=this.$results.offset().top,e=a.offset().top,f=this.$results.scrollTop()+(e-d),g=e-d;f-=2*a.outerHeight(!1),2>=c?this.$results.scrollTop(0):(g>this.$results.outerHeight()||0>g)&&this.$results.scrollTop(f)}},c.prototype.template=function(b,c){var d=this.options.get("templateResult"),e=this.options.get("escapeMarkup"),f=d(b,c);null==f?c.style.display="none":"string"==typeof f?c.innerHTML=e(f):a(c).append(f)},c}),b.define("select2/keys",[],function(){var a={BACKSPACE:8,TAB:9,ENTER:13,SHIFT:16,CTRL:17,ALT:18,ESC:27,SPACE:32,PAGE_UP:33,PAGE_DOWN:34,END:35,HOME:36,LEFT:37,UP:38,RIGHT:39,DOWN:40,DELETE:46};return a}),b.define("select2/selection/base",["jquery","../utils","../keys"],function(a,b,c){function d(a,b){this.$element=a,this.options=b,d.__super__.constructor.call(this)}return b.Extend(d,b.Observable),d.prototype.render=function(){var b=a('<span class="select2-selection" role="combobox"  aria-haspopup="true" aria-expanded="false"></span>');return this._tabindex=0,null!=this.$element.data("old-tabindex")?this._tabindex=this.$element.data("old-tabindex"):null!=this.$element.attr("tabindex")&&(this._tabindex=this.$element.attr("tabindex")),b.attr("title",this.$element.attr("title")),b.attr("tabindex",this._tabindex),this.$selection=b,b},d.prototype.bind=function(a,b){var d=this,e=(a.id+"-container",a.id+"-results");this.container=a,this.$selection.on("focus",function(a){d.trigger("focus",a)}),this.$selection.on("blur",function(a){d._handleBlur(a)}),this.$selection.on("keydown",function(a){d.trigger("keypress",a),a.which===c.SPACE&&a.preventDefault()}),a.on("results:focus",function(a){d.$selection.attr("aria-activedescendant",a.data._resultId)}),a.on("selection:update",function(a){d.update(a.data)}),a.on("open",function(){d.$selection.attr("aria-expanded","true"),d.$selection.attr("aria-owns",e),d._attachCloseHandler(a)}),a.on("close",function(){d.$selection.attr("aria-expanded","false"),d.$selection.removeAttr("aria-activedescendant"),d.$selection.removeAttr("aria-owns"),d.$selection.focus(),d._detachCloseHandler(a)}),a.on("enable",function(){d.$selection.attr("tabindex",d._tabindex)}),a.on("disable",function(){d.$selection.attr("tabindex","-1")})},d.prototype._handleBlur=function(b){var c=this;window.setTimeout(function(){document.activeElement==c.$selection[0]||a.contains(c.$selection[0],document.activeElement)||c.trigger("blur",b)},1)},d.prototype._attachCloseHandler=function(b){a(document.body).on("mousedown.select2."+b.id,function(b){var c=a(b.target),d=c.closest(".select2"),e=a(".select2.select2-container--open");e.each(function(){var b=a(this);if(this!=d[0]){var c=b.data("element");c.select2("close")}})})},d.prototype._detachCloseHandler=function(b){a(document.body).off("mousedown.select2."+b.id)},d.prototype.position=function(a,b){var c=b.find(".selection");c.append(a)},d.prototype.destroy=function(){this._detachCloseHandler(this.container)},d.prototype.update=function(a){throw new Error("The `update` method must be defined in child classes.")},d}),b.define("select2/selection/single",["jquery","./base","../utils","../keys"],function(a,b,c,d){function e(){e.__super__.constructor.apply(this,arguments)}return c.Extend(e,b),e.prototype.render=function(){var a=e.__super__.render.call(this);return a.addClass("select2-selection--single"),a.html('<span class="select2-selection__rendered"></span><span class="select2-selection__arrow" role="presentation"><b role="presentation"></b></span>'),a},e.prototype.bind=function(a,b){var c=this;e.__super__.bind.apply(this,arguments);var d=a.id+"-container";this.$selection.find(".select2-selection__rendered").attr("id",d),this.$selection.attr("aria-labelledby",d),this.$selection.on("mousedown",function(a){1===a.which&&c.trigger("toggle",{originalEvent:a})}),this.$selection.on("focus",function(a){}),this.$selection.on("blur",function(a){}),a.on("selection:update",function(a){c.update(a.data)})},e.prototype.clear=function(){this.$selection.find(".select2-selection__rendered").empty()},e.prototype.display=function(a,b){var c=this.options.get("templateSelection"),d=this.options.get("escapeMarkup");return d(c(a,b))},e.prototype.selectionContainer=function(){return a("<span></span>")},e.prototype.update=function(a){if(0===a.length)return void this.clear();var b=a[0],c=this.$selection.find(".select2-selection__rendered"),d=this.display(b,c);c.empty().append(d),c.prop("title",b.title||b.text)},e}),b.define("select2/selection/multiple",["jquery","./base","../utils"],function(a,b,c){function d(a,b){d.__super__.constructor.apply(this,arguments)}return c.Extend(d,b),d.prototype.render=function(){var a=d.__super__.render.call(this);return a.addClass("select2-selection--multiple"),a.html('<ul class="select2-selection__rendered"></ul>'),a},d.prototype.bind=function(b,c){var e=this;d.__super__.bind.apply(this,arguments),this.$selection.on("click",function(a){e.trigger("toggle",{originalEvent:a})}),this.$selection.on("click",".select2-selection__choice__remove",function(b){if(!e.options.get("disabled")){var c=a(this),d=c.parent(),f=d.data("data");e.trigger("unselect",{originalEvent:b,data:f})}})},d.prototype.clear=function(){this.$selection.find(".select2-selection__rendered").empty()},d.prototype.display=function(a,b){var c=this.options.get("templateSelection"),d=this.options.get("escapeMarkup");return d(c(a,b))},d.prototype.selectionContainer=function(){var b=a('<li class="select2-selection__choice"><span class="select2-selection__choice__remove" role="presentation">&times;</span></li>');return b},d.prototype.update=function(a){if(this.clear(),0!==a.length){for(var b=[],d=0;d<a.length;d++){var e=a[d],f=this.selectionContainer(),g=this.display(e,f);f.append(g),f.prop("title",e.title||e.text),f.data("data",e),b.push(f)}var h=this.$selection.find(".select2-selection__rendered");c.appendMany(h,b)}},d}),b.define("select2/selection/placeholder",["../utils"],function(a){function b(a,b,c){this.placeholder=this.normalizePlaceholder(c.get("placeholder")),a.call(this,b,c)}return b.prototype.normalizePlaceholder=function(a,b){return"string"==typeof b&&(b={id:"",text:b}),b},b.prototype.createPlaceholder=function(a,b){var c=this.selectionContainer();return c.html(this.display(b)),c.addClass("select2-selection__placeholder").removeClass("select2-selection__choice"),c},b.prototype.update=function(a,b){var c=1==b.length&&b[0].id!=this.placeholder.id,d=b.length>1;if(d||c)return a.call(this,b);this.clear();var e=this.createPlaceholder(this.placeholder);this.$selection.find(".select2-selection__rendered").append(e)},b}),b.define("select2/selection/allowClear",["jquery","../keys"],function(a,b){function c(){}return c.prototype.bind=function(a,b,c){var d=this;a.call(this,b,c),null==this.placeholder&&this.options.get("debug")&&window.console&&console.error&&console.error("Select2: The `allowClear` option should be used in combination with the `placeholder` option."),this.$selection.on("mousedown",".select2-selection__clear",function(a){d._handleClear(a)}),b.on("keypress",function(a){d._handleKeyboardClear(a,b)})},c.prototype._handleClear=function(a,b){if(!this.options.get("disabled")){var c=this.$selection.find(".select2-selection__clear");if(0!==c.length){b.stopPropagation();for(var d=c.data("data"),e=0;e<d.length;e++){var f={data:d[e]};if(this.trigger("unselect",f),f.prevented)return}this.$element.val(this.placeholder.id).trigger("change"),this.trigger("toggle",{})}}},c.prototype._handleKeyboardClear=function(a,c,d){d.isOpen()||(c.which==b.DELETE||c.which==b.BACKSPACE)&&this._handleClear(c)},c.prototype.update=function(b,c){if(b.call(this,c),!(this.$selection.find(".select2-selection__placeholder").length>0||0===c.length)){var d=a('<span class="select2-selection__clear">&times;</span>');d.data("data",c),this.$selection.find(".select2-selection__rendered").prepend(d)}},c}),b.define("select2/selection/search",["jquery","../utils","../keys"],function(a,b,c){function d(a,b,c){a.call(this,b,c)}return d.prototype.render=function(b){var c=a('<li class="select2-search select2-search--inline"><input class="select2-search__field" type="search" tabindex="-1" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" role="textbox" aria-autocomplete="list" /></li>');this.$searchContainer=c,this.$search=c.find("input");var d=b.call(this);return this._transferTabIndex(),d},d.prototype.bind=function(a,b,d){var e=this;a.call(this,b,d),b.on("open",function(){e.$search.trigger("focus")}),b.on("close",function(){e.$search.val(""),e.$search.removeAttr("aria-activedescendant"),e.$search.trigger("focus")}),b.on("enable",function(){e.$search.prop("disabled",!1),e._transferTabIndex()}),b.on("disable",function(){e.$search.prop("disabled",!0)}),b.on("focus",function(a){e.$search.trigger("focus")}),b.on("results:focus",function(a){e.$search.attr("aria-activedescendant",a.id)}),this.$selection.on("focusin",".select2-search--inline",function(a){e.trigger("focus",a)}),this.$selection.on("focusout",".select2-search--inline",function(a){e._handleBlur(a)}),this.$selection.on("keydown",".select2-search--inline",function(a){a.stopPropagation(),e.trigger("keypress",a),e._keyUpPrevented=a.isDefaultPrevented();var b=a.which;if(b===c.BACKSPACE&&""===e.$search.val()){var d=e.$searchContainer.prev(".select2-selection__choice");if(d.length>0){var f=d.data("data");e.searchRemoveChoice(f),a.preventDefault()}}});var f=document.documentMode,g=f&&11>=f;this.$selection.on("input.searchcheck",".select2-search--inline",function(a){return g?void e.$selection.off("input.search input.searchcheck"):void e.$selection.off("keyup.search")}),this.$selection.on("keyup.search input.search",".select2-search--inline",function(a){if(g&&"input"===a.type)return void e.$selection.off("input.search input.searchcheck");var b=a.which;b!=c.SHIFT&&b!=c.CTRL&&b!=c.ALT&&b!=c.TAB&&e.handleSearch(a)})},d.prototype._transferTabIndex=function(a){this.$search.attr("tabindex",this.$selection.attr("tabindex")),this.$selection.attr("tabindex","-1")},d.prototype.createPlaceholder=function(a,b){this.$search.attr("placeholder",b.text)},d.prototype.update=function(a,b){var c=this.$search[0]==document.activeElement;this.$search.attr("placeholder",""),a.call(this,b),this.$selection.find(".select2-selection__rendered").append(this.$searchContainer),this.resizeSearch(),c&&this.$search.focus()},d.prototype.handleSearch=function(){if(this.resizeSearch(),!this._keyUpPrevented){var a=this.$search.val();this.trigger("query",{term:a})}this._keyUpPrevented=!1},d.prototype.searchRemoveChoice=function(a,b){this.trigger("unselect",{data:b}),this.$search.val(b.text),this.handleSearch()},d.prototype.resizeSearch=function(){this.$search.css("width","25px");var a="";if(""!==this.$search.attr("placeholder"))a=this.$selection.find(".select2-selection__rendered").innerWidth();else{var b=this.$search.val().length+1;a=.75*b+"em"}this.$search.css("width",a)},d}),b.define("select2/selection/eventRelay",["jquery"],function(a){function b(){}return b.prototype.bind=function(b,c,d){var e=this,f=["open","opening","close","closing","select","selecting","unselect","unselecting"],g=["opening","closing","selecting","unselecting"];b.call(this,c,d),c.on("*",function(b,c){if(-1!==a.inArray(b,f)){c=c||{};var d=a.Event("select2:"+b,{params:c});e.$element.trigger(d),-1!==a.inArray(b,g)&&(c.prevented=d.isDefaultPrevented())}})},b}),b.define("select2/translation",["jquery","require"],function(a,b){function c(a){this.dict=a||{}}return c.prototype.all=function(){return this.dict},c.prototype.get=function(a){return this.dict[a]},c.prototype.extend=function(b){this.dict=a.extend({},b.all(),this.dict)},c._cache={},c.loadPath=function(a){if(!(a in c._cache)){var d=b(a);c._cache[a]=d}return new c(c._cache[a])},c}),b.define("select2/diacritics",[],function(){var a={"Ⓐ":"A","Ａ":"A","À":"A","Á":"A","Â":"A","Ầ":"A","Ấ":"A","Ẫ":"A","Ẩ":"A","Ã":"A","Ā":"A","Ă":"A","Ằ":"A","Ắ":"A","Ẵ":"A","Ẳ":"A","Ȧ":"A","Ǡ":"A","Ä":"A","Ǟ":"A","Ả":"A","Å":"A","Ǻ":"A","Ǎ":"A","Ȁ":"A","Ȃ":"A","Ạ":"A","Ậ":"A","Ặ":"A","Ḁ":"A","Ą":"A","Ⱥ":"A","Ɐ":"A","Ꜳ":"AA","Æ":"AE","Ǽ":"AE","Ǣ":"AE","Ꜵ":"AO","Ꜷ":"AU","Ꜹ":"AV","Ꜻ":"AV","Ꜽ":"AY","Ⓑ":"B","Ｂ":"B","Ḃ":"B","Ḅ":"B","Ḇ":"B","Ƀ":"B","Ƃ":"B","Ɓ":"B","Ⓒ":"C","Ｃ":"C","Ć":"C","Ĉ":"C","Ċ":"C","Č":"C","Ç":"C","Ḉ":"C","Ƈ":"C","Ȼ":"C","Ꜿ":"C","Ⓓ":"D","Ｄ":"D","Ḋ":"D","Ď":"D","Ḍ":"D","Ḑ":"D","Ḓ":"D","Ḏ":"D","Đ":"D","Ƌ":"D","Ɗ":"D","Ɖ":"D","Ꝺ":"D","Ǳ":"DZ","Ǆ":"DZ","ǲ":"Dz","ǅ":"Dz","Ⓔ":"E","Ｅ":"E","È":"E","É":"E","Ê":"E","Ề":"E","Ế":"E","Ễ":"E","Ể":"E","Ẽ":"E","Ē":"E","Ḕ":"E","Ḗ":"E","Ĕ":"E","Ė":"E","Ë":"E","Ẻ":"E","Ě":"E","Ȅ":"E","Ȇ":"E","Ẹ":"E","Ệ":"E","Ȩ":"E","Ḝ":"E","Ę":"E","Ḙ":"E","Ḛ":"E","Ɛ":"E","Ǝ":"E","Ⓕ":"F","Ｆ":"F","Ḟ":"F","Ƒ":"F","Ꝼ":"F","Ⓖ":"G","Ｇ":"G","Ǵ":"G","Ĝ":"G","Ḡ":"G","Ğ":"G","Ġ":"G","Ǧ":"G","Ģ":"G","Ǥ":"G","Ɠ":"G","Ꞡ":"G","Ᵹ":"G","Ꝿ":"G","Ⓗ":"H","Ｈ":"H","Ĥ":"H","Ḣ":"H","Ḧ":"H","Ȟ":"H","Ḥ":"H","Ḩ":"H","Ḫ":"H","Ħ":"H","Ⱨ":"H","Ⱶ":"H","Ɥ":"H","Ⓘ":"I","Ｉ":"I","Ì":"I","Í":"I","Î":"I","Ĩ":"I","Ī":"I","Ĭ":"I","İ":"I","Ï":"I","Ḯ":"I","Ỉ":"I","Ǐ":"I","Ȉ":"I","Ȋ":"I","Ị":"I","Į":"I","Ḭ":"I","Ɨ":"I","Ⓙ":"J","Ｊ":"J","Ĵ":"J","Ɉ":"J","Ⓚ":"K","Ｋ":"K","Ḱ":"K","Ǩ":"K","Ḳ":"K","Ķ":"K","Ḵ":"K","Ƙ":"K","Ⱪ":"K","Ꝁ":"K","Ꝃ":"K","Ꝅ":"K","Ꞣ":"K","Ⓛ":"L","Ｌ":"L","Ŀ":"L","Ĺ":"L","Ľ":"L","Ḷ":"L","Ḹ":"L","Ļ":"L","Ḽ":"L","Ḻ":"L","Ł":"L","Ƚ":"L","Ɫ":"L","Ⱡ":"L","Ꝉ":"L","Ꝇ":"L","Ꞁ":"L","Ǉ":"LJ","ǈ":"Lj","Ⓜ":"M","Ｍ":"M","Ḿ":"M","Ṁ":"M","Ṃ":"M","Ɱ":"M","Ɯ":"M","Ⓝ":"N","Ｎ":"N","Ǹ":"N","Ń":"N","Ñ":"N","Ṅ":"N","Ň":"N","Ṇ":"N","Ņ":"N","Ṋ":"N","Ṉ":"N","Ƞ":"N","Ɲ":"N","Ꞑ":"N","Ꞥ":"N","Ǌ":"NJ","ǋ":"Nj","Ⓞ":"O","Ｏ":"O","Ò":"O","Ó":"O","Ô":"O","Ồ":"O","Ố":"O","Ỗ":"O","Ổ":"O","Õ":"O","Ṍ":"O","Ȭ":"O","Ṏ":"O","Ō":"O","Ṑ":"O","Ṓ":"O","Ŏ":"O","Ȯ":"O","Ȱ":"O","Ö":"O","Ȫ":"O","Ỏ":"O","Ő":"O","Ǒ":"O","Ȍ":"O","Ȏ":"O","Ơ":"O","Ờ":"O","Ớ":"O","Ỡ":"O","Ở":"O","Ợ":"O","Ọ":"O","Ộ":"O","Ǫ":"O","Ǭ":"O","Ø":"O","Ǿ":"O","Ɔ":"O","Ɵ":"O","Ꝋ":"O","Ꝍ":"O","Ƣ":"OI","Ꝏ":"OO","Ȣ":"OU","Ⓟ":"P","Ｐ":"P","Ṕ":"P","Ṗ":"P","Ƥ":"P","Ᵽ":"P","Ꝑ":"P","Ꝓ":"P","Ꝕ":"P","Ⓠ":"Q","Ｑ":"Q","Ꝗ":"Q","Ꝙ":"Q","Ɋ":"Q","Ⓡ":"R","Ｒ":"R","Ŕ":"R","Ṙ":"R","Ř":"R","Ȑ":"R","Ȓ":"R","Ṛ":"R","Ṝ":"R","Ŗ":"R","Ṟ":"R","Ɍ":"R","Ɽ":"R","Ꝛ":"R","Ꞧ":"R","Ꞃ":"R","Ⓢ":"S","Ｓ":"S","ẞ":"S","Ś":"S","Ṥ":"S","Ŝ":"S","Ṡ":"S","Š":"S","Ṧ":"S","Ṣ":"S","Ṩ":"S","Ș":"S","Ş":"S","Ȿ":"S","Ꞩ":"S","Ꞅ":"S","Ⓣ":"T","Ｔ":"T","Ṫ":"T","Ť":"T","Ṭ":"T","Ț":"T","Ţ":"T","Ṱ":"T","Ṯ":"T","Ŧ":"T","Ƭ":"T","Ʈ":"T","Ⱦ":"T","Ꞇ":"T","Ꜩ":"TZ","Ⓤ":"U","Ｕ":"U","Ù":"U","Ú":"U","Û":"U","Ũ":"U","Ṹ":"U","Ū":"U","Ṻ":"U","Ŭ":"U","Ü":"U","Ǜ":"U","Ǘ":"U","Ǖ":"U","Ǚ":"U","Ủ":"U","Ů":"U","Ű":"U","Ǔ":"U","Ȕ":"U","Ȗ":"U","Ư":"U","Ừ":"U","Ứ":"U","Ữ":"U","Ử":"U","Ự":"U","Ụ":"U","Ṳ":"U","Ų":"U","Ṷ":"U","Ṵ":"U","Ʉ":"U","Ⓥ":"V","Ｖ":"V","Ṽ":"V","Ṿ":"V","Ʋ":"V","Ꝟ":"V","Ʌ":"V","Ꝡ":"VY","Ⓦ":"W","Ｗ":"W","Ẁ":"W","Ẃ":"W","Ŵ":"W","Ẇ":"W","Ẅ":"W","Ẉ":"W","Ⱳ":"W","Ⓧ":"X","Ｘ":"X","Ẋ":"X","Ẍ":"X","Ⓨ":"Y","Ｙ":"Y","Ỳ":"Y","Ý":"Y","Ŷ":"Y","Ỹ":"Y","Ȳ":"Y","Ẏ":"Y","Ÿ":"Y","Ỷ":"Y","Ỵ":"Y","Ƴ":"Y","Ɏ":"Y","Ỿ":"Y","Ⓩ":"Z","Ｚ":"Z","Ź":"Z","Ẑ":"Z","Ż":"Z","Ž":"Z","Ẓ":"Z","Ẕ":"Z","Ƶ":"Z","Ȥ":"Z","Ɀ":"Z","Ⱬ":"Z","Ꝣ":"Z","ⓐ":"a","ａ":"a","ẚ":"a","à":"a","á":"a","â":"a","ầ":"a","ấ":"a","ẫ":"a","ẩ":"a","ã":"a","ā":"a","ă":"a","ằ":"a","ắ":"a","ẵ":"a","ẳ":"a","ȧ":"a","ǡ":"a","ä":"a","ǟ":"a","ả":"a","å":"a","ǻ":"a","ǎ":"a","ȁ":"a","ȃ":"a","ạ":"a","ậ":"a","ặ":"a","ḁ":"a","ą":"a","ⱥ":"a","ɐ":"a","ꜳ":"aa","æ":"ae","ǽ":"ae","ǣ":"ae","ꜵ":"ao","ꜷ":"au","ꜹ":"av","ꜻ":"av","ꜽ":"ay","ⓑ":"b","ｂ":"b","ḃ":"b","ḅ":"b","ḇ":"b","ƀ":"b","ƃ":"b","ɓ":"b","ⓒ":"c","ｃ":"c","ć":"c","ĉ":"c","ċ":"c","č":"c","ç":"c","ḉ":"c","ƈ":"c","ȼ":"c","ꜿ":"c","ↄ":"c","ⓓ":"d","ｄ":"d","ḋ":"d","ď":"d","ḍ":"d","ḑ":"d","ḓ":"d","ḏ":"d","đ":"d","ƌ":"d","ɖ":"d","ɗ":"d","ꝺ":"d","ǳ":"dz","ǆ":"dz","ⓔ":"e","ｅ":"e","è":"e","é":"e","ê":"e","ề":"e","ế":"e","ễ":"e","ể":"e","ẽ":"e","ē":"e","ḕ":"e","ḗ":"e","ĕ":"e","ė":"e","ë":"e","ẻ":"e","ě":"e","ȅ":"e","ȇ":"e","ẹ":"e","ệ":"e","ȩ":"e","ḝ":"e","ę":"e","ḙ":"e","ḛ":"e","ɇ":"e","ɛ":"e","ǝ":"e","ⓕ":"f","ｆ":"f","ḟ":"f","ƒ":"f","ꝼ":"f","ⓖ":"g","ｇ":"g","ǵ":"g","ĝ":"g","ḡ":"g","ğ":"g","ġ":"g","ǧ":"g","ģ":"g","ǥ":"g","ɠ":"g","ꞡ":"g","ᵹ":"g","ꝿ":"g","ⓗ":"h","ｈ":"h","ĥ":"h","ḣ":"h","ḧ":"h","ȟ":"h","ḥ":"h","ḩ":"h","ḫ":"h","ẖ":"h","ħ":"h","ⱨ":"h","ⱶ":"h","ɥ":"h","ƕ":"hv","ⓘ":"i","ｉ":"i","ì":"i","í":"i","î":"i","ĩ":"i","ī":"i","ĭ":"i","ï":"i","ḯ":"i","ỉ":"i","ǐ":"i","ȉ":"i","ȋ":"i","ị":"i","į":"i","ḭ":"i","ɨ":"i","ı":"i","ⓙ":"j","ｊ":"j","ĵ":"j","ǰ":"j","ɉ":"j","ⓚ":"k","ｋ":"k","ḱ":"k","ǩ":"k","ḳ":"k","ķ":"k","ḵ":"k","ƙ":"k","ⱪ":"k","ꝁ":"k","ꝃ":"k","ꝅ":"k","ꞣ":"k","ⓛ":"l","ｌ":"l","ŀ":"l","ĺ":"l","ľ":"l","ḷ":"l","ḹ":"l","ļ":"l","ḽ":"l","ḻ":"l","ſ":"l","ł":"l","ƚ":"l","ɫ":"l","ⱡ":"l","ꝉ":"l","ꞁ":"l","ꝇ":"l","ǉ":"lj","ⓜ":"m","ｍ":"m","ḿ":"m","ṁ":"m","ṃ":"m","ɱ":"m","ɯ":"m","ⓝ":"n","ｎ":"n","ǹ":"n","ń":"n","ñ":"n","ṅ":"n","ň":"n","ṇ":"n","ņ":"n","ṋ":"n","ṉ":"n","ƞ":"n","ɲ":"n","ŉ":"n","ꞑ":"n","ꞥ":"n","ǌ":"nj","ⓞ":"o","ｏ":"o","ò":"o","ó":"o","ô":"o","ồ":"o","ố":"o","ỗ":"o","ổ":"o","õ":"o","ṍ":"o","ȭ":"o","ṏ":"o","ō":"o","ṑ":"o","ṓ":"o","ŏ":"o","ȯ":"o","ȱ":"o","ö":"o","ȫ":"o","ỏ":"o","ő":"o","ǒ":"o","ȍ":"o","ȏ":"o","ơ":"o","ờ":"o","ớ":"o","ỡ":"o","ở":"o","ợ":"o","ọ":"o","ộ":"o","ǫ":"o","ǭ":"o","ø":"o","ǿ":"o","ɔ":"o","ꝋ":"o","ꝍ":"o","ɵ":"o","ƣ":"oi","ȣ":"ou","ꝏ":"oo","ⓟ":"p","ｐ":"p","ṕ":"p","ṗ":"p","ƥ":"p","ᵽ":"p","ꝑ":"p","ꝓ":"p","ꝕ":"p","ⓠ":"q","ｑ":"q","ɋ":"q","ꝗ":"q","ꝙ":"q","ⓡ":"r","ｒ":"r","ŕ":"r","ṙ":"r","ř":"r","ȑ":"r","ȓ":"r","ṛ":"r","ṝ":"r","ŗ":"r","ṟ":"r","ɍ":"r","ɽ":"r","ꝛ":"r","ꞧ":"r","ꞃ":"r","ⓢ":"s","ｓ":"s","ß":"s","ś":"s","ṥ":"s","ŝ":"s","ṡ":"s","š":"s","ṧ":"s","ṣ":"s","ṩ":"s","ș":"s","ş":"s","ȿ":"s","ꞩ":"s","ꞅ":"s","ẛ":"s","ⓣ":"t","ｔ":"t","ṫ":"t","ẗ":"t","ť":"t","ṭ":"t","ț":"t","ţ":"t","ṱ":"t","ṯ":"t","ŧ":"t","ƭ":"t","ʈ":"t","ⱦ":"t","ꞇ":"t","ꜩ":"tz","ⓤ":"u","ｕ":"u","ù":"u","ú":"u","û":"u","ũ":"u","ṹ":"u","ū":"u","ṻ":"u","ŭ":"u","ü":"u","ǜ":"u","ǘ":"u","ǖ":"u","ǚ":"u","ủ":"u","ů":"u","ű":"u","ǔ":"u","ȕ":"u","ȗ":"u","ư":"u","ừ":"u","ứ":"u","ữ":"u","ử":"u","ự":"u","ụ":"u","ṳ":"u","ų":"u","ṷ":"u","ṵ":"u","ʉ":"u","ⓥ":"v","ｖ":"v","ṽ":"v","ṿ":"v","ʋ":"v","ꝟ":"v","ʌ":"v","ꝡ":"vy","ⓦ":"w","ｗ":"w","ẁ":"w","ẃ":"w","ŵ":"w","ẇ":"w","ẅ":"w","ẘ":"w","ẉ":"w","ⱳ":"w","ⓧ":"x","ｘ":"x","ẋ":"x","ẍ":"x","ⓨ":"y","ｙ":"y","ỳ":"y","ý":"y","ŷ":"y","ỹ":"y","ȳ":"y","ẏ":"y","ÿ":"y","ỷ":"y","ẙ":"y","ỵ":"y","ƴ":"y","ɏ":"y","ỿ":"y","ⓩ":"z","ｚ":"z","ź":"z","ẑ":"z","ż":"z","ž":"z","ẓ":"z","ẕ":"z","ƶ":"z","ȥ":"z","ɀ":"z","ⱬ":"z","ꝣ":"z","Ά":"Α","Έ":"Ε","Ή":"Η","Ί":"Ι","Ϊ":"Ι","Ό":"Ο","Ύ":"Υ","Ϋ":"Υ","Ώ":"Ω","ά":"α","έ":"ε","ή":"η","ί":"ι","ϊ":"ι","ΐ":"ι","ό":"ο","ύ":"υ","ϋ":"υ","ΰ":"υ","ω":"ω","ς":"σ"};return a}),b.define("select2/data/base",["../utils"],function(a){function b(a,c){b.__super__.constructor.call(this)}return a.Extend(b,a.Observable),b.prototype.current=function(a){throw new Error("The `current` method must be defined in child classes.")},b.prototype.query=function(a,b){throw new Error("The `query` method must be defined in child classes.")},b.prototype.bind=function(a,b){},b.prototype.destroy=function(){},b.prototype.generateResultId=function(b,c){var d=b.id+"-result-";return d+=a.generateChars(4),d+=null!=c.id?"-"+c.id.toString():"-"+a.generateChars(4)},b}),b.define("select2/data/select",["./base","../utils","jquery"],function(a,b,c){function d(a,b){this.$element=a,this.options=b,d.__super__.constructor.call(this)}return b.Extend(d,a),d.prototype.current=function(a){var b=[],d=this;this.$element.find(":selected").each(function(){var a=c(this),e=d.item(a);b.push(e)}),a(b)},d.prototype.select=function(a){var b=this;if(a.selected=!0,c(a.element).is("option"))return a.element.selected=!0,void this.$element.trigger("change");if(this.$element.prop("multiple"))this.current(function(d){var e=[];a=[a],a.push.apply(a,d);for(var f=0;f<a.length;f++){var g=a[f].id;-1===c.inArray(g,e)&&e.push(g)}b.$element.val(e),b.$element.trigger("change")});else{var d=a.id;this.$element.val(d),this.$element.trigger("change")}},d.prototype.unselect=function(a){
var b=this;if(this.$element.prop("multiple"))return a.selected=!1,c(a.element).is("option")?(a.element.selected=!1,void this.$element.trigger("change")):void this.current(function(d){for(var e=[],f=0;f<d.length;f++){var g=d[f].id;g!==a.id&&-1===c.inArray(g,e)&&e.push(g)}b.$element.val(e),b.$element.trigger("change")})},d.prototype.bind=function(a,b){var c=this;this.container=a,a.on("select",function(a){c.select(a.data)}),a.on("unselect",function(a){c.unselect(a.data)})},d.prototype.destroy=function(){this.$element.find("*").each(function(){c.removeData(this,"data")})},d.prototype.query=function(a,b){var d=[],e=this,f=this.$element.children();f.each(function(){var b=c(this);if(b.is("option")||b.is("optgroup")){var f=e.item(b),g=e.matches(a,f);null!==g&&d.push(g)}}),b({results:d})},d.prototype.addOptions=function(a){b.appendMany(this.$element,a)},d.prototype.option=function(a){var b;a.children?(b=document.createElement("optgroup"),b.label=a.text):(b=document.createElement("option"),void 0!==b.textContent?b.textContent=a.text:b.innerText=a.text),a.id&&(b.value=a.id),a.disabled&&(b.disabled=!0),a.selected&&(b.selected=!0),a.title&&(b.title=a.title);var d=c(b),e=this._normalizeItem(a);return e.element=b,c.data(b,"data",e),d},d.prototype.item=function(a){var b={};if(b=c.data(a[0],"data"),null!=b)return b;if(a.is("option"))b={id:a.val(),text:a.text(),disabled:a.prop("disabled"),selected:a.prop("selected"),title:a.prop("title")};else if(a.is("optgroup")){b={text:a.prop("label"),children:[],title:a.prop("title")};for(var d=a.children("option"),e=[],f=0;f<d.length;f++){var g=c(d[f]),h=this.item(g);e.push(h)}b.children=e}return b=this._normalizeItem(b),b.element=a[0],c.data(a[0],"data",b),b},d.prototype._normalizeItem=function(a){c.isPlainObject(a)||(a={id:a,text:a}),a=c.extend({},{text:""},a);var b={selected:!1,disabled:!1};return null!=a.id&&(a.id=a.id.toString()),null!=a.text&&(a.text=a.text.toString()),null==a._resultId&&a.id&&null!=this.container&&(a._resultId=this.generateResultId(this.container,a)),c.extend({},b,a)},d.prototype.matches=function(a,b){var c=this.options.get("matcher");return c(a,b)},d}),b.define("select2/data/array",["./select","../utils","jquery"],function(a,b,c){function d(a,b){var c=b.get("data")||[];d.__super__.constructor.call(this,a,b),this.addOptions(this.convertToOptions(c))}return b.Extend(d,a),d.prototype.select=function(a){var b=this.$element.find("option").filter(function(b,c){return c.value==a.id.toString()});0===b.length&&(b=this.option(a),this.addOptions(b)),d.__super__.select.call(this,a)},d.prototype.convertToOptions=function(a){function d(a){return function(){return c(this).val()==a.id}}for(var e=this,f=this.$element.find("option"),g=f.map(function(){return e.item(c(this)).id}).get(),h=[],i=0;i<a.length;i++){var j=this._normalizeItem(a[i]);if(c.inArray(j.id,g)>=0){var k=f.filter(d(j)),l=this.item(k),m=c.extend(!0,{},l,j),n=this.option(m);k.replaceWith(n)}else{var o=this.option(j);if(j.children){var p=this.convertToOptions(j.children);b.appendMany(o,p)}h.push(o)}}return h},d}),b.define("select2/data/ajax",["./array","../utils","jquery"],function(a,b,c){function d(a,b){this.ajaxOptions=this._applyDefaults(b.get("ajax")),null!=this.ajaxOptions.processResults&&(this.processResults=this.ajaxOptions.processResults),d.__super__.constructor.call(this,a,b)}return b.Extend(d,a),d.prototype._applyDefaults=function(a){var b={data:function(a){return c.extend({},a,{q:a.term})},transport:function(a,b,d){var e=c.ajax(a);return e.then(b),e.fail(d),e}};return c.extend({},b,a,!0)},d.prototype.processResults=function(a){return a},d.prototype.query=function(a,b){function d(){var d=f.transport(f,function(d){var f=e.processResults(d,a);e.options.get("debug")&&window.console&&console.error&&(f&&f.results&&c.isArray(f.results)||console.error("Select2: The AJAX results did not return an array in the `results` key of the response.")),b(f)},function(){});e._request=d}var e=this;null!=this._request&&(c.isFunction(this._request.abort)&&this._request.abort(),this._request=null);var f=c.extend({type:"GET"},this.ajaxOptions);"function"==typeof f.url&&(f.url=f.url.call(this.$element,a)),"function"==typeof f.data&&(f.data=f.data.call(this.$element,a)),this.ajaxOptions.delay&&""!==a.term?(this._queryTimeout&&window.clearTimeout(this._queryTimeout),this._queryTimeout=window.setTimeout(d,this.ajaxOptions.delay)):d()},d}),b.define("select2/data/tags",["jquery"],function(a){function b(b,c,d){var e=d.get("tags"),f=d.get("createTag");if(void 0!==f&&(this.createTag=f),b.call(this,c,d),a.isArray(e))for(var g=0;g<e.length;g++){var h=e[g],i=this._normalizeItem(h),j=this.option(i);this.$element.append(j)}}return b.prototype.query=function(a,b,c){function d(a,f){for(var g=a.results,h=0;h<g.length;h++){var i=g[h],j=null!=i.children&&!d({results:i.children},!0),k=i.text===b.term;if(k||j)return f?!1:(a.data=g,void c(a))}if(f)return!0;var l=e.createTag(b);if(null!=l){var m=e.option(l);m.attr("data-select2-tag",!0),e.addOptions([m]),e.insertTag(g,l)}a.results=g,c(a)}var e=this;return this._removeOldTags(),null==b.term||null!=b.page?void a.call(this,b,c):void a.call(this,b,d)},b.prototype.createTag=function(b,c){var d=a.trim(c.term);return""===d?null:{id:d,text:d}},b.prototype.insertTag=function(a,b,c){b.unshift(c)},b.prototype._removeOldTags=function(b){var c=(this._lastTag,this.$element.find("option[data-select2-tag]"));c.each(function(){this.selected||a(this).remove()})},b}),b.define("select2/data/tokenizer",["jquery"],function(a){function b(a,b,c){var d=c.get("tokenizer");void 0!==d&&(this.tokenizer=d),a.call(this,b,c)}return b.prototype.bind=function(a,b,c){a.call(this,b,c),this.$search=b.dropdown.$search||b.selection.$search||c.find(".select2-search__field")},b.prototype.query=function(a,b,c){function d(a){e.trigger("select",{data:a})}var e=this;b.term=b.term||"";var f=this.tokenizer(b,this.options,d);f.term!==b.term&&(this.$search.length&&(this.$search.val(f.term),this.$search.focus()),b.term=f.term),a.call(this,b,c)},b.prototype.tokenizer=function(b,c,d,e){for(var f=d.get("tokenSeparators")||[],g=c.term,h=0,i=this.createTag||function(a){return{id:a.term,text:a.term}};h<g.length;){var j=g[h];if(-1!==a.inArray(j,f)){var k=g.substr(0,h),l=a.extend({},c,{term:k}),m=i(l);null!=m?(e(m),g=g.substr(h+1)||"",h=0):h++}else h++}return{term:g}},b}),b.define("select2/data/minimumInputLength",[],function(){function a(a,b,c){this.minimumInputLength=c.get("minimumInputLength"),a.call(this,b,c)}return a.prototype.query=function(a,b,c){return b.term=b.term||"",b.term.length<this.minimumInputLength?void this.trigger("results:message",{message:"inputTooShort",args:{minimum:this.minimumInputLength,input:b.term,params:b}}):void a.call(this,b,c)},a}),b.define("select2/data/maximumInputLength",[],function(){function a(a,b,c){this.maximumInputLength=c.get("maximumInputLength"),a.call(this,b,c)}return a.prototype.query=function(a,b,c){return b.term=b.term||"",this.maximumInputLength>0&&b.term.length>this.maximumInputLength?void this.trigger("results:message",{message:"inputTooLong",args:{maximum:this.maximumInputLength,input:b.term,params:b}}):void a.call(this,b,c)},a}),b.define("select2/data/maximumSelectionLength",[],function(){function a(a,b,c){this.maximumSelectionLength=c.get("maximumSelectionLength"),a.call(this,b,c)}return a.prototype.query=function(a,b,c){var d=this;this.current(function(e){var f=null!=e?e.length:0;return d.maximumSelectionLength>0&&f>=d.maximumSelectionLength?void d.trigger("results:message",{message:"maximumSelected",args:{maximum:d.maximumSelectionLength}}):void a.call(d,b,c)})},a}),b.define("select2/dropdown",["jquery","./utils"],function(a,b){function c(a,b){this.$element=a,this.options=b,c.__super__.constructor.call(this)}return b.Extend(c,b.Observable),c.prototype.render=function(){var b=a('<span class="select2-dropdown"><span class="select2-results"></span></span>');return b.attr("dir",this.options.get("dir")),this.$dropdown=b,b},c.prototype.bind=function(){},c.prototype.position=function(a,b){},c.prototype.destroy=function(){this.$dropdown.remove()},c}),b.define("select2/dropdown/search",["jquery","../utils"],function(a,b){function c(){}return c.prototype.render=function(b){var c=b.call(this),d=a('<span class="select2-search select2-search--dropdown"><input class="select2-search__field" type="search" tabindex="-1" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" role="textbox" /></span>');return this.$searchContainer=d,this.$search=d.find("input"),c.prepend(d),c},c.prototype.bind=function(b,c,d){var e=this;b.call(this,c,d),this.$search.on("keydown",function(a){e.trigger("keypress",a),e._keyUpPrevented=a.isDefaultPrevented()}),this.$search.on("input",function(b){a(this).off("keyup")}),this.$search.on("keyup input",function(a){e.handleSearch(a)}),c.on("open",function(){e.$search.attr("tabindex",0),e.$search.focus(),window.setTimeout(function(){e.$search.focus()},0)}),c.on("close",function(){e.$search.attr("tabindex",-1),e.$search.val("")}),c.on("results:all",function(a){if(null==a.query.term||""===a.query.term){var b=e.showSearch(a);b?e.$searchContainer.removeClass("select2-search--hide"):e.$searchContainer.addClass("select2-search--hide")}})},c.prototype.handleSearch=function(a){if(!this._keyUpPrevented){var b=this.$search.val();this.trigger("query",{term:b})}this._keyUpPrevented=!1},c.prototype.showSearch=function(a,b){return!0},c}),b.define("select2/dropdown/hidePlaceholder",[],function(){function a(a,b,c,d){this.placeholder=this.normalizePlaceholder(c.get("placeholder")),a.call(this,b,c,d)}return a.prototype.append=function(a,b){b.results=this.removePlaceholder(b.results),a.call(this,b)},a.prototype.normalizePlaceholder=function(a,b){return"string"==typeof b&&(b={id:"",text:b}),b},a.prototype.removePlaceholder=function(a,b){for(var c=b.slice(0),d=b.length-1;d>=0;d--){var e=b[d];this.placeholder.id===e.id&&c.splice(d,1)}return c},a}),b.define("select2/dropdown/infiniteScroll",["jquery"],function(a){function b(a,b,c,d){this.lastParams={},a.call(this,b,c,d),this.$loadingMore=this.createLoadingMore(),this.loading=!1}return b.prototype.append=function(a,b){this.$loadingMore.remove(),this.loading=!1,a.call(this,b),this.showLoadingMore(b)&&this.$results.append(this.$loadingMore)},b.prototype.bind=function(b,c,d){var e=this;b.call(this,c,d),c.on("query",function(a){e.lastParams=a,e.loading=!0}),c.on("query:append",function(a){e.lastParams=a,e.loading=!0}),this.$results.on("scroll",function(){var b=a.contains(document.documentElement,e.$loadingMore[0]);if(!e.loading&&b){var c=e.$results.offset().top+e.$results.outerHeight(!1),d=e.$loadingMore.offset().top+e.$loadingMore.outerHeight(!1);c+50>=d&&e.loadMore()}})},b.prototype.loadMore=function(){this.loading=!0;var b=a.extend({},{page:1},this.lastParams);b.page++,this.trigger("query:append",b)},b.prototype.showLoadingMore=function(a,b){return b.pagination&&b.pagination.more},b.prototype.createLoadingMore=function(){var b=a('<li class="select2-results__option select2-results__option--load-more"role="treeitem" aria-disabled="true"></li>'),c=this.options.get("translations").get("loadingMore");return b.html(c(this.lastParams)),b},b}),b.define("select2/dropdown/attachBody",["jquery","../utils"],function(a,b){function c(b,c,d){this.$dropdownParent=d.get("dropdownParent")||a(document.body),b.call(this,c,d)}return c.prototype.bind=function(a,b,c){var d=this,e=!1;a.call(this,b,c),b.on("open",function(){d._showDropdown(),d._attachPositioningHandler(b),e||(e=!0,b.on("results:all",function(){d._positionDropdown(),d._resizeDropdown()}),b.on("results:append",function(){d._positionDropdown(),d._resizeDropdown()}))}),b.on("close",function(){d._hideDropdown(),d._detachPositioningHandler(b)}),this.$dropdownContainer.on("mousedown",function(a){a.stopPropagation()})},c.prototype.destroy=function(a){a.call(this),this.$dropdownContainer.remove()},c.prototype.position=function(a,b,c){b.attr("class",c.attr("class")),b.removeClass("select2"),b.addClass("select2-container--open"),b.css({position:"absolute",top:-999999}),this.$container=c},c.prototype.render=function(b){var c=a("<span></span>"),d=b.call(this);return c.append(d),this.$dropdownContainer=c,c},c.prototype._hideDropdown=function(a){this.$dropdownContainer.detach()},c.prototype._attachPositioningHandler=function(c,d){var e=this,f="scroll.select2."+d.id,g="resize.select2."+d.id,h="orientationchange.select2."+d.id,i=this.$container.parents().filter(b.hasScroll);i.each(function(){a(this).data("select2-scroll-position",{x:a(this).scrollLeft(),y:a(this).scrollTop()})}),i.on(f,function(b){var c=a(this).data("select2-scroll-position");a(this).scrollTop(c.y)}),a(window).on(f+" "+g+" "+h,function(a){e._positionDropdown(),e._resizeDropdown()})},c.prototype._detachPositioningHandler=function(c,d){var e="scroll.select2."+d.id,f="resize.select2."+d.id,g="orientationchange.select2."+d.id,h=this.$container.parents().filter(b.hasScroll);h.off(e),a(window).off(e+" "+f+" "+g)},c.prototype._positionDropdown=function(){var b=a(window),c=this.$dropdown.hasClass("select2-dropdown--above"),d=this.$dropdown.hasClass("select2-dropdown--below"),e=null,f=(this.$container.position(),this.$container.offset());f.bottom=f.top+this.$container.outerHeight(!1);var g={height:this.$container.outerHeight(!1)};g.top=f.top,g.bottom=f.top+g.height;var h={height:this.$dropdown.outerHeight(!1)},i={top:b.scrollTop(),bottom:b.scrollTop()+b.height()},j=i.top<f.top-h.height,k=i.bottom>f.bottom+h.height,l={left:f.left,top:g.bottom};if("static"!==this.$dropdownParent[0].style.position){var m=this.$dropdownParent.offset();l.top-=m.top,l.left-=m.left}c||d||(e="below"),k||!j||c?!j&&k&&c&&(e="below"):e="above",("above"==e||c&&"below"!==e)&&(l.top=g.top-h.height),null!=e&&(this.$dropdown.removeClass("select2-dropdown--below select2-dropdown--above").addClass("select2-dropdown--"+e),this.$container.removeClass("select2-container--below select2-container--above").addClass("select2-container--"+e)),this.$dropdownContainer.css(l)},c.prototype._resizeDropdown=function(){var a={width:this.$container.outerWidth(!1)+"px"};this.options.get("dropdownAutoWidth")&&(a.minWidth=a.width,a.width="auto"),this.$dropdown.css(a)},c.prototype._showDropdown=function(a){this.$dropdownContainer.appendTo(this.$dropdownParent),this._positionDropdown(),this._resizeDropdown()},c}),b.define("select2/dropdown/minimumResultsForSearch",[],function(){function a(b){for(var c=0,d=0;d<b.length;d++){var e=b[d];e.children?c+=a(e.children):c++}return c}function b(a,b,c,d){this.minimumResultsForSearch=c.get("minimumResultsForSearch"),this.minimumResultsForSearch<0&&(this.minimumResultsForSearch=1/0),a.call(this,b,c,d)}return b.prototype.showSearch=function(b,c){return a(c.data.results)<this.minimumResultsForSearch?!1:b.call(this,c)},b}),b.define("select2/dropdown/selectOnClose",[],function(){function a(){}return a.prototype.bind=function(a,b,c){var d=this;a.call(this,b,c),b.on("close",function(){d._handleSelectOnClose()})},a.prototype._handleSelectOnClose=function(){var a=this.getHighlightedResults();if(!(a.length<1)){var b=a.data("data");null!=b.element&&b.element.selected||null==b.element&&b.selected||this.trigger("select",{data:b})}},a}),b.define("select2/dropdown/closeOnSelect",[],function(){function a(){}return a.prototype.bind=function(a,b,c){var d=this;a.call(this,b,c),b.on("select",function(a){d._selectTriggered(a)}),b.on("unselect",function(a){d._selectTriggered(a)})},a.prototype._selectTriggered=function(a,b){var c=b.originalEvent;c&&c.ctrlKey||this.trigger("close",{})},a}),b.define("select2/i18n/en",[],function(){return{errorLoading:function(){return"The results could not be loaded."},inputTooLong:function(a){var b=a.input.length-a.maximum,c="Please delete "+b+" character";return 1!=b&&(c+="s"),c},inputTooShort:function(a){var b=a.minimum-a.input.length,c="Please enter "+b+" or more characters";return c},loadingMore:function(){return"Loading more results…"},maximumSelected:function(a){var b="You can only select "+a.maximum+" item";return 1!=a.maximum&&(b+="s"),b},noResults:function(){return"No results found"},searching:function(){return"Searching…"}}}),b.define("select2/defaults",["jquery","require","./results","./selection/single","./selection/multiple","./selection/placeholder","./selection/allowClear","./selection/search","./selection/eventRelay","./utils","./translation","./diacritics","./data/select","./data/array","./data/ajax","./data/tags","./data/tokenizer","./data/minimumInputLength","./data/maximumInputLength","./data/maximumSelectionLength","./dropdown","./dropdown/search","./dropdown/hidePlaceholder","./dropdown/infiniteScroll","./dropdown/attachBody","./dropdown/minimumResultsForSearch","./dropdown/selectOnClose","./dropdown/closeOnSelect","./i18n/en"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C){function D(){this.reset()}D.prototype.apply=function(l){if(l=a.extend({},this.defaults,l),null==l.dataAdapter){if(null!=l.ajax?l.dataAdapter=o:null!=l.data?l.dataAdapter=n:l.dataAdapter=m,l.minimumInputLength>0&&(l.dataAdapter=j.Decorate(l.dataAdapter,r)),l.maximumInputLength>0&&(l.dataAdapter=j.Decorate(l.dataAdapter,s)),l.maximumSelectionLength>0&&(l.dataAdapter=j.Decorate(l.dataAdapter,t)),l.tags&&(l.dataAdapter=j.Decorate(l.dataAdapter,p)),(null!=l.tokenSeparators||null!=l.tokenizer)&&(l.dataAdapter=j.Decorate(l.dataAdapter,q)),null!=l.query){var C=b(l.amdBase+"compat/query");l.dataAdapter=j.Decorate(l.dataAdapter,C)}if(null!=l.initSelection){var D=b(l.amdBase+"compat/initSelection");l.dataAdapter=j.Decorate(l.dataAdapter,D)}}if(null==l.resultsAdapter&&(l.resultsAdapter=c,null!=l.ajax&&(l.resultsAdapter=j.Decorate(l.resultsAdapter,x)),null!=l.placeholder&&(l.resultsAdapter=j.Decorate(l.resultsAdapter,w)),l.selectOnClose&&(l.resultsAdapter=j.Decorate(l.resultsAdapter,A))),null==l.dropdownAdapter){if(l.multiple)l.dropdownAdapter=u;else{var E=j.Decorate(u,v);l.dropdownAdapter=E}if(0!==l.minimumResultsForSearch&&(l.dropdownAdapter=j.Decorate(l.dropdownAdapter,z)),l.closeOnSelect&&(l.dropdownAdapter=j.Decorate(l.dropdownAdapter,B)),null!=l.dropdownCssClass||null!=l.dropdownCss||null!=l.adaptDropdownCssClass){var F=b(l.amdBase+"compat/dropdownCss");l.dropdownAdapter=j.Decorate(l.dropdownAdapter,F)}l.dropdownAdapter=j.Decorate(l.dropdownAdapter,y)}if(null==l.selectionAdapter){if(l.multiple?l.selectionAdapter=e:l.selectionAdapter=d,null!=l.placeholder&&(l.selectionAdapter=j.Decorate(l.selectionAdapter,f)),l.allowClear&&(l.selectionAdapter=j.Decorate(l.selectionAdapter,g)),l.multiple&&(l.selectionAdapter=j.Decorate(l.selectionAdapter,h)),null!=l.containerCssClass||null!=l.containerCss||null!=l.adaptContainerCssClass){var G=b(l.amdBase+"compat/containerCss");l.selectionAdapter=j.Decorate(l.selectionAdapter,G)}l.selectionAdapter=j.Decorate(l.selectionAdapter,i)}if("string"==typeof l.language)if(l.language.indexOf("-")>0){var H=l.language.split("-"),I=H[0];l.language=[l.language,I]}else l.language=[l.language];if(a.isArray(l.language)){var J=new k;l.language.push("en");for(var K=l.language,L=0;L<K.length;L++){var M=K[L],N={};try{N=k.loadPath(M)}catch(O){try{M=this.defaults.amdLanguageBase+M,N=k.loadPath(M)}catch(P){l.debug&&window.console&&console.warn&&console.warn('Select2: The language file for "'+M+'" could not be automatically loaded. A fallback will be used instead.');continue}}J.extend(N)}l.translations=J}else{var Q=k.loadPath(this.defaults.amdLanguageBase+"en"),R=new k(l.language);R.extend(Q),l.translations=R}return l},D.prototype.reset=function(){function b(a){function b(a){return l[a]||a}return a.replace(/[^\u0000-\u007E]/g,b)}function c(d,e){if(""===a.trim(d.term))return e;if(e.children&&e.children.length>0){for(var f=a.extend(!0,{},e),g=e.children.length-1;g>=0;g--){var h=e.children[g],i=c(d,h);null==i&&f.children.splice(g,1)}return f.children.length>0?f:c(d,f)}var j=b(e.text).toUpperCase(),k=b(d.term).toUpperCase();return j.indexOf(k)>-1?e:null}this.defaults={amdBase:"./",amdLanguageBase:"./i18n/",closeOnSelect:!0,debug:!1,dropdownAutoWidth:!1,escapeMarkup:j.escapeMarkup,language:C,matcher:c,minimumInputLength:0,maximumInputLength:0,maximumSelectionLength:0,minimumResultsForSearch:0,selectOnClose:!1,sorter:function(a){return a},templateResult:function(a){return a.text},templateSelection:function(a){return a.text},theme:"default",width:"resolve"}},D.prototype.set=function(b,c){var d=a.camelCase(b),e={};e[d]=c;var f=j._convertData(e);a.extend(this.defaults,f)};var E=new D;return E}),b.define("select2/options",["require","jquery","./defaults","./utils"],function(a,b,c,d){function e(b,e){if(this.options=b,null!=e&&this.fromElement(e),this.options=c.apply(this.options),e&&e.is("input")){var f=a(this.get("amdBase")+"compat/inputData");this.options.dataAdapter=d.Decorate(this.options.dataAdapter,f)}}return e.prototype.fromElement=function(a){var c=["select2"];null==this.options.multiple&&(this.options.multiple=a.prop("multiple")),null==this.options.disabled&&(this.options.disabled=a.prop("disabled")),null==this.options.language&&(a.prop("lang")?this.options.language=a.prop("lang").toLowerCase():a.closest("[lang]").prop("lang")&&(this.options.language=a.closest("[lang]").prop("lang"))),null==this.options.dir&&(a.prop("dir")?this.options.dir=a.prop("dir"):a.closest("[dir]").prop("dir")?this.options.dir=a.closest("[dir]").prop("dir"):this.options.dir="ltr"),a.prop("disabled",this.options.disabled),a.prop("multiple",this.options.multiple),a.data("select2Tags")&&(this.options.debug&&window.console&&console.warn&&console.warn('Select2: The `data-select2-tags` attribute has been changed to use the `data-data` and `data-tags="true"` attributes and will be removed in future versions of Select2.'),a.data("data",a.data("select2Tags")),a.data("tags",!0)),a.data("ajaxUrl")&&(this.options.debug&&window.console&&console.warn&&console.warn("Select2: The `data-ajax-url` attribute has been changed to `data-ajax--url` and support for the old attribute will be removed in future versions of Select2."),a.attr("ajax--url",a.data("ajaxUrl")),a.data("ajax--url",a.data("ajaxUrl")));var e={};e=b.fn.jquery&&"1."==b.fn.jquery.substr(0,2)&&a[0].dataset?b.extend(!0,{},a[0].dataset,a.data()):a.data();var f=b.extend(!0,{},e);f=d._convertData(f);for(var g in f)b.inArray(g,c)>-1||(b.isPlainObject(this.options[g])?b.extend(this.options[g],f[g]):this.options[g]=f[g]);return this},e.prototype.get=function(a){return this.options[a]},e.prototype.set=function(a,b){this.options[a]=b},e}),b.define("select2/core",["jquery","./options","./utils","./keys"],function(a,b,c,d){var e=function(a,c){null!=a.data("select2")&&a.data("select2").destroy(),this.$element=a,this.id=this._generateId(a),c=c||{},this.options=new b(c,a),e.__super__.constructor.call(this);var d=a.attr("tabindex")||0;a.data("old-tabindex",d),a.attr("tabindex","-1");var f=this.options.get("dataAdapter");this.dataAdapter=new f(a,this.options);var g=this.render();this._placeContainer(g);var h=this.options.get("selectionAdapter");this.selection=new h(a,this.options),this.$selection=this.selection.render(),this.selection.position(this.$selection,g);var i=this.options.get("dropdownAdapter");this.dropdown=new i(a,this.options),this.$dropdown=this.dropdown.render(),this.dropdown.position(this.$dropdown,g);var j=this.options.get("resultsAdapter");this.results=new j(a,this.options,this.dataAdapter),this.$results=this.results.render(),this.results.position(this.$results,this.$dropdown);var k=this;this._bindAdapters(),this._registerDomEvents(),this._registerDataEvents(),this._registerSelectionEvents(),this._registerDropdownEvents(),this._registerResultsEvents(),this._registerEvents(),this.dataAdapter.current(function(a){k.trigger("selection:update",{data:a})}),a.addClass("select2-hidden-accessible"),a.attr("aria-hidden","true"),this._syncAttributes(),a.data("select2",this)};return c.Extend(e,c.Observable),e.prototype._generateId=function(a){var b="";return b=null!=a.attr("id")?a.attr("id"):null!=a.attr("name")?a.attr("name")+"-"+c.generateChars(2):c.generateChars(4),b="select2-"+b},e.prototype._placeContainer=function(a){a.insertAfter(this.$element);var b=this._resolveWidth(this.$element,this.options.get("width"));null!=b&&a.css("width",b)},e.prototype._resolveWidth=function(a,b){var c=/^width:(([-+]?([0-9]*\.)?[0-9]+)(px|em|ex|%|in|cm|mm|pt|pc))/i;if("resolve"==b){var d=this._resolveWidth(a,"style");return null!=d?d:this._resolveWidth(a,"element")}if("element"==b){var e=a.outerWidth(!1);return 0>=e?"auto":e+"px"}if("style"==b){var f=a.attr("style");if("string"!=typeof f)return null;for(var g=f.split(";"),h=0,i=g.length;i>h;h+=1){var j=g[h].replace(/\s/g,""),k=j.match(c);if(null!==k&&k.length>=1)return k[1]}return null}return b},e.prototype._bindAdapters=function(){this.dataAdapter.bind(this,this.$container),this.selection.bind(this,this.$container),this.dropdown.bind(this,this.$container),this.results.bind(this,this.$container)},e.prototype._registerDomEvents=function(){var b=this;this.$element.on("change.select2",function(){b.dataAdapter.current(function(a){b.trigger("selection:update",{data:a})})}),this._sync=c.bind(this._syncAttributes,this),this.$element[0].attachEvent&&this.$element[0].attachEvent("onpropertychange",this._sync);var d=window.MutationObserver||window.WebKitMutationObserver||window.MozMutationObserver;null!=d?(this._observer=new d(function(c){a.each(c,b._sync)}),this._observer.observe(this.$element[0],{attributes:!0,subtree:!1})):this.$element[0].addEventListener&&this.$element[0].addEventListener("DOMAttrModified",b._sync,!1)},e.prototype._registerDataEvents=function(){var a=this;this.dataAdapter.on("*",function(b,c){a.trigger(b,c)})},e.prototype._registerSelectionEvents=function(){var b=this,c=["toggle","focus"];this.selection.on("toggle",function(){b.toggleDropdown()}),this.selection.on("focus",function(a){b.focus(a)}),this.selection.on("*",function(d,e){-1===a.inArray(d,c)&&b.trigger(d,e)})},e.prototype._registerDropdownEvents=function(){var a=this;this.dropdown.on("*",function(b,c){a.trigger(b,c)})},e.prototype._registerResultsEvents=function(){var a=this;this.results.on("*",function(b,c){a.trigger(b,c)})},e.prototype._registerEvents=function(){var a=this;this.on("open",function(){a.$container.addClass("select2-container--open")}),this.on("close",function(){a.$container.removeClass("select2-container--open")}),this.on("enable",function(){a.$container.removeClass("select2-container--disabled")}),this.on("disable",function(){a.$container.addClass("select2-container--disabled")}),this.on("blur",function(){a.$container.removeClass("select2-container--focus")}),this.on("query",function(b){a.isOpen()||a.trigger("open",{}),this.dataAdapter.query(b,function(c){a.trigger("results:all",{data:c,query:b})})}),this.on("query:append",function(b){this.dataAdapter.query(b,function(c){a.trigger("results:append",{data:c,query:b})})}),this.on("keypress",function(b){var c=b.which;a.isOpen()?c===d.ESC||c===d.TAB||c===d.UP&&b.altKey?(a.close(),b.preventDefault()):c===d.ENTER?(a.trigger("results:select",{}),b.preventDefault()):c===d.SPACE&&b.ctrlKey?(a.trigger("results:toggle",{}),b.preventDefault()):c===d.UP?(a.trigger("results:previous",{}),b.preventDefault()):c===d.DOWN&&(a.trigger("results:next",{}),b.preventDefault()):(c===d.ENTER||c===d.SPACE||c===d.DOWN&&b.altKey)&&(a.open(),b.preventDefault())})},e.prototype._syncAttributes=function(){this.options.set("disabled",this.$element.prop("disabled")),this.options.get("disabled")?(this.isOpen()&&this.close(),this.trigger("disable",{})):this.trigger("enable",{})},e.prototype.trigger=function(a,b){var c=e.__super__.trigger,d={open:"opening",close:"closing",select:"selecting",unselect:"unselecting"};if(void 0===b&&(b={}),a in d){var f=d[a],g={prevented:!1,name:a,args:b};if(c.call(this,f,g),g.prevented)return void(b.prevented=!0)}c.call(this,a,b)},e.prototype.toggleDropdown=function(){this.options.get("disabled")||(this.isOpen()?this.close():this.open())},e.prototype.open=function(){this.isOpen()||this.trigger("query",{})},e.prototype.close=function(){this.isOpen()&&this.trigger("close",{})},e.prototype.isOpen=function(){return this.$container.hasClass("select2-container--open")},e.prototype.hasFocus=function(){return this.$container.hasClass("select2-container--focus")},e.prototype.focus=function(a){this.hasFocus()||(this.$container.addClass("select2-container--focus"),this.trigger("focus",{}))},e.prototype.enable=function(a){this.options.get("debug")&&window.console&&console.warn&&console.warn('Select2: The `select2("enable")` method has been deprecated and will be removed in later Select2 versions. Use $element.prop("disabled") instead.'),(null==a||0===a.length)&&(a=[!0]);var b=!a[0];this.$element.prop("disabled",b)},e.prototype.data=function(){this.options.get("debug")&&arguments.length>0&&window.console&&console.warn&&console.warn('Select2: Data can no longer be set using `select2("data")`. You should consider setting the value instead using `$element.val()`.');var a=[];return this.dataAdapter.current(function(b){a=b}),a},e.prototype.val=function(b){if(this.options.get("debug")&&window.console&&console.warn&&console.warn('Select2: The `select2("val")` method has been deprecated and will be removed in later Select2 versions. Use $element.val() instead.'),null==b||0===b.length)return this.$element.val();var c=b[0];a.isArray(c)&&(c=a.map(c,function(a){return a.toString()})),this.$element.val(c).trigger("change")},e.prototype.destroy=function(){this.$container.remove(),this.$element[0].detachEvent&&this.$element[0].detachEvent("onpropertychange",this._sync),null!=this._observer?(this._observer.disconnect(),this._observer=null):this.$element[0].removeEventListener&&this.$element[0].removeEventListener("DOMAttrModified",this._sync,!1),this._sync=null,this.$element.off(".select2"),this.$element.attr("tabindex",this.$element.data("old-tabindex")),this.$element.removeClass("select2-hidden-accessible"),this.$element.attr("aria-hidden","false"),this.$element.removeData("select2"),this.dataAdapter.destroy(),this.selection.destroy(),this.dropdown.destroy(),this.results.destroy(),this.dataAdapter=null,this.selection=null,this.dropdown=null,this.results=null},e.prototype.render=function(){var b=a('<span class="select2 select2-container"><span class="selection"></span><span class="dropdown-wrapper" aria-hidden="true"></span></span>');return b.attr("dir",this.options.get("dir")),this.$container=b,this.$container.addClass("select2-container--"+this.options.get("theme")),b.data("element",this.$element),b},e}),b.define("jquery-mousewheel",["jquery"],function(a){return a}),b.define("jquery.select2",["jquery","jquery-mousewheel","./select2/core","./select2/defaults"],function(a,b,c,d){if(null==a.fn.select2){var e=["open","close","destroy"];a.fn.select2=function(b){if(b=b||{},"object"==typeof b)return this.each(function(){var d=a.extend(!0,{},b);new c(a(this),d)}),this;if("string"==typeof b){var d;return this.each(function(){var c=a(this).data("select2");null==c&&window.console&&console.error&&console.error("The select2('"+b+"') method was called on an element that is not using Select2.");var e=Array.prototype.slice.call(arguments,1);d=c[b].apply(c,e)}),a.inArray(b,e)>-1?this:d}throw new Error("Invalid arguments for Select2: "+b)}}return null==a.fn.select2.defaults&&(a.fn.select2.defaults=d),c}),{define:b.define,require:b.require}}(),c=b.require("jquery.select2");return a.fn.select2.amd=b,c});/**
 *  This file is part of Wigii.
 *  Wigii is developed to inspire humanity. To Humankind we offer Gracefulness, Righteousness and Goodness.
 *  
 *  Wigii is free software: you can redistribute it and/or modify it 
 *  under the terms of the GNU General Public License as published by
 *  the Free Software Foundation, either version 3 of the License, 
 *  or (at your option) any later version.
 *  
 *  Wigii is distributed in the hope that it will be useful, but WITHOUT ANY WARRANTY; 
 *  without even the implied warranty of MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  
 *  See the GNU General Public License for more details.
 *
 *  A copy of the GNU General Public License is available in the Readme folder of the source code.  
 *  If not, see <http://www.gnu.org/licenses/>.
 *
 *  @copyright  Copyright (c) 2016  Wigii.org
 *  @author     <http://www.wigii.org/system>      Wigii.org 
 *  @link       <http://www.wigii-system.net>      <https://github.com/wigii/wigii>   Source Code
 *  @license    <http://www.gnu.org/licenses/>     GNU General Public License
 */

/**
 * Customized select2 minimumInputLength decorator which passes through defaultOptions and blocks or not ajax calls.
 * Created by Medair(CWE) on 19.02.2018
 */
$.fn.select2.amd.define('select2/data/wigiiMinimumInputLength',[	
], function () {
  function WigiiMinimumInputLength (decorated, $e, options) {
    this.minimumInputLength = options.get('minimumInputLength');
    this.selectId = options.get('selectId');
    decorated.call(this, $e, options);
  }

  WigiiMinimumInputLength.prototype.query = function (decorated, params, callback) {
    params.term = params.term || '';
    params.term = params.term.trim();
    var selectedValue = $('#'+this.selectId).val();
    
    // shows user invite to enter a search term
    if (params.term.length == 0 && !selectedValue) {
      this.trigger('results:message', {
        message: 'inputTooShort',
        args: {
          minimum: this.minimumInputLength,
          input: params.term,
          params: params
        }
      });
      return;
    }
    // if search term length is smaller than minimum required, blocks ajax and only shows default options
    else if (params.term.length < this.minimumInputLength) {
      params.blockAjax=true;
    }   
    // fetches default options present in DOM
    params.defaultOptions = [];
    $('#'+this.selectId+' option').each(function(i){
    	var opt = $(this);
    	params.defaultOptions.push({'id':opt.attr('value'),'text':opt.text()});
    });
    decorated.call(this, params, callback);
  };

  return WigiiMinimumInputLength;
});


/**
 * Customized select2 ajax adapter to handle default options and conditional ajax calls.
 * Based on the select2/ajax DataAdapter.
 * Created by Medair(CWE) on 19.02.2018 
 */
$.fn.select2.amd.define('select2/data/wigiiAjaxAdapter',[
  'select2/data/array',
  'select2/utils',
  'select2/data/wigiiMinimumInputLength',
], function (ArrayAdapter, Utils, MinimumInputLength) {
  function WigiiAjaxAdapter ($element, options) {
    this.ajaxOptions = this._applyDefaults(options.get('ajax'));
    
    if (this.ajaxOptions.processResults != null) {
      this.processResults = this.ajaxOptions.processResults;
    }

    WigiiAjaxAdapter.__super__.constructor.call(this, $element, options);
  }

  Utils.Extend(WigiiAjaxAdapter, ArrayAdapter);

  WigiiAjaxAdapter.prototype._applyDefaults = function (options) {
    var defaults = {
      data: function (params) {
        return $.extend({}, params, {
          q: params.term
        });
      },
      transport: function (params, success, failure) {
        var $request = $.ajax(params);

        $request.then(success);
        $request.fail(failure);

        return $request;
      }
    };

    return $.extend({}, defaults, options, true);
  };

  WigiiAjaxAdapter.prototype.processResults = function (results) {
    return results;
  };

  WigiiAjaxAdapter.prototype.query = function (params, callback) {
    var matches = [];
    var self = this;

    if(params.blockAjax) {
    	// filters defaultOptions with search term
    	if(params.defaultOptions) {
    		if(params.term != '') {
    			var ucTerm = params.term.toUpperCase();
	    		for(var i=0;i<params.defaultOptions.length;i++) {	    			
	    			var opt = params.defaultOptions[i];
	    			// keeps empty value
	    			if(opt.id == '') matches.push(opt);
	    			// else filters with search term
	    			else if(opt.id.toUpperCase().indexOf(ucTerm) > -1 || opt.text.toUpperCase().indexOf(ucTerm) > -1) matches.push(opt);
	    		}
    		}
    		else matches = params.defaultOptions;
    	}
    	callback({'results':matches});
    	return;
    }
    
    if (this._request != null) {
      // JSONP requests cannot always be aborted
      if ($.isFunction(this._request.abort)) {
        this._request.abort();
      }

      this._request = null;
    }

    var options = $.extend({
      type: 'GET'
    }, this.ajaxOptions);

    if (typeof options.url === 'function') {
      options.url = options.url.call(this.$element, params);
    }

    if (typeof options.data === 'function') {
      options.data = options.data.call(this.$element, params);
    }

    function request () {
    	var $request = options.transport(options, function (data) {
        var results = self.processResults(data, params);

        // Extends results with default options
        if(params.defaultOptions) {
        	var ucTerm = '';
        	if(params.term != '') ucTerm = params.term.toUpperCase();
        	var matching = results.results;
        	var matchingIndex = {};
        	// Rebuilds results array
        	results.results = [];
        	// First puts default options
    		for(var i=0;i<params.defaultOptions.length;i++) {
    			var opt = params.defaultOptions[i];
    			// keeps empty value
    			// and filters with search term
    			if(opt.id == '' || opt.id.toUpperCase().indexOf(ucTerm) > -1 || opt.text.toUpperCase().indexOf(ucTerm) > -1) {
    				results.results.push(opt);
    				matchingIndex[opt.id] = true;
    			}
    		}
    		// then, filters duplicates and builds result
    		for(var i=0;i<matching.length;i++) {
    			var opt = matching[i];
    			if(!matchingIndex[opt.id]) {
    				results.results.push(opt);
    				matchingIndex[opt.id] = true;
    			}
    		}
        }       
        
        if (self.options.get('debug') && window.console && console.error) {
          // Check to make sure that the response included a `results` key.
          if (!results || !results.results || !$.isArray(results.results)) {
            console.error(
              'Select2: The AJAX results did not return an array in the ' +
              '`results` key of the response.'
            );
          }
        }

        callback(results);
      }, function () {
        // Attempt to detect if a request was aborted
        // Only works if the transport exposes a status property
        if ($request.status && $request.status === '0') {
          return;
        }

        self.trigger('results:message', {
          message: 'errorLoading'
        });
      });

      self._request = $request;
    }

    if (this.ajaxOptions.delay && params.term != null) {
      if (this._queryTimeout) {
        window.clearTimeout(this._queryTimeout);
      }

      this._queryTimeout = window.setTimeout(request, this.ajaxOptions.delay);
    } else {
      request();
    }
  };
  // Decorates with mininum input length
  return Utils.Decorate(WigiiAjaxAdapter,MinimumInputLength);
});
﻿/*!
 * jQuery blockUI plugin
 * Version 2.59.0-2013.04.05
 * @requires jQuery v1.7 or later
 *
 * Examples at: http://malsup.com/jquery/block/
 * Copyright (c) 2007-2013 M. Alsup
 * Dual licensed under the MIT and GPL licenses:
 * http://www.opensource.org/licenses/mit-license.php
 * http://www.gnu.org/licenses/gpl.html
 *
 * Thanks to Amir-Hossein Sobhi for some excellent contributions!
 */

;(function() {
/*jshint eqeqeq:false curly:false latedef:false */
"use strict";

	function setup($) {
		$.fn._fadeIn = $.fn.fadeIn;

		var noOp = $.noop || function() {};

		// this bit is to ensure we don't call setExpression when we shouldn't (with extra muscle to handle
		// retarded userAgent strings on Vista)
		var msie = /MSIE/.test(navigator.userAgent);
		var ie6  = /MSIE 6.0/.test(navigator.userAgent) && ! /MSIE 8.0/.test(navigator.userAgent);
		var mode = document.documentMode || 0;
		var setExpr = $.isFunction( document.createElement('div').style.setExpression );

		// global $ methods for blocking/unblocking the entire page
		$.blockUI   = function(opts) { install(window, opts); };
		$.unblockUI = function(opts) { remove(window, opts); };

		// convenience method for quick growl-like notifications  (http://www.google.com/search?q=growl)
		$.growlUI = function(title, message, timeout, onClose) {
			var $m = $('<div class="growlUI"></div>');
			if (title) $m.append('<h1>'+title+'</h1>');
			if (message) $m.append('<h2>'+message+'</h2>');
			if (timeout === undefined) timeout = 3000;
			$.blockUI({
				message: $m, fadeIn: 700, fadeOut: 1000, centerY: false,
				timeout: timeout, showOverlay: false,
				onUnblock: onClose,
				css: $.blockUI.defaults.growlCSS
			});
		};

		// plugin method for blocking element content
		$.fn.block = function(opts) {
			if ( this[0] === window ) {
				$.blockUI( opts );
				return this;
			}
			var fullOpts = $.extend({}, $.blockUI.defaults, opts || {});
			this.each(function() {
				var $el = $(this);
				if (fullOpts.ignoreIfBlocked && $el.data('blockUI.isBlocked'))
					return;
				$el.unblock({ fadeOut: 0 });
			});

			return this.each(function() {
				if ($.css(this,'position') == 'static') {
					this.style.position = 'relative';
					$(this).data('blockUI.static', true);
				}
				this.style.zoom = 1; // force 'hasLayout' in ie
				install(this, opts);
			});
		};

		// plugin method for unblocking element content
		$.fn.unblock = function(opts) {
			if ( this[0] === window ) {
				$.unblockUI( opts );
				return this;
			}
			return this.each(function() {
				remove(this, opts);
			});
		};

		$.blockUI.version = 2.59; // 2nd generation blocking at no extra cost!

		// override these in your code to change the default behavior and style
		$.blockUI.defaults = {
			// message displayed when blocking (use null for no message)
			message:  '<h1>Please wait...</h1>',

			title: null,		// title string; only used when theme == true
			draggable: true,	// only used when theme == true (requires jquery-ui.js to be loaded)

			theme: false, // set to true to use with jQuery UI themes

			// styles for the message when blocking; if you wish to disable
			// these and use an external stylesheet then do this in your code:
			// $.blockUI.defaults.css = {};
			css: {
				padding:	0,
				margin:		0,
				width:		'30%',
				top:		'40%',
				left:		'35%',
				textAlign:	'center',
				color:		'#000',
				border:		'3px solid #aaa',
				backgroundColor:'#fff',
				cursor:		'wait'
			},

			// minimal style set used when themes are used
			themedCSS: {
				width:	'30%',
				top:	'40%',
				left:	'35%'
			},

			// styles for the overlay
			overlayCSS:  {
				backgroundColor:	'#000',
				opacity:			0.6,
				cursor:				'wait'
			},

			// style to replace wait cursor before unblocking to correct issue
			// of lingering wait cursor
			cursorReset: 'default',

			// styles applied when using $.growlUI
			growlCSS: {
				width:		'350px',
				top:		'10px',
				left:		'',
				right:		'10px',
				border:		'none',
				padding:	'5px',
				opacity:	0.6,
				cursor:		'default',
				color:		'#fff',
				backgroundColor: '#000',
				'-webkit-border-radius':'10px',
				'-moz-border-radius':	'10px',
				'border-radius':		'10px'
			},

			// IE issues: 'about:blank' fails on HTTPS and javascript:false is s-l-o-w
			// (hat tip to Jorge H. N. de Vasconcelos)
			/*jshint scripturl:true */
			iframeSrc: /^https/i.test(window.location.href || '') ? 'javascript:false' : 'about:blank',

			// force usage of iframe in non-IE browsers (handy for blocking applets)
			forceIframe: false,

			// z-index for the blocking overlay
			baseZ: 99999,

			// set these to true to have the message automatically centered
			centerX: true, // <-- only effects element blocking (page block controlled via css above)
			centerY: true,

			// allow body element to be stetched in ie6; this makes blocking look better
			// on "short" pages.  disable if you wish to prevent changes to the body height
			allowBodyStretch: true,

			// enable if you want key and mouse events to be disabled for content that is blocked
			bindEvents: true,

			// be default blockUI will supress tab navigation from leaving blocking content
			// (if bindEvents is true)
			constrainTabKey: true,

			// fadeIn time in millis; set to 0 to disable fadeIn on block
			fadeIn:  200,

			// fadeOut time in millis; set to 0 to disable fadeOut on unblock
			fadeOut:  400,

			// time in millis to wait before auto-unblocking; set to 0 to disable auto-unblock
			timeout: 0,

			// disable if you don't want to show the overlay
			showOverlay: true,

			// if true, focus will be placed in the first available input field when
			// page blocking
			focusInput: true,

			// suppresses the use of overlay styles on FF/Linux (due to performance issues with opacity)
			// no longer needed in 2012
			// applyPlatformOpacityRules: true,

			// callback method invoked when fadeIn has completed and blocking message is visible
			onBlock: null,

			// callback method invoked when unblocking has completed; the callback is
			// passed the element that has been unblocked (which is the window object for page
			// blocks) and the options that were passed to the unblock call:
			//	onUnblock(element, options)
			onUnblock: null,

			// callback method invoked when the overlay area is clicked.
			// setting this will turn the cursor to a pointer, otherwise cursor defined in overlayCss will be used.
			onOverlayClick: null,

			// don't ask; if you really must know: http://groups.google.com/group/jquery-en/browse_thread/thread/36640a8730503595/2f6a79a77a78e493#2f6a79a77a78e493
			quirksmodeOffsetHack: 4,

			// class name of the message block
			blockMsgClass: 'blockMsg',

			// if it is already blocked, then ignore it (don't unblock and reblock)
			ignoreIfBlocked: false
		};

		// private data and functions follow...

		var pageBlock = null;
		var pageBlockEls = [];

		function install(el, opts) {
			var css, themedCSS;
			var full = (el == window);
			var msg = (opts && opts.message !== undefined ? opts.message : undefined);
			opts = $.extend({}, $.blockUI.defaults, opts || {});

			if (opts.ignoreIfBlocked && $(el).data('blockUI.isBlocked'))
				return;

			opts.overlayCSS = $.extend({}, $.blockUI.defaults.overlayCSS, opts.overlayCSS || {});
			css = $.extend({}, $.blockUI.defaults.css, opts.css || {});
			if (opts.onOverlayClick)
				opts.overlayCSS.cursor = 'pointer';

			themedCSS = $.extend({}, $.blockUI.defaults.themedCSS, opts.themedCSS || {});
			msg = msg === undefined ? opts.message : msg;

			// remove the current block (if there is one)
			if (full && pageBlock)
				remove(window, {fadeOut:0});

			// if an existing element is being used as the blocking content then we capture
			// its current place in the DOM (and current display style) so we can restore
			// it when we unblock
			if (msg && typeof msg != 'string' && (msg.parentNode || msg.jquery)) {
				var node = msg.jquery ? msg[0] : msg;
				var data = {};
				$(el).data('blockUI.history', data);
				data.el = node;
				data.parent = node.parentNode;
				data.display = node.style.display;
				data.position = node.style.position;
				if (data.parent)
					data.parent.removeChild(node);
			}

			$(el).data('blockUI.onUnblock', opts.onUnblock);
			var z = opts.baseZ;

			// blockUI uses 3 layers for blocking, for simplicity they are all used on every platform;
			// layer1 is the iframe layer which is used to supress bleed through of underlying content
			// layer2 is the overlay layer which has opacity and a wait cursor (by default)
			// layer3 is the message content that is displayed while blocking
			var lyr1, lyr2, lyr3, s;
			if (msie || opts.forceIframe)
				lyr1 = $('<iframe class="blockUI" style="z-index:'+ (z++) +';display:none;border:none;margin:0;padding:0;position:absolute;width:100%;height:100%;top:0;left:0" src="'+opts.iframeSrc+'"></iframe>');
			else
				lyr1 = $('<div class="blockUI" style="display:none"></div>');

			if (opts.theme)
				lyr2 = $('<div class="blockUI blockOverlay ui-widget-overlay" style="z-index:'+ (z++) +';display:none"></div>');
			else
				lyr2 = $('<div class="blockUI blockOverlay" style="z-index:'+ (z++) +';display:none;border:none;margin:0;padding:0;width:100%;height:100%;top:0;left:0"></div>');

			if (opts.theme && full) {
				s = '<div class="blockUI ' + opts.blockMsgClass + ' blockPage ui-dialog ui-widget ui-corner-all" style="z-index:'+(z+10)+';display:none;position:fixed">';
				if ( opts.title ) {
					s += '<div class="ui-widget-header ui-dialog-titlebar ui-corner-all blockTitle">'+(opts.title || '&nbsp;')+'</div>';
				}
				s += '<div class="ui-widget-content ui-dialog-content"></div>';
				s += '</div>';
			}
			else if (opts.theme) {
				s = '<div class="blockUI ' + opts.blockMsgClass + ' blockElement ui-dialog ui-widget ui-corner-all" style="z-index:'+(z+10)+';display:none;position:absolute">';
				if ( opts.title ) {
					s += '<div class="ui-widget-header ui-dialog-titlebar ui-corner-all blockTitle">'+(opts.title || '&nbsp;')+'</div>';
				}  
				s += '<div class="ui-widget-content ui-dialog-content"></div>';
				s += '</div>';
			}
			else if (full) {
				s = '<div class="blockUI ' + opts.blockMsgClass + ' blockPage" style="z-index:'+(z+10)+';display:none;position:fixed"></div>';
			}
			else {
				s = '<div class="blockUI ' + opts.blockMsgClass + ' blockElement" style="z-index:'+(z+10)+';display:none;position:absolute"></div>';
			}
			lyr3 = $(s);

			// if we have a message, style it
			if (msg) {
				if (opts.theme) {
					lyr3.css(themedCSS);
					lyr3.addClass('ui-widget-content');
				}
				else
					lyr3.css(css);
			}

			// style the overlay
			if (!opts.theme /*&& (!opts.applyPlatformOpacityRules)*/)
				lyr2.css(opts.overlayCSS);
			lyr2.css('position', full ? 'fixed' : 'absolute');

			// make iframe layer transparent in IE
			if (msie || opts.forceIframe)
				lyr1.css('opacity',0.0);

			//$([lyr1[0],lyr2[0],lyr3[0]]).appendTo(full ? 'body' : el);
			var layers = [lyr1,lyr2,lyr3], $par = full ? $('body') : $(el);
			$.each(layers, function() {
				this.appendTo($par);
			});

			if (opts.theme && opts.draggable && $.fn.draggable) {
				lyr3.draggable({
					handle: '.ui-dialog-titlebar',
					cancel: 'li'
				});
			}

			// ie7 must use absolute positioning in quirks mode and to account for activex issues (when scrolling)
			var expr = setExpr && (!$.support.boxModel || $('object,embed', full ? null : el).length > 0);
			if (ie6 || expr) {
				// give body 100% height
				if (full && opts.allowBodyStretch && $.support.boxModel)
					$('html,body').css('height','100%');

				// fix ie6 issue when blocked element has a border width
				if ((ie6 || !$.support.boxModel) && !full) {
					var t = sz(el,'borderTopWidth'), l = sz(el,'borderLeftWidth');
					var fixT = t ? '(0 - '+t+')' : 0;
					var fixL = l ? '(0 - '+l+')' : 0;
				}

				// simulate fixed position
				$.each(layers, function(i,o) {
					var s = o[0].style;
					s.position = 'absolute';
					if (i < 2) {
						if (full)
							s.setExpression('height','Math.max(document.body.scrollHeight, document.body.offsetHeight) - (jQuery.support.boxModel?0:'+opts.quirksmodeOffsetHack+') + "px"');
						else
							s.setExpression('height','this.parentNode.offsetHeight + "px"');
						if (full)
							s.setExpression('width','jQuery.support.boxModel && document.documentElement.clientWidth || document.body.clientWidth + "px"');
						else
							s.setExpression('width','this.parentNode.offsetWidth + "px"');
						if (fixL) s.setExpression('left', fixL);
						if (fixT) s.setExpression('top', fixT);
					}
					else if (opts.centerY) {
						if (full) s.setExpression('top','(document.documentElement.clientHeight || document.body.clientHeight) / 2 - (this.offsetHeight / 2) + (blah = document.documentElement.scrollTop ? document.documentElement.scrollTop : document.body.scrollTop) + "px"');
						s.marginTop = 0;
					}
					else if (!opts.centerY && full) {
						var top = (opts.css && opts.css.top) ? parseInt(opts.css.top, 10) : 0;
						var expression = '((document.documentElement.scrollTop ? document.documentElement.scrollTop : document.body.scrollTop) + '+top+') + "px"';
						s.setExpression('top',expression);
					}
				});
			}

			// show the message
			if (msg) {
				if (opts.theme)
					lyr3.find('.ui-widget-content').append(msg);
				else
					lyr3.append(msg);
				if (msg.jquery || msg.nodeType)
					$(msg).show();
			}

			if ((msie || opts.forceIframe) && opts.showOverlay)
				lyr1.show(); // opacity is zero
			if (opts.fadeIn) {
				var cb = opts.onBlock ? opts.onBlock : noOp;
				var cb1 = (opts.showOverlay && !msg) ? cb : noOp;
				var cb2 = msg ? cb : noOp;
				if (opts.showOverlay)
					lyr2._fadeIn(opts.fadeIn, cb1);
				if (msg)
					lyr3._fadeIn(opts.fadeIn, cb2);
			}
			else {
				if (opts.showOverlay)
					lyr2.show();
				if (msg)
					lyr3.show();
				if (opts.onBlock)
					opts.onBlock();
			}

			// bind key and mouse events
			bind(1, el, opts);

			if (full) {
				pageBlock = lyr3[0];
				pageBlockEls = $(':input:enabled:visible',pageBlock);
				if (opts.focusInput)
					setTimeout(focus, 20);
			}
			else
				center(lyr3[0], opts.centerX, opts.centerY);

			if (opts.timeout) {
				// auto-unblock
				var to = setTimeout(function() {
					if (full)
						$.unblockUI(opts);
					else
						$(el).unblock(opts);
				}, opts.timeout);
				$(el).data('blockUI.timeout', to);
			}
		}

		// remove the block
		function remove(el, opts) {
			var count;
			var full = (el == window);
			var $el = $(el);
			var data = $el.data('blockUI.history');
			var to = $el.data('blockUI.timeout');
			if (to) {
				clearTimeout(to);
				$el.removeData('blockUI.timeout');
			}
			opts = $.extend({}, $.blockUI.defaults, opts || {});
			bind(0, el, opts); // unbind events

			if (opts.onUnblock === null) {
				opts.onUnblock = $el.data('blockUI.onUnblock');
				$el.removeData('blockUI.onUnblock');
			}

			var els;
			if (full) // crazy selector to handle odd field errors in ie6/7
				els = $('body').children().filter('.blockUI').add('body > .blockUI');
			else
				els = $el.find('>.blockUI');

			// fix cursor issue
			if ( opts.cursorReset ) {
				if ( els.length > 1 )
					els[1].style.cursor = opts.cursorReset;
				if ( els.length > 2 )
					els[2].style.cursor = opts.cursorReset;
			}

			if (full)
				pageBlock = pageBlockEls = null;

			if (opts.fadeOut) {
				count = els.length;
				els.fadeOut(opts.fadeOut, function() { 
					if ( --count === 0)
						reset(els,data,opts,el);
				});
			}
			else
				reset(els, data, opts, el);
		}

		// move blocking element back into the DOM where it started
		function reset(els,data,opts,el) {
			var $el = $(el);
			els.each(function(i,o) {
				// remove via DOM calls so we don't lose event handlers
				if (this.parentNode)
					this.parentNode.removeChild(this);
			});

			if (data && data.el) {
				data.el.style.display = data.display;
				data.el.style.position = data.position;
				if (data.parent)
					data.parent.appendChild(data.el);
				$el.removeData('blockUI.history');
			}

			if ($el.data('blockUI.static')) {
				$el.css('position', 'static'); // #22
			}

			if (typeof opts.onUnblock == 'function')
				opts.onUnblock(el,opts);

			// fix issue in Safari 6 where block artifacts remain until reflow
			var body = $(document.body), w = body.width(), cssW = body[0].style.width;
			body.width(w-1).width(w);
			body[0].style.width = cssW;
		}

		// bind/unbind the handler
		function bind(b, el, opts) {
			var full = el == window, $el = $(el);

			// don't bother unbinding if there is nothing to unbind
			if (!b && (full && !pageBlock || !full && !$el.data('blockUI.isBlocked')))
				return;

			$el.data('blockUI.isBlocked', b);

			// don't bind events when overlay is not in use or if bindEvents is false
			if (!full || !opts.bindEvents || (b && !opts.showOverlay))
				return;

			// bind anchors and inputs for mouse and key events
			var events = 'mousedown mouseup keydown keypress keyup touchstart touchend touchmove';
			if (b)
				$(document).bind(events, opts, handler);
			else
				$(document).unbind(events, handler);

		// former impl...
		//		var $e = $('a,:input');
		//		b ? $e.bind(events, opts, handler) : $e.unbind(events, handler);
		}

		// event handler to suppress keyboard/mouse events when blocking
		function handler(e) {
			// allow tab navigation (conditionally)
			if (e.keyCode && e.keyCode == 9) {
				if (pageBlock && e.data.constrainTabKey) {
					var els = pageBlockEls;
					var fwd = !e.shiftKey && e.target === els[els.length-1];
					var back = e.shiftKey && e.target === els[0];
					if (fwd || back) {
						setTimeout(function(){focus(back);},10);
						return false;
					}
				}
			}
			var opts = e.data;
			var target = $(e.target);
			if (target.hasClass('blockOverlay') && opts.onOverlayClick)
				opts.onOverlayClick();

			// allow events within the message content
			if (target.parents('div.' + opts.blockMsgClass).length > 0)
				return true;

			// allow events for content that is not being blocked
			return target.parents().children().filter('div.blockUI').length === 0;
		}

		function focus(back) {
			if (!pageBlockEls)
				return;
			var e = pageBlockEls[back===true ? pageBlockEls.length-1 : 0];
			if (e)
				e.focus();
		}

		function center(el, x, y) {
			var p = el.parentNode, s = el.style;
			var l = ((p.offsetWidth - el.offsetWidth)/2) - sz(p,'borderLeftWidth');
			var t = ((p.offsetHeight - el.offsetHeight)/2) - sz(p,'borderTopWidth');
			if (x) s.left = l > 0 ? (l+'px') : '0';
			if (y) s.top  = t > 0 ? (t+'px') : '0';
		}

		function sz(el, p) {
			return parseInt($.css(el,p),10)||0;
		}

	}


	/*global define:true */
	if (typeof define === 'function' && define.amd && define.amd.jQuery) {
		define(['jquery'], setup);
	} else {
		setup(jQuery);
	}

})();/*!
 * jQuery Form Plugin
 * version: 3.35.0-2013.05.23
 * @requires jQuery v1.5 or later
 * Copyright (c) 2013 M. Alsup
 * Examples and documentation at: http://malsup.com/jquery/form/
 * Project repository: https://github.com/malsup/form
 * Dual licensed under the MIT and GPL licenses.
 * https://github.com/malsup/form#copyright-and-license
 */
/*global ActiveXObject */
;(function($) {
"use strict";

/*
    Usage Note:
    -----------
    Do not use both ajaxSubmit and ajaxForm on the same form.  These
    functions are mutually exclusive.  Use ajaxSubmit if you want
    to bind your own submit handler to the form.  For example,

    $(document).ready(function() {
        $('#myForm').on('submit', function(e) {
            e.preventDefault(); // <-- important
            $(this).ajaxSubmit({
                target: '#output'
            });
        });
    });

    Use ajaxForm when you want the plugin to manage all the event binding
    for you.  For example,

    $(document).ready(function() {
        $('#myForm').ajaxForm({
            target: '#output'
        });
    });

    You can also use ajaxForm with delegation (requires jQuery v1.7+), so the
    form does not have to exist when you invoke ajaxForm:

    $('#myForm').ajaxForm({
        delegation: true,
        target: '#output'
    });

    When using ajaxForm, the ajaxSubmit function will be invoked for you
    at the appropriate time.
*/

/**
 * Feature detection
 */
var feature = {};
feature.fileapi = $("<input type='file'/>").get(0).files !== undefined;
feature.formdata = window.FormData !== undefined;

var hasProp = !!$.fn.prop;

// attr2 uses prop when it can but checks the return type for
// an expected string.  this accounts for the case where a form 
// contains inputs with names like "action" or "method"; in those
// cases "prop" returns the element
$.fn.attr2 = function() {
    if ( ! hasProp )
        return this.attr.apply(this, arguments);
    var val = this.prop.apply(this, arguments);
    if ( ( val && val.jquery ) || typeof val === 'string' )
        return val;
    return this.attr.apply(this, arguments);
};

/**
 * ajaxSubmit() provides a mechanism for immediately submitting
 * an HTML form using AJAX.
 */
$.fn.ajaxSubmit = function(options) {
    /*jshint scripturl:true */

    // fast fail if nothing selected (http://dev.jquery.com/ticket/2752)
    if (!this.length) {
        log('ajaxSubmit: skipping submit process - no element selected');
        return this;
    }

    var method, action, url, $form = this;

    if (typeof options == 'function') {
        options = { success: options };
    }

    method = options.type || this.attr2('method');
    action = options.url  || this.attr2('action');

    url = (typeof action === 'string') ? $.trim(action) : '';
    url = url || window.location.href || '';
    if (url) {
        // clean url (don't include hash vaue)
        url = (url.match(/^([^#]+)/)||[])[1];
    }

    options = $.extend(true, {
        url:  url,
        success: $.ajaxSettings.success,
        type: method || 'GET',
        iframeSrc: /^https/i.test(window.location.href || '') ? 'javascript:false' : 'about:blank'
    }, options);

    // hook for manipulating the form data before it is extracted;
    // convenient for use with rich editors like tinyMCE or FCKEditor
    var veto = {};
    this.trigger('form-pre-serialize', [this, options, veto]);
    if (veto.veto) {
        log('ajaxSubmit: submit vetoed via form-pre-serialize trigger');
        return this;
    }

    // provide opportunity to alter form data before it is serialized
    if (options.beforeSerialize && options.beforeSerialize(this, options) === false) {
        log('ajaxSubmit: submit aborted via beforeSerialize callback');
        return this;
    }

    var traditional = options.traditional;
    if ( traditional === undefined ) {
        traditional = $.ajaxSettings.traditional;
    }

    var elements = [];
    var qx, a = this.formToArray(options.semantic, elements);
    if (options.data) {
        options.extraData = options.data;
        qx = $.param(options.data, traditional);
    }

    // give pre-submit callback an opportunity to abort the submit
    if (options.beforeSubmit && options.beforeSubmit(a, this, options) === false) {
        log('ajaxSubmit: submit aborted via beforeSubmit callback');
        return this;
    }

    // fire vetoable 'validate' event
    this.trigger('form-submit-validate', [a, this, options, veto]);
    if (veto.veto) {
        log('ajaxSubmit: submit vetoed via form-submit-validate trigger');
        return this;
    }

    var q = $.param(a, traditional);
    if (qx) {
        q = ( q ? (q + '&' + qx) : qx );
    }
    if (options.type.toUpperCase() == 'GET') {
        options.url += (options.url.indexOf('?') >= 0 ? '&' : '?') + q;
        options.data = null;  // data is null for 'get'
    }
    else {
        options.data = q; // data is the query string for 'post'
    }

    var callbacks = [];
    if (options.resetForm) {
        callbacks.push(function() { $form.resetForm(); });
    }
    if (options.clearForm) {
        callbacks.push(function() { $form.clearForm(options.includeHidden); });
    }

    // perform a load on the target only if dataType is not provided
    if (!options.dataType && options.target) {
        var oldSuccess = options.success || function(){};
        callbacks.push(function(data) {
            var fn = options.replaceTarget ? 'replaceWith' : 'html';
            $(options.target)[fn](data).each(oldSuccess, arguments);
        });
    }
    else if (options.success) {
        callbacks.push(options.success);
    }

    options.success = function(data, status, xhr) { // jQuery 1.4+ passes xhr as 3rd arg
        var context = options.context || this ;    // jQuery 1.4+ supports scope context
        for (var i=0, max=callbacks.length; i < max; i++) {
            callbacks[i].apply(context, [data, status, xhr || $form, $form]);
        }
    };

    if (options.error) {
        var oldError = options.error;
        options.error = function(xhr, status, error) {
            var context = options.context || this;
            oldError.apply(context, [xhr, status, error, $form]);
        };
    }

     if (options.complete) {
        var oldComplete = options.complete;
        options.complete = function(xhr, status) {
            var context = options.context || this;
            oldComplete.apply(context, [xhr, status, $form]);
        };
    }

    // are there files to upload?

    // [value] (issue #113), also see comment:
    // https://github.com/malsup/form/commit/588306aedba1de01388032d5f42a60159eea9228#commitcomment-2180219
    var fileInputs = $('input[type=file]:enabled[value!=""]', this);

    var hasFileInputs = fileInputs.length > 0;
    var mp = 'multipart/form-data';
    var multipart = ($form.attr('enctype') == mp || $form.attr('encoding') == mp);

    var fileAPI = feature.fileapi && feature.formdata;
    log("fileAPI :" + fileAPI);
    var shouldUseFrame = (hasFileInputs || multipart) && !fileAPI;

    var jqxhr;

    // options.iframe allows user to force iframe mode
    // 06-NOV-09: now defaulting to iframe mode if file input is detected
    if (options.iframe !== false && (options.iframe || shouldUseFrame)) {
        // hack to fix Safari hang (thanks to Tim Molendijk for this)
        // see:  http://groups.google.com/group/jquery-dev/browse_thread/thread/36395b7ab510dd5d
        if (options.closeKeepAlive) {
            $.get(options.closeKeepAlive, function() {
                jqxhr = fileUploadIframe(a);
            });
        }
        else {
            jqxhr = fileUploadIframe(a);
        }
    }
    else if ((hasFileInputs || multipart) && fileAPI) {
        jqxhr = fileUploadXhr(a);
    }
    else {
        jqxhr = $.ajax(options);
    }

    $form.removeData('jqxhr').data('jqxhr', jqxhr);

    // clear element array
    for (var k=0; k < elements.length; k++)
        elements[k] = null;

    // fire 'notify' event
    this.trigger('form-submit-notify', [this, options]);
    return this;

    // utility fn for deep serialization
    function deepSerialize(extraData){
        var serialized = $.param(extraData, options.traditional).split('&');
        var len = serialized.length;
        var result = [];
        var i, part;
        for (i=0; i < len; i++) {
            // #252; undo param space replacement
            serialized[i] = serialized[i].replace(/\+/g,' ');
            part = serialized[i].split('=');
            // #278; use array instead of object storage, favoring array serializations
            result.push([decodeURIComponent(part[0]), decodeURIComponent(part[1])]);
        }
        return result;
    }

     // XMLHttpRequest Level 2 file uploads (big hat tip to francois2metz)
    function fileUploadXhr(a) {
        var formdata = new FormData();

        for (var i=0; i < a.length; i++) {
            formdata.append(a[i].name, a[i].value);
        }

        if (options.extraData) {
            var serializedData = deepSerialize(options.extraData);
            for (i=0; i < serializedData.length; i++)
                if (serializedData[i])
                    formdata.append(serializedData[i][0], serializedData[i][1]);
        }

        options.data = null;

        var s = $.extend(true, {}, $.ajaxSettings, options, {
            contentType: false,
            processData: false,
            cache: false,
            type: method || 'POST'
        });

        if (options.uploadProgress) {
            // workaround because jqXHR does not expose upload property
            s.xhr = function() {
                var xhr = jQuery.ajaxSettings.xhr();
                if (xhr.upload) {
                    xhr.upload.addEventListener('progress', function(event) {
                        var percent = 0;
                        var position = event.loaded || event.position; /*event.position is deprecated*/
                        var total = event.total;
                        if (event.lengthComputable) {
                            percent = Math.ceil(position / total * 100);
                        }
                        options.uploadProgress(event, position, total, percent);
                    }, false);
                }
                return xhr;
            };
        }

        s.data = null;
            var beforeSend = s.beforeSend;
            s.beforeSend = function(xhr, o) {
                o.data = formdata;
                if(beforeSend)
                    beforeSend.call(this, xhr, o);
        };
        return $.ajax(s);
    }

    // private function for handling file uploads (hat tip to YAHOO!)
    function fileUploadIframe(a) {
        var form = $form[0], el, i, s, g, id, $io, io, xhr, sub, n, timedOut, timeoutHandle;
        var deferred = $.Deferred();

        if (a) {
            // ensure that every serialized input is still enabled
            for (i=0; i < elements.length; i++) {
                el = $(elements[i]);
                if ( hasProp )
                    el.prop('disabled', false);
                else
                    el.removeAttr('disabled');
            }
        }

        s = $.extend(true, {}, $.ajaxSettings, options);
        s.context = s.context || s;
        id = 'jqFormIO' + (new Date().getTime());
        if (s.iframeTarget) {
            $io = $(s.iframeTarget);
            n = $io.attr2('name');
            if (!n)
                 $io.attr2('name', id);
            else
                id = n;
        }
        else {
            $io = $('<iframe name="' + id + '" src="'+ s.iframeSrc +'" />');
            $io.css({ position: 'absolute', top: '-1000px', left: '-1000px' });
        }
        io = $io[0];


        xhr = { // mock object
            aborted: 0,
            responseText: null,
            responseXML: null,
            status: 0,
            statusText: 'n/a',
            getAllResponseHeaders: function() {},
            getResponseHeader: function() {},
            setRequestHeader: function() {},
            abort: function(status) {
                var e = (status === 'timeout' ? 'timeout' : 'aborted');
                log('aborting upload... ' + e);
                this.aborted = 1;

                try { // #214, #257
                    if (io.contentWindow.document.execCommand) {
                        io.contentWindow.document.execCommand('Stop');
                    }
                }
                catch(ignore) {}

                $io.attr('src', s.iframeSrc); // abort op in progress
                xhr.error = e;
                if (s.error)
                    s.error.call(s.context, xhr, e, status);
                if (g)
                    $.event.trigger("ajaxError", [xhr, s, e]);
                if (s.complete)
                    s.complete.call(s.context, xhr, e);
            }
        };

        g = s.global;
        // trigger ajax global events so that activity/block indicators work like normal
        if (g && 0 === $.active++) {
            $.event.trigger("ajaxStart");
        }
        if (g) {
            $.event.trigger("ajaxSend", [xhr, s]);
        }

        if (s.beforeSend && s.beforeSend.call(s.context, xhr, s) === false) {
            if (s.global) {
                $.active--;
            }
            deferred.reject();
            return deferred;
        }
        if (xhr.aborted) {
            deferred.reject();
            return deferred;
        }

        // add submitting element to data if we know it
        sub = form.clk;
        if (sub) {
            n = sub.name;
            if (n && !sub.disabled) {
                s.extraData = s.extraData || {};
                s.extraData[n] = sub.value;
                if (sub.type == "image") {
                    s.extraData[n+'.x'] = form.clk_x;
                    s.extraData[n+'.y'] = form.clk_y;
                }
            }
        }

        var CLIENT_TIMEOUT_ABORT = 1;
        var SERVER_ABORT = 2;
                
        function getDoc(frame) {
            /* it looks like contentWindow or contentDocument do not
             * carry the protocol property in ie8, when running under ssl
             * frame.document is the only valid response document, since
             * the protocol is know but not on the other two objects. strange?
             * "Same origin policy" http://en.wikipedia.org/wiki/Same_origin_policy
             */
            
            var doc = null;
            
            // IE8 cascading access check
            try {
                if (frame.contentWindow) {
                    doc = frame.contentWindow.document;
                }
            } catch(err) {
                // IE8 access denied under ssl & missing protocol
                log('cannot get iframe.contentWindow document: ' + err);
            }

            if (doc) { // successful getting content
                return doc;
            }

            try { // simply checking may throw in ie8 under ssl or mismatched protocol
                doc = frame.contentDocument ? frame.contentDocument : frame.document;
            } catch(err) {
                // last attempt
                log('cannot get iframe.contentDocument: ' + err);
                doc = frame.document;
            }
            return doc;
        }

        // Rails CSRF hack (thanks to Yvan Barthelemy)
        var csrf_token = $('meta[name=csrf-token]').attr('content');
        var csrf_param = $('meta[name=csrf-param]').attr('content');
        if (csrf_param && csrf_token) {
            s.extraData = s.extraData || {};
            s.extraData[csrf_param] = csrf_token;
        }

        // take a breath so that pending repaints get some cpu time before the upload starts
        function doSubmit() {
            // make sure form attrs are set
            var t = $form.attr2('target'), a = $form.attr2('action');

            // update form attrs in IE friendly way
            form.setAttribute('target',id);
            if (!method) {
                form.setAttribute('method', 'POST');
            }
            if (a != s.url) {
                form.setAttribute('action', s.url);
            }

            // ie borks in some cases when setting encoding
            if (! s.skipEncodingOverride && (!method || /post/i.test(method))) {
                $form.attr({
                    encoding: 'multipart/form-data',
                    enctype:  'multipart/form-data'
                });
            }

            // support timout
            if (s.timeout) {
                timeoutHandle = setTimeout(function() { timedOut = true; cb(CLIENT_TIMEOUT_ABORT); }, s.timeout);
            }

            // look for server aborts
            function checkState() {
                try {
                    var state = getDoc(io).readyState;
                    log('state = ' + state);
                    if (state && state.toLowerCase() == 'uninitialized')
                        setTimeout(checkState,50);
                }
                catch(e) {
                    log('Server abort: ' , e, ' (', e.name, ')');
                    cb(SERVER_ABORT);
                    if (timeoutHandle)
                        clearTimeout(timeoutHandle);
                    timeoutHandle = undefined;
                }
            }

            // add "extra" data to form if provided in options
            var extraInputs = [];
            try {
                if (s.extraData) {
                    for (var n in s.extraData) {
                        if (s.extraData.hasOwnProperty(n)) {
                           // if using the $.param format that allows for multiple values with the same name
                           if($.isPlainObject(s.extraData[n]) && s.extraData[n].hasOwnProperty('name') && s.extraData[n].hasOwnProperty('value')) {
                               extraInputs.push(
                               $('<input type="hidden" name="'+s.extraData[n].name+'">').val(s.extraData[n].value)
                                   .appendTo(form)[0]);
                           } else {
                               extraInputs.push(
                               $('<input type="hidden" name="'+n+'">').val(s.extraData[n])
                                   .appendTo(form)[0]);
                           }
                        }
                    }
                }

                if (!s.iframeTarget) {
                    // add iframe to doc and submit the form
                    $io.appendTo('body');
                    if (io.attachEvent)
                        io.attachEvent('onload', cb);
                    else
                        io.addEventListener('load', cb, false);
                }
                setTimeout(checkState,15);

                try {
                    form.submit();
                } catch(err) {
                    // just in case form has element with name/id of 'submit'
                    var submitFn = document.createElement('form').submit;
                    submitFn.apply(form);
                }
            }
            finally {
                // reset attrs and remove "extra" input elements
                form.setAttribute('action',a);
                if(t) {
                    form.setAttribute('target', t);
                } else {
                    $form.removeAttr('target');
                }
                $(extraInputs).remove();
            }
        }

        if (s.forceSync) {
            doSubmit();
        }
        else {
            setTimeout(doSubmit, 10); // this lets dom updates render
        }

        var data, doc, domCheckCount = 50, callbackProcessed;

        function cb(e) {
            if (xhr.aborted || callbackProcessed) {
                return;
            }
            
            doc = getDoc(io);
            if(!doc) {
                log('cannot access response document');
                e = SERVER_ABORT;
            }
            if (e === CLIENT_TIMEOUT_ABORT && xhr) {
                xhr.abort('timeout');
                deferred.reject(xhr, 'timeout');
                return;
            }
            else if (e == SERVER_ABORT && xhr) {
                xhr.abort('server abort');
                deferred.reject(xhr, 'error', 'server abort');
                return;
            }

            if (!doc || doc.location.href == s.iframeSrc) {
                // response not received yet
                if (!timedOut)
                    return;
            }
            if (io.detachEvent)
                io.detachEvent('onload', cb);
            else
                io.removeEventListener('load', cb, false);

            var status = 'success', errMsg;
            try {
                if (timedOut) {
                    throw 'timeout';
                }

                var isXml = s.dataType == 'xml' || doc.XMLDocument || $.isXMLDoc(doc);
                log('isXml='+isXml);
                if (!isXml && window.opera && (doc.body === null || !doc.body.innerHTML)) {
                    if (--domCheckCount) {
                        // in some browsers (Opera) the iframe DOM is not always traversable when
                        // the onload callback fires, so we loop a bit to accommodate
                        log('requeing onLoad callback, DOM not available');
                        setTimeout(cb, 250);
                        return;
                    }
                    // let this fall through because server response could be an empty document
                    //log('Could not access iframe DOM after mutiple tries.');
                    //throw 'DOMException: not available';
                }

                //log('response detected');
                var docRoot = doc.body ? doc.body : doc.documentElement;
                xhr.responseText = docRoot ? docRoot.innerHTML : null;
                xhr.responseXML = doc.XMLDocument ? doc.XMLDocument : doc;
                if (isXml)
                    s.dataType = 'xml';
                xhr.getResponseHeader = function(header){
                    var headers = {'content-type': s.dataType};
                    return headers[header];
                };
                // support for XHR 'status' & 'statusText' emulation :
                if (docRoot) {
                    xhr.status = Number( docRoot.getAttribute('status') ) || xhr.status;
                    xhr.statusText = docRoot.getAttribute('statusText') || xhr.statusText;
                }

                var dt = (s.dataType || '').toLowerCase();
                var scr = /(json|script|text)/.test(dt);
                if (scr || s.textarea) {
                    // see if user embedded response in textarea
                    var ta = doc.getElementsByTagName('textarea')[0];
                    if (ta) {
                        xhr.responseText = ta.value;
                        // support for XHR 'status' & 'statusText' emulation :
                        xhr.status = Number( ta.getAttribute('status') ) || xhr.status;
                        xhr.statusText = ta.getAttribute('statusText') || xhr.statusText;
                    }
                    else if (scr) {
                        // account for browsers injecting pre around json response
                        var pre = doc.getElementsByTagName('pre')[0];
                        var b = doc.getElementsByTagName('body')[0];
                        if (pre) {
                            xhr.responseText = pre.textContent ? pre.textContent : pre.innerText;
                        }
                        else if (b) {
                            xhr.responseText = b.textContent ? b.textContent : b.innerText;
                        }
                    }
                }
                else if (dt == 'xml' && !xhr.responseXML && xhr.responseText) {
                    xhr.responseXML = toXml(xhr.responseText);
                }

                try {
                    data = httpData(xhr, dt, s);
                }
                catch (err) {
                    status = 'parsererror';
                    xhr.error = errMsg = (err || status);
                }
            }
            catch (err) {
                log('error caught: ',err);
                status = 'error';
                xhr.error = errMsg = (err || status);
            }

            if (xhr.aborted) {
                log('upload aborted');
                status = null;
            }

            if (xhr.status) { // we've set xhr.status
                status = (xhr.status >= 200 && xhr.status < 300 || xhr.status === 304) ? 'success' : 'error';
            }

            // ordering of these callbacks/triggers is odd, but that's how $.ajax does it
            if (status === 'success') {
                if (s.success)
                    s.success.call(s.context, data, 'success', xhr);
                deferred.resolve(xhr.responseText, 'success', xhr);
                if (g)
                    $.event.trigger("ajaxSuccess", [xhr, s]);
            }
            else if (status) {
                if (errMsg === undefined)
                    errMsg = xhr.statusText;
                if (s.error)
                    s.error.call(s.context, xhr, status, errMsg);
                deferred.reject(xhr, 'error', errMsg);
                if (g)
                    $.event.trigger("ajaxError", [xhr, s, errMsg]);
            }

            if (g)
                $.event.trigger("ajaxComplete", [xhr, s]);

            if (g && ! --$.active) {
                $.event.trigger("ajaxStop");
            }

            if (s.complete)
                s.complete.call(s.context, xhr, status);

            callbackProcessed = true;
            if (s.timeout)
                clearTimeout(timeoutHandle);

            // clean up
            setTimeout(function() {
                if (!s.iframeTarget)
                    $io.remove();
                xhr.responseXML = null;
            }, 100);
        }

        var toXml = $.parseXML || function(s, doc) { // use parseXML if available (jQuery 1.5+)
            if (window.ActiveXObject) {
                doc = new ActiveXObject('Microsoft.XMLDOM');
                doc.async = 'false';
                doc.loadXML(s);
            }
            else {
                doc = (new DOMParser()).parseFromString(s, 'text/xml');
            }
            return (doc && doc.documentElement && doc.documentElement.nodeName != 'parsererror') ? doc : null;
        };
        var parseJSON = $.parseJSON || function(s) {
            /*jslint evil:true */
            return window['eval']('(' + s + ')');
        };

        var httpData = function( xhr, type, s ) { // mostly lifted from jq1.4.4

            var ct = xhr.getResponseHeader('content-type') || '',
                xml = type === 'xml' || !type && ct.indexOf('xml') >= 0,
                data = xml ? xhr.responseXML : xhr.responseText;

            if (xml && data.documentElement.nodeName === 'parsererror') {
                if ($.error)
                    $.error('parsererror');
            }
            if (s && s.dataFilter) {
                data = s.dataFilter(data, type);
            }
            if (typeof data === 'string') {
                if (type === 'json' || !type && ct.indexOf('json') >= 0) {
                    data = parseJSON(data);
                } else if (type === "script" || !type && ct.indexOf("javascript") >= 0) {
                    $.globalEval(data);
                }
            }
            return data;
        };

        return deferred;
    }
};

/**
 * ajaxForm() provides a mechanism for fully automating form submission.
 *
 * The advantages of using this method instead of ajaxSubmit() are:
 *
 * 1: This method will include coordinates for <input type="image" /> elements (if the element
 *    is used to submit the form).
 * 2. This method will include the submit element's name/value data (for the element that was
 *    used to submit the form).
 * 3. This method binds the submit() method to the form for you.
 *
 * The options argument for ajaxForm works exactly as it does for ajaxSubmit.  ajaxForm merely
 * passes the options argument along after properly binding events for submit elements and
 * the form itself.
 */
$.fn.ajaxForm = function(options) {
    options = options || {};
    options.delegation = options.delegation && $.isFunction($.fn.on);

    // in jQuery 1.3+ we can fix mistakes with the ready state
    if (!options.delegation && this.length === 0) {
        var o = { s: this.selector, c: this.context };
        if (!$.isReady && o.s) {
            log('DOM not ready, queuing ajaxForm');
            $(function() {
                $(o.s,o.c).ajaxForm(options);
            });
            return this;
        }
        // is your DOM ready?  http://docs.jquery.com/Tutorials:Introducing_$(document).ready()
        log('terminating; zero elements found by selector' + ($.isReady ? '' : ' (DOM not ready)'));
        return this;
    }

    if ( options.delegation ) {
        $(document)
            .off('submit.form-plugin', this.selector, doAjaxSubmit)
            .off('click.form-plugin', this.selector, captureSubmittingElement)
            .on('submit.form-plugin', this.selector, options, doAjaxSubmit)
            .on('click.form-plugin', this.selector, options, captureSubmittingElement);
        return this;
    }

    return this.ajaxFormUnbind()
        .bind('submit.form-plugin', options, doAjaxSubmit)
        .bind('click.form-plugin', options, captureSubmittingElement);
};

// private event handlers
function doAjaxSubmit(e) {
    /*jshint validthis:true */
    var options = e.data;
    if (!e.isDefaultPrevented()) { // if event has been canceled, don't proceed
        e.preventDefault();
        $(this).ajaxSubmit(options);
    }
}

function captureSubmittingElement(e) {
    /*jshint validthis:true */
    var target = e.target;
    var $el = $(target);
    if (!($el.is("[type=submit],[type=image]"))) {
        // is this a child element of the submit el?  (ex: a span within a button)
        var t = $el.closest('[type=submit]');
        if (t.length === 0) {
            return;
        }
        target = t[0];
    }
    var form = this;
    form.clk = target;
    if (target.type == 'image') {
        if (e.offsetX !== undefined) {
            form.clk_x = e.offsetX;
            form.clk_y = e.offsetY;
        } else if (typeof $.fn.offset == 'function') {
            var offset = $el.offset();
            form.clk_x = e.pageX - offset.left;
            form.clk_y = e.pageY - offset.top;
        } else {
            form.clk_x = e.pageX - target.offsetLeft;
            form.clk_y = e.pageY - target.offsetTop;
        }
    }
    // clear form vars
    setTimeout(function() { form.clk = form.clk_x = form.clk_y = null; }, 100);
}


// ajaxFormUnbind unbinds the event handlers that were bound by ajaxForm
$.fn.ajaxFormUnbind = function() {
    return this.unbind('submit.form-plugin click.form-plugin');
};

/**
 * formToArray() gathers form element data into an array of objects that can
 * be passed to any of the following ajax functions: $.get, $.post, or load.
 * Each object in the array has both a 'name' and 'value' property.  An example of
 * an array for a simple login form might be:
 *
 * [ { name: 'username', value: 'jresig' }, { name: 'password', value: 'secret' } ]
 *
 * It is this array that is passed to pre-submit callback functions provided to the
 * ajaxSubmit() and ajaxForm() methods.
 */
$.fn.formToArray = function(semantic, elements) {
    var a = [];
    if (this.length === 0) {
        return a;
    }

    var form = this[0];
    var els = semantic ? form.getElementsByTagName('*') : form.elements;
    if (!els) {
        return a;
    }

    var i,j,n,v,el,max,jmax;
    for(i=0, max=els.length; i < max; i++) {
        el = els[i];
        n = el.name;
        if (!n || el.disabled) {
            continue;
        }

        if (semantic && form.clk && el.type == "image") {
            // handle image inputs on the fly when semantic == true
            if(form.clk == el) {
                a.push({name: n, value: $(el).val(), type: el.type });
                a.push({name: n+'.x', value: form.clk_x}, {name: n+'.y', value: form.clk_y});
            }
            continue;
        }

        v = $.fieldValue(el, true);
        if (v && v.constructor == Array) {
            if (elements)
                elements.push(el);
            for(j=0, jmax=v.length; j < jmax; j++) {
                a.push({name: n, value: v[j]});
            }
        }
        else if (feature.fileapi && el.type == 'file') {
            if (elements)
                elements.push(el);
            var files = el.files;
            if (files.length) {
                for (j=0; j < files.length; j++) {
                    a.push({name: n, value: files[j], type: el.type});
                }
            }
            else {
                // #180
                a.push({ name: n, value: '', type: el.type });
            }
        }
        else if (v !== null && typeof v != 'undefined') {
            if (elements)
                elements.push(el);
            a.push({name: n, value: v, type: el.type, required: el.required});
        }
    }

    if (!semantic && form.clk) {
        // input type=='image' are not found in elements array! handle it here
        var $input = $(form.clk), input = $input[0];
        n = input.name;
        if (n && !input.disabled && input.type == 'image') {
            a.push({name: n, value: $input.val()});
            a.push({name: n+'.x', value: form.clk_x}, {name: n+'.y', value: form.clk_y});
        }
    }
    return a;
};

/**
 * Serializes form data into a 'submittable' string. This method will return a string
 * in the format: name1=value1&amp;name2=value2
 */
$.fn.formSerialize = function(semantic) {
    //hand off to jQuery.param for proper encoding
    return $.param(this.formToArray(semantic));
};

/**
 * Serializes all field elements in the jQuery object into a query string.
 * This method will return a string in the format: name1=value1&amp;name2=value2
 */
$.fn.fieldSerialize = function(successful) {
    var a = [];
    this.each(function() {
        var n = this.name;
        if (!n) {
            return;
        }
        var v = $.fieldValue(this, successful);
        if (v && v.constructor == Array) {
            for (var i=0,max=v.length; i < max; i++) {
                a.push({name: n, value: v[i]});
            }
        }
        else if (v !== null && typeof v != 'undefined') {
            a.push({name: this.name, value: v});
        }
    });
    //hand off to jQuery.param for proper encoding
    return $.param(a);
};

/**
 * Returns the value(s) of the element in the matched set.  For example, consider the following form:
 *
 *  <form><fieldset>
 *      <input name="A" type="text" />
 *      <input name="A" type="text" />
 *      <input name="B" type="checkbox" value="B1" />
 *      <input name="B" type="checkbox" value="B2"/>
 *      <input name="C" type="radio" value="C1" />
 *      <input name="C" type="radio" value="C2" />
 *  </fieldset></form>
 *
 *  var v = $('input[type=text]').fieldValue();
 *  // if no values are entered into the text inputs
 *  v == ['','']
 *  // if values entered into the text inputs are 'foo' and 'bar'
 *  v == ['foo','bar']
 *
 *  var v = $('input[type=checkbox]').fieldValue();
 *  // if neither checkbox is checked
 *  v === undefined
 *  // if both checkboxes are checked
 *  v == ['B1', 'B2']
 *
 *  var v = $('input[type=radio]').fieldValue();
 *  // if neither radio is checked
 *  v === undefined
 *  // if first radio is checked
 *  v == ['C1']
 *
 * The successful argument controls whether or not the field element must be 'successful'
 * (per http://www.w3.org/TR/html4/interact/forms.html#successful-controls).
 * The default value of the successful argument is true.  If this value is false the value(s)
 * for each element is returned.
 *
 * Note: This method *always* returns an array.  If no valid value can be determined the
 *    array will be empty, otherwise it will contain one or more values.
 */
$.fn.fieldValue = function(successful) {
    for (var val=[], i=0, max=this.length; i < max; i++) {
        var el = this[i];
        var v = $.fieldValue(el, successful);
        if (v === null || typeof v == 'undefined' || (v.constructor == Array && !v.length)) {
            continue;
        }
        if (v.constructor == Array)
            $.merge(val, v);
        else
            val.push(v);
    }
    return val;
};

/**
 * Returns the value of the field element.
 */
$.fieldValue = function(el, successful) {
    var n = el.name, t = el.type, tag = el.tagName.toLowerCase();
    if (successful === undefined) {
        successful = true;
    }

    if (successful && (!n || el.disabled || t == 'reset' || t == 'button' ||
        (t == 'checkbox' || t == 'radio') && !el.checked ||
        (t == 'submit' || t == 'image') && el.form && el.form.clk != el ||
        tag == 'select' && el.selectedIndex == -1)) {
            return null;
    }

    if (tag == 'select') {
        var index = el.selectedIndex;
        if (index < 0) {
            return null;
        }
        var a = [], ops = el.options;
        var one = (t == 'select-one');
        var max = (one ? index+1 : ops.length);
        for(var i=(one ? index : 0); i < max; i++) {
            var op = ops[i];
            if (op.selected) {
                var v = op.value;
                if (!v) { // extra pain for IE...
                    v = (op.attributes && op.attributes['value'] && !(op.attributes['value'].specified)) ? op.text : op.value;
                }
                if (one) {
                    return v;
                }
                a.push(v);
            }
        }
        return a;
    }
    return $(el).val();
};

/**
 * Clears the form data.  Takes the following actions on the form's input fields:
 *  - input text fields will have their 'value' property set to the empty string
 *  - select elements will have their 'selectedIndex' property set to -1
 *  - checkbox and radio inputs will have their 'checked' property set to false
 *  - inputs of type submit, button, reset, and hidden will *not* be effected
 *  - button elements will *not* be effected
 */
$.fn.clearForm = function(includeHidden) {
    return this.each(function() {
        $('input,select,textarea', this).clearFields(includeHidden);
    });
};

/**
 * Clears the selected form elements.
 */
$.fn.clearFields = $.fn.clearInputs = function(includeHidden) {
    var re = /^(?:color|date|datetime|email|month|number|password|range|search|tel|text|time|url|week)$/i; // 'hidden' is not in this list
    return this.each(function() {
        var t = this.type, tag = this.tagName.toLowerCase();
        if (re.test(t) || tag == 'textarea') {
            this.value = '';
        }
        else if (t == 'checkbox' || t == 'radio') {
            this.checked = false;
        }
        else if (tag == 'select') {
            this.selectedIndex = -1;
        }
		else if (t == "file") {
			if (/MSIE/.test(navigator.userAgent)) {
				$(this).replaceWith($(this).clone(true));
			} else {
				$(this).val('');
			}
		}
        else if (includeHidden) {
            // includeHidden can be the value true, or it can be a selector string
            // indicating a special test; for example:
            //  $('#myForm').clearForm('.special:hidden')
            // the above would clean hidden inputs that have the class of 'special'
            if ( (includeHidden === true && /hidden/.test(t)) ||
                 (typeof includeHidden == 'string' && $(this).is(includeHidden)) )
                this.value = '';
        }
    });
};

/**
 * Resets the form data.  Causes all form elements to be reset to their original value.
 */
$.fn.resetForm = function() {
    return this.each(function() {
        // guard against an input with the name of 'reset'
        // note that IE reports the reset function as an 'object'
        if (typeof this.reset == 'function' || (typeof this.reset == 'object' && !this.reset.nodeType)) {
            this.reset();
        }
    });
};

/**
 * Enables or disables any matching elements.
 */
$.fn.enable = function(b) {
    if (b === undefined) {
        b = true;
    }
    return this.each(function() {
        this.disabled = !b;
    });
};

/**
 * Checks/unchecks any matching checkboxes or radio buttons and
 * selects/deselects and matching option elements.
 */
$.fn.selected = function(select) {
    if (select === undefined) {
        select = true;
    }
    return this.each(function() {
        var t = this.type;
        if (t == 'checkbox' || t == 'radio') {
            this.checked = select;
        }
        else if (this.tagName.toLowerCase() == 'option') {
            var $sel = $(this).parent('select');
            if (select && $sel[0] && $sel[0].type == 'select-one') {
                // deselect all other options
                $sel.find('option').selected(false);
            }
            this.selected = select;
        }
    });
};

// expose debug var
$.fn.ajaxSubmit.debug = false;

// helper fn for console logging
function log() {
    if (!$.fn.ajaxSubmit.debug)
        return;
    var msg = '[jquery.form] ' + Array.prototype.join.call(arguments,'');
    if (window.console && window.console.log) {
        window.console.log(msg);
    }
    else if (window.opera && window.opera.postError) {
        window.opera.postError(msg);
    }
}

})(jQuery);/*!
	Autosize 3.0.15
	license: MIT
	http://www.jacklmoore.com/autosize
*/
(function (global, factory) {
	if (typeof define === 'function' && define.amd) {
		define(['exports', 'module'], factory);
	} else if (typeof exports !== 'undefined' && typeof module !== 'undefined') {
		factory(exports, module);
	} else {
		var mod = {
			exports: {}
		};
		factory(mod.exports, mod);
		global.autosize = mod.exports;
	}
})(this, function (exports, module) {
	'use strict';

	var set = typeof Set === 'function' ? new Set() : (function () {
		var list = [];

		return {
			has: function has(key) {
				return Boolean(list.indexOf(key) > -1);
			},
			add: function add(key) {
				list.push(key);
			},
			'delete': function _delete(key) {
				list.splice(list.indexOf(key), 1);
			} };
	})();

	var createEvent = function createEvent(name) {
		return new Event(name);
	};
	try {
		new Event('test');
	} catch (e) {
		// IE does not support `new Event()`
		createEvent = function (name) {
			var evt = document.createEvent('Event');
			evt.initEvent(name, true, false);
			return evt;
		};
	}

	function assign(ta) {
		var _ref = arguments[1] === undefined ? {} : arguments[1];

		var _ref$setOverflowX = _ref.setOverflowX;
		var setOverflowX = _ref$setOverflowX === undefined ? true : _ref$setOverflowX;
		var _ref$setOverflowY = _ref.setOverflowY;
		var setOverflowY = _ref$setOverflowY === undefined ? true : _ref$setOverflowY;

		if (!ta || !ta.nodeName || ta.nodeName !== 'TEXTAREA' || set.has(ta)) return;

		var heightOffset = null;
		var overflowY = null;
		var clientWidth = ta.clientWidth;

		function init() {
			var style = window.getComputedStyle(ta, null);

			overflowY = style.overflowY;

			if (style.resize === 'vertical') {
				ta.style.resize = 'none';
			} else if (style.resize === 'both') {
				ta.style.resize = 'horizontal';
			}

			if (style.boxSizing === 'content-box') {
				heightOffset = -(parseFloat(style.paddingTop) + parseFloat(style.paddingBottom));
			} else {
				heightOffset = parseFloat(style.borderTopWidth) + parseFloat(style.borderBottomWidth);
			}
			// Fix when a textarea is not on document body and heightOffset is Not a Number
			if (isNaN(heightOffset)) {
				heightOffset = 0;
			}

			update();
		}

		function changeOverflow(value) {
			{
				// Chrome/Safari-specific fix:
				// When the textarea y-overflow is hidden, Chrome/Safari do not reflow the text to account for the space
				// made available by removing the scrollbar. The following forces the necessary text reflow.
				var width = ta.style.width;
				ta.style.width = '0px';
				// Force reflow:
				/* jshint ignore:start */
				ta.offsetWidth;
				/* jshint ignore:end */
				ta.style.width = width;
			}

			overflowY = value;

			if (setOverflowY) {
				ta.style.overflowY = value;
			}

			resize();
		}

		function resize() {
			var htmlTop = window.pageYOffset;
			var bodyTop = document.body.scrollTop;
			var originalHeight = ta.style.height;

			ta.style.height = 'auto';

			var endHeight = ta.scrollHeight + heightOffset;

			if (ta.scrollHeight === 0) {
				// If the scrollHeight is 0, then the element probably has display:none or is detached from the DOM.
				ta.style.height = originalHeight;
				return;
			}

			ta.style.height = endHeight + 'px';

			// used to check if an update is actually necessary on window.resize
			clientWidth = ta.clientWidth;

			// prevents scroll-position jumping
			document.documentElement.scrollTop = htmlTop;
			document.body.scrollTop = bodyTop;
		}

		function update() {
			var startHeight = ta.style.height;

			resize();

			var style = window.getComputedStyle(ta, null);

			if (style.height !== ta.style.height) {
				if (overflowY !== 'visible') {
					changeOverflow('visible');
				}
			} else {
				if (overflowY !== 'hidden') {
					changeOverflow('hidden');
				}
			}

			if (startHeight !== ta.style.height) {
				var evt = createEvent('autosize:resized');
				ta.dispatchEvent(evt);
			}
		}

		var pageResize = function pageResize() {
			if (ta.clientWidth !== clientWidth) {
				update();
			}
		};

		var destroy = (function (style) {
			window.removeEventListener('resize', pageResize, false);
			ta.removeEventListener('input', update, false);
			ta.removeEventListener('keyup', update, false);
			ta.removeEventListener('autosize:destroy', destroy, false);
			ta.removeEventListener('autosize:update', update, false);
			set['delete'](ta);

			Object.keys(style).forEach(function (key) {
				ta.style[key] = style[key];
			});
		}).bind(ta, {
			height: ta.style.height,
			resize: ta.style.resize,
			overflowY: ta.style.overflowY,
			overflowX: ta.style.overflowX,
			wordWrap: ta.style.wordWrap });

		ta.addEventListener('autosize:destroy', destroy, false);

		// IE9 does not fire onpropertychange or oninput for deletions,
		// so binding to onkeyup to catch most of those events.
		// There is no way that I know of to detect something like 'cut' in IE9.
		if ('onpropertychange' in ta && 'oninput' in ta) {
			ta.addEventListener('keyup', update, false);
		}

		window.addEventListener('resize', pageResize, false);
		ta.addEventListener('input', update, false);
		ta.addEventListener('autosize:update', update, false);
		set.add(ta);

		if (setOverflowX) {
			ta.style.overflowX = 'hidden';
			ta.style.wordWrap = 'break-word';
		}

		init();
	}

	function destroy(ta) {
		if (!(ta && ta.nodeName && ta.nodeName === 'TEXTAREA')) return;
		var evt = createEvent('autosize:destroy');
		ta.dispatchEvent(evt);
	}

	function update(ta) {
		if (!(ta && ta.nodeName && ta.nodeName === 'TEXTAREA')) return;
		var evt = createEvent('autosize:update');
		ta.dispatchEvent(evt);
	}

	var autosize = null;

	// Do nothing in Node.js environment and IE8 (or lower)
	if (typeof window === 'undefined' || typeof window.getComputedStyle !== 'function') {
		autosize = function (el) {
			return el;
		};
		autosize.destroy = function (el) {
			return el;
		};
		autosize.update = function (el) {
			return el;
		};
	} else {
		autosize = function (el, options) {
			if (el) {
				Array.prototype.forEach.call(el.length ? el : [el], function (x) {
					return assign(x, options);
				});
			}
			return el;
		};
		autosize.destroy = function (el) {
			if (el) {
				Array.prototype.forEach.call(el.length ? el : [el], destroy);
			}
			return el;
		};
		autosize.update = function (el) {
			if (el) {
				Array.prototype.forEach.call(el.length ? el : [el], update);
			}
			return el;
		};
	}

	module.exports = autosize;
});/*
 *	Tabby jQuery plugin version 0.13.0
 *
 *	Ted Devito - http://web.archive.org/web/20110716201510/http://teddevito.com/demos/textarea.html
 *
 *  Now mirrored at https://github.com/alanhogan/Tabby
 *
 *	Copyright (c) 2009 Ted Devito. Updated by Alan Hogan.
 *
 *  LICENSE (BSD 3-Clause):
 *
 *	Redistribution and use in source and binary forms, with or without modification, are permitted provided that the following
 *	conditions are met:
 *	
 *		1. Redistributions of source code must retain the above copyright notice, this list of conditions and the following disclaimer.
 *		2. Redistributions in binary form must reproduce the above copyright notice, this list of conditions and the following disclaimer  
 *			in the documentation and/or other materials provided with the distribution.
 *		3. The name of the author may not be used to endorse or promote products derived from this software without specific prior written 
 *			permission. 
 *	 
 *	THIS SOFTWARE IS PROVIDED BY THE AUTHOR ``AS IS'' AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE 
 *	IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE AUTHOR BE 
 *	LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO, 
 *	PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY 
 *	THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT 
 *	OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
 *
 */
 
// create closure

(function($) {
 
	// plugin definition

	$.fn.tabby = function(options) {
		// build main options before element iteration
		var opts = $.extend({}, $.fn.tabby.defaults, options);
		var pressed = $.fn.tabby.pressed; 
		
		// iterate and reformat each matched element
		return this.each(function() {
			$this = $(this);
			
			// build element specific options
			var options = $.meta ? $.extend({}, opts, $this.data()) : opts;
			
			$this.bind('keydown',function (e) {
				var kc = $.fn.tabby.catch_kc(e);
				if (16 === kc) pressed.shft = true;
				/*
				because both CTRL+TAB and ALT+TAB default to an event (changing tab/window) that 
				will prevent js from capturing the keyup event, we'll set a timer on releasing them.
				*/
				if (17 === kc) {pressed.ctrl = true;	setTimeout(function(){$.fn.tabby.pressed.ctrl = false;},1000);}
				if (18 === kc) {pressed.alt = true; 	setTimeout(function(){$.fn.tabby.pressed.alt = false;},1000);}

				if (9 === kc && !pressed.ctrl && !pressed.alt) {
					e.preventDefault();
					pressed.last = kc;	setTimeout(function(){$.fn.tabby.pressed.last = null;},0);
					process_keypress ($(e.target).get(0), pressed.shft, options);
					return false;
				}
				
			}).bind('keyup',function (e) {
				if (16 === $.fn.tabby.catch_kc(e)) pressed.shft = false;
			}).bind('blur',function (e) { // workaround for Opera -- http://www.webdeveloper.com/forum/showthread.php?p=806588
				if (9 === pressed.last) $(e.target).one('focus',function () {pressed.last = null;}).get(0).focus();
			});
		
		});
	};
	
	// define and expose any extra methods
	$.fn.tabby.catch_kc = function(e) { return e.keyCode ? e.keyCode : e.charCode ? e.charCode : e.which; };
	$.fn.tabby.pressed = {shft : false, ctrl : false, alt : false, last: null};

	function process_keypress (o,shft,options) {
		var scrollTo = o.scrollTop;
		//var tabString = String.fromCharCode(9);
		
		// gecko; o.setSelectionRange is only available when the text box has focus
		if (o.setSelectionRange) gecko_tab (o, shft, options);
		
		// ie; document.selection is always available
		else if (document.selection) ie_tab (o, shft, options);
		
		o.scrollTop = scrollTo;
	}
	
	// plugin defaults
	$.fn.tabby.defaults = {tabString : String.fromCharCode(9)};
	
	function gecko_tab (o, shft, options) {
		var ss = o.selectionStart;
		var es = o.selectionEnd;	
				
		// when there's no selection and we're just working with the caret, we'll add/remove the tabs at the caret, providing more control
		if(ss === es) {
			// SHIFT+TAB
			if (shft) {
				// check to the left of the caret first
				if (ss-options.tabString === o.value.substring(ss-options.tabString.length, ss)) {
					o.value = o.value.substring(0, ss-options.tabString.length) + o.value.substring(ss); // put it back together omitting one character to the left
					o.focus();
					o.setSelectionRange(ss - options.tabString.length, ss - options.tabString.length);
				} 
				// then check to the right of the caret
				else if (ss-options.tabString === o.value.substring(ss, ss + options.tabString.length)) {
					o.value = o.value.substring(0, ss) + o.value.substring(ss + options.tabString.length); // put it back together omitting one character to the right
					o.focus();
					o.setSelectionRange(ss,ss);
				}
			}
			// TAB
			else {			
				o.value = o.value.substring(0, ss) + options.tabString + o.value.substring(ss);
				o.focus();
	    		o.setSelectionRange(ss + options.tabString.length, ss + options.tabString.length);
			}
		} 
		// selections will always add/remove tabs from the start of the line
		else {
			while (ss < o.value.length && o.value.charAt(ss).match(/[ \t]/)) ss++;
			// split the textarea up into lines and figure out which lines are included in the selection
			var lines = o.value.split("\n");
			var indices = [];
			var sl = 0; // start of the line
			var el = 0; // end of the line
			var i = 0;
			for (i in lines) {
				el = sl + lines[i].length;
				indices.push({start: sl, end: el, selected: (sl <= ss && el > ss) || (el >= es && sl < es) || (sl > ss && el < es)});
				sl = el + 1;// for "\n"
			}
			
			// walk through the array of lines (indices) and add tabs where appropriate						
			var modifier = 0;
			for (i in indices) {
				if (indices[i].selected) {
					var pos = indices[i].start + modifier; // adjust for tabs already inserted/removed
					// SHIFT+TAB
					if (shft && options.tabString === o.value.substring(pos,pos+options.tabString.length)) { // only SHIFT+TAB if there's a tab at the start of the line
						o.value = o.value.substring(0,pos) + o.value.substring(pos + options.tabString.length); // omit the tabstring to the right
						modifier -= options.tabString.length;
					}
					// TAB
					else if (!shft) {
						o.value = o.value.substring(0,pos) + options.tabString + o.value.substring(pos); // insert the tabstring
						modifier += options.tabString.length;
					}
				}
			}
			o.focus();
			var ns = ss + ((modifier > 0) ? options.tabString.length : (modifier < 0) ? -options.tabString.length : 0);
			var ne = es + modifier;
			o.setSelectionRange(ns,ne);
		}
	}
	
	function ie_tab (o, shft, options) {
		var range = document.selection.createRange();
		
		if (o === range.parentElement()) {
			// when there's no selection and we're just working with the caret, we'll add/remove the tabs at the caret, providing more control
			if ('' === range.text) {
				// SHIFT+TAB
				if (shft) {
					var bookmark = range.getBookmark();
					//first try to the left by moving opening up our empty range to the left
					range.moveStart('character', -options.tabString.length);
					if (options.tabString === range.text) {
						range.text = '';
					} else {
						// if that didn't work then reset the range and try opening it to the right
						range.moveToBookmark(bookmark);
						range.moveEnd('character', options.tabString.length);
						if (options.tabString === range.text)
							range.text = '';
					}
					// move the pointer to the start of them empty range and select it
					range.collapse(true);
					range.select();
				}
				
				else {
					// very simple here. just insert the tab into the range and put the pointer at the end
					range.text = options.tabString; 
					range.collapse(false);
					range.select();
				}
			}
			// selections will always add/remove tabs from the start of the line
			else {
			
				var selection_text = range.text;
				var selection_len = selection_text.length;
				var selection_arr = selection_text.split("\r\n");
				
				var before_range = document.body.createTextRange();
				before_range.moveToElementText(o);
				before_range.setEndPoint("EndToStart", range);
				var before_text = before_range.text;
				var before_arr = before_text.split("\r\n");
				var before_len = before_text.length; // - before_arr.length + 1;
				
				var after_range = document.body.createTextRange();
				after_range.moveToElementText(o);
				after_range.setEndPoint("StartToEnd", range);
				var after_text = after_range.text; // we can accurately calculate distance to the end because we're not worried about MSIE trimming a \r\n
				
				var end_range = document.body.createTextRange();
				end_range.moveToElementText(o);
				end_range.setEndPoint("StartToEnd", before_range);
				var end_text = end_range.text; // we can accurately calculate distance to the end because we're not worried about MSIE trimming a \r\n
								
				var check_html = $(o).html();
				$("#r3").text(before_len + " + " + selection_len + " + " + after_text.length + " = " + check_html.length);				
				if((before_len + end_text.length) < check_html.length) {
					before_arr.push("");
					before_len += 2; // for the \r\n that was trimmed	
					if (shft && options.tabString === selection_arr[0].substring(0,options.tabString.length))
						selection_arr[0] = selection_arr[0].substring(options.tabString.length);
					else if (!shft) selection_arr[0] = options.tabString + selection_arr[0];	
				} else {
					if (shft && options.tabString === before_arr[before_arr.length-1].substring(0,options.tabString.length))
						before_arr[before_arr.length-1] = before_arr[before_arr.length-1].substring(options.tabString.length);
					else if (!shft) before_arr[before_arr.length-1] = options.tabString + before_arr[before_arr.length-1];
				}
				
				for (var i = 1; i < selection_arr.length; i++) {
					if (shft && options.tabString === selection_arr[i].substring(0,options.tabString.length))
						selection_arr[i] = selection_arr[i].substring(options.tabString.length);
					else if (!shft) selection_arr[i] = options.tabString + selection_arr[i];
				}

				if (1 === before_arr.length && 0 === before_len) {
					if (shft && options.tabString === selection_arr[0].substring(0,options.tabString.length))
						selection_arr[0] = selection_arr[0].substring(options.tabString.length);
					else if (!shft) selection_arr[0] = options.tabString + selection_arr[0];
				}

				if ((before_len + selection_len + after_text.length) < check_html.length) {
					selection_arr.push("");
					selection_len += 2; // for the \r\n that was trimmed
				}
				
				before_range.text = before_arr.join("\r\n");
				range.text = selection_arr.join("\r\n");
				
				var new_range = document.body.createTextRange();
				new_range.moveToElementText(o);
				
				if (0 < before_len)	new_range.setEndPoint("StartToEnd", before_range);
				else new_range.setEndPoint("StartToStart", before_range);
				new_range.setEndPoint("EndToEnd", range);
				
				new_range.select();
				
			} 
		}
	}

// end of closure
})(jQuery);
/*!
 * jQuery Cookie Plugin v1.4.1
 * https://github.com/carhartl/jquery-cookie
 *
 * Copyright 2013 Klaus Hartl
 * Released under the MIT license
 */
(function (factory) {
	if (typeof define === 'function' && define.amd) {
		// AMD
		define(['jquery'], factory);
	} else if (typeof exports === 'object') {
		// CommonJS
		factory(require('jquery'));
	} else {
		// Browser globals
		factory(jQuery);
	}
}(function ($) {

	var pluses = /\+/g;

	function encode(s) {
		return config.raw ? s : encodeURIComponent(s);
	}

	function decode(s) {
		return config.raw ? s : decodeURIComponent(s);
	}

	function stringifyCookieValue(value) {
		return encode(config.json ? JSON.stringify(value) : String(value));
	}

	function parseCookieValue(s) {
		if (s.indexOf('"') === 0) {
			// This is a quoted cookie as according to RFC2068, unescape...
			s = s.slice(1, -1).replace(/\\"/g, '"').replace(/\\\\/g, '\\');
		}

		try {
			// Replace server-side written pluses with spaces.
			// If we can't decode the cookie, ignore it, it's unusable.
			// If we can't parse the cookie, ignore it, it's unusable.
			s = decodeURIComponent(s.replace(pluses, ' '));
			return config.json ? JSON.parse(s) : s;
		} catch(e) {}
	}

	function read(s, converter) {
		var value = config.raw ? s : parseCookieValue(s);
		return $.isFunction(converter) ? converter(value) : value;
	}

	var config = $.cookie = function (key, value, options) {

		// Write

		if (value !== undefined && !$.isFunction(value)) {
			options = $.extend({}, config.defaults, options);

			if (typeof options.expires === 'number') {
				var days = options.expires, t = options.expires = new Date();
				t.setTime(+t + days * 864e+5);
			}

			return (document.cookie = [
				encode(key), '=', stringifyCookieValue(value),
				options.expires ? '; expires=' + options.expires.toUTCString() : '', // use expires attribute, max-age is not supported by IE
				options.path    ? '; path=' + options.path : '',
				options.domain  ? '; domain=' + options.domain : '',
				options.secure  ? '; secure' : ''
			].join(''));
		}

		// Read

		var result = key ? undefined : {};

		// To prevent the for loop in the first place assign an empty array
		// in case there are no cookies at all. Also prevents odd result when
		// calling $.cookie().
		var cookies = document.cookie ? document.cookie.split('; ') : [];

		for (var i = 0, l = cookies.length; i < l; i++) {
			var parts = cookies[i].split('=');
			var name = decode(parts.shift());
			var cookie = parts.join('=');

			if (key && key === name) {
				// If second argument (value) is a function it's a converter...
				result = read(cookie, value);
				break;
			}

			// Prevent storing a cookie that we couldn't decode.
			if (!key && (cookie = read(cookie)) !== undefined) {
				result[name] = cookie;
			}
		}

		return result;
	};

	config.defaults = {};

	$.removeCookie = function (key, options) {
		if ($.cookie(key) === undefined) {
			return false;
		}

		// Must not alter options, thus extending a fresh object...
		$.cookie(key, '', $.extend({}, options, { expires: -1 }));
		return !$.cookie(key);
	};

}));
/*
 * Metadata - jQuery plugin for parsing metadata from elements
 *
 * Copyright (c) 2006 John Resig, Yehuda Katz, J�örn Zaefferer, Paul McLanahan
 *
 * Dual licensed under the MIT and GPL licenses:
 *   http://www.opensource.org/licenses/mit-license.php
 *   http://www.gnu.org/licenses/gpl.html
 *
 * Revision: $Id: jquery.metadata.js 3640 2007-10-11 18:34:38Z pmclanahan $
 *
 */

/**
 * Sets the type of metadata to use. Metadata is encoded in JSON, and each property
 * in the JSON will become a property of the element itself.
 *
 * There are four supported types of metadata storage:
 *
 *   attr:  Inside an attribute. The name parameter indicates *which* attribute.
 *          
 *   class: Inside the class attribute, wrapped in curly braces: { }
 *   
 *   elem:  Inside a child element (e.g. a script tag). The
 *          name parameter indicates *which* element.
 *   html5: Values are stored in data-* attributes.
 *          
 * The metadata for an element is loaded the first time the element is accessed via jQuery.
 *
 * As a result, you can define the metadata type, use $(expr) to load the metadata into the elements
 * matched by expr, then redefine the metadata type and run another $(expr) for other elements.
 * 
 * @name $.metadata.setType
 *
 * @example <p id="one" class="some_class {item_id: 1, item_label: 'Label'}">This is a p</p>
 * @before $.metadata.setType("class")
 * @after $("#one").metadata().item_id == 1; $("#one").metadata().item_label == "Label"
 * @desc Reads metadata from the class attribute
 * 
 * @example <p id="one" class="some_class" data="{item_id: 1, item_label: 'Label'}">This is a p</p>
 * @before $.metadata.setType("attr", "data")
 * @after $("#one").metadata().item_id == 1; $("#one").metadata().item_label == "Label"
 * @desc Reads metadata from a "data" attribute
 * 
 * @example <p id="one" class="some_class"><script>{item_id: 1, item_label: 'Label'}</script>This is a p</p>
 * @before $.metadata.setType("elem", "script")
 * @after $("#one").metadata().item_id == 1; $("#one").metadata().item_label == "Label"
 * @desc Reads metadata from a nested script element
 * 
 * @example <p id="one" class="some_class" data-item_id="1" data-item_label="Label">This is a p</p>
 * @before $.metadata.setType("html5")
 * @after $("#one").metadata().item_id == 1; $("#one").metadata().item_label == "Label"
 * @desc Reads metadata from a series of data-* attributes
 *
 * @param String type The encoding type
 * @param String name The name of the attribute to be used to get metadata (optional)
 * @cat Plugins/Metadata
 * @descr Sets the type of encoding to be used when loading metadata for the first time
 * @type undefined
 * @see metadata()
 */

(function($) {

$.extend({
  metadata : {
    defaults : {
      type: 'class',
      name: 'metadata',
      cre: /({.*})/,
      single: 'metadata'
    },
    setType: function( type, name ){
      this.defaults.type = type;
      this.defaults.name = name;
    },
    get: function( elem, opts ){
      var settings = $.extend({},this.defaults,opts);
      // check for empty string in single property
      if ( !settings.single.length ) settings.single = 'metadata';
      
      var data = $.data(elem, settings.single);
      // returned cached data if it already exists
      if ( data ) return data;
      
      data = "{}";
      
      var getData = function(data) {
        if(typeof data != "string") return data;
        
        if( data.indexOf('{') < 0 ) {
          data = eval("(" + data + ")");
        }
      }
      
      var getObject = function(data) {
        if(typeof data != "string") return data;
        
        data = eval("(" + data + ")");
        return data;
      }
      
      if ( settings.type == "html5" ) {
        var object = {};
        $( elem.attributes ).each(function() {
          var name = this.nodeName;
          if(name.match(/^data-/)) name = name.replace(/^data-/, '');
          else return true;
          object[name] = getObject(this.nodeValue);
        });
      } else {
        if ( settings.type == "class" ) {
          var m = settings.cre.exec( elem.className );
          if ( m )
            data = m[1];
        } else if ( settings.type == "elem" ) {
          if( !elem.getElementsByTagName ) return;
          var e = elem.getElementsByTagName(settings.name);
          if ( e.length )
            data = $.trim(e[0].innerHTML);
        } else if ( elem.getAttribute != undefined ) {
          var attr = elem.getAttribute( settings.name );
          if ( attr )
            data = attr;
        }
        object = getObject(data.indexOf("{") < 0 ? "{" + data + "}" : data);
      }
      
      $.data( elem, settings.single, object );
      return object;
    }
  }
});

/**
 * Returns the metadata object for the first member of the jQuery object.
 *
 * @name metadata
 * @descr Returns element's metadata object
 * @param Object opts An object contianing settings to override the defaults
 * @type jQuery
 * @cat Plugins/Metadata
 */
$.fn.metadata = function( opts ){
  return $.metadata.get( this[0], opts );
};

})(jQuery);/*
 * jQuery Media Plugin for converting elements into rich media content.
 *
 * Examples and documentation at: http://malsup.com/jquery/media/
 * Copyright (c) 2007-2010 M. Alsup
 * Dual licensed under the MIT and GPL licenses:
 * http://www.opensource.org/licenses/mit-license.php
 * http://www.gnu.org/licenses/gpl.html
 *
 * @author: M. Alsup
 * @version: 0.99 (05-JUN-2013)
 * @requires jQuery v1.1.2 or later
 * $Id: jquery.media.js 2460 2007-07-23 02:53:15Z malsup $
 *
 * Supported Media Players:
 *	- Flash
 *	- Quicktime
 *	- Real Player
 *	- Silverlight
 *	- Windows Media Player
 *	- iframe
 *
 * Supported Media Formats:
 *	 Any types supported by the above players, such as:
 *	 Video: asf, avi, flv, mov, mpg, mpeg, mp4, qt, smil, swf, wmv, 3g2, 3gp
 *	 Audio: aif, aac, au, gsm, mid, midi, mov, mp3, m4a, snd, rm, wav, wma
 *	 Other: bmp, html, pdf, psd, qif, qtif, qti, tif, tiff, xaml
 *
 * Thanks to Mark Hicken and Brent Pedersen for helping me debug this on the Mac!
 * Thanks to Dan Rossi for numerous bug reports and code bits!
 * Thanks to Skye Giordano for several great suggestions!
 * Thanks to Richard Connamacher for excellent improvements to the non-IE behavior!
 */
/*global SWFObject alert Sys */
/*jshint forin:false */
;(function($) {
"use strict";	

var mode = document.documentMode || 0;
var msie = /MSIE/.test(navigator.userAgent);
var lameIE = msie && (/MSIE (6|7|8)\.0/.test(navigator.userAgent) || mode < 9);

/**
 * Chainable method for converting elements into rich media.
 *
 * @param options
 * @param callback fn invoked for each matched element before conversion
 * @param callback fn invoked for each matched element after conversion
 */
$.fn.media = function(options, f1, f2) {
	if (options == 'undo') {
		return this.each(function() {
			var $this = $(this);
			var html = $this.data('media.origHTML');
			if (html)
				$this.replaceWith(html);
		});
	}
	
	return this.each(function() {
		if (typeof options == 'function') {
			f2 = f1;
			f1 = options;
			options = {};
		}
		var o = getSettings(this, options);
		// pre-conversion callback, passes original element and fully populated options
		if (typeof f1 == 'function') f1(this, o);

		var r = getTypesRegExp();
		var m = r.exec(o.src.toLowerCase()) || [''];
		var fn;

		if (o.type)
			m[0] = o.type;
		else
			m.shift();

		for (var i=0; i < m.length; i++) {
			fn = m[i].toLowerCase();
			if (isDigit(fn[0])) fn = 'fn' + fn; // fns can't begin with numbers
			if (!$.fn.media[fn])
				continue;  // unrecognized media type
			// normalize autoplay settings
			var player = $.fn.media[fn+'_player'];
			if (!o.params) o.params = {};
			if (player) {
				var num = player.autoplayAttr == 'autostart';
				o.params[player.autoplayAttr || 'autoplay'] = num ? (o.autoplay ? 1 : 0) : o.autoplay ? true : false;
			}
			var $div = $.fn.media[fn](this, o);

			$div.css('backgroundColor', o.bgColor).width(o.width);
			
			if (o.canUndo) {
				var $temp = $('<div></div>').append(this);
				$div.data('media.origHTML', $temp.html()); // store original markup
			}
			
			// post-conversion callback, passes original element, new div element and fully populated options
			if (typeof f2 == 'function') f2(this, $div[0], o, player.name);
			break;
		}
	});
};

/**
 * Non-chainable method for adding or changing file format / player mapping
 * @name mapFormat
 * @param String format File format extension (ie: mov, wav, mp3)
 * @param String player Player name to use for the format (one of: flash, quicktime, realplayer, winmedia, silverlight or iframe
 */
$.fn.media.mapFormat = function(format, player) {
	if (!format || !player || !$.fn.media.defaults.players[player]) return; // invalid
	format = format.toLowerCase();
	if (isDigit(format[0])) format = 'fn' + format;
	$.fn.media[format] = $.fn.media[player];
	$.fn.media[format+'_player'] = $.fn.media.defaults.players[player];
};

// global defautls; override as needed
$.fn.media.defaults = {
	standards:  true,       // use object tags only (no embeds for non-IE browsers)
	canUndo:    true,       // tells plugin to store the original markup so it can be reverted via: $(sel).mediaUndo()
	width:		400,
	height:		400,
	autoplay:	0,			// normalized cross-player setting
	bgColor:	'#ffffff',	// background color
	params:		{ wmode: 'transparent'},	// added to object element as param elements; added to embed element as attrs
	attrs:		{},			// added to object and embed elements as attrs
	flvKeyName: 'file',		// key used for object src param (thanks to Andrea Ercolino)
	flashvars:	{},			// added to flash content as flashvars param/attr
	flashVersion:	'7',	// required flash version
	expressInstaller: null,	// src for express installer

	// default flash video and mp3 player (@see: http://jeroenwijering.com/?item=Flash_Media_Player)
	flvPlayer:	 'mediaplayer.swf',
	mp3Player:	 'mediaplayer.swf',

	// @see http://msdn2.microsoft.com/en-us/library/bb412401.aspx
	silverlight: {
		inplaceInstallPrompt: 'true', // display in-place install prompt?
		isWindowless:		  'true', // windowless mode (false for wrapping markup)
		framerate:			  '24',	  // maximum framerate
		version:			  '0.9',  // Silverlight version
		onError:			  null,	  // onError callback
		onLoad:			      null,   // onLoad callback
		initParams:			  null,	  // object init params
		userContext:		  null	  // callback arg passed to the load callback
	}
};

// Media Players; think twice before overriding
$.fn.media.defaults.players = {
	flash: {
		name:		 'flash',
		title:		 'Flash',
		types:		 'flv,mp3,swf',
		mimetype:	 'application/x-shockwave-flash',
		pluginspage: 'http://www.adobe.com/go/getflashplayer',
		ieAttrs: {
			classid:  'clsid:d27cdb6e-ae6d-11cf-96b8-444553540000',
			type:	  'application/x-oleobject',
			codebase: 'http://fpdownload.macromedia.com/pub/shockwave/cabs/flash/swflash.cab#version=' + $.fn.media.defaults.flashVersion
		}
	},
	quicktime: {
		name:		 'quicktime',
		title:		 'QuickTime',
		mimetype:	 'video/quicktime',
		pluginspage: 'http://www.apple.com/quicktime/download/',
		types:		 'aif,aiff,aac,au,bmp,gsm,mov,mid,midi,mpg,mpeg,mp4,m4a,psd,qt,qtif,qif,qti,snd,tif,tiff,wav,3g2,3gp',
		ieAttrs: {
			classid:  'clsid:02BF25D5-8C17-4B23-BC80-D3488ABDDC6B',
			codebase: 'http://www.apple.com/qtactivex/qtplugin.cab'
		}
	},
	realplayer: {
		name:		  'real',
		title:		  'RealPlayer',
		types:		  'ra,ram,rm,rpm,rv,smi,smil',
		mimetype:	  'audio/x-pn-realaudio-plugin',
		pluginspage:  'http://www.real.com/player/',
		autoplayAttr: 'autostart',
		ieAttrs: {
			classid: 'clsid:CFCDAA03-8BE4-11cf-B84B-0020AFBBCCFA'
		}
	},
	winmedia: {
		name:		  'winmedia',
		title:		  'Windows Media',
		types:		  'asx,asf,avi,wma,wmv',
		mimetype:	  isFirefoxWMPPluginInstalled() ? 'application/x-ms-wmp' : 'application/x-mplayer2',
		pluginspage:  'http://www.microsoft.com/Windows/MediaPlayer/',
		autoplayAttr: 'autostart',
		oUrl:		  'url',
		ieAttrs: {
			classid:  'clsid:6BF52A52-394A-11d3-B153-00C04F79FAA6',
			type:	  'application/x-oleobject'
		}
	},
	// special cases
	img: {
		name:  'img',
		title: 'Image',
		types: 'gif,png,jpg'
	},
	iframe: {
		name:  'iframe',
		types: 'html,pdf'
	},
	silverlight: {
		name:  'silverlight',
		types: 'xaml'
	}
};

//
//	everything below here is private
//


// detection script for FF WMP plugin (http://www.therossman.org/experiments/wmp_play.html)
// (hat tip to Mark Ross for this script)
function isFirefoxWMPPluginInstalled() {
	var plugs = navigator.plugins || [];
	for (var i = 0; i < plugs.length; i++) {
		var plugin = plugs[i];
		if (plugin['filename'] == 'np-mswmp.dll')
			return true;
	}
	return false;
}

var counter = 1;

for (var player in $.fn.media.defaults.players) {
	var types = $.fn.media.defaults.players[player].types;
	$.each(types.split(','), function(i,o) {
		if (isDigit(o[0])) o = 'fn' + o;
		$.fn.media[o] = $.fn.media[player] = getGenerator(player);
		$.fn.media[o+'_player'] = $.fn.media.defaults.players[player];
	});
}

function getTypesRegExp() {
	var types = '';
	for (var player in $.fn.media.defaults.players) {
		if (types.length) types += ',';
		types += $.fn.media.defaults.players[player].types;
	}
	return new RegExp('\\.(' + types.replace(/,/ig,'|') + ')\\b');
}

function getGenerator(player) {
	return function(el, options) {
		return generate(el, options, player);
	};
}

function isDigit(c) {
	return '0123456789'.indexOf(c) > -1;
}

// flatten all possible options: global defaults, meta, option obj
function getSettings(el, options) {
	options = options || {};
	var a, n;
	var $el = $(el);
	var cls = el.className || '';
	// support metadata plugin (v1.0 and v2.0)
	var meta = $.metadata ? $el.metadata() : $.meta ? $el.data() : {};
	meta = meta || {};
	var w = meta.width  || parseInt(((cls.match(/\bw:(\d+)/)||[])[1]||0),10) || parseInt(((cls.match(/\bwidth:(\d+)/)||[])[1]||0),10);
	var h = meta.height || parseInt(((cls.match(/\bh:(\d+)/)||[])[1]||0),10) || parseInt(((cls.match(/\bheight:(\d+)/)||[])[1]||0),10);

	if (w) meta.width = w;
	if (h) meta.height = h;
	if (cls) meta.cls = cls;
	
	// crank html5 style data attributes
	var dataName = 'data-';
    for (var i=0; i < el.attributes.length; i++) {
        a = el.attributes[i], n = $.trim(a.name);
        var index = n.indexOf(dataName);
        if (index === 0) {
			n = n.substring(dataName.length);
			meta[n] = a.value;
        }
    }

	a = $.fn.media.defaults;
	var b = options;
	var c = meta;

	var p = { params: { bgColor: options.bgColor || $.fn.media.defaults.bgColor } };
	var opts = $.extend({}, a, b, c);
	$.each(['attrs','params','flashvars','silverlight'], function(i,o) {
		opts[o] = $.extend({}, p[o] || {}, a[o] || {}, b[o] || {}, c[o] || {});
	});

	if (typeof opts.caption == 'undefined') opts.caption = $el.text();

	// make sure we have a source!
	opts.src = opts.src || $el.attr('href') || $el.attr('src') || 'unknown';
	return opts;
}

//
//	Flash Player
//

// generate flash using SWFObject library if possible
$.fn.media.swf = function(el, opts) {
	var f, p;
	if (!window.SWFObject && !window.swfobject) {
		// roll our own
		if (opts.flashvars) {
			var a = [];
			for (f in opts.flashvars)
				a.push(f + '=' + opts.flashvars[f]);
			if (!opts.params) opts.params = {};
			opts.params.flashvars = a.join('&');
		}
		return generate(el, opts, 'flash');
	}

	var id = el.id ? (' id="'+el.id+'"') : '';
	var cls = opts.cls ? (' class="' + opts.cls + '"') : '';
	var $div = $('<div' + id + cls + '>');

	// swfobject v2+
	if (window.swfobject) {
		$(el).after($div).appendTo($div);
		if (!el.id) el.id = 'movie_player_' + counter++;

		// replace el with swfobject content
		window.swfobject.embedSWF(opts.src, el.id, opts.width, opts.height, opts.flashVersion,
			opts.expressInstaller, opts.flashvars, opts.params, opts.attrs);
	}
	// swfobject < v2
	else {
		$(el).after($div).remove();
		var so = new SWFObject(opts.src, 'movie_player_' + counter++, opts.width, opts.height, opts.flashVersion, opts.bgColor);
		if (opts.expressInstaller) so.useExpressInstall(opts.expressInstaller);

		for (p in opts.params)
			if (p != 'bgColor') so.addParam(p, opts.params[p]);
		for (f in opts.flashvars)
			so.addVariable(f, opts.flashvars[f]);
		so.write($div[0]);
	}

	if (opts.caption) $('<div>').appendTo($div).html(opts.caption);
	return $div;
};

// map flv and mp3 files to the swf player by default
$.fn.media.flv = $.fn.media.mp3 = function(el, opts) {
	var src = opts.src;
	var player = /\.mp3\b/i.test(src) ? opts.mp3Player : opts.flvPlayer;
	var key = opts.flvKeyName;
	src = encodeURIComponent(src);
	opts.src = player;
	opts.src = opts.src + '?'+key+'=' + (src);
	var srcObj = {};
	srcObj[key] = src;
	opts.flashvars = $.extend({}, srcObj, opts.flashvars );
	return $.fn.media.swf(el, opts);
};

//
//	Silverlight
//
$.fn.media.xaml = function(el, opts) {
	if (!window.Sys || !window.Sys.Silverlight) {
		if ($.fn.media.xaml.warning) return;
		$.fn.media.xaml.warning = 1;
		alert('You must include the Silverlight.js script.');
		return;
	}

	var props = {
		width: opts.width,
		height: opts.height,
		background: opts.bgColor,
		inplaceInstallPrompt: opts.silverlight.inplaceInstallPrompt,
		isWindowless: opts.silverlight.isWindowless,
		framerate: opts.silverlight.framerate,
		version: opts.silverlight.version
	};
	var events = {
		onError: opts.silverlight.onError,
		onLoad: opts.silverlight.onLoad
	};

	var id1 = el.id ? (' id="'+el.id+'"') : '';
	var id2 = opts.id || 'AG' + counter++;
	// convert element to div
	var cls = opts.cls ? (' class="' + opts.cls + '"') : '';
	var $div = $('<div' + id1 + cls + '>');
	$(el).after($div).remove();

	Sys.Silverlight.createObjectEx({
		source: opts.src,
		initParams: opts.silverlight.initParams,
		userContext: opts.silverlight.userContext,
		id: id2,
		parentElement: $div[0],
		properties: props,
		events: events
	});

	if (opts.caption) $('<div>').appendTo($div).html(opts.caption);
	return $div;
};

//
// generate object/embed markup
//
function generate(el, opts, player) {
	var $el = $(el);
	var o = $.fn.media.defaults.players[player];
	var a, key, v;

	if (player == 'iframe') {
		o = $('<iframe' + ' width="' + opts.width + '" height="' + opts.height + '" >');
		o.attr('src', opts.src);
		o.css('backgroundColor', o.bgColor);
	}
	else if (player == 'img') {
		o = $('<img>');
		o.attr('src', opts.src);
		if (opts.width)
			o.attr('width', opts.width);
		if (opts.height)
			o.attr('height', opts.height);
		o.css('backgroundColor', o.bgColor);
	}
	else if (lameIE) {
		a = ['<object width="' + opts.width + '" height="' + opts.height + '" '];
		for (key in opts.attrs)
			a.push(key + '="'+opts.attrs[key]+'" ');
		for (key in o.ieAttrs || {}) {
			v = o.ieAttrs[key];
			if (key == 'codebase' && window.location.protocol == 'https:')
				v = v.replace('http','https');
			a.push(key + '="'+v+'" ');
		}
		a.push('></ob'+'ject'+'>');
		var p = ['<param name="' + (o.oUrl || 'src') +'" value="' + opts.src + '">'];
		for (key in opts.params)
			p.push('<param name="'+ key +'" value="' + opts.params[key] + '">');
		o = document.createElement(a.join(''));
		for (var i=0; i < p.length; i++)
			o.appendChild(document.createElement(p[i]));
	}
	else if (opts.standards) {
		// Rewritten to be standards compliant by Richard Connamacher
		a = ['<object type="' + o.mimetype +'" width="' + opts.width + '" height="' + opts.height +'"'];
		if (opts.src) a.push(' data="' + opts.src + '" ');
		if (msie) {
			for (key in o.ieAttrs || {}) {
				v = o.ieAttrs[key];
				if (key == 'codebase' && window.location.protocol == 'https:')
					v = v.replace('http','https');
				a.push(key + '="'+v+'" ');
			}
		}
		a.push('>');
		a.push('<param name="' + (o.oUrl || 'src') +'" value="' + opts.src + '">');
		for (key in opts.params) {
			if (key == 'wmode' && player != 'flash') // FF3/Quicktime borks on wmode
				continue;
			a.push('<param name="'+ key +'" value="' + opts.params[key] + '">');
		}
		// Alternate HTML
		a.push('<div><p><strong>'+o.title+' Required</strong></p><p>'+o.title+' is required to view this media. <a href="'+o.pluginspage+'">Download Here</a>.</p></div>');
		a.push('</ob'+'ject'+'>');
	}
	 else {
	        a = ['<embed width="' + opts.width + '" height="' + opts.height + '" style="display:block"'];
	        if (opts.src) a.push(' src="' + opts.src + '" ');
	        for (key in opts.attrs)
	            a.push(key + '="'+opts.attrs[key]+'" ');
	        for (key in o.eAttrs || {})
	            a.push(key + '="'+o.eAttrs[key]+'" ');
	        for (key in opts.params) {
	            if (key == 'wmode' && player != 'flash') // FF3/Quicktime borks on wmode
					continue;
	            a.push(key + '="'+opts.params[key]+'" ');
	        }
	        a.push('></em'+'bed'+'>');
	    }	
	// convert element to div
	var id = el.id ? (' id="'+el.id+'"') : '';
	var cls = opts.cls ? (' class="' + opts.cls + '"') : '';
	var $div = $('<div' + id + cls + '>');
	$el.after($div).remove();
	if (lameIE || player == 'iframe' || player == 'img')
		$div.append(o);
	else
		$div.html(a.join(''));
	
	if (opts.caption) 
		$('<div>').appendTo($div).html(opts.caption);
	return $div;
}


})(jQuery);/**
 * jQuery.timers - Timer abstractions for jQuery
 * Written by Blair Mitchelmore (blair DOT mitchelmore AT gmail DOT com)
 * Licensed under the WTFPL (http://sam.zoy.org/wtfpl/).
 * Date: 2009/10/16
 *
 * @author Blair Mitchelmore
 * @version 1.2
 *
 **/

jQuery.fn.extend({
	everyTime: function(interval, label, fn, times) {
		return this.each(function() {
			jQuery.timer.add(this, interval, label, fn, times);
		});
	},
	oneTime: function(interval, label, fn) {
		return this.each(function() {
			jQuery.timer.add(this, interval, label, fn, 1);
		});
	},
	stopTime: function(label, fn) {
		return this.each(function() {
			jQuery.timer.remove(this, label, fn);
		});
	}
});

jQuery.extend({
	timer: {
		global: [],
		guid: 1,
		dataKey: "jQuery.timer",
		regex: /^([0-9]+(?:\.[0-9]*)?)\s*(.*s)?$/,
		powers: {
			// Yeah this is major overkill...
			'ms': 1,
			'cs': 10,
			'ds': 100,
			's': 1000,
			'das': 10000,
			'hs': 100000,
			'ks': 1000000
		},
		timeParse: function(value) {
			if (value == undefined || value == null)
				return null;
			var result = this.regex.exec(jQuery.trim(value.toString()));
			if (result[2]) {
				var num = parseFloat(result[1]);
				var mult = this.powers[result[2]] || 1;
				return num * mult;
			} else {
				return value;
			}
		},
		add: function(element, interval, label, fn, times) {
			var counter = 0;
			
			if (jQuery.isFunction(label)) {
				if (!times) 
					times = fn;
				fn = label;
				label = interval;
			}
			
			interval = jQuery.timer.timeParse(interval);

			if (typeof interval != 'number' || isNaN(interval) || interval < 0)
				return;

			if (typeof times != 'number' || isNaN(times) || times < 0) 
				times = 0;
			
			times = times || 0;
			
			var timers = jQuery.data(element, this.dataKey) || jQuery.data(element, this.dataKey, {});
			
			if (!timers[label])
				timers[label] = {};
			
			fn.timerID = fn.timerID || this.guid++;
			
			var handler = function() {
				if ((++counter > times && times !== 0) || fn.call(element, counter) === false)
					jQuery.timer.remove(element, label, fn);
			};
			
			handler.timerID = fn.timerID;
			
			if (!timers[label][fn.timerID])
				timers[label][fn.timerID] = window.setInterval(handler,interval);
			
			this.global.push( element );
			
		},
		remove: function(element, label, fn) {
			var timers = jQuery.data(element, this.dataKey), ret;
			
			if ( timers ) {
				
				if (!label) {
					for ( label in timers )
						this.remove(element, label, fn);
				} else if ( timers[label] ) {
					if ( fn ) {
						if ( fn.timerID ) {
							window.clearInterval(timers[label][fn.timerID]);
							delete timers[label][fn.timerID];
						}
					} else {
						for ( var fn in timers[label] ) {
							window.clearInterval(timers[label][fn]);
							delete timers[label][fn];
						}
					}
					
					for ( ret in timers[label] ) break;
					if ( !ret ) {
						ret = null;
						delete timers[label];
					}
				}
				
				for ( ret in timers ) break;
				if ( !ret ) 
					jQuery.removeData(element, this.dataKey);
			}
		}
	}
});

jQuery(window).bind("unload", function() {
	jQuery.each(jQuery.timer.global, function(index, item) {
		jQuery.timer.remove(item);
	});
});/**
 *  This file is part of Wigii.
 *  Wigii is developed to inspire humanity. To Humankind we offer Gracefulness, Righteousness and Goodness.
 *  
 *  Wigii is free software: you can redistribute it and/or modify it 
 *  under the terms of the GNU General Public License as published by
 *  the Free Software Foundation, either version 3 of the License, 
 *  or (at your option) any later version.
 *  
 *  Wigii is distributed in the hope that it will be useful, but WITHOUT ANY WARRANTY; 
 *  without even the implied warranty of MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  
 *  See the GNU General Public License for more details.
 *
 *  A copy of the GNU General Public License is available in the Readme folder of the source code.  
 *  If not, see <http://www.gnu.org/licenses/>.
 *
 *  @copyright  Copyright (c) 2016  Wigii.org
 *  @author     <http://www.wigii.org/system>      Wigii.org 
 *  @link       <http://www.wigii-system.net>      <https://github.com/wigii/wigii>   Source Code
 *  @license    <http://www.gnu.org/licenses/>     GNU General Public License
 *  
 *  
 *  This small plugin is inpired from http://stackoverflow.com/questions/10151238/jquery-plugin-character-count-for-textareas
 *  
 */
 
(function($) {

	$.fn.wordlimit = function(options){

		// default configuration properties
		var defaults = {    
			allowed: 10,
			wordcounttext : 'Word count'
		};

		var options = $.extend(defaults, options); 

		function calculate(obj, event){
			if($(obj).val()){
	            var count = $(obj).val().split(' ').length;
			} else {
				var count = 0;
			}
            var available = options.allowed - count;
            if(available < 0 && event){
            	//allow del, backspace, tab, home, end, arrows
            	if (event.which != 46 && event.which != 8 && event.which != 9
            		&& event.which != 37 && event.which != 38 && event.which != 39 && event.which != 40
            		&& event.which != 35 && event.which != 36) { 
            		event.preventDefault(); 
	            	//remove last words
	            	words = $(obj).val().split(' ');
	            	words = words.slice(0, options.allowed);
	            	$(obj).val(words.join(' ')+' ');
            	}
            }
            //if available < 0 just continue to display 0 word available...
            $(obj).parent().parent().find('.label span.counter').html('('+options.wordcounttext+' '+Math.min(count, options.allowed)+' / '+options.allowed+')');
        };

        this.each(function(e) {              
			$(this).parent().parent().find('.label').append('&nbsp;&nbsp;<span class="counter"></span>');
			calculate(this, e);
			$(this).keydown(function(e){calculate(this, e)});
			$(this).click(function(e){calculate(this, e)});
			$(this).blur(function(e){calculate(this, e)});
			$(this).change(function(e){calculate(this, e)});
		});

	};

})(jQuery);// Spectrum Colorpicker v1.8.0
// https://github.com/bgrins/spectrum
// Author: Brian Grinstead
// License: MIT

(function (factory) {
    "use strict";

    if (typeof define === 'function' && define.amd) { // AMD
        define(['jquery'], factory);
    }
    else if (typeof exports == "object" && typeof module == "object") { // CommonJS
        module.exports = factory(require('jquery'));
    }
    else { // Browser
        factory(jQuery);
    }
})(function($, undefined) {
    "use strict";

    var defaultOpts = {

        // Callbacks
        beforeShow: noop,
        move: noop,
        change: noop,
        show: noop,
        hide: noop,

        // Options
        color: false,
        flat: false,
        showInput: false,
        allowEmpty: false,
        showButtons: true,
        clickoutFiresChange: true,
        showInitial: false,
        showPalette: false,
        showPaletteOnly: false,
        hideAfterPaletteSelect: false,
        togglePaletteOnly: false,
        showSelectionPalette: true,
        localStorageKey: false,
        appendTo: "body",
        maxSelectionSize: 7,
        cancelText: "cancel",
        chooseText: "choose",
        togglePaletteMoreText: "more",
        togglePaletteLessText: "less",
        clearText: "Clear Color Selection",
        noColorSelectedText: "No Color Selected",
        preferredFormat: false,
        className: "", // Deprecated - use containerClassName and replacerClassName instead.
        containerClassName: "",
        replacerClassName: "",
        showAlpha: false,
        theme: "sp-light",
        palette: [["#ffffff", "#000000", "#ff0000", "#ff8000", "#ffff00", "#008000", "#0000ff", "#4b0082", "#9400d3"]],
        selectionPalette: [],
        disabled: false,
        offset: null
    },
    spectrums = [],
    IE = !!/msie/i.exec( window.navigator.userAgent ),
    rgbaSupport = (function() {
        function contains( str, substr ) {
            return !!~('' + str).indexOf(substr);
        }

        var elem = document.createElement('div');
        var style = elem.style;
        style.cssText = 'background-color:rgba(0,0,0,.5)';
        return contains(style.backgroundColor, 'rgba') || contains(style.backgroundColor, 'hsla');
    })(),
    replaceInput = [
        "<div class='sp-replacer'>",
            "<div class='sp-preview'><div class='sp-preview-inner'></div></div>",
            "<div class='sp-dd'>&#9660;</div>",
        "</div>"
    ].join(''),
    markup = (function () {

        // IE does not support gradients with multiple stops, so we need to simulate
        //  that for the rainbow slider with 8 divs that each have a single gradient
        var gradientFix = "";
        if (IE) {
            for (var i = 1; i <= 6; i++) {
                gradientFix += "<div class='sp-" + i + "'></div>";
            }
        }

        return [
            "<div class='sp-container sp-hidden'>",
                "<div class='sp-palette-container'>",
                    "<div class='sp-palette sp-thumb sp-cf'></div>",
                    "<div class='sp-palette-button-container sp-cf'>",
                        "<button type='button' class='sp-palette-toggle'></button>",
                    "</div>",
                "</div>",
                "<div class='sp-picker-container'>",
                    "<div class='sp-top sp-cf'>",
                        "<div class='sp-fill'></div>",
                        "<div class='sp-top-inner'>",
                            "<div class='sp-color'>",
                                "<div class='sp-sat'>",
                                    "<div class='sp-val'>",
                                        "<div class='sp-dragger'></div>",
                                    "</div>",
                                "</div>",
                            "</div>",
                            "<div class='sp-clear sp-clear-display'>",
                            "</div>",
                            "<div class='sp-hue'>",
                                "<div class='sp-slider'></div>",
                                gradientFix,
                            "</div>",
                        "</div>",
                        "<div class='sp-alpha'><div class='sp-alpha-inner'><div class='sp-alpha-handle'></div></div></div>",
                    "</div>",
                    "<div class='sp-input-container sp-cf'>",
                        "<input class='sp-input' type='text' spellcheck='false'  />",
                    "</div>",
                    "<div class='sp-initial sp-thumb sp-cf'></div>",
                    "<div class='sp-button-container sp-cf'>",
                        "<a class='sp-cancel' href='#'></a>",
                        "<button type='button' class='sp-choose'></button>",
                    "</div>",
                "</div>",
            "</div>"
        ].join("");
    })();

    function paletteTemplate (p, color, className, opts) {
        var html = [];
        for (var i = 0; i < p.length; i++) {
            var current = p[i];
            if(current) {
                var tiny = tinycolor(current);
                var c = tiny.toHsl().l < 0.5 ? "sp-thumb-el sp-thumb-dark" : "sp-thumb-el sp-thumb-light";
                c += (tinycolor.equals(color, current)) ? " sp-thumb-active" : "";
                var formattedString = tiny.toString(opts.preferredFormat || "rgb");
                var swatchStyle = rgbaSupport ? ("background-color:" + tiny.toRgbString()) : "filter:" + tiny.toFilter();
                html.push('<span title="' + formattedString + '" data-color="' + tiny.toRgbString() + '" class="' + c + '"><span class="sp-thumb-inner" style="' + swatchStyle + ';" /></span>');
            } else {
                var cls = 'sp-clear-display';
                html.push($('<div />')
                    .append($('<span data-color="" style="background-color:transparent;" class="' + cls + '"></span>')
                        .attr('title', opts.noColorSelectedText)
                    )
                    .html()
                );
            }
        }
        return "<div class='sp-cf " + className + "'>" + html.join('') + "</div>";
    }

    function hideAll() {
        for (var i = 0; i < spectrums.length; i++) {
            if (spectrums[i]) {
                spectrums[i].hide();
            }
        }
    }

    function instanceOptions(o, callbackContext) {
        var opts = $.extend({}, defaultOpts, o);
        opts.callbacks = {
            'move': bind(opts.move, callbackContext),
            'change': bind(opts.change, callbackContext),
            'show': bind(opts.show, callbackContext),
            'hide': bind(opts.hide, callbackContext),
            'beforeShow': bind(opts.beforeShow, callbackContext)
        };

        return opts;
    }

    function spectrum(element, o) {

        var opts = instanceOptions(o, element),
            flat = opts.flat,
            showSelectionPalette = opts.showSelectionPalette,
            localStorageKey = opts.localStorageKey,
            theme = opts.theme,
            callbacks = opts.callbacks,
            resize = throttle(reflow, 10),
            visible = false,
            isDragging = false,
            dragWidth = 0,
            dragHeight = 0,
            dragHelperHeight = 0,
            slideHeight = 0,
            slideWidth = 0,
            alphaWidth = 0,
            alphaSlideHelperWidth = 0,
            slideHelperHeight = 0,
            currentHue = 0,
            currentSaturation = 0,
            currentValue = 0,
            currentAlpha = 1,
            palette = [],
            paletteArray = [],
            paletteLookup = {},
            selectionPalette = opts.selectionPalette.slice(0),
            maxSelectionSize = opts.maxSelectionSize,
            draggingClass = "sp-dragging",
            shiftMovementDirection = null;

        var doc = element.ownerDocument,
            body = doc.body,
            boundElement = $(element),
            disabled = false,
            container = $(markup, doc).addClass(theme),
            pickerContainer = container.find(".sp-picker-container"),
            dragger = container.find(".sp-color"),
            dragHelper = container.find(".sp-dragger"),
            slider = container.find(".sp-hue"),
            slideHelper = container.find(".sp-slider"),
            alphaSliderInner = container.find(".sp-alpha-inner"),
            alphaSlider = container.find(".sp-alpha"),
            alphaSlideHelper = container.find(".sp-alpha-handle"),
            textInput = container.find(".sp-input"),
            paletteContainer = container.find(".sp-palette"),
            initialColorContainer = container.find(".sp-initial"),
            cancelButton = container.find(".sp-cancel"),
            clearButton = container.find(".sp-clear"),
            chooseButton = container.find(".sp-choose"),
            toggleButton = container.find(".sp-palette-toggle"),
            isInput = boundElement.is("input"),
            isInputTypeColor = isInput && boundElement.attr("type") === "color" && inputTypeColorSupport(),
            shouldReplace = isInput && !flat,
            replacer = (shouldReplace) ? $(replaceInput).addClass(theme).addClass(opts.className).addClass(opts.replacerClassName) : $([]),
            offsetElement = (shouldReplace) ? replacer : boundElement,
            previewElement = replacer.find(".sp-preview-inner"),
            initialColor = opts.color || (isInput && boundElement.val()),
            colorOnShow = false,
            currentPreferredFormat = opts.preferredFormat,
            clickoutFiresChange = !opts.showButtons || opts.clickoutFiresChange,
            isEmpty = !initialColor,
            allowEmpty = opts.allowEmpty && !isInputTypeColor;

        function applyOptions() {

            if (opts.showPaletteOnly) {
                opts.showPalette = true;
            }

            toggleButton.text(opts.showPaletteOnly ? opts.togglePaletteMoreText : opts.togglePaletteLessText);

            if (opts.palette) {
                palette = opts.palette.slice(0);
                paletteArray = $.isArray(palette[0]) ? palette : [palette];
                paletteLookup = {};
                for (var i = 0; i < paletteArray.length; i++) {
                    for (var j = 0; j < paletteArray[i].length; j++) {
                        var rgb = tinycolor(paletteArray[i][j]).toRgbString();
                        paletteLookup[rgb] = true;
                    }
                }
            }

            container.toggleClass("sp-flat", flat);
            container.toggleClass("sp-input-disabled", !opts.showInput);
            container.toggleClass("sp-alpha-enabled", opts.showAlpha);
            container.toggleClass("sp-clear-enabled", allowEmpty);
            container.toggleClass("sp-buttons-disabled", !opts.showButtons);
            container.toggleClass("sp-palette-buttons-disabled", !opts.togglePaletteOnly);
            container.toggleClass("sp-palette-disabled", !opts.showPalette);
            container.toggleClass("sp-palette-only", opts.showPaletteOnly);
            container.toggleClass("sp-initial-disabled", !opts.showInitial);
            container.addClass(opts.className).addClass(opts.containerClassName);

            reflow();
        }

        function initialize() {

            if (IE) {
                container.find("*:not(input)").attr("unselectable", "on");
            }

            applyOptions();

            if (shouldReplace) {
                boundElement.after(replacer).hide();
            }

            if (!allowEmpty) {
                clearButton.hide();
            }

            if (flat) {
                boundElement.after(container).hide();
            }
            else {

                var appendTo = opts.appendTo === "parent" ? boundElement.parent() : $(opts.appendTo);
                if (appendTo.length !== 1) {
                    appendTo = $("body");
                }

                appendTo.append(container);
            }

            updateSelectionPaletteFromStorage();

            offsetElement.bind("click.spectrum touchstart.spectrum", function (e) {
                if (!disabled) {
                    toggle();
                }

                e.stopPropagation();

                if (!$(e.target).is("input")) {
                    e.preventDefault();
                }
            });

            if(boundElement.is(":disabled") || (opts.disabled === true)) {
                disable();
            }

            // Prevent clicks from bubbling up to document.  This would cause it to be hidden.
            container.click(stopPropagation);

            // Handle user typed input
            textInput.change(setFromTextInput);
            textInput.bind("paste", function () {
                setTimeout(setFromTextInput, 1);
            });
            textInput.keydown(function (e) { if (e.keyCode == 13) { setFromTextInput(); } });

            cancelButton.text(opts.cancelText);
            cancelButton.bind("click.spectrum", function (e) {
                e.stopPropagation();
                e.preventDefault();
                revert();
                hide();
            });

            clearButton.attr("title", opts.clearText);
            clearButton.bind("click.spectrum", function (e) {
                e.stopPropagation();
                e.preventDefault();
                isEmpty = true;
                move();

                if(flat) {
                    //for the flat style, this is a change event
                    updateOriginalInput(true);
                }
            });

            chooseButton.text(opts.chooseText);
            chooseButton.bind("click.spectrum", function (e) {
                e.stopPropagation();
                e.preventDefault();

                if (IE && textInput.is(":focus")) {
                    textInput.trigger('change');
                }

                if (isValid()) {
                    updateOriginalInput(true);
                    hide();
                }
            });

            toggleButton.text(opts.showPaletteOnly ? opts.togglePaletteMoreText : opts.togglePaletteLessText);
            toggleButton.bind("click.spectrum", function (e) {
                e.stopPropagation();
                e.preventDefault();

                opts.showPaletteOnly = !opts.showPaletteOnly;

                // To make sure the Picker area is drawn on the right, next to the
                // Palette area (and not below the palette), first move the Palette
                // to the left to make space for the picker, plus 5px extra.
                // The 'applyOptions' function puts the whole container back into place
                // and takes care of the button-text and the sp-palette-only CSS class.
                if (!opts.showPaletteOnly && !flat) {
                    container.css('left', '-=' + (pickerContainer.outerWidth(true) + 5));
                }
                applyOptions();
            });

            draggable(alphaSlider, function (dragX, dragY, e) {
                currentAlpha = (dragX / alphaWidth);
                isEmpty = false;
                if (e.shiftKey) {
                    currentAlpha = Math.round(currentAlpha * 10) / 10;
                }

                move();
            }, dragStart, dragStop);

            draggable(slider, function (dragX, dragY) {
                currentHue = parseFloat(dragY / slideHeight);
                isEmpty = false;
                if (!opts.showAlpha) {
                    currentAlpha = 1;
                }
                move();
            }, dragStart, dragStop);

            draggable(dragger, function (dragX, dragY, e) {

                // shift+drag should snap the movement to either the x or y axis.
                if (!e.shiftKey) {
                    shiftMovementDirection = null;
                }
                else if (!shiftMovementDirection) {
                    var oldDragX = currentSaturation * dragWidth;
                    var oldDragY = dragHeight - (currentValue * dragHeight);
                    var furtherFromX = Math.abs(dragX - oldDragX) > Math.abs(dragY - oldDragY);

                    shiftMovementDirection = furtherFromX ? "x" : "y";
                }

                var setSaturation = !shiftMovementDirection || shiftMovementDirection === "x";
                var setValue = !shiftMovementDirection || shiftMovementDirection === "y";

                if (setSaturation) {
                    currentSaturation = parseFloat(dragX / dragWidth);
                }
                if (setValue) {
                    currentValue = parseFloat((dragHeight - dragY) / dragHeight);
                }

                isEmpty = false;
                if (!opts.showAlpha) {
                    currentAlpha = 1;
                }

                move();

            }, dragStart, dragStop);

            if (!!initialColor) {
                set(initialColor);

                // In case color was black - update the preview UI and set the format
                // since the set function will not run (default color is black).
                updateUI();
                currentPreferredFormat = opts.preferredFormat || tinycolor(initialColor).format;

                addColorToSelectionPalette(initialColor);
            }
            else {
                updateUI();
            }

            if (flat) {
                show();
            }

            function paletteElementClick(e) {
                if (e.data && e.data.ignore) {
                    set($(e.target).closest(".sp-thumb-el").data("color"));
                    move();
                }
                else {
                    set($(e.target).closest(".sp-thumb-el").data("color"));
                    move();
                    updateOriginalInput(true);
                    if (opts.hideAfterPaletteSelect) {
                      hide();
                    }
                }

                return false;
            }

            var paletteEvent = IE ? "mousedown.spectrum" : "click.spectrum touchstart.spectrum";
            paletteContainer.delegate(".sp-thumb-el", paletteEvent, paletteElementClick);
            initialColorContainer.delegate(".sp-thumb-el:nth-child(1)", paletteEvent, { ignore: true }, paletteElementClick);
        }

        function updateSelectionPaletteFromStorage() {

            if (localStorageKey && window.localStorage) {

                // Migrate old palettes over to new format.  May want to remove this eventually.
                try {
                    var oldPalette = window.localStorage[localStorageKey].split(",#");
                    if (oldPalette.length > 1) {
                        delete window.localStorage[localStorageKey];
                        $.each(oldPalette, function(i, c) {
                             addColorToSelectionPalette(c);
                        });
                    }
                }
                catch(e) { }

                try {
                    selectionPalette = window.localStorage[localStorageKey].split(";");
                }
                catch (e) { }
            }
        }

        function addColorToSelectionPalette(color) {
            if (showSelectionPalette) {
                var rgb = tinycolor(color).toRgbString();
                if (!paletteLookup[rgb] && $.inArray(rgb, selectionPalette) === -1) {
                    selectionPalette.push(rgb);
                    while(selectionPalette.length > maxSelectionSize) {
                        selectionPalette.shift();
                    }
                }

                if (localStorageKey && window.localStorage) {
                    try {
                        window.localStorage[localStorageKey] = selectionPalette.join(";");
                    }
                    catch(e) { }
                }
            }
        }

        function getUniqueSelectionPalette() {
            var unique = [];
            if (opts.showPalette) {
                for (var i = 0; i < selectionPalette.length; i++) {
                    var rgb = tinycolor(selectionPalette[i]).toRgbString();

                    if (!paletteLookup[rgb]) {
                        unique.push(selectionPalette[i]);
                    }
                }
            }

            return unique.reverse().slice(0, opts.maxSelectionSize);
        }

        function drawPalette() {

            var currentColor = get();

            var html = $.map(paletteArray, function (palette, i) {
                return paletteTemplate(palette, currentColor, "sp-palette-row sp-palette-row-" + i, opts);
            });

            updateSelectionPaletteFromStorage();

            if (selectionPalette) {
                html.push(paletteTemplate(getUniqueSelectionPalette(), currentColor, "sp-palette-row sp-palette-row-selection", opts));
            }

            paletteContainer.html(html.join(""));
        }

        function drawInitial() {
            if (opts.showInitial) {
                var initial = colorOnShow;
                var current = get();
                initialColorContainer.html(paletteTemplate([initial, current], current, "sp-palette-row-initial", opts));
            }
        }

        function dragStart() {
            if (dragHeight <= 0 || dragWidth <= 0 || slideHeight <= 0) {
                reflow();
            }
            isDragging = true;
            container.addClass(draggingClass);
            shiftMovementDirection = null;
            boundElement.trigger('dragstart.spectrum', [ get() ]);
        }

        function dragStop() {
            isDragging = false;
            container.removeClass(draggingClass);
            boundElement.trigger('dragstop.spectrum', [ get() ]);
        }

        function setFromTextInput() {

            var value = textInput.val();

            if ((value === null || value === "") && allowEmpty) {
                set(null);
                updateOriginalInput(true);
            }
            else {
                var tiny = tinycolor(value);
                if (tiny.isValid()) {
                    set(tiny);
                    updateOriginalInput(true);
                }
                else {
                    textInput.addClass("sp-validation-error");
                }
            }
        }

        function toggle() {
            if (visible) {
                hide();
            }
            else {
                show();
            }
        }

        function show() {
            var event = $.Event('beforeShow.spectrum');

            if (visible) {
                reflow();
                return;
            }

            boundElement.trigger(event, [ get() ]);

            if (callbacks.beforeShow(get()) === false || event.isDefaultPrevented()) {
                return;
            }

            hideAll();
            visible = true;

            $(doc).bind("keydown.spectrum", onkeydown);
            $(doc).bind("click.spectrum", clickout);
            $(window).bind("resize.spectrum", resize);
            replacer.addClass("sp-active");
            container.removeClass("sp-hidden");

            reflow();
            updateUI();

            colorOnShow = get();

            drawInitial();
            callbacks.show(colorOnShow);
            boundElement.trigger('show.spectrum', [ colorOnShow ]);
        }

        function onkeydown(e) {
            // Close on ESC
            if (e.keyCode === 27) {
                hide();
            }
        }

        function clickout(e) {
            // Return on right click.
            if (e.button == 2) { return; }

            // If a drag event was happening during the mouseup, don't hide
            // on click.
            if (isDragging) { return; }

            if (clickoutFiresChange) {
                updateOriginalInput(true);
            }
            else {
                revert();
            }
            hide();
        }

        function hide() {
            // Return if hiding is unnecessary
            if (!visible || flat) { return; }
            visible = false;

            $(doc).unbind("keydown.spectrum", onkeydown);
            $(doc).unbind("click.spectrum", clickout);
            $(window).unbind("resize.spectrum", resize);

            replacer.removeClass("sp-active");
            container.addClass("sp-hidden");

            callbacks.hide(get());
            boundElement.trigger('hide.spectrum', [ get() ]);
        }

        function revert() {
            set(colorOnShow, true);
        }

        function set(color, ignoreFormatChange) {
            if (tinycolor.equals(color, get())) {
                // Update UI just in case a validation error needs
                // to be cleared.
                updateUI();
                return;
            }

            var newColor, newHsv;
            if (!color && allowEmpty) {
                isEmpty = true;
            } else {
                isEmpty = false;
                newColor = tinycolor(color);
                newHsv = newColor.toHsv();

                currentHue = (newHsv.h % 360) / 360;
                currentSaturation = newHsv.s;
                currentValue = newHsv.v;
                currentAlpha = newHsv.a;
            }
            updateUI();

            if (newColor && newColor.isValid() && !ignoreFormatChange) {
                currentPreferredFormat = opts.preferredFormat || newColor.getFormat();
            }
        }

        function get(opts) {
            opts = opts || { };

            if (allowEmpty && isEmpty) {
                return null;
            }

            return tinycolor.fromRatio({
                h: currentHue,
                s: currentSaturation,
                v: currentValue,
                a: Math.round(currentAlpha * 100) / 100
            }, { format: opts.format || currentPreferredFormat });
        }

        function isValid() {
            return !textInput.hasClass("sp-validation-error");
        }

        function move() {
            updateUI();

            callbacks.move(get());
            boundElement.trigger('move.spectrum', [ get() ]);
        }

        function updateUI() {

            textInput.removeClass("sp-validation-error");

            updateHelperLocations();

            // Update dragger background color (gradients take care of saturation and value).
            var flatColor = tinycolor.fromRatio({ h: currentHue, s: 1, v: 1 });
            dragger.css("background-color", flatColor.toHexString());

            // Get a format that alpha will be included in (hex and names ignore alpha)
            var format = currentPreferredFormat;
            if (currentAlpha < 1 && !(currentAlpha === 0 && format === "name")) {
                if (format === "hex" || format === "hex3" || format === "hex6" || format === "name") {
                    format = "rgb";
                }
            }

            var realColor = get({ format: format }),
                displayColor = '';

             //reset background info for preview element
            previewElement.removeClass("sp-clear-display");
            previewElement.css('background-color', 'transparent');

            if (!realColor && allowEmpty) {
                // Update the replaced elements background with icon indicating no color selection
                previewElement.addClass("sp-clear-display");
            }
            else {
                var realHex = realColor.toHexString(),
                    realRgb = realColor.toRgbString();

                // Update the replaced elements background color (with actual selected color)
                if (rgbaSupport || realColor.alpha === 1) {
                    previewElement.css("background-color", realRgb);
                }
                else {
                    previewElement.css("background-color", "transparent");
                    previewElement.css("filter", realColor.toFilter());
                }

                if (opts.showAlpha) {
                    var rgb = realColor.toRgb();
                    rgb.a = 0;
                    var realAlpha = tinycolor(rgb).toRgbString();
                    var gradient = "linear-gradient(left, " + realAlpha + ", " + realHex + ")";

                    if (IE) {
                        alphaSliderInner.css("filter", tinycolor(realAlpha).toFilter({ gradientType: 1 }, realHex));
                    }
                    else {
                        alphaSliderInner.css("background", "-webkit-" + gradient);
                        alphaSliderInner.css("background", "-moz-" + gradient);
                        alphaSliderInner.css("background", "-ms-" + gradient);
                        // Use current syntax gradient on unprefixed property.
                        alphaSliderInner.css("background",
                            "linear-gradient(to right, " + realAlpha + ", " + realHex + ")");
                    }
                }

                displayColor = realColor.toString(format);
            }

            // Update the text entry input as it changes happen
            if (opts.showInput) {
                textInput.val(displayColor);
            }

            if (opts.showPalette) {
                drawPalette();
            }

            drawInitial();
        }

        function updateHelperLocations() {
            var s = currentSaturation;
            var v = currentValue;

            if(allowEmpty && isEmpty) {
                //if selected color is empty, hide the helpers
                alphaSlideHelper.hide();
                slideHelper.hide();
                dragHelper.hide();
            }
            else {
                //make sure helpers are visible
                alphaSlideHelper.show();
                slideHelper.show();
                dragHelper.show();

                // Where to show the little circle in that displays your current selected color
                var dragX = s * dragWidth;
                var dragY = dragHeight - (v * dragHeight);
                dragX = Math.max(
                    -dragHelperHeight,
                    Math.min(dragWidth - dragHelperHeight, dragX - dragHelperHeight)
                );
                dragY = Math.max(
                    -dragHelperHeight,
                    Math.min(dragHeight - dragHelperHeight, dragY - dragHelperHeight)
                );
                dragHelper.css({
                    "top": dragY + "px",
                    "left": dragX + "px"
                });

                var alphaX = currentAlpha * alphaWidth;
                alphaSlideHelper.css({
                    "left": (alphaX - (alphaSlideHelperWidth / 2)) + "px"
                });

                // Where to show the bar that displays your current selected hue
                var slideY = (currentHue) * slideHeight;
                slideHelper.css({
                    "top": (slideY - slideHelperHeight) + "px"
                });
            }
        }

        function updateOriginalInput(fireCallback) {
            var color = get(),
                displayColor = '',
                hasChanged = !tinycolor.equals(color, colorOnShow);

            if (color) {
                displayColor = color.toString(currentPreferredFormat);
                // Update the selection palette with the current color
                addColorToSelectionPalette(color);
            }

            if (isInput) {
                boundElement.val(displayColor);
            }

            if (fireCallback && hasChanged) {
                callbacks.change(color);
                boundElement.trigger('change', [ color ]);
            }
        }

        function reflow() {
            if (!visible) {
                return; // Calculations would be useless and wouldn't be reliable anyways
            }
            dragWidth = dragger.width();
            dragHeight = dragger.height();
            dragHelperHeight = dragHelper.height();
            slideWidth = slider.width();
            slideHeight = slider.height();
            slideHelperHeight = slideHelper.height();
            alphaWidth = alphaSlider.width();
            alphaSlideHelperWidth = alphaSlideHelper.width();

            if (!flat) {
                container.css("position", "absolute");
                if (opts.offset) {
                    container.offset(opts.offset);
                } else {
                    container.offset(getOffset(container, offsetElement));
                }
            }

            updateHelperLocations();

            if (opts.showPalette) {
                drawPalette();
            }

            boundElement.trigger('reflow.spectrum');
        }

        function destroy() {
            boundElement.show();
            offsetElement.unbind("click.spectrum touchstart.spectrum");
            container.remove();
            replacer.remove();
            spectrums[spect.id] = null;
        }

        function option(optionName, optionValue) {
            if (optionName === undefined) {
                return $.extend({}, opts);
            }
            if (optionValue === undefined) {
                return opts[optionName];
            }

            opts[optionName] = optionValue;

            if (optionName === "preferredFormat") {
                currentPreferredFormat = opts.preferredFormat;
            }
            applyOptions();
        }

        function enable() {
            disabled = false;
            boundElement.attr("disabled", false);
            offsetElement.removeClass("sp-disabled");
        }

        function disable() {
            hide();
            disabled = true;
            boundElement.attr("disabled", true);
            offsetElement.addClass("sp-disabled");
        }

        function setOffset(coord) {
            opts.offset = coord;
            reflow();
        }

        initialize();

        var spect = {
            show: show,
            hide: hide,
            toggle: toggle,
            reflow: reflow,
            option: option,
            enable: enable,
            disable: disable,
            offset: setOffset,
            set: function (c) {
                set(c);
                updateOriginalInput();
            },
            get: get,
            destroy: destroy,
            container: container
        };

        spect.id = spectrums.push(spect) - 1;

        return spect;
    }

    /**
    * checkOffset - get the offset below/above and left/right element depending on screen position
    * Thanks https://github.com/jquery/jquery-ui/blob/master/ui/jquery.ui.datepicker.js
    */
    function getOffset(picker, input) {
        var extraY = 0;
        var dpWidth = picker.outerWidth();
        var dpHeight = picker.outerHeight();
        var inputHeight = input.outerHeight();
        var doc = picker[0].ownerDocument;
        var docElem = doc.documentElement;
        var viewWidth = docElem.clientWidth + $(doc).scrollLeft();
        var viewHeight = docElem.clientHeight + $(doc).scrollTop();
        var offset = input.offset();
        offset.top += inputHeight;

        offset.left -=
            Math.min(offset.left, (offset.left + dpWidth > viewWidth && viewWidth > dpWidth) ?
            Math.abs(offset.left + dpWidth - viewWidth) : 0);

        offset.top -=
            Math.min(offset.top, ((offset.top + dpHeight > viewHeight && viewHeight > dpHeight) ?
            Math.abs(dpHeight + inputHeight - extraY) : extraY));

        return offset;
    }

    /**
    * noop - do nothing
    */
    function noop() {

    }

    /**
    * stopPropagation - makes the code only doing this a little easier to read in line
    */
    function stopPropagation(e) {
        e.stopPropagation();
    }

    /**
    * Create a function bound to a given object
    * Thanks to underscore.js
    */
    function bind(func, obj) {
        var slice = Array.prototype.slice;
        var args = slice.call(arguments, 2);
        return function () {
            return func.apply(obj, args.concat(slice.call(arguments)));
        };
    }

    /**
    * Lightweight drag helper.  Handles containment within the element, so that
    * when dragging, the x is within [0,element.width] and y is within [0,element.height]
    */
    function draggable(element, onmove, onstart, onstop) {
        onmove = onmove || function () { };
        onstart = onstart || function () { };
        onstop = onstop || function () { };
        var doc = document;
        var dragging = false;
        var offset = {};
        var maxHeight = 0;
        var maxWidth = 0;
        var hasTouch = ('ontouchstart' in window);

        var duringDragEvents = {};
        duringDragEvents["selectstart"] = prevent;
        duringDragEvents["dragstart"] = prevent;
        duringDragEvents["touchmove mousemove"] = move;
        duringDragEvents["touchend mouseup"] = stop;

        function prevent(e) {
            if (e.stopPropagation) {
                e.stopPropagation();
            }
            if (e.preventDefault) {
                e.preventDefault();
            }
            e.returnValue = false;
        }

        function move(e) {
            if (dragging) {
                // Mouseup happened outside of window
                if (IE && doc.documentMode < 9 && !e.button) {
                    return stop();
                }

                var t0 = e.originalEvent && e.originalEvent.touches && e.originalEvent.touches[0];
                var pageX = t0 && t0.pageX || e.pageX;
                var pageY = t0 && t0.pageY || e.pageY;

                var dragX = Math.max(0, Math.min(pageX - offset.left, maxWidth));
                var dragY = Math.max(0, Math.min(pageY - offset.top, maxHeight));

                if (hasTouch) {
                    // Stop scrolling in iOS
                    prevent(e);
                }

                onmove.apply(element, [dragX, dragY, e]);
            }
        }

        function start(e) {
            var rightclick = (e.which) ? (e.which == 3) : (e.button == 2);

            if (!rightclick && !dragging) {
                if (onstart.apply(element, arguments) !== false) {
                    dragging = true;
                    maxHeight = $(element).height();
                    maxWidth = $(element).width();
                    offset = $(element).offset();

                    $(doc).bind(duringDragEvents);
                    $(doc.body).addClass("sp-dragging");

                    move(e);

                    prevent(e);
                }
            }
        }

        function stop() {
            if (dragging) {
                $(doc).unbind(duringDragEvents);
                $(doc.body).removeClass("sp-dragging");

                // Wait a tick before notifying observers to allow the click event
                // to fire in Chrome.
                setTimeout(function() {
                    onstop.apply(element, arguments);
                }, 0);
            }
            dragging = false;
        }

        $(element).bind("touchstart mousedown", start);
    }

    function throttle(func, wait, debounce) {
        var timeout;
        return function () {
            var context = this, args = arguments;
            var throttler = function () {
                timeout = null;
                func.apply(context, args);
            };
            if (debounce) clearTimeout(timeout);
            if (debounce || !timeout) timeout = setTimeout(throttler, wait);
        };
    }

    function inputTypeColorSupport() {
        return $.fn.spectrum.inputTypeColorSupport();
    }

    /**
    * Define a jQuery plugin
    */
    var dataID = "spectrum.id";
    $.fn.spectrum = function (opts, extra) {

        if (typeof opts == "string") {

            var returnValue = this;
            var args = Array.prototype.slice.call( arguments, 1 );

            this.each(function () {
                var spect = spectrums[$(this).data(dataID)];
                if (spect) {
                    var method = spect[opts];
                    if (!method) {
                        throw new Error( "Spectrum: no such method: '" + opts + "'" );
                    }

                    if (opts == "get") {
                        returnValue = spect.get();
                    }
                    else if (opts == "container") {
                        returnValue = spect.container;
                    }
                    else if (opts == "option") {
                        returnValue = spect.option.apply(spect, args);
                    }
                    else if (opts == "destroy") {
                        spect.destroy();
                        $(this).removeData(dataID);
                    }
                    else {
                        method.apply(spect, args);
                    }
                }
            });

            return returnValue;
        }

        // Initializing a new instance of spectrum
        return this.spectrum("destroy").each(function () {
            var options = $.extend({}, opts, $(this).data());
            var spect = spectrum(this, options);
            $(this).data(dataID, spect.id);
        });
    };

    $.fn.spectrum.load = true;
    $.fn.spectrum.loadOpts = {};
    $.fn.spectrum.draggable = draggable;
    $.fn.spectrum.defaults = defaultOpts;
    $.fn.spectrum.inputTypeColorSupport = function inputTypeColorSupport() {
        if (typeof inputTypeColorSupport._cachedResult === "undefined") {
            var colorInput = $("<input type='color'/>")[0]; // if color element is supported, value will default to not null
            inputTypeColorSupport._cachedResult = colorInput.type === "color" && colorInput.value !== "";
        }
        return inputTypeColorSupport._cachedResult;
    };

    $.spectrum = { };
    $.spectrum.localization = { };
    $.spectrum.palettes = { };

    $.fn.spectrum.processNativeColorInputs = function () {
        var colorInputs = $("input[type=color]");
        if (colorInputs.length && !inputTypeColorSupport()) {
            colorInputs.spectrum({
                preferredFormat: "hex6"
            });
        }
    };

    // TinyColor v1.1.2
    // https://github.com/bgrins/TinyColor
    // Brian Grinstead, MIT License

    (function() {

    var trimLeft = /^[\s,#]+/,
        trimRight = /\s+$/,
        tinyCounter = 0,
        math = Math,
        mathRound = math.round,
        mathMin = math.min,
        mathMax = math.max,
        mathRandom = math.random;

    var tinycolor = function(color, opts) {

        color = (color) ? color : '';
        opts = opts || { };

        // If input is already a tinycolor, return itself
        if (color instanceof tinycolor) {
           return color;
        }
        // If we are called as a function, call using new instead
        if (!(this instanceof tinycolor)) {
            return new tinycolor(color, opts);
        }

        var rgb = inputToRGB(color);
        this._originalInput = color,
        this._r = rgb.r,
        this._g = rgb.g,
        this._b = rgb.b,
        this._a = rgb.a,
        this._roundA = mathRound(100*this._a) / 100,
        this._format = opts.format || rgb.format;
        this._gradientType = opts.gradientType;

        // Don't let the range of [0,255] come back in [0,1].
        // Potentially lose a little bit of precision here, but will fix issues where
        // .5 gets interpreted as half of the total, instead of half of 1
        // If it was supposed to be 128, this was already taken care of by `inputToRgb`
        if (this._r < 1) { this._r = mathRound(this._r); }
        if (this._g < 1) { this._g = mathRound(this._g); }
        if (this._b < 1) { this._b = mathRound(this._b); }

        this._ok = rgb.ok;
        this._tc_id = tinyCounter++;
    };

    tinycolor.prototype = {
        isDark: function() {
            return this.getBrightness() < 128;
        },
        isLight: function() {
            return !this.isDark();
        },
        isValid: function() {
            return this._ok;
        },
        getOriginalInput: function() {
          return this._originalInput;
        },
        getFormat: function() {
            return this._format;
        },
        getAlpha: function() {
            return this._a;
        },
        getBrightness: function() {
            var rgb = this.toRgb();
            return (rgb.r * 299 + rgb.g * 587 + rgb.b * 114) / 1000;
        },
        setAlpha: function(value) {
            this._a = boundAlpha(value);
            this._roundA = mathRound(100*this._a) / 100;
            return this;
        },
        toHsv: function() {
            var hsv = rgbToHsv(this._r, this._g, this._b);
            return { h: hsv.h * 360, s: hsv.s, v: hsv.v, a: this._a };
        },
        toHsvString: function() {
            var hsv = rgbToHsv(this._r, this._g, this._b);
            var h = mathRound(hsv.h * 360), s = mathRound(hsv.s * 100), v = mathRound(hsv.v * 100);
            return (this._a == 1) ?
              "hsv("  + h + ", " + s + "%, " + v + "%)" :
              "hsva(" + h + ", " + s + "%, " + v + "%, "+ this._roundA + ")";
        },
        toHsl: function() {
            var hsl = rgbToHsl(this._r, this._g, this._b);
            return { h: hsl.h * 360, s: hsl.s, l: hsl.l, a: this._a };
        },
        toHslString: function() {
            var hsl = rgbToHsl(this._r, this._g, this._b);
            var h = mathRound(hsl.h * 360), s = mathRound(hsl.s * 100), l = mathRound(hsl.l * 100);
            return (this._a == 1) ?
              "hsl("  + h + ", " + s + "%, " + l + "%)" :
              "hsla(" + h + ", " + s + "%, " + l + "%, "+ this._roundA + ")";
        },
        toHex: function(allow3Char) {
            return rgbToHex(this._r, this._g, this._b, allow3Char);
        },
        toHexString: function(allow3Char) {
            return '#' + this.toHex(allow3Char);
        },
        toHex8: function() {
            return rgbaToHex(this._r, this._g, this._b, this._a);
        },
        toHex8String: function() {
            return '#' + this.toHex8();
        },
        toRgb: function() {
            return { r: mathRound(this._r), g: mathRound(this._g), b: mathRound(this._b), a: this._a };
        },
        toRgbString: function() {
            return (this._a == 1) ?
              "rgb("  + mathRound(this._r) + ", " + mathRound(this._g) + ", " + mathRound(this._b) + ")" :
              "rgba(" + mathRound(this._r) + ", " + mathRound(this._g) + ", " + mathRound(this._b) + ", " + this._roundA + ")";
        },
        toPercentageRgb: function() {
            return { r: mathRound(bound01(this._r, 255) * 100) + "%", g: mathRound(bound01(this._g, 255) * 100) + "%", b: mathRound(bound01(this._b, 255) * 100) + "%", a: this._a };
        },
        toPercentageRgbString: function() {
            return (this._a == 1) ?
              "rgb("  + mathRound(bound01(this._r, 255) * 100) + "%, " + mathRound(bound01(this._g, 255) * 100) + "%, " + mathRound(bound01(this._b, 255) * 100) + "%)" :
              "rgba(" + mathRound(bound01(this._r, 255) * 100) + "%, " + mathRound(bound01(this._g, 255) * 100) + "%, " + mathRound(bound01(this._b, 255) * 100) + "%, " + this._roundA + ")";
        },
        toName: function() {
            if (this._a === 0) {
                return "transparent";
            }

            if (this._a < 1) {
                return false;
            }

            return hexNames[rgbToHex(this._r, this._g, this._b, true)] || false;
        },
        toFilter: function(secondColor) {
            var hex8String = '#' + rgbaToHex(this._r, this._g, this._b, this._a);
            var secondHex8String = hex8String;
            var gradientType = this._gradientType ? "GradientType = 1, " : "";

            if (secondColor) {
                var s = tinycolor(secondColor);
                secondHex8String = s.toHex8String();
            }

            return "progid:DXImageTransform.Microsoft.gradient("+gradientType+"startColorstr="+hex8String+",endColorstr="+secondHex8String+")";
        },
        toString: function(format) {
            var formatSet = !!format;
            format = format || this._format;

            var formattedString = false;
            var hasAlpha = this._a < 1 && this._a >= 0;
            var needsAlphaFormat = !formatSet && hasAlpha && (format === "hex" || format === "hex6" || format === "hex3" || format === "name");

            if (needsAlphaFormat) {
                // Special case for "transparent", all other non-alpha formats
                // will return rgba when there is transparency.
                if (format === "name" && this._a === 0) {
                    return this.toName();
                }
                return this.toRgbString();
            }
            if (format === "rgb") {
                formattedString = this.toRgbString();
            }
            if (format === "prgb") {
                formattedString = this.toPercentageRgbString();
            }
            if (format === "hex" || format === "hex6") {
                formattedString = this.toHexString();
            }
            if (format === "hex3") {
                formattedString = this.toHexString(true);
            }
            if (format === "hex8") {
                formattedString = this.toHex8String();
            }
            if (format === "name") {
                formattedString = this.toName();
            }
            if (format === "hsl") {
                formattedString = this.toHslString();
            }
            if (format === "hsv") {
                formattedString = this.toHsvString();
            }

            return formattedString || this.toHexString();
        },

        _applyModification: function(fn, args) {
            var color = fn.apply(null, [this].concat([].slice.call(args)));
            this._r = color._r;
            this._g = color._g;
            this._b = color._b;
            this.setAlpha(color._a);
            return this;
        },
        lighten: function() {
            return this._applyModification(lighten, arguments);
        },
        brighten: function() {
            return this._applyModification(brighten, arguments);
        },
        darken: function() {
            return this._applyModification(darken, arguments);
        },
        desaturate: function() {
            return this._applyModification(desaturate, arguments);
        },
        saturate: function() {
            return this._applyModification(saturate, arguments);
        },
        greyscale: function() {
            return this._applyModification(greyscale, arguments);
        },
        spin: function() {
            return this._applyModification(spin, arguments);
        },

        _applyCombination: function(fn, args) {
            return fn.apply(null, [this].concat([].slice.call(args)));
        },
        analogous: function() {
            return this._applyCombination(analogous, arguments);
        },
        complement: function() {
            return this._applyCombination(complement, arguments);
        },
        monochromatic: function() {
            return this._applyCombination(monochromatic, arguments);
        },
        splitcomplement: function() {
            return this._applyCombination(splitcomplement, arguments);
        },
        triad: function() {
            return this._applyCombination(triad, arguments);
        },
        tetrad: function() {
            return this._applyCombination(tetrad, arguments);
        }
    };

    // If input is an object, force 1 into "1.0" to handle ratios properly
    // String input requires "1.0" as input, so 1 will be treated as 1
    tinycolor.fromRatio = function(color, opts) {
        if (typeof color == "object") {
            var newColor = {};
            for (var i in color) {
                if (color.hasOwnProperty(i)) {
                    if (i === "a") {
                        newColor[i] = color[i];
                    }
                    else {
                        newColor[i] = convertToPercentage(color[i]);
                    }
                }
            }
            color = newColor;
        }

        return tinycolor(color, opts);
    };

    // Given a string or object, convert that input to RGB
    // Possible string inputs:
    //
    //     "red"
    //     "#f00" or "f00"
    //     "#ff0000" or "ff0000"
    //     "#ff000000" or "ff000000"
    //     "rgb 255 0 0" or "rgb (255, 0, 0)"
    //     "rgb 1.0 0 0" or "rgb (1, 0, 0)"
    //     "rgba (255, 0, 0, 1)" or "rgba 255, 0, 0, 1"
    //     "rgba (1.0, 0, 0, 1)" or "rgba 1.0, 0, 0, 1"
    //     "hsl(0, 100%, 50%)" or "hsl 0 100% 50%"
    //     "hsla(0, 100%, 50%, 1)" or "hsla 0 100% 50%, 1"
    //     "hsv(0, 100%, 100%)" or "hsv 0 100% 100%"
    //
    function inputToRGB(color) {

        var rgb = { r: 0, g: 0, b: 0 };
        var a = 1;
        var ok = false;
        var format = false;

        if (typeof color == "string") {
            color = stringInputToObject(color);
        }

        if (typeof color == "object") {
            if (color.hasOwnProperty("r") && color.hasOwnProperty("g") && color.hasOwnProperty("b")) {
                rgb = rgbToRgb(color.r, color.g, color.b);
                ok = true;
                format = String(color.r).substr(-1) === "%" ? "prgb" : "rgb";
            }
            else if (color.hasOwnProperty("h") && color.hasOwnProperty("s") && color.hasOwnProperty("v")) {
                color.s = convertToPercentage(color.s);
                color.v = convertToPercentage(color.v);
                rgb = hsvToRgb(color.h, color.s, color.v);
                ok = true;
                format = "hsv";
            }
            else if (color.hasOwnProperty("h") && color.hasOwnProperty("s") && color.hasOwnProperty("l")) {
                color.s = convertToPercentage(color.s);
                color.l = convertToPercentage(color.l);
                rgb = hslToRgb(color.h, color.s, color.l);
                ok = true;
                format = "hsl";
            }

            if (color.hasOwnProperty("a")) {
                a = color.a;
            }
        }

        a = boundAlpha(a);

        return {
            ok: ok,
            format: color.format || format,
            r: mathMin(255, mathMax(rgb.r, 0)),
            g: mathMin(255, mathMax(rgb.g, 0)),
            b: mathMin(255, mathMax(rgb.b, 0)),
            a: a
        };
    }


    // Conversion Functions
    // --------------------

    // `rgbToHsl`, `rgbToHsv`, `hslToRgb`, `hsvToRgb` modified from:
    // <http://mjijackson.com/2008/02/rgb-to-hsl-and-rgb-to-hsv-color-model-conversion-algorithms-in-javascript>

    // `rgbToRgb`
    // Handle bounds / percentage checking to conform to CSS color spec
    // <http://www.w3.org/TR/css3-color/>
    // *Assumes:* r, g, b in [0, 255] or [0, 1]
    // *Returns:* { r, g, b } in [0, 255]
    function rgbToRgb(r, g, b){
        return {
            r: bound01(r, 255) * 255,
            g: bound01(g, 255) * 255,
            b: bound01(b, 255) * 255
        };
    }

    // `rgbToHsl`
    // Converts an RGB color value to HSL.
    // *Assumes:* r, g, and b are contained in [0, 255] or [0, 1]
    // *Returns:* { h, s, l } in [0,1]
    function rgbToHsl(r, g, b) {

        r = bound01(r, 255);
        g = bound01(g, 255);
        b = bound01(b, 255);

        var max = mathMax(r, g, b), min = mathMin(r, g, b);
        var h, s, l = (max + min) / 2;

        if(max == min) {
            h = s = 0; // achromatic
        }
        else {
            var d = max - min;
            s = l > 0.5 ? d / (2 - max - min) : d / (max + min);
            switch(max) {
                case r: h = (g - b) / d + (g < b ? 6 : 0); break;
                case g: h = (b - r) / d + 2; break;
                case b: h = (r - g) / d + 4; break;
            }

            h /= 6;
        }

        return { h: h, s: s, l: l };
    }

    // `hslToRgb`
    // Converts an HSL color value to RGB.
    // *Assumes:* h is contained in [0, 1] or [0, 360] and s and l are contained [0, 1] or [0, 100]
    // *Returns:* { r, g, b } in the set [0, 255]
    function hslToRgb(h, s, l) {
        var r, g, b;

        h = bound01(h, 360);
        s = bound01(s, 100);
        l = bound01(l, 100);

        function hue2rgb(p, q, t) {
            if(t < 0) t += 1;
            if(t > 1) t -= 1;
            if(t < 1/6) return p + (q - p) * 6 * t;
            if(t < 1/2) return q;
            if(t < 2/3) return p + (q - p) * (2/3 - t) * 6;
            return p;
        }

        if(s === 0) {
            r = g = b = l; // achromatic
        }
        else {
            var q = l < 0.5 ? l * (1 + s) : l + s - l * s;
            var p = 2 * l - q;
            r = hue2rgb(p, q, h + 1/3);
            g = hue2rgb(p, q, h);
            b = hue2rgb(p, q, h - 1/3);
        }

        return { r: r * 255, g: g * 255, b: b * 255 };
    }

    // `rgbToHsv`
    // Converts an RGB color value to HSV
    // *Assumes:* r, g, and b are contained in the set [0, 255] or [0, 1]
    // *Returns:* { h, s, v } in [0,1]
    function rgbToHsv(r, g, b) {

        r = bound01(r, 255);
        g = bound01(g, 255);
        b = bound01(b, 255);

        var max = mathMax(r, g, b), min = mathMin(r, g, b);
        var h, s, v = max;

        var d = max - min;
        s = max === 0 ? 0 : d / max;

        if(max == min) {
            h = 0; // achromatic
        }
        else {
            switch(max) {
                case r: h = (g - b) / d + (g < b ? 6 : 0); break;
                case g: h = (b - r) / d + 2; break;
                case b: h = (r - g) / d + 4; break;
            }
            h /= 6;
        }
        return { h: h, s: s, v: v };
    }

    // `hsvToRgb`
    // Converts an HSV color value to RGB.
    // *Assumes:* h is contained in [0, 1] or [0, 360] and s and v are contained in [0, 1] or [0, 100]
    // *Returns:* { r, g, b } in the set [0, 255]
     function hsvToRgb(h, s, v) {

        h = bound01(h, 360) * 6;
        s = bound01(s, 100);
        v = bound01(v, 100);

        var i = math.floor(h),
            f = h - i,
            p = v * (1 - s),
            q = v * (1 - f * s),
            t = v * (1 - (1 - f) * s),
            mod = i % 6,
            r = [v, q, p, p, t, v][mod],
            g = [t, v, v, q, p, p][mod],
            b = [p, p, t, v, v, q][mod];

        return { r: r * 255, g: g * 255, b: b * 255 };
    }

    // `rgbToHex`
    // Converts an RGB color to hex
    // Assumes r, g, and b are contained in the set [0, 255]
    // Returns a 3 or 6 character hex
    function rgbToHex(r, g, b, allow3Char) {

        var hex = [
            pad2(mathRound(r).toString(16)),
            pad2(mathRound(g).toString(16)),
            pad2(mathRound(b).toString(16))
        ];

        // Return a 3 character hex if possible
        if (allow3Char && hex[0].charAt(0) == hex[0].charAt(1) && hex[1].charAt(0) == hex[1].charAt(1) && hex[2].charAt(0) == hex[2].charAt(1)) {
            return hex[0].charAt(0) + hex[1].charAt(0) + hex[2].charAt(0);
        }

        return hex.join("");
    }
        // `rgbaToHex`
        // Converts an RGBA color plus alpha transparency to hex
        // Assumes r, g, b and a are contained in the set [0, 255]
        // Returns an 8 character hex
        function rgbaToHex(r, g, b, a) {

            var hex = [
                pad2(convertDecimalToHex(a)),
                pad2(mathRound(r).toString(16)),
                pad2(mathRound(g).toString(16)),
                pad2(mathRound(b).toString(16))
            ];

            return hex.join("");
        }

    // `equals`
    // Can be called with any tinycolor input
    tinycolor.equals = function (color1, color2) {
        if (!color1 || !color2) { return false; }
        return tinycolor(color1).toRgbString() == tinycolor(color2).toRgbString();
    };
    tinycolor.random = function() {
        return tinycolor.fromRatio({
            r: mathRandom(),
            g: mathRandom(),
            b: mathRandom()
        });
    };


    // Modification Functions
    // ----------------------
    // Thanks to less.js for some of the basics here
    // <https://github.com/cloudhead/less.js/blob/master/lib/less/functions.js>

    function desaturate(color, amount) {
        amount = (amount === 0) ? 0 : (amount || 10);
        var hsl = tinycolor(color).toHsl();
        hsl.s -= amount / 100;
        hsl.s = clamp01(hsl.s);
        return tinycolor(hsl);
    }

    function saturate(color, amount) {
        amount = (amount === 0) ? 0 : (amount || 10);
        var hsl = tinycolor(color).toHsl();
        hsl.s += amount / 100;
        hsl.s = clamp01(hsl.s);
        return tinycolor(hsl);
    }

    function greyscale(color) {
        return tinycolor(color).desaturate(100);
    }

    function lighten (color, amount) {
        amount = (amount === 0) ? 0 : (amount || 10);
        var hsl = tinycolor(color).toHsl();
        hsl.l += amount / 100;
        hsl.l = clamp01(hsl.l);
        return tinycolor(hsl);
    }

    function brighten(color, amount) {
        amount = (amount === 0) ? 0 : (amount || 10);
        var rgb = tinycolor(color).toRgb();
        rgb.r = mathMax(0, mathMin(255, rgb.r - mathRound(255 * - (amount / 100))));
        rgb.g = mathMax(0, mathMin(255, rgb.g - mathRound(255 * - (amount / 100))));
        rgb.b = mathMax(0, mathMin(255, rgb.b - mathRound(255 * - (amount / 100))));
        return tinycolor(rgb);
    }

    function darken (color, amount) {
        amount = (amount === 0) ? 0 : (amount || 10);
        var hsl = tinycolor(color).toHsl();
        hsl.l -= amount / 100;
        hsl.l = clamp01(hsl.l);
        return tinycolor(hsl);
    }

    // Spin takes a positive or negative amount within [-360, 360] indicating the change of hue.
    // Values outside of this range will be wrapped into this range.
    function spin(color, amount) {
        var hsl = tinycolor(color).toHsl();
        var hue = (mathRound(hsl.h) + amount) % 360;
        hsl.h = hue < 0 ? 360 + hue : hue;
        return tinycolor(hsl);
    }

    // Combination Functions
    // ---------------------
    // Thanks to jQuery xColor for some of the ideas behind these
    // <https://github.com/infusion/jQuery-xcolor/blob/master/jquery.xcolor.js>

    function complement(color) {
        var hsl = tinycolor(color).toHsl();
        hsl.h = (hsl.h + 180) % 360;
        return tinycolor(hsl);
    }

    function triad(color) {
        var hsl = tinycolor(color).toHsl();
        var h = hsl.h;
        return [
            tinycolor(color),
            tinycolor({ h: (h + 120) % 360, s: hsl.s, l: hsl.l }),
            tinycolor({ h: (h + 240) % 360, s: hsl.s, l: hsl.l })
        ];
    }

    function tetrad(color) {
        var hsl = tinycolor(color).toHsl();
        var h = hsl.h;
        return [
            tinycolor(color),
            tinycolor({ h: (h + 90) % 360, s: hsl.s, l: hsl.l }),
            tinycolor({ h: (h + 180) % 360, s: hsl.s, l: hsl.l }),
            tinycolor({ h: (h + 270) % 360, s: hsl.s, l: hsl.l })
        ];
    }

    function splitcomplement(color) {
        var hsl = tinycolor(color).toHsl();
        var h = hsl.h;
        return [
            tinycolor(color),
            tinycolor({ h: (h + 72) % 360, s: hsl.s, l: hsl.l}),
            tinycolor({ h: (h + 216) % 360, s: hsl.s, l: hsl.l})
        ];
    }

    function analogous(color, results, slices) {
        results = results || 6;
        slices = slices || 30;

        var hsl = tinycolor(color).toHsl();
        var part = 360 / slices;
        var ret = [tinycolor(color)];

        for (hsl.h = ((hsl.h - (part * results >> 1)) + 720) % 360; --results; ) {
            hsl.h = (hsl.h + part) % 360;
            ret.push(tinycolor(hsl));
        }
        return ret;
    }

    function monochromatic(color, results) {
        results = results || 6;
        var hsv = tinycolor(color).toHsv();
        var h = hsv.h, s = hsv.s, v = hsv.v;
        var ret = [];
        var modification = 1 / results;

        while (results--) {
            ret.push(tinycolor({ h: h, s: s, v: v}));
            v = (v + modification) % 1;
        }

        return ret;
    }

    // Utility Functions
    // ---------------------

    tinycolor.mix = function(color1, color2, amount) {
        amount = (amount === 0) ? 0 : (amount || 50);

        var rgb1 = tinycolor(color1).toRgb();
        var rgb2 = tinycolor(color2).toRgb();

        var p = amount / 100;
        var w = p * 2 - 1;
        var a = rgb2.a - rgb1.a;

        var w1;

        if (w * a == -1) {
            w1 = w;
        } else {
            w1 = (w + a) / (1 + w * a);
        }

        w1 = (w1 + 1) / 2;

        var w2 = 1 - w1;

        var rgba = {
            r: rgb2.r * w1 + rgb1.r * w2,
            g: rgb2.g * w1 + rgb1.g * w2,
            b: rgb2.b * w1 + rgb1.b * w2,
            a: rgb2.a * p  + rgb1.a * (1 - p)
        };

        return tinycolor(rgba);
    };


    // Readability Functions
    // ---------------------
    // <http://www.w3.org/TR/AERT#color-contrast>

    // `readability`
    // Analyze the 2 colors and returns an object with the following properties:
    //    `brightness`: difference in brightness between the two colors
    //    `color`: difference in color/hue between the two colors
    tinycolor.readability = function(color1, color2) {
        var c1 = tinycolor(color1);
        var c2 = tinycolor(color2);
        var rgb1 = c1.toRgb();
        var rgb2 = c2.toRgb();
        var brightnessA = c1.getBrightness();
        var brightnessB = c2.getBrightness();
        var colorDiff = (
            Math.max(rgb1.r, rgb2.r) - Math.min(rgb1.r, rgb2.r) +
            Math.max(rgb1.g, rgb2.g) - Math.min(rgb1.g, rgb2.g) +
            Math.max(rgb1.b, rgb2.b) - Math.min(rgb1.b, rgb2.b)
        );

        return {
            brightness: Math.abs(brightnessA - brightnessB),
            color: colorDiff
        };
    };

    // `readable`
    // http://www.w3.org/TR/AERT#color-contrast
    // Ensure that foreground and background color combinations provide sufficient contrast.
    // *Example*
    //    tinycolor.isReadable("#000", "#111") => false
    tinycolor.isReadable = function(color1, color2) {
        var readability = tinycolor.readability(color1, color2);
        return readability.brightness > 125 && readability.color > 500;
    };

    // `mostReadable`
    // Given a base color and a list of possible foreground or background
    // colors for that base, returns the most readable color.
    // *Example*
    //    tinycolor.mostReadable("#123", ["#fff", "#000"]) => "#000"
    tinycolor.mostReadable = function(baseColor, colorList) {
        var bestColor = null;
        var bestScore = 0;
        var bestIsReadable = false;
        for (var i=0; i < colorList.length; i++) {

            // We normalize both around the "acceptable" breaking point,
            // but rank brightness constrast higher than hue.

            var readability = tinycolor.readability(baseColor, colorList[i]);
            var readable = readability.brightness > 125 && readability.color > 500;
            var score = 3 * (readability.brightness / 125) + (readability.color / 500);

            if ((readable && ! bestIsReadable) ||
                (readable && bestIsReadable && score > bestScore) ||
                ((! readable) && (! bestIsReadable) && score > bestScore)) {
                bestIsReadable = readable;
                bestScore = score;
                bestColor = tinycolor(colorList[i]);
            }
        }
        return bestColor;
    };


    // Big List of Colors
    // ------------------
    // <http://www.w3.org/TR/css3-color/#svg-color>
    var names = tinycolor.names = {
        aliceblue: "f0f8ff",
        antiquewhite: "faebd7",
        aqua: "0ff",
        aquamarine: "7fffd4",
        azure: "f0ffff",
        beige: "f5f5dc",
        bisque: "ffe4c4",
        black: "000",
        blanchedalmond: "ffebcd",
        blue: "00f",
        blueviolet: "8a2be2",
        brown: "a52a2a",
        burlywood: "deb887",
        burntsienna: "ea7e5d",
        cadetblue: "5f9ea0",
        chartreuse: "7fff00",
        chocolate: "d2691e",
        coral: "ff7f50",
        cornflowerblue: "6495ed",
        cornsilk: "fff8dc",
        crimson: "dc143c",
        cyan: "0ff",
        darkblue: "00008b",
        darkcyan: "008b8b",
        darkgoldenrod: "b8860b",
        darkgray: "a9a9a9",
        darkgreen: "006400",
        darkgrey: "a9a9a9",
        darkkhaki: "bdb76b",
        darkmagenta: "8b008b",
        darkolivegreen: "556b2f",
        darkorange: "ff8c00",
        darkorchid: "9932cc",
        darkred: "8b0000",
        darksalmon: "e9967a",
        darkseagreen: "8fbc8f",
        darkslateblue: "483d8b",
        darkslategray: "2f4f4f",
        darkslategrey: "2f4f4f",
        darkturquoise: "00ced1",
        darkviolet: "9400d3",
        deeppink: "ff1493",
        deepskyblue: "00bfff",
        dimgray: "696969",
        dimgrey: "696969",
        dodgerblue: "1e90ff",
        firebrick: "b22222",
        floralwhite: "fffaf0",
        forestgreen: "228b22",
        fuchsia: "f0f",
        gainsboro: "dcdcdc",
        ghostwhite: "f8f8ff",
        gold: "ffd700",
        goldenrod: "daa520",
        gray: "808080",
        green: "008000",
        greenyellow: "adff2f",
        grey: "808080",
        honeydew: "f0fff0",
        hotpink: "ff69b4",
        indianred: "cd5c5c",
        indigo: "4b0082",
        ivory: "fffff0",
        khaki: "f0e68c",
        lavender: "e6e6fa",
        lavenderblush: "fff0f5",
        lawngreen: "7cfc00",
        lemonchiffon: "fffacd",
        lightblue: "add8e6",
        lightcoral: "f08080",
        lightcyan: "e0ffff",
        lightgoldenrodyellow: "fafad2",
        lightgray: "d3d3d3",
        lightgreen: "90ee90",
        lightgrey: "d3d3d3",
        lightpink: "ffb6c1",
        lightsalmon: "ffa07a",
        lightseagreen: "20b2aa",
        lightskyblue: "87cefa",
        lightslategray: "789",
        lightslategrey: "789",
        lightsteelblue: "b0c4de",
        lightyellow: "ffffe0",
        lime: "0f0",
        limegreen: "32cd32",
        linen: "faf0e6",
        magenta: "f0f",
        maroon: "800000",
        mediumaquamarine: "66cdaa",
        mediumblue: "0000cd",
        mediumorchid: "ba55d3",
        mediumpurple: "9370db",
        mediumseagreen: "3cb371",
        mediumslateblue: "7b68ee",
        mediumspringgreen: "00fa9a",
        mediumturquoise: "48d1cc",
        mediumvioletred: "c71585",
        midnightblue: "191970",
        mintcream: "f5fffa",
        mistyrose: "ffe4e1",
        moccasin: "ffe4b5",
        navajowhite: "ffdead",
        navy: "000080",
        oldlace: "fdf5e6",
        olive: "808000",
        olivedrab: "6b8e23",
        orange: "ffa500",
        orangered: "ff4500",
        orchid: "da70d6",
        palegoldenrod: "eee8aa",
        palegreen: "98fb98",
        paleturquoise: "afeeee",
        palevioletred: "db7093",
        papayawhip: "ffefd5",
        peachpuff: "ffdab9",
        peru: "cd853f",
        pink: "ffc0cb",
        plum: "dda0dd",
        powderblue: "b0e0e6",
        purple: "800080",
        rebeccapurple: "663399",
        red: "f00",
        rosybrown: "bc8f8f",
        royalblue: "4169e1",
        saddlebrown: "8b4513",
        salmon: "fa8072",
        sandybrown: "f4a460",
        seagreen: "2e8b57",
        seashell: "fff5ee",
        sienna: "a0522d",
        silver: "c0c0c0",
        skyblue: "87ceeb",
        slateblue: "6a5acd",
        slategray: "708090",
        slategrey: "708090",
        snow: "fffafa",
        springgreen: "00ff7f",
        steelblue: "4682b4",
        tan: "d2b48c",
        teal: "008080",
        thistle: "d8bfd8",
        tomato: "ff6347",
        turquoise: "40e0d0",
        violet: "ee82ee",
        wheat: "f5deb3",
        white: "fff",
        whitesmoke: "f5f5f5",
        yellow: "ff0",
        yellowgreen: "9acd32"
    };

    // Make it easy to access colors via `hexNames[hex]`
    var hexNames = tinycolor.hexNames = flip(names);


    // Utilities
    // ---------

    // `{ 'name1': 'val1' }` becomes `{ 'val1': 'name1' }`
    function flip(o) {
        var flipped = { };
        for (var i in o) {
            if (o.hasOwnProperty(i)) {
                flipped[o[i]] = i;
            }
        }
        return flipped;
    }

    // Return a valid alpha value [0,1] with all invalid values being set to 1
    function boundAlpha(a) {
        a = parseFloat(a);

        if (isNaN(a) || a < 0 || a > 1) {
            a = 1;
        }

        return a;
    }

    // Take input from [0, n] and return it as [0, 1]
    function bound01(n, max) {
        if (isOnePointZero(n)) { n = "100%"; }

        var processPercent = isPercentage(n);
        n = mathMin(max, mathMax(0, parseFloat(n)));

        // Automatically convert percentage into number
        if (processPercent) {
            n = parseInt(n * max, 10) / 100;
        }

        // Handle floating point rounding errors
        if ((math.abs(n - max) < 0.000001)) {
            return 1;
        }

        // Convert into [0, 1] range if it isn't already
        return (n % max) / parseFloat(max);
    }

    // Force a number between 0 and 1
    function clamp01(val) {
        return mathMin(1, mathMax(0, val));
    }

    // Parse a base-16 hex value into a base-10 integer
    function parseIntFromHex(val) {
        return parseInt(val, 16);
    }

    // Need to handle 1.0 as 100%, since once it is a number, there is no difference between it and 1
    // <http://stackoverflow.com/questions/7422072/javascript-how-to-detect-number-as-a-decimal-including-1-0>
    function isOnePointZero(n) {
        return typeof n == "string" && n.indexOf('.') != -1 && parseFloat(n) === 1;
    }

    // Check to see if string passed in is a percentage
    function isPercentage(n) {
        return typeof n === "string" && n.indexOf('%') != -1;
    }

    // Force a hex value to have 2 characters
    function pad2(c) {
        return c.length == 1 ? '0' + c : '' + c;
    }

    // Replace a decimal with it's percentage value
    function convertToPercentage(n) {
        if (n <= 1) {
            n = (n * 100) + "%";
        }

        return n;
    }

    // Converts a decimal to a hex value
    function convertDecimalToHex(d) {
        return Math.round(parseFloat(d) * 255).toString(16);
    }
    // Converts a hex value to a decimal
    function convertHexToDecimal(h) {
        return (parseIntFromHex(h) / 255);
    }

    var matchers = (function() {

        // <http://www.w3.org/TR/css3-values/#integers>
        var CSS_INTEGER = "[-\\+]?\\d+%?";

        // <http://www.w3.org/TR/css3-values/#number-value>
        var CSS_NUMBER = "[-\\+]?\\d*\\.\\d+%?";

        // Allow positive/negative integer/number.  Don't capture the either/or, just the entire outcome.
        var CSS_UNIT = "(?:" + CSS_NUMBER + ")|(?:" + CSS_INTEGER + ")";

        // Actual matching.
        // Parentheses and commas are optional, but not required.
        // Whitespace can take the place of commas or opening paren
        var PERMISSIVE_MATCH3 = "[\\s|\\(]+(" + CSS_UNIT + ")[,|\\s]+(" + CSS_UNIT + ")[,|\\s]+(" + CSS_UNIT + ")\\s*\\)?";
        var PERMISSIVE_MATCH4 = "[\\s|\\(]+(" + CSS_UNIT + ")[,|\\s]+(" + CSS_UNIT + ")[,|\\s]+(" + CSS_UNIT + ")[,|\\s]+(" + CSS_UNIT + ")\\s*\\)?";

        return {
            rgb: new RegExp("rgb" + PERMISSIVE_MATCH3),
            rgba: new RegExp("rgba" + PERMISSIVE_MATCH4),
            hsl: new RegExp("hsl" + PERMISSIVE_MATCH3),
            hsla: new RegExp("hsla" + PERMISSIVE_MATCH4),
            hsv: new RegExp("hsv" + PERMISSIVE_MATCH3),
            hsva: new RegExp("hsva" + PERMISSIVE_MATCH4),
            hex3: /^([0-9a-fA-F]{1})([0-9a-fA-F]{1})([0-9a-fA-F]{1})$/,
            hex6: /^([0-9a-fA-F]{2})([0-9a-fA-F]{2})([0-9a-fA-F]{2})$/,
            hex8: /^([0-9a-fA-F]{2})([0-9a-fA-F]{2})([0-9a-fA-F]{2})([0-9a-fA-F]{2})$/
        };
    })();

    // `stringInputToObject`
    // Permissive string parsing.  Take in a number of formats, and output an object
    // based on detected format.  Returns `{ r, g, b }` or `{ h, s, l }` or `{ h, s, v}`
    function stringInputToObject(color) {

        color = color.replace(trimLeft,'').replace(trimRight, '').toLowerCase();
        var named = false;
        if (names[color]) {
            color = names[color];
            named = true;
        }
        else if (color == 'transparent') {
            return { r: 0, g: 0, b: 0, a: 0, format: "name" };
        }

        // Try to match string input using regular expressions.
        // Keep most of the number bounding out of this function - don't worry about [0,1] or [0,100] or [0,360]
        // Just return an object and let the conversion functions handle that.
        // This way the result will be the same whether the tinycolor is initialized with string or object.
        var match;
        if ((match = matchers.rgb.exec(color))) {
            return { r: match[1], g: match[2], b: match[3] };
        }
        if ((match = matchers.rgba.exec(color))) {
            return { r: match[1], g: match[2], b: match[3], a: match[4] };
        }
        if ((match = matchers.hsl.exec(color))) {
            return { h: match[1], s: match[2], l: match[3] };
        }
        if ((match = matchers.hsla.exec(color))) {
            return { h: match[1], s: match[2], l: match[3], a: match[4] };
        }
        if ((match = matchers.hsv.exec(color))) {
            return { h: match[1], s: match[2], v: match[3] };
        }
        if ((match = matchers.hsva.exec(color))) {
            return { h: match[1], s: match[2], v: match[3], a: match[4] };
        }
        if ((match = matchers.hex8.exec(color))) {
            return {
                a: convertHexToDecimal(match[1]),
                r: parseIntFromHex(match[2]),
                g: parseIntFromHex(match[3]),
                b: parseIntFromHex(match[4]),
                format: named ? "name" : "hex8"
            };
        }
        if ((match = matchers.hex6.exec(color))) {
            return {
                r: parseIntFromHex(match[1]),
                g: parseIntFromHex(match[2]),
                b: parseIntFromHex(match[3]),
                format: named ? "name" : "hex"
            };
        }
        if ((match = matchers.hex3.exec(color))) {
            return {
                r: parseIntFromHex(match[1] + '' + match[1]),
                g: parseIntFromHex(match[2] + '' + match[2]),
                b: parseIntFromHex(match[3] + '' + match[3]),
                format: named ? "name" : "hex"
            };
        }

        return false;
    }

    window.tinycolor = tinycolor;
    })();

    $(function () {
        if ($.fn.spectrum.load) {
            $.fn.spectrum.processNativeColorInputs();
        }
    });

});
/*
 * flowplayer.js 3.2.10. The Flowplayer API
 *
 * Copyright 2009-2011 Flowplayer Oy
 *
 * This file is part of Flowplayer.
 *
 * Flowplayer is free software: you can redistribute it and/or modify
 * it under the terms of the GNU General Public License as published by
 * the Free Software Foundation, either version 3 of the License, or
 * (at your option) any later version.
 *
 * Flowplayer is distributed in the hope that it will be useful,
 * but WITHOUT ANY WARRANTY; without even the implied warranty of
 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
 * GNU General Public License for more details.
 *
 * You should have received a copy of the GNU General Public License
 * along with Flowplayer.  If not, see <http://www.gnu.org/licenses/>.
 *
 * Date: 2012-05-08 11:13:41 +0300 (Tue, 08 May 2012)
 * Revision: 794
 */
(function(){function g(o){console.log("$f.fireEvent",[].slice.call(o))}function k(q){if(!q||typeof q!="object"){return q}var o=new q.constructor();for(var p in q){if(q.hasOwnProperty(p)){o[p]=k(q[p])}}return o}function m(t,q){if(!t){return}var o,p=0,r=t.length;if(r===undefined){for(o in t){if(q.call(t[o],o,t[o])===false){break}}}else{for(var s=t[0];p<r&&q.call(s,p,s)!==false;s=t[++p]){}}return t}function c(o){return document.getElementById(o)}function i(q,p,o){if(typeof p!="object"){return q}if(q&&p){m(p,function(r,s){if(!o||typeof s!="function"){q[r]=s}})}return q}function n(s){var q=s.indexOf(".");if(q!=-1){var p=s.slice(0,q)||"*";var o=s.slice(q+1,s.length);var r=[];m(document.getElementsByTagName(p),function(){if(this.className&&this.className.indexOf(o)!=-1){r.push(this)}});return r}}function f(o){o=o||window.event;if(o.preventDefault){o.stopPropagation();o.preventDefault()}else{o.returnValue=false;o.cancelBubble=true}return false}function j(q,o,p){q[o]=q[o]||[];q[o].push(p)}function e(){return"_"+(""+Math.random()).slice(2,10)}var h=function(t,r,s){var q=this,p={},u={};q.index=r;if(typeof t=="string"){t={url:t}}i(this,t,true);m(("Begin*,Start,Pause*,Resume*,Seek*,Stop*,Finish*,LastSecond,Update,BufferFull,BufferEmpty,BufferStop").split(","),function(){var v="on"+this;if(v.indexOf("*")!=-1){v=v.slice(0,v.length-1);var w="onBefore"+v.slice(2);q[w]=function(x){j(u,w,x);return q}}q[v]=function(x){j(u,v,x);return q};if(r==-1){if(q[w]){s[w]=q[w]}if(q[v]){s[v]=q[v]}}});i(this,{onCuepoint:function(x,w){if(arguments.length==1){p.embedded=[null,x];return q}if(typeof x=="number"){x=[x]}var v=e();p[v]=[x,w];if(s.isLoaded()){s._api().fp_addCuepoints(x,r,v)}return q},update:function(w){i(q,w);if(s.isLoaded()){s._api().fp_updateClip(w,r)}var v=s.getConfig();var x=(r==-1)?v.clip:v.playlist[r];i(x,w,true)},_fireEvent:function(v,y,w,A){if(v=="onLoad"){m(p,function(B,C){if(C[0]){s._api().fp_addCuepoints(C[0],r,B)}});return false}A=A||q;if(v=="onCuepoint"){var z=p[y];if(z){return z[1].call(s,A,w)}}if(y&&"onBeforeBegin,onMetaData,onStart,onUpdate,onResume".indexOf(v)!=-1){i(A,y);if(y.metaData){if(!A.duration){A.duration=y.metaData.duration}else{A.fullDuration=y.metaData.duration}}}var x=true;m(u[v],function(){x=this.call(s,A,y,w)});return x}});if(t.onCuepoint){var o=t.onCuepoint;q.onCuepoint.apply(q,typeof o=="function"?[o]:o);delete t.onCuepoint}m(t,function(v,w){if(typeof w=="function"){j(u,v,w);delete t[v]}});if(r==-1){s.onCuepoint=this.onCuepoint}};var l=function(p,r,q,t){var o=this,s={},u=false;if(t){i(s,t)}m(r,function(v,w){if(typeof w=="function"){s[v]=w;delete r[v]}});i(this,{animate:function(y,z,x){if(!y){return o}if(typeof z=="function"){x=z;z=500}if(typeof y=="string"){var w=y;y={};y[w]=z;z=500}if(x){var v=e();s[v]=x}if(z===undefined){z=500}r=q._api().fp_animate(p,y,z,v);return o},css:function(w,x){if(x!==undefined){var v={};v[w]=x;w=v}r=q._api().fp_css(p,w);i(o,r);return o},show:function(){this.display="block";q._api().fp_showPlugin(p);return o},hide:function(){this.display="none";q._api().fp_hidePlugin(p);return o},toggle:function(){this.display=q._api().fp_togglePlugin(p);return o},fadeTo:function(y,x,w){if(typeof x=="function"){w=x;x=500}if(w){var v=e();s[v]=w}this.display=q._api().fp_fadeTo(p,y,x,v);this.opacity=y;return o},fadeIn:function(w,v){return o.fadeTo(1,w,v)},fadeOut:function(w,v){return o.fadeTo(0,w,v)},getName:function(){return p},getPlayer:function(){return q},_fireEvent:function(w,v,x){if(w=="onUpdate"){var z=q._api().fp_getPlugin(p);if(!z){return}i(o,z);delete o.methods;if(!u){m(z.methods,function(){var B=""+this;o[B]=function(){var C=[].slice.call(arguments);var D=q._api().fp_invoke(p,B,C);return D==="undefined"||D===undefined?o:D}});u=true}}var A=s[w];if(A){var y=A.apply(o,v);if(w.slice(0,1)=="_"){delete s[w]}return y}return o}})};function b(q,G,t){var w=this,v=null,D=false,u,s,F=[],y={},x={},E,r,p,C,o,A;i(w,{id:function(){return E},isLoaded:function(){return(v!==null&&v.fp_play!==undefined&&!D)},getParent:function(){return q},hide:function(H){if(H){q.style.height="0px"}if(w.isLoaded()){v.style.height="0px"}return w},show:function(){q.style.height=A+"px";if(w.isLoaded()){v.style.height=o+"px"}return w},isHidden:function(){return w.isLoaded()&&parseInt(v.style.height,10)===0},load:function(J){if(!w.isLoaded()&&w._fireEvent("onBeforeLoad")!==false){var H=function(){if(u&&!flashembed.isSupported(G.version)){q.innerHTML=""}if(J){J.cached=true;j(x,"onLoad",J)}flashembed(q,G,{config:t})};var I=0;m(a,function(){this.unload(function(K){if(++I==a.length){H()}})})}return w},unload:function(J){if(u.replace(/\s/g,"")!==""){if(w._fireEvent("onBeforeUnload")===false){if(J){J(false)}return w}D=true;try{if(v){v.fp_close();w._fireEvent("onUnload")}}catch(H){}var I=function(){v=null;q.innerHTML=u;D=false;if(J){J(true)}};if(/WebKit/i.test(navigator.userAgent)&&!/Chrome/i.test(navigator.userAgent)){setTimeout(I,0)}else{I()}}else{if(J){J(false)}}return w},getClip:function(H){if(H===undefined){H=C}return F[H]},getCommonClip:function(){return s},getPlaylist:function(){return F},getPlugin:function(H){var J=y[H];if(!J&&w.isLoaded()){var I=w._api().fp_getPlugin(H);if(I){J=new l(H,I,w);y[H]=J}}return J},getScreen:function(){return w.getPlugin("screen")},getControls:function(){return w.getPlugin("controls")._fireEvent("onUpdate")},getLogo:function(){try{return w.getPlugin("logo")._fireEvent("onUpdate")}catch(H){}},getPlay:function(){return w.getPlugin("play")._fireEvent("onUpdate")},getConfig:function(H){return H?k(t):t},getFlashParams:function(){return G},loadPlugin:function(K,J,M,L){if(typeof M=="function"){L=M;M={}}var I=L?e():"_";w._api().fp_loadPlugin(K,J,M,I);var H={};H[I]=L;var N=new l(K,null,w,H);y[K]=N;return N},getState:function(){return w.isLoaded()?v.fp_getState():-1},play:function(I,H){var J=function(){if(I!==undefined){w._api().fp_play(I,H)}else{w._api().fp_play()}};if(w.isLoaded()){J()}else{if(D){setTimeout(function(){w.play(I,H)},50)}else{w.load(function(){J()})}}return w},getVersion:function(){var I="flowplayer.js 3.2.10";if(w.isLoaded()){var H=v.fp_getVersion();H.push(I);return H}return I},_api:function(){if(!w.isLoaded()){throw"Flowplayer "+w.id()+" not loaded when calling an API method"}return v},setClip:function(H){m(H,function(I,J){if(typeof J=="function"){j(x,I,J);delete H[I]}else{if(I=="onCuepoint"){$f(q).getCommonClip().onCuepoint(H[I][0],H[I][1])}}});w.setPlaylist([H]);return w},getIndex:function(){return p},bufferAnimate:function(H){v.fp_bufferAnimate(H===undefined||H);return w},_swfHeight:function(){return v.clientHeight}});m(("Click*,Load*,Unload*,Keypress*,Volume*,Mute*,Unmute*,PlaylistReplace,ClipAdd,Fullscreen*,FullscreenExit,Error,MouseOver,MouseOut").split(","),function(){var H="on"+this;if(H.indexOf("*")!=-1){H=H.slice(0,H.length-1);var I="onBefore"+H.slice(2);w[I]=function(J){j(x,I,J);return w}}w[H]=function(J){j(x,H,J);return w}});m(("pause,resume,mute,unmute,stop,toggle,seek,getStatus,getVolume,setVolume,getTime,isPaused,isPlaying,startBuffering,stopBuffering,isFullscreen,toggleFullscreen,reset,close,setPlaylist,addClip,playFeed,setKeyboardShortcutsEnabled,isKeyboardShortcutsEnabled").split(","),function(){var H=this;w[H]=function(J,I){if(!w.isLoaded()){return w}var K=null;if(J!==undefined&&I!==undefined){K=v["fp_"+H](J,I)}else{K=(J===undefined)?v["fp_"+H]():v["fp_"+H](J)}return K==="undefined"||K===undefined?w:K}});w._fireEvent=function(Q){if(typeof Q=="string"){Q=[Q]}var R=Q[0],O=Q[1],M=Q[2],L=Q[3],K=0;if(t.debug){g(Q)}if(!w.isLoaded()&&R=="onLoad"&&O=="player"){v=v||c(r);o=w._swfHeight();m(F,function(){this._fireEvent("onLoad")});m(y,function(S,T){T._fireEvent("onUpdate")});s._fireEvent("onLoad")}if(R=="onLoad"&&O!="player"){return}if(R=="onError"){if(typeof O=="string"||(typeof O=="number"&&typeof M=="number")){O=M;M=L}}if(R=="onContextMenu"){m(t.contextMenu[O],function(S,T){T.call(w)});return}if(R=="onPluginEvent"||R=="onBeforePluginEvent"){var H=O.name||O;var I=y[H];if(I){I._fireEvent("onUpdate",O);return I._fireEvent(M,Q.slice(3))}return}if(R=="onPlaylistReplace"){F=[];var N=0;m(O,function(){F.push(new h(this,N++,w))})}if(R=="onClipAdd"){if(O.isInStream){return}O=new h(O,M,w);F.splice(M,0,O);for(K=M+1;K<F.length;K++){F[K].index++}}var P=true;if(typeof O=="number"&&O<F.length){C=O;var J=F[O];if(J){P=J._fireEvent(R,M,L)}if(!J||P!==false){P=s._fireEvent(R,M,L,J)}}m(x[R],function(){P=this.call(w,O,M);if(this.cached){x[R].splice(K,1)}if(P===false){return false}K++});return P};function B(){if($f(q)){$f(q).getParent().innerHTML="";p=$f(q).getIndex();a[p]=w}else{a.push(w);p=a.length-1}A=parseInt(q.style.height,10)||q.clientHeight;E=q.id||"fp"+e();r=G.id||E+"_api";G.id=r;u=q.innerHTML;if(typeof t=="string"){t={clip:{url:t}}}t.playerId=E;t.clip=t.clip||{};if(q.getAttribute("href",2)&&!t.clip.url){t.clip.url=q.getAttribute("href",2)}s=new h(t.clip,-1,w);t.playlist=t.playlist||[t.clip];var I=0;m(t.playlist,function(){var L=this;if(typeof L=="object"&&L.length){L={url:""+L}}m(t.clip,function(M,N){if(N!==undefined&&L[M]===undefined&&typeof N!="function"){L[M]=N}});t.playlist[I]=L;L=new h(L,I,w);F.push(L);I++});m(t,function(L,M){if(typeof M=="function"){if(s[L]){s[L](M)}else{j(x,L,M)}delete t[L]}});m(t.plugins,function(L,M){if(M){y[L]=new l(L,M,w)}});if(!t.plugins||t.plugins.controls===undefined){y.controls=new l("controls",null,w)}y.canvas=new l("canvas",null,w);u=q.innerHTML;function K(L){if(/iPad|iPhone|iPod/i.test(navigator.userAgent)&&!/.flv$/i.test(F[0].url)&&!J()){return true}if(!w.isLoaded()&&w._fireEvent("onBeforeClick")!==false){w.load()}return f(L)}function J(){return w.hasiPadSupport&&w.hasiPadSupport()}function H(){if(u.replace(/\s/g,"")!==""){if(q.addEventListener){q.addEventListener("click",K,false)}else{if(q.attachEvent){q.attachEvent("onclick",K)}}}else{if(q.addEventListener&&!J()){q.addEventListener("click",f,false)}w.load()}}setTimeout(H,0)}if(typeof q=="string"){var z=c(q);if(!z){throw"Flowplayer cannot access element: "+q}q=z;B()}else{B()}}var a=[];function d(o){this.length=o.length;this.each=function(q){m(o,q)};this.size=function(){return o.length};var p=this;for(name in b.prototype){p[name]=function(){var q=arguments;p.each(function(){this[name].apply(this,q)})}}}window.flowplayer=window.$f=function(){var p=null;var o=arguments[0];if(!arguments.length){m(a,function(){if(this.isLoaded()){p=this;return false}});return p||a[0]}if(arguments.length==1){if(typeof o=="number"){return a[o]}else{if(o=="*"){return new d(a)}m(a,function(){if(this.id()==o.id||this.id()==o||this.getParent()==o){p=this;return false}});return p}}if(arguments.length>1){var t=arguments[1],q=(arguments.length==3)?arguments[2]:{};if(typeof t=="string"){t={src:t}}t=i({bgcolor:"#000000",version:[10,1],expressInstall:"http://releases.flowplayer.org/swf/expressinstall.swf",cachebusting:false},t);if(typeof o=="string"){if(o.indexOf(".")!=-1){var s=[];m(n(o),function(){s.push(new b(this,k(t),k(q)))});return new d(s)}else{var r=c(o);return new b(r!==null?r:k(o),k(t),k(q))}}else{if(o){return new b(o,k(t),k(q))}}}return null};i(window.$f,{fireEvent:function(){var o=[].slice.call(arguments);var q=$f(o[0]);return q?q._fireEvent(o.slice(1)):null},addPlugin:function(o,p){b.prototype[o]=p;return $f},each:m,extend:i});if(typeof jQuery=="function"){jQuery.fn.flowplayer=function(q,p){if(!arguments.length||typeof arguments[0]=="number"){var o=[];this.each(function(){var r=$f(this);if(r){o.push(r)}});return arguments.length?o[arguments[0]]:new d(o)}return this.each(function(){$f(this,k(q),p?k(p):{})})}}})();(function(){var h=document.all,j="http://www.adobe.com/go/getflashplayer",c=typeof jQuery=="function",e=/(\d+)[^\d]+(\d+)[^\d]*(\d*)/,b={width:"100%",height:"100%",id:"_"+(""+Math.random()).slice(9),allowfullscreen:true,allowscriptaccess:"always",quality:"high",version:[3,0],onFail:null,expressInstall:null,w3c:false,cachebusting:false};if(window.attachEvent){window.attachEvent("onbeforeunload",function(){__flash_unloadHandler=function(){};__flash_savedUnloadHandler=function(){}})}function i(m,l){if(l){for(var f in l){if(l.hasOwnProperty(f)){m[f]=l[f]}}}return m}function a(f,n){var m=[];for(var l in f){if(f.hasOwnProperty(l)){m[l]=n(f[l])}}return m}window.flashembed=function(f,m,l){if(typeof f=="string"){f=document.getElementById(f.replace("#",""))}if(!f){return}if(typeof m=="string"){m={src:m}}return new d(f,i(i({},b),m),l)};var g=i(window.flashembed,{conf:b,getVersion:function(){var m,f;try{f=navigator.plugins["Shockwave Flash"].description.slice(16)}catch(o){try{m=new ActiveXObject("ShockwaveFlash.ShockwaveFlash.7");f=m&&m.GetVariable("$version")}catch(n){try{m=new ActiveXObject("ShockwaveFlash.ShockwaveFlash.6");f=m&&m.GetVariable("$version")}catch(l){}}}f=e.exec(f);return f?[1*f[1],1*f[(f[1]*1>9?2:3)]*1]:[0,0]},asString:function(l){if(l===null||l===undefined){return null}var f=typeof l;if(f=="object"&&l.push){f="array"}switch(f){case"string":l=l.replace(new RegExp('(["\\\\])',"g"),"\\$1");l=l.replace(/^\s?(\d+\.?\d*)%/,"$1pct");return'"'+l+'"';case"array":return"["+a(l,function(o){return g.asString(o)}).join(",")+"]";case"function":return'"function()"';case"object":var m=[];for(var n in l){if(l.hasOwnProperty(n)){m.push('"'+n+'":'+g.asString(l[n]))}}return"{"+m.join(",")+"}"}return String(l).replace(/\s/g," ").replace(/\'/g,'"')},getHTML:function(o,l){o=i({},o);var n='<object width="'+o.width+'" height="'+o.height+'" id="'+o.id+'" name="'+o.id+'"';if(o.cachebusting){o.src+=((o.src.indexOf("?")!=-1?"&":"?")+Math.random())}if(o.w3c||!h){n+=' data="'+o.src+'" type="application/x-shockwave-flash"'}else{n+=' classid="clsid:D27CDB6E-AE6D-11cf-96B8-444553540000"'}n+=">";if(o.w3c||h){n+='<param name="movie" value="'+o.src+'" />'}o.width=o.height=o.id=o.w3c=o.src=null;o.onFail=o.version=o.expressInstall=null;for(var m in o){if(o[m]){n+='<param name="'+m+'" value="'+o[m]+'" />'}}var p="";if(l){for(var f in l){if(l[f]){var q=l[f];p+=f+"="+(/function|object/.test(typeof q)?g.asString(q):q)+"&"}}p=p.slice(0,-1);n+='<param name="flashvars" value=\''+p+"' />"}n+="</object>";return n},isSupported:function(f){return k[0]>f[0]||k[0]==f[0]&&k[1]>=f[1]}});var k=g.getVersion();function d(f,n,m){if(g.isSupported(n.version)){f.innerHTML=g.getHTML(n,m)}else{if(n.expressInstall&&g.isSupported([6,65])){f.innerHTML=g.getHTML(i(n,{src:n.expressInstall}),{MMredirectURL:encodeURIComponent(location.href),MMplayerType:"PlugIn",MMdoctitle:document.title})}else{if(!f.innerHTML.replace(/\s/g,"")){f.innerHTML="<h2>Flash version "+n.version+" or greater is required</h2><h3>"+(k[0]>0?"Your version is "+k:"You have no flash plugin installed")+"</h3>"+(f.tagName=="A"?"<p>Click here to download latest version</p>":"<p>Download latest version from <a href='"+j+"'>here</a></p>");if(f.tagName=="A"||f.tagName=="DIV"){f.onclick=function(){location.href=j}}}if(n.onFail){var l=n.onFail.call(this);if(typeof l=="string"){f.innerHTML=l}}}}if(h){window[n.id]=document.getElementById(n.id)}i(this,{getRoot:function(){return f},getOptions:function(){return n},getConf:function(){return m},getApi:function(){return f.firstChild}})}if(c){jQuery.tools=jQuery.tools||{version:"3.2.10"};jQuery.tools.flashembed={conf:b};jQuery.fn.flashembed=function(l,f){return this.each(function(){$(this).data("flashembed",flashembed(this,l,f))})}}})();/**
 * jQuery BASE64 functions
 * 
 * 	<code>
 * 		Encodes the given data with base64. 
 * 		String $.base64Encode ( String str )
 *		<br />
 * 		Decodes a base64 encoded data.
 * 		String $.base64Decode ( String str )
 * 	</code>
 * 
 * Encodes and Decodes the given data in base64.
 * This encoding is designed to make binary data survive transport through transport layers that are not 8-bit clean, such as mail bodies.
 * Base64-encoded data takes about 33% more space than the original data. 
 * This javascript code is used to encode / decode data using base64 (this encoding is designed to make binary data survive transport through transport layers that are not 8-bit clean). Script is fully compatible with UTF-8 encoding. You can use base64 encoded data as simple encryption mechanism.
 * If you plan using UTF-8 encoding in your project don't forget to set the page encoding to UTF-8 (Content-Type meta tag). 
 * This function orginally get from the WebToolkit and rewrite for using as the jQuery plugin.
 * 
 * Example
 * 	Code
 * 		<code>
 * 			$.base64Encode("I'm Persian."); 
 * 		</code>
 * 	Result
 * 		<code>
 * 			"SSdtIFBlcnNpYW4u"
 * 		</code>
 * 	Code
 * 		<code>
 * 			$.base64Decode("SSdtIFBlcnNpYW4u");
 * 		</code>
 * 	Result
 * 		<code>
 * 			"I'm Persian."
 * 		</code>
 * 
 * @alias Muhammad Hussein Fattahizadeh < muhammad [AT] semnanweb [DOT] com >
 * @link http://www.semnanweb.com/jquery-plugin/base64.html (no longer available?)
 * @link https://gist.github.com/gists/1602210
 * @see http://www.webtoolkit.info/
 * @license http://www.gnu.org/licenses/gpl.html [GNU General Public License]
 * @param {jQuery} {base64Encode:function(input))
 * @param {jQuery} {base64Decode:function(input))
 * @return string
 */

(function($){
	
	var keyString = "ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";
	
	var uTF8Encode = function(string) {
		string = string.replace(/\x0d\x0a/g, "\x0a");
		var output = "";
		for (var n = 0; n < string.length; n++) {
			var c = string.charCodeAt(n);
			if (c < 128) {
				output += String.fromCharCode(c);
			} else if ((c > 127) && (c < 2048)) {
				output += String.fromCharCode((c >> 6) | 192);
				output += String.fromCharCode((c & 63) | 128);
			} else {
				output += String.fromCharCode((c >> 12) | 224);
				output += String.fromCharCode(((c >> 6) & 63) | 128);
				output += String.fromCharCode((c & 63) | 128);
			}
		}
		return output;
	};
	
	var uTF8Decode = function(input) {
		var string = "";
		var i = 0;
		var c = c1 = c2 = 0;
		while ( i < input.length ) {
			c = input.charCodeAt(i);
			if (c < 128) {
				string += String.fromCharCode(c);
				i++;
			} else if ((c > 191) && (c < 224)) {
				c2 = input.charCodeAt(i+1);
				string += String.fromCharCode(((c & 31) << 6) | (c2 & 63));
				i += 2;
			} else {
				c2 = input.charCodeAt(i+1);
				c3 = input.charCodeAt(i+2);
				string += String.fromCharCode(((c & 15) << 12) | ((c2 & 63) << 6) | (c3 & 63));
				i += 3;
			}
		}
		return string;
	};
	
	$.extend({
		base64Encode: function(input) {
			var output = "";
			var chr1, chr2, chr3, enc1, enc2, enc3, enc4;
			var i = 0;
			input = uTF8Encode(input);
			while (i < input.length) {
				chr1 = input.charCodeAt(i++);
				chr2 = input.charCodeAt(i++);
				chr3 = input.charCodeAt(i++);
				enc1 = chr1 >> 2;
				enc2 = ((chr1 & 3) << 4) | (chr2 >> 4);
				enc3 = ((chr2 & 15) << 2) | (chr3 >> 6);
				enc4 = chr3 & 63;
				if (isNaN(chr2)) {
					enc3 = enc4 = 64;
				} else if (isNaN(chr3)) {
					enc4 = 64;
				}
				output = output + keyString.charAt(enc1) + keyString.charAt(enc2) + keyString.charAt(enc3) + keyString.charAt(enc4);
			}
			return output;
		},
		base64Decode: function(input) {
			var output = "";
			var chr1, chr2, chr3;
			var enc1, enc2, enc3, enc4;
			var i = 0;
			input = input.replace(/[^A-Za-z0-9\+\/\=]/g, "");
			while (i < input.length) {
				enc1 = keyString.indexOf(input.charAt(i++));
				enc2 = keyString.indexOf(input.charAt(i++));
				enc3 = keyString.indexOf(input.charAt(i++));
				enc4 = keyString.indexOf(input.charAt(i++));
				chr1 = (enc1 << 2) | (enc2 >> 4);
				chr2 = ((enc2 & 15) << 4) | (enc3 >> 2);
				chr3 = ((enc3 & 3) << 6) | enc4;
				output = output + String.fromCharCode(chr1);
				if (enc3 != 64) {
					output = output + String.fromCharCode(chr2);
				}
				if (enc4 != 64) {
					output = output + String.fromCharCode(chr3);
				}
			}
			output = uTF8Decode(output);
			return output;
		}
	});
})(jQuery);

/**
 * Extends JQuery with base64EncodeUrl and base64DecodeUrl
 *@see http://jsfiddle.net/magikmaker/7bjat/
 */ 
(function($) {
	$.extend({			
		base64EncodeUrl : function(str){
			return $.base64Encode(str).replace(/\+/g, '-').replace(/\//g, '_').replace(/\=+$/, '');
		},
		base64DecodeUrl : function(str){
			str = (str + '===').slice(0, str.length + (str.length % 4));
			return $.base64Decode(str.replace(/-/g, '+').replace(/_/g, '/'));
		}
	});
})(jQuery);/*!
 *  This file is part of Wigii.
 *  Wigii is developed to inspire humanity. To Humankind we offer Gracefulness, Righteousness and Goodness.
 *  
 *  Wigii is free software: you can redistribute it and/or modify it 
 *  under the terms of the GNU General Public License as published by
 *  the Free Software Foundation, either version 3 of the License, 
 *  or (at your option) any later version.
 *  
 *  Wigii is distributed in the hope that it will be useful, but WITHOUT ANY WARRANTY; 
 *  without even the implied warranty of MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  
 *  See the GNU General Public License for more details.
 *
 *  A copy of the GNU General Public License is available in the Readme folder of the source code.  
 *  If not, see <http://www.gnu.org/licenses/>.
 *
 *  @copyright  Copyright (c) 2016  Wigii.org
 *  @author     <http://www.wigii.org/system>      Wigii.org 
 *  @link       <http://www.wigii-system.net>      <https://github.com/wigii/wigii>   Source Code
 *  @license    <http://www.gnu.org/licenses/>     GNU General Public License
 */

/*
 * Modified by Medair in 2016 for maintenance purposes (see SVN log for details) 
 */

function printObj(obj) {
	var arr = [];
	$.each(obj, function(key, val) {
		var next = key + ": ";
		next += $.isPlainObject(val) ? printObj(val) : val;
		arr.push( next );
	});
	return "{ " + arr.join(", ") + " }";
};


/* global JS variables */

crtElementId = null; //id of the current selectedElement
crtElementType = 'element'; //type name of the current selectedElement
crtRoleId = null;
crtContextId = 0; //id of the current JS context, this is used to manage context from multiple browser window
crtWigiiNamespaceUrl = null;
crtModuleName = null;
crtWorkingModuleName = null;
crtLanguage = null;
wigii_operationSuccessfullTimeout = null;
wigii_preventOperationSuccessfullTimeout = null;

function object2Array(obj){
	r = new Array;
	i = 0;
	for(x in obj){
		r[i++]=obj[x];
	}
	return r;
}

// prepends #ctrWigiiNamespace/crtModule/ to url. 
function prependCrtWigiiNamespaceAndModule2Url(url) {
	return '#'+crtWigiiNamespaceUrl+'/'+crtModuleName+'/'+url;
}

//add the function icontains which use the contains insensitive.
$.expr[':'].icontains = function(obj, index, meta, stack){ return (obj.textContent || obj.innerText || jQuery(obj).text() || '').toLowerCase().indexOf(meta[3].toLowerCase()) >= 0; };

////the first occurence needs to have the full dots
//function dotdotdot(dotdotdotElement, maxDots) {
//	dotdotdotText = dotdotdotElement.text();
//	lastDotPos = dotdotdotText.lastIndexOf('.');
//	if(lastDotPos==-1) lastDotPos = dotdotdotText.length;
//	//current nb of dots
//	nbDots = maxDots-(dotdotdotText.length-lastDotPos+1);
//	//add one
//	nbDots = (nbDots+1)%maxDots;
//	spaces = new Array(maxDots-nbDots).join(" ");
//	dots = new Array(nbDots).join(".");
//	$('#companyBanner>div>font:first').text(nbDots+" "+dotdotdotText+":"+dots+":"+spaces);
//
//	dotdotdotElement.text(dotdotdotText.substr(0,dotdotdotText.length-maxDots)+dots+spaces);
//
//};
dialogPos = new Array();
busyDivStack = new Array();
busyDivInterval = null;
function setVis(element, vis){
	if(typeof element != 'object'){
		element = $('#'+element);
	}
	id = element.attr('id');

	if(vis == true){
		element.show();
		if(id=='busyDiv'){
			if(busyDivStack.length==0){
//				busyDivInterval = setInterval(function(){ dotdotdot(element, 3); }, 300);
			}
			busyDivStack.push('x');
		}
		//element.css("visibility", 'visible'); //.fadeIn("normal");
		//element.show("slow");
	}
	else{
		if(id=='busyDiv'){
			//alert(busyDivStack.length);
			busyDivStack.pop();
			if(busyDivStack.length==0){
//				clearInterval(busyDivInterval);
				element.hide();
				//element.css("visibility", 'hidden'); //.fadeOut("normal", function(){ if($(this).css('opacity') == 0) $(this).css("visibility", 'hidden');});
			}
		} else {
			//element.hide("slow");
			element.hide();
			//element.css("visibility", 'hidden'); //.fadeOut("normal", function(){ if($(this).css('opacity') == 0) $(this).css("visibility", 'hidden');});
		}
	}
}
function resetBusyDiv() {
	busyDivStack = new Array();
	$('#busyDiv').hide();
}

//called each time a dialog is closed
function actOnCloseDialog(id){
	//nothing special to do here...
}
//called each time a dialog is canceled
function actOnCancelDialog(id){
	$('#'+id).stopTime(); //very important to stop all the timers on elements that we will destroy.
	$('#'+id+" *").stopTime(); //very important to stop all the timers on elements that we will destroy.
	$('#'+id).html('');
	closeAnyJsOnGoingStreams();
}
function emptyDialog(id){
	$('#'+id).stopTime(); //very important to stop all the timers on elements that we will destroy.
	$('#'+id+" *").stopTime(); //very important to stop all the timers on elements that we will destroy.
	$('#'+id).html('');
}

checkOpenItemTemp_id = null;
checkOpenItemTemp_lookupPath = null;
checkOpenItemTemp_url = null;
checkOpenItemTemp_f = null;
checkOpenItemTemp_informIfFoundInCache = null;
function checkOpenItem(id, lookupPath, url, checkAnyOpenItem, informIfFoundInCache){
	if (arguments.length<2) lookupPath = null;
	if (arguments.length<3) url = null;
	if (arguments.length<4) checkAnyOpenItem = false;
	if (arguments.length<5) informIfFoundInCache = false;

	if(checkAnyOpenItem){
		f = $('form');
	} else {
		f = $('#'+id+' form');
	}
	if(f.length>0){
		if(f.length==1){
			//those needs to be updated only there is a checkOpenItems thing, this is to prevent the call on cancel click to change them
			checkOpenItemTemp_id = id;
			checkOpenItemTemp_lookupPath = lookupPath;
			checkOpenItemTemp_url = url;
			checkOpenItemTemp_f = f;
			checkOpenItemTemp_informIfFoundInCache = informIfFoundInCache;
			customConfirmTextFromDialogId = DIALOG_doYouWantToSaveChage;
			if(typeof( window["DIALOG_doYouWantToSave_"+id] ) != "undefined") eval("customConfirmTextFromDialogId = DIALOG_doYouWantToSave_"+id);
			// if cancel button exists and is visible, then asks user to confirm what to do
			cButton = $('.ui-dialog-buttonpane .cancel', checkOpenItemTemp_f.closest('.ui-dialog'));
			if(cButton.filter(':visible').length){
				jConfirm(customConfirmTextFromDialogId, null, function(check){
					if(check===true){
						//click on Ok button
						//alert("ok");
						$('.ui-dialog-buttonpane .ok', checkOpenItemTemp_f.closest('.ui-dialog')).click();
						//cancel current action
					} else if(check===null){
						//do nothing and cancel current action
						checkOpenItemTemp_url = null;
					} else if(check===false){
						//do cancel or no button
						$('.ui-dialog-buttonpane .cancel', checkOpenItemTemp_f.closest('.ui-dialog')).click();
						//continue current action
						if(checkOpenItemTemp_url!=null){
							updateThroughCache(checkOpenItemTemp_id, checkOpenItemTemp_lookupPath, checkOpenItemTemp_url, null, checkOpenItemTemp_informIfFoundInCache, true);
							checkOpenItemTemp_url = null;
						}
					}
				});
			// else if cancel button but not visible then clicks on it and  closes the dialog
			} else if(cButton.length) {
				//alert("cancel");
				//do cancel or no button
				cButton.click();
				//continue current action
				if(checkOpenItemTemp_url!=null){
					updateThroughCache(checkOpenItemTemp_id, checkOpenItemTemp_lookupPath, checkOpenItemTemp_url, null, checkOpenItemTemp_informIfFoundInCache, true);
					checkOpenItemTemp_url = null;
				}
			// else no cancel button, only ok button to click onto
			} else {
				$('.ui-dialog-buttonpane .ok', checkOpenItemTemp_f.closest('.ui-dialog')).click();
			}
			return true;
		} else {
			jAlert(DIALOG_finishCurrentAction);
			return true;
		}
	}
	return false;
}

function checkOpenWorkzoneViewMode(id, lookupPath, url, checkAnyOpenItem, informIfFoundInCache){
	if (arguments.length<2) lookupPath = null;
	if (arguments.length<3) url = null;
	if (arguments.length<4) checkAnyOpenItem = false;
	if (arguments.length<5) informIfFoundInCache = false;

	if(checkAnyOpenItem){
		f = $('.elementDialog.docked').find('form');
	} else {
		f = $('#'+id).find('form');
	}
	
	if(f.length>0){
		if(f.length==1){
			//those needs to be updated only there is a checkOpenItems thing, this is to prevent the call on cancel click to change them
			checkOpenItemTemp_id = id;
			checkOpenItemTemp_lookupPath = lookupPath;
			checkOpenItemTemp_url = url;
			checkOpenItemTemp_f = f;
			checkOpenItemTemp_informIfFoundInCache = informIfFoundInCache;
			customConfirmTextFromDialogId = DIALOG_doYouWantToSaveChage;
			if(typeof( window["DIALOG_doYouWantToSave_"+id] ) != "undefined") eval("customConfirmTextFromDialogId = DIALOG_doYouWantToSave_"+id);
			// if cancel button exists and is visible, then asks user to confirm what to do
			cButton = $('.cancel.ui-button', checkOpenItemTemp_f);
					
			if(cButton.filter(':visible').length){
				jConfirm(customConfirmTextFromDialogId, null, function(check){
					if(check===true){
						//click on Ok button
						$('.ok.ui-button', checkOpenItemTemp_f).click();
						//cancel current action
					} else if(check===null){
						//do nothing and cancel current action
						checkOpenItemTemp_url = null;
					} else if(check===false){
						//do cancel or no button
						$('.cancel.ui-button', checkOpenItemTemp_f).click();
						//continue current action
						if(checkOpenItemTemp_url!=null){
							updateThroughCache(checkOpenItemTemp_id, checkOpenItemTemp_lookupPath, checkOpenItemTemp_url, null, checkOpenItemTemp_informIfFoundInCache, true);
							checkOpenItemTemp_url = null;
						}
					}
				});
			// else if cancel button but not visible then clicks on it and  closes the dialog
			} else if(cButton.length) {
				//do cancel or no button
				cButton.click();
				//continue current action
				if(checkOpenItemTemp_url!=null){
					updateThroughCache(checkOpenItemTemp_id, checkOpenItemTemp_lookupPath, checkOpenItemTemp_url, null, checkOpenItemTemp_informIfFoundInCache, true);
					checkOpenItemTemp_url = null;
				}
			// else no cancel button, only ok button to click onto
			} else {
				$('.ok.ui-button', checkOpenItemTemp_f).click();
			}
			return true;
		} else {
			jAlert(DIALOG_finishCurrentAction);
			return true;
		}
	}
	return false;
}

currentElementDialogViewCacheKey = null;
function updateCurrentElementDialogViewCache(){
	if(__cache && __cache["elementDialog"] && __cache["elementDialog"][currentElementDialogViewCacheKey]){
		setCacheFromDom("elementDialog", currentElementDialogViewCacheKey);
	}
}
function invalidCurrentElementDialogViewCache(){
	invalidCache("elementDialog", currentElementDialogViewCacheKey);
}
currentModuleViewCacheKey = null;
function updateCurrentModuleViewCache(){
	if(__cache && __cache["moduleView"] && __cache["moduleView"][currentModuleViewCacheKey]){
		setCacheFromDom("moduleView", currentModuleViewCacheKey);
	}
}
function invalidCurrentModuleViewCache(){
	invalidCache("moduleView", currentModuleViewCacheKey);
}
function invalidModuleViewCache(){
	invalidCache("moduleView");
}

__cache = new Object();
__cacheJS = new Object();
__cacheKeep = new Object();
//checkAnyOpenItem checks that in the whole dom there is no form.
//other wise the check is done only within the id
foundInCache=false;
function updateThroughCache(id, lookupPath, url, checkAnyOpenItem, informIfFoundInCache, noOpenItemCheck){
	if (arguments.length<4) checkAnyOpenItem = false;
	if (arguments.length<5) informIfFoundInCache = false;
	if (arguments.length<6) noOpenItemCheck = false;
 
	if(!isWorkzoneViewDocked()){
		if(!noOpenItemCheck && checkOpenItem(id, lookupPath, url, checkAnyOpenItem, informIfFoundInCache)){
			return;
		}
	} else {
		if(!noOpenItemCheck && checkOpenWorkzoneViewMode(id, lookupPath, url, checkAnyOpenItem, informIfFoundInCache)){	
			return;
		}
	}

	//special caching for moduleView
	if(id=="moduleView"){
		currentModuleViewCacheKey = lookupPath;
	} else if(id=="elementDialog"){
		currentElementDialogViewCacheKey = lookupPath;
	}
	var r = null; var c= null; foundInCache = false;
	if(lookupPath){
		r = getCache(id, lookupPath);
		if(r) foundInCache = true;
		c = getJSCache(id, lookupPath);
		if(c) foundInCache = true;
	}
	if(foundInCache){
		if(r) {
			$("#"+id+" *").stopTime(); //very important to stop all the timers on elements that we will destroy.
			$("#"+id).html(r);
		}
		//inform the server that an action has been done from the user, but content is found in cache
		if(informIfFoundInCache) {
			foundInCacheUpdate(url);
		}
		if(c){
			// make sure that foundInCache is still true when ready function is executed
			c = '$(document).ready(function(){foundInCache=true;});'+c;
			eval(c);
		}
		foundInCache=false;
	} else {
		update(url, true);
	}
}
function getCache(id, lookupPath){
	if(!__cache[id]){
		__cache[id] = new Object();
	}
	r = __cache[id][lookupPath];
	return r;
}
function getJSCache(id, lookupPath){
	if(!__cacheJS[id]){
		__cacheJS[id] = new Object();
	}
	c = __cacheJS[id][lookupPath];
	return c;
}
function setCache(id, lookupPath, html){
	if(!__cache[id]){
		__cache[id] = new Object();
	}
	__cache[id][lookupPath] = html;
}
function setJSCache(id, lookupPath, code){
	if(!__cacheJS[id]){
		__cacheJS[id] = new Object();
	}
	__cacheJS[id][lookupPath] = code;
}
function setCacheFromDom(id, lookupPath){
	if(id==null){
		alert("try to setCacheFromDom with no id. WigiiExecutor.js");
		return;
	}
	if(!__cache[id]){
		__cache[id] = new Object();
	}
	if(!__cacheJS[id]){
		__cacheJS[id] = new Object();
	}
	__cache[id][lookupPath] = $('#'+id).html();
	if($('#JSCode'+id).length>0){
		__cacheJS[id][lookupPath] = $('#JSCode'+id).text();
	}
}
//isRecursif should be ignored, as it is used only in window opener recursif code
function invalidCompleteCache(isRecursif){
	if (arguments.length<1) isRecursif = false;
	__cache = new Object();
	__cacheJS = new Object();

	if(!isRecursif){
		var crtWin = window;
		while(crtWin.opener){
			try {
				if(crtWin.opener.location.hostname == crtWin.location.hostname) {
					crtWin.opener.invalidCompleteCache(true);
					crtWin = crtWin.opener;
				}
				else crtWin = false;
			}
			catch(err) {
				crtWin = false;
			}
		}
	}
}
//isRecursif should be ignored, as it is used only in window opener recursif code
function invalidCache(id, lookupPath, isRecursif){
	if (arguments.length<2) lookupPath = null;
	if (arguments.length<3) isRecursif = false;

	//invalid cache of any parent window

	if(!__cache[id]){
		__cache[id] = new Object();
	}
	if(!__cacheJS[id]){
		__cacheJS[id] = new Object();
	}
	if(lookupPath){
		if(!__cacheKeep[lookupPath]) {
			__cache[id][lookupPath] = null;
			__cacheJS[id][lookupPath] = null;
		}
	} else {
		var c = __cache[id];
		var newC = new Object();
		for(var cId in c) {
			if(__cacheKeep[cId]) newC[cId] = c[cId];			
		}
		__cache[id] = newC;
		
		c = __cacheJS[id];
		newC = new Object();
		for(var cId in c) {
			if(__cacheKeep[cId]) newC[cId] = c[cId];			
		}
		__cacheJS[id] = newC;
	}

	if(!isRecursif){
		var crtWin = window;
		while(crtWin.opener){
			try {
				if(crtWin.opener.location.hostname == crtWin.location.hostname) {
					crtWin.opener.invalidCache(id, lookupPath, true);
					crtWin = crtWin.opener;
				}
				else crtWin = false;
			}
			catch(err) {
				crtWin = false;
			}
		}
	}
}
function keepInCache(id) {
	__cacheKeep[id] = id;
}
function clearKeepInCache() {
	__cacheKeep = new Object();
}
var crtNavigateCacheKey = null;
function setModuleViewKeyCacheForNavigate(key) {
	setJSCache('navigationCache', crtNavigateCacheKey, key);
}
function getModuleViewKeyCacheForNavigate() {
	return getJSCache('navigationCache', crtNavigateCacheKey);
}
function setCurrentNavigateCacheKey(key) {
	crtNavigateCacheKey = key;
}

function foundInCacheUpdate(url){
	if(url == null) return;

	//find the idAnswer:
	s = url.split("/");
	s[0] = EXEC_foundInJSCache;
	url = s.join("/");

	url = SITE_ROOT +"Update/"+crtContextId+EXEC_requestSeparator+ url;

	var myAjax = new jQuery.ajax({
			url: encodeURI(url),
			success : parseUpdateResult,
			cache:false,
			error: errorOnUpdate
		});
	onUpdateErrorCounter = 0;
}
function update(url, noOpenItemCheck, postdata, successCallback){
	if (arguments.length<2) noOpenItemCheck = false;
	if (arguments.length<3) postdata = null;
	if (arguments.length<4) successCallback = null;

	if(url == null) return;

	//find the idAnswer:
	idAnswer = url.split("/")[0];

	if(!noOpenItemCheck){
		if(isWorkzoneViewDocked()){
			if(checkOpenWorkzoneViewMode(idAnswer, null, url)){
				return;
			}
		} else {
			if(checkOpenItem(idAnswer, null, url)){
				return;
			}
		}
	}

	setVis("busyDiv", true);

	url = SITE_ROOT +"Update/"+crtContextId+EXEC_requestSeparator+ url;

	if(postdata != null){
		var myAjax = new jQuery.ajax({
				type: "POST",
				url: encodeURI(url),
				success : (successCallback != null ? successCallback : parseUpdateResult),
				data: postdata,
				error: errorOnUpdate
			});
	} else {
		var myAjax = new jQuery.ajax({
				url: encodeURI(url),
				success : (successCallback != null ? successCallback : parseUpdateResult),
				cache:false,
				error: errorOnUpdate
			});
	}
	onUpdateErrorCounter = 0;
}

//use this fonction to make your navigator download a file
function download(url){
	url = SITE_ROOT +"useContext/"+crtContextId+EXEC_requestSeparator+ url.replace(SITE_ROOT, '');
	window.location.href = url;
}
function longDownload(url,fieldId) {
	messageDownload(fieldId);
	setTimeout(function() {setVis('fileDownloadingBar', false);}, 5000);
	download(url);
}

/**
 * cette méthode réeffectue l'update trois fois s'il y a eu une erreur de request.
 * Ceci arrive par exemple lorsque je fais l'event de la touche ESC qui clique
 * le bouton annuler...
 */
onUpdateErrorCounter = 0; //compteur du nombre d'erreur consécutif d'un update ajax
function errorOnUpdate(XMLHttpRequest, textStatus, errorThrown) {
	onUpdateErrorCounter ++;
	if(onUpdateErrorCounter <= 3){
  		var myAjax = new jQuery.ajax( {
			url: this.url,
			data: this.data,
			method: this.method,
			type: this.type,
			success : this.success,
			cache:false,
			error: this.error
			}
			);
  	}
}

encHTML = function(text) {
	return text.replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;');
};

decHTML = function(text) {
	//very important to replace the \n and \r to prevent js evaluation error
	return text.replace(/\n/g, ' ').replace(/\r/g, ' ').replace(/&quot;/g,'"').replace(/&#39;/g,"'").replace(/&mySQ;/g,"'").replace(/&oelig;/g,'œ').replace(/&amp;/g,'&').replace(/&lt;/g,'<').replace(/&gt;/g,'>'); //.replace(/<br\/>/g,'\n').replace(/<br>/g,'\n').replace(/<br \/>/g,'\n');
};

/**
 * décode le résultat d'une requête asynchrone et effectue les opérations désirée en fonction
 * du premier paramêtre de la réponse
 * @param {} tabReq
 * @param {} textStatus
 */
function parseUpdateResult(tabReq, textStatus){
	/* do not hide long run waiting message neither form submission progress bar until it is done
	 * 	the code bellow is deprecated since the 22.03.2018 to prevent user thinking things are completed when not yet
	 *  the risk is that the long run waiting message never goes away in some cases, which then is still preferable that the user
	 *  refresh than having the message removed by itself
		// hides progress bar
		setVis('formProgressBar', false);
	 */
	// hides long run waiting message
	if(savingBarTimeout) {clearTimeout(savingBarTimeout);savingBarTimeout=null;}
	setVis('savingBar', false);
	// Wigii 4.324 R1790: transfers parseUpdateResult algorithm to wigii() JS client.
	wigii().parseUpdateResult(tabReq,textStatus);
	// hides short run waiting message
	setVis("busyDiv", false);	
}

function positionElementOnMouse(obj, event, align, linkedObj, additionalLowOffset){
	if(arguments.length < 4) linkedObj = null;
	if(arguments.length < 5) additionalLowOffset = null;
	//we need to add the scrolls to get the real position
	//the width of 5 px allows a better way to manage position beside the mouse without being to easy under it
	//if we want to be under, then use the offsetLow and a fromLeft
	//calculate the offsetLow to be not under the mouse, but not either out of the current linkedObj
	//to prevent block scrolling when mouving mouse
	if(linkedObj != null){
		offsetLow = 5;
		//alert(offsetLow+" "+(linkedObj.offset().top+linkedObj.height())+" "+(event.clientY+$(document).scrollTop())+" "+((linkedObj.offset().top+linkedObj.height()) - (event.clientY+$(document).scrollTop())));
		//WARNING if you forget adding the parseint calculation is messy, because some is concatenating and others are additionning
		scrollTop = parseInt($(document).scrollTop());
		if(scrollTop != 0) scrollTop = scrollTop - 5;
		if (parseInt(linkedObj.offset().top)+parseInt(linkedObj.height()) - parseInt(event.clientY)+scrollTop <= offsetLow){
			offsetLow = parseInt(linkedObj.offset().top) + parseInt(linkedObj.height()) - parseInt(event.clientY)+scrollTop-2;
		}
	} else {
		offsetLow = 0;
		scrollTop = parseInt($(document).scrollTop());
	}
	positionElement(obj, event.clientY+scrollTop, event.clientX+parseInt($(document).scrollLeft()), 30, 5, align, offsetLow+additionalLowOffset, true);
}
//position the object depending on the align parameters
//using linkedObj as reference.
//the object will be positioned to not go out of the client window size
function positionElementOnDom(obj, linkedObj, align, offsetLow, preventRecovering, usePosition){
	if(arguments.length < 4) offsetLow = null;
	if(arguments.length < 5) preventRecovering = false;
	if(arguments.length < 6) usePosition = false;
	if(usePosition){
		var pos = linkedObj.position();
	} else {
		var pos = linkedObj.offset();
	}
	var myLeft = pos.left;
	var myTop = pos.top;
	positionElement(obj, myTop, myLeft, linkedObj.outerHeight(), linkedObj.outerWidth(), align, offsetLow, preventRecovering);
}

function positionElement(obj, refTop, refLeft, refHeight, refWidth, align, offsetLow, preventRecovering){

	var myLeft, myTop;

	//alignement centré
	if(align=="center"){
		myLeft = refLeft+ refWidth/2 - obj.outerWidth()/2;
	} else if (align=="right"){
		myLeft = refLeft + refWidth;
	} else if (align=="left"){
		myLeft = refLeft - obj.outerWidth();
	} else if (align=="fromLeft"){
		myLeft = refLeft;
	} else if (align=="fromRight"){
		myLeft = refLeft + refWidth - obj.outerWidth();
	} else if (align=="fromCenter"){
		myLeft = refLeft+ (refWidth/2);
	} else if (align=="toCenter"){
		myLeft = refLeft+ (refWidth/2) - obj.outerWidth();
	}
	if(offsetLow === null){
		myTop = refTop + refHeight;
	} else {
		myTop = refTop + offsetLow;
	}


	//var winW = $('#mainDiv').outerWidth();
	//var winH = $('#mainDiv').outerHeight();
	// get window size ( code extracted from pre 1.1.0 getPageSize )
	var winW, winH;

	if (self.innerHeight) {	// all except Explorer
		if(document.documentElement.clientWidth){
			winW = document.documentElement.clientWidth;
		} else {
			winW = self.innerWidth;
		}
		winH = self.innerHeight;
	} else if (document.documentElement && document.documentElement.clientHeight) { // Explorer 6 Strict Mode
		winW = document.documentElement.clientWidth;
		winH = document.documentElement.clientHeight;
	} else if (document.body) { // other Explorers
		winW = document.body.clientWidth;
		winH = document.body.clientHeight;
	}

	var width = obj.outerWidth();
	var height = obj.outerHeight();

//	if(obj.attr('id') == "editElementSharingMenu"){
//		alert("top:"+myTop+" myLeft:"+myLeft+" winW:"+winW+" winH:"+winH+" width:"+width+" height:"+height);
//	}

	myTop = Math.min(winH-height, myTop-$(document).scrollTop());
	myTop = Math.max(0, myTop);

	//control that the obj is not covering the linkedObj
	if(preventRecovering){
		//vertical control
		//alert(myTop+' '+(linkedObj.offset().top+linkedObj.outerHeight())+' '+(myTop+height)+' '+linkedObj.offset().top);
		if((myTop+$(document).scrollTop() < (refTop+refHeight) && (myTop+$(document).scrollTop()+height)>refTop)){
			//move it on the left if possible
			if((winW-width < myLeft+$(document).scrollLeft()) && (refLeft - width > 0)){
				myLeft = refLeft - width;
			} else {
				//myLeft = refLeft + refWidth;
			}
		}
	}
	if(!preventRecovering){
		myLeft = Math.min(winW-width, myLeft-$(document).scrollLeft());
	}
	//limit on the right
	myLeft = Math.min(winW-width, myLeft-$(document).scrollLeft());
	//limit on the left
	myLeft = Math.max(0, myLeft);

//	if(obj.attr('id') == "editElementSharingMenu"){
//		alert(myTop+$(document).scrollTop() + " " + myLeft+$(document).scrollLeft());
//	}

	//those values will be added to the offsetParent of the obj.
	//if we want that those value will really be from the document
	//we need to soustract the offset of the parent.
//	if(obj.attr('id') == "editElementSharingMenu"){
//		alert(obj.get()[0].parentNode.offsetParent.offsetLeft);
//	}
//

	//if the obj origin is not the document, then substract the origin
//	obj.css("left", 0);
//	obj.css("top", 0);
//	origin = obj.offset();
//	alert(origin.left+" "+origin.top);
//	obj.css("left", myLeft-origin.left+$(document).scrollLeft());
//	obj.css("top", myTop-origin.top+$(document).scrollTop()); //il faut ajouter la position actuelle du scroll top pour que ce soit toujours à la bonne place

	obj.css("left", myLeft+$(document).scrollLeft());
	obj.css("top", myTop+$(document).scrollTop()); //il faut ajouter la position actuelle du scroll top pour que ce soit toujours à la bonne place

	//obj.offset({ left: myLeft+$(document).scrollLeft(), top: myTop+$(document).scrollTop() });
}


showHelpTimer = null;
hideHelpTimer = null;
doHideHelpTimer = null;
var showHelpRef, showHelpText, showHelpOffsetLow, showHelpAlign, showHelpDelay, showHelpMaxWidth, showHelpDefinedWidth, showHelpHideAfter, showHelpEvent;

//cette méthode construit vraiment le hep. On fait cela uniquement dans le
//cas où l'on va réellement l'afficher
function showHelp2(){

	var event = showHelpEvent;
	var ref = showHelpRef;
	var text = showHelpText;
	var offsetLow = showHelpOffsetLow;
	var align = showHelpAlign;
	var delay = showHelpDelay;
	var maxWidth = showHelpMaxWidth;
	var definedWidth = showHelpDefinedWidth;
	var hideAfter = showHelpHideAfter;

	//pour que la méthode outerWidth fonctionne correctement
	//il faut définir le width...
	helpEl = $('#help');
	helpEl.width(5);
	helpEl.html(text);
	if(definedWidth){
		helpEl.width(maxWidth);
	} else {
		helpEl.width("auto");
		if(helpEl.width() > maxWidth){
			helpEl.width(maxWidth);
		}
	}
	$('#help').stop(true, true).show();
	$('#help').hide();

	//put("width:"+helpEl.width()+" outerWidth:"+helpEl.outerWidth());

	if(typeof ref != 'object'){
		ref = $('#'+ref);
	} else {
		ref = $(ref);
	}
	if(event != null && typeof event == 'object' && event.clientY){
		positionElementOnMouse(helpEl, event, align, ref, offsetLow);
	} else {
		positionElementOnDom(helpEl, ref, align, offsetLow, false);
	}

	//if the mouse is over the help but the mouse do not move then keep the help showing
	$('#help').unbind().mouseenter(function(){ clearTimeout(doHideHelpTimer); }).mousemove(function(){ hideHelp(true); });
	$('#help').stop(true, true).show();
}

function showHelp(ref,text,offsetLow,align,delay,maxWidth,hideAfter, event){
	clearTimeout(doHideHelpTimer);
	clearTimeout(hideHelpTimer); //on annule les hide en cours...
	//s'il n'y a pas de texte, on montre pas le help
	//ceci peut arriver dans les infosbulles de l'ihmList
	if(text == "") return;
	definedWidth = false; //it is better to always leave that width to use the max if necessary
	if (arguments.length<3) offsetLow = null;
	if (arguments.length<4) align = "fromCenter";
	if (arguments.length<5) delay = 200;
	if (arguments.length<6 || maxWidth == null){
		maxWidth = 200; //largeur maximum de l'aide
		definedWidth = false;
	}
	if (arguments.length<7) hideAfter = 3500; //cache l'aide après ce temps
	if (arguments.length<8) event = null; //mouseover event

	//on rends publique ces données, pour permettre de les transmettres dans une fonction appelée en timout
	showHelpEvent = event;
	showHelpRef = ref;
	showHelpText = text;
	showHelpOffsetLow = offsetLow;
	showHelpAlign = align;
	showHelpDelay = delay;
	showHelpMaxWidth = maxWidth;
	showHelpDefinedWidth = definedWidth;
	showHelpHideAfter = hideAfter;

	if(delay != 0){
		//showHelpTimer = setTimeout("showHelp.showHelp3();", delay);
		showHelpTimer = setTimeout("showHelp2();", delay);
	} else {
		showHelp2();
	}

	if(hideAfter != 0){
		hideHelpTimer = setTimeout("hideHelp();", hideAfter);
	} else {
		//in any case hide after 10sec
		hideHelpTimer = setTimeout("hideHelp();", 10000);
	}
}

function hideHelp(fromHideHelp){
	if(arguments.length < 1) fromHideHelp = false;
	//detect if mouse is in help in this case keep help open
	clearTimeout(doHideHelpTimer);
	if(fromHideHelp){
		clearTimeout(showHelpTimer);
		clearTimeout(hideHelpTimer);
		$('#help').hide();
	} else {
		doHideHelpTimer = setTimeout("hideHelp(true);", "50");
	}
}

//cette méthode permet de faire que le multipleSelect dont l'id est passé en paramêtre
//devient un multipleSelect, ou chaque clique toggle la valeur de l'option
var multipleSelectVals = new Array; //les clés contiennes les valeurs de chaque id
function multipleSelectOnClick(id){
	var scrollTop = $('#'+id).scrollTop();
	var newMultipleTab = new Array;
	var alreadyIn = false;
	var select = $('#'+id);
	var temp = multipleSelectVals[id];
	$(temp).each(function(i){
		if(this.toString() != select.val().toString()){ newMultipleTab[newMultipleTab.length] = this.toString();}
		else { alreadyIn = true; }
	});
	if(!alreadyIn && select.val()) newMultipleTab[newMultipleTab.length] = select.val().toString();
	multipleSelectVals[id] = newMultipleTab;
	select.val(newMultipleTab);
	//select.val(new Array('French', 'German'));
	select.scrollTop(scrollTop);
}

function colorize(parent){
	if(arguments.length < 1) parent = $(window);
	else parent = $('#'+parent);
	//text = "begin to colorize "+parent;
	$('#moduleView *[class*="color_"]').each(function(){
		color = "#"+$(this).attr("class").match(/color_(.{6})/i)[1].toUpperCase();
		$(this).css('background-color', color).css('border-color', color);
		var
		    r = HexToR(color),
		    g = HexToG(color),
		    b = HexToB(color);
		var brightness = (r*299 + g*587 + b*114) / 1000;
		if (brightness > 140) {
		    // use black
			$("*", this).css('color', "#000000");
		} else {
		    // use white
			$("*", this).css('color', "#FFFFFF");
		}
	});
	//alert(text);
}

function HexToR(h) {return parseInt((cutHex(h)).substring(0,2),16)}
function HexToG(h) {return parseInt((cutHex(h)).substring(2,4),16)}
function HexToB(h) {return parseInt((cutHex(h)).substring(4,6),16)}
function cutHex(h) {return (h.charAt(0)=="#") ? h.substring(1,7):h}

/**
 * CRON JOBS function
 */
var globalCronJobsStopper = false;
var doingWakeup = false;
var cronJobsWorkingFunction = function(params){
	if(arguments.length < 1) params = "";
	if(doingWakeup){
		return;
	}
	doingWakeup = true;
	// CWE 13.09.2016: clears busyDiv stack to ensure having a fresh empty stack
	resetBusyDiv();
	$('#cronJobsCursor').text(' > ');	
	update('JSCode/NoWigiiNamespace/NoModule/wakeup/'+params);
};
var cronJobsFinishWorkingFunction = function(){
	doingWakeup = false;
};
function setListenersToCronJob(wakeupJsCode, postponeTimer){
	$('#cronJobsStart').click(function(){
		$('#cronJobsNb').stopTime('cronJobsWorking');
		$('#cronJobsStop span').stopTime('cronJobsPostpone');
		$('#cronJobsStop span').text('');
		cronJobsFinishWorkingFunction();
		globalCronJobsStopper = false;
		wakeupJsCode();
	});
	$('#cronJobsStop').click(function(){
		$('#cronJobsNb').stopTime('cronJobsWorking');
		$('#cronJobsNb').stopTime('cronJobsWakeup');
		globalCronJobsStopper = true;
		s = (postponeTimer)/1000;
		m = Math.floor(s/60);
		s = s % 60;
		if(s<10){
			s = '0'+s;
		}
		$('#cronJobsStop span').text(' '+m+':'+s);
		$('#cronJobsStop span').stopTime('cronJobsPostpone');
		$('#cronJobsStop span').everyTime(1000, 'cronJobsPostpone', function(i){
			s = (postponeTimer-(i*1000))/1000;
			m = Math.floor(s/60);
			s = s % 60;
			if(s<10){
				s = '0'+s;
			}
			$(this).text(' '+m+':'+s);
		});
		$('#cronJobsNb').oneTime(postponeTimer, 'cronJobsWorking', function(){
			$('#cronJobsStop span').stopTime('cronJobsPostpone');
			$('#cronJobsStart').click();
		});
	});
}


function logout(){
	update('NoAnswer/NoWigiiNamespace/NoModule/logout');
}
/**
 *  This file is part of Wigii.
 *  Wigii is developed to inspire humanity. To Humankind we offer Gracefulness, Righteousness and Goodness.
 *  
 *  Wigii is free software: you can redistribute it and/or modify it 
 *  under the terms of the GNU General Public License as published by
 *  the Free Software Foundation, either version 3 of the License, 
 *  or (at your option) any later version.
 *  
 *  Wigii is distributed in the hope that it will be useful, but WITHOUT ANY WARRANTY; 
 *  without even the implied warranty of MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  
 *  See the GNU General Public License for more details.
 *
 *  A copy of the GNU General Public License is available in the Readme folder of the source code.  
 *  If not, see <http://www.gnu.org/licenses/>.
 *
 *  @copyright  Copyright (c) 2016  Wigii.org
 *  @author     <http://www.wigii.org/system>      Wigii.org 
 *  @link       <http://www.wigii-system.net>      <https://github.com/wigii/wigii>   Source Code
 *  @license    <http://www.gnu.org/licenses/>     GNU General Public License
 */

/*
 * Modified by Medair in 2016 for maintenance purposes (see SVN log for details) 
 */

//timeout for external access
externalAccessTimeoutTimer = null;
previewCrtHeight = 10;

//DataType Files

function getBasicCKEditorToolbar(){
	return [
		[ 'Bold','Italic','Underline','TextColor'],['NumberedList','BulletedList','Outdent','Indent','Link', 'Image','Table','Scayt','Templates']];
}
function getMediumCKEditorToolbar(){
	return [
		['Templates','Maximize','-','PasteText','RemoveFormat'],['NumberedList','BulletedList','Outdent','Indent' ],['Link', 'Image','Table','HorizontalRule','-','Source','Scayt' ],'/',
		[ 'Format','FontSize','Bold','Italic','Underline','TextColor','BGColor','Strike','SpecialChar'],['JustifyLeft','JustifyCenter','JustifyRight']
		];
}
function getFullCKEditorToolbar(){
	//version 4
	return [
		[ 'Source','-','Templates','Preview','Maximize' ],
		[ 'Cut','Copy','Paste','PasteText','RemoveFormat','-','Undo','Redo' ],
		[ 'Find','Replace','-','SelectAll','-','Scayt','About' ],
		'/',
		[ 'NumberedList','BulletedList','-','Outdent','Indent','-','JustifyLeft','JustifyCenter','JustifyRight','JustifyBlock' ],
		[ 'Link','Unlink','Anchor', 'Image','Table','HorizontalRule','SpecialChar','CreateDiv','ShowBlocks' ],
		'/',
		[ 'Format','FontSize' ],
		[ 'TextColor','BGColor' ],
		[ 'Bold','Italic','Underline','Strike','Subscript','Superscript' ]
		];
}

function getScayt_sLangFromLanguage(lang){
	switch(lang){
		case "en": return "en_GB";
		case "fr": return "fr_FR";
		default : return "en_GB";
	}
}

function boxChooseFile(inputBoxFileId, inputFileId, inputNameId, inputPathId, SITE_ROOT_forFileUrl){
	$(inputBoxFileId).click(function(){
		// Clears all previous callbacks
		boxSelect.unregister(boxSelect.SUCCESS_EVENT_TYPE);
		boxSelect.unregister(boxSelect.CANCEL_EVENT_TYPE);
		//Register a success callback handler
		boxSelect.success(function(response) {
			var v = $(inputNameId).parent();
			$(inputBoxFileId).hide();
			$(inputFileId).hide();
			boxSuccess(inputNameId, inputPathId, response, SITE_ROOT_forFileUrl, v);
		}); 			
		//Register a cancel callback handler
		boxSelect.cancel(function() {/*nothing to do*/});		
		//Launch the Box's File Picker
		boxSelect.launchPopup();
	});
}
function boxSuccess(inputNameId, inputPathId, response, SITE_ROOT_forFileUrl, v){
	// Shows file management buttons
	$('div.updateCurrentFile', v).show();
	$('div.removeCurrentFile', v).show();
	$('div.downloadCurrentFile', v).hide();
	// Extracts file info 
	var name = response[0].name;
	var fileId = response[0].id;
	var dotSep=name.lastIndexOf(".");
	var type='';
	var ext='';
	if(dotSep>-1) {
		ext = name.substring(dotSep+1).toLowerCase();
		type = '.'+ext;
		name = name.substring(0,dotSep);
	}	
	// Puts the ID of the file in the path as box://xxxxx
	$(inputPathId).val("box://".concat(fileId));
	// Puts the type of the file
	$(inputPathId.replace("path", "type")).val(type);
	// Hides Box file picker button
	$(this).hide();	
	// puts file name in text box and shows mime type
	$(inputNameId).val(name).show().focus().change().select();
	$('div.filePreview', v).css('background-image', 'url("'+SITE_ROOT_forFileUrl+'images/preview/prev.26.'+ext+'.png")');
	$('div.filePreview', v).show();	
}
/**
 * Callback from BoxService which updates File info for the given field of type Files
 * @param String inputFileId HTML id of field of type Files for which to update File info
 * @param String fileName file name got from Box
 * @param Numeric fileSize actual file size in bytes got from Box
 * @param String fileSizeFormatted file size expressed as a string for end user
 * @param String fileMime file MIME type got from Box
 * @param String file date got from Box in format (YYYY-MM-DD HH:MM:SS)
 * @param String fileDateFormatted file date expressed as a string for end user
 */
function boxUpdateFileInfo(inputFileId, fileName, fileType, fileMime, fileSize, fileSizeFormatted, fileDate, fileDateFormatted) {
	// Extracts formId and field name from inputFileId
	var formId = inputFileId.split('__');
	var fieldName = formId[1];
	formId = formId[0];
	// Detects if we are in edit mode
	if($('#'+inputFileId+' div.value input#'+formId+'_'+fieldName+'_path_hidden').length>0) {		
		// Updates file name
		$('#'+formId+'_'+fieldName+'_name_text').val(fileName);
		// And all hidden fields
		$('#'+formId+'_'+fieldName+'_size_hidden').val(fileSize);
		$('#'+formId+'_'+fieldName+'_type_hidden').val(fileType);
		$('#'+formId+'_'+fieldName+'_mime_hidden').val(fileMime);
		$('#'+formId+'_'+fieldName+'_date_hidden').val(fileDate);
	}
	// Or in details mode
	else {
		var fileDet = $('#'+inputFileId+' div.value.file');
		if(fileDet.length>0) {
			// if small view
			if(fileDet.find('div.fdet.small').length>0){
				// updates file name
				fileDet.find('div.fdet a.H.fileDownload').html(fileName);
				// updates file date
				fileDet.find('div.fdet font').html('('+fileSizeFormatted+', '+fileDateFormatted+')');
				// updates file size
				var e = fileDet.find('div.fdet a.fdet.fileDownload img');
				if(e.attr('title')) e.attr('title',e.attr('title').replace(/\(.*\)/g,'('+fileSizeFormatted+')'));
				e = fileDet.find('div.fdet img.checkOutIn');
				if(e.attr('title')) e.attr('title',e.attr('title').replace(/\(.*\)/g,'('+fileSizeFormatted+')'));
				
			}
			// else if normal view
			else {
				// updates file name
				fileDet.find('div.fdet a.fileDownload').html(fileName);
				// updates file date
				fileDet.find('div.fdet font').html('('+fileDateFormatted+')');
				// updates file size
				fileDet.find('a.fdet.fileDownload div span font').html('('+fileSizeFormatted+')');
			}
		}
	} 		
}
function addJsCodeOnFileInput(inputFileId, inputNameId, inputPathId, clickToBrowseAndFindANewFile, SITE_ROOT_forFileUrl){
	var v = $(inputNameId).parent();
	var inputBoxFileId = inputPathId.replace('_path_hidden','_box_hidden');
	$('div.removeCurrentFile', v).click(function(){
		var v = $(inputNameId).parent();
		$(this).hide();
		
		var w = "#".concat($(inputNameId).parent().parent().attr('id'));

		// Removes Box service tag on file removal
		if(domElementHasWigiiService(w, "box")){
			domElementRemoveWigiiService(w, "box");
		}
		// Hides file operations
		$('div.filePreview', v).hide();
		$('div.updateCurrentFile', v).hide();
		$('div.downloadCurrentFile', v).hide();
		$('div.backToFilename', v).hide();
		// Shows Box file picker button
		$(inputBoxFileId).show();
		// Shows Local file chooser
		$(inputFileId).val('').show();
		$(inputNameId).val('').hide().change().blur(); //this is important to generate autoSave feature if activated
		$(inputPathId).val('');
	});
	$('div.backToFilename', v).click(function(){
		var v = $(inputNameId).parent();
		$(this).hide();
		$('div.filePreview', v).show();
		$('div.updateCurrentFile', v).show();
		$('div.removeCurrentFile', v).show();
		$(inputFileId).hide();
		$(inputNameId).show();
	});
	$('div.updateCurrentFile', v).click(function(e){
		var v = $(inputNameId).parent();	
		if($(inputPathId).val().indexOf("box://")>=0 && window.boxSelect){
			// Clears all previous callbacks
			boxSelect.unregister(boxSelect.SUCCESS_EVENT_TYPE);
			boxSelect.unregister(boxSelect.CANCEL_EVENT_TYPE);
			//Register a success callback handler
			boxSelect.success(function(response) {
				$('div.downloadCurrentFile', v).hide();
				$('div.removeCurrentFile', v).hide();
				boxSuccess(inputNameId, inputPathId, response, SITE_ROOT_forFileUrl, v);
			}); 			
			//Register a cancel callback handler
			boxSelect.cancel(function() {/*nothing to do*/});		
			//Launch the Box's File Picker
			boxSelect.launchPopup();
			
		} else {
			$(this).hide();
			$('div.removeCurrentFile', v).show();
			$('div.filePreview', v).hide();
			$('div.backToFilename', v).show();
			$(inputNameId).hide();
			$(inputFileId).show();
			showHelp($(inputFileId), clickToBrowseAndFindANewFile, 0, 'left');
		}
	});
	$(inputFileId).click(function(){ hideHelp(); }).change(function(){
		var v = $(inputFileId).parent();
		$('div.backToFilename', v).hide();
		$('div.updateCurrentFile', v).show();
		$('div.removeCurrentFile', v).show();
		var name = $(this).val();
		name = name.substring(name.lastIndexOf('"."\\"."\\"."')+1);
		var ext = name.substring(name.lastIndexOf('.')+1);
		name = name.substring(0, name.lastIndexOf('.'));
		//remove any local path in the name
		var re = new RegExp('.*/', "g");
		name = name.replace(re, '');
		re = new RegExp('.*\\\\', "g");
		name = name.replace(re, '');
		// hides local File chooser
		$(this).hide();	
		// hides Box file picker
		$(inputBoxFileId).hide();
		// puts file name in text box and shows mime type
		$(inputNameId).val(name).show().focus().select();
		$('div.filePreview', v).css('background-image', 'url("'+SITE_ROOT_forFileUrl+'images/preview/prev.26.'+ext+'.png")');
		$('div.filePreview', v).show();
	});
	
	//make the whole field area dropable from files and not only the input
	if(!!navigator.userAgent.match(/Trident/g) || !!navigator.userAgent.match(/MSIE/g)){
		//IE do not support this code to manage file drag and drop
	} else {
		var dropContainer = document.getElementById(inputFileId.replace('#','')).parentNode.parentNode;
		dropContainer.ondragover = dropContainer.ondragenter = function(evt) {
			$(inputFileId).parent().parent().css('background-color','#ddd');
			evt.preventDefault();
		};
		dropContainer.ondragleave = dropContainer.ondragout = function(evt) {
			$(inputFileId).parent().parent().css('background-color','transparent');
			evt.preventDefault();
		};
		dropContainer.ondrop = function(evt) {
			// pretty simple -- but not for IE :(
			document.getElementById(inputFileId.replace('#','')).files = evt.dataTransfer.files;
			$(inputFileId).change();
			$(inputFileId).parent().parent().css('background-color','transparent');
			evt.preventDefault();
		};
	}
}

//DataType on-line Files
// if cancel is false, then dialog without a cancel button (only ok button).
function addJsCodeOnOnLineFileInput(textContentId, inputNameId, template, cancel, ok, SITE_ROOT_forFileUrl, newDocument, lang, height, templateFile){
	v = $(inputNameId).parent();
	$('div.removeExistingOnLineFile', v).click(function(){
		v = $(inputNameId).parent();
		$(this).hide();
		$('div.filePreview', v).hide();
		$('div.removeExistingOnLineFile', v).hide();
		$('div.updateExistingOnLineFile', v).hide();
		$('div.newOnLineFile', v).show();
		$(inputNameId).val('').hide();
		$(textContentId).val('').change().blur();  //this is important to generate autoSave feature if activated
	});

	$('div.newOnLineFile, div.updateExistingOnLineFile', v).click(function(e){
		myPosition = { my: 'center top', at: 'center top+50' };
		v = $(inputNameId).parent();
		if($(textContentId).val()==''){
			//load a default template if defined in the config
			if(template!=null){
				t = CKEDITOR.getTemplates('default').templates;
				for(i in t){
					if(t[i].title == template){
						$(textContentId).val(t[i].html);
					}
				}
			}
		}
		$('#elementPreview').html('<textarea style="width:'+($(window).width()-30)+'px;" id="elementPreview_textContent">'+$(textContentId).val().replace(/&/g,'&amp;')+'</textarea>');

		//activates link for scheduled autosave
		crtActiveOnlineFileTextContentId = textContentId;

		// displays dialog
		if( $('#elementPreview').is(':ui-dialog')) { $('#elementPreview').dialog("destroy"); }
		var btns = {ok: function(){
				// clears link for scheduled autosave
				crtActiveOnlineFileTextContentId=null;
				//$(textContentId).val($('#elementPreview_textContent').val());
				$(textContentId).val($('#elementPreview').find('textarea:first').ckeditorGet().getData()).change().blur();  //this is important to generate autoSave feature if activated
				v = $(inputNameId).parent();
				$('div.filePreview', v).css('background-image', 'url("'+SITE_ROOT_forFileUrl+'images/preview/prev.26.html.png")');
				$('div.filePreview', v).show();
				$('div.removeExistingOnLineFile', v).show();
				$('div.updateExistingOnLineFile', v).show();
				$('div.newOnLineFile', v).hide();
				if($(inputNameId).val()==null || $(inputNameId).val()==''){
					$(inputNameId).val(newDocument);
				}
				$(inputNameId).show().focus().select();
				CKEDITOR.remove($('#elementPreview').find('textarea:first').ckeditorGet());
				$(this).val('').dialog('destroy');
			}
		};
		if(cancel !== false) btns[cancel] = function(){
			//clears link for scheduled autosave
			crtActiveOnlineFileTextContentId=null;
			$(this).dialog('destroy');
		};
		$('#elementPreview').dialog({
			buttons: btns,
			width: $(window).width()-110, position: myPosition,
			closeOnEscape: false, draggable:false, resizable:false, modal:false,
			beforeClose: function(){ }
		});
		$('#elementPreview').prev().css('display', 'none');

		var editorID = 'elementPreview_textContent';
		var instance = CKEDITOR.instances[editorID];
		if (instance) { CKEDITOR.remove(instance); }
		tempZIndex = $('#elementPreview').parent().css('zIndex')+1;
		$('#elementPreview').find('textarea:first').ckeditor({
			language : lang,
			scayt_sLang : getScayt_sLangFromLanguage(lang),
			templates : crtWigiiNamespaceUrl+",default",
			templates_files : [templateFile],
			baseFloatZIndex : tempZIndex,
			toolbar : getFullCKEditorToolbar(),
			toolbarCanCollapse : true,
			toolbarStartupExpanded : true,
			resize_minWidth: $(window).width()-130,
			height:height-100,
			allowedContent: true,
		    filebrowserUploadUrl : crtWigiiNamespaceUrl+'/'+crtModuleName+'/CKEditor/upload'
		});
	});
}

var progressBarTimeout = null;
var savingBarTimeout = null;
var jsFileContentInForm = null;
function getAjaxformOption(formId){
	return {
		success: parseUpdateResult,
		beforeSerialize: function(){
			//remove disable for readonly field when submitting the form
			if($(formId+' .removeDisableOnSubmit').length>0){
				$(formId+' .removeDisableOnSubmit').removeAttr('disabled');
			}
		},
		beforeSubmit:  function(formData, jqForm, options){
			hideHelp(); setVis('busyDiv', true);
			// show long run loading bar if server side response takes more than 2 seconds
			if(savingBarTimeout==null){
				savingBarTimeout = setTimeout(function(){ 
					$("#savingBar").html(wigii().context.serverSavingWaitingMsg).show();
					// if Form has Fields linked to box-upload service, then shows Box specific waiting message
					if($(formId).wigii('FormHelper').fields("[data-wigii-service~='box-upload']").$.length) {
						var boxCtx = wigii().context.box;
						boxCtx.showBoxWaitingMsg = true;
						if(!boxCtx.waitForBoxUpload) boxCtx.waitForBoxUpload = function() {
							if(wigii().context.box.showBoxWaitingMsg) $("#savingBar").html(wigii().context.box.serverSavingWaitingMsg).show();
							else $("#savingBar").html(wigii().context.serverSavingWaitingMsg).show();
							wigii().context.box.showBoxWaitingMsg = !wigii().context.box.showBoxWaitingMsg;
							savingBarTimeout = setTimeout(wigii().context.box.waitForBoxUpload, 5000);
						};
						savingBarTimeout = setTimeout(boxCtx.waitForBoxUpload, 3500);						
					}
				}, 2000);
		    }
			//add any jsFile content in form data
			if(jsFileContentInForm){
				for(var jsFileContent in jsFileContentInForm){
					formData[formData.length] = { name: jsFileContent, value: jsFileContentInForm[jsFileContent] };
				}
				jsFileContentInForm = null;
			}
			closeAnyJsOnGoingStreams();
		},
		uploadProgress: function(event, position, total, percentComplete) {
	        $("#formProgressBar").progressbar({
		      value: percentComplete
		    });
		    //show the progress bar only if the upload operation takes more than 500 miliseconds
		    if(progressBarTimeout==null){
			    progressBarTimeout = setTimeout(function(){ $("#formProgressBar").show(); }, 500);
		    }
		    if(percentComplete>=100){
		    	setTimeout(function(){ if(progressBarTimeout){ clearTimeout(progressBarTimeout); } progressBarTimeout = null; $("#formProgressBar").hide(); },500);
		    }
	    },
		error: errorOnUpdate, cache:false };
}

//stop any on going streams (currently only audio)
//called in WigiiExecutor.js actOnCancelDialog and in WigiiForm.js getAjaxformOption
function closeAnyJsOnGoingStreams(){
	if(jsOnGoingStreams){
		for(var jsStreams in jsOnGoingStreams){
			if(typeof jsOnGoingStreams[jsStreams] == "object"){
				var audioTracks = jsOnGoingStreams[jsStreams].getAudioTracks();
				if(audioTracks){
					for(var audioTrack in audioTracks){
						audioTracks[audioTrack].stop();
					}
				}
			}
		}
		jsOnGoingStreams = null;
	}
}
var jsOnGoingStreams = null; //each audio streams are stoped if still opened will be stopped in getAjaxformOption->beforeSubmit
function addJsCodeOnFileAudioRecording(formIdFielname, audioFieldname, audioRecordingButtonId, audioRecordingSaveButtonId, continueRecordingLabel, pauseRecordingLabel, stopedRecordingLabel){
	window.AudioContext = window.AudioContext || window.webkitAudioContext;
	/*check if navigator allows MediaDevices*/
	if(navigator.mediaDevices.getUserMedia){
		var chunks = [];
		var stream = null;
		
		var onError = function(error) {
		  console.error('Error: ', error);
		};
		
		var onSuccess = function(stream){
			if(!jsOnGoingStreams){ jsOnGoingStreams = {}; }
			jsOnGoingStreams[audioFieldname] = stream;
			var audioRecorder = new MediaRecorder(stream);
			
			$('#'+audioRecordingButtonId).click(function(){ 
				if(audioRecorder.state=='inactive'){
					audioRecorder.start();
				} else if(audioRecorder.state=='paused'){
					audioRecorder.resume();
				} else if(audioRecorder.state=='recording'){
					audioRecorder.pause();
				}
				$('#'+audioRecordingSaveButtonId).show();
				if(audioRecorder.state=='recording'){
					$(this).addClass('isRecording');
					$(this).html('<img src="images/icones/tango/16x16/actions/media-playback-pause.png" style="float:left;margin-right:5px;"/>'+pauseRecordingLabel);
				} else {
					$(this).removeClass('isRecording');
					$(this).html('<img src="images/icones/tango/16x16/devices/audio-input-microphone.png" style="float:left;margin-right:5px;"/>'+continueRecordingLabel);
				}
			});
			
			$('#'+audioRecordingSaveButtonId).click(function(){ 
				if(audioRecorder.state!='inactive'){
					audioRecorder.stop();
					stream.getAudioTracks()[0].stop();
					$('#'+audioRecordingButtonId).hide();
					$(this).html('<img src="images/icones/18px/accept.png" style="float:left;margin-right:5px;"/>'+stopedRecordingLabel);
				}
			});
			
			audioRecorder.onstop = function(e) {
				/*store the audio data in a file */
				var filename = String(moment().format('YYYY-MM-DD HH:mm'))+'.ogg';
				var file = new File(chunks, filename, { 'type' : 'audio/ogg; codecs=opus'});
				/* add file information in the wigii Files subfields */
				$('#'+formIdFielname+'_name_text').val(filename.replace('.ogg',''));
				$('#'+formIdFielname+'_type_hidden').val('.ogg');
				$('#'+formIdFielname+'_size_hidden').val(file.size);
				$('#'+formIdFielname+'_path_hidden').val('');
				chunks = [];
				jsFileContentInForm[audioFieldname] = file;
			};
			
			audioRecorder.ondataavailable = function(e) {
				chunks.push(e.data);
			};
		};
		
		/*gain access to the mic*/
		try {
			navigator.mediaDevices.getUserMedia({audio: true}).then(onSuccess,onError);
		} catch (error){
			console.error('Error: ', error);
		}
	}
}

function addJsCodeAfterFormIsShown(formId, lang, templateFilter, templateFile){
	//reset any jsFileContent
	jsFileContentInForm = {};
	$(formId+' textarea.htmlArea').each(function(){
		var editorID = $(this).attr('id');
		var instance = CKEDITOR.instances[editorID];
		if (instance) { CKEDITOR.remove(instance); }
		if($(formId +' textarea.htmlArea').closest('.ui-dialog').length > 0){
			tempZIndex = $(formId+ ' textarea.htmlArea').closest('.ui-dialog').css('zIndex')+1;
		} else {
			tempZIndex = 100;
		}
		if($(this).hasClass('fullToolbarHtmlArea')){
			toolbar = getFullCKEditorToolbar();
		} else if($(this).hasClass('mediumToolbarHtmlArea')){
			toolbar = getMediumCKEditorToolbar();
		} else {
			toolbar = getBasicCKEditorToolbar();
		}
		height = 100;
		maxHeight = 450;
		options = {};
		if($(this).hasClass('wordlimit') && !$(this).hasClass('isJournal')){
			wordlimit = $(this).attr('class').match(/ wordlimit_([0-9]*) /g)[0].replace(/ wordlimit_([0-9]*) /g, '$1');
			extraPlugins = ""
			if(options.extraPlugins) extraPlugins = options.extraPlugins+',';
			extraPlugins += 'wordcount,undo';
			options = $.extend(options, {
				extraPlugins : extraPlugins,
				wordcount_limit : wordlimit,
				wordcount_format : '<span class="cke_path_item">Word count: %count% / %limit%</span>'
			});
		}
		if($(this).hasClass('difH')){
			height = $(this).height()-40;
		} else {
			extraPlugins = ""
			if(options.extraPlugins) extraPlugins = options.extraPlugins+',';
			extraPlugins += 'autogrow';
			options = $.extend(options, {
				extraPlugins : extraPlugins,
				autoGrow_minHeight : height,
				autoGrow_maxHeight : maxHeight
			});
		}

		options = $.extend({
				language : lang,
				scayt_sLang : getScayt_sLangFromLanguage(lang),
				templates : templateFilter,
				templates_files : [templateFile],
				baseFloatZIndex : tempZIndex,
				toolbar : toolbar,
				toolbarCanCollapse : true,
				toolbarStartupExpanded : $(this).hasClass('activateHtmlArea'),
				height : height,
				resize_minWidth : 50,
				allowedContent: true,
				filebrowserUploadUrl : crtWigiiNamespaceUrl+'/'+crtModuleName+'/CKEditor/upload'
			}, options);

		$(this).ckeditor(
			function(){
				t = $('#'+this.element.getId());
				if(t.hasClass('collapsed')){
					t.next().hide();
				}
				this.on('focus', function() {
					//$(this.element.$).focus();
					//crtActiveCKEditor = this.element.$;
					$(this.element.$).triggerHandler('focus');
				});
				//this event is then fired on the textarea it self. This allow autoSave to be trigged on blur
				this.on('blur', function() {
					$(this.element.$).blur();
				});
			}, options);
		
		$(window).resize();
		
		//instance = $(this).ckeditorGet();
//		instance.on('keydown', function(){ l = $(this).closest('div.field').find('.label'); if(l.find(':input:first').length){ l.find(':input:first').attr('checked',true); } });
	});

	autosize($(formId+' textarea:not(.noWrap):not(.noElastic)').css('max-height',450).css('min-height',30));

	$(formId+' textarea.noWrap').css('overflow','auto').tabby();
	$(formId+' :input:enabled:not([readonly]):first').focus();
	
	/*
	 * CWE 2015.06.18: switches chosen and flex plugin to select2 plugin to improve rendering performances and functionalities
	 */	
	$('select.flex, select.chosen',formId).each(function(i) {
		var current = $(this);
		var attrPlaceholder = $.trim(current.attr('data-placeholder')) || false;
		var maxSelection = current.attr("data-max-selection") || false;
		//create options for the creation of select2 list
		var options = {};
		if(attrPlaceholder != false && attrPlaceholder.length>0) {
			if(current.hasClass('flex')) options.allowClear = true;
			options.placeholder = attrPlaceholder;
		}		
		if(maxSelection != false && current.hasClass('chosen')) options.maximumSelectionLength = maxSelection;
		if(current.hasClass('allowNewValues')) options.tags = [];
		// CWE 11.10.2018 if displayDBValue then shows db value instead of label, but keeps label in search/drop-down
		if(current.hasClass('displayDBValue')) options.templateSelection = function(data){return data.id;};
		
		// Medair (CWE) 08.02.2018: add support of ajax data sources
		var attributeMatchExp = current.attr("data-attributematchexp") || false;
		if(attributeMatchExp) {
			// configures the ajax object for select2
			options.ajax = {
				url:function(params) {
					return encodeURI(SITE_ROOT+"useContext/"+crtContextId+EXEC_requestSeparator+crtWigiiNamespaceUrl+"/"+crtModuleName+"/fx/"+attributeMatchExp+"/"+params.term);
				},
				data:function(params){},
				dataType:"json",			
				delay: Number(current.attr("data-querydelay")) || 250,
				error: wigii().defaultFxErrorHandler
			};
			options.minimumInputLength= Number(current.attr("data-queryminlength")) || 1;
			options.selectId = current.attr('id');
			options.dataAdapter = $.fn.select2.amd.require('select2/data/wigiiAjaxAdapter');
		}
		current.select2(options);
	});
	
	$(formId+' textarea:not(.htmlArea,.isJournal).wordlimit').each(function(){ $(this).wordlimit({ allowed: $(this).attr('class').match(/ wordlimit_([0-9]*) /g)[0].replace(/ wordlimit_([0-9]*) /g, '$1') }); });

	/* deprecated code working with colorpicker plugin, depracted on the 22.03.2018 and replace by spectrum
	$(formId+' .colorPickerInput:input:enabled:not([readonly])').ColorPicker({
		onSubmit: function(hsb, hex, rgb, el) {
			$(el).val(hex);
			$(el).ColorPickerHide();
		},
		onBeforeShow: function () {
			$(this).ColorPickerSetColor(this.value);
		}
	})
	.bind('keyup', function(){
		$(this).ColorPickerSetColor(this.value);
	});
	*/
	$(formId+' .colorPickerInput:input:enabled:not([readonly])').spectrum({
		preferredFormat: "hex",
		chooseText: DIALOG_okLabel,
		cancelText: DIALOG_cancelLabel,
		allowEmpty:true,
	    showInput: true,
	    showPalette: true,
	    maxPaletteSize: 10,
	    maxSelectionSize: 10,
	    localStorageKey: "spectrum."+crtWigiiNamespaceUrl,
	    palette: [
	        ["rgb(0, 0, 0)", "rgb(67, 67, 67)", "rgb(102, 102, 102)", "rgb(153, 153, 153)","rgb(183, 183, 183)",
	        "rgb(204, 204, 204)", "rgb(217, 217, 217)", "rgb(239, 239, 239)", "rgb(243, 243, 243)", "rgb(255, 255, 255)"],
	        ["rgb(152, 0, 0)", "rgb(255, 0, 0)", "rgb(255, 153, 0)", "rgb(255, 255, 0)", "rgb(0, 255, 0)",
	        "rgb(0, 255, 255)", "rgb(74, 134, 232)", "rgb(0, 0, 255)", "rgb(153, 0, 255)", "rgb(255, 0, 255)"],
	        ["rgb(230, 184, 175)", "rgb(244, 204, 204)", "rgb(252, 229, 205)", "rgb(255, 242, 204)", "rgb(217, 234, 211)",
	        "rgb(208, 224, 227)", "rgb(201, 218, 248)", "rgb(207, 226, 243)", "rgb(217, 210, 233)", "rgb(234, 209, 220)"],
	        ["rgb(221, 126, 107)", "rgb(234, 153, 153)", "rgb(249, 203, 156)", "rgb(255, 229, 153)", "rgb(182, 215, 168)",
	        "rgb(162, 196, 201)", "rgb(164, 194, 244)", "rgb(159, 197, 232)", "rgb(180, 167, 214)", "rgb(213, 166, 189)"],
	        ["rgb(204, 65, 37)", "rgb(224, 102, 102)", "rgb(246, 178, 107)", "rgb(255, 217, 102)", "rgb(147, 196, 125)",
	        "rgb(118, 165, 175)", "rgb(109, 158, 235)", "rgb(111, 168, 220)", "rgb(142, 124, 195)", "rgb(194, 123, 160)"],
	        ["rgb(166, 28, 0)", "rgb(204, 0, 0)", "rgb(230, 145, 56)", "rgb(241, 194, 50)", "rgb(106, 168, 79)",
	        "rgb(69, 129, 142)", "rgb(60, 120, 216)", "rgb(61, 133, 198)", "rgb(103, 78, 167)", "rgb(166, 77, 121)"],
	        ["rgb(133, 32, 12)", "rgb(153, 0, 0)", "rgb(180, 95, 6)", "rgb(191, 144, 0)", "rgb(56, 118, 29)",
	        "rgb(19, 79, 92)", "rgb(17, 85, 204)", "rgb(11, 83, 148)", "rgb(53, 28, 117)", "rgb(116, 27, 71)"],
	        ["rgb(91, 15, 0)", "rgb(102, 0, 0)", "rgb(120, 63, 4)", "rgb(127, 96, 0)", "rgb(39, 78, 19)",
	        "rgb(12, 52, 61)", "rgb(28, 69, 135)", "rgb(7, 55, 99)", "rgb(32, 18, 77)", "rgb(76, 17, 48)"]
	    ]
    });

	$(formId).ajaxForm(getAjaxformOption(formId));

	$(formId+' div.label').click(function(){ $(':input:visible:first', $(this).next()).select(); } );
	$(formId+' .addC').nextAll().hide();
	$(formId+' .addC').click(function(){
		$(this).hide();
		//show the field
		$(this).next().show();
		//add Date management
		$(this).next().children('.ui-datepicker-trigger').show();
		//tabs management
		$(this).next().children('.ui-tabs').show();
		//htmlArea management
		$(this).next().children('.cke').show();
		//add a width of 100% to label
        $(this).prev().css('width', '100%');
		//.find('>:not(.timeZone)').show();
		$(this).next().find(':input:first').focus();
	});
	//resize the date picker
	if($(formId+' .ui-datepicker-trigger').length){ $(formId+' .ui-datepicker-trigger').css("width", "30px"); }
	//add code for multiple select
	$(formId+' select[multiple]:not([readonly]):not([disabled])').click(function(){ multipleSelectOnClick(this.id); }).each(function(){
		multipleSelectVals[this.id] = $(this).val();
	});
	
	//handle the data-max-selection on checkboxes
	$( '*:input:checkbox[data-max-selection]' ).click(function( event ) {
		var maxSelectionValue = event.target.dataset.maxSelection;
		if(maxSelectionValue > 0) {
			var valueDiv = $(event.target).parent().parent();
			$(valueDiv).find('span[class="max-selection-alert"]').remove();
			if($(valueDiv).find(':checkbox:checked').length >= maxSelectionValue) {
				if ($(valueDiv).find(':checkbox:checked').length > maxSelectionValue) $(event.target).attr('checked', false);
				$(valueDiv).find(':checkbox:not(:checked)').attr("disabled", true);
				$(valueDiv).append('<span class="max-selection-alert" style="color:DarkGray">You can only select '+maxSelectionValue+' items</span>');
			} else {
				$(valueDiv).find(':checkbox:not(:checked)').attr("disabled", false);
			}
		}
	});

	//show Sysinfo on mouse over + CTRL
	$(formId+' div.field .label').bind('contextmenu', function(e){
		$(this).parent().find(">.addinfo").show();
		return false;
	});
	$(formId+' div.field').mouseleave(function(e){
		$(this).find(".addinfo").hide();
	});
	if(isWorkzoneViewDocked()) addScrollWithShadow($(formId).parent().prop("id"));	
}

function convertTimestamps(obj){
	//advanced search: match any TIMESTAMP() and convert them into a real timestamp
	orignalText = $(obj).val();
	res = orignalText.match(/TIMESTAMP\(([0-9]{4}\-[0-9]{2}\-[0-9]{2}[ \:0-9]*)\)/gi);
	for(r in res){
		d = new Date(res[r].replace("TIMESTAMP", "").replace("(", "").replace(")", "").replace(/-/g, "/"));
		orignalText = orignalText.replace(res[r], Math.round(d.getTime()/1000));
	}
	$(obj).val(orignalText);
}

emailingFormCrtMergeField = "";
function setListenerForEmailMerge(formId){
	$("#"+formId+" #Emailing_form__message>.label span").click(function(e){
		clone = $(this).clone();
		clone.css("position", "absolute");
		clone.css("z-index", "999999999");
		clone.offset({left: $(this).position().left+10, top: $(this).position().top+10});
		emailingFormCrtMergeField = clone.attr("title");
		crtOverSubject = false;
		$("#"+formId+"").mousemove(function(e) {
			clone.offset({left: e.pageX+10, top: e.pageY+10});
		});
		$("#"+formId+" #Emailing_form_object_value_text").mouseenter(function(){ crtOverSubject = true; });
		$("#"+formId+" #Emailing_form_object_value_text").mouseleave(function(){ crtOverSubject = false; });
		e.stopPropagation();
		$("#"+formId+"").one("click", function(){
			clone.remove();
			if($("#"+formId+" #Emailing_form_object_value_text:focus").length){
				$("#"+formId+" #Emailing_form_object_value_text").val($("#"+formId+" #Emailing_form_object_value_text").val()+emailingFormCrtMergeField);
			}
			emailingFormCrtMergeField = null;
			$("#cke_Emailing_form_message_value_textarea iframe").contents().find("body").unbind("click");
		});
		$("#cke_Emailing_form_message_value_textarea iframe").contents().find("body").one("click", function(){
			clone.remove();
			ckInst = CKEDITOR.instances["Emailing_form_message_value_textarea"];
			ckInst.insertHtml(emailingFormCrtMergeField);
			$("#"+formId+"").unbind("click");
			emailingFormCrtMergeField = null;
		});
		$("#"+formId+" #Emailing_form__message>.label").append(clone);
	});
}

confirmationEmailFormCrtMergeField = "";
function setListenerForConfirmationEmailMerge(formId){
	$("#groupSubscription_form__subscriptionConfEmailText>.label span").click(function(e){
		clone = $(this).clone();
		clone.css("position", "absolute");
		clone.css("z-index", "999999999");
		clone.offset({left: $(this).position().left+10, top: $(this).position().top+10});
		confirmationEmailFormCrtMergeField = clone.attr("title");
		crtOverSubject = false;
		$("#"+formId+"").mousemove(function(e) {
			clone.offset({left: e.pageX+10, top: e.pageY+10});
		});
		$("#groupSubscription_form_subscriptionConfEmailSubject_tabs input").mouseenter(function(){ crtOverSubject = true; });
		$("#groupSubscription_form_subscriptionConfEmailSubject_tabs input").mouseleave(function(){ crtOverSubject = false; });
		e.stopPropagation();
		$("#"+formId+"").one("click", function(){
			clone.remove();
			if($("#groupSubscription_form_subscriptionConfEmailSubject_tabs input:focus").length){
				$("#groupSubscription_form_subscriptionConfEmailSubject_tabs input:focus").val($("#groupSubscription_form_subscriptionConfEmailSubject_tabs input:focus").val()+confirmationEmailFormCrtMergeField);
			}
			confirmationEmailFormCrtMergeField = null;
			$("#cke_groupSubscription_form_subscriptionConfEmailText_value_l01_textarea iframe").contents().find("body").unbind("click");
			$("#cke_groupSubscription_form_subscriptionConfEmailText_value_l02_textarea iframe").contents().find("body").unbind("click");
		});
		$("#cke_groupSubscription_form_subscriptionConfEmailText_value_l01_textarea iframe").contents().find("body").one("click", function(){
			clone.remove();
			ckInst = CKEDITOR.instances["groupSubscription_form_subscriptionConfEmailText_value_l01_textarea"];
			ckInst.insertHtml(confirmationEmailFormCrtMergeField);
			$("#"+formId+"").unbind("click");
			confirmationEmailFormCrtMergeField = null;
		});
		$("#cke_groupSubscription_form_subscriptionConfEmailText_value_l02_textarea iframe").contents().find("body").one("click", function(){
			clone.remove();
			ckInst = CKEDITOR.instances["groupSubscription_form_subscriptionConfEmailText_value_l02_textarea"];
			ckInst.insertHtml(confirmationEmailFormCrtMergeField);
			$("#"+formId+"").unbind("click");
			confirmationEmailFormCrtMergeField = null;
		});
		$("#groupSubscription_form__subscriptionConfEmailText>.label").append(clone);
	});
}

function actOnDisplayOnRightSide(elementDialogId, fieldId, journalItemWidth, totalWidth){
	if($('#elementRightSide').length==0){
		//create elementRightSide
		if($('#'+elementDialogId+' .elementDetail').length){
			//if in detail mode
			$('#'+elementDialogId+' .elementDetail').wrapInner('<div class="center" />');
			$('#'+elementDialogId+' .elementDetail').prepend('<table style="border:none;border-collapse:collapse;margin:0px;padding:0px;"><tr><td valign="top" class="center"></td><td valign="top" class="right"></td></tr></table>');
			$('#'+elementDialogId+' .elementDetail td.center').append($('#'+elementDialogId+' .elementDetail div.center'));
			$('#'+elementDialogId+' .elementDetail td.right').append('<div style="float:left;border-width:1px;padding:5px;width:'+(journalItemWidth)+'px;text-align:left;" id="elementRightSide" class="Tcolor"></div>');
			$('#'+elementDialogId+' .elementDetail>table td.center').width(totalWidth+22);
			$('#'+elementDialogId+'').closest('.ui-dialog').width(totalWidth+journalItemWidth+32);
			$('#'+elementDialogId+'>div.T').width(totalWidth+journalItemWidth+31);
			if($('#'+elementDialogId+'').closest('.ui-dialog').position()) $('#'+elementDialogId+'').closest('.ui-dialog').css('left', Math.min($('#'+elementDialogId+'').closest('.ui-dialog').position().left, $(window).width()-$('#'+elementDialogId+'').closest('.ui-dialog').outerWidth()-5));
//			$('#'+elementDialogId+' .elementDetail').before('<div style="position:fixed;margin-top:-50px;margin-left:'+(totalWidth+19)+'px;border-width:2px;padding:5px;width:'+(journalItemWidth+20)+'px;background-color:#fff;" id="elementRightSide" class="SBIB ui-corner-all"></div>');
		} else if($('#mainDiv .elementDetail').length){
			//in print mode
			$('#mainDiv .elementDetail').wrapInner('<div class="center" />');
			$('#mainDiv .elementDetail').prepend('<table style="border:none;border-collapse:collapse;margin:0px;padding:0px;"><tr><td valign="top" class="center"></td><td valign="top" class="right"></td></tr></table>');
			$('#mainDiv .elementDetail td.center').append($('#mainDiv .elementDetail div.center'));
			$('#mainDiv .elementDetail td.right').append('<div style="float:left;border-width:1px;padding:5px;width:'+(journalItemWidth)+'px;text-align:left;" id="elementRightSide" class="Tcolor"></div>');
			$('#mainDiv .elementDetail>table td.center').width(totalWidth+22);
//			$('#mainDiv .elementDetail').before('<div style="position:absolute;margin-left:'+(totalWidth+19)+'px;border-width:1px;padding:5px;width:'+(journalItemWidth+20)+'px;background-color:#fff;" id="elementRightSide" class="BSB ui-corner-all"></div>');
		} else if($('#mainDiv .public form').length){
			//external edit
			$('#mainDiv .public form').wrapInner('<div class="center" />');
			$('#mainDiv .public form').prepend('<table style="border:none;border-collapse:collapse;margin:0px;padding:0px;"><tr><td valign="top" class="center"></td><td valign="top" class="right"></td></tr></table>');
			$('#mainDiv .public form td.center').append($('#mainDiv .public form div.center'));
			$('#mainDiv .public form td.right').append('<div style="float:left;border-width:1px;padding:5px;width:'+(journalItemWidth)+'px;text-align:left;" id="elementRightSide" class="Tcolor"></div>');
			$('#mainDiv .public form>table td.center').width(totalWidth+22);
			$('#mainDiv .public form').width(totalWidth+journalItemWidth+32);
			$('#mainDiv .public').width(totalWidth+journalItemWidth+32);
			$('#mainDiv .public form>table').after($('#mainDiv .public form>table td.center>div.center>div.publicFormBorder'));
			$('#mainDiv .public form>div.publicFormBorder').width(totalWidth+journalItemWidth+32);
		} else if($('#mainDiv .public').length){
			//external view
			$('#mainDiv .public').wrapInner('<div class="center" />');
			$('#mainDiv .public').prepend('<table style="border:none;border-collapse:collapse;margin:0px;padding:0px;"><tr><td valign="top" class="center"></td><td valign="top" class="right"></td></tr></table>');
			$('#mainDiv .public td.center').append($('#mainDiv .public div.center'));
			$('#mainDiv .public td.right').append('<div style="float:left;border-width:1px;padding:5px;width:'+(journalItemWidth)+'px;text-align:left;" id="elementRightSide" class="Tcolor"></div>');
			$('#mainDiv .public>table td.center').width(totalWidth+22);
			$('#mainDiv .public').width(totalWidth+journalItemWidth+32);
			$('#mainDiv .public>table').after($('#mainDiv .public>table td.center>div.center>div.publicFormBorder'));
			$('#mainDiv .public>div.publicFormBorder').width(totalWidth+journalItemWidth+32);
		} else if($('#'+elementDialogId+' form').length){
			//in form mode
			$('#'+elementDialogId+' form').wrapInner('<div class="center" />');
			$('#'+elementDialogId+' form').prepend('<table style="border:none;border-collapse:collapse;margin:0px;padding:0px;"><tr><td valign="top" class="center"></td><td valign="top" class="right"></td></tr></table>');
			$('#'+elementDialogId+' form td.center').append($('#'+elementDialogId+' form div.center'));
			$('#'+elementDialogId+' form td.right').append('<div style="float:left;border-width:1px;padding:5px;width:'+(journalItemWidth)+'px;text-align:left;" id="elementRightSide" class="Tcolor"></div>');
			$('#'+elementDialogId+' form>table td.center').width(totalWidth+12);
			$('#'+elementDialogId+' form').width(totalWidth+journalItemWidth+32);
			$('#'+elementDialogId+'').closest('.ui-dialog').width(totalWidth+journalItemWidth+37);
			if($('#'+elementDialogId+'').closest('.ui-dialog').position()) $('#'+elementDialogId+'').closest('.ui-dialog').css('left', Math.min($('#'+elementDialogId+'').closest('.ui-dialog').position().left, $(window).width()-$('#'+elementDialogId+'').closest('.ui-dialog').outerWidth()-5));
//			$('#'+elementDialogId+' form').wrapInner('<div class="center" />');
//			$('#'+elementDialogId+' form>.center').before('<div style="position:fixed;margin-left:'+(totalWidth+12)+'px;border-width:2px;padding:5px;width:'+(journalItemWidth+20)+'px;background-color:#fff;" id="elementRightSide" class="SBIB ui-corner-all"></div>');
            $('#'+elementDialogId).ready(function(){
                var width = $('.ui-dialog').width()+20;
                $('.ui-dialog').css('width', width);
            });
		} else {
			return;
		}
	}

	$('#'+fieldId)
		.width(journalItemWidth)
		.find('div.label').width(journalItemWidth)
		.next().width(journalItemWidth)
		;
	if($('#'+fieldId+' div.value>div').length){
		$('#'+fieldId+' div.value>div').width(journalItemWidth);
	}

	$('#elementRightSide').append($('#'+fieldId));

	$('#elementRightSide .label').css("font-weight", "bold");
	$('#elementRightSide .field:gt(0)').css('border-top','solid 2px #fff').css('margin-top','5px');
	//add max height only in
	if($('#'+elementDialogId+' .elementDetail').length){
		//if in detail view or in external view then add max-height
		$('#elementRightSide div.value').css('max-height', ((($('.elementDetail table td.center>div.center').height()) / $('#elementRightSide div.value').length)-30)+'px').css('overflow-y','scroll');
	}
	if($('#mainDiv .public').length && $('#mainDiv .public form').length==0){
		$('#elementRightSide div.value').css('max-height', ((($('#mainDiv .public table td.center>div.center').height()) / $('#elementRightSide div.value').length)-30)+'px').css('overflow-y','scroll');
	}

	//Remove max-width
	$('.ui-dialog').css('max-width', '');

//	$('#elementRightSide').unbind('load').bind('load', function(){
//		alert($(this).find('.value').length);
//		$(this).find('.value').css('max-height', ($(window).height()-$(this).position().top) / $(this).find('.value').length).css('overflow-y','scroll');
//	});

//	if(dialogPos['elementDialog']==null){
//		dialogPos['elementDialog'] = new Array();
//		dialogPos['elementDialog'][0] = Math.max(0, $(window).width()-totalWidth-journalItemWidth-50);
//	}
//	dialogPos['elementDialog'][0] = Math.min(0, journalItemWidth+50, dialogPos['elementDialog'][0]);
//	dialogPos['elementDialog'][1] = dialogPos['elementDialog'][1];

}

// Displays a waiting message on file download
function messageDownload(fieldId){
	if(domElementHasWigiiService('#'+fieldId, 'box')) {
		$('#fileDownloadingBar').html(wigii().context.box.fileDownloadingWaitingMsg);
		setVis('fileDownloadingBar', true);	
	}
	else {
		$('#fileDownloadingBar').html(wigii().context.fileDownloadingWaitingMsg);
		/* doesn't show fileDownloadingBar by default, but still restores default message inside */
	}
}

function setListenerToDownloadFile(fieldId, fieldName, src){
	$('#'+fieldId+' .fileDownload').click(function(e){
		messageDownload(fieldId);
		if(domElementHasWigiiService('#'+fieldId, 'box')) setTimeout(function() {setVis('fileDownloadingBar', false);}, 5000); // time out to hide fileDownloadingBar
		e.stopPropagation();
		download(src);
		return false; //if the click is on a link, prevent the link adress to be executed
	});
}
function setListenerToPreviewFile(fieldId, fieldName, src, time){
	$('#'+fieldId+' .value .imgPreview').click(function(e){
		previewImage(src, time);
		messageDownload(fieldId);
		e.stopPropagation();
	});
	$('#'+fieldId+' .value .htmlPreview').click(function(e){
		previewHtml(src, time);
		messageDownload(fieldId);
		e.stopPropagation();
	});
}
function setListenerToUnzipForViewing(fieldId, fieldName, src, time){
	$('#'+fieldId+' .value .htmlPreview').click(function(e){
		previewUnzipForViewing(src, time);
		e.stopPropagation();
	});
}

function setListenerToAddJournalItem(elementDialogId, recordId, fieldName, fieldId, crtLanguage, isHtmlArea, newJournalItemString, okLabel, cancelLabel, urlAction, newJournalContentStringCode){
	//if no elementDialogId that means we are looking at the item directly in the mainDiv
	if(elementDialogId==""){
		elementDialogId="mainDiv";
	}
	//remove the add comment button in case the dialog is readOnly
	//except if allowReadOnly is setup for this field
	if(!$('#'+fieldId+'').hasClass("allowOnReadOnly") && (($('#'+elementDialogId+'>.elementDetail').length==1 && $('#'+elementDialogId+' div.T div.el_edit').length==0) || $('#'+fieldId+'.readOnly').length>0)){
		$('#'+fieldId+' div.label span').remove();
		$('#'+fieldId+' div.label').text($('#'+fieldId+' div.label').text().replace("(", "").replace(")", ""));
		return;
	}
	$('#'+fieldId+' div.label span.addJournalItem').click(function(e){
		emb = $(this);//$('#'+fieldId+' div.label span');
		$(emb).parent().find('.addJournalItemMenu').remove();
		$(emb).after('<div class="addJournalItemMenu SBB ui-corner-all" style="z-index:999999;position:fixed;font-weight:normal;background-color:#fff;top:'+(Math.min(e.pageY-$(window).scrollTop(), $(window).height()-350))+'px; left:'+(Math.min(e.pageX-$(window).scrollLeft(), $(window).width()-420))+'px; padding:5px; " >'+
				'<span class="label" style="float:left;margin-top:5px; margin-bottom:5px;width:400px;" >'+$(emb).parent().text().replace(/\(.*\)/, '')+'</span><div class="clear"></div>'+
				'<textarea id="'+fieldId+'_addJournalItem" style="margin-top:5px; margin-bottom:5px;width:400px;" class="elastic" >'+'</textarea>'+
				'<br />'+
				'<input type="button" name="ok" value="'+okLabel+'" />'+
				'<input type="button" name="cancel" value="'+cancelLabel+'" />'+
			'</div>');
		if(isHtmlArea){
			options = {};
			//in case of a form dialog
			if($('#'+fieldId+' div.value textarea').hasClass('wordlimit')){
				wordlimit = $('#'+fieldId+' div.value textarea').attr('class').match(/ wordlimit_([0-9]*) /g)[0].replace(/ wordlimit_([0-9]*) /g, '$1');
				options = $.extend({
					extraPlugins : 'wordcount,undo',
					wordcount_limit : wordlimit,
					wordcount_format : '<span class="cke_path_item">Word count: %count% / %limit%</span>'
				}, options);
			} else if($('#'+fieldId+'').hasClass('wordlimit')){ //if from a detail dialog
				wordlimit = $('#'+fieldId+'').attr('class').match(/ wordlimit_([0-9]*) /g)[0].replace(/ wordlimit_([0-9]*) /g, '$1');
				options = $.extend({
					extraPlugins : 'wordcount,undo',
					wordcount_limit : wordlimit,
					wordcount_format : '<span class="cke_path_item">Word count: %count% / %limit%</span>'
				}, options);
			}
			options = $.extend({
				language : crtLanguage,
				scayt_sLang : getScayt_sLangFromLanguage(crtLanguage),
				baseFloatZIndex : $(this).closest('.ui-dialog').css('zIndex')+1,
				toolbar : getBasicCKEditorToolbar(),
				toolbarCanCollapse : true,
				toolbarStartupExpanded : $(emb).parent().parent().find('.activateHtmlArea').length>0,
				width : 400,
				height : 200,
				resize_minWidth : 50,
				startupFocus: true,
				allowedContent: true,
				filebrowserUploadUrl : crtWigiiNamespaceUrl+'/'+crtModuleName+'/CKEditor/upload'
			}, options);

			$(emb).parent().find('.elastic').ckeditor(function(){ }, options);

		} else {
			autosize($(emb).parent().find('.elastic').css('max-height',450).css('min-height',30));
			if($(emb).parent().parent().find('.value textarea').hasClass('wordlimit')){ //in case of a form dialog
				$(emb).parent().find('.elastic').wordlimit({ allowed: $(emb).parent().parent().find('.value textarea').attr('class').match(/ wordlimit_([0-9]*) /g)[0].replace(/ wordlimit_([0-9]*) /g, '$1') });
			} else if($(emb).parent().parent().hasClass('wordlimit')){ //if from a detail dialog
				$(emb).parent().find('.elastic').wordlimit({ allowed: $(emb).parent().parent().attr('class').match(/ wordlimit_([0-9]*) /g)[0].replace(/ wordlimit_([0-9]*) /g, '$1') });
			}
			$(emb).parent().find('.elastic').focus();
		}
		$(emb).next().click(function(e){ e.stopPropagation(); return false; });
		$('.addJournalItemMenu input[type="button"]:input[name="cancel"]', $(emb).parent()).click(function(){
			$(this).parent().hide();
		});
		$('.addJournalItemMenu input[type="button"]:input[name="ok"]', $(emb).parent()).click(function(){
			$(this).parent().hide();

			if(urlAction){
				//external access: 'confirmationDialog/'+crtWigiiNamespaceUrl+'/'+crtModuleName+'/externalAccess/'+crtExternalAccessCode+'/addJournalItem/'+recordId+'/';
				//standard access: 'confirmationDialog/'+crtWigiiNamespaceUrl+'/'+crtModuleName+'/element/addJournalItem/'+recordId+'/';
				url = SITE_ROOT +'Update/'+crtContextId+EXEC_requestSeparator+ urlAction;
						var myAjax = new jQuery.ajax({
							type: 'POST',
							url: encodeURI(url),
							success : parseUpdateResult,
							cache:false,
							data: {
								addJournalItemMessage: newJournalItemString.replace(newJournalContentStringCode, $(this).parent().find('textarea').val()),
								elementId: recordId,
								journalFieldName: fieldName,
								elementDialogId: elementDialogId
							},
							error: errorOnUpdate
						});
			} else { //in modify mode, update the textarea
				$('#'+fieldId+' div.value textarea').val(newJournalItemString.replace(newJournalContentStringCode, $(this).parent().find('textarea').val()).replace(/\\n/g, "\n").replace("style=&quot;",'style="').replace("&quot;>",'">')+$('#'+fieldId+' div.value textarea').val());
				if(!isHtmlArea){
					$('#'+fieldId+' div.value textarea').change().blur();
				} else {
//					$('#'+fieldId+' div.value textarea').ckeditorGet().setData(newJournalItemString.replace(newJournalContentStringCode, $(this).parent().find('textarea').val()).replace(/\\n/g, "\n")+$('#'+fieldId+' div.value textarea').val());
//					$('#'+fieldId+' div.value textarea').ckeditorGet().updateElement();
					$('#'+fieldId+' div.value textarea').blur();
				}
			}
		});
		$(emb).next().draggable({ handle:".label" });
		//prevent selecting the textarea content as normally when clicking on label
		e.stopPropagation();
		return false;
	});
}

function setListenerToPreviousVersions(inputPathId, areYouSure){
	$('#'+inputPathId).parent().find('a.previousVersion').mouseenter(function(){
		$(this).parent().find('.deletePreviousVersion').stop().remove();
		$(this).append('<span class=\"deletePreviousVersion\" style=\"font-size:11px;padding:5px;margin-top:-8px;margin-right:-5px;margin-left:0px;cursor:pointer;display:none;\">x</span>');
		$('.deletePreviousVersion', this).show().click(function(e){
			var vToDel = $('#'+inputPathId).parent().find('a.previousVersion:has(span.deletePreviousVersion)');
			jYescancel(areYouSure+':<br /><br />'+$(this).parent().find('span.H').text(), null, function(check){
				if(check===true){
					//click on Ok button
					eval(vToDel.attr('href').replace('javascript:download(\''+SITE_ROOT.replace('//', '\/\/'),'update(\'NoAnswer/').replace('previousVersion', 'deletePreviousVersion'));
					vToDel.fadeOut(800, function(){ vToDel.remove(); });
				} else if(check===null){
					//do nothing and cancel current action
				}
			});
			e.stopPropagation();
			return false;
		});
	}).mouseleave(function(){
		$('.deletePreviousVersion', this).stop().fadeOut(500, function(){ $(this).remove(); });
	});
}
function setListenerToEmailExternalCode(
	elementDialogId,
	emailManageButtonId,
	proofKey,
	proofStatus,
	externalCodeExternalAccess,
	externalAccessEndDate,
	options,
	crtLanguage,
	recordId,
	fieldName,
	email
	){

	//if no elementDialogId that means we are looking at the item directly in the mainDiv
	if(elementDialogId==""){
		elementDialogId="mainDiv";
	}
	$('#'+emailManageButtonId+'').click(function(){
		setVis("busyDiv", true);
		//call server to load html code:
		url = SITE_ROOT +"Update/"+crtContextId+EXEC_requestSeparator+ "emailExternalCodeMenu/"+crtWigiiNamespaceUrl+"/"+crtModuleName+"/getExternalAccessMenuContent";
		var myAjax = new jQuery.ajax({
				type: 'POST',
				url: encodeURI(url),
				success : function(returnText, textStatus){

	otherRequest = returnText.split(EXEC_answerRequestSeparator);
	returnText = otherRequest[0].split(EXEC_answerParamSeparator);
	otherRequest.shift();
	i=1

	externalAccessMenusendEmailTitle = returnText[i++];
	externalAccessMenuEndDate = returnText[i++];
	okLabel = returnText[i++];
	cancelLabel = returnText[i++];
	subjectLabel = returnText[i++];
	helloBaseText = returnText[i++];
	helloBaseSubject = returnText[i++];
	validationEmailHtml = returnText[i++];
	validationEmailSubject = returnText[i++];
	externalAccessViewEmailHtml = returnText[i++];
	externalAccessViewEmailSubject = returnText[i++];
	externalAccessEditEmailHtml = returnText[i++];
	externalAccessEditEmailSubject = returnText[i++];
	areYouSureToStopExternalAccess = returnText[i++];

	emb = $('#'+emailManageButtonId+'');
	$(emb).parent().find('.externalAccessMenu').remove();
	$(emb).after('<div class="externalAccessMenu SBB ui-corner-all" style="font-weight:normal;background-color:#fff;top:'+(parseInt($(emb).position().top)+parseInt($(emb).outerHeight()))+'px; left:'+($(emb).position().left-170)+'px; padding:5px; position:absolute;" >'+
		'<div style="width:380px;font-weight:bold;">'+externalAccessMenusendEmailTitle+'</div>'+
			options +
			'<div class="endDate" style="cursor:pointer;margin-bottom:5px;margin-top:5px;"><span class="endDate" style="cursor:pointer;margin-right:5px;" onclick="$(this).next().focus();">'+externalAccessMenuEndDate+'</span><input class="endDate" type="text" name="externalAccessEndDate" value="'+externalAccessEndDate+'" /></div>'+
			'<hr class="SBB">'+
			'<span class="grayFont subject" style="display:none;">'+subjectLabel+'&nbsp;</span><input class="subject" type="text" name="subject" value="" style="display:none;margin-top:0px; margin-bottom:5px;" />'+
			'<textarea style="display:none;margin-top:5px; margin-bottom:5px;" class="elastic"></textarea>'+
			'<br />'+
			'<input type="button" name="ok" disabled="on" value="'+okLabel+'" />'+
			'<input type="button" name="cancel" value="'+cancelLabel+'" />'+
		'</div>');
	externalTempCode = null;
	//resize subject input
	$(emb).parent().find('input.subject').width(395-$(emb).parent().find('span.subject').width());

	//hide externalaccess view and edit if element is readOnly	
	if((!isWorkzoneViewDocked() && $('#'+elementDialogId+' div.T div.el_edit').length==0) || (isWorkzoneViewDocked() && $('#searchBar .middleBox div.T div.el_edit').length==0)){
		$('.externalAccessMenu input[value="externalAccessMenuViewLink"]').hide().next().hide().next().hide();
		$('.externalAccessMenu input[value="externalAccessMenuEditLink"]').hide().next().hide().next().hide();
		$('.externalAccessMenu input[value="externalAccessMenuStop"]').hide().next().hide().next().hide();
		$('.externalAccessMenu input[value="externalAccessMenuValidationLink"]').hide().next().hide().next().hide();
	}


	$(emb).parent().find('.endDate').hide();
	$(emb).next().find('input[type="radio"]').click(function(){
		$(this).attr('checked', true);
		$(this).parent().find('input[type="button"]:input[name="ok"]').removeAttr('disabled');
		showCkEditor = false;
		showEndDate = false;
		switch($(this).val()){
			case 'externalAccessMenusendEmail':
				$(this).parent().find('span.stopAccess').remove();
				$(this).parent().find('.elastic').val(helloBaseText);
				$(this).parent().find('input.subject').val(helloBaseSubject);
				externalTempCode = null;
				showEndDate = false;
				showCkEditor = true;
				break;
			case 'externalAccessMenuValidationLink':
				$(this).parent().find('span.stopAccess').remove();
				$(this).parent().find('.elastic').val(validationEmailHtml);
				$(this).parent().find('input.subject').val(validationEmailSubject);
				externalTempCode = proofKey;
				showEndDate = false;
				showCkEditor = true;
				break;
			case 'externalAccessMenuViewLink':
				$(this).parent().find('span.stopAccess').remove();
				$(this).parent().find('.elastic').val(externalAccessViewEmailHtml);
				$(this).parent().find('input.subject').val(externalAccessViewEmailSubject);
				externalTempCode = externalCodeExternalAccess;
				showEndDate = true;
				showCkEditor = true;
				break;
			case 'externalAccessMenuEditLink':
				$(this).parent().find('span.stopAccess').remove();
				$(this).parent().find('.elastic').val(externalAccessEditEmailHtml);
				$(this).parent().find('input.subject').val(externalAccessEditEmailSubject);
				externalTempCode = externalCodeExternalAccess;
				showEndDate = true;
				showCkEditor = true;
				break;
			case 'externalAccessMenuStop':
				if($(this).parent().find('.cke').length>0){
					$(this).parent().find('.elastic').ckeditorGet().destroy();
				}
				$(this).parent().find('.elastic').hide();
				$(this).parent().find('.subject').hide();
				$(this).parent().find('input[type="button"]:input[name="ok"]').before('<span class="stopAccess">'+areYouSureToStopExternalAccess+'<br /><br /></span>');
				externalTempCode = externalCodeExternalAccess;
				showEndDate = false;
				showCkEditor = false;
				break;
		}
		if(showEndDate) {
			$(this).parent().find('input.endDate').datepicker({
					dateFormat: 'dd.mm.yy',
					changeYear: true,
					firstDay:1,
					constrainInput:true,
					showOn:'button'
				})
				.width('75')
				.click(function(){
					$(this).datepicker('hide');
				});
			$(this).parent().find('.endDate').show();
		} else $(this).parent().find('.endDate').hide();

		if(showCkEditor){
			$(this).parent().find('.subject').show();
			$(this).parent().find('.elastic').ckeditor({
				language : crtLanguage,
				scayt_sLang : getScayt_sLangFromLanguage(crtLanguage),
				baseFloatZIndex : $(this).closest('.ui-dialog').css('zIndex')+1,
				toolbar : getBasicCKEditorToolbar(),
				toolbarCanCollapse : true,
				toolbarStartupExpanded : false,
				extraPlugins : 'autogrow',
				autoGrow_minHeight: Math.max(80, $(this).height()),
				width : 400,
				allowedContent: true,
				resize_minWidth : 50,
				startupFocus: true
			});
		}
	});
	$(emb).next().find('input[type="button"]:input[name="cancel"]').click(function(){
		$(this).parent().hide().remove();
	});
	$(emb).next().find('input[type="button"]:input[name="ok"]').click(function(){
		$(this).parent().hide();
		url = SITE_ROOT +'Update/'+crtContextId+EXEC_requestSeparator+ elementDialogId+'/'+crtWigiiNamespaceUrl+'/'+crtModuleName+'/element/manageEmail/'+recordId+'/';
				var myAjax = new jQuery.ajax({
					type: 'POST',
					url: encodeURI(url),
					success : parseUpdateResult,
					cache:false,
					data: {
						externalMessage: $(this).parent().find('textarea').val(),
						externalSubject: $(this).parent().find('input.subject').val(),
						externalAction: $(this).parent().find('input:radio:checked').val(),
						externalCode: externalTempCode,
						externalEndDate: $(this).parent().find('input.endDate').val(),
						externalElementId: recordId,
						externalFieldName: fieldName,
						externalEmail: email
					},
					error: errorOnUpdate
				});
		});

	if(otherRequest){
		parseUpdateResult(otherRequest.join(EXEC_answerRequestSeparator), textStatus);
	}

				},
				cache:false,
				data: {
					proofKey: proofKey,
					externalCode: externalCodeExternalAccess,
					proofStatus: proofStatus
				},
				error: errorOnUpdate
			});
		onUpdateErrorCounter = 0;

	});
}

/**
 * AutoSave
 */
var crtAutoSaveFieldChanged = {};
var changeAutoSaveFieldForSubmit = {}; //IE do not support submit data in a form { 'changedAutoSaveField' : Array }, we need so to build the object ourself
var tempAutoSaveFormIndex = 0;
function saveField(formId, submitUrlForAutoSave, autoSaveFieldId, labelAutoSaveTrigged, additionalUrlArgument){
	if(arguments.length < 5) additionalUrlArgument = null;
	if($('#'+autoSaveFieldId+' input[name=captcha_code]').length){
		return false;
	}
	setVis('busyDiv', true);
	if($('#'+autoSaveFieldId).hasClass('field')){
		var autoSaveFieldName = autoSaveFieldId.replace(formId+'__', '');
		var autoSaveMesssageTargetId = autoSaveFieldId;
	} else {
		var parentField = $('#'+autoSaveFieldId).parents('.field');
		if(parentField.length > 0) {
			var autoSaveFieldName = parentField.attr('id').replace(formId+'__', '');
			var autoSaveMesssageTargetId = parentField.attr('id');
		}
		else {
			// this path is used when ckeditor is full screen
			parentField = $('#'+autoSaveFieldId).parent().parent();
			if(parentField.attr('id').indexOf(formId+'__') === 0) {
				var autoSaveFieldName = parentField.attr('id').replace(formId+'__', '');
				var autoSaveMesssageTargetId = $('#'+autoSaveFieldId).parent().find('div.cke_contents').attr('id');
			}
			else throw 'cannot find wrapping field name for '+autoSaveFieldId+' in autosave.';
		}
	}

	//store the list of change fields
	crtAutoSaveFieldChanged[autoSaveFieldName] = true;
	changeAutoSaveFieldForSubmit['changedAutoSaveField['+autoSaveFieldName+']']=true;

	var url = SITE_ROOT +submitUrlForAutoSave+'/'+autoSaveFieldName+(additionalUrlArgument ? '/'+additionalUrlArgument:'');

	$('#'+autoSaveMesssageTargetId).prepend('<div class="autoSaveConfirmation ui-widget ui-corner-all" style="position:absolute;margin-left:0px;margin-top:20px;padding:2px;">'+labelAutoSaveTrigged+'<span class="percent"></span></div>');
	asFid = 'tempAutoSaveFileForm'+ (tempAutoSaveFormIndex++);
	//wrap a new form to submit only the specified fields
	$('#'+autoSaveFieldId).wrap('<form id="'+asFid+'" action="'+url+'" enctype="multipart/form-data" method="post" ></form>');
	var hasRemovedDisabledOnSubmit = false;
	if($('#'+autoSaveFieldId).find('.removeDisableOnSubmit[disabled]').andSelf().filter('.removeDisableOnSubmit[disabled]').length){
		$('#'+autoSaveFieldId).find('.removeDisableOnSubmit[disabled]').andSelf().filter('.removeDisableOnSubmit[disabled]').attr('disabled', false);
		hasRemovedDisabledOnSubmit = true;
	}
	$('#'+asFid).ajaxForm({
		success: function(tabReq, textStatus){
			parseUpdateResult(tabReq, textStatus);
		},
		data: { 'autoSaveFieldId':autoSaveFieldId, 'autoSaveMesssageTargetId':autoSaveMesssageTargetId },
		uploadProgress: function(event, position, total, percentComplete) {
	        $('#'+autoSaveMesssageTargetId+' .autoSaveConfirmation .percent').html(' ('+percentComplete+'%)');
	    }, cache:false
	});
	$('#'+asFid).submit();
	//unwrap just after submitting to prevent leaving in form a sub form
	//the timeout is necessary to prevent IE 7-8-9 to not submit the form
	setTimeout(function(){
		if(hasRemovedDisabledOnSubmit){
			$('#'+autoSaveFieldId).find('.removeDisableOnSubmit').andSelf().filter('.removeDisableOnSubmit').attr('disabled', true);
		}
		$('#'+autoSaveFieldId).unwrap();
	}, 10);
}

function autoSaveCKEditor(obj, formId, submitUrlForAutoSave, labelAutoSaveTrigged){
	$(obj).ckeditorGet().updateElement();
	saveField(formId, submitUrlForAutoSave, $(obj).attr('id'), labelAutoSaveTrigged);
	return false;
}
var focusAutoSaveFieldId = 'initial';
var crtAutoSaveFieldDirty = {};
var crtActiveCKEditor = null;
var crtActiveOnlineFileTextContentId = null;
var blockHistoryForOnlineFileTextFieldName = null;
function setListenerForAutoSave(formId, submitUrlForAutoSave, labelAutoSaveTrigged){
	//initialise variables
	focusAutoSaveFieldId = 'initial';
	crtAutoSaveFieldDirty = {};
	crtAutoSaveFieldChanged = {};
	changeAutoSaveFieldForSubmit = {};
	tempAutoSaveFormIndex = 0;

	//mark dirty fields on change
	$('#'+formId+' :input').change(function(){
//		alert('change:'+$(this).parents('.field').attr('id'));
		crtAutoSaveFieldDirty[$(this).parents('.field').attr('id')] = true;
	});

	//on radio button or checkbox save on click
	$('#'+formId+' :radio, #'+formId+' :checkbox').click(function(){
		crtAutoSaveFieldDirty[$(this).parents('.field').attr('id')] = true;
		if(crtAutoSaveFieldDirty[$(this).parents('.field').attr('id')]){
			saveField(formId, submitUrlForAutoSave, $(this).parents('.field').attr('id'), labelAutoSaveTrigged);
			crtAutoSaveFieldDirty[$(this).parents('.field').attr('id')]=false;
		}
	});

	//mark if a field receive the new focus
	onFocus = function(e){
		if($(this).parents('.field').length){
			focusAutoSaveFieldId = $(this).parents('.field').attr('id');
		}
	};
	
	$('#'+formId+' :input').focus(onFocus);

	//on standard fields save on blur if dirty, when changing field
	onBlur = function(){
		var autoSaveFieldId = $(this).parents('.field').attr('id');
		//reinitialise focusAutosaveFieldId to empty
		focusAutoSaveFieldId = '';
		//wait to mark focusAutoSaveFieldId with the new focus
		setTimeout(function(){
			if((focusAutoSaveFieldId != autoSaveFieldId) && crtAutoSaveFieldDirty[autoSaveFieldId]){
				var blockHistory = null;
				if(autoSaveFieldId == formId+'__'+blockHistoryForOnlineFileTextFieldName) {
					blockHistory = 'blockHistory';
					blockHistoryForOnlineFileTextFieldName = null;
				}
				saveField(formId, submitUrlForAutoSave, autoSaveFieldId, labelAutoSaveTrigged, blockHistory);
				crtAutoSaveFieldDirty[autoSaveFieldId]=false;
			}
	    },10);
	};
	$('#'+formId+' :input:not(:radio,:checkbox)').blur(onBlur);

	// select2 dropdowns
	$('#'+formId+' select.flex, '+'#'+formId+' select.chosen')
		.on('select2:open', onFocus)
		.on('select2:close', onBlur);
	
	//CKEditors
	$('#'+formId+' div.value textarea.htmlArea').blur(function(){
		crtActiveCKEditor = null;
		autoSaveCKEditor(this, formId, submitUrlForAutoSave, labelAutoSaveTrigged);
	});
	$('#'+formId+' div.value textarea.htmlArea').focus(function(){
		crtActiveCKEditor = this;
	});

//	CKEDITOR.on('instanceReady', function(evt) {
//	    var editor = evt.editor;
//	    editor.on('focus', function(e) {
//	        //crtActiveCKEditor = $('#'+formId+' #' + e.editor.name);
//	    	crtActiveCKEditor = this;
//	    });
//	});
//	
	// select2 dropdowns event for autosave : http://code.runnable.com/UmuP-67-dQlIAAFU/events-in-select2-for-jquery
	
	//launch auto saving evey 30 seconds
	$('#'+formId).stopTime(formId+'autoSaveFormCKEditors');
	$('#'+formId).everyTime(1000*30, formId+'autoSaveFormCKEditors', function(i){
		// autosaves CKEditor content for html areas
		if(crtActiveCKEditor != null) autoSaveCKEditor(crtActiveCKEditor, formId, submitUrlForAutoSave, labelAutoSaveTrigged);
		// autosaves inline file content from preview dialog
		if(crtActiveOnlineFileTextContentId != null) {
			// gets data from element preview ck editor
			$(crtActiveOnlineFileTextContentId).val($('#elementPreview').find('textarea:first').ckeditorGet().getData());
			// autosaves file content
			var autoSaveFieldId = $(crtActiveOnlineFileTextContentId).parents('.field').attr('id');
			saveField(formId, submitUrlForAutoSave, autoSaveFieldId, labelAutoSaveTrigged,
					(crtActiveOnlineFileTextContentId == '#editElement_form_'+blockHistoryForOnlineFileTextFieldName+'_textContent_textarea' ? 'blockHistory' : null));
			crtAutoSaveFieldDirty[autoSaveFieldId]=false;
		}
	});

	//submit what was the changes made when submit current form
	$('#'+formId).ajaxForm($.extend({}, getAjaxformOption('#'+formId), {
		data: changeAutoSaveFieldForSubmit,
		beforeSerialize:  function(){
			//remove disable for readonly field when submitting the form (part of standard option)
			if($('#'+formId+' .removeDisableOnSubmit').length>0){
				$('#'+formId+' .removeDisableOnSubmit').removeAttr('disabled');
			}
			$('#'+formId).find('form').each(function(){ $(this).children().unwrap(); });
		}
		}));

	//hide cancel button in form
	if($('#'+formId+' .cancel').length){
		$('#'+formId+' .cancel').hide();
	}
	if($('#'+formId).parents('.ui-dialog').find('button.cancel').length){
		$('#'+formId).parents('.ui-dialog').find('button.cancel').hide();
	}
	// Re-initializes middle box with toolbar from dialog box.
	if(isWorkzoneViewDocked()){
		var middleBox = initMiddleBox();
		middleBox.append($('#elementDialog .T').addClass('docked').css({'width':''}));
		$('#searchBar .toolbarBox').hide();
	}
	
}

//
function setListenerForTimeline(formId, fieldId, nbColumn, options){
    var historyFields = options.historyFields;
    historyFields = $.parseJSON(historyFields);
    var d = new Date();
    var date = d.getDate() + '.' + (d.getMonth()+1) + '.' + d.getFullYear();

    $("#"+fieldId+' input').click(function(){
    	if($(this).attr('class') == 'inTimeline'){
            if($(this).prop('checked') == false){
                $(this).prop('checked', false);
            }else{
                $(this).prop('checked', true);
            }

            var index = $(this).parent().index()-1;
            var revIndex = nbColumn - index;
            $(this).parent().parent().children('div .child:lt('+index+')').each(function(){
                var fieldName = $(this).children('input').attr('value');
                var fieldId = formId+'_'+historyFields[fieldName]+'_value_text';

                $(this).children('input').prop('checked', true);

                if(!$('#'+fieldId).attr('value')){
                    $('#'+fieldId).attr('value', date);
                }
            });
            $(this).parent().parent().children('div .child:gt(-'+revIndex+')').each(function(){
                $(this).children('input').prop('checked', false);
            });
            $("#"+fieldId+' .value').children('input').each(function(){
                $(this).prop('checked', false);
            });

            if($(this).prop('checked') == true){
                $(this).prop('checked', true);

                var fieldName = $(this).attr('value');
                var fieldDate = $('#'+fieldName.replace(/ /g , "_")+'_date span');
                var field = formId+'_'+historyFields[fieldName]+'_value_text';

                $(this).attr('id');

                if(!$('#'+field).attr('value')){
                    $('#'+field).attr('value', date);
                    fieldDate.html(date).show();
                }

            }else{
                $("#"+fieldId).prop('checked', false);
            }
		}
    });
}

// called each time the server historizes an online html file.
function actOnHistorizedHtmlFile(fieldName) {
	// blocks further history if CKEditor is still open on the same file during autosave flow
	if(fieldName && crtActiveOnlineFileTextContentId == ('#editElement_form_'+fieldName+'_textContent_textarea')) {
		blockHistoryForOnlineFileTextFieldName = fieldName;
	}
}

/**
*@param String selector jQuery selector to fetch some DOM elements
*@param String serviceNames a space separated string of service names to add to data-wigii-service attribute
*/
function domElementAddWigiiService(selector, serviceNames) {
	
	var existingServices = $(selector).attr("data-wigii-service");
	
	if(existingServices == null){
		existingServices = serviceNames;
	}else{
		var servicesArray = serviceNames.split(" ");
		var servicesList = existingServices.split(" ");
		
		//loop on all element of the both arrays and return true if there are already this element
		//else add the new element in the second array
		for(key1 in servicesArray){
			var exist = false;
			for (key2 in servicesList) {
				
				if(servicesArray[key1] === servicesList[key2]){
					exist = true;
				}
			}
		
			if(!exist){
				existingServices = existingServices.concat(" ".concat(servicesArray[key1]));
			}
		}
	}
	$(selector).attr("data-wigii-service", existingServices);
}
/**
*@param String selector jQuery selector to fetch some DOM elements
*@param String serviceNames a space separated string of service names to remove from data-wigii-service attribute
*/
function domElementRemoveWigiiService(selector, serviceNames){
	var existingServices = $(selector).attr("data-wigii-service");
	var newServices = "";
	
	if(existingServices != null){
		var servicesArray = serviceNames.split(" ");
		var servicesList = existingServices.split(" ");

		for (key in servicesArray) {
			servicesList.splice(servicesList.indexOf(servicesArray[key]),1)
		}
		
		for (key in servicesList) {
			newServices = newServices.concat(" ".concat(servicesList[key]));
		}
		$(selector).attr("data-wigii-service", newServices);
	}
}
/**
*@param String selector jQuery selector to fetch some DOM elements
*@param String serviceName a service name to check if exist in the data-wigii-service attribute
*/
function domElementHasWigiiService(selector, serviceName){
	var existingServices = $(selector).attr("data-wigii-service");
	if(existingServices != null){
		var servicesList = existingServices.split(" ");
			for (key in servicesList) {
				if(servicesList[key] === serviceName){
					return true;
				}
			}
	}
	return false;
}

//$(document).ready(function(){
//	$(".chosen-select").chosen({width: '350px'});
//});


/**
 *  This file is part of Wigii.
 *  Wigii is developed to inspire humanity. To Humankind we offer Gracefulness, Righteousness and Goodness.
 *  
 *  Wigii is free software: you can redistribute it and/or modify it 
 *  under the terms of the GNU General Public License as published by
 *  the Free Software Foundation, either version 3 of the License, 
 *  or (at your option) any later version.
 *  
 *  Wigii is distributed in the hope that it will be useful, but WITHOUT ANY WARRANTY; 
 *  without even the implied warranty of MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  
 *  See the GNU General Public License for more details.
 *
 *  A copy of the GNU General Public License is available in the Readme folder of the source code.  
 *  If not, see <http://www.gnu.org/licenses/>.
 *
 *  @copyright  Copyright (c) 2016  Wigii.org
 *  @author     <http://www.wigii.org/system>      Wigii.org 
 *  @link       <http://www.wigii-system.net>      <https://github.com/wigii/wigii>   Source Code
 *  @license    <http://www.gnu.org/licenses/>     GNU General Public License
 */

//Get the height of the top of screen (companyBanner + navigationBar + searchBar (in option))
function getTopHeight(includeSearchBar){
	if(arguments.length<1){
		includeSearchBar = false;
	}
	var height = 0;
	$('#companyBanner').children().each(function(){height += $(this).outerHeight();});
	height += $('#NMContainer').outerHeight();
    height += $('#NMContainerBsp').outerHeight();

	//if(includeSearchBar) height += $('#searchBar').outerHeight();

	//Now the searchBar is in the navbar, but we should just add 3px to prevent the scrollbar
	if(includeSearchBar) height += 3;

	return height;
}

function resize_groupPanel(){
	resize_groupPanel_i = $('#groupPanel>ul');
	fb = $('#footerBar');
	gpT = $('#groupPanel>.keepNotify');
	if(resize_groupPanel_i.length>0){
		//If it is the new design we must remove the search bar in the calculation
		if($('#NMContainerBsp').height() > 0){
			var bool = false;
		} else {
			var bool = true;
		}
		if(typeof gpT.outerHeight() != "undefined"){
			resize_groupPanel_i.height($(window).height() - getTopHeight(bool) - fb.outerHeight() - gpT.outerHeight()-20);
		}else{
			resize_groupPanel_i.height($(window).height() - getTopHeight(bool) - fb.outerHeight() -20);
		}
//		if($('#groupPanel>ul:hidden').length){
//			var tempH = $('#moduleView').height();
//			var tempPad = tempH / 2 -30;
//		} else {
//			var tempH = $(window).height()-resize_groupPanel_i.position().top - fb.outerHeight();
//			var tempPad = tempH / 2 -30;
//		}
//		var tempH = $(window).height()-$('#groupPanel').position().top - fb.outerHeight();
		var tempH = $(window).height() - getTopHeight(bool) - fb.outerHeight();
		var tempPad = tempH / 2 -30;

		//We remove one pixel to prevent the apparation of the scroll bar
		$('#groupPanel>.collapse').height(tempH-tempPad-1).css('padding-top',tempPad);
	}
}
$(window).resize(resize_groupPanel);

ElementPListRows_makeHeaders_getTotalWidth = 0;
ElementPListRows_makeHeaders_getNbNoWidth = 0;
ElementPListRows_makeHeaders_getNb = 0;
ElementPListRows_makeHeaders_totalPaddingInCol = 0;
ElementPListRows_scrollWidth = 17;
//those variables are filled in ElementPListRowsForElementList.php at the end of the method makeHeader
function ElementPListRows_makeHeaders(){
	//17 is the scroll bar size
	cor = 0;
	$('#moduleView .list .headerList>div.noWidth').width(Math.max(75, parseInt(($('#moduleView .list').width()-ElementPListRows_scrollWidth-ElementPListRows_makeHeaders_getTotalWidth-(cor*ElementPListRows_makeHeaders_getNb))/ElementPListRows_makeHeaders_getNbNoWidth)-ElementPListRows_makeHeaders_totalPaddingInCol));
	$('#moduleView .list .headerList>div:last').css('padding-right', ElementPListRows_scrollWidth+'px'); //to cover the space of the vertical scroll
}
function resize_elementList(){
	if(isWorkzoneViewDocked() && crtModuleName!='Admin' && !$('#elementDialog').hasClass('ui-dialog-content')) resize_workzoneViewDocked();

	//resizing of the iframe if it's present (It's the case in qlik report)
	resize_iframe_i = $('#moduleView iframe');
	if(resize_iframe_i.height()>0){
		resize_iframe_i.height($(window).height() - getTopHeight(true) - fb.outerHeight());
	}
	
	resize_elementList_i = $('#moduleView>div.list>div.dataList');
	fb = $('#footerBar');
	if(resize_elementList_i.length>0){
//		ElementPListRows_actOnFinishAddElementP();
//		//this is needed because of a googleChrome bug
		ElementPListRows_makeHeaders();
		tempTableWidth = 0;
		$('#moduleView .list .headerList>div').each(function(){ tempTableWidth += parseInt($(this).outerWidth()); });
//		$('#moduleView .list .dataList table').width($('#moduleView .list').width()-ElementPListRows_scrollWidth); //css('width', '100%'); dosen't work in IE7
		$('#moduleView .list .dataList table').width(tempTableWidth-ElementPListRows_scrollWidth); //css('width', '100%'); dosen't work in IE7
		$('#moduleView .list .dataList table').css('table-layout', 'fixed');
		//alert($(window).height()+" "+ul.position().top+" "+fb.height());
		$('#moduleView>div.list .headerList').width(tempTableWidth);
		if(tempTableWidth > $('#moduleView .list').width()){
			//there is an horizontal scrool bar in the table
			$('#moduleView div.nbItemsInList').css('margin-top', '-42px');
		} else {
			$('#moduleView div.nbItemsInList').css('margin-top', '-25px');
		}
		if($('.Red').height() > 0){
            resize_elementList_i.height($(window).height() - getTopHeight(true) - $('#moduleView > .dataZone.list > .headerList').outerHeight() - $('#moduleView #indicators').height() - fb.outerHeight() - 26 - 8);
		}
		else{
			resize_elementList_i.height($(window).height() - getTopHeight(true) - $('#moduleView > .dataZone.list > .headerList').outerHeight() - $('#moduleView #indicators').height() - fb.outerHeight() - 8);
        }

		$('#moduleView .list .dataList').unbind('scroll').scroll(function(){
			$('#moduleView>div.list .headerList').css('margin-left', -$(this).scrollLeft());
		});
	}
	resize_portal();
	resize_coverPage();
	resize_calendar();
	resize_blog();
	resize_wncd();
	if(!isWorkzoneViewDocked()||crtModuleName=='Admin'){
		resize_scrollArea(true);
	}
}
$(window).resize(resize_elementList);

function resize_workzoneViewDocked(){
	var collapseSymbole = '&laquo;',
		explodeSymbole = '&raquo;',
		collapseRef = $('#groupPanel>.collapse'),
		elementDialog = $('#elementDialog'),
		moduleView = $('#moduleView'),
		groupPanel = $('#groupPanel'),
		dockingContainer = $('#dockingContainer');
		dockingCollapse = dockingContainer.find('.collapse');
		height = $(window).innerHeight() - getTopHeight(true) - $('#footerBar').outerHeight(),
		availableWidthSpace = $(window).innerWidth();
	
	var dockingCardVisible = $('#elementDialog:visible').length==1,
		windowSize = $(window).innerWidth(),
		scrollSize = $('#scrollElement').width(),
		cardSize = scrollSize + 15,
		groupSize = groupPanel.outerWidth(),
		moduleSize = windowSize - groupSize - cardSize,
		GroupListCollapsed = groupPanel.data('GroupListCollapsed') || 0 ;
		ListViewCollapsed = moduleView.data('ListViewCollapsed') || 0 ;
		collapseMinWidth = moduleView.data('minWidth') || 100;
	//get the same parameters of existing collapse bar
	dockingCollapse.height(collapseRef.height()).css('padding-top',collapseRef.css('padding-top'));
	
	//set width of docked card
	elementDialog.width(cardSize);
	
	//Auto-Collapse
	var userHasClick = groupPanel.data('userClickCollapse') || dockingCollapse.find('span').data('userClickCollapse');
	if(dockingCardVisible) {
        // Auto-collapse: first GroupList then ListView

        if(GroupListCollapsed == 1 && !userHasClick || moduleSize < collapseMinWidth && !userHasClick) {
            groupPanel.find('ul#group_0').hide();
            groupPanel.find('.keepNotify').hide();
            positionSelectedGroup("#groupPanel");
            groupPanel.find('.collapse').html(explodeSymbole);

            groupSize = groupPanel.outerWidth();
            moduleSize = windowSize - groupSize - cardSize;

            if(ListViewCollapsed == 1 && !userHasClick || moduleSize < collapseMinWidth && !userHasClick){
                moduleView.hide();
                dockingCollapse.find('span').html(explodeSymbole);
            }
        }

        if(ListViewCollapsed == 1 && !userHasClick) {
            moduleView.hide();
            dockingCollapse.find('span').html(explodeSymbole);
        }

        // Auto-collapse: first ListView then GroupList
		/*
		 if(ListViewCollapsed == 1 && !userHasClick || moduleSize < collapseMinWidth && !userHasClick) {
		 moduleView.hide();
		 dockingCollapse.find('span').html(explodeSymbole);
		 }
		 groupSize = groupPanel.outerWidth();
		 moduleSize = windowSize - groupSize - cardSize;
		 if(GroupListCollapsed == 1 && !userHasClick || moduleSize < collapseMinWidth && !userHasClick) {
		 groupPanel.find('ul#group_0').hide();
		 groupPanel.find('.keepNotify').hide();
		 positionSelectedGroup("#groupPanel");
		 groupPanel.find('.collapse').html(explodeSymbole);
		 }
		 */
	} else {
		if(!userHasClick) {
			groupPanel.find('ul#group_0').show();
			groupPanel.find('.keepNotify').show();
		    positionSelectedGroup("#groupPanel");
		    groupPanel.find('.collapse').html(collapseSymbole);
		    groupSize = groupPanel.outerWidth();
		}
	}
	groupPanel.data('userClickCollapse',false);
	dockingCollapse.find('span').data('userClickCollapse',false);

	var marginsWidth = elementDialog.outerWidth() - cardSize;//scrollSize;	
	availableWidthSpace -= groupSize;
	
	//When element dialog is not visible or is there empty moduleView is display with the totality of space available
	if(elementDialog.children().length==0 || elementDialog.css('display')=='none') {
		//remove margin size
		availableWidthSpace -= moduleView.outerWidth()-moduleView.width();
		moduleView.width(availableWidthSpace).show();
		return;
	}
	
	//if docking collapse bar is not hidden, we subtract is availableWidthSpace
	if($('#dockingContainer>.collapse:hidden').length==0) availableWidthSpace-= dockingCollapse.outerWidth();
	
	//if moduleView is visible then calculate available space and asign then to it
	if(dockingContainer.find('#moduleView:hidden').length==0) {		
		var remainingWidthSpace = availableWidthSpace - elementDialog.outerWidth(); // + marginsWidth;	
		//if moduleView is too small, we put the minimum and reduce elementDialog
		var moduleViewMinWidth = collapseMinWidth;
		if (remainingWidthSpace <= moduleViewMinWidth) {		
			moduleView.width(moduleViewMinWidth);
			elementDialog.width(availableWidthSpace - marginsWidth - moduleView.outerWidth());
		} else {
			moduleView.width(remainingWidthSpace -15);
			elementDialog.width(cardSize+(marginsWidth/2))
		}
	} else { //if moduleView is hidden calculate the availableWidthSpace
		availableWidthSpace -= marginsWidth;		
		elementDialog.width(availableWidthSpace);
	}

	//if ToolsBar is visible then push down the working zone.
	/*
	if(dockingContainer.find('#moduleView .toolBar').length > 0) {
    	var contentToolBar = $('#moduleView .toolBar').html();
    	var elementDialog = $('#dockingContainer #elementDialog');

    	$('#moduleView .toolBar').html('');

		elementDialog.prepend(contentToolBar);
	}

	*/

	elementDialog.height(height + (elementDialog.height()-elementDialog.outerHeight())).css('overflow','auto');
	if(dockingCardVisible){
		$('.firstBox, .toolbarBox','#searchBar').hide();
	}
}

function resize_homePage(){
	resize_homePage_i = $('#workZone #ContainerHome');
	fb = $('#footerBar');
	if(resize_homePage_i.length>0){
		//resize_homePage_i = resize_homePage_i.parent();
		resize_homePage_i.height($(window).height()-resize_homePage_i.position().top - fb.outerHeight()-40); //-40 is because of internal padding
		if($('#workZone #quickStartTabs').length){
			$('#workZone #quickStartTabs').css("min-width", $(window).width()-50-$('#workZone #ContainerHome').outerWidth());
			//$('#workZone #quickStartTabs').height(resize_homePage_i.height());
		}
	}
}
$(window).resize(resize_homePage);

function resize_portal(){
	if($('#moduleView .portal:visible').length > 0 && $('#moduleView .portal>.media').length > 0){
		//$('#searchBar .firstBox, #searchBar .toolbarBox').hide();
		$('#moduleView .portal').css('float', 'left');
		fb = $('#footerBar');
		tempResizePortalHeight = $(window).height()-$('#moduleView').position().top-$('#moduleView .toolBar').height()-$('#moduleView #indicators').height()-fb.outerHeight()-1;
		$('#moduleView .portal').height(tempResizePortalHeight);
		$('#moduleView .portal').width($(window).width()-$('#groupPanel').outerWidth()-4);
		$('#moduleView .portal').css('overflow','hidden');
		$('#moduleView .portal .media>iframe').attr('height', $('#moduleView .portal').height()).attr('width', $('#moduleView .portal').width());
	//} else {
		//$('#searchBar .firstBox, #searchBar .toolbarBox').show();
	}
	resize_groupPanel();
}
function resize_coverPage(){
	if($('#moduleView .portal:visible').length > 0 && $('#moduleView .portal>.media').length == 0){
		$('#moduleView .portal').css('float', 'left');
		fb = $('#footerBar');
		tempResizePortalHeight = $(window).height()-$('#moduleView').position().top-$('#moduleView .toolBar').height()-$('#moduleView #indicators').height()-fb.outerHeight()-1;
		$('#moduleView .portal').height(tempResizePortalHeight);
		$('#moduleView .portal').width($(window).width()-$('#groupPanel').outerWidth()-24); //padding-left and right 10px;
		$('#moduleView .portal').css('overflow','auto');
	}
}

coverPage_toggleList_titleList = null;
coverPage_toggleList_titleWebsite = null;
function coverPage_toggleList(){
	$(document).ready(function(){
        if($('#searchBar .toolbarBox .toggleCoverPage').length==0){
            $('#searchBar .toolbarBox div.addNewElement').after('<div class="toggleCoverPage" style="display:none;" onclick="coverPage_toggleList();"><span class="H"></span></div>');
        }
        if($('#moduleView .dataZone:visible').length > 0){
            showCoverPage();
        } else {
            hideCoverPage();
        }
	});


}
//when displaying a folder without cover page reset the searchBar as normal
function removeCoverPageItems(){
	hideCoverPage();
	$('#searchBar .toolbarBox .toggleCoverPage').hide();
}
function showCoverPage(){
	$('#moduleView .dataZone').hide();
	$('#searchBar .toolbarBox div:not(.toggleCoverPage,.addNewElement)').hide();
	$('#searchBar .toolbarBox .toggleCoverPage span').text(coverPage_toggleList_titleList).parent().show();
	$('#moduleView .portal').show();
	resize_elementList();
}
function hideCoverPage(){
	$('#moduleView .portal').hide();
	$('#searchBar .toolbarBox .toggleCoverPage span').text(coverPage_toggleList_titleWebsite).parent().show();
	$('#searchBar .toolbarBox div:not(.toggleCoverPage,.addNewElement,.cm,.disabledR,.ui-dialog)').show();
	$('#moduleView .dataZone').show();
	resize_elementList();
}

function isWorkzoneViewDocked(){
	return wigii().context.isWorkzoneViewDocked;
}

function fold(id){
	$(id+' ul ul').hide();
	$(id+' span.with-ul-displayed').removeClass('with-ul-displayed').addClass('with-ul-hidden');

}
function unfoldToSelectedGroup(id, selectedClass){
	if(arguments.length < 2){
		selectedClass = "selected";
	}
	//check if groupPanel is collapsed, if yes keep hidding
	var hide = false;
	if(id=="#groupPanel" && $(id+'>ul:hidden').length){
		hide = true;
	}

	//always unfold noRights group
	$(id+' ul:has(li.disabled)').show();
	$(id+' li.disabled>ul').show();
	$(id+' li.disabled>div>span.with-ul-hidden').removeClass('with-ul-hidden').addClass('with-ul-displayed');
	//unfold selected li
	$(id+' ul:has(div.'+selectedClass+')').show();
	$(id+' li.'+selectedClass+'>ul').show();
	$(id+' li:has(li div.'+selectedClass+')>div>span.with-ul-hidden').removeClass('with-ul-hidden').addClass('with-ul-displayed');
	$(id+' li:has(>div.'+selectedClass+')>div>span.with-ul-hidden').removeClass('with-ul-hidden').addClass('with-ul-displayed');
	if(hide){
		$(id+'>ul').hide();
	}
}
function unfoldToSelectedGroupButNotChildren(id, selectedClass){
	if(arguments.length < 2){
		selectedClass = "selected";
	}
	//always unfold noRights group
	$(id+' ul:has(li.disabled)').show();
	$(id+' li.disabled>ul').show();
	$(id+' li.disabled>div>span.with-ul-hidden').removeClass('with-ul-hidden').addClass('with-ul-displayed');
	//unfold selected li
	$(id+' ul:has(div.'+selectedClass+')').show();
	$(id+' li:has(li div.'+selectedClass+')>div>span.with-ul-hidden').removeClass('with-ul-hidden').addClass('with-ul-displayed');
	//$(id+' li:not(:has(li div.'+selectedClass+')).'+selectedClass+'>div>span.with-ul-displayed').addClass('with-ul-hidden').removeClass('with-ul-displayed');
}
function positionSelectedGroup(id, selectedClass){
	if(arguments.length < 2){
		selectedClass = "selected";
	}
	group = $(id+' li.'+selectedClass);
	if(group.length>0){
		p = group.offset().top-$(id+'>ul').offset().top+$(id+'>ul').scrollTop();
		h = $(id+'>ul').innerHeight();
		s = $(id+'>ul').scrollTop();
		d = group.outerHeight();
		//alert(p+' '+h+' '+s+' '+d);
		if(p < s){
			$(id+'>ul').scrollTop(p-10);
		} else if((p+d) > (h + s)){
			$(id+'>ul').scrollTop(Math.min(p-10, p-h+d+10));
		}
	}
}

function prepareOrganizeDialog(callbackOnClick, callbackOnOk){
	$('#organizeDialog').html('<div class="groupPanel"></div><div class="clear"></div>');
	$('#organizeDialog>.groupPanel').html($('#groupPanel>ul').clone(true));
	$('#organizeDialog>.groupPanel span.menu').remove();
	$('#organizeDialog>.groupPanel span.description').remove();
	$('#organizeDialog>.groupPanel div, #organizeDialog>.groupPanel li, #organizeDialog>.groupPanel ul, #organizeDialog>.groupPanel a.H').unbind();
	$('#organizeDialog .disabled').removeClass('disabled');
	$('#organizeDialog .selected').removeClass('selected');
	$('#organizeDialog .found').removeClass('found');
	$('#organizeDialog .hidden').show().removeClass('hidden');
	$('#organizeDialog .empty').removeClass('empty');

	//define heigth
	$('#organizeDialog>.groupPanel>ul').height($('#moduleView').height()-80-10).show();

	//add the input box before each link
	$('#organizeDialog>.groupPanel li>div>a').before('<span class="checkbox">&nbsp;</span>');

	//add callback on click
	$('#organizeDialog>.groupPanel li>div').click(callbackOnClick);

	fold('#organizeDialog>.groupPanel');

	tempWidth = 450;
	$('#organizeDialog>.groupPanel #group_0').width(tempWidth).css('overflow-x','auto');
	$('#organizeDialog>.groupPanel a').css('white-space', 'nowrap');
	$('#organizeDialog>.groupPanel').css('margin-bottom', 0);
	$('#organizeDialog>.groupPanel>ul').css('height', $('#organizeDialog>.groupPanel>ul').height()-20);

	$('#organizeDialog').dialog({
		width: tempWidth+20,
		buttons: [
			{
				text: DIALOG_okLabel,
				click: callbackOnOk,
				"class": "ok"
			},
			{
				text: DIALOG_cancelLabel,
				click: function(){ $(this).dialog("destroy"); },
				"class": "cancel"
			}
		],
		closeOnEscape: true,
		stack:false,
		resizable:false,
		zIndex:0,
		modal:true
	});
}

function parseKeepNotifiedResult(returnText, textStatus){
	setVis("busyDiv", false);
	otherRequest = returnText.split(EXEC_answerRequestSeparator);
	returnText = otherRequest[0].split(EXEC_answerParamSeparator);
	otherRequest.shift();
	i=1;
	$('#ui-dialog-title-organizeDialog').text(returnText[i++]);

	if(returnText[i++]=="emailAdressIsDefined"){
		$('#organizeDialog>.notifiedIntroduction').remove();
		$('#organizeDialog').prepend('<div class="notifiedIntroduction">'+returnText[i++]+'</div>');

		$('#organizeDialog>.groupPanel').show();
		fold('#organizeDialog>.groupPanel');
		$('#organizeDialog>.groupPanel .selected').removeClass('selected');
		$('#organizeDialog>.groupPanel .originalSelected').removeClass('originalSelected');

		checkedFolders = new Array();
		if(returnText[i]){
			checkedFolders = returnText[i++].split(',');
		}
		for(i=0; i<checkedFolders.length; i++){
			id = checkedFolders[i];
			$('#organizeDialog>.groupPanel #group_'+id+', #organizeDialog>.groupPanel #group_'+id+'>div').addClass('selected originalSelected');
			$('#organizeDialog>.groupPanel #group_'+id+' li').addClass('selected');
			$('#organizeDialog>.groupPanel #group_'+id+' li>div').addClass('selected');
//			.find('li, li>div').addClass('selected');
		}
		//disables no rights groups
		//disables read only groups
		$('#organizeDialog>.groupPanel li.noRights').addClass("disabled noRights");
		$('#organizeDialog>.groupPanel li.noRights>div').addClass("disabled noRights");

//		$('#organizeDialog>.groupPanel li.noRights, #organizeDialog>.groupPanel li.noRights>div.selected').addClass('disabled');
//		alert('add disabled');

		unfoldToSelectedGroupButNotChildren('#organizeDialog>.groupPanel', 'originalSelected');
		positionSelectedGroup('#organizeDialog>.groupPanel');
	} else {
		$('#organizeDialog>.groupPanel').hide();
		$('#organizeDialog>.notifiedIntroduction').remove();
		//display an input box
		$('#organizeDialog').prepend('<div class="notifiedIntroduction">'+returnText[i++]+'</div>');
	}
	if(otherRequest){
		parseUpdateResult(otherRequest.join(EXEC_answerRequestSeparator), textStatus);
	}
}
function actionForKeepNotified(action){
	setVis("busyDiv", true);
	original = new Array();
	actual = new Array();
	if(action=="setKeepNotifiedGroupsForEmail"){
		//the original selection are taged witht the originalSelected class
		$('#organizeDialog li.originalSelected').each(function(){ original[original.length] = $(this).attr('id').split('_')[1]; });
		//actual are all selected with no selected parents
		$('#organizeDialog li.selected').each(function(){ if(!$(this).parent().parent().hasClass('selected')){ actual[actual.length] = $(this).attr('id').split('_')[1]; } });
	}
	url = SITE_ROOT +"Update/"+crtContextId+EXEC_requestSeparator+ "organizeDialog/"+crtWigiiNamespaceUrl+"/"+crtModuleName+"/"+action;
	var myAjax = new jQuery.ajax({
			type: 'POST',
			url: encodeURI(url),
			success : parseKeepNotifiedResult,
			cache:false,
			data: {
				emailAccountForP: $('#KeepNotifiedEmailInput').val(),
				original: original, //contain the first matching groups
				actual: actual //contain the current most hign li.selected
			},
			error: errorOnUpdate
		});
	onUpdateErrorCounter = 0;
}
function openKeepNotifiedDialog(){
	//for the keep notified dialog the highest li's are the references
	prepareOrganizeDialog(
		//on click
		function(e){
			if(!$(this).hasClass('disabled')){
				$(this).toggleClass('selected');
				if($(this).hasClass('selected')){
					//select all the sub folders
					$(this).parent().addClass('selected').find('li, li>div').addClass('selected');
				} else {
					//deselect all the folders above
					$(this).parents('.selected').removeClass('selected');
					//deselect all the sub folders
					$(this).parent().find('li').removeClass('selected');
					//clean selected div when li are not selected
					$('#organizeDialog li:not(.selected)>div.selected').removeClass('selected');
				}
			}
			return false;
		},
		//on Ok
		function(){
			if($('#KeepNotifiedEmailInput').length){
				actionForKeepNotified("setKeepNotifiedEmail");
			} else {
				actionForKeepNotified("setKeepNotifiedGroupsForEmail");
				if( $('#organizeDialog').is(':ui-dialog')) { $('#organizeDialog').dialog("destroy"); }
			}
		});

	//fetch current email + subscribed group
	url = SITE_ROOT +"Update/"+crtContextId+EXEC_requestSeparator+ "organizeDialog/"+crtWigiiNamespaceUrl+"/"+crtModuleName+"/getKeepNotifiedDialogContent/";
	setVis("busyDiv", true);
	var myAjax = new jQuery.ajax({
			url: encodeURI(url),
			cache:false,
			success : parseKeepNotifiedResult,
			error: errorOnUpdate
		});
	onUpdateErrorCounter = 0;
}

function openOrganizeDialog(elementId){
	newCheckedFolders = new Object();
	checkedFolders = new Array();

	prepareOrganizeDialog(
		//on click
		function(e){
			if(!$(this).hasClass('disabled')){
				$(this).toggleClass('selected');
				$('#organizeDialog>div>span.nb').removeClass('zero');
				if($(this).hasClass('selected')){
					newCheckedFolders[$(this).parent().attr('id').split('_')[1]] = $(this).parent().attr('id').split('_')[1];
					$('#organizeDialog>div>span.nb').text(parseInt($('#organizeDialog>div>span.nb').text())+1);
				} else {
					newCheckedFolders[$(this).parent().attr('id').split('_')[1]] = null;
					$('#organizeDialog>div>span.nb').text(parseInt($('#organizeDialog>div>span.nb').text())-1);
					if(parseInt($('#organizeDialog>div>span.nb').text())<1){
						$('#organizeDialog>div>span.nb').addClass('zero');
					}
				}
			}
			return false;
		},
		//on ok, call setGroupsContainingElement
		function(){
			//force at least one selected group
			if(parseInt($('#organizeDialog>div>span.nb').text())==0){
				jAlert(DIALOG_selectAtLeastOneGroup);
				return false;
			}
			url = SITE_ROOT +"Update/"+crtContextId+EXEC_requestSeparator+ "confirmationDialog/"+crtWigiiNamespaceUrl+"/"+crtModuleName+"/element/setGroupsContainingElement/"+elementId;
			var myAjax = new jQuery.ajax({
					type: 'POST',
					url: encodeURI(url),
					success : parseUpdateResult,
					cache:false,
					data: {
						original: checkedFolders.join(','),
						actual: object2Array(newCheckedFolders).join(',')
					},
					error: errorOnUpdate
				});
			onUpdateErrorCounter = 0;
			$(this).dialog("destroy");
			//openOrganize dialog currently work only on main item, not on subitems as the groupPanel is not the good one
			$('#elementDialog').prev().find('.ui-dialog-titlebar-close').click();
		}
		);

	//fetch the selected groups
	url = SITE_ROOT +"Update/"+crtContextId+EXEC_requestSeparator+ "organizeDialog/"+crtWigiiNamespaceUrl+"/"+crtModuleName+"/element/getGroupsContainingElement/"+elementId;
	setVis("busyDiv", true);
	var myAjax = new jQuery.ajax({
			url: encodeURI(url),
			cache:false,
			success : function(returnText, textStatus){
				setVis("busyDiv", false);
				returnText = returnText.split(EXEC_answerRequestSeparator)[0].split(EXEC_answerParamSeparator);
				dialogTitle = returnText[1];
				$('#organizeDialog').prev().find('.ui-dialog-title').text(dialogTitle);
				checkedFolders = returnText[4];
				if(checkedFolders=="") return;
				checkedFolders = checkedFolders.split(",");
				for(i=0; i<checkedFolders.length; i++){
					id = checkedFolders[i];
					newCheckedFolders[id] = id;
					$('#organizeDialog>.groupPanel #group_'+id+', #organizeDialog>.groupPanel #group_'+id+'>div').addClass('selected');
				}
				nbSelected = returnText[2];
				//nbSelected reflects the complete list of folders the item is into.
				//however this number should reflect only the list of visible folders, to prevent the user "loosing" the item
				//by unselecting the last folder visible by this user
				nbSelected = $('#organizeDialog>.groupPanel li.selected').length;
				textSelected = returnText[3];
				$('#organizeDialog').prepend('<div class="introduction"><span class="nb">'+nbSelected+'</span>&nbsp;<span>'+textSelected+'</span></div>');

				// Medair (CWE) 02.02.2018 disables trashbin structure if element is blocked
				if(wigii().context.crtElementState & 2) {
					$('#organizeDialog>.groupPanel li.trashbin, #organizeDialog>.groupPanel li.trashbin li').removeClass("write").hide();					
				}
				
				//disables read only groups
				$('#organizeDialog>.groupPanel li:not(.write)').addClass("disabled noRights");
				$('#organizeDialog>.groupPanel li:not(.write)>div').addClass("disabled noRights");				
				unfoldToSelectedGroupButNotChildren('#organizeDialog>.groupPanel');				
				positionSelectedGroup('#organizeDialog>.groupPanel');
			},
			error: errorOnUpdate
		});
	onUpdateErrorCounter = 0;
}

function openOrganizeMultipleDialog(){
	prepareOrganizeDialog(
		//on click
		function(e){
			if(!$(this).hasClass('disabled')){
				if($(this).hasClass('wasMixed')){
					if($(this).hasClass('mixed')){
						$(this).add($(this).parent()).removeClass('selected').removeClass('mixed');
					} else if($(this).hasClass('selected')){
						$(this).add($(this).parent()).removeClass('selected').addClass('mixed selected');
					} else {
						$(this).add($(this).parent()).addClass('selected');
					}
				} else if($(this).hasClass('wasSelected')){
					$(this).add($(this).parent()).toggleClass('selected');
				} else if($(this).hasClass('wasUnselected')){
					$(this).add($(this).parent()).toggleClass('selected');
				}
			}
			return false;
		},
		//on ok, call setGroupsContainingElement
		function(){
			setVis('busyDiv', true);
			changeToSelected = new Array();
			$('#organizeDialog li.wasMixed.selected:not(.mixed), #organizeDialog li.wasUnselected.selected').each(function(){
				changeToSelected[changeToSelected.length] = $(this).attr('id').replace('group_', '');
			});
			changeToUnselected = new Array();
			$('#organizeDialog li.wasMixed:not(.selected), #organizeDialog li.wasSelected:not(.selected)').each(function(){
				changeToUnselected[changeToUnselected.length] = $(this).attr('id').replace('group_', '');
			});

			url = SITE_ROOT +'Update/'+crtContextId+EXEC_requestSeparator+ 'confirmationDialog/'+crtWigiiNamespaceUrl+'/'+crtModuleName+'/element/setGroupsContainingElements/multiple';
			var myAjax = new jQuery.ajax({
					type: 'POST',
					url: encodeURI(url),
					success : parseUpdateResult,
					cache:false,
					data: {
						changeToUnselected: changeToUnselected.join(','),
						changeToSelected: changeToSelected.join(',')
					},
					error: errorOnUpdate
				});
			onUpdateErrorCounter = 0;
		}
		);

	//fetch the selected groups
	url = SITE_ROOT +'Update/'+crtContextId+EXEC_requestSeparator+ 'organizeDialog/'+crtWigiiNamespaceUrl+'/'+crtModuleName+'/element/getGroupsContainingElements/multiple';
	setVis('busyDiv', true);
	var myAjax = new jQuery.ajax({
			url: encodeURI(url),
			cache:false,
			success : function(returnText, textStatus){
				setVis('busyDiv', false);
				returnText = returnText.split(EXEC_answerRequestSeparator)[0].split(EXEC_answerParamSeparator);
				dialogTitle = returnText[1];
				$('#organizeDialog').prev().find('.ui-dialog-title').text(dialogTitle);
				eval(returnText[2]); //fill var originalFolders
				totalElementsChecked = parseInt($('#multipleDialog .summary .multipleSelectionNb').text());
				//result = '';
				for(i in originalFolders){
					groupId = i;
					isSelected = originalFolders[i]==totalElementsChecked;
					isMixed = originalFolders[i] && !isSelected;
					//result += 'group '+groupId+' is mixed '+isMixed+' and is selected '+isSelected+' | ';
					//always add selected even for mixed to make the li blue
					$('#organizeDialog>.groupPanel #group_'+groupId+', #organizeDialog>.groupPanel #group_'+groupId+'>div').addClass('selected');
					if(isMixed){
						$('#organizeDialog>.groupPanel #group_'+groupId+', #organizeDialog>.groupPanel #group_'+groupId+'>div').addClass('mixed wasMixed');
					} else if(isSelected){
						$('#organizeDialog>.groupPanel #group_'+groupId+', #organizeDialog>.groupPanel #group_'+groupId+'>div').addClass('wasSelected');
					}
				}
				$('#organizeDialog>.groupPanel li:not(.selected), #organizeDialog>.groupPanel li>div:not(.selected)').addClass('wasUnselected');
				// Medair (CWE) 02.02.2018 disables trashbin structure if at least one element is blocked
				if(multipleElementStatePerm & 2) {
					$('#organizeDialog>.groupPanel li.trashbin, #organizeDialog>.groupPanel li.trashbin li').removeClass("write").hide();
				}
				//disables read only groups
				$('#organizeDialog>.groupPanel li:not(.write)').addClass('disabled noRights');
				$('#organizeDialog>.groupPanel li:not(.write)>div').addClass('disabled noRights');				
				unfoldToSelectedGroupButNotChildren('#organizeDialog>.groupPanel');				
				positionSelectedGroup('#organizeDialog>.groupPanel');
			},
			error: errorOnUpdate
		});
	onUpdateErrorCounter = 0;
}

function removeElementInList(elementId){
	//if WNCD view, then notifies js client of deletion
	if($("#moduleView div.dataZone.wncd").length > 0) {
		wigii().getWncdContainer().elementDeleted(elementId);
	}
	else {
		//if the item was selected, then remove the highlights in the group panel
		if($("#moduleView #row_"+elementId).hasClass('S')){
			$('#groupPanel div.highlight').removeClass('highlight');
		}
		$("#moduleView #row_"+elementId).remove();
	}
}

function addElementInList(elementId){
	//check if element is in List (if for example adding with isKey feature
	if($("#moduleView #row_"+elementId).length){
		updateElementInList(elementId);
	} else {
		url = SITE_ROOT +"Update/"+crtContextId+EXEC_requestSeparator+ "row_"+elementId+"/"+crtWigiiNamespaceUrl+"/"+crtModuleName+"/addElementInList/"+elementId;
		setVis("busyDiv", true);
		var myAjax = new jQuery.ajax({
				url: encodeURI(url),
				cache:false,
				success : function(returnText, textStatus){

					setVis("busyDiv", false);
					otherRequest = returnText.split(EXEC_answerRequestSeparator);
					returnText = otherRequest[0].split(EXEC_answerParamSeparator);
					otherRequest.shift();
					i=1;

					//for blogView or any view implementing the folder list in the groupList
					if($('#moduleView .groupList').length>0){
						$('#moduleView .groupList').after(returnText[i++]);
					} else {
						$('#moduleView tr.folder:last').after(returnText[i++]);
					}

					if(otherRequest){
						parseUpdateResult(otherRequest.join(EXEC_answerRequestSeparator), textStatus);
					}

				},
				error: errorOnUpdate
			});
		onUpdateErrorCounter = 0;
	}
}
function updateElementInList(elementId){
	update("NoResponse/"+crtWigiiNamespaceUrl+"/"+crtModuleName+"/updateElementInList/"+elementId);
}
//elementIds must be ids separated with -
function updateElementsInList(elementIds){
	update("NoResponse/"+crtWigiiNamespaceUrl+"/"+crtModuleName+"/updateElementsInList/"+elementIds);
}

function unselectGroups(id, selectedClass){
	if(arguments.length < 2){
		selectedClass = "selected";
	}
	$(id+' li.'+selectedClass+', '+id+' li.'+selectedClass+'>div.'+selectedClass+'').removeClass(selectedClass);
	//don't need to change the location in this case as this function is always followed by an other one setting the location to the relevant value
	//self.location = '#'+crtWigiiNamespaceUrl+"/"+crtModuleName+"/folder/0";
}
function clickOnGroupInGroupPanel(id){
	$('#groupPanel #group_'+id+'').click();
}
function selectGroupInGroupPanel(){
	unselectGroups('#groupPanel');
	for(i=0; i<arguments.length; i++){
		id = arguments[i];
		$('#group_'+id+', #group_'+id+'>div').addClass('selected');
		//hide subfolders management in list if no subfolders
		if($('#group_'+id+' ul').length==0){
			$('#moduleView div.subFoldersContent, #moduleView div.subFoldersList').hide();
		} else {
			$('#moduleView div.subFoldersContent, #moduleView div.subFoldersList').show();
		}
		//hide parentGroup folder if parent group has no rights
		if($('#group_'+id+'').parent().parent().hasClass('noRights')){
			$('#moduleView div.folderUp').addClass('disabled');
		} else {
			$('#moduleView div.folderUp').removeClass('disabled');
		}
	}
	unfoldToSelectedGroup('#groupPanel');
	positionSelectedGroup('#groupPanel');
	resize_elementList();
	self.location = '#'+crtWigiiNamespaceUrl+"/"+crtModuleName+"/folder/"+id;
}
function selectGroup(groupId, id, selectedClass){
	if(arguments.length < 3){
		selectedClass = "selected";
	}
	unselectGroups(id, selectedClass);
	$('#group_'+groupId+', #group_'+groupId+'>div').addClass(selectedClass);
	unfoldToSelectedGroup(id, selectedClass);
	positionSelectedGroup(id, selectedClass);
}

function setListenersToGroupTree(id, selectedClass){
	if(arguments.length < 2){
		selectedClass = "selected";
	}
	//add click on context menu:
	$(id+' li:not(.disabled) .menu').click(function(e){
		$(id+' .over').removeClass('over');
		$(this).closest('div').addClass('over');
		positionElementOnDom($(id+'>.cm'), $(this), 'fromLeft', 5, false, true);
		//show hide some buttons:
		$(id+'>.cm div.write, '+id+'>.cm div.admin').hide();
		if($(this).parent().parent().hasClass('readOnly')){
			$(id+'>.cm div.readOnly').show();
		}
		if($(this).parent().parent().hasClass('share')){
			$(id+'>.cm div.share').show();
		}
		if($(this).parent().parent().hasClass('write')){
			$(id+'>.cm div.write').show();
		}
		if($(this).parent().parent().hasClass('admin')){
			$(id+'>.cm div.admin').show();
		}
		if($(this).parent().parent().hasClass('level1')){
			$(id+'>.cm div.level1').hide();
		}
		// hides empty group on trashbin until proper recursive deletion of files is coded (ticket 12796)
		if($(this).parent().parent().hasClass('trashbin')){
			$('#cm_emptyGroup').hide();
		}
		$(id+'>.cm').show();
		e.stopPropagation();
	});
	$(id+'>.cm').mouseleave(function(){
		$(id+' li>div').removeClass('over');
		$(this).hide();
	});
	$(id+'>.cm').click(function(e){
		$(id+' li>div').removeClass('over');
		$(this).hide();
		e.stopPropagation();
	});
	$(id+'>.cm>div').bind('contextmenu', function(e){ //disable the right click on context menu to prevent displaying context menu on right click
		e.stopPropagation();
		return false;
	});
	//add click on li: select folder
	$(id+' li>div>a.H').click(function(e){
		$(this).parent().click();
		e.stopPropagation();
		return false;
	});
	$(id+' li:not(.disabled)').click(function(e){
		selectGroup($(this).attr('id').split('_')[1], id, selectedClass);
		var span = $('>div>span.with-ul-hidden', this);
		if(span.length>0){
			span.click();
		}
		e.stopPropagation(); //very important to not click on the parent on the same time
	});
	$(id+' li:not(.disabled)').bind('contextmenu', function(e){
		$('>div>.menu', this).click();
//		positionElementOnDom($(id+'>.cm'), $(this), 'fromLeft', 5);
//		$(id+'>.cm').show();
		e.stopPropagation();
		return false;
	});
	//add click on folder: folde, unfold or select
	$(id+' li:not(.disabled) span.folder').click(function(e){
		var ul = $(this).parent().nextAll('ul');
		if(ul.length>0){
			$(this).toggleClass('with-ul-hidden').toggleClass('with-ul-displayed');
			ul.toggle();
		} else {
			//if no children then click on the parent
			$(this).parent().click();
		}
		e.stopPropagation();
	});
	$(id+' li>div>a.H').hover(function(){
		hideHelp();
		showHelp($(this), $(this).nextAll('.description').html(), 20, "fromCenter", 500);
//		positionElementOnDom($(this).nextAll('.description'), $(this), 'fromCenter', 20, false, true);
//		$(this).nextAll('.description').show();
	}, function(){
		hideHelp();
//		$(id+' .description').hide();
	});
	//add folders class
	$(id+' li>div>span.folder')
		.addClass('without-ul');
	$(id+' li:has(ul)>div>span.folder')
		.removeClass('without-ul')
		.addClass('with-ul-displayed');
	//the hidden selector could not work in the case of displaying in a dialog box which is not showned yet
//	$(id+' li:has(>ul:hidden)>div>span.folder')
	$(id+' li:has(>ul.n)>div>span.folder')
		.removeClass('without-ul')
		.removeClass('with-ul-displayed')
		.addClass('with-ul-hidden');

	setListnerForGroupDragAndDrop(id, id+' li.admin:not(.level1)', id+' li.write>div', selectedClass);
}


//this should be called as well on setListenerOnListRows...
function setListnerForGroupDragAndDrop(id, draggableSelector, dropableSelector, selectedClass){
	if(arguments.length < 4){
		selectedClass = "selected";
	}

	//add dragable for groups
	$(draggableSelector).draggable(
		{
			scroll: true,
			cursorAt: { top: 5, left: -10 },
			helper: function( event ) {
				var helpText = '';
				if($(this).hasClass('folder')){
					helpText = $(this).text();
				} else {
					helpText = $(this).find('>div>a').text();
				}
				return $( '<div class="ui-widget ui-corner-all SBIB" style="padding:5px;">'+helpText+"</div>" );
			}
		}
	);
	//add dropable for folder
	$(dropableSelector).droppable({
		accept: "#moduleView .dataList tr:not(.folder), " +
				"#moduleView .dataList tr.folder.admin:not(.level1), " +
				"#moduleView .dataBlog div.el, " +
				"#moduleView .dataBlog div.folder.admin:not(level1), " +
				""+id+" li.admin",
		hoverClass: "SBIB",
		tolerance: "pointer",
		greedy: true,
		drop: function( event, ui ) {
			if(ui.draggable.hasClass('admin')){
				//droping a folder
				var myUiDraggable = ui.draggable; //folder
				var helpText = '';
				var myThisDroppable = null;
				if($(this).hasClass('folder')){
					myThisDroppable = $(this); //folder
					helpText = myThisDroppable.text();
				} else {
					myThisDroppable = $(this).parent(); //folder
					helpText = myThisDroppable.find('>div>a').text();
				}

				jYescancel(DIALOG_doYouWantToMoveThisFolderUnderParent+helpText, null, function(check){
					if(check===true){
						//click on Ok button
						//simulate a edit group post
						setVis("busyDiv", true);
						$.post(
							"UPDATE/"+crtContextId+"/__/elementDialog/"+crtWigiiNamespaceUrl+"/Admin/groupEdit/"+crtModuleName+"/"+myUiDraggable.attr('id').split('_')[1]+"/"+id.replace('#',''),
							{
								//only post the groupParent to not change the other values....
								'isInitiatedFromDragDrop': true,
								'groupParent_value': myThisDroppable.attr('id').split('_')[1],
								'idForm': 'editGroup_form',
								'action': 'check'
							},
							function(tabReq, textStatus){
								parseUpdateResult(tabReq, textStatus);
								if(id.replace("#","")=="groupPanel"){
									clickOnGroupInGroupPanel(myUiDraggable.attr('id').split('_')[1]);
								} else {
									selectGroup(myUiDraggable.attr('id').split('_')[1], id, selectedClass);
								}
							}
						);
						//alert("folder "+myUiDraggable.attr('id').split('_')[1]+" is moved in folder "+myThisDraggable.parent().attr('id').split('_')[1]);
						//cancel current action
					} else if(check===null){
						//do nothing and cancel current action
					}
				});
			} else {
				//droping an element
				var myUiDraggable = ui.draggable; //element
				var helpText = '';
				var myThisDroppable = null;
				if($(this).hasClass('folder')){
					myThisDroppable = $(this); //folder
					helpText = myThisDroppable.text();
				} else {
					myThisDroppable = $(this).parent(); //folder
					helpText = myThisDroppable.find('>div>a').text();
				}

				$.alerts.noButton = DIALOG_keepInBoth;
				$.alerts.okButton = DIALOG_move;
				jConfirm('&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;'+DIALOG_doYouWantToMoveOrKeepInBoth+helpText+'?&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;', null, function(check){
					if(check===true){
						//click on Move button
						if(myUiDraggable.hasClass('M')){
							//droping elements
							setVis("busyDiv", true);
							$.post(
								"UPDATE/"+crtContextId+"/__/confirmationDialog/"+crtWigiiNamespaceUrl+"/"+crtModuleName+"/element/setGroupsContainingElements/multiple/drag",
								{
									'changeToSelected': myThisDroppable.attr('id').split('_')[1],
									'changeToUnselected' : ($(id+' li.selected').attr('id')?$(id+' li.selected').attr('id').split('_')[1]:'all')
								},
								parseUpdateResult
							);
							//alert("move multiple selection in folder "+myThisDraggable.parent().attr('id').split('_')[1]);
						} else {
							//droping an element
							setVis("busyDiv", true);
							$.post(
								"UPDATE/"+crtContextId+"/__/confirmationDialog/"+crtWigiiNamespaceUrl+"/"+crtModuleName+"/element/setGroupsContainingElement/"+myUiDraggable.attr('id').split('_')[1]+"/drag",
								{
									'actual': myThisDroppable.attr('id').split('_')[1],
									'original' : ($(id+' li.selected').attr('id')?$(id+' li.selected').attr('id').split('_')[1]:'all')
								},
								parseUpdateResult
							);
							//alert("move element "+myUiDraggable.attr('id').split('_')[1]+" in folder "+myThisDraggable.parent().attr('id').split('_')[1]);
						}
						//cancel current action
					} else if(check===null){
						//do nothing and cancel current action
					} else if(check===false){
						//do keep both button
						if(myUiDraggable.hasClass('M')){
							//droping elements
							setVis("busyDiv", true);
							$.post(
								"UPDATE/"+crtContextId+"/__/confirmationDialog/"+crtWigiiNamespaceUrl+"/"+crtModuleName+"/element/setGroupsContainingElements/multiple/drag",
								{
									'changeToSelected': myThisDroppable.attr('id').split('_')[1],
									'changeToUnselected' : ''
								},
								parseUpdateResult
							);
//							alert("add sharing multiple selection in folder "+myThisDraggable.parent().attr('id').split('_')[1]);
						} else {
							//droping an element
							setVis("busyDiv", true);
							$.post(
								"UPDATE/"+crtContextId+"/__/confirmationDialog/"+crtWigiiNamespaceUrl+"/"+crtModuleName+"/element/setGroupsContainingElement/"+myUiDraggable.attr('id').split('_')[1]+"/drag",
								{
									'actual': myThisDroppable.attr('id').split('_')[1],
									'original' : ''
								},
								parseUpdateResult
							);
							//alert("add sharing of element "+myUiDraggable.attr('id').split('_')[1]+" in folder "+myThisDraggable.parent().attr('id').split('_')[1]);
						}
					}
				});
				$.alerts.noButton = '&nbsp;No&nbsp;';
				$.alerts.okButton = '&nbsp;Ok&nbsp;';
			}
			event.stopPropagation();
		}
	});
}
crtGroupSelectorId = null;
crtMultipleSelectionDialogKeep = false;
function setListenersToGroupPanel(doYouWantToRemoveYouMultipleSelectionText){
	//add click on keep notified
	if($('#keepNotifyButton').length){
		$('#keepNotifyButton').click(openKeepNotifiedDialog);
	}

	$('#groupPanel li.noRights, #groupPanel li.noRights>div').addClass('disabled');

	setListenersToGroupTree('#groupPanel');

	//add click on collapse div
		$('#groupPanel>.collapse').click(function(){
			$("#groupPanel").data('userClickCollapse',true);
			if($('#groupPanel>ul#group_0:hidden').length){
				$('#groupPanel>ul#group_0').show();
				$('#groupPanel>.keepNotify').show();
				positionSelectedGroup("#groupPanel");
				$(this).html("&laquo;");
			} else {
				$('#groupPanel>ul#group_0').hide();
				$('#groupPanel>.keepNotify').hide();
				$(this).html("&raquo;");
			}

			resize_elementList();
			resize_coverPage();
			resize_portal();
		});
	
	$('#dockingContainer>.collapse').click(function(){
//	$('#dockingContainer>.collapse span').click(function(){
		var docking = $('#dockingContainer'),
			moduleView = $('#moduleView');
//		$(this).data('userClickCollapse',true);
		$(this).find('span').data('userClickCollapse',true);
		if(docking.find('#moduleView:hidden').length){
			moduleView.show();
//			$(this).html("&laquo;");
			$(this).find('span').html("&laquo;");
		} else {
			moduleView.hide();
//			$(this).html("&raquo;");
			$(this).find('span').html("&raquo;");
		}

		resize_elementList();
		resize_coverPage();
		resize_portal();
	});

	//add resize on fold/unfold folder
	$('#groupPanel li span.folder').click(function(){
		resize_elementList();
	});
	//add click on li: select folder
	$('#groupPanel li').click(function(e){
		resize_elementList();
		var idGroup = $(this).attr('id').split('_')[1];
		self.location = '#'+crtWigiiNamespaceUrl+'/'+crtModuleName+'/folder/'+idGroup;
		//if there is a multiple selection dialog box open, ask if we want to keep the current multiple selection
//		alert($('#multipleDialog .multipleSelectionNb').text());
		if(!crtMultipleSelectionDialogKeep && crtGroupSelectorId != idGroup && $('#multipleDialog .multipleSelectionNb').length && $('#multipleDialog .multipleSelectionNb').text()!="0"){
			$.alerts.noButton = '&nbsp;'+DIALOG_keepSelectionLabel+'&nbsp;';
			$.alerts.okButton = '&nbsp;'+DIALOG_discardSelectionLabel+'&nbsp;';
			var crtGroupHref = $('>div>a.H', this).attr('href').replace('#','');
			jConfirm(doYouWantToRemoveYouMultipleSelectionText, null, function(check){
				if(check===true){
					//click on Ok button
					$('.ui-dialog-titlebar-close', $('#multipleDialog').closest('.ui-dialog')).click();
					updateThroughCache('moduleView', crtGroupHref, 'NoAnswer/'+crtWigiiNamespaceUrl+'/'+crtModuleName+'/groupSelectorPanel/selectGroup/'+idGroup+'', 1, 1);
				} else if(check===null){
					//do nothing and cancel current action
					idGroup = crtGroupSelectorId;
					$('#groupPanel #group_'+idGroup).click();
				} else if(check===false){
					//keep multiple selection
					crtMultipleSelectionDialogKeep = true;
					updateThroughCache('moduleView', crtGroupHref, 'NoAnswer/'+crtWigiiNamespaceUrl+'/'+crtModuleName+'/groupSelectorPanel/selectGroup/'+idGroup+'', 1, 1);
				}
				crtGroupSelectorId = idGroup;
			});
			$.alerts.noButton = '&nbsp;No&nbsp;';
			$.alerts.okButton = '&nbsp;Ok&nbsp;';
		} else {
			updateThroughCache('moduleView', $('>div>a.H', this).attr('href').replace('#',''), 'NoAnswer/'+crtWigiiNamespaceUrl+'/'+crtModuleName+'/groupSelectorPanel/selectGroup/'+idGroup+'', 1, 1);
			crtGroupSelectorId = idGroup;
		}
		e.stopPropagation();
	});
	//add click on root ul if some root groups are available
	$('#groupPanel ul#group_0').click(function(){
		if($(this).children('li:not(.noRights)').length>0){
			unselectGroups('#groupPanel');
			var idGroup = +$(this).attr('id').split('_')[1];
			self.location = '#'+crtWigiiNamespaceUrl+'/'+crtModuleName+'/folder/'+idGroup;
			updateThroughCache('moduleView', $(this).attr('href').replace('#',''), 'NoAnswer/'+crtWigiiNamespaceUrl+'/'+crtModuleName+'/groupSelectorPanel/selectGroup/'+idGroup+'', 1, 1);
		} else {
			//if no groups selected then select the first group available
			$('li:not(.noRights):first').click();
		}
	});

	//add click on context menu:
	$('#groupPanel>.cm>div').click(function(){
		var groupItem = $('#groupPanel li>div.over').parent();
		var idGroup = groupItem.attr('id').split('_')[1];

		if($(this).attr('id')=="cm_exit") return true;
		if($(this).attr('id')=="cm_select"){
			groupItem.click();
			return true;
		}
		
		var responseDiv = 'elementDialog';
		if(isWorkzoneViewDocked()) responseDiv = 'confirmationDialog';
		
		if($(this).attr('id')=="cm_findDuplicatesIn"){
			//this action is special as it take the current context to find duplicates.
			//so it is good to first load the current folder
			groupItem.click();
			update('organizeDialog/'+crtWigiiNamespaceUrl+'/'+crtModuleName+'/findDuplicatesIn/');
			return true;
		}
		if($(this).attr('id')=="cm_add"){
			update('elementDialog/'+crtWigiiNamespaceUrl+'/'+crtModuleName+'/element/add/'+idGroup);
			groupItem.click();
			return true;
		}
		if($(this).attr('id')=="cm_renameGroup"){
			update(responseDiv+'/'+crtWigiiNamespaceUrl+'/Admin/groupEdit/'+crtModuleName+'/'+idGroup+'/groupPanel');
			groupItem.click();
			return true;
		}
		if($(this).attr('id')=="cm_deleteGroup"){
			update(responseDiv+'/'+crtWigiiNamespaceUrl+'/Admin/groupDelete/'+crtModuleName+'/'+idGroup+'/groupPanel');
			groupItem.click();
			return true;
		}
		if($(this).attr('id')=="cm_emptyGroup"){
			update(responseDiv+'/'+crtWigiiNamespaceUrl+'/Admin/groupEmpty/'+crtModuleName+'/'+idGroup+'/groupPanel');
			groupItem.click();
			return true;
		}
		if($(this).attr('id')=="cm_createSubGroup"){
			update(responseDiv+'/'+crtWigiiNamespaceUrl+'/Admin/groupNew/'+crtModuleName+'/'+idGroup+'/groupPanel');
			groupItem.click();
			return true;
		}
		if($(this).attr('id')=="cm_copyGroup"){
			update('elementDialog/'+crtWigiiNamespaceUrl+'/Admin/groupNewCopy/'+crtModuleName+'/'+idGroup+'/groupPanel');
			groupItem.click();
			return true;
		}
		if($(this).attr('id')=="cm_groupDetail"){
			update('elementDialog/'+crtWigiiNamespaceUrl+'/Admin/groupDetail/'+crtModuleName+'/'+idGroup+'/groupPanel');
			return true;
		}
		if($(this).attr('id')=="cm_portal"){
			update('elementDialog/'+crtWigiiNamespaceUrl+'/Admin/groupPortal/'+crtModuleName+'/'+idGroup+'/groupPanel');
			return true;
		}
		if($(this).attr('id')=="cm_htmlContent"){
			update('elementDialog/'+crtWigiiNamespaceUrl+'/Admin/groupHtmlContent/'+crtModuleName+'/'+idGroup+'/groupPanel');
			return true;
		}
		if($(this).attr('id')=="cm_subscription"){
			update(responseDiv+'/'+crtWigiiNamespaceUrl+'/Admin/groupSubscription/'+crtModuleName+'/'+idGroup+'/groupPanel');
			return true;
		}
		if($(this).attr('id')=="cm_emailNotification"){
			update(responseDiv+'/'+crtWigiiNamespaceUrl+'/Admin/groupEmailNotification/'+crtModuleName+'/'+idGroup+'/groupPanel');
			return true;
		}
		if($(this).attr('id')=="cm_xmlPublish"){
			update(responseDiv+'/'+crtWigiiNamespaceUrl+'/Admin/groupXmlPublish/'+crtModuleName+'/'+idGroup+'/groupPanel');
			return true;
		}
	});
}

function setListenersToIndicator(){
	$('#indicators .closeIndicators').click(function(){
		$('#indicators div.indicator').hide();
		$('#indicators div.closeIndicators').hide();
		$('#indicators div.showIndicators').show();
		update('NoAnswer/'+crtWigiiNamespaceUrl+'/'+crtModuleName+'/closeIndicators');
	});
	$('#indicators .showIndicators').click(function(){
		update('NoAnswer/'+crtWigiiNamespaceUrl+'/'+crtModuleName+'/showIndicators');
	});
	$('#indicators div.indicator:not(.system)').mouseenter(function(){
		$('#indicators div.indicator .closeIndicator').stop().remove();
		$(this).append('<div class=\"closeIndicator\" style=\"font-size:11px;float:right;padding:3px;margin-top:-8px;margin-right:-5px;margin-left:2px;cursor:pointer;display:none;\">x</div>');
		$('.closeIndicator', this).show().click(function(){
			$(this).parent().fadeOut(800, function(){ $(this).remove(); });
			update('NoAnswer/'+crtWigiiNamespaceUrl+'/'+crtModuleName+'/closeIndicator/'+$(this).parent().attr('id'));
		});
	});
	$('#indicators div.indicator').mouseleave(function(){
		$('.closeIndicator', this).stop().fadeOut(500, function(){ $(this).remove(); });
	});
}

menuTimeout = new Object();
function setListenersToMenu(buttonId, menuId, dialogTarget, action, actionParameter, clickToOpen){
	if(arguments.length<5 || actionParameter==null){
		actionParameter = "";
	}
	if(arguments.length<6){
		clickToOpen = false;
	}
	if(!clickToOpen){
		$('#'+buttonId).mouseenter(function(e){
			clearTimeout(menuTimeout[menuId]);
			var handler = $(this);
			menuTimeout[menuId] = setTimeout(function(){
				positionElementOnDom($('#'+menuId), handler, 'fromLeft', 26, true);
				var winH = window.innerHeight || document.documentElement.clientHeight || document.body.clientHeight;
				$('#'+menuId).css('overflow-y','auto').css('max-height',winH-20);
				$('#'+menuId).show().scrollTop(0);
			},150);
			e.stopPropagation();
		}).click(function(e){
			e.stopPropagation();
			e.preventDefault();
			return false;
		});
	} else {
		$('#'+buttonId).click(function(e){
			clearTimeout(menuTimeout[menuId]);
			positionElementOnDom($('#'+menuId), $(this), 'fromLeft', 26);
			var winH = window.innerHeight || document.documentElement.clientHeight || document.body.clientHeight;
			$('#'+menuId).css('overflow-y','auto').css('max-height',winH-20);
			$('#'+menuId).show().scrollTop(0);
			e.stopPropagation();
			e.preventDefault();
			return false;
		});
	}
	$('#'+buttonId).mouseleave(function(e){ clearTimeout(menuTimeout[menuId]); menuTimeout[menuId] = setTimeout(function(){ $('#'+menuId).hide();}, 300); });
	$('#'+menuId)
		.mouseleave(function(){
			clearTimeout(menuTimeout[menuId]); menuTimeout[menuId] = setTimeout(function(){ $('#'+menuId).hide();}, 300);
		}).mouseenter(function(){ clearTimeout(menuTimeout[menuId]); });
	$('#'+menuId+'>div').click(function(e){
			if(!$(this).hasClass('exit')){
				if(dialogTarget!=null && action!=null){
					update(dialogTarget+'/'+crtWigiiNamespaceUrl+'/'+crtModuleName+'/'+action+'/'+$('a:first', this).attr('href').replace('#', '')+'/'+actionParameter);
				}
			}
			clearTimeout(menuTimeout[menuId]);
			$('#'+menuId).hide();
			e.stopPropagation();
			return false;
		});
}

function setListenersToMenuBsp(buttonId, menuId, dialogTarget, action, actionParameter, clickToOpen){
	$('#'+buttonId+' li a').click(function(){
		if($(this).hasClass('changeOrder')){
			order = ($(this).hasClass('ASC')?false:true);
            update(dialogTarget+'/'+crtWigiiNamespaceUrl+'/'+crtModuleName+'/'+action+'/'+$(this).attr('href').replace('#', '')+'/'+order);
			return false;
		}
        update(dialogTarget+'/'+crtWigiiNamespaceUrl+'/'+crtModuleName+'/'+action+'/'+$(this).attr('href').replace('#', '')+'/'+actionParameter);
        return false;
    });
}


//listSelector: #moduleView .list
//elSelector: #moduleView .dataList tr.el
//folderSelector : #moduleView .dataList tr.folder
//cmSelector :  #moduleView .list>.cm
function setListenersToRows(listSelector, elSelector, folderSelector, cmSelector){

	if(arguments.length<4){	var cmSelector = '#moduleView .list>.cm'; }
	if(arguments.length<3){	var folderSelector = '#moduleView .dataList tr.folder'; }
	if(arguments.length<2){	var elSelector = '#moduleView .dataList tr.el'; }
	if(arguments.length<1){	var listSelector = '#moduleView .list'; }

	//make element draggable in foders if write on element and if write on folder
	var dragHandler = '.dragHandler';
	if($(elSelector+' .dragHandler').length==0){
		dragHandler = null;
	}
	$(elSelector+':not(.readOnly)').draggable(
			{
				scroll: true,
				cursorAt: { top: 5, left: -10 },
				handle: dragHandler,
				helper: function( event ) {
					if($(this).hasClass('M')){
						return $( '<div class="ui-widget ui-corner-all SBIB" style="padding:5px;">'+$('#multipleDialog .summary').html()+"</div>");
					}
					return $( '<div class="ui-widget ui-corner-all SBIB" style="padding:5px;">'+$(this).children().map(function(){ if($(this).text() && $(this).is(':visible')) { return $(this).text(); } else { return null; } }).get().join(" ").substring(0,30)+"...</div>" );
				}
			}
		);

	setListnerForGroupDragAndDrop('#groupPanel', folderSelector+'.admin:not(.level1)', folderSelector+'.write');


	$(elSelector).unbind('click');
	$(elSelector).click(function(e){
		$(elSelector).removeClass('S');
		$(this).addClass('S');
		idItem = $(this).attr('id').split('_')[1];
		self.location = '#'+crtWigiiNamespaceUrl+'/'+crtModuleName+'/item/'+idItem;
		updateThroughCache('elementDialog', $(this).attr('href').replace('#', ''), 'elementDialog/'+crtWigiiNamespaceUrl+'/'+crtModuleName+'/element/detail/'+idItem+'');
	});
	$(elSelector).unbind('contextmenu');
	$(elSelector).bind("contextmenu", function(e) {
		hideHelp();
		$('.menu', this).click(); //.trigger('click', e);
		positionElementOnMouse($(cmSelector), e, 'fromRight', null, 5);
		//$(cmSelector).css('left', e.clientX-5+parseInt($(document).scrollLeft()));
		//$(cmSelector).css('top', e.clientY-5+parseInt($(document).scrollTop()));
	    return false;
	});

	//add info bull preview of content of cell
	ModuleView_dataListIsMouseDrag = false;
	$('#moduleView .dataList tr.el>td>div').unbind();
	$('#moduleView .dataList tr.el>td>div')
		.mouseenter(function(e){
			if($(this).hasClass('helpWidth')){
				w = $(this).attr('class').match(/ help_(.*) /g)[0].replace(/ help_(.*) /g, '$1');
			} else {
				w = Math.min(400, Math.max(200, $(this).width())); //take the width of the column min 200 max 400
			}
			showHelp(this, $(this).html(), 30, 'fromLeft', 500, w, 60000, e);
		})
		.mouseleave(function(e){ hideHelp(); })
		.click(function(e){
			if(e.ctrlKey){
				ModuleView_dataListIsMouseDrag = true;
				if($('#summaryDialog:visible').length==0){
					if(!$('#summaryDialog').hasClass('ui-draggable')){
						$('#summaryDialog').draggable({ handle: '.handler', cursor: 'crosshair'});
//						$('#summaryDialog>textarea').autosize();
					}
					$('#summaryDialog').show();
				}
				if($('#summaryDialog>textarea.content').val()!=""){
					$('#summaryDialog>textarea.content').val($('#summaryDialog>textarea.content').val()+", ");
				}
				$('#summaryDialog>textarea.content').val($('#summaryDialog>textarea.content').val()+$(this).text()).focus();
				$('#summaryDialog>textarea.content').scrollTop('9999999');
				e.stopPropagation();
				var sel ;
				if(document.selection && document.selection.empty){
					document.selection.empty() ;
				} else if(window.getSelection) {
					sel=window.getSelection();
				if(sel && sel.removeAllRanges)
					sel.removeAllRanges() ;
				}
				return false;
			} else {
				ModuleView_dataListIsMouseDrag = false;
			}
		});


	//!!the display or not of the subFolders button is managed in the selectGroupInGroupPanel() JS function!!!

	//prevent click propagation on file downloads
	$(elSelector+' div.value div.file a').unbind();
	$(elSelector+' div.value div.file a').click(function(e){ e.stopPropagation(); });

	//add click on context menu:
	$(elSelector+' div.max').unbind();
	$(elSelector+' div.max').click(function(e){
		var el = $(this).closest(elSelector);
		if(el.hasClass('max')){
			el.removeClass('max');
			el.css('min-width',0);
			resize_elementList();
		} else {
			el.addClass('max');
			el.css('min-width',el.width());
			el.width('auto');
		}
		e.stopPropagation();
	});

	//add click on context menu:
	$(elSelector+' div.menu').unbind();
	$(elSelector+' div.menu').click(function(e){
		$(this).closest(elSelector).addClass('over');
		positionElementOnDom($(cmSelector), $(this), 'fromRight', 5);
		//show hide some buttons:
		elEnableState = $('.elEnableState', this).html();
		elState = $('.elState', this).html();
		// Medair (CWE) 02.02.2018: saves element state in Wigii Api context for further use
		wigii().context.crtElementState = Number(elState);
		
		if($(this).parent().parent().hasClass('readOnly')){
			$(cmSelector+' div.write').hide();
		} else {
			$(cmSelector+' div.write').show();
		}
		if($('#moduleView .toolBar .addNewElement.disabledBg').length>0){
			$(cmSelector+' #cm_addElementInList').hide();
		} else {
			$(cmSelector+' #cm_addElementInList').show();
		}
		// if blocked, then hides modify, delete and organize
		if(elState & 2) {
			$(cmSelector+' #cm_edit').hide();
			$(cmSelector+' #cm_delete').hide();
			// by default, hides organize, except if:
			// - Medair (CWE) 30.01.2018 if especifically enabled on blocked elements
			if(!(elEnableState & 2048)) $(cmSelector+' #cm_organize').hide();
		}
		// enables lock
		if(elEnableState & 1) {
			s = $(cmSelector+' #cm_lock');
			// checks or unchecks menu entry
			if(elState & 1) s.addClass('checked').removeClass('unchecked');
			else s.addClass('unchecked').removeClass('checked');
		}
		else $(cmSelector+' #cm_lock').hide();
		// enables block
		if(elEnableState & 2) {
			s = $(cmSelector+' #cm_block');
			// checks or unchecks menu entry
			if(elState & 2) s.addClass('checked').removeClass('unchecked');
			else s.addClass('unchecked').removeClass('checked');
		}
		else $(cmSelector+' #cm_block').hide();
		// enables important1
		if(elEnableState & 4) {
			s = $(cmSelector+' #cm_state_important1');
			// checks or unchecks menu entry
			if(elState & 4) s.addClass('checked').removeClass('unchecked');
			else s.addClass('unchecked').removeClass('checked');
		}
		else $(cmSelector+' #cm_state_important1').hide();
		// enables important2
		if(elEnableState & 8) {
			s = $(cmSelector+' #cm_state_important2');
			// checks or unchecks menu entry
			if(elState & 8) s.addClass('checked').removeClass('unchecked');
			else s.addClass('unchecked').removeClass('checked');
		}
		else $(cmSelector+' #cm_state_important2').hide();
		// enables finalize
		if(elEnableState & 16) {
			s = $(cmSelector+' #cm_finalize');
			// checks or unchecks menu entry
			if(elState & 16) s.addClass('checked').removeClass('unchecked');
			else s.addClass('unchecked').removeClass('checked');
		}
		else $(cmSelector+' #cm_finalize').hide();
		// enables approve
		if(elEnableState & 32) {
			s = $(cmSelector+' #cm_approve');
			// checks or unchecks menu entry
			if(elState & 32) s.addClass('checked').removeClass('unchecked');
			else s.addClass('unchecked').removeClass('checked');
		}
		else $(cmSelector+' #cm_approve').hide();
		// enables dismiss
		if(elEnableState & 64) {
			s = $(cmSelector+' #cm_dismiss');
			// checks or unchecks menu entry
			if(elState & 64) s.addClass('checked').removeClass('unchecked');
			else s.addClass('unchecked').removeClass('checked');
		}
		else $(cmSelector+' #cm_dismiss').hide();
		// enables archived
		if(elEnableState & 128) {
			s = $(cmSelector+' #cm_state_archived');
			// checks or unchecks menu entry
			if(elState & 128) s.addClass('checked').removeClass('unchecked');
			else s.addClass('unchecked').removeClass('checked');
		}
		else $(cmSelector+' #cm_state_archived').hide();
		// enables deprecated
		if(elEnableState & 256) {
			s = $(cmSelector+' #cm_state_deprecated');
			// checks or unchecks menu entry
			if(elState & 256) s.addClass('checked').removeClass('unchecked');
			else s.addClass('unchecked').removeClass('checked');
		}
		else $(cmSelector+' #cm_state_deprecated').hide();
		// enables hide
		if(elEnableState & 512) {
			s = $(cmSelector+' #cm_hide');
			// checks or unchecks menu entry
			if(elState & 512) s.addClass('checked').removeClass('unchecked');
			else s.addClass('unchecked').removeClass('checked');
		}
		else $(cmSelector+' #cm_hide').hide();
		
		// hides delete if non admin and enableDeleteOnlyForAdmin=1
		if(elEnableState & 1024) {
			$(cmSelector+' #cm_delete').hide();
		}

		$(cmSelector).show();
		e.stopPropagation();
	});

	//add click on multiple select
	//this needs to include as well the folders, not only the elements
	$(elSelector+' div.mul').unbind();
	$(elSelector+' div.mul, '+folderSelector+' div.mul').click(function(e){
		if($(this).parent().parent().hasClass('folder')){
			clickFolderLineInMultipleSelectionMode($(this).closest(folderSelector));
		} else {
			clickLineInMultipleSelectionMode($(this).closest(elSelector));
		}
		e.stopPropagation();
	});

	//make new lines, no more new
	$(listSelector+' .new').removeClass("new");

}
function setListenersToElementList(){

	//add click on multiple select All
	$('#moduleView .list .headerList div.mul').click(function(e){
		$(this).addClass('M');
		selectAllMultipleSelect();
		setTimeout(function(){ $('#moduleView .list .headerList div.mul').removeClass('M'); }, 500);
		e.stopPropagation();
	});

	//add click on folder up
	$('#moduleView .dataList tr.folder div.folderUp').click(function(e){
		$('#groupPanel #group_'+$(this).parent().parent().attr('id').split('_')[1]).click();
		e.stopPropagation();
	});

	//add click on folder line
	$('#moduleView .dataList tr.folder').click(function(e){
		$('#groupPanel #group_'+$(this).attr('id').split('_')[1]).click();
		e.stopPropagation();
	});
	//add click on see subFolders content
	$('#moduleView .dataList tr.folder div.subFoldersContent').click(function(e){
		tempGroupId = $('#groupPanel li.selected');
		if(tempGroupId.length>0){
			tempGroupId = tempGroupId.attr('id').split('_')[1];
		} else {
			tempGroupId = 0;
		}
		updateThroughCache('moduleView', $(this).attr('href').replace('#', ''), 'NoAnswer/'+crtWigiiNamespaceUrl+'/'+crtModuleName+'/groupSelectorPanel/selectGroupAndChildren/'+tempGroupId+'', 0, 1);
		e.stopPropagation();
	});
	//add click on reset to subFolder list
	$('#moduleView .dataList tr.folder div.subFoldersList').click(function(e){
		if($('#groupPanel li.selected').length>0){
			$('#groupPanel li.selected').click();
		} else {
			$('#groupPanel ul#group_0').click();
		}
		e.stopPropagation();
	});

	//!!the display or not of the subFolders button is managed in the selectGroupInGroupPanel() JS function!!!

	//set listener to list header
	$('#moduleView .headerList>div:not(.noSorting)').click(function(){
		//define the fieldName
		fieldName = $(this).attr('class');
		fieldName = fieldName.match('key_([^\ ]*)');
		if(!fieldName) return;
		fieldName = fieldName[1];
		//take off for all other headers the sorting class
		$('#moduleView .headerList>div').not($(this)).removeClass('DESC').removeClass('ASC');
		if(!($(this).hasClass('ASC')) && !($(this).hasClass('DESC'))){
			if($(this).hasClass('defaultSorted')){
				sortedDir = $(this).attr('class').match('defaultSorted_([^\ ]*)')[1];
				$(this).addClass(sortedDir);
			} else {
				$(this).addClass('ASC');
			}
		} else {
			$(this).toggleClass('DESC').toggleClass('ASC');
		}
		update('moduleView/'+crtWigiiNamespaceUrl+'/'+crtModuleName+'/changeSortByKey/'+fieldName+'/'+$(this).hasClass('ASC'));
	});
	
	//make a global variable to store the rezise column
	window.customHeaderSize = [];
	//Add a rezise event on each column with classname begin by 'key_'
	$('#moduleView .headerList>div[class^="key_"]').resizable({
		handles: 'e',
		create: function( event, ui ) {
			// Initialize the resize
            // Prefers an another cursor with two arrows
            $(".ui-resizable-e").css("cursor","col-resize").click(function(event){
            	//Stop the propagation of mouse click in sort column
            	event.stopImmediatePropagation();
            });
        },
		start: function(event, ui) {
			// Loop into each header div to remove the noWidth class attribut
			$('#moduleView .headerList>div').each(function( index ) {
				  $(this).removeClass('noWidth');
			});
	    },
		resize: function (event, ui){
			var unitOfMeasure = 'px';
			//retrieve the position of an element relative to its parent
			var pos = $('#moduleView .headerList>div').index(this);
			this.style.width = ui.size.width+'px';
			//change the size of cols in colgroup
			var colgroup = $('.dataList colgroup').children();
			colgroup[pos].style.width = ui.size.width + 17 + unitOfMeasure; //add 17px beacause it's the différance of size
	
			//restore the other custom size, this function is to bypass bizarre behavior of jquery
			var currentField = getFieldName(this);
			if(window.customHeaderSize) {
				for (var key in window.customHeaderSize) {
					if(key != currentField) window.customHeaderSize[key].obj.style.width = window.customHeaderSize[key].width + unitOfMeasure;
				}
			}
		},
		stop: function(event, ui) {
			//Store the custom size of column in variable
			var fieldName = getFieldName(this);
			window.customHeaderSize[fieldName] = {"obj": this, "width": ui.size.width};
			this.style.width = ui.size.width;
			update('NoAnswer/'+crtWigiiNamespaceUrl+'/'+crtModuleName+'/saveListViewUIPref/'+fieldName+'/width/'+ui.size.width);
			//Invoke the methode of resizing window
			resize_elementList();
	    }
	});
	
	//function to extract the field name
	function getFieldName(header) {
		var fieldName = header.className;
		fieldName = fieldName.match('key_([^\ ]*)');
		fieldName = fieldName[1].replace(/(value)|__element/i, '');
		fieldName = fieldName.replace('(','').replace('(','');
		fieldName = fieldName.replace(')','').replace(')','');
		return fieldName;
	}
	
	//set listeners to contextMenu
	$('#moduleView .list>.cm').mouseleave(function(){
		$('#moduleView .dataList tr').removeClass('over');
		$(this).hide();
	});
	$('#moduleView .list>.cm').click(function(){
		$('#moduleView .dataList tr').removeClass('over');
		$(this).hide();
	});
	$('#moduleView .list>.cm>div').click(function(){
		if($(this).attr('id')=="cm_exit") return true;
		if($(this).attr('id')=="cm_open"){
			$('#moduleView .dataList tr.el.over').click();
			return true;
		}
		idItem = $('#moduleView .dataList tr.el.over').attr('id').split('_')[1];
		if($(this).attr('id')=="cm_addElementInList"){
			$('#searchBar .toolbarBox .addNewElement').click();
			//update('elementDialog/'+crtWigiiNamespaceUrl+'/'+crtModuleName+'/element/add/'+$('#groupPanel li.selected').attr('id').split('_')[1]);
			return true;
		}
		//select the current line
		$('#moduleView .dataList tr.S').removeClass('S');
		$('#row_'+idItem).addClass('S');
		self.location = '#'+crtWigiiNamespaceUrl+'/'+crtModuleName+'/item/'+idItem;
		// toggles checkbox value
		if($(this).hasClass('unchecked')) {
			checked = 1;
			$(this).removeClass('unchecked').addClass('checked');
		}
		else if($(this).hasClass('checked')) {
			checked = 0;
			$(this).removeClass('checked').addClass('unchecked');
		}
		else checked = -1;

		if($(this).attr('id')=="cm_edit"){
			update('elementDialog/'+crtWigiiNamespaceUrl+'/'+crtModuleName+'/element/edit/'+idItem);
			return true;
		}
		if($(this).attr('id')=="cm_delete"){
			var responseDiv = 'elementDialog';
			//update('elementDialog/'+crtWigiiNamespaceUrl+'/'+crtModuleName+'/element/delete/'+idItem+'/elementDialog');
			if(isWorkzoneViewDocked()) responseDiv = 'confirmationDialog';
			update(responseDiv+'/'+crtWigiiNamespaceUrl+'/'+crtModuleName+'/element/delete/'+idItem+'/elementDialog');
			return true;
		}
		if($(this).attr('id')=="cm_copy"){
			copyWithOrganize('elementDialog/'+crtWigiiNamespaceUrl+'/'+crtModuleName, idItem);
			//update('elementDialog/'+crtWigiiNamespaceUrl+'/'+crtModuleName+'/element/copy/'+idItem+'/'+$('#groupPanel li.selected').attr('id').split('_')[1]);
			return true;
		}
		if($(this).attr('id')=="cm_organize"){
			openOrganizeDialog(idItem);
			return true;
		}
		if($(this).attr('id')=="cm_lock"){
			if(checked >= 0) update('NoAnswer/'+crtWigiiNamespaceUrl+'/'+crtModuleName+'/setElementState/'+idItem+'/locked/'+checked+'/');
			return true;
		}
		if($(this).attr('id')=="cm_block"){
			if(checked >= 0) update('NoAnswer/'+crtWigiiNamespaceUrl+'/'+crtModuleName+'/setElementState/'+idItem+'/blocked/'+checked+'/');
			return true;
		}
		if($(this).attr('id')=="cm_state_important1"){
			if(checked >= 0) update('NoAnswer/'+crtWigiiNamespaceUrl+'/'+crtModuleName+'/setElementState/'+idItem+'/important1/'+checked+'/');
			return true;
		}
		if($(this).attr('id')=="cm_state_important2"){
			if(checked >= 0) update('NoAnswer/'+crtWigiiNamespaceUrl+'/'+crtModuleName+'/setElementState/'+idItem+'/important2/'+checked+'/');
			return true;
		}
		if($(this).attr('id')=="cm_finalize"){
			if(checked >= 0) update('NoAnswer/'+crtWigiiNamespaceUrl+'/'+crtModuleName+'/setElementState/'+idItem+'/finalized/'+checked+'/');
			return true;
		}
		if($(this).attr('id')=="cm_approve"){
			if(checked >= 0) update('NoAnswer/'+crtWigiiNamespaceUrl+'/'+crtModuleName+'/setElementState/'+idItem+'/approved/'+checked+'/');
			return true;
		}
		if($(this).attr('id')=="cm_dismiss"){
			if(checked >= 0) update('NoAnswer/'+crtWigiiNamespaceUrl+'/'+crtModuleName+'/setElementState/'+idItem+'/dismissed/'+checked+'/');
			return true;
		}
		if($(this).attr('id')=="cm_state_archived"){
			if(checked >= 0) update('NoAnswer/'+crtWigiiNamespaceUrl+'/'+crtModuleName+'/setElementState/'+idItem+'/archived/'+checked+'/');
			return true;
		}
		if($(this).attr('id')=="cm_state_deprecated"){
			if(checked >= 0) update('NoAnswer/'+crtWigiiNamespaceUrl+'/'+crtModuleName+'/setElementState/'+idItem+'/deprecated/'+checked+'/');
			return true;
		}
		if($(this).attr('id')=="cm_hide"){
			if(checked >= 0) update('NoAnswer/'+crtWigiiNamespaceUrl+'/'+crtModuleName+'/setElementState/'+idItem+'/hidden/'+checked+'/');
			return true;
		}
	});

	//set listeners to loadMoreLines
	setListenersToLoadMoreLines("getNextElementInList", "#moduleView .list", "#moduleView .list .dataList table tbody");

	setListenersToRows();
}

function setListenersToElementBlog(){

	//add click on folder line
	$('#moduleView .dataBlog div.groupList div.folder:not(.subFoldersContent, .subFoldersList)').click(function(e){
		$('#groupPanel #group_'+$(this).attr('id').split('_')[1]).click();
		e.stopPropagation();
	});
	//add click on see subFolders content
	$('#moduleView .dataBlog div.groupList div.subFoldersContent').click(function(e){
		tempGroupId = $('#groupPanel li.selected');
		if(tempGroupId.length>0){
			tempGroupId = tempGroupId.attr('id').split('_')[1];
		} else {
			tempGroupId = 0;
		}
		updateThroughCache('moduleView', $(this).attr('href').replace('#', ''), 'NoAnswer/'+crtWigiiNamespaceUrl+'/'+crtModuleName+'/groupSelectorPanel/selectGroupAndChildren/'+tempGroupId+'', 0, 1);
		e.stopPropagation();
	});
	//add click on reset to subFolder list
	$('#moduleView .dataBlog div.groupList div.subFoldersList').click(function(e){
		if($('#groupPanel li.selected').length>0){
			$('#groupPanel li.selected').click();
		} else {
			$('#groupPanel ul#group_0').click();
		}
		e.stopPropagation();
	});

	//!!the display or not of the subFolders button is managed in the selectGroupInGroupPanel() JS function!!!

	//set listeners to contextMenu
	$('#moduleView .blog>.cm').mouseleave(function(){
		$('#moduleView .dataBlog div.el').removeClass('over');
		$(this).hide();
	});
	$('#moduleView .blog>.cm').click(function(){
		$('#moduleView .dataBlog div.el').removeClass('over');
		$(this).hide();
	});
	$('#moduleView .blog>.cm>div').click(function(){
		if($(this).attr('id')=="cm_exit") return true;
		if($(this).attr('id')=="cm_open"){
			$('#moduleView .dataBlog div.el.over').click();
			return true;
		}
		idItem = $('#moduleView .dataBlog div.el.over').attr('id').split('_')[1];
		if($(this).attr('id')=="cm_addElementInList"){
			$('#searchBar .toolbarBox .addNewElement').click();
			//update('elementDialog/'+crtWigiiNamespaceUrl+'/'+crtModuleName+'/element/add/'+$('#groupPanel li.selected').attr('id').split('_')[1]);
			return true;
		}
		//select the current line
		$('#moduleView .dataBlog div.S').removeClass('S');
		$('#row_'+idItem).addClass('S');
		self.location = '#'+crtWigiiNamespaceUrl+'/'+crtModuleName+'/item/'+idItem;
		// toggles checkbox value
		if($(this).hasClass('unchecked')) {
			checked = 1;
			$(this).removeClass('unchecked').addClass('checked');
		}
		else if($(this).hasClass('checked')) {
			checked = 0;
			$(this).removeClass('checked').addClass('unchecked');
		}
		else checked = -1;

		if($(this).attr('id')=="cm_edit"){
			update('elementDialog/'+crtWigiiNamespaceUrl+'/'+crtModuleName+'/element/edit/'+idItem);
			return true;
		}
		if($(this).attr('id')=="cm_delete"){
            var responseDiv = 'elementDialog';
            //update('elementDialog/'+crtWigiiNamespaceUrl+'/'+crtModuleName+'/element/delete/'+idItem+'/elementDialog');
            if(isWorkzoneViewDocked()) responseDiv = 'confirmationDialog';
            update(responseDiv+'/'+crtWigiiNamespaceUrl+'/'+crtModuleName+'/element/delete/'+idItem+'/elementDialog');
            return true;
		}
		if($(this).attr('id')=="cm_copy"){
			copyWithOrganize('elementDialog/'+crtWigiiNamespaceUrl+'/'+crtModuleName, idItem);
			//update('elementDialog/'+crtWigiiNamespaceUrl+'/'+crtModuleName+'/element/copy/'+idItem+'/'+$('#groupPanel li.selected').attr('id').split('_')[1]);
			return true;
		}
		if($(this).attr('id')=="cm_organize"){
			openOrganizeDialog(idItem);
			return true;
		}
		if($(this).attr('id')=="cm_lock"){
			if(checked >= 0) update('NoAnswer/'+crtWigiiNamespaceUrl+'/'+crtModuleName+'/setElementState/'+idItem+'/locked/'+checked+'/');
			return true;
		}
		if($(this).attr('id')=="cm_block"){
			if(checked >= 0) update('NoAnswer/'+crtWigiiNamespaceUrl+'/'+crtModuleName+'/setElementState/'+idItem+'/blocked/'+checked+'/');
			return true;
		}
		if($(this).attr('id')=="cm_state_important1"){
			if(checked >= 0) update('NoAnswer/'+crtWigiiNamespaceUrl+'/'+crtModuleName+'/setElementState/'+idItem+'/important1/'+checked+'/');
			return true;
		}
		if($(this).attr('id')=="cm_state_important2"){
			if(checked >= 0) update('NoAnswer/'+crtWigiiNamespaceUrl+'/'+crtModuleName+'/setElementState/'+idItem+'/important2/'+checked+'/');
			return true;
		}
		if($(this).attr('id')=="cm_finalize"){
			if(checked >= 0) update('NoAnswer/'+crtWigiiNamespaceUrl+'/'+crtModuleName+'/setElementState/'+idItem+'/finalized/'+checked+'/');
			return true;
		}
		if($(this).attr('id')=="cm_approve"){
			if(checked >= 0) update('NoAnswer/'+crtWigiiNamespaceUrl+'/'+crtModuleName+'/setElementState/'+idItem+'/approved/'+checked+'/');
			return true;
		}
		if($(this).attr('id')=="cm_dismiss"){
			if(checked >= 0) update('NoAnswer/'+crtWigiiNamespaceUrl+'/'+crtModuleName+'/setElementState/'+idItem+'/dismissed/'+checked+'/');
			return true;
		}
		if($(this).attr('id')=="cm_state_archived"){
			if(checked >= 0) update('NoAnswer/'+crtWigiiNamespaceUrl+'/'+crtModuleName+'/setElementState/'+idItem+'/archived/'+checked+'/');
			return true;
		}
		if($(this).attr('id')=="cm_state_deprecated"){
			if(checked >= 0) update('NoAnswer/'+crtWigiiNamespaceUrl+'/'+crtModuleName+'/setElementState/'+idItem+'/deprecated/'+checked+'/');
			return true;
		}
		if($(this).attr('id')=="cm_hide"){
			if(checked >= 0) update('NoAnswer/'+crtWigiiNamespaceUrl+'/'+crtModuleName+'/setElementState/'+idItem+'/hidden/'+checked+'/');
			return true;
		}
	});

	setListenersToLoadMoreLines("getNextElementInBlog", "#moduleView .blog", "#moduleView .blog .dataBlog");

	setListenersToRows('#moduleView .blog', '#moduleView .dataBlog div.el', '#moduleView .dataBlog div.folder', '#moduleView .blog>.cm');
}

function setListenersToLoadMoreLines(action, selector, appendToSelector){
	//set listeners to loadMoreLines
	$(selector+'>.nbItemsInList>.loadMoreLines').click(function(){
		url = SITE_ROOT +"useContext/"+crtContextId+EXEC_requestSeparator+ crtWigiiNamespaceUrl+"/"+crtModuleName+"/"+action+"/";
		setVis("busyDiv", true);
		page = parseInt($(selector+'>.nbItemsInList>.page').text())+1;
		$(selector+'>.nbItemsInList>.page').text(page);
		var myAjax = new jQuery.ajax({
				type: 'POST',
				url: encodeURI(url),
				cache:false,
				data:{
					page: page
					},
				success : function(returnText, textStatus){
					setVis("busyDiv", false);
					data = returnText.split('_X_NBNEWROWS_X_');
					nbLoaded = parseInt(data[1]);
					jsCode = data[2];
					data = data[0];
					$(selector+'>.nbItemsInList>.nb').text(parseInt($(selector+'>.nbItemsInList>.nb').text())+nbLoaded);
					if(data =='' || parseInt($(selector+'>.nbItemsInList>.nb').text()) == parseInt($(selector+'>.nbItemsInList>.total').text())){
						$(selector+'>.nbItemsInList').html($(selector+'>.nbItemsInList>.nb').html()+$(selector+'>.nbItemsInList>.type').html());
					}
					$(appendToSelector).append(data);

					if(jsCode){
                        eval(jsCode.replace('<script id="JSCode" type="text/javascript" > $(document).ready(function(){ ', '').replace('}); </script>', ''));
					}

					//update the cache content
					updateCurrentModuleViewCache();
				},
				error: errorOnUpdate
			});
		onUpdateErrorCounter = 0;
	});
}

function matchSubFoldersInElementListToGroupPanel(){
	//hide folder if hidden in groupPanel
	$('#moduleView .dataList tr.folder').each(function(e){
		if(!$('#groupPanel #group_'+$(this).attr('id').split('_')[1]+':visible').length){
			$(this).hide();
		} else {
			tempHtml = $('#groupPanel #group_'+$(this).attr('id').split('_')[1]+'>div>span.nb').html();
			if(tempHtml){
				//alert(tempHtml);
				$('div.folder', this).next().append('<span class="R nb">'+tempHtml+'</span>');
			}
		}
	});
}

/*******************
 * Element Detail
 ******************/

function displayLink(anchor, link, marginTop, marginLeft){
	if(arguments.length < 3){
		marginTop = 30;
		marginLeft = 0;
	}
	if($(anchor).find('.sendLinkInput').length==1){
		//if sendLinkInput already exist do nothing
	} else {
		link = link.replace(" ", "%20");
		$(anchor)
		.prepend('<div class="sendLinkInput ui-corner-all SBB" style="background-color:#fff;z-index:9999999;position:absolute;float:left;margin-top:'+marginTop+'px;margin-left:'+marginLeft+'px;padding:4px;width:425px;"><input type="text" style="float:left;margin:0px;padding:2px;width:400px;" value="'+link+'" /><div class="H" style="float:left;font-size:x-small;margin-left:8px;"> X </div></div>')
		.find('input').select().next().click(function(e){ $(this).parent().remove(); e.stopPropagation(); return false; });
	}
}
function mailToFromLink(elementDialogId, link){
	if($('#'+elementDialogId+'').parent().find('.sendLinkInput').length==1){

	} else {
		link = link.replace(" ", "%20");
		if(isWorkzoneViewDocked()) {
			$('#'+elementDialogId+'').prepend('<div class="sendLinkInput ui-corner-all SBB" style="background-color:#fff;z-index:9999999;position:absolute;left:'+($('#searchBar .el_sendLink').position().left+$('#searchBar .el_sendLink').outerWidth()-425)+'px;top:'+(getTopHeight(true)+28)+'px;padding:4px;width:425px;"><input type="text" style="float:left;margin:0px;padding:2px;width:400px;" value="'+link+'" /><div class="H" style="float:left;font-size:x-small;margin-left:8px;"> X </div></div>').find('input').select().next().click(function(e){ $(this).parent().remove(); e.stopPropagation(); return false; });
		} else {
			$('#'+elementDialogId+'').parent().prepend('<div class="sendLinkInput ui-corner-all SBB" style="background-color:#fff;z-index:9999999;position:absolute;float:left;margin-top:20px;margin-left:'+($('#'+elementDialogId+'').width()-425)+'px;padding:4px;width:425px;"><input type="text" style="float:left;margin:0px;padding:2px;width:400px;" value="'+link+'" /><div class="H" style="float:left;font-size:x-small;margin-left:8px;"> X </div></div>').find('input').select().next().click(function(e){ $(this).parent().remove(); e.stopPropagation(); return false; });
		}
	}
	//link = link.replace('#', '#').replace(' ', '%2520');
	//window.location = 'mailto:?body=Access document with: '+link+' .';
}

/*
 * copyWithOrganize, Copy a card with a dialog box organize to choose where you want to put the copy
 * it is in a function to share the code with the button in the card and the right click on list view item
 */
function copyWithOrganize(startUrl, itemID){
	var targetFolder = $('#groupPanel li.selected.write');
	if(targetFolder.length>0) targetFolder = targetFolder.attr('id').split('_')[1];
	else targetFolder = undefined;
	var initialFolder = targetFolder;
	//var currentFolderId = ($('#groupPanel li.selected').length>0)?targetFolder:null;
	prepareOrganizeDialog(
		//on click
		function(e){
			if(!$(this).hasClass('disabled')){
				$('#organizeDialog .selected').removeClass('selected');
				$(this).toggleClass('selected');
				targetFolder = $(this).parent().attr('id').split('_')[1];
			}
			return false;
		}, 
		//on Ok
		function(){
			if(!targetFolder) {
				jAlert(DIALOG_selectAtLeastOneGroup);
				return false;
			}
			if( $('#organizeDialog').is(':ui-dialog')) { $('#organizeDialog').dialog("destroy"); }			
			// opens copy dialog
			// if folder changed, then navigates to new folder
			invalidCache("moduleView");
			if(targetFolder != initialFolder) startUrl = 'NoAnswer/'+crtWigiiNamespaceUrl+'/'+crtModuleName+'/groupSelectorPanel/selectGroup/'+targetFolder+EXEC_requestSeparator+startUrl;
			update(startUrl+'/element/copy/'+itemID+'/'+targetFolder);
		});
	$('#organizeDialog').prev().find('.ui-dialog-title').text(DIALOG_copyToFolder);
	$('#organizeDialog').prepend('<div class="introduction">'+DIALOG_copyToFolder_help+'</div>');
	
	//disables read only groups
	$('#organizeDialog>.groupPanel li:not(.write)').addClass("disabled noRights");
	$('#organizeDialog>.groupPanel li:not(.write)>div').addClass("disabled noRights");
	if(targetFolder) $('#organizeDialog>.groupPanel #group_'+targetFolder+', #organizeDialog>.groupPanel #group_'+targetFolder+'>div').addClass('selected');
	unfoldToSelectedGroupButNotChildren('#organizeDialog>.groupPanel');
	positionSelectedGroup('#organizeDialog>.groupPanel');	
	if(targetFolder) {		
		// sets focus on OK button to manage pressing enter to copy directly in current folder
		$('#organizeDialog').next().find('button.ok').focus();
	}	
}

function setListenersToElementDetail(elementDialogId, useWigiiNamespaceUrl, useModuleName, isSubItem, parentModuleName, elementParentId, elementLinkName, parentCacheLookup){
	if(arguments.length < 4){
		isSubItem = false;
		parentModuleName = null;
		elementParentId = null;
		elementLinkName = null;
		cacheId = null;
	}
	if(arguments.length < 2){
		var useWigiiNamespaceUrl = crtWigiiNamespaceUrl;
		var useModuleName = crtModuleName;
	}
	//if no elementDialogId that means we are looking at the item directly in the mainDiv
	if(elementDialogId==""){
		elementDialogId="mainDiv";
	}
	//if dialog lookup in dialog title, if main div lookup in T
	$('#'+elementDialogId+' .T>div, #'+elementDialogId+' .T>a, #'+elementDialogId+' .T>button').add($('a', $('#'+elementDialogId+'').prev())).click(function(){
		if($(this).hasClass('el_edit')){
			update(''+elementDialogId+'/'+useWigiiNamespaceUrl+'/'+useModuleName+'/element/edit/'+$(this).parent().attr('href').replace('#', ''));
			if(isWorkzoneViewDocked()) {
				$('#searchBar .middleBox div.T').children().remove();
			}
			return;
		}
		if($(this).hasClass('el_copy')){
			var itemID = $(this).parent().attr('href').replace('#', '');			
			if(isSubItem){
				update(''+elementDialogId+'/'+useWigiiNamespaceUrl+'/'+useModuleName+'/subelement/copy/'+elementParentId+'/'+elementLinkName+'/'+itemID);
			} else {
				copyWithOrganize(''+elementDialogId+'/'+useWigiiNamespaceUrl+'/'+useModuleName, itemID);
				//update(''+elementDialogId+'/'+useWigiiNamespaceUrl+'/'+useModuleName+'/element/copy/'+$(this).parent().attr('href').replace('#', '')+'/'+$('#groupPanel li.selected').attr('id').split('_')[1]);
			}
			return;
		}
		if($(this).hasClass('el_organize')){
			openOrganizeDialog($(this).parent().attr('href').replace('#', ''));
			return;
		}
		if($(this).hasClass('el_status')){
			//positionElementOnDom($('#elementStatusMenu'), $(this), 'fromLeft', 26);
			if(isWorkzoneViewDocked()){
				$('#searchBar .elementStatusMenu').show();
			} else {
				$('#'+elementDialogId+' .elementStatusMenu').show();
			}
			return;
		}
		if($(this).hasClass('el_delete')){
			update('confirmationDialog/'+useWigiiNamespaceUrl+'/'+useModuleName+'/element/delete/'+$(this).parent().attr('href').replace('#', '')+'/'+elementDialogId);
			return;
		}
		if($(this).hasClass('el_feedback')){
			update('feedbackDialog/'+useWigiiNamespaceUrl+'/'+useModuleName+'/giveFeedback/element/'+$(this).attr('href').replace('#', ''));
			return false;
		}
		if($(this).hasClass('el_back')){
			if(parentCacheLookup){
				updateThroughCache('elementDialog', parentCacheLookup, 'elementDialog/'+useWigiiNamespaceUrl+'/'+useModuleName+'/element/detail/'+elementParentId+'');
			} else {
				update('elementDialog/'+useWigiiNamespaceUrl+'/'+useModuleName+'/element/detail/'+elementParentId+'');
			}
			return false;
		}
		if($(this).hasClass('el_printDetails')){
			//is a real link
			return;
		}
		if($(this).hasClass('el_sendLink')){
			//window.location = 'mailto:?body='+$(this).attr('href').replace('#', '').replace(' ', '%2520');
			return;
		}
		
		if(isWorkzoneViewDocked() && $(this).hasClass('el_closeDetails')){
			manageWorkzoneViewDocked('hide');
			return;
		}
		
	});
	
	if(isWorkzoneViewDocked()){ //move control to serchBar middleBox
		var middleBox = $('#searchBar .middleBox');
		if(middleBox.length > 0) {
			middleBox.remove();
			needToResize = false;
		};
		var height = $('#searchBar .firstBox').after('<div class="middleBox"></div>').css('display','none').height();
		middleBox = $('#searchBar .middleBox').height('auto');
		middleBox.append($('#elementDialog .T').addClass('docked').css({'width':''}));
		$('#searchBar .toolbarBox').hide();
		resize_groupPanel();
		resize_elementList();
		resize_calendar();
		resize_blog();
		resize_wncd();
		resize_workzoneViewDocked();			
	}

	$('#'+elementDialogId+' .elementStatusMenu')
		.mouseleave(function(){
			$(this).hide();
		});
	var elementDialogIdForStatus = elementDialogId;
	if(isWorkzoneViewDocked()) elementDialogIdForStatus = 'elementDialog';
		
	$('#'+elementDialogIdForStatus+' .elementStatusMenu>div').click(function(e){
			if(!$(this).hasClass('exit')){
				$(this).toggleClass('checked');
				if($(this).hasClass('checked')){
					val = "1";
				} else {
					val = "0";
				}
				update(elementDialogId+'/'+useWigiiNamespaceUrl+'/'+useModuleName+'/setElementState/'+$('#'+elementDialogIdForStatus+' .T').attr('href').replace('#', '')+'/'+$(this).attr('href').replace('#', '')+'/'+val);
			} else {
				$('#'+elementDialogIdForStatus+' .elementStatusMenu').hide();
			}
			e.stopPropagation();
		});

	$('#'+elementDialogId+' .elementHistoric>div.label').click(function(){
		$(this).toggleClass('expanded').toggleClass('collapsed');
		$(this).next().toggle();
		if($(this).hasClass("expanded")){
			$(window).scrollTop($(window).scrollTop() +$('#'+elementDialogId+' .elementHistoric').height());
			if(!isWorkzoneViewDocked()) resize_scrollArea(true);
		}
	});

	hrefWithSiteroot2js(elementDialogId, elementDialogId);

	//show Sysinfo on mouse right click on label
	$('#'+elementDialogId+' div.field .label').bind('contextmenu', function(e){
		$(this).parent().find(">.addinfo").show();
		return false;
	});
	$('#'+elementDialogId+' div.field').mouseleave(function(e){
		$(this).find(".addinfo").hide();
	});
}

function hrefWithSiteroot2js(domIdToCheck, targetDomId){
	$('#'+domIdToCheck+' a[href^="'+SITE_ROOT+'"]').each(function(){
		$(this).click(function(e){
			//check if CTRL key is hold, in wich case do nothing to prevent double action (open in new tab + click)
			if(e.ctrlKey){
				return;
			}
			if($(this).attr('target') != '_blank'){
				//detect if changing namespace or not
				var ref = $(this).attr('href');
				//detect if a # is in the link
				if(ref.indexOf('#')!=-1){
					ref = ref.replace(SITE_ROOT+'#','')
					if(!$(this).attr('href').match(crtWigiiNamespaceUrl) || !$(this).attr('href').match(crtModuleName)){
						if($(this).attr('href').match('item/')){
							ref = ref.replace('/item/', '/navigate/item/');
						}
						if($(this).attr('href').match('folder/')){
							ref = ref.replace('/folder/', '/navigate/folder/');
						}
						update('mainDiv/'+ref);
					} else {
						if($(this).attr('href').match('item/')){
							ref = ref.replace('/item/', '/element/detail/');
							update(''+targetDomId+'/'+ref);
						}
						if($(this).attr('href').match('folder/')){
							ref = ref.replace('/folder/', '/groupSelectorPanel/selectGroup/');
							update('NoAnswer/'+ref);
						}
						if($(this).attr('href').match('find/')){
							update('mainDiv/'+ref);
						}
					}
				}
			}
		});
	});
	// CWE 13.09.2018 transforms data-wigii-href in new window hyperlinks
	$('#'+domIdToCheck+' div.field[data-wigii-href] div.value').each(function(){
		$(this).addClass('H').click(function(){window.open($(this).parent().attr('data-wigii-href'));});		
	});
	// CWE 13.09.2018 transforms data-wigii-href-self in navigation hyperlinks
	$('#'+domIdToCheck+' div.field[data-wigii-href-self] div.value').each(function(){
		$(this).addClass('H');
		var href = $(this).parent().attr('data-wigii-href-self');
		if(href.indexOf(SITE_ROOT)===0) {
			$(this).click(function(e){
				if(e.ctrlKey) window.open(href);
				else {
					var ref = href;
					//detect if changing namespace or not					
					//detect if a # is in the link
					if(ref.indexOf('#')!=-1){
						ref = ref.replace(SITE_ROOT+'#','')
						if(!href.match(crtWigiiNamespaceUrl) || !href.match(crtModuleName)){
							if(href.match('item/')){
								ref = ref.replace('/item/', '/navigate/item/');
							}
							if(href.match('folder/')){
								ref = ref.replace('/folder/', '/navigate/folder/');
							}
							update('mainDiv/'+ref);
						} else {
							if(href.match('item/')){
								ref = ref.replace('/item/', '/element/detail/');
								update(''+targetDomId+'/'+ref);
							}
							if(href.match('folder/')){
								ref = ref.replace('/folder/', '/groupSelectorPanel/selectGroup/');
								update('NoAnswer/'+ref);
							}
							if(href.match('find/')){
								update('mainDiv/'+ref);
							}
						}
					}
				}
			});
		}
		else {
			$(this).click(function(e){		
				if(e.ctrlKey) window.open(href);
				else window.location.href=href;
			});		
		}		
	});
}

function resize_navigateMenu(){	
	//Change the margin when the submenu bar is resizing - 23.01.2017 (LMA)
	var resize_subMenu = $('.sf-navbar li.selected ul');
	if(resize_subMenu.height() != null && resize_subMenu.height() > 0){
		$('#workZone').css('margin-top', resize_subMenu.height()-28);
	}
}
$(window).resize(resize_navigateMenu);

navigateMenuTimerComeBackToSelected = null;
doShowUserMenuUserNameTimer = null;
doShowUserSubMenuUserNameTimer = null;
myTimer = [0];

var ctrlPressed = false;
window.onmousedown = function(e){ ctrlPressed = e.ctrlKey; };

function setListenerToNavigateMenu(){
	$('#navigateMenu li').click(function(e){ //:not(.with-ul)
		if($(this).hasClass('with-ul')){
			//if click directly on the top link of the navigation bar selec the first possible option
			if(!$(this).hasClass('selected') && $('ul li:first a', this).length){
				$('ul li:first a', this).click();
			}
		} else {
			$.cookie('wigii_anchor', $('a', this).attr('href'),  { path: '/' });
			if(e.ctrlKey){
				//do nothing, just let browser open link in new tab
				//window.open($('a', this).attr('href').replace('#', '')+'/navigate', '_blank');
			} else {
				$('#navigateMenu .selected').removeClass('selected');
				$(this).addClass('selected');
				refreshNavigateMenu();
				self.location = $('a', this).attr('href');
				updateThroughCache();
				clearTimeout(navigateMenuTimerComeBackToSelected);
			}
			e.stopPropagation();
		}
	}).bind('contextmenu', function(e){$.cookie('wigii_anchor', $('a', this).attr('href'),  { path: '/' }); e.stopPropagation();});
	//in the JS cache there already is the setNavigationBarInHomeState when displaying the home page
	//$('#userMenu li.home').click(setNavigationBarInHomeState);
	$('#userMenu li.back').click(function(e){
		$('#navigateMenu a[href=\'#'+crtWigiiNamespaceUrl+'/'+crtModuleName+'\']').click(e);
		return false;
	});
	$('#userName')
		.mouseenter(function(e){
			clearTimeout(doShowUserMenuUserNameTimer);
			doShowUserMenuUserNameTimer = setTimeout(function(){
				$('#userName').addClass('menuHover');
				$('#userName>ul, #userName>ul>li').css('visibility','visible');
			}, 250);
		})
		.mouseleave(function(e){
			clearTimeout(doShowUserMenuUserNameTimer);
			doShowUserMenuUserNameTimer = setTimeout(function(){
				$('#userName').removeClass('menuHover');
				$('#userName>ul, #userName>ul>li').css('visibility','hidden');
			}, 400);
		})
	;
	$('#userName>ul>li')
		.mouseenter(function(e){		
			var height = $(window).height()-$(this).offset().top-$('#footerBar').outerHeight();
			//$('#userMenu ul li ul').css('max-height',height+'px');
			//add a max-height for let the browser handle the scrollbar
			$(this).children().last().css('max-height',height+'px'); //relative path
			
			$('#userName>ul>li.subMenuHoverTemp').removeClass('subMenuHoverTemp');
			$(this).addClass('subMenuHoverTemp');
			clearTimeout(doShowUserSubMenuUserNameTimer);
			doShowUserSubMenuUserNameTimer = setTimeout(function(){
				$('#userName>ul>li.subMenuHover>ul, #userName>ul>li.subMenuHover>ul>li').css('visibility','hidden');
				$('#userName>ul>li.subMenuHover').removeClass('subMenuHover');
				$('#userName>ul>li.subMenuHoverTemp').addClass('subMenuHover');
				$('#userName>ul>li.subMenuHover ul, #userName>ul>li.subMenuHover>ul>li').css('visibility','visible');
			}, 400);
		})
		.mouseleave(function(e){
			clearTimeout(doShowUserSubMenuUserNameTimer);
			doShowUserSubMenuUserNameTimer = setTimeout(function(){
				$('#userName>ul>li.subMenuHover>ul, #userName>ul>li.subMenuHover>ul>li').css('visibility','hidden');
				$('#userName>ul>li.subMenuHover').removeClass('subMenuHover');
			}, 400);
		})
	;
	//Create a delai for hide submenu in navigationBar
	$("#navigateMenu li.with-ul").on("mouseenter", function() {
		$(this).removeClass("delai-navbar");
		if(!$(this).hasClass("selected")){
			var navMenu = $("#navigateMenu li.with-ul");
			var currentLi = navMenu.index(this);
			clearTimeout(myTimer[currentLi]);
			for(var index=0, len=myTimer.length; index<len; index++){
				if(index!=currentLi) {
					myTimer[index] = null;
					navMenu.eq(index).removeClass("delai-navbar");
				}
			}
		}
	}).on("mouseleave", function() {
		if(!$(this).hasClass("selected")){
			var navMenu = $("#navigateMenu li.with-ul");
			var currentLi = navMenu.index(this);
			$(this).addClass("delai-navbar");
			myTimer[currentLi] = setTimeout(function(){
				navMenu.removeClass("delai-navbar");
			}, 400);
		}
	});
	/* deprecated since 4.602 28.11.2017
	$('#navigationBar .navL').click(function(e){
		if($(this).hasClass('D')) return;
		$('#navigateMenu').stop(true, true).animate({ marginLeft: "+=200" }, 200, enableDisableNavScroll);
		clearTimeout(navigateMenuTimerComeBackToSelected);
		navigateMenuTimerComeBackToSelected = setTimeout(timeToScrollBack, 5000);
	});
	$('#navigationBar .navR').click(function(e){
		if($(this).hasClass('D')) return;
		$('#navigateMenu').stop(true, true).animate({ marginLeft: "-=200" }, 200, enableDisableNavScroll);
		clearTimeout(navigateMenuTimerComeBackToSelected);
		navigateMenuTimerComeBackToSelected = setTimeout(timeToScrollBack, 5000);
	});
	*/
}

function addNavigationToMenu(menuId, menuTimer){
	var menu = $('#'+menuId);
	var submenu = menu.children().children().last();
	//console.log(menu.is("li"));
	menu
		.mouseenter(function(e){
			clearTimeout(menuTimer);
			menuTimer = setTimeout(function(){
				menu.addClass('menuHover');
				submenu.css('visibility','visible');
			}, 150);
		})
		.mouseleave(function(e){
			clearTimeout(menuTimer);
			menuTimer = setTimeout(function(){
				menu.removeClass('menuHover');
				menu.find('ul').css('visibility','hidden');
			}, 400);
		})
		/*.click(function(){ 
			//submenu.slideUp(200);
			submenu.css('visibility','hidden');
		})*/
	;
	
	addNavigationToSubMenu(submenu.children(), menuTimer);
}

function addNavigationToSubMenu(subMenus, menuTimer){
	//subMenus is a JQuery collection of list item (<li>)
	subMenus
		.mouseenter(function(e){
			var self = $(this);
			var childMenu = self.children().last();
			var currentSpaceAvailable = $(window).height() -childMenu.offset().top -$('#footerBar').outerHeight();
			//for solve a resize problem we put the initial height in data
			if(childMenu.data('originHeight')===undefined)
				childMenu.data('originHeight',childMenu.height());
			childMenu.height(childMenu.data('originHeight'));
			
			if(childMenu.is('ul') && currentSpaceAvailable < childMenu.outerHeight()) {
				//add a max-height for let the browser handle the scrollbar
				childMenu.css({'max-height':currentSpaceAvailable+'px', 'overflow-y':'auto', 'overflow-x':'hidden'});
			} else {
				childMenu.css({'max-height':'','overflow-x':'','overflow-y':''});
			}
			
			self.parent().find('.subMenuHoverTemp').removeClass('subMenuHoverTemp');
			self.addClass('subMenuHoverTemp');
			clearTimeout(menuTimer);
			menuTimer = setTimeout(function(){
				if(childMenu.is("ul")) {
					subMenus.find('ul').css('visibility','hidden');
					childMenu.css({'top':'0','visibility':'visible'});
				} else {
					subMenus.find("ul").css('visibility','hidden');
				}
			}, 10);
		})
		.mouseleave(function(e){
			clearTimeout(menuTimer);
			menuTimer = setTimeout(function(){
				//mainMenu.find('.subMenuHoverTemp').removeClass('subMenuHoverTemp');
				subMenus.parent().find('.subMenuHoverTemp').removeClass('subMenuHoverTemp');
				
				//$('#'+menuId+'>ul>li.subMenuHover>ul, #'+menuId+'>ul>li.subMenuHover>ul>li').css('visibility','hidden');
				subMenus.find('.subMenuHover>ul').css('visibility','hidden');
				//$('#'+menuId+'>ul>li.subMenuHover').removeClass('subMenuHover');
				subMenus.find('.subMenuHover').removeClass('subMenuHover');
			}, 400);
		})
		.click(function(){ 
			//submenu.slideUp(200);
			var self = $(this);
			self.addClass('S');
			subMenus.parent().css('visibility','hidden');
		})
	;
	//Recursion for sub-submenu...
	subMenus.each(function( index ) {
		var nextSubMenu = $(this).children().last();
		if(nextSubMenu.is('ul')) {
			addNavigationToSubMenu(nextSubMenu.children(), menuTimer);
		}
	});
}

function enableDisableNavScroll(){
	NMOriginalOffset = $('#NMContainer').offset().left;
	NMFirst = $('#navigateMenu>li:first').offset().left-NMOriginalOffset;
	NMLast = $('#navigateMenu>li:last').offset().left-NMOriginalOffset+$('#navigateMenu>li:last').width();
	NMWidth = $('#NMContainer').width();
	//if the first element is pushed in the right, move it back
	if(NMFirst <= 0){
		$('#navigationBar .navL').removeClass('D');
	} else {
		$('#navigationBar .navL').addClass('D');
	}
	if(NMLast > NMWidth){
		$('#navigationBar .navR').removeClass('D');
	} else {
		$('#navigationBar .navR').addClass('D');
	}
}
/**
 *@deprecated
 */
function timeToScrollBack(){
	//alert('time to scroll');
	NMOriginalOffset = $('#NMContainer').offset().left;
	NMWidth = $('#NMContainer').width();
	NMOffset = $('#navigateMenu>li.selected').offset().left-NMOriginalOffset;
	NMSelectedWidth = $('#navigateMenu>li.selected').width();
	NMFirstOffset = $('#navigateMenu>li:first').offset().left-NMOriginalOffset;
	NMLastOffset = $('#navigateMenu>li:last').offset().left-NMOriginalOffset+$('#navigateMenu>li:last').width();

	//alert("offset:"+NMoffset+" length:"+NMOriginalLength+" pos of first:"+NMFirstOffset);

	NMOffsetResult = 0;
	//is the selected visible?
	if((NMOffset+NMSelectedWidth) > NMWidth){
		//hidden on the right
		NMOffsetResult =  -(NMOffset + NMSelectedWidth - NMWidth)-50;
	} else if(NMOffset < 0){
		//hidden on the left
		NMOffsetResult = - NMOffset + 50;
	}

	if((NMFirstOffset + NMOffsetResult) >= 0){
		NMOffsetResult = - NMFirstOffset;
	}

	//scroll the navigateMenu if necessary
	if(NMOffsetResult != 0){
		$('#navigateMenu').animate({ marginLeft:  "+="+(NMOffsetResult)}, 500, enableDisableNavScroll);
	} else {
		enableDisableNavScroll();
	}
}
/**
 * @deprecated since v.4.602 28.11.2017, replaced by setNavigationBarInHomeStateBsp
 */
function setNavigationBarInHomeState(displayFeedbackOnSystem){
	if(arguments.length==0){ displayFeedbackOnSystem = false; }
	$('#navigationBar .homeOnly').show();
	if(!crtWigiiNamespaceUrl || !crtModuleName){
		$('#userMenu li.back').hide();
	}
	$('#navigationBar .notHome').hide();
    $('nav #base-dropdown #dropdown-title').html('<span class="glyphicon glyphicon-menu-hamburger" aria-hidden="true"></span>');
    $('#navigationBarBsp #base-dropdown #dropdown-title').show();
    $('#navigationBarBsp .admin').hide();
	if(displayFeedbackOnSystem){
		$('#userFeedbackOnSystem').show();
		$('#userFeedbackOnSystem').removeClass('disabled');
		$('#userFeedbackOnSystem a').removeClass('disabled');
	} else {
		$('#userFeedbackOnSystem').hide();
		$('#userFeedbackOnSystem a').addClass('disabled');
		$('#userFeedbackOnSystem').addClass('disabled');
	}
	closeStandardsDialogs();
	self.location = '#Home';
	resize_navigateMenu();
}
function setNavigationBarInHomeStateBsp(displayFeedbackOnSystem){
    if(arguments.length==0){ displayFeedbackOnSystem = false; }
    $('#navigationBarBsp .homeOnly').show();
    $('#navigationBarBsp #base-dropdown #dropdown-title').show();
    $("#navToolBar #searchBar").remove();
    if(!crtWigiiNamespaceUrl || !crtModuleName){
        $('#navigationBarBsp li.back').hide();
    }
    $('#navigationBarBsp .notHome').hide();
    $('nav #base-dropdown #dropdown-title').html('<span class="glyphicon glyphicon-menu-hamburger" aria-hidden="true"></span>');
    $('#navigationBarBsp .admin').hide();
    if(displayFeedbackOnSystem){
        $('#userFeedbackOnSystem').show();
        $('#userFeedbackOnSystem').removeClass('disabled');
        $('#userFeedbackOnSystem a').removeClass('disabled');
    } else {
        $('#userFeedbackOnSystem').hide();
        $('#userFeedbackOnSystem a').addClass('disabled');
        $('#userFeedbackOnSystem').addClass('disabled');
    }
    closeStandardsDialogs();
    self.location = '#Home';
    resize_navigateMenu();
}
/**
 * @deprecated since v.4.602 28.11.2017, replaced by setNavigationBarNotInHomeStateBsp
 */
function setNavigationBarNotInHomeState(displayFeedbackOnSystem){
	$('#navigationBar .admin').hide();
	$('#navigationBar .homeOnly').hide();
	$('#navigationBar .notHome').show();
	if(displayFeedbackOnSystem){
		$('#userFeedbackOnSystem').show();
		$('#userFeedbackOnSystem').removeClass('disabled');
		$('#userFeedbackOnSystem a').removeClass('disabled');
	} else {
		$('#userFeedbackOnSystem').hide();
		$('#userFeedbackOnSystem a').addClass('disabled');
		$('#userFeedbackOnSystem').addClass('disabled');
	}
	self.location = '#'+crtWigiiNamespaceUrl+"/"+crtModuleName;
	resize_navigateMenu();
}
function setNavigationBarNotInHomeStateBsp(displayFeedbackOnSystem){

	var wigiiModule = crtModuleName;
	var wigiiModuleLabel = crtModuleLabel;
	var parentNamespace = crtWigiiNamespaceUrl || null;
	var parentNamespaceLabel = crtWigiiNamespaceLabel || parentNamespace;
	var parentEncode = parentNamespace.replace(/ /g, '-');

	$('#navigationBarBsp .admin').hide(); //Hide admin toolsbar
    $("#navigationBarBsp .carret-submenu").hide(); //Hide the submenu carret
    $("nav .with-submenu").hide(); //Hide the submenu
	$("#navigationBarBsp .home").show(); //Show element souldn't appear on home
    $("#navigationBarBsp .carret").show(); //Show the first carret


	$('#navigationBarBsp #base-dropdown a:first').html(parentNamespaceLabel + ' <span class="caret"></span>'); //Show the namespace in place of the burger menu

    //show the submenu
	if($("nav #submenu-" + parentEncode + " a")){
        $("nav #submenu-" + parentEncode + " a:first").html(wigiiModuleLabel + ' <span class="caret"></span>');
        $("nav #submenu-" + parentEncode).show();
        $("#navigationBarBsp .carret-submenu").show(); //Show the submenu carret
	}

	//Show the searchfield and add the event to change the color when it has the focus
	$("nav #searchField").show(function(){
        $("#searchField input").focusin(function(){
            $("#searchField #goForSearch").css('background-color', '#95C33B');
        });
        $("#searchField input").focusout(function(){
            $("#searchField #goForSearch").css('background-color', '#d8d8d8');
        });
	});

	if(parentNamespace == defaultWigiiNamespaceUrl){
        $("nav #submenu-" + parentEncode).hide();
        $("#navigationBarBsp .carret-submenu").hide(); //Show the submenu carret
        $("#navigationBarBsp #base-dropdown a:first").html(wigiiModuleLabel + ' <span class="caret"></span>'); //Show the module name
	}

	if(displayFeedbackOnSystem){
		$('#userFeedbackOnSystem').show();
		$('#userFeedbackOnSystem').removeClass('disabled');
		$('#userFeedbackOnSystem a').removeClass('disabled');
	} else {
		$('#userFeedbackOnSystem').hide();
		$('#userFeedbackOnSystem a').addClass('disabled');
		$('#userFeedbackOnSystem').addClass('disabled');
	}
	self.location = '#'+crtWigiiNamespaceUrl+"/"+crtModuleName;
	resize_navigateMenu();
}
/**
 * @deprecated since v.4.602 28.11.2017, replaced by setNavigationBarInAdminState
 */
function setNavigationBarInAdminState(){
	$('#navigationBar .homeOnly').hide();
	$('#navigationBar .notHome').show();
	$('#userMenu .notHome').hide();
	$('#navigationBar .home').hide();
	$('#userFeedbackOnSystem').hide();
	$('#userFeedbackOnSystem a').addClass('disabled');
	$('#userFeedbackOnSystem').addClass('disabled');
	$('#navigationBar .admin').show();
}
function setNavigationBarInAdminStateBsp(){
	$(".with-submenu").hide();
    $('#searchField').hide();
    $('#searchBar').hide();
    $('#dropdown-title').hide();
    $('#navigationBarBsp .homeOnly').hide();
    $('#navigationBarBsp .notHome').hide();
    $('#navigationBarBsp .home').hide();
    $('#navigationBarBsp .carret').hide();
    $('#userFeedbackOnSystem').hide();
    $('#userMenuImport').hide();
    $('#userMenuUpdate').hide();
    $('#userMenuFindDuplicates').hide();
    $('#userMenuAddIndicators').hide();
    $('#userFeedbackOnSystem a').addClass('disabled');
    $('#userFeedbackOnSystem').addClass('disabled');
    $('#navigationBarBsp .admin').show();
    if(crtWigiiNamespaceUrl != "NoWigiiNamespace"){
        $('#navigationBarBsp #adminWigiiNamespace').html("Admin console: "+crtWigiiNamespaceUrl);
	} else {
        $('#navigationBarBsp #adminWigiiNamespace').html("Admin console: ");
	}
}
/**
 * @deprecated since v.4.602 28.11.2017
 */
function refreshNavigateMenu(){
	$('#navigateMenu .selected')
		.parentsUntil('#navigateMenu', 'li')
		.addClass('selected');
	if($('#navigateMenu li.selected').length>1){
		$('#navigateMenu').addClass('with-sub');
	} else {
		$('#navigateMenu').removeClass('with-sub');
	}
	resize_navigateMenu();
}

//subMenuPosition : string = positionElementOnDom option
function setListenerToHomePage(subMenuPosition){
	if(arguments.length < 1) subMenuPosition = "fromLeft";
	$('#ContainerHome #homePageModuleMenu li, #ContainerHome #homePageWigiiNamespaceMenu li.sub').click(function(e){
		$('a', this).click();
	});
	$('#ContainerHome #homePageModuleMenu :not(.link) a, #ContainerHome #homePageWigiiNamespaceMenu .sub a').click(function(e){
		homePageClickRef = $(this).attr('href');
		//in IE7 href include the site root even if not define in the html of the home page
		homePageClickRef = homePageClickRef.replace(SITE_ROOT, '');
		if($(this).parent().hasClass("adminMenu")){
			// deprecated 25.01.2018 $("#userMenuAdmin a[href$='"+homePageClickRef+"']").click();
			/*BSP*/$("#base-dropdown a[href$='"+homePageClickRef+"']").click();
		} else {					
            // deprecated 25.01.2018 $("#navigateMenu a[href$='"+homePageClickRef+"']").click();
            /*BSP*/$("#base-dropdown a[href$='"+homePageClickRef+"']").click();
		}
		self.location = homePageClickRef;
		e.stopPropagation();
	});

	var homePageMenuTimers = [];
	$('#ContainerHome #homePageWigiiNamespaceMenu li')
		.mouseenter(function(){
			var self = this;
			//dont't display submenu if only one module
			if($('ul li', self).length>1){
				tempOffsetLow = null;
				if(subMenuPosition == "right" || subMenuPosition=="left"){
					tempOffsetLow = 0;
				}
				positionElementOnDom($('ul', self), $(self), subMenuPosition, tempOffsetLow, true);				
				
				var currentLi = $('#homePageWigiiNamespaceMenu .H.N').index(self);
				clearTimeout(homePageMenuTimers[currentLi]);
				homePageMenuTimers[currentLi] = setTimeout(function(){
					$('#homePageWigiiNamespaceMenu .H.N > ul').hide();
					$('ul', self).show();
				}, 100);
			}
		})
		.mouseleave(function(){
			var self = this;
			var currentLi = $('#homePageWigiiNamespaceMenu .H.N').index(self);
			clearTimeout(homePageMenuTimers[currentLi]);
			homePageMenuTimers[currentLi] = setTimeout(function(){
				$('ul', self).hide();
			}, 400);
		})
		.click(function(e){
			if($('ul li:first a', this).length){
				$('ul li:first a', this).click();
			}
			else if($('a:first', this).length) {				
				if(!ctrlPressed) self.location = $('a:first', this).attr("href");
				else $("#base-dropdown a[href$='"+$('a:first', this).attr("href")+"']").click();
			}
		})
		.bind('contextmenu', function(e){$.cookie('wigii_anchor', $('a', this).attr('href'),  { path: '/' }); e.stopPropagation();})
		;
}


/*******************
 * Multiple select
 ******************/


function selectLine(id, toggleIfMultiple){
	if(arguments.length < 2) toggleIfMultiple = false;
	if(typeof(id) == 'string'){
		obj = $('#'+id);
	} else obj = $(id);

	//remove all from parents who are selected
	obj.parent().find("*").removeClass("selected");
	if(switchSelectionModeIsMultiple){
		if(obj.hasClass('readOnly')){
			$('#moduleView .title .onlyWriteRights').hide();
		} else if(allMultipleSelectionHaveWriteRights) {
			$('#moduleView .title .onlyWriteRights').show();
		}
		if(toggleIfMultiple){
			obj.toggleClass('multipleSelected');
		} else {
			obj.addClass('multipleSelected');
		}
	} else {
		obj.parent().find("*").removeClass("multipleSelected");
		obj.addClass('selected');
	}

	//after the selection is made, check if need to change the contextMenu
	matchContextMenu(obj);
}

switchSelectionModeIsMultiple = false;
allMultipleSelectionHaveWriteRights = false;
multipleSelectionNb = 0;
function setSelectionMode(isMultiple){
	if(arguments.length<1){
		isMultiple = switchSelectionModeIsMultiple;
	}
	if(switchSelectionModeIsMultiple != isMultiple){
		switchSelectionModeIsMultiple = isMultiple;
//		update('multipleDialog/'+crtWigiiNamespaceUrl+'/'+crtModuleName+'/element/switchMultipleSelection/'+switchSelectionModeIsMultiple);
		if(switchSelectionModeIsMultiple){

		} else {
			crtMultipleSelectionDialogKeep = false;
			update('multipleDialog/'+crtWigiiNamespaceUrl+'/'+crtModuleName+'/element/stopMultipleSelection/');
			$('#moduleView .M').removeClass('M');
		}
	}
	if(switchSelectionModeIsMultiple){
		$('#moduleView div.toolBar>div.emailing').addClass('M');
		$('#moduleView div.toolBar>div.export').addClass('M');
	} else {
		$('#moduleView div.toolBar>div.emailing').removeClass('M');
		$('#moduleView div.toolBar>div.export').removeClass('M');
	}
	//update the multiple dialog content
	if($('#multipleDialog:visible').length>0){
		$('#multipleDialog .summary span.multipleSelectionNb').text(multipleSelectionNb);
		if(allMultipleSelectionHaveWriteRights){
			$('#multipleDialog div.onlyWriteRights').show();
		} else {
			$('#multipleDialog div.onlyWriteRights').hide();
		}

		// hides delete if at least one element is blocked
		// hides organize if at least one element is blocked, except if:
		// - Medair (CWE) 30.01.2018: Element_Blocked_enableSharing is defined in config 
		if(multipleElementStatePerm & 2) {
			if(!(multipleEnableElementState & 2048)) $('#multipleDialog div.organizeMultiple').hide();
			$('#multipleDialog div.deleteMultiple').hide();
		}
		// hides delete if non admin and enableDeleteOnlyForAdmin config parameter
		if(multipleEnableElementState & 1024) {
			$('#multipleDialog div.deleteMultiple').hide();
		}
		// hides edit if all elements are blocked
		if(multipleElementStateRest & 2) {
			$('#multipleDialog div.editMultiple').hide();
		}		
		// shows or hides element statuses
		if(multipleEnableElementState > 0) {
			// enables lock
			if(multipleEnableElementState & 1) {
				s = $('#multipleDialog div.lockedMultiple');
				if(multipleElementState & 1) s.addClass('checked').removeClass('unchecked').removeClass('mixed');
				else if(multipleElementStateMedi & 1) s.addClass('mixed').removeClass('unchecked').removeClass('checked');
				else s.addClass('unchecked').removeClass('checked').removeClass('mixed');
			}
			else $('#multipleDialog div.lockedMultiple').hide();
			// enables block
			if(multipleEnableElementState & 2) {
				s = $('#multipleDialog div.blockedMultiple');
				if(multipleElementState & 2) s.addClass('checked').removeClass('unchecked').removeClass('mixed');
				else if(multipleElementStateMedi & 2) s.addClass('mixed').removeClass('unchecked').removeClass('checked');
				else s.addClass('unchecked').removeClass('checked').removeClass('mixed');
			}
			else $('#multipleDialog div.blockedMultiple').hide();
			// enables important1
			if(multipleEnableElementState & 4) {
				s = $('#multipleDialog div.important1Multiple');
				if(multipleElementState & 4) s.addClass('checked').removeClass('unchecked').removeClass('mixed');
				else if(multipleElementStateMedi & 4) s.addClass('mixed').removeClass('unchecked').removeClass('checked');
				else s.addClass('unchecked').removeClass('checked').removeClass('mixed');
			}
			else $('#multipleDialog div.important1Multiple').hide();
			// enables important2
			if(multipleEnableElementState & 8) {
				s = $('#multipleDialog div.important2Multiple');
				if(multipleElementState & 8) s.addClass('checked').removeClass('unchecked').removeClass('mixed');
				else if(multipleElementStateMedi & 8) s.addClass('mixed').removeClass('unchecked').removeClass('checked');
				else s.addClass('unchecked').removeClass('checked').removeClass('mixed');
			}
			else $('#multipleDialog div.important2Multiple').hide();
			// enables finalized
			if(multipleEnableElementState & 16) {
				s = $('#multipleDialog div.finalizedMultiple');
				if(multipleElementState & 16) s.addClass('checked').removeClass('unchecked').removeClass('mixed');
				else if(multipleElementStateMedi & 16) s.addClass('mixed').removeClass('unchecked').removeClass('checked');
				else s.addClass('unchecked').removeClass('checked').removeClass('mixed');
			}
			else $('#multipleDialog div.finalizedMultiple').hide();
			// enables approved
			if(multipleEnableElementState & 32) {
				s = $('#multipleDialog div.approvedMultiple');
				if(multipleElementState & 32) s.addClass('checked').removeClass('unchecked').removeClass('mixed');
				else if(multipleElementStateMedi & 32) s.addClass('mixed').removeClass('unchecked').removeClass('checked');
				else s.addClass('unchecked').removeClass('checked').removeClass('mixed');
			}
			else $('#multipleDialog div.approvedMultiple').hide();
			// enables dismissed
			if(multipleEnableElementState & 64) {
				s = $('#multipleDialog div.dismissedMultiple');
				if(multipleElementState & 64) s.addClass('checked').removeClass('unchecked').removeClass('mixed');
				else if(multipleElementStateMedi & 64) s.addClass('mixed').removeClass('unchecked').removeClass('checked');
				else s.addClass('unchecked').removeClass('checked').removeClass('mixed');
			}
			else $('#multipleDialog div.dismissedMultiple').hide();
			// enables archived
			if(multipleEnableElementState & 128) {
				s = $('#multipleDialog div.archivedMultiple');
				if(multipleElementState & 128) s.addClass('checked').removeClass('unchecked').removeClass('mixed');
				else if(multipleElementStateMedi & 128) s.addClass('mixed').removeClass('unchecked').removeClass('checked');
				else s.addClass('unchecked').removeClass('checked').removeClass('mixed');
			}
			else $('#multipleDialog div.archivedMultiple').hide();
			// enables deprecated
			if(multipleEnableElementState & 256) {
				s = $('#multipleDialog div.deprecatedMultiple');
				if(multipleElementState & 256) s.addClass('checked').removeClass('unchecked').removeClass('mixed');
				else if(multipleElementStateMedi & 256) s.addClass('mixed').removeClass('unchecked').removeClass('checked');
				else s.addClass('unchecked').removeClass('checked').removeClass('mixed');
			}
			else $('#multipleDialog div.deprecatedMultiple').hide();
			// enables hidden
			if(multipleEnableElementState & 512) {
				s = $('#multipleDialog div.hiddenMultiple');
				if(multipleElementState & 512) s.addClass('checked').removeClass('unchecked').removeClass('mixed');
				else if(multipleElementStateMedi & 512) s.addClass('mixed').removeClass('unchecked').removeClass('checked');
				else s.addClass('unchecked').removeClass('checked').removeClass('mixed');
			}
			else $('#multipleDialog div.hiddenMultiple').hide();
		}
		else $('#multipleDialog div.elementStates').hide();
	} else if(switchSelectionModeIsMultiple){
		//if not display and multiple selection then show the dialog
		update('multipleDialog/'+crtWigiiNamespaceUrl+'/'+crtModuleName+'/element/displayMultipleDialog/');
	}
}

function clickFolderLineInMultipleSelectionMode(obj){
	obj.toggleClass('M');
	invalidModuleViewCache();
	update('NoAnswer/'+crtWigiiNamespaceUrl+'/'+crtModuleName+'/element/setMultipleSelectionFolder/'+obj.attr('id').split('_')[1]+'/'+obj.hasClass('M'));
}
function clickLineInMultipleSelectionMode(obj){
	obj.toggleClass('M');
	invalidModuleViewCache();
	elEnableState = $('.menu .elEnableState', obj).html();
	elState = $('.menu .elState', obj).html();
	update('NoAnswer/'+crtWigiiNamespaceUrl+'/'+crtModuleName+'/element/setMultipleSelection/'+obj.attr('id').split('_')[1]+'/'+obj.hasClass('M')+'/'+!obj.hasClass('readOnly')+'/'+elEnableState+'/'+elState);
}
function selectAllMultipleSelect(){
	if($('#groupPanel li.selected').length==0){
		groupId = 0;
	} else {
		groupId = $('#groupPanel li.selected').attr('id').split('_')[1];
	}
	$('#moduleView .el:has(.mul), #moduleView .folder:has(.mul)').addClass('M');
	invalidModuleViewCache();
	update('NoAnswer/'+crtWigiiNamespaceUrl+'/'+crtModuleName+'/element/setMultipleSelectionFolder/'+groupId+'/true');
}
function deselectAllMultipleSelect(){
	if($('#groupPanel li.selected').length==0){
		groupId = 0;
	} else {
		groupId = $('#groupPanel li.selected').attr('id').split('_')[1];
	}
	$('#moduleView .M').removeClass('M');
	invalidModuleViewCache();
	update('NoAnswer/'+crtWigiiNamespaceUrl+'/'+crtModuleName+'/element/setMultipleSelectionFolder/'+groupId+'/false');
}
function switchSelectionMode(){
	setSelectionMode(!switchSelectionModeIsMultiple);
}

//with flowPlayer plugin
function displayAudioPlayer(mediaId){
	flowplayer(
		mediaId,
		'flowplayer-3.2.11.swf',
		{
			plugins: {
				controls: {
					backgroundColor: '#696969',
					fullscreen: false,
					height: 26,
					autoHide: false
				}
			},
			clip: {
				type: 'audio',
				autoPlay: false
			}
		}
	);
}

function displayVideoPlayer(mediaId){
	flowplayer(
		mediaId,
		'flowplayer-3.2.11.swf',
		{
			plugins: {
				controls: {
					backgroundColor: '#696969',
					fullscreen: true,
					autoHide: false
				}
			},
			clip: {
				scaling: 'no',
				type: 'video',
				autoPlay: false
			}
		}
	);
}

function previewUnzipForViewing(fileSrc, previewTime){
	update('elementPreview/'+fileSrc+'/unzipForViewing/');
}

function previewHtml(fileSrc, previewTime){
	$.blockUI(
		{
			css: {
				top: '5%',
				left: '3%',
				border: 'none',
				width: '90%',
				height:'90%'
			},
			message: '<div class=\'ui-corner-all\' style=\'position:absolute; top:3%px; left:101%; font-style:bold;font-size:10px;padding:5px 10px 5px 10px;cursor:pointer; background-color:#fff;\' onclick=\'$.unblockUI();$("#fileDownloadingBar").hide();\' >X</div><iframe onload=\'$("#fileDownloadingBar").hide();\' style=\'height:100%;width:100%;\'src=\''+SITE_ROOT +"useContext/"+crtContextId+EXEC_requestSeparator+ fileSrc.replace(SITE_ROOT, '')+'/integrated?'+previewTime+'\' >Your browser does not support iframes.</iframe>'
		}
	);
	$('.blockOverlay').unbind('click').click($.unblockUI);
}

function previewIframe(url){
	$.blockUI(
		{
			css: {
				top: '5%',
				left: '3%',
				border: 'none',
				width: '90%',
				height:'90%'
			},
			message: '<div class=\'ui-corner-all\' style=\'position:absolute; top:3%px; left:101%; font-style:bold;font-size:10px;padding:5px 10px 5px 10px;cursor:pointer; background-color:#fff;\' onclick=\'$.unblockUI();\' >X</div><iframe style=\'height:100%;width:100%;\'src=\''+url+'\' >Your browser does not support iframes.</iframe>'
		}
	);
	$('.blockOverlay').unbind('click').click($.unblockUI);
}

function previewImage(fileSrc, previewTime){
	$.blockUI({
		css: {
			top: '10%',
			left: '10%',
			border: 'none',
			width: '80%',
			height:'80%',
			background: 'none'
		}, message: '<img style=\'max-height:100%;max-width:100%;vertical-align:middle;\' onload=\'$("#fileDownloadingBar").hide();\' src=\''+SITE_ROOT +"useContext/"+crtContextId+EXEC_requestSeparator+ fileSrc.replace(SITE_ROOT, '')+'?'+previewTime+'\' /><span class=\'ui-corner-all\' style=\'position:absolute; font-style:bold;font-size:10px;padding:5px 10px 5px 10px;margin-left:5px;margin-top:0px;cursor:pointer; background-color:#fff;\'  onclick=\'$.unblockUI(); $("#fileDownloadingBar").hide();\' >X</span>'
	});
	$('.blockOverlay').unbind('click').click($.unblockUI);
}

function setListenersToFiltersBsp(){
    $('nav input:first').change(function(){
        hideHelp();
        $(this).next().next().click();
    });
    $('nav #goForSearch').click(function(){
        setVis("busyDiv", true);
        setVis('filteringBar', true);
        url = SITE_ROOT +'Update/'+crtContextId+EXEC_requestSeparator+ 'filtersDialog/'+crtWigiiNamespaceUrl+'/'+crtModuleName+'/simpleFilters';
        var myAjax = new jQuery.ajax({
            type: 'POST',
            url: encodeURI(url),
            success : parseUpdateResult,
            cache:false,
            data: {action: 'check', __textSearch_value:$(this).prev().prev().val()},
            error: errorOnUpdate
        });
    });
    $('nav #filtersButton').click(function(){
        update('filtersDialog/'+crtWigiiNamespaceUrl+'/'+crtModuleName+'/filters');
    });
    $('nav #removeFiltersButton').click(function(){
        $('nav input:first').val('');
        update('filtersDialog/'+crtWigiiNamespaceUrl+'/'+crtModuleName+'/removeFilters');
    });
}
/**
 * @deprecated since v.4.602 28.11.2017
 */
function setListenersToFilters(){
	$('#workZone #searchBar input:first').change(function(){
		hideHelp();
		$(this).next().next().click();
	});
	$('#workZone #searchBar #goForSearch').click(function(){
		setVis("busyDiv", true);
		setVis('filteringBar', true);
		url = SITE_ROOT +'Update/'+crtContextId+EXEC_requestSeparator+ 'filtersDialog/'+crtWigiiNamespaceUrl+'/'+crtModuleName+'/simpleFilters';
		var myAjax = new jQuery.ajax({
				type: 'POST',
				url: encodeURI(url),
				success : parseUpdateResult,
				cache:false,
				data: {action: 'check', __textSearch_value:$(this).prev().prev().val()},
				error: errorOnUpdate
			});
	});
	$('#workZone #searchBar #filtersButton').click(function(){
		update('filtersDialog/'+crtWigiiNamespaceUrl+'/'+crtModuleName+'/filters');
	});
	$('#workZone #searchBar #removeFiltersButton').click(function(){
		$('#workZone #searchBar input:first').val('');
		update('filtersDialog/'+crtWigiiNamespaceUrl+'/'+crtModuleName+'/removeFilters');
	});
}

function setFiltersButton(isFilterSet){
	if(isFilterSet){
		$("#filtersButton").removeClass('grayFont').addClass('R');
		$("#removeFiltersButton").removeClass('grayFont').addClass('R');
	} else {
		$("#removeFiltersButton").addClass('grayFont').removeClass('R');
		$("#filtersButton").addClass('grayFont').removeClass('R');
	}
}

function setListenersToCheckInOutFiles(elementDialogId, elementId, fieldId, fieldName, checkFunction, checkTitleText, okLabel, cancelLabel){
	//if no elementDialogId that means we are looking at the item directly in the mainDiv
	if(elementDialogId==""){
		elementDialogId="mainDiv";
	}
	$('#'+fieldId+'.field .value .checkOutIn').click(function(e){
		$(this).after('<div class="SBB ui-corner-all" style="font-size:small;background-color:#fff;z-index:'+($(this).closest('.ui-dialog').css('zIndex')+1)+';top:'+(parseInt($(this).position().top)+parseInt($(this).outerHeight())+8)+'px; left:'+$(this).position().left+'px; padding:5px; position:absolute;" ><div style="font-size:small;">'+checkTitleText+'</div><textarea style="width:300px;margin-top:5px; margin-bottom:5px;height:100px;" class=""></textarea><br /><input type="button" name="ok" value="'+okLabel+'" /><input type="button" name="cancel" value="'+cancelLabel+'" /></div>');
		autosize($(this).next().find('.elastic'));
		$(this).next().find('input:input:last').click(function(){
			$(this).parent().hide().remove();
		});
		$(this).next().find('input:input:first').click(function(){
			$(this).parent().hide();
			if(elementDialogId!="mainDiv"){
				$(this).closest('.ui-dialog').find('.ui-icon-closethick').click();
				url = SITE_ROOT +'Update/'+crtContextId+EXEC_requestSeparator+ 'NoAnswer/'+crtWigiiNamespaceUrl+'/'+crtModuleName+'/'+checkFunction+'/'+elementId+'/'+fieldName;
			} else {
				url = SITE_ROOT +'Update/'+crtContextId+EXEC_requestSeparator+ 'mainDiv/'+crtWigiiNamespaceUrl+'/'+crtModuleName+'/'+checkFunction+'/'+elementId+'/'+fieldName;
			}
			
			if(checkFunction == 'download/checkoutFile') {
				messageDownload(fieldId);
				setTimeout(function() {setVis('fileDownloadingBar', false);}, 5000);
			}			
			var myAjax = new jQuery.ajax({
					type: 'POST',
					url: encodeURI(url),
					success : parseUpdateResult,
					cache:false,
					data: {message:$(this).parent().find('textarea').val(), elementDialogId: elementDialogId },
					error: errorOnUpdate
				});
			});
		e.stopPropagation();
	});
	if($('#'+elementDialogId+' div.T div.el_edit').length==0 || $('#'+fieldId+'.readOnly').length>0){
		$('#'+fieldId+'.field .value .checkOutIn').hide();
	}
}

function setListenerToMultipleDialog(
	externalAccessMenusendEmailTitle,
	multipleExternalAccessMenuView,
	multipleExternalAccessMenuEdit,
	multipleExternalAccessMenuStop,
	externalAccessMenuEndDate,
	okLabel,
	cancelLabel,
	areYouSureToStopExternalAccess){

	$('#multipleDialog').prev().css('background-color', '#FFE694');
	$('#multipleDialog').css('min-height', '0px');
	$('#multipleDialog').parent().find('.ui-dialog-title')
		.append($('#multipleDialog .toolBar .selectAll'))
		.append($('#multipleDialog .toolBar .resetAll'))
		.append($('#multipleDialog .toolBar .viewAll'));
	$('#multipleDialog').next().hide();

	if(externalAccessMenusendEmailTitle){
		emb = $('#multipleDialog .multipleExternalAccess');
		$(emb).click(function(){
			$(this).parent().find('.externalAccessMenu').remove();
			externalAccessMenuHtml = ''+
				'<span class="externalAccessMenu SBB ui-corner-all" style="font-weight:normal;background-color:#fff;top:'+(parseInt($(emb).position().top)+parseInt($(emb).outerHeight())-50)+'px; left:'+($(emb).position().left-50)+'px; padding:5px; position:absolute;" >'+
					'<span style="width:380px;font-weight:bold;">'+externalAccessMenusendEmailTitle+'</span><br />';
			if(multipleExternalAccessMenuView){
				externalAccessMenuHtml += ''+
					'<input type="radio" name="MultipleExternalAccessEmailManage" value="externalAccessMenuViewLink" /><span style="cursor:pointer;margin-top:-2px;" onclick="$(this).prev().click();">'+multipleExternalAccessMenuView+'</span><br />';
			}
			if(multipleExternalAccessMenuEdit){
				externalAccessMenuHtml += ''+
					'<input type="radio" name="MultipleExternalAccessEmailManage" value="externalAccessMenuEditLink" /><span style="cursor:pointer;margin-top:-2px;" onclick="$(this).prev().click();">'+multipleExternalAccessMenuEdit+'</span><br />';
			}
			externalAccessMenuHtml += ''+
					'<input type="radio" name="MultipleExternalAccessEmailManage" value="externalAccessMenuStop" /><span style="cursor:pointer;margin-top:-2px;" onclick="$(this).prev().click();">'+multipleExternalAccessMenuStop+'</span><br />' +
					'<span class="endDate" style="display:none;cursor:pointer;"><br /><span class="endDate" style="cursor:pointer;margin-right:5px;" onclick="$(this).next().focus();">'+externalAccessMenuEndDate+'</span><input class="endDate" type="text" name="externalAccessEndDate" value="" /><br /></span>'+
					'<br />'+
					'<input type="button" name="ok" disabled="on" value="'+okLabel+'" />'+
					'<input type="button" name="cancel" value="'+cancelLabel+'" />'+
				'</span>';
			$(this).after(externalAccessMenuHtml);
			$(this).next().find('input[type="radio"]').click(function(){
				$(this).attr('checked', true);
				$(this).parent().find('input[type="button"]:input[name="ok"]').removeAttr('disabled');
				showEndDate = false;
				switch($(this).val()){
					case 'externalAccessMenuValidationLink':
						$(this).parent().find('span.stopAccess').remove();
						showEndDate = false;
						break;
					case 'externalAccessMenuViewLink':
						$(this).parent().find('span.stopAccess').remove();
						showEndDate = true;
						break;
					case 'externalAccessMenuEditLink':
						$(this).parent().find('span.stopAccess').remove();
						showEndDate = true;
						break;
					case 'externalAccessMenuStop':
						$(this).parent().find('input[type="button"]:input[name="ok"]').before('<span class="stopAccess">'+areYouSureToStopExternalAccess+'<br /><br /></span>');
						showEndDate = false;
						break;
				}
				if(showEndDate) {
					$(this).parent().find('input.endDate').datepicker({
							dateFormat: 'dd.mm.yy',
							changeYear: true,
							firstDay:1,
							constrainInput:true,
							showOn:'button'
						})
						.width('75')
						.click(function(){
							$(this).datepicker('hide');
						});
					$(this).parent().find('.endDate').show();
				} else $(this).parent().find('.endDate').hide();
			});
			$(this).next().find('input[type="button"]:input[name="cancel"]').click(function(){
				$(this).parent().hide().remove();
			});
			$(this).next().find('input[type="button"]:input[name="ok"]').click(function(){
				$(this).parent().hide();
				url = SITE_ROOT +'Update/'+crtContextId+EXEC_requestSeparator+ 'confirmationDialog/'+crtWigiiNamespaceUrl+'/'+crtModuleName+'/element/manageEmails/multiple';
						var myAjax = new jQuery.ajax({
							type: 'POST',
							url: encodeURI(url),
							success : parseUpdateResult,
							cache:false,
							data: {
								externalAction: $(this).parent().find('input:radio:checked').val(),
								externalEndDate: $(this).parent().find('input.endDate').val()
							},
							error: errorOnUpdate
						});
				$(this).parent().remove();
			});
		});
	}

	// element statuses
	$('#multipleDialog div.elementStates div.onlyWriteRights').click(function(e){
		state = $(this).attr('href').replace('#', '');
		if($(this).hasClass('unchecked')) {
			$(this).addClass('checked').removeClass('unchecked');
			update('NoAnswer/'+crtWigiiNamespaceUrl+'/'+crtModuleName+'/setElementState/multiple/'+state+'/1');
		}
		else if($(this).hasClass('checked')) {
			$(this).addClass('unchecked').removeClass('checked');
			update('NoAnswer/'+crtWigiiNamespaceUrl+'/'+crtModuleName+'/setElementState/multiple/'+state+'/0');
		}
		else if($(this).hasClass('mixed')) {
			$(this).addClass('checked').removeClass('mixed');
			update('NoAnswer/'+crtWigiiNamespaceUrl+'/'+crtModuleName+'/setElementState/multiple/'+state+'/1');
		}
		e.stopPropagation();
	});
}
function popup_params(width, height) {
    var a = typeof window.screenX != 'undefined' ? window.screenX : window.screenLeft;
    var i = typeof window.screenY != 'undefined' ? window.screenY : window.screenTop;
    var g = typeof window.outerWidth!='undefined' ? window.outerWidth : document.documentElement.clientWidth;
    var f = typeof window.outerHeight != 'undefined' ? window.outerHeight: (document.documentElement.clientHeight - 22);
    var h = (a < 0) ? window.screen.width + a : a;
    var left = parseInt(h + ((g - width) / 2), 10);
    var top = parseInt(i + ((f-height) / 2.5), 10);
    return 'width=' + width + ',height=' + height + ',left=' + left + ',top=' + top + ',location=0,menubar=0,status=0,toolbar=0,scrollbars=1,resizable=1';
}
function setListenerToPreviewListLines(previewListId, moduleName, linkType, wListenerToPreviewList, gtIndex){
	var crtwListenerToPreviewList = wListenerToPreviewList;
	var crtPreviewListId = previewListId;
	var crtLinkType = linkType;
	var moreSelector = "";
	if(gtIndex){
		moreSelector = ":gt("+(gtIndex)+")";
	}

	if(crtLinkType == 'query') {
		$('#'+crtPreviewListId+' tr:not(.loadNextLines)'+moreSelector).click(function(e){
			var res = $(this).attr('id').split('$$');
			var wigiiNamespaceUrl = res[3];
			var moduleUrl = res[4];
			var eltId = res[5];
			window.open(SITE_ROOT+'#'+wigiiNamespaceUrl+'/'+moduleUrl+'/item/'+eltId);
			e.stopPropagation();
		});
	}
	else {
		$('#'+crtPreviewListId+' tr:not(.loadNextLines)'+moreSelector).click(function(e){
			var res = $(this).attr('id').split('$$');
			var ownerEltId = res[1];
			var linkName = res[2];
			var eltId = res[3];
			//always refer to module and namespace of parent
			self.location = '#'+crtWigiiNamespaceUrl+'/'+crtModuleName+'/item/'+eltId;
			//update('elementDialog/'+crtWigiiNamespaceUrl+'/'+crtModuleName+'/element/detail/'+eltId);
			updateThroughCache('elementDialog', $(this).attr('href').replace('#', ''), 'elementDialog/'+crtWigiiNamespaceUrl+'/'+crtModuleName+'/element/detail/'+eltId);
			e.stopPropagation();
		});
		$('#'+crtPreviewListId+' tr:not(.loadNextLines)'+moreSelector+' td.edit').click(function(e){
			var res = $(this).parent().attr('id').split('$$');
			var ownerEltId = res[1];
			var linkName = res[2];
			var eltId = res[3];
			//always refer to module and namespace of parent
			update('elementDialog/'+crtWigiiNamespaceUrl+'/'+crtModuleName+'/element/edit/'+eltId);
			e.stopPropagation();
		});
		$('#'+crtPreviewListId+' tr:not(.loadNextLines)'+moreSelector+' td.delete').click(function(e){
			var res = $(this).parent().attr('id').split('$$');
			var ownerEltId = res[1];
			var linkName = res[2];
			var eltId = res[3];
			//always refer to module and namespace of parent
			update('elementDialog/'+crtWigiiNamespaceUrl+'/'+crtModuleName+'/element/detail/'+eltId+'/__/confirmationDialog/'+crtWigiiNamespaceUrl+'/'+crtModuleName+'/element/delete/'+eltId);
			e.stopPropagation();
		});
		$('#'+crtPreviewListId+' tr:not(.loadNextLines)'+moreSelector+' td.restore').click(function(e){
			var res = $(this).parent().attr('id').split('$$');
			var ownerEltId = res[1];
			var linkName = res[2];
			var eltId = res[3];
			//always refer to module and namespace of parent
			//preventing Request forgery (CSRF) with posting data
			update('confirmationDialog/'+crtWigiiNamespaceUrl+'/'+crtModuleName+'/element/restore/'+eltId, false, {action:"check"});
			e.stopPropagation();
		});
	}

	$('#'+crtPreviewListId+' tr:not(.loadNextLines)'+moreSelector+' td:not(.delete, .restore, .edit)>div')
		.mouseenter(function(e){
			showHelp(this, $(this).html(), 30, 'fromLeft', 500, Math.max(200, $(this).width()), 60000);
		})
		.mouseleave(function(e){ hideHelp(); })
}
function setListenerToAddSubItem(fieldId, elementId, linkName){
	//click on add subitems
	$('#'+fieldId+' .addNewSubElement').click(function(e){
		update('elementDialog/'+crtWigiiNamespaceUrl+'/'+crtModuleName+'/subelement/add/'+elementId+'/'+linkName);
		e.stopPropagation();
	});
}
function setListenerToPreviewList(elementId, linkName, previewListId, moduleName, wListenerToPreviewList, linkType){
	var crtwListenerToPreviewList = wListenerToPreviewList;
	var crtPreviewListId = previewListId;
	var crtElementId = elementId;
	var crtLinkName = linkName;
	var crtLinkType = linkType;


	//click on the value
	$('#'+crtPreviewListId).prev().find('.H:first').click(function(e){
		$('#'+crtPreviewListId).toggle();
		e.stopPropagation();
	});

	//click on lines
	setListenerToPreviewListLines(crtPreviewListId, moduleName, crtLinkType, crtwListenerToPreviewList, null);

	//click on load more...
	$('#'+crtPreviewListId+' tr.loadNextLines').click(function(e){
		var tot = parseInt($(".totalItems", this).text());
		var pageSize = parseInt($(".pageSize", this).text());
		var nbItem = parseInt($(".nbItem", this).text());

		//update preview table with next items
		url = crtWigiiNamespaceUrl+"/"+crtModuleName+"/getNextElementInPreviewList/"+crtElementId+"/"+crtLinkName;
		url = SITE_ROOT +"useContext/"+crtContextId+EXEC_requestSeparator+ url;

		setVis("busyDiv", true);
		var myAjax = new jQuery.ajax({
				type: 'POST',
				url: encodeURI(url),
				cache:false,
				data:{
					page: (nbItem/pageSize)+1,
					elementId : elementId,
					previewListId : crtPreviewListId
					},
				success : function(returnText, textStatus){
					setVis("busyDiv", false);
					data = returnText.split('_X_NBNEWROWS_X_');
					nbLoaded = parseInt(data[1]);
					nbTot = parseInt(data[2]);
					data = data[0];
					$('#'+crtPreviewListId+' tr.loadNextLines').before(data);
					if(e.which || (!e.which && nbItem == 0)) $('#'+crtPreviewListId+' tr.loadNextLines .nbItem').html(nbItem + nbLoaded);
					$('#'+crtPreviewListId+' tr.loadNextLines .totalItems').html(nbTot);

					setListenerToPreviewListLines(crtPreviewListId, moduleName, crtLinkType, crtwListenerToPreviewList, nbItem);

					if((nbItem + nbLoaded) >= nbTot){
						//remove see more
						$('#'+crtPreviewListId+' tr.loadNextLines>td>font').hide();
					} else {
						$('#'+crtPreviewListId+' tr.loadNextLines>td>font').show();
					}
					//update the cache content
					// Modified by AC on 06 july 2016 to handle dynamic javascript from config. Do not store modified HTML in cache but only store click instruction
					// e.which is not undefine if the user use the mouse and click
					//updateCurrentElementDialogViewCache();
					if(__cacheJS && __cacheJS["elementDialog"] && __cacheJS["elementDialog"][currentElementDialogViewCacheKey] && e.which){
						var cacheJSaddon = "$(document).ready(function(){" +
									"$('#"+crtPreviewListId+" tr.loadNextLines').click();" +
									"$('#"+crtPreviewListId+" tr.loadNextLines .nbItem').html("+(nbItem + nbLoaded)+"); ";
						if((nbItem + nbLoaded) >= nbTot) cacheJSaddon+= "$('#"+crtPreviewListId+" tr.loadNextLines>td>font').hide();";
						cacheJSaddon+= "});"
						__cacheJS["elementDialog"][currentElementDialogViewCacheKey] = __cacheJS["elementDialog"][currentElementDialogViewCacheKey]+cacheJSaddon;
					}
				},
				error: errorOnUpdate
			});
		onUpdateErrorCounter = 0;

		//update total/nbItem

		e.stopPropagation();
	});

	//click on refresh
	$('#'+crtPreviewListId+' .refresh').click(function(e){
		// Modified by AC on 06 july 2016 to handle dynamic javascript from config. Do not store modified HTML in cache but only store click instruction
		if(__cacheJS && __cacheJS["elementDialog"] && __cacheJS["elementDialog"][currentElementDialogViewCacheKey]){
			var regexExpression = "(\\$\\(document\\)\\.ready\\([\\s]*function\\(\\)[\\s]*\\{[\\w\\s\\n\\r$()'#.;]*(?:value[\\s]*tr\\.loadNextLines\\'\\)\\.click\\(\\);){1}[\\w\\s\\n\\r$()'#.;]*\\}\\);)";
			regexExpression = regexExpression.replace('value', crtPreviewListId);
			var theRegExp = new RegExp(regexExpression, 'gmi');
			__cacheJS["elementDialog"][currentElementDialogViewCacheKey] = __cacheJS["elementDialog"][currentElementDialogViewCacheKey].replace(theRegExp, '');
		}
		//empty previewList
		$('#'+crtPreviewListId+' tr:not(.loadNextLines, .header)').remove();
		$('#'+crtPreviewListId+' tr.loadNextLines .nbItem').html(0);
		$('#'+crtPreviewListId+' tr.loadNextLines').click();
		e.stopPropagation();
		return false;
	});

	// if linkType is query then updates link value with total
	if(crtLinkType == 'query') {
		$('#'+crtPreviewListId).prev().find('.linkTypeQuery').html('('+$('#'+crtPreviewListId+' tr.loadNextLines .totalItems').text()+')');
	}
}

elementCalendar_currentEventSelected = null;
elementCalendar_contextMenuIdElement = null;
lastResizeOrDragRevertFunction = null;
lastModifiedEvent = null;
//callbackOnEventFetch is a function to call when events are fetched. Typically used to update indicators calculation
function setListenersToCalendar(groupUpId, groupUpLabel, crtLanguage, crtView, crtDate, callbackOnEventFetch){
	
	var cmSelector = '#moduleView .calendar>.cm';
	var elSelector = '#moduleView .dataZone a.fc-event';
	
	$('#moduleView .calendar').fullCalendar({
		locale : crtLanguage, 
		defaultView: crtView,
		defaultDate: crtDate,
		slotLabelFormat: 'H:mm',
		header: {
			left: 'prev,next today',
			center: 'title',
			right: 'month,agendaWeek,listWeek'
		},
		businessHours: {
			// days of week. an array of zero-based day of week integers (0=Sunday)
			dow: [ 1, 2, 3, 4, 5 ], // Monday - Thursday
			start: '08:00', // a start time (10am in this example)
			end: '17:00', // an end time (6pm in this example)
		},
		views: {
			month : {
				columnHeaderFormat: 'ddd',
				titleFormat: 'MMMM YYYY',
				timeFormat: 'H:mm',
				displayEventTime : true,
				displayEventEnd : true
			},
			agendaWeek : {
				columnHeaderFormat: 'ddd DD MMM',
				titleFormat: 'DD MMM YYYY',
				timeFormat: 'H:mm',
				displayEventTime : true,
				displayEventEnd : true
			}
		},
		lazyFetching: false,
		timezone: false,
		height: $('#moduleView').height() - parseInt($('#moduleView .calendar').css('margin-top'),10),
		firstDay: 1,
		editable: calendarIsEditable,
		eventDragStart: function(event, jsEvent, ui, view){

		},
		eventResizeStart: function(event, jsEvent, ui, view){

		},
		eventDrop: function(event,delta,revertFunc, jsEvent, ui, view) {
			if($(this).hasClass('readOnly')){
				revertFunc();
			} else {
				start = event.start;
				end = event.end;
				allDay = event.allDay;
				if(end == null) end = start.add(1,'day');
				if(allDay || !end.hasTime() || end.format("HH:mm:mm")=="00:00:00"){
					end.subtract(1, 'second'); //to prevent change of date when selecting a day or to the end of the day
				}
				lastResizeOrDragRevertFunction = revertFunc;
				update('elementDialog/'+crtWigiiNamespaceUrl+'/'+crtModuleName+'/element/edit/'+event.id+'/'+start.format('YYYY-MM-DD HH:mm')+'/'+end.format('YYYY-MM-DD HH:mm')+'/'+allDay);
			}
	    },
		eventResize: function(event, delta, revertFunc, jsEvent, ui, view){
			if((event.className+'').search('readOnly')!=-1){
				revertFunc();
			} else {
				start = event.start;
				end = event.end;
				allDay = event.allDay;
				if(end == null) end = start.add(1,'day');
				if(allDay || !end.hasTime() || end.format("HH:mm:mm")=="00:00:00"){
					end.subtract(1, 'second'); //to prevent change of date when selecting a day or to the end of the day
				}
				lastResizeOrDragRevertFunction = revertFunc;
				update('elementDialog/'+crtWigiiNamespaceUrl+'/'+crtModuleName+'/element/edit/'+event.id+'/'+start.format('YYYY-MM-DD HH:mm')+'/'+end.format('YYYY-MM-DD HH:mm')+'/'+allDay);
			}
		},
		eventAfterRender: function(event, element, view){
			colorize();
		},
		selectable: calendarIsEditable,
		selectHelper: true,
		select: function(start, end, jsEvent) {
			allDay = !start.hasTime();
			if(allDay || !end.hasTime() || end.format("HH:mm:mm")=="00:00:00"){
				end.subtract(1, 'second'); //to prevent change of date when selecting a day or to the end of the day
			}
			update('elementDialog/'+crtWigiiNamespaceUrl+'/'+crtModuleName+'/element/add/'+$('#groupPanel li.selected').attr('id').split('_')[1]+'/'+start.format('YYYY-MM-DD HH:mm')+'/'+end.format('YYYY-MM-DD HH:mm')+'/'+allDay);
		},
		events: function(start, end, timezone, callback) {
			crtView = $('#moduleView .calendar').fullCalendar('getView').name;
			crtDate = $('#moduleView .calendar').fullCalendar('getDate');
			//crtDate = 'crtYear='+crtDate.getFullYear()+';crtMonth='+crtDate.getMonth()+';crtDay='+crtDate.getDate()+';';
	        $.ajax({
	            url: encodeURI(SITE_ROOT +"useContext/"+crtContextId+EXEC_requestSeparator+crtWigiiNamespaceUrl+'/'+crtModuleName+'/getCalendarEvents/'+start.unix()+'/'+end.unix()+'/'+crtView+'/'+crtDate.unix()),
		            dataType: 'text',
					cache:false,
					error: errorOnUpdate,
		            success: function(events){
						events = eval(events);
						if(events.length>0){
							firstEvent = events[0];
//								tempFirstDate = new Date(parseInt(firstEvent.start)*1000);
//								alert(tempFirstDate.getFullYear()+'.'+tempFirstDate.getMonth()+'.'+tempFirstDate.getDate());
//								alert(firstEvent.end*1000>=start.getTime()+' '+firstEvent.start*1000<=end.getTime());
							if(!(moment(firstEvent.end).unix() >= start.unix() && moment(firstEvent.start).unix() <= end.unix())){
								$('#moduleView .calendar').fullCalendar('gotoDate', firstEvent.start);
							}
						}
						if(callbackOnEventFetch){
							callbackOnEventFetch();
						}
						callback(events);
						//colorize();
					}
	        });
	    },
		eventRender: function(event, element) {
	        element.find('.fc-event-title').html(event.title);
	        element.unbind('contextmenu');
	        element.bind('contextmenu', function (e) { //FullCalendar right click properly handled
	            if (e.which == 3) {
					hideHelp();
	            	$(this).closest(elSelector).addClass('over');
	            	$('#moduleView .calendar .S').removeClass('S');
	        		$('#moduleView .calendar div.over').addClass('S');
	        		positionElementOnMouse($(cmSelector), e, 'fromRight', null, 5);
	        		//show hide some buttons: Default values
	        		elEnableState = $('0');
	        		elState = $('0');
	        		//saving the id of element clicked
	        		if($(cmSelector + " > div.idSelect").length ){
	        			$(cmSelector + " > div.idSelect").attr("id", event.id);
	        		} else {
	        			$(cmSelector).append('<div class="idSelect" id="'+event.id+'" style="display: none;"></div>');
	        		}
	        		if(event.editable == "false"){
	        			$(cmSelector+' div.write').hide();
	        		} else {
	        			$(cmSelector+' div.write').show();
	        		}
	        		if($('#moduleView .toolBar .addNewElement.disabledBg').length>0){
	        			$(cmSelector+' #cm_addElementInList').hide();
	        		} else {
	        			$(cmSelector+' #cm_addElementInList').show();
	        		}
	        		if(elState & 2) {
	        			$(cmSelector+' #cm_edit').hide();
	        			$(cmSelector+' #cm_delete').hide();
	        			$(cmSelector+' #cm_organize').hide();
	        		}
	        		$(cmSelector).show();
	        		e.stopPropagation();
					return false;
	            }
	        });
	    },

		loading: function(isLoading, view){
			setVis('busyDiv', isLoading);
		},
		eventClick: function(calEvent, jsEvent, view) {
			clickEvent_elementCalendar(this, calEvent, jsEvent, view, crtWigiiNamespaceUrl, crtModuleName);
			},
		eventMouseover: function(calEvent, jsEvent, view){
			elementCalendar_contextMenuIdElement = calEvent.id;
			hideHelp();
			//displaying description under mouse position
			showHelp(this, calEvent.description, 30, "fromCenter", 200, 200, 5000, jsEvent);
		}
	});
	if(groupUpId!==""){
		$('#moduleView .calendar .fc-header-left').append('<span class="folderUp L H" >'+groupUpLabel+'</span>');
		//add click on folder up
		$('#moduleView .calendar span.folderUp').click(function(e){
			$('#groupPanel #group_'+groupUpId).click();
			e.stopPropagation();
		});
	}
	//Context menu
	$(cmSelector).mouseleave(function(){
		$(elSelector).removeClass('over');
		$(this).hide();
	});
	$(cmSelector).click(function(){
		$(elSelector).removeClass('over');
		$(this).hide();
	});
	$(cmSelector + '>div').unbind();
	$(cmSelector + '>div').click(function(e){
		if($(this).attr('id')=="cm_exit") return true;
		if($(this).attr('id')=="cm_open"){
			$(elSelector+'.over').click();
			return true;
		}
		//Recovering the id of element clicked
		idItem = $(cmSelector + ' > div.idSelect').attr('id');
		
		if($(this).attr('id')=="cm_addElementInList"){
			$('#searchBar .toolbarBox .addNewElement').click();
			return true;
		}
		
		if($(this).hasClass('unchecked')) {
			checked = 1;
			$(this).removeClass('unchecked').addClass('checked');
		}
		else if($(this).hasClass('checked')) {
			checked = 0;
			$(this).removeClass('checked').addClass('unchecked');
		}
		else checked = -1;

		if($(this).attr('id')=="cm_edit"){
			update('elementDialog/'+crtWigiiNamespaceUrl+'/'+crtModuleName+'/element/edit/'+idItem);
			return true;
		}
		if($(this).attr('id')=="cm_delete"){
			update('elementDialog/'+crtWigiiNamespaceUrl+'/'+crtModuleName+'/element/delete/'+idItem+'/elementDialog');
			return true;
		}
		if($(this).attr('id')=="cm_copy"){
			copyWithOrganize('elementDialog/'+crtWigiiNamespaceUrl+'/'+crtModuleName, idItem);
			//update('elementDialog/'+crtWigiiNamespaceUrl+'/'+crtModuleName+'/element/copy/'+idItem+'/'+$('#groupPanel li.selected').attr('id').split('_')[1]);
			return true;
		}
		if($(this).attr('id')=="cm_organize"){
			openOrganizeDialog(idItem);
			return true;
		}
		e.stopPropagation();
	});
}
function resize_calendar(){
	if($('#moduleView .calendar').length>0){
		$('#moduleView .calendar').height($('#groupPanel').height() - parseInt($('#moduleView .calendar').css('margin-top'),10) - $('#moduleView .toolBar').height());
		if ( $('#moduleView .calendar .fc-view-container').length > 0 ) { //do this only if calendar is already rendered
			$('#moduleView .calendar').fullCalendar('option', 'height', $('#moduleView .calendar').height()-3);
		}
	}
}
function selectEvent_elementCalendar(){
	if(switchSelectionModeIsMultiple){
		//multiple mode
		$('#moduleView .calendar div.over').addClass('M');
	} else {
		//unique mode
		$('#moduleView .calendar .S').removeClass('S');
		$('#moduleView .calendar div.over').addClass('S');
	}
	elementCalendar_currentEventSelected = elementCalendar_contextMenuIdElement;
}
function clickEvent_elementCalendar(domObj, calEvent, jsEvent, view, myWigiiNamespace, module){
	if(switchSelectionModeIsMultiple){
		//multiple mode
		$(domObj).addClass('M');
	} else {
		//unique mode
		$('#moduleView .calendar .S').removeClass('S');
		$(domObj).addClass('S');
	}
	elementCalendar_currentEventSelected = calEvent.id;
	if(!switchSelectionModeIsMultiple){
		update('elementDialog/'+myWigiiNamespace+'/'+module+'/element/detail/'+elementCalendar_currentEventSelected);
	}
}

var crtBlogViewNbOfColumns = 2;
var crtBlogViewItemWidth = false;
function resize_blog(){
	if($('#moduleView .blog').length>0){
		var modViewWidth = $('#moduleView').width();
		var blogWidth = Math.floor((modViewWidth-6-10) / crtBlogViewNbOfColumns); //contains margin 1x + rounding
		var blogHeight = $(window).height()-$('#moduleView>div.blog .dataBlog').position().top - fb.outerHeight()-3 - $('#moduleView #indicators').height();
		blogWidth = blogWidth - 42 - 2; //padding 2x, border 2x, margin 1x + rounding
		if(crtBlogViewItemWidth) blogWidth = crtBlogViewItemWidth;
		if(blogHeight<0){
            $('#moduleView').width($('#moduleView').width()-1);
            var blogHeight = $(window).height()-$('#moduleView>div.blog .dataBlog').position().top - fb.outerHeight()-3 - $('#moduleView #indicators').height();
		}
		$('#moduleView>div.blog div.el:not(.max)').width(blogWidth);
		$('#moduleView>div.blog .dataBlog').height(blogHeight);
    }
}
function resize_wncd(){
	// only changes height. width of wncd view is assumed to be always 100%.
	if($('#moduleView div.dataZone.wncd').length>0){
		$('#moduleView div.dataZone.wncd').height($('#groupPanel').height() - parseInt($('#moduleView div.dataZone.wncd').css('margin-top'),10) - $('#moduleView #indicators').height() - $('#moduleView .toolBar').height());
	}
}


//Normalizing mousewheel speed across browsers
//find on http://stackoverflow.com/questions/5527601/normalizing-mousewheel-speed-across-browsers
function normalizeWheelSpeed(event) {
    var normalized;
    if (event.wheelDelta) {
        normalized = (event.wheelDelta % 120 - 0) == -0 ? event.wheelDelta / 120 : event.wheelDelta / 12;
    } else {
        var rawAmmount = event.deltaY ? event.deltaY : event.detail;
        normalized = -(rawAmmount % 3 ? rawAmmount * 10 : rawAmmount / 3);
    }
    return normalized;
}

//calculate the height of dialogeElement scroll area
function getElementDialogScrollHeight(name, object){
	var height = window.innerHeight;
	if(object.prop('id')=='scrollElement') {
		height = height - object.parent().parent().offset().top;
	} else {
		height = height - object.parent().offset().top;
	}	
	switch(name){
		case 'neighbour':
			height-= object.prev().outerHeight(true);
			if(object.next().hasClass('scrollGradient'))
				height-= object.next().next().outerHeight(true);
			else
				height-= object.next().outerHeight(true);
			break;
		case 'children':
			height-= object.parent().prev().outerHeight(true);
			height-= object.parent().children().first().outerHeight(true);
			break;
	}
	return (height -30);
}

(function($) {
    $.fn.hasScrollBar = function() {
        return this.get(0).scrollHeight > this.height();
    }
})(jQuery);

//Add gradient on a scroll area
//if no scroll bar exist, create it
function addScrollWithShadow(idScrollElement, elementPreviousTop) {
	if(isWorkzoneViewDocked()) return true;
	if(!$('#'+idScrollElement).hasScrollBar()) return true;
	if (arguments.length<2) elementPreviousTop = 0;
	//change the CSS of an element
	function changeElementCss(element, cssRules){
		for(var index in cssRules) 
			if(cssRules[index]!='na') element.css(index,cssRules[index]);
	}
	//add the scroll event for an element
	function addScrollEvent(element) {	
		element.unbind('scroll');
		element.scroll(function() {
			var self = $(this);
			if(self.next().hasClass('scrollGradient'))
				self.next().css("display",((self.scrollTop() + self.outerHeight() >= this.scrollHeight) ? "none" : "block"));
		});
	}
	//add gradient div, passe the height in the css rules
	function addGradient(element, cssRules){
		if(element.next().hasClass('scrollGradient')) return;
		
		var html = '<div class="scrollGradient" style="';
		for(var index in cssRules)
			html+= index+':'+cssRules[index]+';';
		html+= '"></div>';
		element.after(html);
	}
	
	var scrollElement = $('#'+idScrollElement);
	var element = idScrollElement;
	if(jQuery.inArray(idScrollElement, ['elementDialog', 'emailingDialog', 'filtersDialog', 'activityDialog']) > -1)
		element = ((scrollElement.find('div.T').length == 0) ? "neighbour" : "children");
	var cssArray = {"height":"na","overflow-x":"hidden","overflow-y":"auto","margin-right":"na"};
	switch(element){
		case 'neighbour':
			if(scrollElement.parent().outerHeight(true) > window.innerHeight || scrollElement.prop('scrollHeight') > scrollElement.prop('clientHeight')) { //if the dialog box is bigger than the window height, then resize.				
				cssArray.height = getElementDialogScrollHeight(element, scrollElement);//window.innerHeight - scrollElement.prev().outerHeight(true) - scrollElement.next().outerHeight(true)-30;
				changeElementCss(scrollElement, cssArray);
				addScrollEvent(scrollElement);
				addGradient(scrollElement, {"bottom":(scrollElement.next().outerHeight(true)-7)+"px"});
				scrollElement.next().css({"display":"block"}); //,"width":(scrollElement.innerWidth()-18)+"px"
			} else {
				scrollElement.css('overflow','visible');
			}
			break;
		case 'children':
			if(scrollElement.parent().outerHeight(true) > window.innerHeight) { //if the dialog box is bigger than the window height, then resize.
				scrollElement = $('#scrollElement');
				cssArray.height = getElementDialogScrollHeight(element, scrollElement);//window.innerHeight - scrollElement.prev().outerHeight(true) - toolbarHeight -30;
				cssArray["margin-right"] = "-7px";
				changeElementCss(scrollElement, cssArray);
				addScrollEvent(scrollElement);
				addGradient(scrollElement, {"bottom":"0px"});
				scrollElement.next().css({"display":"block"}); //,"width":(scrollElement.innerWidth()-18)+"px"
			} else {
				$('#scrollElement').css('overflow','visible');
			}
			break;
	}//end switch
	
	scrollElement.scrollTop(elementPreviousTop);
	if(scrollElement.next().hasClass('scrollGradient')) {
		scrollElement.next().unbind('mouseenter DOMMouseScroll mousewheel');
		scrollElement.next().mouseenter(function() {
			scrollElement.animate( { scrollTop: (scrollElement.scrollTop()+40) }, 750 );
		}).bind('DOMMouseScroll mousewheel', function(e){
			scrollElement.scrollTop(scrollElement.scrollTop()+(-normalizeWheelSpeed(e.originalEvent)*10));//*10 for better amplitude and - for invert the sens
	    });
	}
}

//resize function for elementDialog for the moment
function resize_scrollArea(keepScrollPosition){
	if (arguments.length<1) keepScrollPosition = false;
	if(isWorkzoneViewDocked() && !crtModuleName=='Admin') return true;
	var elements = ['elementDialog', 'emailingDialog', 'filtersDialog', 'activityDialog'];
	var element = null;
	var elementName = 'elementDialog';
	var elementPreviousTop = 0;
	// find the type of dialog box by browsing the table 'elements' and look if the object has children
	$.each(elements, function(index, value) {
		var tmpElement = $('#'+value);	
		if (tmpElement.children().length > 0) {
			element = tmpElement;
			elementName = value;
		}
	});

	if(element!=null && element.parent().prop("tagName").toLowerCase()!='body') {
		if(keepScrollPosition) elementPreviousTop = ((element.find('#scrollElement').length == 1) ? element.find('#scrollElement').scrollTop() : element.scrollTop());
		var typeOfDialog = ((element.find('div.T').length == 0) ? "neighbour" : "children");
		if(typeOfDialog == 'neighbour'){
			var oldHeight = element.css("height");
			element.css("height","");
			if(element.next().hasClass('scrollGradient'))
				element.next().css("display", "none");
		} else {
			$('#scrollElement').css("height","")
			.next().css("display", "none");
		}
		addScrollWithShadow(elementName, elementPreviousTop);
		
		if(isWorkzoneViewDocked()){
			element.css("height",oldHeight);
		}
	}
}

function manageWorkzoneViewDocked(action, cardSize){
	if (arguments.length<1) action = 'show';
	if (arguments.length<2) cardSize = 1000;
	
	var elementDialog = $('#elementDialog'),
		moduleView = $('#moduleView'),
		collapseBar = $('#dockingContainer>.collapse'),
		scrollElement = $('#scrollElement'),
		dataBlog = $('.dataBlog'),
        selectedElement = $('.el.S');

	if(scrollElement.length==0) {
		elementDialog.append('<div id="scrollElement"></div>');
		scrollElement = $('#scrollElement').append(elementDialog.find('form'));
	}
	scrollElement.width(cardSize);
	
	switch (action){
		case 'show':		
			cardSize+=20; //padding 10px
			elementDialog.css({'display':'block','float':'left','width':cardSize+'px'});
			collapseBar.css('display','block');
			moduleView.css({'float':'left'});
			if ($('#moduleView:hidden').length) {
				collapseBar.find('span').html("&raquo;");
			} else {
				collapseBar.find('span').html("&laquo;");
			}
			$('.firstBox, .toolbarBox','#searchBar').css('display','none');
            $('#elementDialog > .T').css('background-color', '#f1f3f7');
            $('#elementDialog > .T').css('margin-top', '-40px');
            $('#elementDialog > .T').css('width', '100%');
            $('#elementDialog > .T').css('z-index', '1000');
            $('#elementDialog > .T').attr('id', 'searchBar');
            $('#elementDialog').css('padding-top', '50px');

            if($('#validateButton').length != 0){
                var validate = $('#validateButton').html();
                $('#elementDialog').prepend('<div id="validTop">'+validate+'</div>');
                $('#elementDialog #validTop').css('height', '60px');
                $('#elementDialog #validTop').css('margin-top', '-60px');
                $('#elementDialog #validTop').css('width', '100%');
                $('#elementDialog #validTop').css('background-color', '#fff');
                $('#elementDialog #validTop').css('border-bottom', '2px solid #bbb');
                $('#elementDialog #validTop').css('z-index', '1000');

                $('#validTop .ok').click(function(e){
                	$('#scrollElement form').submit();
                });
                $('#validTop .cancel').click(function(){
                	$('form .cancel').click();
				});
			}

			elementDialog.scrollTop(0);
			break;
		case 'clear':
			elementDialog.html('');
		case 'hide':			
			elementDialog.css('display','none').css('float','none');
			$('#dockingContainer>.collapse').css('display','none');
			$('#moduleView').css({'float':'none'});
			$('.firstBox, .toolbarBox','#searchBar').css('display','block');
			$('#searchBar .middleBox').css('display','none');
			// CWE 14.12.2017 unhighlights folders containing element in the group panel
			if($('#groupPanel').length){ $('#groupPanel li>div.highlight').removeClass('highlight'); }
			break;
	};
	
	resize_elementList();

    //Adapt the scroll to show selected element
    if(selectedElement.length > 0){
        dataBlog.scrollTop(0);
        var marginTop = selectedElement.position().top;
        var navigationBar = $('#NMContainerBsp').height();
        var toolbar = $('.toolBar').height();
        dataBlog.scrollTop(marginTop-navigationBar-toolbar-10);
    }

}

//Re-initializes middle box
function initMiddleBox(keepExistingBox){
	if (arguments.length<1) keepExistingBox = false;
	
	var middleBox = $('#searchBar .middleBox');
	var firstBox = $('#searchBar .firstBox');

	if(!keepExistingBox && middleBox.length > 0) {
		middleBox.remove();
	};
	
	middleBox = $('#searchBar .middleBox');
	
	if(middleBox.length == 0) {
		firstBox.after('<div class="middleBox"></div>');
		middleBox = $('#searchBar .middleBox');
	}
	
	if(middleBox.find('div.T').length==0) middleBox.append('<div class=\"T docked\"></div>');
	
	var height = $('#searchBar .firstBox').height();
	return $('#searchBar .middleBox').css('height', 'auto');
}/**
 *  This file is part of Wigii.
 *  Wigii is developed to inspire humanity. To Humankind we offer Gracefulness, Righteousness and Goodness.
 *  
 *  Wigii is free software: you can redistribute it and/or modify it 
 *  under the terms of the GNU General Public License as published by
 *  the Free Software Foundation, either version 3 of the License, 
 *  or (at your option) any later version.
 *  
 *  Wigii is distributed in the hope that it will be useful, but WITHOUT ANY WARRANTY; 
 *  without even the implied warranty of MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  
 *  See the GNU General Public License for more details.
 *
 *  A copy of the GNU General Public License is available in the Readme folder of the source code.  
 *  If not, see <http://www.gnu.org/licenses/>.
 *
 *  @copyright  Copyright (c) 2016  Wigii.org
 *  @author     <http://www.wigii.org/system>      Wigii.org 
 *  @link       <http://www.wigii-system.net>      <https://github.com/wigii/wigii>   Source Code
 *  @license    <http://www.gnu.org/licenses/>     GNU General Public License
 */

//User filter
userFilterDefaultValue = null;
user2FilterDefaultValue = null;
groupFilterDefaultValue = null;


userFilterLastValue = null;
function adminFilterUser_input_focus(){
	v = $('#adminFilterUser input');
	if(v.hasClass('empty')){
		v.removeClass('empty').removeClass('grayFont').val('');
	} else {
		v.select();
	}
	userFilterLastValue = v.val();
}
adminFilterTextOnBlurTimeout = null;
function adminFilterUser_input_blur(){
	v = $('#adminFilterUser input');
	changed = userFilterLastValue != v.val();
	if(v.val()==''){
		v.addClass('empty').addClass('grayFont').val(userFilterDefaultValue);
	}
	if(changed) {
		//reset the paging
		$('#adminFilterUser .select:eq(1) :input').val("1");
		adminFilterTextOnBlurTimeout = setTimeout(function(){$('#adminFilterUser div.goButton').click(); }, 100);
	}
}

function adminFilterUser_select_change(e){
	s = $('#adminFilterUser select[name=__userFilterType]');
	p = $('#adminFilterUser select[name=__horizontalPagingText]');
	if(s.val()!='none'){
		s.removeClass('empty').removeClass('grayFont');
	} else {
		s.addClass('empty').addClass('grayFont');
	}
	if(e.target.name =="__userFilterType"){
		p.val("1");
	}
	$('#adminFilterUser div.goButton').click();
}

function adminFilterUser_goButton_click(crtWigiiNamespace, crtModule){
	clearTimeout(adminFilterTextOnBlurTimeout);

	setVis("busyDiv", true);

	url = SITE_ROOT +'Update/'+crtContextId+EXEC_requestSeparator+ 'NoAnswer/'+crtWigiiNamespace+'/'+crtModule+'/setFilterUser/';

	inputTextFilter = $('#adminFilterUser input');
	if(inputTextFilter.hasClass('empty')){
		tempText = inputTextFilter.val();
		inputTextFilter.val('');
	}

	var myAjax = new jQuery.ajax({
			url: encodeURI(url),
			data: $('#adminFilterUser :input').serialize(),
			type: 'POST',
			success : parseUpdateResult,
			cache:false,
			error: errorOnUpdate
		});
	onUpdateErrorCounter = 0;

	if(inputTextFilter.hasClass('empty')){
		inputTextFilter.val(tempText);
	}
}

function adminFilterUser_reset(crtWigiiNamespace, crtModule){
	t = $('#adminFilterUser input');
	s = $('#adminFilterUser select[name=__userFilterType]');
	p = $('#adminFilterUser select[name=__horizontalPagingText]');
	t.val(userFilterDefaultValue).addClass('empty').addClass('grayFont');
	s.val('none').addClass('empty').addClass('grayFont');
	p.val(1);
	adminFilterTextOnBlurTimeout = setTimeout(function(){ $('#adminFilterUser div.goButton').click(); }, 100);
}

function adminFilterUserType_disable(isDisabled){
	if(isDisabled){
		$('#adminFilterUser :input[name="__userFilterType"]').attr('disabled', true).addClass('disabled').css('background-color', '#e6e6e6');
	} else {
		$('#adminFilterUser :input[name="__userFilterType"]').attr('disabled', false).removeClass('disabled').css('background-color', '#fff');
	}
}
function adminFilterUserText_disable(isDisabled){
	if(isDisabled){
		$('#adminFilterUser :input[name="__userFilterText"]').attr('disabled', true).addClass('disabled').css('background-color', '#e6e6e6');
	} else {
		$('#adminFilterUser :input[name="__userFilterText"]').attr('disabled', false).removeClass('disabled').css('background-color', '#fff');
	}
}
function adminUserPaging_enable(isEnabled){
	p = $('#adminFilterUser select[name=__horizontalPagingText]');
	if(isEnabled){
		p.attr('disabled', false).removeClass('disabled').css('background-color', '#fff').show();
	} else {
		p.val('1').attr('disabled', true).addClass('disabled').css('background-color', '#e6e6e6').hide();
	}
}
function adminFilterUser_hide(isHidden){
	if(isHidden){
		$('#adminFilterUser').hide();
	} else {
		$('#adminFilterUser').show();
	}
}

function adminUserPaging_matchFor(crt, total, prefix){
	select = $('#adminFilterUser select[name=__horizontalPagingText]');
	select.find('option').remove();
	for(var i = 1; i<total+1; i++){
		if(crt == i){
			select.append('<option class="blackFont" value="'+i+'" title="'+prefix+' '+i+'" selected="selected" >'+prefix+' '+i+'</option>');
		} else {
			select.append('<option class="blackFont" value="'+i+'" title="'+prefix+' '+i+'" >'+prefix+' '+i+'</option>');
		}
	}
	if(total > 1){
		select.removeClass("grayFont").addClass("blackFont");
	} else {
		select.addClass("grayFont").removeClass("blackFont");
	}
}

//User2 filter
user2FilterLastValue = null;
function adminFilterUser2_input_focus(){
	v = $('#adminFilterUser2 input');
	if(v.hasClass('empty')){
		v.removeClass('empty').removeClass('grayFont').val('');
	} else {
		v.select();
	}
	user2FilterLastValue = v.val();
}
adminFilterTextOnBlurTimeout = null;
function adminFilterUser2_input_blur(){
	v = $('#adminFilterUser2 input');
	changed = user2FilterLastValue != v.val();
	if(v.val()==''){
		v.addClass('empty').addClass('grayFont').val(user2FilterDefaultValue);
	}
	if(changed) {
		//reset the paging
		$('#adminFilterUser2 .select:eq(1) :input').val("1");
		adminFilterTextOnBlurTimeout = setTimeout(function(){$('#adminFilterUser2 div.goButton').click(); }, 100);
	}
}

function adminFilterUser2_select_change(e){
	s = $('#adminFilterUser2 select[name=__user2FilterType]');
	p = $('#adminFilterUser2 select[name=__horizontalPagingText]');
	if(s.val()!='none'){
		s.removeClass('empty').removeClass('grayFont');
	} else {
		s.addClass('empty').addClass('grayFont');
	}
	if(e.target.name =="__user2FilterType"){
		p.val("1");
	}
	$('#adminFilterUser2 div.goButton').click();
}

function adminFilterUser2_goButton_click(crtWigiiNamespace, crtModule){
	clearTimeout(adminFilterTextOnBlurTimeout);

	setVis("busyDiv", true);

	url = SITE_ROOT +'Update/'+crtContextId+EXEC_requestSeparator+ 'NoAnswer/'+crtWigiiNamespace+'/'+crtModule+'/setFilterUser2/';

	inputTextFilter = $('#adminFilterUser2 input');
	if(inputTextFilter.hasClass('empty')){
		tempText = inputTextFilter.val();
		inputTextFilter.val('');
	}

	var myAjax = new jQuery.ajax({
			url: encodeURI(url),
			data: $('#adminFilterUser2 :input').serialize(),
			type: 'POST',
			success : parseUpdateResult,
			cache:false,
			error: errorOnUpdate
		});
	onUpdateErrorCounter = 0;

	if(inputTextFilter.hasClass('empty')){
		inputTextFilter.val(tempText);
	}
}

function adminFilterUser2_reset(crtWigiiNamespace, crtModule){
	t = $('#adminFilterUser2 input');
	s = $('#adminFilterUser2 select[name=__user2FilterType]');
	p = $('#adminFilterUser2 select[name=__horizontalPagingText]');
	t.val(user2FilterDefaultValue).addClass('empty').addClass('grayFont');
	s.val('none').addClass('empty').addClass('grayFont');
	p.val(1);
	adminFilterTextOnBlurTimeout = setTimeout(function(){ $('#adminFilterUser2 div.goButton').click(); }, 100);
}

function adminFilterUser2Type_disable(isDisabled){
	if(isDisabled){
		$('#adminFilterUser2 :input[name="__user2FilterType"]').attr('disabled', true).addClass('disabled').css('background-color', '#e6e6e6');
	} else {
		$('#adminFilterUser2 :input[name="__user2FilterType"]').attr('disabled', false).removeClass('disabled').css('background-color', '#fff');
	}
}
function adminFilterUser2Text_disable(isDisabled){
	if(isDisabled){
		$('#adminFilterUser2 :input[name="__user2FilterText"]').attr('disabled', true).addClass('disabled').css('background-color', '#e6e6e6');
	} else {
		$('#adminFilterUser2 :input[name="__user2FilterText"]').attr('disabled', false).removeClass('disabled').css('background-color', '#fff');
	}
}
function adminUser2Paging_enable(isEnabled){
	p = $('#adminFilterUser2 select[name=__horizontalPagingText]');
	if(isEnabled){
		p.attr('disabled', false).removeClass('disabled').css('background-color', '#fff').show();
	} else {
		p.val('1').attr('disabled', true).addClass('disabled').css('background-color', '#e6e6e6').hide();
	}
}
function adminFilterUser2_hide(isHidden){
	if(isHidden){
		$('#adminFilterUser2').hide();
	} else {
		$('#adminFilterUser2').show();
	}
}

function adminUser2Paging_matchFor(crt, total, prefix){
	select = $('#adminFilterUser2 select[name=__horizontalPagingText]');
	select.find('option').remove();
	for(var i = 1; i<total+1; i++){
		if(crt == i){
			select.append('<option class="blackFont" value="'+i+'" title="'+prefix+' '+i+'" selected="selected" >'+prefix+' '+i+'</option>');
		} else {
			select.append('<option class="blackFont" value="'+i+'" title="'+prefix+' '+i+'" >'+prefix+' '+i+'</option>');
		}
	}
	if(total > 1){
		select.removeClass("grayFont").addClass("blackFont");
	} else {
		select.addClass("grayFont").removeClass("blackFont");
	}
}

//GROUPS
groupFilterLastValue = null;
function adminFilterGroup_input_focus(){
	v = $('#adminFilterGroup input');
	if(v.hasClass('empty')){
		v.removeClass('empty').removeClass('grayFont').val('');
	} else {
		v.select();
	}
	groupFilterLastValue = v.val();
}
adminFilterTextOnBlurTimeout = null;
function adminFilterGroup_input_blur(){
	v = $('#adminFilterGroup input');
	changed = groupFilterLastValue != v.val();
	if(v.val()==''){
		v.addClass('empty').addClass('grayFont').val(groupFilterDefaultValue);
	}
	if(changed){
		//reset the paging
//		$('#adminFilterGroup .select:eq(1) :input').val("1");
		adminFilterTextOnBlurTimeout = setTimeout(function(){$('#adminFilterGroup div.goButton').click(); }, 100);
	}
}

//function adminFilterGroup_select_change(e){
//	p = $('#adminFilterGroup select[name=__horizontalPagingText]');
//	if(e.target.name =="__userFilterType"){
//		p.val("1");
//	}
//	$('#adminFilterGroup div.goButton').click();
//}

function adminFilterGroup_goButton_click(crtWigiiNamespace, crtModule){
	clearTimeout(adminFilterTextOnBlurTimeout);

	setVis("busyDiv", true);

	url = SITE_ROOT +'Update/'+crtContextId+EXEC_requestSeparator+ 'NoAnswer/'+crtWigiiNamespace+'/'+crtModule+'/setFilterGroup/';

	inputTextFilter = $('#adminFilterGroup input');
	if(inputTextFilter.hasClass('empty')){
		tempText = inputTextFilter.val();
		inputTextFilter.val('');
	}

	var myAjax = new jQuery.ajax({
			url: encodeURI(url),
			data: $('#adminFilterGroup :input').serialize(),
			type: 'POST',
			success : parseUpdateResult,
			cache:false,
			error: errorOnUpdate
		});
	onUpdateErrorCounter = 0;

	if(inputTextFilter.hasClass('empty')){
		inputTextFilter.val(tempText);
	}
}

function adminFilterGroup_reset(crtWigiiNamespace, crtModule){
	t = $('#adminFilterGroup input');
//	p = $('#adminFilterGroup select[name=__horizontalPagingText]');
	t.val(groupFilterDefaultValue).addClass('empty').addClass('grayFont');
//	p.val(1);
	adminFilterTextOnBlurTimeout = setTimeout(function(){ $('#adminFilterGroup div.goButton').click(); }, 100);
}

function adminFilterGroupText_disable(isDisabled){
	if(isDisabled){
		$('#adminFilterGroup :input[name="__groupFilterText"]').attr('disabled', true).addClass('disabled').css('background-color', '#e6e6e6');
	} else {
		$('#adminFilterGroup :input[name="__groupFilterText"]').attr('disabled', false).removeClass('disabled').css('background-color', '#fff');
	}
}
//function adminGroupPaging_enable(isEnabled){
//	p = $('#adminFilterGroup select[name=__horizontalPagingText]');
//	if(isEnabled){
//		p.attr('disabled', false).removeClass('disabled').css('background-color', '#fff');
//	} else {
//		p.val('1').attr('disabled', true).addClass('disabled').css('background-color', '#e6e6e6');
//	}
//}
function adminFilterGroup_hide(isHidden){
	if(isHidden){
		$('#adminFilterGroup').hide();
	} else {
		$('#adminFilterGroup').show();
	}
}

//function adminGroupPaging_matchFor(crt, total, prefix){
//	select = $('#adminFilterGroup select[name=__horizontalPagingText]');
//	select.find('option').remove();
//	for(var i = 1; i<total+1; i++){
//		if(crt == i){
//			select.append('<option class="blackFont" value="'+i+'" title="'+prefix+' '+i+'" selected="selected" >'+prefix+' '+i+'</option>');
//		} else {
//			select.append('<option class="blackFont" value="'+i+'" title="'+prefix+' '+i+'" >'+prefix+' '+i+'</option>');
//		}
//	}
//	if(total > 1){
//		select.removeClass("grayFont").addClass("blackFont");
//	} else {
//		select.addClass("grayFont").removeClass("blackFont");
//	}
//}

function adminButton_click(doAction, crtWigiiNamespace, crtModule, idButton, groupFilterLabel, userFilterLabel, roleFilterLabel, okLabel, cancelLabel, displayAllLabel, guGroupFilterLabel, guGroupFilterExplanation, guUserFilterLabel, guUserFilterExplanation, guScreenshot, urUserFilterLabel, urUserFilterExplanation, urRoleFilterLabel, urRoleFilterExplanation, urScreenshot, uuUserFilterLabel, uuUserFilterExplanation, uuUser2FilterLabel, uuUser2FilterExplanation, uuScreenshot, dialogTitle, title, message, workingModule){
	//define empty filter value
	if (typeof workingModule === 'undefined') { workingModule = null; }
	var idButtonPlus = idButton;
	if(idButton.indexOf('_')) {
		temp = idButton.split('_');
		idButton = temp[0];
	}
	if(idButton =="adminGroup"){
		userFilterDefaultValue = null;
		user2FilterDefaultValue = null;
		groupFilterDefaultValue = groupFilterLabel;
	} else if(idButton == "adminUser"){
		userFilterDefaultValue = userFilterLabel;
		user2FilterDefaultValue = null;
		groupFilterDefaultValue = null;
	} else if(idButton == "adminRole"){
		userFilterDefaultValue = roleFilterLabel;
		user2FilterDefaultValue = null;
		groupFilterDefaultValue = null;
	} else if(idButton == "adminGroupUser"){
		userFilterDefaultValue = guUserFilterLabel;
		user2FilterDefaultValue = null;
		groupFilterDefaultValue = guGroupFilterLabel;
	} else if(idButton == "adminUserRole"){
		userFilterDefaultValue = urUserFilterLabel;
		user2FilterDefaultValue = urRoleFilterLabel;
		groupFilterDefaultValue = null;
	} else if(idButton == "adminUserUser"){
		userFilterDefaultValue = uuUserFilterLabel;
		user2FilterDefaultValue = uuUser2FilterLabel;
		groupFilterDefaultValue = null;
	} else if(idButton == "adminUserAdmin"){
		userFilterDefaultValue = userFilterLabel;
		user2FilterDefaultValue = null;
		groupFilterDefaultValue = null;
	}
	
	var parentMenu = $('#'+idButtonPlus).parent().parent();
	if(doAction && parentMenu.prop('id')=='adminGroupMenu') {
		tmpText = $('#adminGroup').children().first().children().first().contents()[0].data.split('(');
		$('#adminGroup').children().first().children().first().contents()[0].data = tmpText[0]+' ('+$('#'+idButtonPlus).text().trim()+') ';
	}
	
	if(!(doAction && (idButton =="adminGroupUser" || idButton =="adminUserRole" || idButton =="adminUserUser"))){
		i1 = $('#adminFilterGroup input:first');
		i2 = $('#adminFilterUser input:first');
		i3 = $('#adminFilterUser2 input:first');
		if(i1.hasClass('empty')) i1.val(groupFilterDefaultValue);
		if(i2.hasClass('empty')) i2.val(userFilterDefaultValue);
		if(i3.hasClass('empty')) i3.val(user2FilterDefaultValue);
	}
	//if group/role/user matrix, display filters as dialog before.
	if(doAction && (idButton =="adminGroupUser" || idButton =="adminUserRole" || idButton =="adminUserUser")){
		$('#elementDialog').html('');
		$('#elementDialog')
		.append('<div class="introduction" style="width:400px;margin-bottom:10px; margin-top:8px;"><img src="'+SITE_ROOT+'images/icones/26px/magnifier.png" /><div style="margin-left:5px;padding-top:7px;font-size:14px;font-weight:bold;">'+title+'</div><div class="clear"></div><div style="margin-top:5px;">'+message+'</div></div>')
		.append('<div class="clear"></div><hr class="SBB" style="margin:20px;" />');
		$('#elementDialog')
		.append('<div class="filters"></div>')
		;
		//prepare dialog content
		if(idButton =="adminGroupUser"){
			$('#elementDialog div.filters')
			.append('<div class="label">'+guGroupFilterLabel+'</div>').append($('#adminFilterGroup input').clone()).append('<div class="clear"></div>')
//			.append('<div class="explanation">'+guGroupFilterExplanation+'</div><div class="clear"></div>')
			.append('<div class="label">'+guUserFilterLabel+'</div>').append($('#adminFilterUser input').clone()).append('<div class="clear"></div>')
			.append('<div class="label"></div>').append($('#adminFilterUser select:first').clone()).append('<div class="clear"></div>')
//			.append('<div class="explanation">'+guUserFilterExplanation+'</div><div class="clear"></div>')
			;
			$('#elementDialog div.filters input:first').blur(function(){ if($(this).val()=='' || $(this).hasClass('empty')){ $(this).addClass('empty').addClass('grayFont').val(guGroupFilterExplanation); }}).focus(function(){ if($(this).hasClass('empty')){ $(this).val('').removeClass('empty').removeClass('grayFont'); }});
			$('#elementDialog div.filters input:last').blur(function(){ if($(this).val()=='' || $(this).hasClass('empty')){ $(this).addClass('empty').addClass('grayFont').val(guUserFilterExplanation); }}).focus(function(){ if($(this).hasClass('empty')){ $(this).val('').removeClass('empty').removeClass('grayFont'); }});
			$('#elementDialog div.introduction').before('<div class="screenshot"><img src="'+SITE_ROOT+guScreenshot+'" /></div>');
			$('#elementDialog div.filters select').removeAttr('disabled').removeClass('disabled').removeClass('grayFont').css('background-color', 'transparent');
		} else if (idButton =="adminUserRole"){
			$('#elementDialog div.filters')
			.append('<div class="label">'+urUserFilterLabel+'</div>').append($('#adminFilterUser input').clone()).append('<div class="clear"></div>')
			.append('<div class="label"></div>').append($('#adminFilterUser select:first').clone()).append('<div class="clear"></div>')
//			.append('<div class="explanation">'+urUserFilterExplanation+'</div><div class="clear"></div>')
			.append('<div class="label">'+urRoleFilterLabel+'</div>').append($('#adminFilterUser2 input').clone()).append('<div class="clear"></div>')
			.append('<div class="label"></div>').append($('#adminFilterUser2 select:first').clone()).append('<div class="clear"></div>')
//			.append('<div class="explanation">'+urRoleFilterExplanation+'</div><div class="clear"></div>')
			;
			$('#elementDialog div.filters input:first').blur(function(){ if($(this).val()=='' || $(this).hasClass('empty')){ $(this).addClass('empty').addClass('grayFont').val(urUserFilterExplanation); }}).focus(function(){ if($(this).hasClass('empty')){ $(this).val('').removeClass('empty').removeClass('grayFont'); }});
			$('#elementDialog div.filters input:last').blur(function(){ if($(this).val()=='' || $(this).hasClass('empty')){ $(this).addClass('empty').addClass('grayFont').val(urRoleFilterExplanation); }}).focus(function(){ if($(this).hasClass('empty')){ $(this).val('').removeClass('empty').removeClass('grayFont'); }});
			$('#elementDialog div.introduction').before('<div class="screenshot"><img src="'+SITE_ROOT+urScreenshot+'" /></div>');
			$('#elementDialog div.filters select').hide();
		} else if (idButton =="adminUserUser"){
			$('#elementDialog div.filters')
			.append('<div class="label">'+uuUserFilterLabel+'</div>').append($('#adminFilterUser input').clone()).append('<div class="clear"></div>')
			.append('<div class="label"></div>').append($('#adminFilterUser select:first').clone()).append('<div class="clear"></div>')
//			.append('<div class="explanation">'+uuUserFilterExplanation+'</div><div class="clear"></div>')
			.append('<div class="label">'+uuUser2FilterLabel+'</div>').append($('#adminFilterUser2 input').clone()).append('<div class="clear"></div>')
			.append('<div class="label"></div>').append($('#adminFilterUser2 select:first').clone()).append('<div class="clear"></div>')
//			.append('<div class="explanation">'+uuUser2FilterExplanation+'</div><div class="clear"></div>')
			;
			$('#elementDialog div.filters input:first').blur(function(){ if($(this).val()=='' || $(this).hasClass('empty')){ $(this).addClass('empty').addClass('grayFont').val(uuUserFilterExplanation); }}).focus(function(){ if($(this).hasClass('empty')){ $(this).val('').removeClass('empty').removeClass('grayFont'); }});
			$('#elementDialog div.filters input:last').blur(function(){ if($(this).val()=='' || $(this).hasClass('empty')){ $(this).addClass('empty').addClass('grayFont').val(uuUser2FilterExplanation); }}).focus(function(){ if($(this).hasClass('empty')){ $(this).val('').removeClass('empty').removeClass('grayFont'); }});
			$('#elementDialog div.introduction').before('<div class="screenshot"><img src="'+SITE_ROOT+uuScreenshot+'" /></div>');
			$('#elementDialog div.filters select').removeAttr('disabled').removeClass('disabled').removeClass('grayFont').css('background-color', 'transparent');
		}
		//$('#elementDialog .empty').val('').removeClass('empty').removeClass('grayFont');
		$('#elementDialog div:not(.clear, .filters), #elementDialog img').css('float', 'left');
		$('#elementDialog div.label').css('white-space', 'nowrap').css("margin", "5px 5px 2px 5px");
		$('#elementDialog div.screenshot').css("margin", "5px 15px 0px 5px");
		$('#elementDialog input').css('float', 'left').width(280).css("padding", "1px").css("margin", "5px 5px 2px 5px");
		$('#elementDialog select').css('float', 'left').width(160).css("margin", "5px 5px 2px 5px");
		$('#elementDialog :input').keydown(function(e){
			if(e.keyCode == 13){ $('#elementDialog').closest('.ui-dialog').children('.ui-dialog-buttonpane').find('button.ok').click(); }
			else if (e.keyCode == 27){ $('#elementDialog').closest('.ui-dialog').children('.ui-dialog-buttonpane').find('button.cancel').click(); }
			e.stopPropagation();
		});
		var buttons = {};
		buttons[okLabel] =
			{
			click: function(){
				setVis("busyDiv", true);

				url = SITE_ROOT +'Update/'+crtContextId+EXEC_requestSeparator+ 'NoAnswer/'+crtWigiiNamespace+'/'+crtModule+'/setFilterFor'+idButton.replace('admin', '');
				if(workingModule!=null) {
					url+= '/' + workingModule;
				}
				$('#elementDialog input.empty').val('');

				var myAjax = new jQuery.ajax({
						url: encodeURI(url),
						data: $('#elementDialog :input').serialize(),
						type: 'POST',
						success : parseUpdateResult,
						cache:false,
						error: errorOnUpdate
					});
				onUpdateErrorCounter = 0;

				$('#elementDialog').html('').dialog("destroy");
			},
			"class": 'ok',
			text : okLabel
			};
		buttons[displayAllLabel] =
			{
			click: function(e){
				$('#elementDialog input').val('');
				$('#elementDialog select').val('');
				$(e.target).prev().click();
			},
			"class": 'reset',
			text : displayAllLabel
			};
		buttons[cancelLabel] =
			{
			click: function(e){ $(this).dialog("destroy"); },
			"class": 'cancel',
			text : cancelLabel
			};

		if($('#elementDialog').is(':ui-dialog')){ $('#elementDialog').dialog("destroy"); } $('#elementDialog').dialog({
			title: dialogTitle+$('#'+idButton).text(),
			width:560,
			position: { my: "center", at: "center" },
			buttons: buttons,
			modal:true,
			dragStop: function(event, ui){ },
			beforeClose: function(){ actOnCloseDialog("elementDialog"); $(this).dialog("destroy"); },
			closeOnEscape: false, resizable:false
		});
		$('#elementDialog').next().find('button.ok').focus();
		$('#elementDialog input').each(function(){ $(this).blur();});
		tempMax = 117;
		$('#elementDialog div.label').each(function(){ tempMax = Math.max(tempMax, $(this).width());});
		$('#elementDialog div.label').width(tempMax);
		$('#elementDialog input').width(550-50-tempMax);
		return;
	}

	//subButton get the submenu action name
	var subButton = '';
	var button = $('#'+idButton);
	var parentButton = button.parent().parent();
	$('#adminSearchBar').find('.S').removeClass('S');
	switch(parentButton.attr('id')) {
		case 'adminAccessMenu': 
			$('#adminAccess').addClass('S');
			subButton = workingModule;
			break;
		case 'adminGroupMenu':
			$('#adminGroup').addClass('S');
			subButton = idButton;
			idButton = 'adminGroup';
			break;
	} 
	button.addClass('S');

	adminFilterUser_hide(idButton=="adminGroup" || idButton=="adminModuleEditor" );
	adminFilterUser2_hide(idButton=="adminGroup" || idButton=="adminModuleEditor" || idButton=="adminUser" || idButton=="adminRole" || idButton=="adminGroupUser" || idButton=="adminUserAdmin" );
	adminFilterGroup_hide(idButton=="adminUser" || idButton=="adminRole" || idButton=="adminModuleEditor" || idButton=="adminUserRole" || idButton=="adminUserUser" || idButton=="adminUserAdmin");

	adminFilterUserType_disable(idButton=="adminUser" || idButton=="adminRole");
	adminFilterUser2Type_disable(idButton=="adminUserRole");

	adminUserPaging_enable(idButton=="adminGroupUser");
	adminUser2Paging_enable(idButton=="adminUserRole" || idButton=="adminUserUser");
//	adminGroupPaging_enable(idButton=="adminGroupUser");

	$('#adminFilterUser select[name=__horizontalPagingText]').val("1");
	$('#adminFilterUser2 select[name=__horizontalPagingText]').val("1");
//	$('#adminFilterGroup select[name=__horizontalPagingText]').val("1");

	if(doAction && subButton=='') {
		update('NoAnswer/'+crtWigiiNamespace+'/'+crtModule+'/switchAdminTo/'+idButton);
	} else if(doAction && subButton!='') {
		update('NoAnswer/'+crtWigiiNamespace+'/'+crtModule+'/switchAdminTo/'+idButton+'/'+subButton);
	}
}

//*************************************
//Matrix
//*************************************

function matrixResize(id){
	m = $('#'+id);
	if(m.length == 0) return;

	totalW = m.width();
	totalH = $(window).height()-m.offset().top-$('#footerBar').outerHeight()-2;

	//alert(totalW+" "+totalH);

	corn = $('.MatrixCorner', m);
	mR = $('.MatrixRowHeaders', m);
	mC = $('.MatrixColHeaders', m);
	mI = $('.MatrixItems', m);
	sL = $('.ScrollLeftZone', m);
	sR = $('.ScrollRightZone', m);
	sU = $('.ScrollUpZone', m);
	sD = $('.ScrollDownZone', m);

	//the rowHeaders should not be more than the half of the screen
	mR.css('max-width', m.width()*0.5);

	//resize the corner
		corn.width(mR.width()+5);
		corn.height(mC.height()+5);

	//resize the colHeaders container
	mC.width(totalW-corn.outerWidth()-10);

	//resize the rowHeaders container
	//use only the standard scrolling in Admin (reason commented)
	//mR.height(totalH-corn.outerHeight()-5);
	//mR.height(mR.height()+30);
	mR.css('margin-bottom', '30px');

	//resize the matrixItem
		mI.width(mC.width()-1);
		mI.height(mR.height());

	//place the scrollZones
		sR.height(mC.height()+mI.height()+5);
	sR.css('top', mC.offset().top+5);
	sR.css('left', mC.offset().left+mC.outerWidth()-sR.outerWidth()-5);
		sL.height(mC.height()+mI.height()+5);
	sL.css('top', sR.css('top'));
	sL.css('left', mC.offset().left+5);

		sU.width(mR.width()+mI.width()+5);
	sU.css('top', mR.offset().top);
	sU.css('left', 5);
		sD.width(mR.width()+mI.width()+5);

	sD.css('top', mR.offset().top+mR.outerHeight() - sD.outerHeight()-5);
	sD.css('left', sU.css('left'));

	//hide display the scrollZones
	showScrollZones(id)

	//alert(mC.children('table').width());

}


function scrollLeft(id){
	$('#'+id+' .MatrixColHeaders table, #'+id+' .MatrixItems table').animate( { marginLeft: 0}, -parseInt($('#'+id+' .MatrixColHeaders table').css('marginLeft').replace('px', ''))*5, "swing", function(){ stopScroll(id); });
}
function goLeftScroll(id){
	$('#'+id+' .MatrixColHeaders table, #'+id+' .MatrixItems table').stop().css('marginLeft',0);
	showScrollZones(id);
}
function scrollRight(id){
	max = $('#'+id+' .MatrixColHeaders table').width()-$('#'+id+' .MatrixColHeaders').width()+100;
	$('#'+id+' .MatrixColHeaders table, #'+id+' .MatrixItems table').animate( { marginLeft: -max}, max*5, "swing", function(){ stopScroll(id); });
}
function goRightScroll(id){
	$('#'+id+' .MatrixColHeaders table, #'+id+' .MatrixItems table').stop();
	max = $('#'+id+' .MatrixColHeaders table').width()-$('#'+id+' .MatrixColHeaders').width()+100;
	$('#'+id+' .MatrixColHeaders table, #'+id+' .MatrixItems table').css('marginLeft', -max);
	showScrollZones(id);
}
function scrollUp(id){
	$('#'+id+' .MatrixRowHeaders div:first, #'+id+' .MatrixItems table').animate( { marginTop: 0}, -parseInt($('#'+id+' .MatrixRowHeaders div:first').css('marginTop').replace('px', ''))*10, "swing", function(){ stopScroll(id); });
}
function goUpScroll(id){
	$('#'+id+' .MatrixRowHeaders div:first, #'+id+' .MatrixItems table').stop();
	$('#'+id+' .MatrixRowHeaders div:first, #'+id+' .MatrixItems table').css('marginTop', 0);
	showScrollZones(id);
}
function scrollDown(id){
	max = -$('#'+id+' .MatrixRowHeaders div:first').offset().top+$('#'+id+' .MatrixRowHeaders div:last').offset().top+$('#'+id+' .MatrixRowHeaders div:last').outerHeight()-$('#'+id+' .MatrixRowHeaders').height()+20;
	$('#'+id+' .MatrixRowHeaders div:first, #'+id+' .MatrixItems table').animate( { marginTop: -max}, max*10, "swing", function(){ stopScroll(id); });
}
function goDownScroll(id){
	$('#'+id+' .MatrixRowHeaders div:first, #'+id+' .MatrixItems table').stop();
	max = -$('#'+id+' .MatrixRowHeaders div:first').offset().top+$('#'+id+' .MatrixRowHeaders div:last').offset().top+$('#'+id+' .MatrixRowHeaders div:last').outerHeight()-$('#'+id+' .MatrixRowHeaders').height()+20;
	$('#'+id+' .MatrixRowHeaders div:first, #'+id+' .MatrixItems table').css('marginTop', -max);
	showScrollZones(id);
}
function stopScroll(id){
	$('#'+id+' .MatrixColHeaders table, #'+id+' .MatrixRowHeaders div:first, #'+id+' .MatrixItems table').stop();
	showScrollZones(id);
}

function showScrollZones(id){
	m = $('#'+id);
	if(m.length == 0) return;

	mR = $('.MatrixRowHeaders div:first', m);
	mC = $('.MatrixColHeaders table', m);
	mI = $('.MatrixItems table', m);
	sL = $('.ScrollLeftZone', m);
	sR = $('.ScrollRightZone', m);
	sU = $('.ScrollUpZone', m);
	sD = $('.ScrollDownZone', m);

	//hide display the scrollZones
	//use only the standard scrolling in Admin
	sU.hide();
//	if(mR.css('marginTop')=='0px'){
//		sU.hide();
//		mI.css('marginTop', 0);
//	} else sU.show();
	if(mC.css('marginLeft')=='0px') {
		sL.hide();
		mI.css('marginLeft', 0);
	} else sL.show();

	//use only the standard scrolling in Admin
	sD.hide();
//	if(-$('#'+id+' .MatrixRowHeaders').offset().top+$('#'+id+' .MatrixRowHeaders div:last').offset().top+$('#'+id+' .MatrixRowHeaders div:last').outerHeight()+10 > $('#'+id+' .MatrixRowHeaders').height()) sD.show();
//	else sD.hide();

	if($('#'+id+' .MatrixColHeaders').width() - $('#'+id+' .MatrixColHeaders table').width()-50 < parseInt(mC.css('marginLeft').replace('px',''))) sR.show();
	else sR.hide();

}

//higlights
function unHighlight(id){
	if(typeof(id) == 'string'){
		myObj = $('#'+id);
	} else myObj = $(this);

	if(!myObj.hasClass('Matrix')){
		myObj = myObj.parents('.Matrix');
	}
	myObj.find('.highlight, .active').removeClass('active').removeClass('highlight').removeClass('highlightV');
}
function highlightFromRowHeader(id){
	if(typeof(id) == 'string'){
		obj = $('#'+id);
	} else obj = $(this);
	unHighlight(id);
	idRow = obj.attr('id');
	idM = obj.parents('.Matrix').attr('id');
	$('#'+idRow+', #'+idM+' .'+idRow+' td>div').addClass('highlight');
}
function highlightFromColHeader(){
	idCol = $(this).attr('id');
	unHighlight(idCol);
	idM = $(this).parents('.Matrix').attr('id');
	$('#'+idCol+', #'+idM+' .'+idCol+'>div').addClass('highlight').addClass('highlightV');
	$('#'+idCol).parents('td').addClass('highlight').addClass('highlightV');
}
function highlightFromMatrixItem(){
	idCol = $(this).parent().attr('class');
	unHighlight(idCol); // unhiglight from the col, just to have an id
	idRow = $(this).parent().parent().attr('class');
	idM = $(this).parents('.Matrix').attr('id');
	$(this).addClass('active');
	$('#'+idRow+', #'+idM+' .'+idRow+' td>div').addClass('highlight');
	$('#'+idCol+', #'+idCol+', #'+idM+' .'+idCol+'>div').addClass('highlight').addClass('highlightV');
	$('#'+idCol).parents('td').addClass('highlight').addClass('highlightV');
}


//context menu
valueContextMenu_crtRow = null;
valueContextMenu_crtCol = null;
function showValueContextMenu(e, obj, idContextMenu){
	valueContextMenu_crtCol = $(obj).parent().attr('class');
	valueContextMenu_crtRow = $(obj).parent().parent().attr('class');

	if($('#'+valueContextMenu_crtCol+'').hasClass('noRights')){ // || !$('#'+valueContextMenu_crtRow+'').hasClass('RX')){
		return;
	}

	if($('#'+valueContextMenu_crtRow+'').hasClass('RR')){ // || !$('#'+valueContextMenu_crtRow+'').hasClass('RX')){
		$('#'+idContextMenu+' .ugr_').show();
		$('#'+idContextMenu+' .ugr_r').show();
		$('#'+idContextMenu+' .ugr_s').hide();
		$('#'+idContextMenu+' .ugr_w').hide();
		$('#'+idContextMenu+' .ugr_x').hide();
	}
	if($('#'+valueContextMenu_crtRow+'').hasClass('RS')){ // || !$('#'+valueContextMenu_crtRow+'').hasClass('RX')){
		$('#'+idContextMenu+' .ugr_').show();
		$('#'+idContextMenu+' .ugr_r').show();
		$('#'+idContextMenu+' .ugr_s').show();
		$('#'+idContextMenu+' .ugr_w').hide();
		$('#'+idContextMenu+' .ugr_x').hide();
	}
	if($('#'+valueContextMenu_crtRow+'').hasClass('RW')){ // || !$('#'+valueContextMenu_crtRow+'').hasClass('RX')){
		$('#'+idContextMenu+' .ugr_').show();
		$('#'+idContextMenu+' .ugr_r').show();
		$('#'+idContextMenu+' .ugr_s').show();
		$('#'+idContextMenu+' .ugr_w').show();
		$('#'+idContextMenu+' .ugr_x').hide();
	}
	if($('#'+valueContextMenu_crtRow+'').hasClass('RX')){ // || !$('#'+valueContextMenu_crtRow+'').hasClass('RX')){
		$('#'+idContextMenu+' .ugr_').show();
		$('#'+idContextMenu+' .ugr_r').show();
		$('#'+idContextMenu+' .ugr_s').show();
		$('#'+idContextMenu+' .ugr_w').show();
		$('#'+idContextMenu+' .ugr_x').show();
	}

	obj = $(obj);
	cm = $('#'+idContextMenu);
	positionElementOnMouse(cm, e, 'center', obj, -50);
	cm.show();


	obj.unbind('mouseleave');
}
function hideValueContextMenu(e, obj, idContextMenu){
	//unHighlight(idContextMenu);
	$('#'+idContextMenu).hide();
}

function clickOnRightInGroupUserMatrixValueContextMenu(contextButton, crtWigiiNamespace, crtModule, workingModule){
	contextButton = $(contextButton);

	right = 'none'; //no  rights
	if(contextButton.hasClass('ugr_r')) right = 'r';
	if(contextButton.hasClass('ugr_s')) right = 's';
	if(contextButton.hasClass('ugr_w')) right = 'w';
	if(contextButton.hasClass('ugr_x')) right = 'x';

	//check rights on doing action
	if($('#'+valueContextMenu_crtCol+'').hasClass('noRights')){ // || !$('#'+valueContextMenu_crtRow+'').hasClass('RX')){
		return;
	}

	//change content of the value:
	obj = $('tr.'+valueContextMenu_crtRow+' td.'+valueContextMenu_crtCol+'>div>div');
	tempRight = right;
	if(tempRight == "none") tempRight = "";
	obj.removeClass().addClass('ugr_'+tempRight);
	if(right=="none"){
		obj.text('');
	} else {
		obj.text(contextButton.text());
	}

	update('NoAnswer/'+crtWigiiNamespace+'/'+crtModule+'/GroupUserMatrix/setUgr/'+workingModule+'/'+right+'/'+valueContextMenu_crtRow+'/'+valueContextMenu_crtCol)

}

standardContextMenu_crtHeader = null;
function showStandardContextMenu(e, obj, idContextMenu){
	standardContextMenu_crtHeader = $(obj).attr('id')

	obj = $(obj);
	cm = $('#'+idContextMenu);
	positionElementOnMouse(cm, e, 'right', obj);
	cm.show();

	obj.unbind('mouseleave');
}
function hideStandardContextMenu(e, obj, idContextMenu){
	//unHighlight(idContextMenu);
	$('#'+idContextMenu).hide();
}
function clickOnAcitivityInGroupUserMatrixGroupContextMenu(contextButton, crtWigiiNamespace, crtModule, workingModule){
	contextButton = $(contextButton);

	activities = ["groupEdit", "groupDelete", "groupEmailNotification", "groupPortal", "groupHtmlContent", "groupXmlPublish", "groupSubscription"];
	for (i in activities){
		if(contextButton.hasClass(activities[i])){
			act = activities[i];
			break;
		}
	}

	update('NoAnswer/'+crtWigiiNamespace+'/'+crtModule+'/GroupUserMatrix/doGroupActivity/'+act+'/'+workingModule+'/'+standardContextMenu_crtHeader)

}
function clickOnAcitivityInGroupUserMatrixUserContextMenu(contextButton, crtWigiiNamespace, crtModule, workingModule){
	contextButton = $(contextButton);

	activities = ["userEdit", "userDelete"];
	for (i in activities){
		if(contextButton.hasClass(activities[i])){
			act = activities[i];
			break;
		}
	}

	update('NoAnswer/'+crtWigiiNamespace+'/'+crtModule+'/GroupUserMatrix/doUserActivity/'+act+'/'+workingModule+'/'+standardContextMenu_crtHeader)

}
function clickOnAcitivityInUserAdminMatrixUserContextMenu(contextButton, crtWigiiNamespace, crtModule, workingModule){
	contextButton = $(contextButton);

	activities = ["userEdit", "userDelete"];
	for (i in activities){
		if(contextButton.hasClass(activities[i])){
			act = activities[i];
			break;
		}
	}

	update('NoAnswer/'+crtWigiiNamespace+'/'+crtModule+'/UserAdminMatrix/doUserActivity/'+act+'/'+workingModule+'/'+standardContextMenu_crtHeader)

}
function clickOnAcitivityInUserAdminMatrixItems(items, crtWigiiNamespace, crtModule, workingModule){
	crtCol = $(items).parent().parent().attr('class');
	crtRow = $(items).parent().parent().parent().attr('class');
	checked = $(items).find('input').get(0).checked;
	update('NoAnswer/'+crtWigiiNamespace+'/'+crtModule+'/UserAdminMatrix/setAdminLevel/'+workingModule+'/'+crtRow+'/'+crtCol+'/'+checked)

}

function clickOnAcitivityInUserUserMatrixUserContextMenu(contextButton, crtWigiiNamespace, crtModule, workingModule){
	contextButton = $(contextButton);

	activities = ["userEdit", "userDelete"];
	for (i in activities){
		if(contextButton.hasClass(activities[i])){
			act = activities[i];
			break;
		}
	}

	update('NoAnswer/'+crtWigiiNamespace+'/'+crtModule+'/UserUserMatrix/doUserActivity/'+act+'/'+workingModule+'/'+standardContextMenu_crtHeader)

}
function clickOnAcitivityInUserUserMatrixItems(items, crtWigiiNamespace, crtModule, workingModule){
	crtCol = $(items).parent().attr('class');
	crtRow = $(items).parent().parent().attr('class');
	checked = $(items).find('input').get(0).checked;
	update('NoAnswer/'+crtWigiiNamespace+'/'+crtModule+'/UserUserMatrix/setUserUser/'+workingModule+'/'+crtRow+'/'+crtCol+'/'+checked)

}

function clickOnAcitivityInUserRoleMatrixItems(items, crtWigiiNamespace, crtModule, workingModule){
	crtCol = $(items).parent().attr('class');
	crtRow = $(items).parent().parent().attr('class');
	checked = $(items).find('input').get(0).checked;
	update('NoAnswer/'+crtWigiiNamespace+'/'+crtModule+'/UserRoleMatrix/setUserRole/'+workingModule+'/'+crtRow+'/'+crtCol+'/'+checked)
}

adminGroup_crtSelectedGroup = null;
adminUser_crtSelectedUser = null;
adminModuleEditor_crtSelectedModuleConfig = null;

function adminUserDetailOnResize(){
	if($('#adminUser_list').length>0){
		if(browserName == "msie" && version =="8") corr = 25;
		else corr = 5;
		$('#adminUser_list').css('height', $(window).height()-$('#adminUser_list').position().top -$('#footerBar').outerHeight()-5);
		$('#adminUser_detail').width($(window).width()-$('#adminUser_list').outerWidth()-corr);
		$('#elementDetail').width($('#adminUser_detail').width()-60-5); //60 is internal padding
		$('#elementDetail').css('height', $(window).height()-$('#elementDetail').position().top -$('#footerBar').outerHeight()-10);
		//position the scroll on selected element
		if($('#adminUser_list div.userHeader.S').length > 0){
			$('#adminUser_list').scrollTop($('#adminUser_list div.userHeader.S').position().top+2+$('#adminUser_list').position().top+$('#adminUser_list').scrollTop()-$('#adminUser_list').height());
		}
		//$('#adminUser_list').css('height', $(window).height()-$('#userBar').outerHeight()-$('#navigationBar').outerHeight()-$('#tabsBar').outerHeight()-$('#adminSearchBar').outerHeight()-$('#footerBar').outerHeight()-5);
	}
}
function adminGroupDetailOnClickGroupTree(){
	if(browserName == "msie" && version =="8") corr = 25;
	else corr = 5;
	$('#adminGroup_detail').width($(window).width()-$('#adminGroup_list').outerWidth()-corr);
	$('#elementDetail').width($('#adminGroup_detail').width()-60-5); //60 is internal padding
	$('#elementDetail').css('height', $(window).height()-$('#elementDetail').position().top -$('#footerBar').outerHeight()-5);
}
function adminGroupOnResize(){
	if($('#adminGroup_list').length>0){
		if(browserName == "msie" && version =="8") corr = 25;
		else corr = 5;
		adminGroupDetailOnClickGroupTree();
		$('#adminGroup_list>ul').css('height', $(window).height()-$('#adminGroup_list').position().top -$('#footerBar').outerHeight()-20); //20 is the padding of the groupPanel>ul
	}
}
//function adminGroupDetailOnToggleTreeNode(){
//	if(browserName == "msie" && version =="8") corr = 25;
//	else corr = 5;
//	$('#adminGroup_detail').width($(window).width()-$('#adminGroup_list').outerWidth()-corr);
//	$('#elementDetail').width($('#adminGroup_detail').width()-5);
//}
function adminModuleEditorDetailOnResize(){
	//$('#adminModuleEditor_detail').width($(window).width()-$('#adminModuleEditor_list').outerWidth());
}

function adminModuleEditorListOnResize(){
	if($("#adminModuleEditor_list").offset()) { //test if the adminModuleEditor_list was created
		$("#adminModuleEditor_list").height($(window).height()-$("#adminModuleEditor_list").offset().top-$("#footerBar").outerHeight()-10); //10 = padding-top + padding-bottom
		$("#adminModuleEditor_list").width($(window).width()-$("#adminModuleEditor_detail").width()-15); //16 = padding-left + padding-right + border-left-width +1 for IE
	}
}

function setListenersToAdminGroup(){
	//add click on keep notified
	if($('#keepNotifyButton').length){
		$('#keepNotifyButton').click(openKeepNotifiedDialog);
	}
	setListenersToGroupTree('#adminGroup_list');

	//add resize on fold/unfold folder
	$('#adminGroup_list li span.folder').click(function(){
		adminGroupDetailOnClickGroupTree();
	});
	//add click on li: select folder
	$('#adminGroup_list li').click(function(e){
		adminGroupDetailOnClickGroupTree();
		adminGroup_crtSelectedGroup = $(this).attr('id').split('_')[1];

		//update the commands depending on the rights
		$('#adminGroup_detail .commands div').removeClass('disabled');
		$('#adminGroup_detail .commands div.write, #adminGroup_detail .commands div.admin').addClass('disabled');
		if($(this).hasClass("write")){
			$('#adminGroup_detail .commands div.write').removeClass('disabled');
		}
		if($(this).hasClass("admin")){
			$('#adminGroup_detail .commands div.admin').removeClass('disabled');
		}
		if($(this).parent().attr('id')=="group_0"){
			$('#adminGroup_detail .commands div.level1').addClass('disabled');
		}

		self.location = '#'+crtWigiiNamespaceUrl+'/'+crtModuleName+'/'+crtWorkingModuleName+'/folder/'+adminGroup_crtSelectedGroup;
		update('elementDetail/'+crtWigiiNamespaceUrl+'/'+crtModuleName+'/groupDetail/'+crtWorkingModuleName+'/'+adminGroup_crtSelectedGroup);
		e.stopPropagation();
	});
}

function setListenerToUserRoleAllocationFilter(){
	$('#UserRoleAllocationFilterInput')
		.keydown(function(e){
			//$(this).next().click();
			if(e.keyCode == 13){ $(this).next().click(); }
		})
		.focus(function(){ $(this).select(); })
	;
	$('#UserRoleAllocationFilterInput').next().click(function(){
		var searchVal = $(this).prev().val();
		if(searchVal == '' || searchVal == null){
			$('#adminRole_list div.userHeader').show();
			if($('#adminRole_list .S:first').length > 0){
				$('#adminRole_list').scrollTop($('#adminRole_list .S:first').get()[0].offsetTop-$('#adminRole_list').get()[0].offsetTop - 50);
			}
		} else {
			$('#adminRole_list div.userHeader').hide();
			//if there are some separators then use them as separators else use the space
			searchVal = searchVal.replace(/\"/g, '');
			if(searchVal.search(/[,;|]/i)!=-1){
				searchVal = searchVal.replace(/\|\|/g, '|');
				searchVal = searchVal.replace(/,/g, '|');
				searchVal = searchVal.replace(/;/g, '|');
			} else {
				searchVal = searchVal.replace(/ /g, '|');
			}
			searchVal = searchVal.split('|');
			var x;
			for(x in searchVal){
				$('#adminRole_list div.userHeader:icontains(\"'+searchVal[x].trim()+'\")').show();
			}
		}

	});
	
	$('#adminRole_list_check_all')
		.click(function(e){
			$('#adminRole_list > div').not('[style*="display: none"]').addClass('S');
			$('#adminRole_list_check_all').parent().children().first().text($('#adminRole_list > div.S').length);
		});
	$('#adminRole_list_uncheck_all')
		.click(function(e){
			$('#adminRole_list > div').not('[style*="display: none"]').removeClass('S');
			$('#adminRole_list_uncheck_all').parent().children().first().text($('#adminRole_list > div.S').length);
		});
}

$(window).resize(adminModuleEditorDetailOnResize);
$(window).resize(adminModuleEditorListOnResize);
$(window).resize(adminGroupOnResize);
$(window).resize(adminUserDetailOnResize);





/**
 *  This file is part of Wigii.
 *  Wigii is developed to inspire humanity. To Humankind we offer Gracefulness, Righteousness and Goodness.
 *  
 *  Wigii is free software: you can redistribute it and/or modify it 
 *  under the terms of the GNU General Public License as published by
 *  the Free Software Foundation, either version 3 of the License, 
 *  or (at your option) any later version.
 *  
 *  Wigii is distributed in the hope that it will be useful, but WITHOUT ANY WARRANTY; 
 *  without even the implied warranty of MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  
 *  See the GNU General Public License for more details.
 *
 *  A copy of the GNU General Public License is available in the Readme folder of the source code.  
 *  If not, see <http://www.gnu.org/licenses/>.
 *
 *  @copyright  Copyright (c) 2016  Wigii.org
 *  @author     <http://www.wigii.org/system>      Wigii.org 
 *  @link       <http://www.wigii-system.net>      <https://github.com/wigii/wigii>   Source Code
 *  @license    <http://www.gnu.org/licenses/>     GNU General Public License
 */

// helpers to embed javascript into xml documents without causing parsing errors due to reserved characters
window.sm = window.smaller = function(a,b){return a<b;};
window.gr = window.greater = function(a,b){return a>b;};
window.smeq = window.smallerOrEqual = function(a,b){return a<=b;};
window.greq = window.greaterOrEqual = function(a,b){return a>=b;};

/**
 * Wigii JS client
 * Created by CWE on October 19 2015
 * Modified by CWE on December 13 2018 to remove unused library WigiiStdFL and to add documentation tags on functions
 * @param Window window current browser window
 * @param JQuery $ depends on JQuery 1.8.x
 */
(function(window,$) {
	// Configuration options
	var wigiiApiOptions = undefined;
	if(window.wigiiApi && window.wigiiApi.options) wigiiApiOptions = window.wigiiApi.options;
	if(!wigiiApiOptions) wigiiApiOptions = {};
	
	/**
	 * Attaches a comment and some custom attributes to a given function.
	 * The comment or the attributes are stored in the wncdAttr object attached to the function 
	 * and can be used as meta information further down in the code.
	 * NCD attributes are not loaded by default. To load them wigiiApiOptions.loadNcdAttributes should be true.
	 *@param String|Function comment a comment describing the function, as a string or as a source code native comment wrapped into a function
	 *@param Function|Object f the function to which to add the NCD attributes. 
	 * Between first argument comment and last argument f, as many pairs key,value as needed can be inserted. These pairs key:value will be added to the attached wncdAttr object.
	 *@return Function returns f for chaining
	 */
	var wigiiNcdAttr = function(enable){var enabled=(enable==true); return function(comment,f) {
		if(enabled && f) {
			// extracts any list of pairs key,value
			var args = undefined;
			if(arguments.length > 2) {
				args = Array.prototype.slice.call(arguments);
				comment = args[0];
				f = args[args.length-1];
			}
			// extracts source code comment from wrapping function
			if($.isFunction(comment)) {
				comment = comment.toString().match(/(\/\*\*([^*]|[\r\n]|(\*+([^*\/]|[\r\n])))*\*+\/)/g);
				if(comment) comment = comment[0];				
			}
			// stores attributes
			var wncdAttr = f.wncdAttr || {};
			if(comment) wncdAttr.comment = comment;
			if(args && args.length>0) {
				var i=0; var key,value;
				while(i<args.length) {
					key = args[i]; i++;
					if(i<args.length) {
						value = args[i]; i++;
					}
					if(key && value!==undefined) wncdAttr[key] = value;
				}
			}
			f.wncdAttr = wncdAttr;			
		}
		return f;
	}};
	var ncddoc = wigiiNcdAttr(wigiiApiOptions.loadNcdAttributes);
	
	/**
	 * Wigii JS API
	 */
	var WigiiApi = function() {
		var wigiiApi = this;
		wigiiApi.instantiationTime = (new Date()).getTime();
		wigiiApi.ctxKey = 'Wigii_'+wigiiApi.instantiationTime;
		/**
		 * Object which holds inner private mutable state variables.
		 */
		wigiiApi.context = {};
		
		// Configuration
		
		wigiiApi.holdJsCodeAnswers = function(bool) {
			if(bool===undefined) return wigiiApi.context.holdJsCodeAnswers;
			else wigiiApi.context.holdJsCodeAnswers = bool;
		};
		
		// Error codes
		
		wigiiApi.errorCodes = {
				
			// ServiceException (from 1000 to 1099 + http error codes)
				
			/**
			 * unauthorized user, http equivalent
			 */
			UNAUTHORIZED: 401,
			/**
			 * access forbidden, http equivalent
			 */
			FORBIDDEN: 403,
			/**
			 * not found, http equivalent
			 */
			NOT_FOUND: 404,
			/**
			 * default error
			 */
			UNKNOWN_ERROR: 1000,
			/**
			 * development error, indicates that a method is still not implemented but will be in a short term
			 */
			NOT_IMPLEMENTED: 1001,
			/**
			 * indicates that nested (or previous) exception exists.
			 */
			WRAPPING: 1002,
			/**
			 * indicates that this operation is not supported by this implementation.
			 */
			UNSUPPORTED_OPERATION: 1003,
			/**
			 * indicates that a method argument is invalid
			 */
			INVALID_ARGUMENT: 1004,
			/**
			 * unexpected error, that should never happen.
			 */
			UNEXPECTED_ERROR: 1005,
			/**
			 * database is dirty with corrupted or invalid data
			 */
			DATA_INTEGRITY_ERROR: 1006,
			/**
			 * deprecated method
			 */
			DEPRECATED: 1007,
			/**
			 * invalid state of object
			 */
			INVALID_STATE: 1008,
			/**
			 * Indicates that there is a problem in the configuration of the system
			 */
			CONFIGURATION_ERROR: 1009,
			/**
			 * Indicates that the current operation has been explicitely canceled by the service
			 * The service can provide a retryAfterCancel method.
			 */
			OPERATION_CANCELED: 1010,
			
			
			// ListException (error code range from 3100 to 3199)
			
			OUT_OF_BOUND: 3100,
			ALREADY_EXISTS: 3101,
			DOES_NOT_EXIST: 3102,
			
			// FuncExpEvalException (error code range from 4600 to 4699)
			
			SYMBOL_NOT_FOUND: 4600,
			INVALID_RETURN_VALUE: 4601,
			VARIABLE_NOT_DECLARED: 4602,
			DIVISION_BY_ZERO: 4603,
			ASSERTION_FAILED: 4604
			
		};
		// initializes error labels
		wigiiApi.initializeErrorLabels = function() {
			if(!wigiiApi.errorLabels) {
				wigiiApi.errorLabels = {};
				for(var errName in wigiiApi.errorCodes) {
					wigiiApi.errorLabels[wigiiApi.errorCodes[errName]] = errName;
				}
			}			
		};
		wigiiApi.initializeErrorLabels();
		
		// Exceptions
		
		ncddoc(function(){/**
		 * ServiceException class
		 * @param String message the error message
		 * @param Number code the error code
		 * @param Object previous if defined, the previous exception in the chain if wrapping.
		*/},
		wigiiApi.ServiceException = function(message,code,previous) {			
			var self = this;
			self.name = 'ServiceException';
			self.message = message;
			self.code = code || wigiiApi.errorCodes.UNKNOWN_ERROR;
			self.previousException = previous; 
		});
		
		// Classes
		
		ncddoc(function(){/**
		 * Debugger core technical service
		*/},
		wigiiApi.DebugLogger = function(typeName) {
			var self = this;
			self.attachedClass = typeName;
			self.enabled = true;
			self.write = function(message) {
				if(self.enabled) wigiiApiConsole().debug("DEBUG "+self.attachedClass+" : "+message);
			};
			self.writeIf = function(condition,message) {
				if(self.enabled && condition) wigiiApiConsole().debug("DEBUG "+self.attachedClass+" : "+message);
			};
			self.logBeginOperation = function(operation) {self.write("BEGIN "+operation);};
			self.logEndOperation = function(operation) {self.write("END "+operation);};
		});
		
		ncddoc(function(){/**
		 * Exception sink core technical service
		*/},
		wigiiApi.ExceptionSink = function() {
			var self = this;
			self.publish = function(exception) {
				// goes up to root exception
				while($.type(exception) === 'object' && 
					exception.code == wigiiApi.errorCodes.WRAPPING && exception.previousException) {
					exception = exception.previousException;
				}
				var exceptionType = $.type(exception);
				if(exceptionType === 'object') {
					name = exception.name || 'ServiceException';
					code = exception.code || wigiiApi.errorCodes.UNKNOWN_ERROR;
					message = exception.message || 'No message';
				}				
				else if(exceptionType === 'array') {
					name = 'ServiceException';
					code = wigiiApi.errorCodes.UNKNOWN_ERROR;
					message = 'Array';
				}
				else if(exception) {
					name = 'ServiceException';
					code = wigiiApi.errorCodes.UNKNOWN_ERROR;
					message = exception;
				}
				else {
					name = 'ServiceException';
					code = wigiiApi.errorCodes.UNKNOWN_ERROR;
					message = 'UNKNOWN_ERROR';
				}
				var errorMessage = "EXCEPTION "+name+"   code:"+code+"\n"+message;
				try {wigiiApiConsole().error(errorMessage);}catch(e){alert(errorMessage+"\n\n(note: using browser alert because WigiiAPIConsole is not working)");}				
			};
		});
				
		
		ncddoc(function(){/**
		 * Creates a popup window attached to the given anchor element
		 * @param jQuery|DOM.Element anchor the element to which attach the popup window
		 * @param Object options a map of configuration options for the popup window:
		 * {
		 *  id: html ID to attach to the pop-up,
		 *  classId: class used as an html ID to attach to the pop-up,
		 *  title: String used as a pop-up title,
		 *  type: undefined or 'help','info','warning','error','notif'
		 *  relativeToAnchor: boolean (if true, then top and left are relative to anchor, else relative to window)
		 *  top: default y position,
		 *  left: default x position,  
		 *  width: default width in px, 
		 *  height: default height in px, 
		 *  resizable: boolean (if true, then resizable and movable popup, else fix popup),
		 *  closeable: boolean (if true, adds a small x button on top-right to hide the popup).
		 *  removeOnClose: boolean. If true and closeable, then closing the popup will remove it from the DOM, else only closes the popup. Defaults to false.
		 * }
		*/},
		wigiiApi.PopUp = function(anchor,options) {
			var self = this;
			if(!anchor) anchor = $('body');
			else anchor = $(anchor);
			if(!options) options = {};
			if(options['resizable'] !== false) options.resizable=true;
			if(options['closeable'] !== false) options.closeable=true;
			/**
			 * Shows the popup 
			 * or registers an event handler on show event
			 * @param Function eventHandler event handler to register for show event
			 * @return Popup for chaining
			 */
			self.show = function(eventHandler) {
				// eventHandler registration
				if($.isFunction(eventHandler)) {
					if(!self.showEventSubscribers) self.showEventSubscribers = [];
					self.showEventSubscribers.push(eventHandler);
				}
				// show popup
				else if(self['popupElt']) {
					$(self.popupElt).show();
					if(!self.isVisible) {
						self.isVisible = true;
						// if the popup is relative to anchor we add overflow to  ensure popup is displayed
						if(self.isRelativeToAnchor) anchor.parent().css('overflow','visible');
						// reset default position and dimension if resetOnShow
						if(self.resetOnShow && self.defaultOptions) {
							var w = self.window();
							w.css('top',self.defaultOptions.top).css('left',self.defaultOptions.left);
							if(self.defaultOptions.width && self.defaultOptions.height) {
								w.css('height',self.defaultOptions.height+20).css('width',self.defaultOptions.width).resize();
							}; 
							self.body().scrollTop(0).scrollLeft(0);
						}
						// notifies all event subscribers
						if(self.showEventSubscribers) {
							for(var i=0;i<self.showEventSubscribers.length;i++) {
								var handler = self.showEventSubscribers[i];
								if($.isFunction(handler)) handler(self);
							}
						}
					}					
				}
				return self;
			};
			/**
			 * Hides the popup (but still keeps it attached to the DOM)
			 * or registers an event handler on hide event
			 * @param Function eventHandler event handler to register for show event
			 * @return Popup for chaining
			 */
			self.hide = function(eventHandler) {
				// eventHandler registration
				if($.isFunction(eventHandler)) {
					if(!self.hideEventSubscribers) self.hideEventSubscribers = [];
					self.hideEventSubscribers.push(eventHandler);
				}
				// else hides popup
				else if(self['popupElt']) {
					$(self.popupElt).hide();
					if(self.isVisible) {
						self.isVisible=false;
						// if the popup is relative to anchor we remove overflow for fix a display bug
						if(self.isRelativeToAnchor) anchor.parent().css('overflow','');
						// notifies all event subscribers
						if(self.hideEventSubscribers) {
							for(var i=0;i<self.hideEventSubscribers.length;i++) {
								var handler = self.hideEventSubscribers[i];
								if($.isFunction(handler)) handler(self);
							}
						}
					}					
				}
				return self;
			};
			/**
			 * Toggles the visibility of the popup
			 */
			self.toggle = function() {
				if(self.isVisible) self.hide();
				else self.show();
			};
			/**
			 * Removes the popup window from the DOM
			 * or registers an event handler on remove event
			 * @param Function eventHandler event handler to register for show event
			 * @return Popup for chaining
			 */
			self.remove = function(eventHandler) {
				// eventHandler registration
				if($.isFunction(eventHandler)) {
					if(!self.removeEventSubscribers) self.removeEventSubscribers = [];
					self.removeEventSubscribers.push(eventHandler);
				}
				else if(self['popupElt']) {
					$(self.popupElt).remove();
					self.isVisible=false;
					delete self.popupElt;
					// notifies all event subscribers
					if(self.removeEventSubscribers) {
						for(var i=0;i<self.removeEventSubscribers.length;i++) {
							var handler = self.removeEventSubscribers[i];
							if($.isFunction(handler)) handler(self);
						}
					}
				}
				return self;
			};
			/**
			 * Sets the html of the popup body.
			 * @param String|Function htmlString the html string to use as html content for this popup 
			 */
			self.html = function(htmlString) {
				var b = self.body();
				if(b) {
					// if we have an html emitting function, call it on the popup body.
					if($.isFunction(htmlString)) htmlString(b,self)
					// else we already have a built in html string
					else b.html(htmlString);
					// fixes body height					
					if(b.children().size()>0) {
						b.css('height',b.height()+1);						
					}
				}
				// records default width and height if not yet calculated
				if(b.children().size()>0 && self.defaultOptions && !self.defaultOptions.width && !self.defaultOptions.height) {					
					var w = self.window();
					self.defaultOptions.width = w.width();
					self.defaultOptions.height = w.height();
				}
			};
			/**
			 * Returns the DIV jQuery selector containing the pop-up window
			 * @return jQuery 
			 */
			self.window = function() {
				if(self['popupElt']) return $(self.popupElt);
			};
			/**
			 * Returns the DIV jQuery selector containing the pop-up html body
			 * @return jQuery
			 */
			self.body = function() {
				if(self['popupElt']) return $(self.popupElt).find('div.popupBody');
			};
			
			var insertIntoAnchor = anchor.is('body')||(options['domInsertionMode']=='append');
			// if insertIntoAnchor then an ID should exist, generates one if needed.
			if(insertIntoAnchor && !options['id'] && !options['classId']) {
				options['id'] = 'popup_'+(new Date()).getTime();
			}

			if(!options.referenceWindow) options.referenceWindow = $(window);			
			var popupSelector = (options['id']?'#'+options.id:(options['classId']?'.'+options.classId:undefined));
			var title = options['title'];
			var width = options['width'] || Math.round(options.referenceWindow.width()/3);			
			var height = options['height'] || Math.round(options.referenceWindow.height()/3);
			var top = options['top'] ||  Math.max(0,(options.referenceWindow.height()-height)/2);
			var left = options['left'] || Math.max(0,(options.referenceWindow.width()-width)/2);		
			
			// if displays relative to anchor
			var popupPosition = 'fixed';
			if(options['relativeToAnchor'] && !anchor.is('body')) {
				// computes anchor position relative to parent
				var anchorOffset = anchor.offset();
				var parentOffset = anchor.parent().offset();
				// adapts top and left to handle parent coordinates
				top = top+(anchorOffset.top-parentOffset.top);
				left = left+(anchorOffset.left-parentOffset.left);
				// fixes anchor parent position
				anchor.parent().css('position','relative').css('overflow','visible');
				popupPosition='absolute';
				if(!self.isRelativeToAnchor) self.isRelativeToAnchor = true;
			}
			
			var popupHtml = '<div';
			if(options['id']) popupHtml+=' id="'+options['id']+'"';
			popupHtml += ' class="'+(options['classId']&&!options['id']?options['classId']:'')+' ui-corner-all ui-widget ui-dialog SBIB"';
			popupHtml += ' style="cursor:default;z-index:998;position:'+popupPosition+';background-color:#fff;border-style:solid;border-width:1px;top:'+top+'px;left:'+left+'px;padding:5px;width:'+width+'px;height:auto;max-height:'+height+'px;display:none;float:none;border-color:black;"';
			popupHtml +='>';
			if(title) popupHtml +='<div class="popupTitle ui-corner-all ui-widget-header" style="'+(options['resizable']?'cursor:move;':'')+'float:left;font-style:normal;font-weight:bold;font-size:small;text-align:left;padding-left:13px;padding-right:0;padding-top:5px;padding-bottom:5px;margin:0;color:black;min-height:14px;width:'+(width-13)+'px" >'+title+'</div>';
			else popupHtml +='<div class="popupTitle emptyTitle ui-corner-all" style="'+(options['resizable']?'cursor:move;':'')+'float:left;z-index:999;position:absolute;right:4px;top:-10px;font-style:normal;font-weight:bold;font-size:small;text-align:left;padding-left:13px;padding-right:0;padding-top:5px;padding-bottom:5px;margin:0;color:black;height:14px;width:'+(width-10)+'px" >&nbsp;</div>';
			if(options['closeable']) {
				if(title) popupHtml += '<div class="exit ui-corner-all" style="z-index:999;position:absolute;right:6px;top:8px;cursor:pointer;width:15px;height:17px;float:right;text-align:center;vertical-align:middle;color:black;font-weight:bold;font-style:normal;font-size:small;padding:0;margin:0">x</div>'; 
				else popupHtml += '<div class="exit ui-corner-all SBIB" style="z-index:999;position:absolute;right:-2px;top:-3px;cursor:pointer;width:15px;height:17px;float:right;background-color:#fff;border-style:solid;border-width:1px;text-align:center;vertical-align:middle;color:black;font-weight:bold;font-style:normal;font-size:small;padding:0;margin:0;border-color:black">x</div>';
			}
			popupHtml +='<div class="clear"></div>';
			popupHtml +='<div class="popupBody" style="z-index:998;cursor:default;float:left;font-weight:normal;font-style:normal;font-size:small;text-align:left;padding:0;margin:0;margin-top:1px;color:black;overflow-y:auto;height:auto;max-height:'+(title?height-40:height-8)+'px;width:'+(width-9)+'px;"><br/></div></div>';
						
			// if insert into anchor
			if(insertIntoAnchor) {
				anchor.find(popupSelector).remove();
				anchor.append(popupHtml);
				self.popupElt = anchor.find(popupSelector);
			}
			// else appends to anchor
			else {
				if(popupSelector) anchor.parent().find(popupSelector).remove();
				anchor.after(popupHtml);
				self.popupElt = anchor.next();
			}	
			// saves position and dimension options if resetOnShow
			if(options['resetOnShow']) {
				self.defaultOptions = {top:top,left:left};
				// only records size if popup is not resizable, 
				// because otherwise height is dynamically calculated by the browser when showing.
				if(!options['resizable']) {
					self.defaultOptions.width = width;
					self.defaultOptions.height = height;
				}
				self.resetOnShow=true;
			}
			// resizable and draggable
			if(options['resizable']) {
				self.popupElt.draggable({handle:'.popupTitle'}).resizable().resize(function(event){
					event.stopPropagation();
					$(this).css('min-width','0').css('min-height','0').css('max-width','none').css('max-height','none');
					var body = $(this).find('div.popupBody');
					body.css('min-width','0').css('min-height','0').css('max-width','none').css('max-height','none').width($(this).width()-5);
					var title = $(this).find('div.popupTitle');
					if(title.hasClass('emptyTitle')) {
						title.width($(this).width()-10);
						body.height($(this).height()-8);
					}
					else {
						title.width($(this).width()-13);
						body.height($(this).height()-28);
					}
				});				
			}			
			// close event handler			
			if(options['closeable']) {
				var closeHandler = undefined;
				if(options['removeOnClose']) closeHandler = function(event){self.remove();event.stopPropagation();};
				else closeHandler = function(event){self.hide();event.stopPropagation();};
				self.popupElt.find('div.exit').click(closeHandler);
			}
			// restores defaults mouseDown event on popupBody to allow scrolling
			self.body().mousedown(function(event){event.stopPropagation();});
		});
		
		ncddoc(function(){/**
		 * Wigii Help Service
		 * Shows some contextual help in popup windows or displays contextual messages according to current flow.
		*/},
		wigiiApi.HelpService = function() {
			var self = this;
			self.className = 'HelpService';
			self.ctxKey = wigiiApi.ctxKey+'_'+self.className;
			self.debugLogger = wigiiApi.getDebugLogger(self.className);
			
			/**
			 * HTML event handler
			 */
			self.html = function(htmlString,context) {
				if(context && context.popup) {
					context.popup.html(htmlString);
					context.popup.show();
				}
			};
			
			/**
			 * JSON event handler
			 * @param Object object the JSON response already parsed into an object
			 */
			self.json = function(object,context) {
				// ignore scalar values
				if(!$.isPlainObject(object)) return;
				// if exception, then displays the error
				else if(object['exception']) {					
					self.html(wigiiApi.exception2html(object['exception'],object['context']),context);					
				}
				// if notification, then adds notification to target
				else if(object['notification']) {
					self.showNotification(object['notification']);
				}
				// else nothing to do.
			};
			
			/**
			 * Shows a help popup attached to a given anchor
			 * @param String content the help content (local content or remote url)
			 * @param jQuery anchor the jQuery selector on which to fix a popup
			 * @param options the help and popup options
			 */
			self.showHelp = function(content,anchor,options) {
				//We go back to the tree node 'scrollElement' if not found we are in html node
				options.referenceWindow = anchor.parentsUntil('#scrollElement').last().parent();
				//If we didn't find node 'scrollElement' we try to find 'elementDialog'
				if(options.referenceWindow.attr('id')!='scrollElement' || isWorkzoneViewDocked()) options.referenceWindow =  anchor.parentsUntil('#elementDialog').last().parent();
				var context = anchor.data(self.ctxKey);
				if(!context) {
					context = {};
					// popup positioning
					if(!options.top && !options.left) {						
						var anchorOffset = anchor.offset();
						var scrollLeft = options.referenceWindow.scrollLeft();
						var scrollTop = options.referenceWindow.scrollTop();
						// if reference window is a dialog, then the scroll is in fact the dialog position in the page
						var refWindowOffset = options.referenceWindow.offset();						
						if(refWindowOffset && (refWindowOffset.top > 0 || refWindowOffset.left > 0)) {
							scrollLeft = refWindowOffset.left;
							scrollTop = refWindowOffset.top;
						}						
						// takes max available window height if position is S,SE or SW, 1/3 window height if position is center.
						switch(options.position) {
						case 'SE':
						case 'S':
						case 'SW':							
							options.height = Math.max(options.height, options.referenceWindow.height()-(anchorOffset.top-scrollTop)-options.offset-15);
							break;
						case 'center':
							options.height = Math.max(options.height,Math.floor(options.referenceWindow.height()/2));
							break;
						}
						wigiiApi.positionBox({pageX:anchorOffset.left,pageY:anchorOffset.top}, options, options);
						// make position relative to anchor
						options.top = options.top-(anchorOffset.top-scrollTop);				
						options.left = options.left-(anchorOffset.left-scrollLeft);
						options.relativeToAnchor=true;						
					}
					else {
						options.relativeToAnchor=false;
					};
					// popup creation					
					context.popup = wigiiApi.createPopUpInstance(anchor,options);
					
					// if type == 'help' we would have only one popup  
					// (this initialization on show/hide events should be done before first call of show)
					if (options.type == 'help') {
						fh = anchor.parents('div.field').first().wigii('FieldHelper');
						if(fh.ctxKey) {
							fh = fh.formHelper();
							context.popup.show(fh.onHelpPopupShow);
							context.popup.hide(fh.onHelpPopupHide);
						}						
					};
					
					
					// shows popup first
					context.popup.show();
					// fills content after to resize height correctly based on content
					if(options.localContent) {
						context.popup.html(content);
					}
					else {
						$.ajax({url:wigiiApi.buildUpdateUrl(content),
							cache:false,
							success:wigiiApi.buildUpdateCallback(context)
						});
					}
					// reposition the window now we know its size.
					if(options.relativeToAnchor) {
						var w = context.popup.window();
						options.height = w.height();
						options.width = w.width();
						wigiiApi.positionBox({pageX:anchorOffset.left,pageY:anchorOffset.top}, options, options);
						options.top = options.top-(anchorOffset.top-scrollTop);								
						if(context.popup.defaultOptions) context.popup.defaultOptions.top = options.top;
						w.css('top',Math.ceil(options.top));
					}
					anchor.data(self.ctxKey,context);
					// removes anchor on close if needed
					if(options['removeOnClose']) context.popup.remove(function(){anchor.remove();});
					
				}	
				else context.popup.show();
			};
			
			/**
			 * Toogles visibility of a help popup attached to a given anchor.
			 * If previously displayed, then hides it, else displays it.
			 * @param String content the help content (local content or remote url)
			 * @param jQuery anchor the jQuery selector on which to fix a popup
			 * @param options the help and popup options
			 */
			self.toggleHelp = function(content,anchor,options) {
				var context = anchor.data(self.ctxKey);
				if(context) context.popup.toggle();
                else self.showHelp(content,anchor,options);
			};
			
			/**
			 * Shows a floating help popup displayed on the mouse event coordinates.
			 * @param jQuery container jQuery selector on the element which will contain the help popup
			 * @param jQuery.Event mouseEvent mouse event (click,mousedown, ...)
			 * @param String content the help content (local content or remote url)
			 * @param options the help and popup options
			 */
			self.showFloatingHelp = function(container,mouseEvent,content,options) {
				if(!container) container = $('body');
				if(!options) options = {};
				if(!options['type']) options.type = 'help';
				if(!options['width']) options.width=400;
				if(!options['height']) options.height=400;
				if(!options['position'] && !options.top && !options.left) options.position='SE';
				if(!options['offset'] && !options.top && !options.left) options.offset=0;
				options.removeOnClose=true; // removes popup when it is closed.
				options.domInsertionMode = 'append'; // inserts popup in the container
				// popup positioning
				if(!options.top && !options.left) {
					// takes max available window height if position is S,SE or SW, 1/3 window height if position is center.
					switch(options.position) {
					case 'SE':
					case 'S':
					case 'SW':	
						if(mouseEvent) options.height = Math.max(options.height, $(window).height()-(mouseEvent.pageY-$(window).scrollTop())-options.offset-15);
						else options.height = Math.max(options.height,Math.floor($(window).height()/2));
						break;
					case 'center':
						options.height = Math.max(options.height,Math.floor($(window).height()/2));	
						break;
					}				
					wigiiApi.positionBox(mouseEvent,options,options);
				}
				// popup creation
				var context = {};
				context.popup = wigiiApi.createPopUpInstance(container,options);
				// shows popup first
				context.popup.show();
				// fills content after to resize height correctly based on content
				if(options.localContent) {					
					context.popup.html(content);
				}
				else {
					$.ajax({url:wigiiApi.buildUpdateUrl(content),
						cache:false,
						success:wigiiApi.buildUpdateCallback(context)
					});
				}
			};
			
			/**
			 * Renders a help anchor to which a help popup is attached.
			 * @param jQuery container jQuery selector on the containing element to which append the help anchor.
			 * @param String content the help content
			 * @param Object options the help options
			 */
			self.renderHelpAnchor = function(container,content,options) {
				if(!container) return;
				if(!options) options = {};
				if(!options['type']) options.type = 'help';
				if(!options['domInsertionMode']) options.domInsertionMode = 'append';
				if(!options['width']) options.width=400;
				if(!options['height']) options.height=400;
				if(!options['position'] && !options.top && !options.left) options.position='SE';
				if(!options['offset'] && !options.top && !options.left) options.offset=15;
				options.resetOnShow = true; // resets the popup to default position and dimension each time it is shown.
				var ctxKey = self.ctxKey+'_'+options.type;
				// creates helpAnchor html
				var helpAnchor = '';
				switch(options.type) {
				case 'help':
					helpAnchor = 'helpAnchor';
					break;				
				case 'warning':
					helpAnchor = 'warningAnchor';
					break;	
				case 'error':
					helpAnchor = 'errorAnchor';
					break;
				case 'notif':
					helpAnchor = 'notifAnchor';
					break;
				case 'search':
					helpAnchor = 'searchAnchor';
					break;
				case 'info':
				default:
					helpAnchor = 'infoAnchor';
				}
				// creates helpSpan and inserts it into the DOM
				var helpSpan = '<a class="'+ctxKey+' HelpService '+helpAnchor+'"></a>';
				var neighbor = undefined;
				switch(options.domInsertionMode) {
				case 'append':
					container.append(helpSpan);
					helpSpan = container.find('a.'+ctxKey);
					neighbor = helpSpan.prev();
					if(neighbor.is('a')) neighbor = helpSpan.prevUntil('div,span,select').last().prev();
					break;
				case 'after':
					container.after(helpSpan);
					helpSpan = container.next('a.'+ctxKey);
					break;
				default:
					helpSpan = undefined;
				}
				
				if(helpSpan) {
					// ajusts neighbor width to allow displaying help span					
					if(neighbor) {						
						var w = neighbor.width();
						// special case for select2
						if(neighbor.hasClass("flex")||neighbor.hasClass("chosen")) {
							// checks if we have a fixed width
							var cssW = neighbor.css("width");
							if(cssW && cssW.indexOf("%")>=0) cssW=undefined;
							// else takes max-width
							if(!cssW) cssW = neighbor.css("max-width");
							// else takes parent max-width
							if(!cssW) cssW = neighbor.parent().css("max-width");
							if(cssW) {
								try{w = Number.parseInt(cssW.replace('px',''))-5;} catch(exc){/* nothing to change */}							
							}
						}
						if(w>=75) {
							// forces resize of element
							neighbor.width(w-25);
							neighbor.css("width",(w-25)+"px").resize();							
						}						
						neighbor.children('div,span,select').each(function(){
							var e = $(this);
							w = e.width();
							if(w>=75) {
								// forces resize of element
								e.width(w-25);
								e.css("width",(w-25)+"px").resize();								
							}
						});
					}
					// inserts popup after helpSpan
					options.domInsertionMode = 'after';
					// if position==blank then opens new tab with content as url
					if(options.position == 'blank') {
						helpSpan.attr('href',content).attr('target', '_blank');
					}
					// adds click event handler
					else {
						helpSpan.off().click(function(event){
							var e = $(this);						
							wigiiApi.getHelpService().toggleHelp(content,e,options);
							event.stopPropagation();
						});
					}
				}
			};
			/**
			 * Shows a notification in the GUI.
			 * @param Object notif a Wigii notification object of the form {
			 * target:String. HTML ID of notification container. One of elementDialog|searchBar
			 * type:String. Notification type. One of help|info|warning|error|notif
			 * url:String. Notification content callback.
			 * ... other options for showHelp and Popup
			 * }
			 */
			self.showNotification = function(notif) {
				if(!$.isPlainObject(notif)) return;
				if(!notif.url) return;
				if(notif.target != 'elementDialog') notif.target = 'searchBar';
				if(!notif.type) notif.type = 'info';				
				var wigiiNotif = undefined;
				// gets wigiiNotif div in searchBar
				if(notif.target == 'searchBar') {
					// if help, replaces moduleHelp div
					if(notif.type == 'help') {
						var wigiiHelp = $('#searchBar .toolbarBox .moduleHelp'); 
						if(wigiiHelp.length == 0) {
							$('#searchBar .toolbarBox').prepend('<div class="moduleHelp"/>');
							wigiiNotif = $('#searchBar .toolbarBox .moduleHelp');
						}
						else {
							wigiiHelp.empty();
							wigiiNotif = wigiiHelp;
						}
						// forces popup to appear in SW
						notif.position='SW';
						if(!notif.width) notif.width=800;
						if(!notif.height) notif.height=400;
					}
					// else puts in div wigiiNotif
					else {
						wigiiNotif = $('#searchBar .toolbarBox .wigiiNotif');
						// creates div if does not exist
						if(wigiiNotif.length == 0) {
							$('#searchBar .toolbarBox').append('<div class="wigiiNotif" style="padding-right:3px;padding-left:3px;padding-top:3px;padding-bottom:3px;margin-right:10px;max-width:100%;overflow:hidden;"/>');
							wigiiNotif = $('#searchBar .toolbarBox .wigiiNotif');
						}
					}
				}
				// gets wigiiNotif div in elementDialog
				else if(notif.target == 'elementDialog') {					
					wigiiNotif = $('#elementDialog').parent().find('.wigiiNotif');
					// creates div if does not exist
					if(wigiiNotif.length == 0) {
						if(isWorkzoneViewDocked()) {
							$('#validTop').children().last().after('<div class="wigiiNotif" style=""/>');
							wigiiNotif = $('#validTop').find('.wigiiNotif');
						} else {
							$('#elementDialog').parent().find('.ui-dialog-titlebar-close').before('<div class="wigiiNotif" style="float:right;padding-right:3px;padding-left:3px;padding-top:3px;padding-bottom:3px;margin-right:10px;max-width:100%;overflow:hidden;"/>');
							wigiiNotif = $('#elementDialog').parent().find('.wigiiNotif');
						}
					}
					// if notif is help, then gets special help placeholder
					if(notif.type == 'help') {						
						// creates elementHelp div if not exist
						var wigiiHelp = wigiiNotif.prev('.elementHelp'); 
						if(wigiiHelp.length == 0) {
							wigiiNotif.before('<div class="elementHelp" style="float:right;padding-right:3px;padding-left:0px;padding-top:3px;padding-bottom:3px;margin-right:10px;max-width:100%;overflow:hidden;"/>');
							if(isWorkzoneViewDocked()) {
								wigiiNotif = $('#validTop .elementHelp');
								wigiiNotif.css('margin-top', '25px');
							} else {
								wigiiNotif = $('#elementDialog').parent().find('.elementHelp');
							}
						}
						// else clears elementHelp placeholder
						else {
							wigiiHelp.empty();
							wigiiNotif = wigiiHelp;
						}
						// forces popup to appear in SW
						notif.position='SW';
						if(!notif.width) notif.width=600;
						if(!notif.height) notif.height=300;
					}
				}
				// appends notif in wigiiNotif div
				if(wigiiNotif) {
					self.renderHelpAnchor(wigiiNotif, notif.url, notif);
				}
			};
			
			/**
			 * Remove the * add with a JQuery prepend function.
			 * @param Object collection a JQuery object collection
			 */
			self.removePrependStar = function(collection) {
				collection.each(function(){ 
					$(this).contents().each(function(){
						if($(this)[0].nodeType == 3){
							if($(this)[0].nodeValue.indexOf('*')!=-1) {
								$(this).remove();
								return false;
							}
						}
					});			
				});
			};
		});
		
		ncddoc(function(){/**
		 * Wigii Field helper.
		 * A class which helps manage fields lifecycle.
		*/},
		wigiiApi.FieldHelper = function() {
			var self = this;
			self.className = 'FieldHelper';
			self.ctxKey = wigiiApi.ctxKey+'_'+self.className;
			self.debugLogger = wigiiApi.getDebugLogger(self.className);
			
			
			// Object lifecycle
			
			/**
			 * Binds the FieldHelper instance to a Field or set of Fields selected with JQuery
			 * @param JQuery field the field DOM element to which attach the FieldHelper instance
			 * @param Object options a map of configuration options for the FieldHelper
			 */
			self.attach = function(field,options) {
				if(!field || field.length == 0) return;
				// stores jquery selection if more than one element
				if(field.length>1) {
					self.list = field;
					self.$ = field;
					self.options = options;
				}
				// if one element, then retrieves context
				else if(field.length == 1) {
					self.context = field.data(self.ctxKey);
					if(!self.context) {
						// creates context if not existing
						self.context = {}; /* here options could be used. */
						field.data(self.ctxKey,self.context);
						
						// extracts field info and puts into context
						var fieldInfo = field.attr('id');
						self.context.fieldId = fieldInfo;
						if(fieldInfo) {
							fieldInfo = fieldInfo.split('__');
							if(fieldInfo.length>0) self.context.formId = fieldInfo[0];
							if(fieldInfo.length>1) self.context.fieldName = fieldInfo[1];
						}
						self.context.dataType = field.attr('data-wigii-datatype');
					}
					self.$ = field;					
				}
			};
			
			// List iterator
			
			/**
			 * Returns an iterator that can be used to perform actions on each element of the list
			 */
			self.getIterator = function() {
				return wigiiApi.getFieldHelper();
			};
			/**
			 * Iterates through the list of elements
			 * @param iterator the iterator performing some actions
			 * @param Function actions a function grouping the actions to be done using the iterator. 
			 */
			self.iterate = function(iterator,actions) {
				if($.type(actions) === 'function' && self.list) {
					var options = self.options;
					self.list.each(function(i){
						var e = $(this);
						iterator.attach(e,options);						
						actions();
					});
				}
			};
			
			/**
			 * Iterates through the list of fields and calls doAction on each of them
			 * @param Function doAction callback of the form doAction(fieldHelper) where fieldHelper is a FieldHelper instance centered on the Field.
			 * @return FieldHelper for chaining
			 */
			self.forEachField = function(doAction) {
				if($.isFunction(doAction)) {
					if(self.list){
						var iterator = self.getIterator();
						self.iterate(iterator,function(){doAction(iterator);});
					} else {
						doAction(self);
					}
				}				
				return self;
			};
			
			// FieldHelper functional implementation
			
			/**
			 * Sets a value in the field or the list of fields
			 * @param String value value to set
			 * @param String subFieldName optional subfield name. If not defined, takes default 'value' subfield 
			 * @return FieldHelper for chaining
			 */
			self.setValue = function(value,subFieldName) {	
				// list iteration
				if(self.list) {
					var iterator = self.getIterator();
					var actions = function(){iterator.setValue(value,subFieldName);};
					self.iterate(iterator,actions);
				}
				// single element implementation
				else {
					if(subFieldName!=undefined){
						$('#'+self.fieldId()+' :input[name='+self.fieldName()+'_'+subFieldName+']').val(value);
					} else {
						if($('#'+self.fieldId()+' :input').hasClass('htmlArea')){
							$('#'+self.fieldId()+' :input').ckeditor(function(textarea){ //create a function to ensure the value is set once the editor is ready
								$(textarea).ckeditor().val(value);
							});						
						} else {
							$('#'+self.fieldId()+' :input').val(value);
						}
					}
				}
				return self;
			};
			
			/**
			 * Sets a numeric value in the field or the list of fields and format it with thousand separator
			 * @param String value value to set
			 * @return FieldHelper for chaining
			 */
			self.setNumValue = function(value) {	
				// list iteration
				if(self.list) {
					var iterator = self.getIterator();
					var actions = function(){iterator.setNumValue(value);};
					self.iterate(iterator,actions);
				}
				// single element implementation
				else {
					self.setValue(wigiiApi.txtNumeric(value));
				}
				return self;
			};
			
			/**
			 * Gets the value of the field
			 * @param String subFieldName optional subfield name. If not defined, takes default 'value' subfield 
			 * @returns String|Array the field value or an array of field value if FieldHelper is attached to a list
			 */
			self.getValue = function(subFieldName) {
				var returnValue = undefined;
				// list iteration
				if(self.list) {
					returnValue=[];
					var iterator = self.getIterator();
					var actions = function(){returnValue.push(iterator.getValue(subFieldName));};
					self.iterate(iterator,actions);
				}
				// single element implementation
				else {
					if(subFieldName!=undefined){
						if(self.formId()=='detailElement_form'){
							returnValue = $('#'+self.fieldId()+' div.value').html();
						}
						else {
							returnValue = $('#'+self.fieldId()+' :input[name='+self.fieldName()+'_'+subFieldName+']').val();
						}
					} else {
						if($('#'+self.fieldId()+' :input').hasClass('htmlArea')){
							$('#'+self.fieldId()+' :input').ckeditor(function(textarea){
								returnValue = $(textarea).ckeditor().val();
							});							
						} 
						else if(self.formId()=='detailElement_form'){
							returnValue = $('#'+self.fieldId()+' div.value').html();
						}
						else {
							returnValue = $('#'+self.fieldId()+' :input').val();
						}
					}
				}
				return returnValue;
			};
			/**
			 * Gets the numeric value of the field
			 * @returns Float|Array the numeric field value or an array of numeric field value if FieldHelper is attached to a list
			 */
			self.getNumValue = function() {
				var returnValue = undefined;
				// list iteration
				if(self.list) {
					returnValue=[];
					var iterator = self.getIterator();
					var actions = function(){returnValue.push(iterator.getNumValue());};
					self.iterate(iterator,actions);
				}
				// single element implementation
				else {
					returnValue = wigiiApi.str2float(self.getValue());
				}
				return returnValue;
			};
			/**
			 * Gets the DB value of the field if known, else returns the translated value
			 * @returns String|Array the field db value or an array of field db value if FieldHelper is attached to a list
			 */
			self.getDbValue = function() {
				var returnValue = undefined;
				// list iteration
				if(self.list) {
					returnValue=[];
					var iterator = self.getIterator();
					var actions = function(){returnValue.push(iterator.getDbValue());};
					self.iterate(iterator,actions);
				}
				// single element implementation
				else {
					returnValue = self.$.find('div.value').attr('data-wigii-dbvalue');
					if(self.dataType()=='MultipleAttributs' && returnValue!='' && returnValue!=null) {
						returnValue = returnValue.split(',');
					}
					else if(returnValue == '' || returnValue==null) returnValue = self.getValue();					
				}
				return returnValue;
			};
			/**
			 * sum the numeric value of the fields
			 * @returns Float the numeric field value or an array of numeric field value if FieldHelper is attached to a list
			 */
			self.sum = function() {
				var returnValue = 0;
				self.forEachField(function(fh){
					returnValue += fh.getNumValue();
				});
				return returnValue;
			};

			/**
			 * update the value of the numeric field to a ceiled value
			 * @param Float number up to the number. IE: ceilTo(0.05) returns 10.35 if field value is 10.34
			 * @return Float value of the field after ceiling
			 */
			self.ceilTo = function (number, fixed){
				var returnValue = undefined;
				// list iteration
				if(self.list) {
					returnValue=[];
					var iterator = self.getIterator();
					var actions = function(){returnValue.push(iterator.ceilTo(number, fixed));};
					self.iterate(iterator,actions);
				}
				// single element implementation
				else {
					self.setNumValue(wigiiApi.ceilTo(self.getNumValue(), number, fixed));
					returnValue = self.getNumValue();
				}
				return returnValue;
			};
			
			/**
			 * Gets the value of a field
			 * @param String subFieldName optional subfield name. If not defined, takes default 'value' subfield 
			 * @returns String|Array the field value or an array of field value if FieldHelper is attached to a list
			 */
			self.value = function(subFieldName) {return self.getValue(subFieldName);};
			
			/**
			 * Returns the ID of the field
			 * @return String|Array the field ID or an array of field IDs if FieldHelper is attached to a list
			 */
			self.fieldId = function() {
				var returnValue = undefined;
				// list iteration
				if(self.list) {
					returnValue=[];
					var iterator = self.getIterator();
					var actions = function(){returnValue.push(iterator.fieldId());};
					self.iterate(iterator,actions);
				}
				// single element implementation
				else {
					if(self.context) returnValue = self.context.fieldId;
				}
				return returnValue;
			};
			
			/**
			 * Returns the name of the field
			 * @return String|Array the field name or an array of field names if FieldHelper is attached to a list
			 */
			self.fieldName = function() {
				var returnValue = undefined;
				// list iteration
				if(self.list) {
					returnValue=[];
					var iterator = self.getIterator();
					var actions = function(){returnValue.push(iterator.fieldName());};
					self.iterate(iterator,actions);
				}
				// single element implementation
				else {
					if(self.context) returnValue = self.context.fieldName;
				}
				return returnValue;
			};
			
			/**
			 * Returns the ID of the form containing the field
			 * @return String|Array the form ID or an array of form IDs if FieldHelper is attached to a list
			 */
			self.formId = function() {
				var returnValue = undefined;
				// list iteration
				if(self.list) {
					returnValue=[];
					var iterator = self.getIterator();
					var actions = function(){returnValue.push(iterator.formId());};
					self.iterate(iterator,actions);
				}
				// single element implementation
				else {
					if(self.context) returnValue = self.context.formId;
				}
				return returnValue;
			};
			
			/**
			 * Returns the name of the Wigii data type of the field
			 * @return String|Array the data type name or an array of data type names if FieldHelper is attached to a list
			 */
			self.dataType = function() {
				var returnValue = undefined;
				// list iteration
				if(self.list) {
					returnValue=[];
					var iterator = self.getIterator();
					var actions = function(){returnValue.push(iterator.dataType());};
					self.iterate(iterator,actions);
				}
				// single element implementation
				else {
					if(self.context) returnValue = self.context.dataType;
				}
				return returnValue;
			};					
			
			/**
			 * Returns the FormHelper containing this field
			 */
			self.formHelper = function() {
				var id = self.formId();
				// extracts form id from array if multiple selection
				if($.type(id) === 'array') {
					if(id.length>1) {
						id = wigii('ArrayHelper',id).filterDuplicates().array();
						if(id.length>1) throw wigiiApi.createServiceException('FieldHelper is currently attached to a set of fields not belonging to same Wigii Form, cannot create FormHelper', wigiiApi.errorCodes.INVALID_STATE);
					}
					else if(id.length== 0) id=undefined;
					else id = id[0];
				}
				// gets FormHelper
				if(id) {
					return $('#'+id).wigii('FormHelper');
				}
			};
			
			// Event handling
			
			/**
			 * Registers a handler for FormEvent
			 * @param Function eventHandler FormEvent event handler function
			 * @param Object options a map of filters options for the eventHandler
			 * {eventName=array,fieldName=array,subFieldName=array,dataType=array}
			 */
			self.onFormEvent = function(eventHandler,options) {
				// list iteration
				if(self.list) {
					var iterator = self.getIterator();
					var actions = function(){iterator.onFormEvent(eventHandler,options);};
					self.iterate(iterator,actions);
				}
				// single element implementation
				else if(self.context) {
					if(!self.context.formEventSubscribers) {
						self.context.formEventSubscribers = [];
						// creates jQuery events handler
						var fieldId = self.fieldId();						
						var jQueryEventHandler = function(eventObject) {
							var e = $(this);
							var fh = $('#'+fieldId).wigii('FieldHelper');
							if(fh.context && fh.context.formEventSubscribers) {								
								var formId = fh.formId();
								var fieldName = fh.fieldName();
								// extracts eventName
								var eventName = eventObject.type;
								if(eventName == 'select2:open') eventName = 'focus';
								else if(eventName == 'select2:close') eventName = 'blur';
								// creates FormEvent
								var formEvent = wigiiApi.createFormEventInstance(eventName, formId, fieldId, fieldName);
								// extracts dataType
								var dataType = fh.dataType();
								formEvent.dataType(dataType);
								// extracts subFieldName
								var subFieldName = e.attr('id');
								subFieldName = subFieldName.replace(formId+'_'+fieldName+'_','');
								subFieldName = subFieldName.split('_');
								// specific Addresses::zip_code handling								
								subFieldName = subFieldName[0];
								if(dataType==='Addresses' && subFieldName == 'zip') subFieldName = 'zip_code';
								formEvent.subFieldName(subFieldName);
								// extracts value
								formEvent.value(e.val());
								// forwards event to all subscribers
								var subscribers = fh.context.formEventSubscribers;
								for(var i=0;i<subscribers.length;i++) {
									var formEventHandler = subscribers[i];
									if(formEventHandler) {										
										var trigger = true;
										var opts = formEventHandler.options;
										// filter event if needed
										if(opts) {
											if(opts.eventName && opts.eventName.indexOf(formEvent.eventName())===-1) trigger=false;
											if(opts.fieldName && opts.fieldName.indexOf(formEvent.fieldName())===-1) trigger=false;
											if(opts.subFieldName && opts.subFieldName.indexOf(formEvent.subFieldName())===-1) trigger=false;
											if(opts.dataType && opts.dataType.indexOf(formEvent.dataType())===-1) trigger=false;
										}
										formEventHandler = formEventHandler.eventHandler;
										if($.type(formEventHandler) === 'function' && trigger) formEventHandler(formEvent);
									}									
								}								
							}
						};
						// activates event listening
						$('#'+fieldId+' div.value').find('input,select,textarea').filter('[id^="'+self.formId()+'_'+self.fieldName()+'"]').on('change input focus blur select2:open select2:close',jQueryEventHandler);
					}
					self.context.formEventSubscribers.push({eventHandler:eventHandler,options:options});
				}
				return self;
			};	
			
			/**
			 * bind/trigger change on the field
			 */
			self.change = function(eventHandler){
				// list iteration
				if(self.list) {
					var iterator = self.getIterator();
					var actions = function(){ iterator.change(eventHandler);};
					self.iterate(iterator,actions);
				}
				// single element implementation
				else if(self.context) {
					if(eventHandler==undefined){
						return $('#'+self.fieldId()+' :input').change();
					}
					return $('#'+self.fieldId()+' :input').change(eventHandler);
				}
			}
			
		});
		
		ncddoc(function(){/**
		 * Wigii Form helper.
		 * A class which helps manage form lifecycle.
		*/},
		wigiiApi.FormHelper = function() {
			var self = this;
			self.className = 'FormHelper';
			self.ctxKey = wigiiApi.ctxKey+'_'+self.className;
			//self.debugLogger = wigiiApi.getDebugLogger(self.className);
			
			
			// Object lifecycle
			
			/**
			 * Binds the FormHelper instance to a Wigii Form (detail,edit,copy,add)Field or set of Fields selected with JQuery
			 * @param JQuery wigiiForm the Wigii Form DOM element to which attach the FormHelper instance
			 * @param Object options a map of configuration options for the FormHelper
			 */
			self.attach = function(wigiiForm,options) {
				if(!wigiiForm || wigiiForm.length == 0) return;
				// does not support more than one element selected
				if(wigiiForm.length>1) throw wigiiApi.createServiceException('Wigii FormHelper selector can only be activated on a JQuery collection containing one element and not '+selection.length, wigiiApi.errorCodes.INVALID_ARGUMENT); 
				// retrieves context
				self.context = wigiiForm.data(self.ctxKey);
				if(!self.context) {
					// creates context if not existing
					self.context = {}; /* here options could be used. */
					wigiiForm.data(self.ctxKey,self.context);
					
					// extracts Wigii form info and puts into context
					self.context.formId = wigiiForm.attr('id');								
				}
				self.$ = wigiiForm;					
			};
			
			// FormHelper functional implementation
			
			/**
			 * Returns the ID of the form
			 * @return String the form ID
			 */
			self.formId = function() {
				if(self.context) return self.context.formId;
			};
			
			/**
			 * Returns the ID of the current element
			 * @return String the element ID
			 */
			self.elementId = function() {
				var sel = $('#elementDialog div.T');
				var elementId = '';
				if(sel.length>0) elementId=sel.attr('href').replace('#','');
				if(elementId=='') {
					sel = self.$.find('input[name=elementId]');
					if(sel.length>0) elementId = sel.val();
				}
				return elementId;
			};
			
			/**
			 * Returns if current element has the modify button active
			 * @return Boolean
			 */
			self.elementIsEditable = function() {
				var sel = $('#elementDialog div.T div.el_edit:visible');
				if(sel.length>0){
					if(!sel.attr('disabled')){
						return true;
					}
				}
				return false;
			};
			
			/**
			 * Returns the ID of the current group
			 * @return String the current group ID
			 */
			self.currentGroupId = function() {
				currentFolder = $('#groupPanel li.selected');
				if(currentFolder.length>0) currentFolder = currentFolder.attr('id').split('_')[1];
				else currentFolder = undefined;
				return currentFolder;
			}
			
			/**
			 * Returns the ID of the current group if group can be written
			 * @return String the current group ID
			 */
			self.writableCurrentGroupId = function() {
				currentFolder = $('#groupPanel li.selected.write');
				if(currentFolder.length>0) currentFolder = currentFolder.attr('id').split('_')[1];
				else currentFolder = undefined;
				return currentFolder;
			}
			
			/**
			 * Selects a field in the Wigii Form and returns a FieldHelper on it (or undefined if not found)
			 * @param String fieldName the field selector
			 * @return FieldHelper the FieldHelper instance attached to the selected field or undefined if not found
			 */
			self.field = function(fieldName) {
				var returnValue = undefined;
				if($.isArray(fieldName)){
					returnValue = self.fields(fieldName);
				} else if(fieldName) {
					returnValue = $('#'+self.formId()+'__'+fieldName).wigii('FieldHelper');
				}
				return returnValue;
			};
			
			/**
			 * Selects a field in the Wigii Form and returns a JQuery pointer on its input element
			 * @param String fieldName the field selector
			 * @return JQuery jquery collection on the selected fields input
			 */
			self.fieldInput = function(fieldName) {
				var returnValue = undefined;
				if($.isArray(fieldName)){
					var fieldSelector = '#'+self.formId()+'__';
					returnValue = $(fieldSelector+fieldName.join(' :input, '+fieldSelector)+' :input');
				} else if(fieldName) {
					returnValue = $('#'+self.formId()+'__'+fieldName+' :input');
				}
				return returnValue;
			};

			/**
			 * Returns a selection of fields in the Wigii Form			 
			 * @param String|Array selector JQuery or array of fieldNames, to filter the Fields of the form (for instance based on data-wigii-datatype or other attribute). If not defined, takes all the Fields.
			 * @return FieldHelper an instance of FieldHelper attached to the selected list of Fields.
			 */
			self.fields = function(selector) {
				if($.isArray(selector)){
					return self.fields('#'+self.formId()+'__'+selector.join(', #'+self.formId()+'__'));
				} else if(selector) return self.$.find('div.field[data-wigii-datatype]').filter(selector).wigii('FieldHelper');
				else return self.$.find('div.field[data-wigii-datatype]').wigii('FieldHelper');
			};
			
			/**
			 * Get/Set wigii field value
			 * @param String fieldName the field selector
			 * @param Mixed value for the field : optional, use '' to empty the field value
			 * @param String subFieldName optional the subFieldName
			 * @return Mixed value of the field
			 */
			self.val = function (fieldName, value, subFieldName){
				if(value!=undefined){
					self.field(fieldName).setValue(value, subFieldName);
				}
				return self.field(fieldName).getValue(subFieldName);
			};
			/**
			 * Get/Set wigii numeric field value
			 * @param String fieldName the field selector
			 * @param Float value for the field : optional
			 * @return Float value of the field
			 */
			self.numVal = function (fieldName, value){
				if(value!=undefined){
					self.field(fieldName).setNumValue(value);
				}
				return self.field(fieldName).getNumValue();
			};
			/**
			 * Get wigii field db value
			 * @param String fieldName the field selector
			 * @return String db value of the field
			 */
			self.dbVal = function (fieldName){
				return self.field(fieldName).getDbValue();
			};
			
			/**
			 * update the value of a wigii numeric field to a ceiled value
			 * @param String fieldName the field selector
			 * @param Float number up to the number. IE: ceilTo(fieldName, 0.05) returns 10.35 if field value is 10.34
			 * @return Float value of the field after ceiling
			 */
			self.ceilTo = function (fieldName, number, fixed){
				return self.field(fieldName).ceilTo(number, fixed);
			};
			
			/**
			 * Copies a set of fields, inserts them into the DOM and renames them.
			 * @param Array fromFields the array of field names to copy
			 * @param Array toFields the array of copied field names
			 * @param JQuery|String beforeTarget optional jQuery selector before which to insert the copied fields. 
			 * If not defined, the copied fields are appended to the end of the parent element.
			 * @example copyFields(['articleNumber_1,label_1,quantity_1'],['articleNumber_2,label_2,quantity_2'])
			 * @return FieldHelper a FieldHelper instance centered on the copied fields
			 */
			self.copyFields = function(fromFields,toFields,beforeTarget) {
				var i = 0;				
				if(!$.isArray(toFields)) toFields = [toFields];
				// iterates on the selected fields
				self.fields(fromFields).forEachField(function(field){
					var fieldHtml = field.$[0].outerHTML;
					// replaces current field name by new field name (in every reference
					fieldHtml = fieldHtml.replace(new RegExp(field.fieldName(),'g'),toFields[i]);
					// insert html
					if(beforeTarget==undefined) field.$.parent().append(fieldHtml);
					else field.formHelper().$.insertBefore(beforeTarget);
					// binds js events on new field
					var newField = field.formHelper().field(toFields[i])
					newField.$.find('.select2, .cke').remove();					
					addJsCodeAfterFormIsShown('#'+newField.fieldId());
					i++;
				});
				if(i>0) return self.fields(toFields);
			};
			
			/**
			 * Returns a wigiiApi.ButtonHelper on the selected button in form.
			 * @param String name button name. If selector is not given, then looks for button.name or div.name or span.name.
			 * @param String selector any valid JQuery selector used to select the button
			 * @return wigiiApi.ButtonHelper
			 */
			self.button = function(name,selector) {
				if(!self.context.buttons) self.context.buttons = {};
				if(!self.context.buttons[name]) {
					var btn = undefined;
					if(selector) btn = self.$.find(selector);
					else {
						btn = self.$.find('button.'+name);
						if(btn.length==0) btn = self.$.find('div.'+name);
						if(btn.length==0) btn = self.$.find('span.'+name);
					}
					self.context.buttons[name] = btn.wigii('ButtonHelper');
				}
				return self.context.buttons[name];
			};
			
			/**
			 * Returns a ButtonHelper centered on the form OK button
			 * @return wigiiApi.ButtonHelper
			 */
			self.ok = function() {
				if(!self.context.buttons) self.context.buttons = {};
				if(!self.context.buttons['ok']) {					
					var btn = undefined;
					if(isWorkzoneViewDocked()) btn = $('#elementDialog button.ok');
					else btn = $('#elementDialog').parent().find('button.ok');					
					self.context.buttons['ok'] = btn.wigii('ButtonHelper');
				}
				return self.context.buttons['ok'];
			};
			
			/**
			 * Returns a ButtonHelper centered on the form OK button
			 * @return wigiiApi.ButtonHelper
			 */
			self.cancel = function() {
				if(!self.context.buttons) self.context.buttons = {};
				if(!self.context.buttons['cancel']) {					
					var btn = undefined;
					if(self.formId()=='detailElement_form') {
						if(isWorkzoneViewDocked()) btn = $('#elementDialog div.T .el_closeDetails');
						else btn = $('#elementDialog').parent().find('button.ui-dialog-titlebar-close');
					}
					else {
						if(isWorkzoneViewDocked()) btn = $('#elementDialog button.cancel');
						else btn = $('#elementDialog').parent().find('button.cancel');
					}
					self.context.buttons['cancel'] = btn.wigii('ButtonHelper');
				}
				return self.context.buttons['cancel'];
			};
			
			/**
			 * Gets or sets element dialog title
			 */
			self.title = function(title) {
				if(title===undefined) {
					if(!isWorkzoneViewDocked()) return $('#elementDialog').parent().find('.ui-dialog-title').html();
				}
				else {
					if(!isWorkzoneViewDocked()) {
						$('#elementDialog').parent().find('.ui-dialog-title').html(title);
					}
					return self;
				}
			};
			
			/**
			 * Returns a ButtonHelper on a standard Wigii toolbar or creates a new custom button
			 * @param String name the name of the standard Wigii tool like 'edit','copy','status','organize','delete','feedback','link' or 'sendLink','print' or 'printDetails'
			 * or a new custom tool name (without any space)
			 * @example wigii().form().tool('createInvoice').label("Créer facture").click(function(){...}).$.css("background-color","green")
			 * will create a new custom tool "el_createInvoice" with label "Créer facture" and custom on click function and css
			 * @return wigiiApi.ButtonHelper only if current form is an element detail.
			 */
			self.tool = function(name) {
				if(self.formId()!='detailElement_form') throw wigiiApi.createServiceException("Standard Wigii toolbar is available only on element detail", wigiiApi.errorCodes.UNSUPPORTED_OPERATION);
				if(!self.context.buttons) self.context.buttons = {};
				if(!self.context.buttons[name]) {					
					var btn = undefined;
					var mappedName = name;
					if(name=='link') mappedName = 'sendLink';
					if(name=='print') mappedName = 'printDetails';
					if(isWorkzoneViewDocked()) btn = $('#elementDialog div.T .el_'+mappedName);
					else {
						btn = $('#elementDialog div.T .el_'+mappedName);
						if(btn.length==0) btn = $('#elementDialog').parent().find('div.ui-dialog-titlebar .el_'+mappedName);
					}
					// creates button if it does not exist
					if(btn.length==0) {
						$('#elementDialog div.T > div').last().after('<div class="H el_'+mappedName+'"></div>');
						btn = $('#elementDialog div.T .el_'+mappedName);
					}
					self.context.buttons[name] = btn.wigii('ButtonHelper');
				}
				return self.context.buttons[name];
			};
			
			/**
			 * Launches a custom copy process
			 * @param String dialogTitle custom organize dialog title (defaults to "Copy into folder")
			 * @param String dialogIntro custom instruction displayed before the group panel
			 * @param Object|Array|String urlArgs or an object with some (key,value) pairs, or an array of values, or a single string.
			 * @param int defaultGroupId a group ID to select by default in the organize dialog before launching the copy process 
			 */
			self.launchCopy = function(dialogTitle,dialogIntro,urlArgs,defaultGroupId) {
				var startUrl = 'elementDialog/'+crtWigiiNamespaceUrl+'/'+crtModuleName;
				var targetFolder = defaultGroupId;
				if(targetFolder===undefined) {
					targetFolder = $('#groupPanel li.selected.write');
					if(targetFolder.length>0) targetFolder = targetFolder.attr('id').split('_')[1];
					else targetFolder = undefined;
				}				
				var initialFolder = targetFolder;
				var itemID = self.elementId();
				if(urlArgs) urlArgs = '/'+wigiiApi.buildUrlFragment(urlArgs);
				prepareOrganizeDialog(
					//on click
					function(e){
						if(!$(this).hasClass('disabled')){
							$('#organizeDialog .selected').removeClass('selected');
							$(this).toggleClass('selected');
							targetFolder = $(this).parent().attr('id').split('_')[1];
						}
						return false;
					}, 
					//on Ok
					function(){
						if(!targetFolder) {
							jAlert(DIALOG_selectAtLeastOneGroup);
							return false;
						}
						if( $('#organizeDialog').is(':ui-dialog')) { $('#organizeDialog').dialog("destroy"); }			
						// opens copy dialog
						// if folder changed, then navigates to new folder
						invalidCache("moduleView");
						if(targetFolder != initialFolder) startUrl = 'NoAnswer/'+crtWigiiNamespaceUrl+'/'+crtModuleName+'/groupSelectorPanel/selectGroup/'+targetFolder+EXEC_requestSeparator+startUrl;
						update(startUrl+'/element/copy/'+itemID+'/'+targetFolder+urlArgs);
					});
				$('#organizeDialog').prev().find('.ui-dialog-title').text(dialogTitle||DIALOG_copyToFolder);
				$('#organizeDialog').prepend('<div class="introduction">'+(dialogIntro||DIALOG_copyToFolder_help)+'</div>');
				
				//disables read only groups
				$('#organizeDialog>.groupPanel li:not(.write)').addClass("disabled noRights");
				$('#organizeDialog>.groupPanel li:not(.write)>div').addClass("disabled noRights");
				if(targetFolder) $('#organizeDialog>.groupPanel #group_'+targetFolder+', #organizeDialog>.groupPanel #group_'+targetFolder+'>div').addClass('selected');
				unfoldToSelectedGroupButNotChildren('#organizeDialog>.groupPanel');
				positionSelectedGroup('#organizeDialog>.groupPanel');	
				if(targetFolder) {		
					// sets focus on OK button to manage pressing enter to copy directly in current folder
					$('#organizeDialog').next().find('button.ok').focus();
				}	
			};
			
			// Event handling
			
			/**
			 * Registers a handler for FormEvent
			 * @param Function eventHandler FormEvent event handler function
			 * @param Object options a map of filters options for the eventHandler
			 * {eventName=array,fieldName=array,subFieldName=array,dataType=array}
			 */
			self.onFormEvent = function(eventHandler,options) {
				if(self.context) {
					if(!self.context.formEventSubscribers) {
						self.context.formEventSubscribers = [];		
						// FormHelper subscribes to events from all contained FieldHelpers
						self.fields().onFormEvent(function(formEvent){
							var fh = $('#'+formEvent.formId()).wigii('FormHelper');
							// pushes event to all subscribers
							if(fh.context && fh.context.formEventSubscribers) {
								var subscribers = fh.context.formEventSubscribers;
								for(var i=0;i<subscribers.length;i++) {
									var formEventHandler = subscribers[i];
									if(formEventHandler) {										
										var trigger = true;
										var opts = formEventHandler.options;
										// filter event if needed
										if(opts) {
											if(opts.eventName && opts.eventName.indexOf(formEvent.eventName())===-1) trigger=false;
											if(opts.fieldName && opts.fieldName.indexOf(formEvent.fieldName())===-1) trigger=false;
											if(opts.subFieldName && opts.subFieldName.indexOf(formEvent.subFieldName())===-1) trigger=false;
											if(opts.dataType && opts.dataType.indexOf(formEvent.dataType())===-1) trigger=false;
										}
										formEventHandler = formEventHandler.eventHandler;
										if($.type(formEventHandler) === 'function' && trigger) formEventHandler(formEvent);
									}	
								}
							}
						});
					}
					self.context.formEventSubscribers.push({eventHandler:eventHandler,options:options});
				}
				return self;
			};		
			
			/**
			 * Check if an help popup is show, if a popup is display hide it and place the popup in context helpPopup 
			 * @param Event popup 
			 */
			self.onHelpPopupShow = function(popup) {
				// onHelpPopupShow(popup)
				// if(self.context.helpPopup) self.context.helpPopup.hide(); self.context.helpPopup=popup;
				if(self.context.helpPopup) {
					self.context.helpPopup.hide();
					if(self.context.helpPopup!==popup)
						self.context.helpPopup=popup;
				} else {
					self.context.helpPopup=popup;
				}
			};
			
			/**
			 * Check if the context helpPopup equal to popup event and unasign it
			 * @param Event popup
			 */
			self.onHelpPopupHide = function(popup) {
				// onHelpPopupHide(popup)
				// if(self.context.helpPopup===popup) self.context.helpPopup=undefined;
				if(self.context.helpPopup===popup) 
					self.context.helpPopup=undefined;
			};
		});
		
		ncddoc(function(){/**
		 * Wigii Button helper.
		 * A class which helps manage button lifecycle.
		 * This helper works with any elements acting logically as a button.
		*/},
		wigiiApi.ButtonHelper = function(btn,options) {
			var self = this;
			self.className = 'ButtonHelper';
			self.ctxKey = wigiiApi.ctxKey+'_'+self.className;
			//self.debugLogger = wigiiApi.getDebugLogger(self.className);
			
			self.$ = btn;
			self.label = function(l) {
				if(l===undefined) return self.$.html();
				else {
					self.$.html(l);
					return self;
				}
			};
			self.click = function(eventHandler) {
				if($.isFunction(eventHandler)) self.$.click(eventHandler);
				else self.$.click();
				return self;
			};
			self.disabled = function(bool) {
				if(bool===undefined) return self.$.prop('disabled');
				else {
					self.$.prop('disabled',(bool==true));
					return self;
				}
			}
		});
		
		ncddoc(function(){/**
		 * WNCD container instance
		*/},
		wigiiApi.WncdContainer = function(wncd) {
			var self = this;
			self.className = 'WncdContainer';
			self.ctxKey = wigiiApi.ctxKey+'_'+self.className;	
			//self.debugLogger = wigiiApi.getDebugLogger(self.className);
			self.impl = {
				onDataChangeSubscribers:undefined,
				onElementDeletedSubscribers:undefined
			};
			/**
			 * Resets the current WncdContainer
			 * This method is called each time the moduleView is repainted from scratch.
			 */
			self.reset = function() {
				self.impl.onDataChangeSubscribers=undefined;
				self.impl.onElementDeletedSubscribers=undefined;
			};
			
			/**
			 * Returns Wigii ElementPList JSON data model linked to current WNCD view
			 * @return Object module view object model as specified in https://resource.wigii.org/#Public/Documentation/item/2075
			 */
			self.getWigiiDataModel = function() {
				if(!wncd) throw wigiiApi.createServiceException("wncd libraries have not been correctly loaded, wncd symbol is not available.", wigiiApi.errorCodes.UNSUPPORTED_OPERATION);
				return wncd.program.context[wigiiApi.context.crtView];
			};
			
			/**
			 * Registers an event handler on the Wigii data model changes
			 * or triggers a dataChange event.
			 * The event handler signature is of the form eventHandler(wncdContainer,wigiiDataModel).
			 * @return wigiiApi.WncdContainer for chaining
			 */
			self.dataChange = function(onDataChange) {
				if($.isFunction(onDataChange)) {
					if(!self.impl.onDataChangeSubscribers) {
						self.impl.onDataChangeSubscribers = [];
					}
					self.impl.onDataChangeSubscribers.push(onDataChange);
				}
				else if(onDataChange===undefined) {
					if(self.impl.onDataChangeSubscribers) {
						var dataModel = self.getWigiiDataModel();
						for(var i=0;i<self.impl.onDataChangeSubscribers.length;i++) {
							var eh = self.impl.onDataChangeSubscribers[i];
							if($.isFunction(eh)) eh(self,dataModel);
						}
					}
				}
				return self;
			};
			
			/**
			 * Iterates through each element in current data model.
			 * On each element calls the given callback of the form callback(index,elementId, element)
			 * @return wigiiApi.WncdContainer for chaining
			 */
			self.forEachElement = function(callback) {
				self.iterateOnElementList(self.getWigiiDataModel(),callback);
				return self;
			};
			
			/**
			 * Iterates through each element in the given data model.
			 * On each element calls the given callback of the form callback(index,elementId, element)
			 * @return wigiiApi.WncdContainer for chaining
			 */
			self.iterateOnElementList = function(wigiiDataModel,callback) {
				if(!wigiiDataModel) throw wigiiApi.createServiceException('wigiiDataModel cannot be null',wigiiApi.errorCode.INVALID_ARGUMENT);
				if(!$.isFunction(callback)) throw wigiiApi.createServiceException('callback should be a function of the form callback(index,elementId, element)',wigiiApi.errorCode.INVALID_ARGUMENT);
				var elementList = wigiiDataModel.elementList;
				if(elementList) {
					var index = 1;
					for(var eltId in elementList) {
						var element = elementList[eltId];
						callback(index,element.__element.id,element);
						index++;
					}
				}
			};	
			
			/**
			 * Shows the details of the element
			 */
			self.showElement = function(elementId) {
				update('elementDialog/'+crtWigiiNamespaceUrl+'/'+crtModuleName+'/element/detail/'+elementId);
			};
			
			/**
			 * Opens a Wigii Form to edit the element
			 */
			self.editElement = function(elementId) {
				update('elementDialog/'+crtWigiiNamespaceUrl+'/'+crtModuleName+'/element/edit/'+elementId);
			};
			
			/**
			 * Asks Wigii to delete the element
			 */
			self.deleteElement = function(elementId) {
				update('elementDialog/'+crtWigiiNamespaceUrl+'/'+crtModuleName+'/element/delete/'+elementId+'/elementDialog');
			};
			/**
			 * Registers an event handler when an element has been successfully deleted from Wigii
			 * The event handler signature is of the form eventHandler(wncdContainer,elementId).
			 * @return wigiiApi.WncdContainer for chaining
			 */
			self.elementDeleted = function(onElementDeleted) {
				if($.isFunction(onElementDeleted)) {
					if(!self.impl.onElementDeletedSubscribers) {
						self.impl.onElementDeletedSubscribers = [];
					}
					self.impl.onElementDeletedSubscribers.push(onElementDeleted);
				}
				else if(onElementDeleted) {						
					if(self.impl.onElementDeletedSubscribers) {
						var elementId = onElementDeleted;
						for(var i=0;i<self.impl.onElementDeletedSubscribers.length;i++) {
							var eh = self.impl.onElementDeletedSubscribers[i];
							if($.isFunction(eh)) eh(self,elementId);
						}
					}
				}
				return self;
			};
			
			/**
			 * Saves the value of an Element Field into the database.
			 * @param Int elementId id of the element to update
			 * @param String fieldName name of the field to update
			 * @param Object|String value value to be updated.
			 * To update subfields, an object with the subfields should be given.
			 * @param Object options an optional bag of options. The following options are supported:
			 * - onSuccessCallback: Function. A function to be called if save went well. Function signature is onSuccessCallback(fieldValue), where fieldValue is an object with all the Field subfields.
			 * - exceptionHandler: Function. A function which handles any thrown exception from server. Function signature is exceptionHandler(exception,context) where exception is Wigii API exception object of the form {name:string,code:int,message:string}
			 * and context is an object with some server context information of the form {request:string, wigiiNamespace:string, module:string, action:string, realUsername:string, username:string, principalNamespace:string, version:string}
			 * If exceptionHandler is not set, then exception is published through the wigii.publishException method.
			 * - silent: Boolean. If silent is true, then no exception handler is called if an error occurs.
			 * - noCalculation: Boolean. If true, then element calculated fields are not re-calculated. By default calculation is active.
			 * - noNotification: Boolean. If true, then Notifications are not sent out on field update. By default notifications are enabled following what is defined in configuration file.
			 */
			self.saveFieldValue = function(elementId,fieldName,value,options) {
				options = options || {};
				options.caller = 'saveFieldValue';
				// initializes autosave form
				var target = 'Wigii_'+self.className;					
				var autosaveForm = {
					'autoSaveFieldId':target,
					'autoSaveMesssageTargetId':target,
					'noCalculation':(options.noCalculation==true),
					'noNotification':(options.noNotification==true)
				};
				// puts field value
				if($.isPlainObject(value)) {
					for(var subField in value) {
						autosaveForm[fieldName+"_"+subField] = value[subField];
					}
				}
				else autosaveForm[fieldName+"_value"] = value;
				// call Wigii autosave method
				setVis('busyDiv', true);
				$.ajax({
					type:"POST",
					url: wigiiApi.buildUpdateUrl(target+'/'+crtWigiiNamespaceUrl+'/'+crtModuleName+'/autoSave/'+elementId+'/'+fieldName),
					data:autosaveForm,
					success: wigiiApi.buildUpdateCallback(options)
				});
			};
			/**
			 * JSON event handler
			 * @param Object object the JSON response already parsed into an object
			 */
			self.json = function(object,context) {
				// json callback with default error handling or on success callback
				if(context) {
					setVis('busyDiv', false);
					// extracts return data
					var exception = undefined;
					var exceptionContext = undefined;
					if($.isPlainObject(object)) {
						if(object.exception) {
							exception = object.exception;
							exceptionContext = object.context;
						}
					}
					// handles exceptions
					if(exception) {
						if(!context.silent) {
							if($.isFunction(context.exceptionHandler)) {
								context.exceptionHandler(exception,exceptionContext);
							}
							else wigiiApi.publishException(exception);
						}
					}
					// else handles success
					else if($.isFunction(context.onSuccessCallback)) {
						context.onSuccessCallback(object);
					}
				}					
				// else nothing to do.
			};
		});
		
		ncddoc(function(){/**
		 * HTML String builder
		*/},
		wigiiApi.HtmlBuilder = function() {
			var self = this;
			self.className = 'HtmlBuilder';
			self.ctxKey = wigiiApi.ctxKey+'_'+self.className;
			
			self.buffer = '';
			self.jsBuffer = [];
			
			/**
			 * Returns built html string
			 * @return String
			 */
			self.html = function() {
				return self.buffer;
			};
			/**
			 * Executes all the JS code stored into the buffer
			 * @return HtmlBuilder for chaining
			 */
			self.runJsCode = function() {
				for(var i=0;i<self.jsBuffer.length;i++) {
					var jsCode = self.jsBuffer[i];
					if($.isFunction(jsCode)) jsCode();
				}
				return self;
			};
			/**
			 * Resets the html builder to an empty buffer
			 * @return HtmlBuilder for chaining
			 */
			self.reset = function() {
				self.buffer = '';
				self.jsBuffer = [];
				return self;
			};
			/**
			 * Appends a string to current buffer
			 * @param String str the string to put into the buffer
			 * @return HtmlBuilder for chaining
			 */
			self.put = function(str) {
				if(str) self.buffer += str;
				return self;
			};
			/**
			 * Append a string to current buffer but replace any new line with a br tag
			 */
			self.putNl2Br = function(str) {
				if (typeof str === 'undefined' || str === null) {
					//nothing to do
				} else {
					self.buffer += (str + '').replace(/([^>\r\n]?)(\r\n|\n\r|\r|\n)/g, '$1' + '<br />' + '$2');					
				}
				return self;
			}
			/**
			 * Implodes some arguments with a separator and adds the string to the given buffer
			 * @param String sep the separator to be added between each arguments
			 * @return HtmlBuilder for chaining
			 */
			self.implode = function(sep) {
				if(arguments.length>1) {
					var i = 1;
					var result = '', value;
					while(i<arguments.length) {						
						value = arguments[i];
						if(value) {
							if(result) result += sep;
							result += value;
						}
						i++;
					}
					self.buffer += result;
				}
				return self;
			};
			/**
			 * Prepends a prefix to some content only if content is not null.
			 * @param String prefix the string prefix
			 * @param String str the content to put into the buffer prefixed if not null
			 * @return HtmlBuilder for chaining
			 */
			self.prepend = function(prefix,str) {
				if(str) self.buffer += prefix+str;
				return self;
			};
			/**
			 * Repeats an nbsp entity several times
			 * @return HtmlBuilder for chaining
			 */
			self.putNbsp = function(multiplier) {
				if(!multiplier) multiplier=1;
				for(var i=0;i<multiplier;i++) {
					self.buffer += '&nbsp;';
				}
				return self;
			};
			/**
			 * Puts a double quote entity in the buffer or around the string parameter
			 * @return HtmlBuilder for chaining
			 */
			self.putQuot = function(str) {
				if(str){
					self.buffer += '&quot;'+str+'&quot;';
				} else {
					self.buffer += '&quot;';
				}
				return self;
			};
			/**
			 * Puts an Amp entity in the buffer
			 * @return HtmlBuilder for chaining
			 */
			self.putAmp = function() {
				self.buffer += '&amp;';
				return self;
			};
			/**
			 * Puts a Lt entity in the buffer
			 * @return HtmlBuilder for chaining
			 */
			self.putLt = function() {
				self.buffer += '&lt;';
				return self;
			};
			/**
			 * Puts a Gt entity in the buffer
			 * @return HtmlBuilder for chaining
			 */
			self.putGt = function() {
				self.buffer += '&gt;';
				return self;
			};
			/**
			 * Puts an Apos entity in the buffer
			 * @return HtmlBuilder for chaining
			 */
			self.putApos = function() {
				self.buffer += '&apos;';
				return self;
			};
			/**
			 * Puts an HashTag character in the buffer
			 * @return HtmlBuilder for chaining
			 */
			self.putHashTag = function() {
				self.buffer += '#';
				return self;
			};
			/**
			 * Repeats a br tag several times
			 * @return HtmlBuilder for chaining
			 */
			self.putBrTag = function(multiplier) {
				if(!multiplier) multiplier=1;
				for(var i=0;i<multiplier;i++) {
					self.buffer += '<br />';
				}
				return self;
			};/**
			 * Repeats a br tag several times
			 * @return HtmlBuilder for chaining
			 */
			self.putBr = self.putBrTag;
			
			/**
			 * Creates an html open tag
			 * @param String tagName the name of the html tag, for example "div" or "p"
			 * @param String key an html attribute name, for example "class"
			 * @param String value an html attribute value, for example "ui-dialog"
			 * This function supports a variable number of arguments, 
			 * meaning that you can pass as many key,value as you need to set all html attributes.
			 * @return HtmlBuilder for chaining
			 */
			self.putStartTag = function(tagName) {
				if(!tagName) throw wigiiApi.createServiceException('putStartTag takes a non null tagName', wigiiApi.errorCodes.INVALID_ARGUMENT);
				self.buffer += '<'+tagName;
				if(arguments.length>1) {
					var i = 1;
					var key,value;
					while(i<arguments.length) {
						key = arguments[i];
						if(!key) throw wigiiApi.createServiceException('html attribute name cannot be null', wigiiApi.errorCodes.INVALID_ARGUMENT);
						i++;
						if(i<arguments.length) {
							value = arguments[i];
							i++;
						}
						else value = '';
						self.buffer += ' '+key+'="'+value+'"';
					}
				}
				self.buffer += '>';
				return self;
			};
			/**
			 * Creates an html close tag
			 * @param String tagName the name of the html tag to close, for example "div" or "p"
			 * @return HtmlBuilder for chaining
			 */
			self.putEndTag = function(tagName) {
				if(!tagName) throw wigiiApi.createServiceException('putEndTag takes a non null tagName', wigiiApi.errorCodes.INVALID_ARGUMENT);
				self.buffer += '</'+tagName+'>';
				return self;
			};			
			/**
			 * Creates an html document header 
			 * @return HtmlBuilder for chaining
			 */
			self.putHtmlHeader = function() {
				self.buffer += '<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">';
				return self;
			};
			/**
			 * Puts some JS code into the buffer waiting for execution
			 * @param Function|String actions the JS code to be executed. (a function with no arguments or a valid js code string).
			 * @returns HtmlBuilder for chaining
			 */
			self.putJsCode = function(actions) {
				var actionType = $.type(actions);
				if(actionType==='function') {
					self.jsBuffer.push(actionType);
				}
				else if(actionType==='string') {
					self.jsBuffer.push(function(){eval(actions);});
				}
				return self;
			};
			/**
			 * Adds the content of the given HtmlBuilder to the current HtmlBuilder
			 * @param HtmlBuilder htmlBuilder the HtmlBuilder instance from which to get the html string and waiting js code.
			 */
			self.putHtmlBuilder = function(htmlBuilder) {
				if(htmlBuilder) {
					// adds html
					self.put(htmlBuilder.html());
					// adds js code
					for(var i=0;i<htmlBuilder.jsBuffer.length;i++) {
						self.putJsCode(htmlBuilder.jsBuffer[i]);
					}
				}
				return self;
			};
		});
		
		ncddoc(function(){/**
		 * A helper on array of strings
		 * @param Array arr the array on which to perform some actions
		*/},
		wigiiApi.ArrayHelper = function(arr) {
			var self = this;
			self.className = 'ArrayHelper';
			self.ctxKey = wigiiApi.ctxKey+'_'+self.className;
			
			if($.type(arr) !== 'array') throw wigiiApi.createServiceException('arr should be an array', wigiiApi.errorCodes.INVALID_ARGUMENT);
			self.arr = arr;
			
			/**
			 * Clones the array 
			 * @return ArrayHelper for chaining
			 */
			self.clone = function() {
				self.arr = self.arr.slice();
				return self;
			};
			/**
			 * Sorts the array
			 * @param Boolean asc sort order, true=ascending,false=descending, defaults to true.
			 * @return ArrayHelper for chaining
			 */
			self.sort = function(asc) {
				if(asc!==false) asc = true;
				// ascending
				self.arr.sort();
				// descending
				if(!asc) self.arr.reverse();
				return self;
			};
			/**
			 * Filter duplicates in the array of strings
			 * @return ArrayHelper for chaining
			 */
			self.filterDuplicates = function() {
				var d = self.distribution();
				self.arr = [];
				for(var val in d) {
					self.arr.push(val);
				}
				return self;
			};
			/**
			 * Returns the distribution of the values in the array (counts the frequency of each single values)
			 * @return Object the distribution object {arrayValue=>frequency counter}
			 */
			self.distribution = function() {
				var d = {};						
				for(var i=0;i<self.arr.length;i++) {
					var val = self.arr[i];
					if(!val) val='';
					var c = d[val];
					if(c) c += 1;
					else c = 1;
					d[val] = c;
				}
				return d;
			};
			/**
			 * Returns the array
			 * @return Array
			 */
			self.array = function() {
				return self.arr;
			};
		});
		
		ncddoc(function(){/**
		 * A helper on an array of rows. A row is an array of values or an object with field names
		 * @param Array matrix the array on which to perform some actions
		 * @param Array selectedRows an optional array with a subset of selected row indexes. If defined, then the matrix helper will act only on these selected rows.
		*/},
		wigiiApi.MatrixHelper = function(matrix,selectedRows) {
			var self = this;
			self.className = 'MatrixHelper';
			self.ctxKey = wigiiApi.ctxKey+'_'+self.className;			
			if($.type(matrix) !== 'array') throw wigiiApi.createServiceException('matrix should be an array', wigiiApi.errorCodes.INVALID_ARGUMENT);
			self.matrix = matrix;
			self.selectedRows = selectedRows;
			self.currentFilter = [];
			self.next = undefined;
			self.previous = undefined;
			/**
			 * Selects rows matching a given value into a column and returns a MatrixHelper on the selection
			 * @param String|int col col index or name on which to apply the filter
			 * @param Scalar value value to filter on
			 * @example To filter more that one column at a time, just append (colI,valueI) pairs to the function arguments
			 * wigii().matrix([{project:"P1",grant:"G1",sector:"WASH"},{project:"P2",grant:"G1",sector:"NUT"},{project:"P1",grant:"G2",sector:"GEN"}])
			 * .filter("project","P1","sector","WASH").column("grant") = ["G1"]
			 * @return wigiiApi.MatrixHelper on filtered rows
			 */
			self.filter = function(col,value) {
				var matchingRows = [];
				if(self.selectedRows) {
					for(var i=0;i<self.selectedRows.length;i++) {
						if(value == self.matrix[self.selectedRows[i]][col]) matchingRows.push(self.selectedRows[i]);
					}
				}
				else {
					for(var i=0;i<self.matrix.length;i++) {
						if(value == self.matrix[i][col]) matchingRows.push(i);
					}
				}
				var returnValue = new wigiiApi.MatrixHelper(self.matrix,matchingRows);
				// saves current filter and links filters in chain
				returnValue.currentFilter = self.currentFilter.concat([col,value]);
				self.next = returnValue;
				returnValue.previous = self;
				
				// recursively call filter if more (col,value) pairs are defined
				var args;
				if(arguments.length > 2) args = Array.prototype.slice.call(arguments,2);
				else args = [];
				if(args.length>0) {
					returnValue = returnValue.filter.apply(returnValue,args);
				}
				
				return returnValue;
			};
			/**
			 * Returns an array with the content of a column filtered with the selected rows.
			 * @param String|int col col index or name from which to extract the values
			 * @param boolean unique if true, then filters duplicates and returns unique values, else returns all values
			 * @return Array
			 */
			self.column = function(col,unique) {
				var returnValue = (unique?{}:[]);
				if(self.selectedRows) {
					for(var i=0;i<self.selectedRows.length;i++) {
						var val = self.matrix[self.selectedRows[i]][col];
						if(unique) returnValue[val] = val;
						else returnValue.push(val);
					}
				}
				else {
					for(var i=0;i<self.matrix.length;i++) {
						var val = self.matrix[i][col];
						if(unique) returnValue[val] = val;
						else returnValue.push(val);
					}
				}
				return (unique?Object.keys(returnValue):returnValue);
			};
			/**
			 * Returns an array with the selected rows
			 * @return Array
			 */
			self.rows = function() {
				var returnValue = [];
				if(self.selectedRows) {
					for(var i=0;i<self.selectedRows.length;i++) {
						returnValue.push(self.matrix[self.selectedRows[i]]);
					}
				}
				else {
					for(var i=0;i<self.matrix.length;i++) {
						returnValue.push(self.matrix[i]);
					}
				}
				return returnValue;
			};	
			/**
			 * Clears the current selection and returns a MatrixHelper showing previous selection or all rows if no previous one
			 * @param String|int col optional column to define which column should be cleared. If not defined, takes current selection, which is last column.
			 * @return wigiiApi.MatrixHelper
			 */
			self.clear = function(col) {
				var returnValue = undefined;
				if(col!==undefined && self.currentFilter.length>2 && self.currentFilter[self.currentFilter.length-3]!=col) {
					var newSelection = [];
					var i=0;
					while(i<self.currentFilter.length) {
						if(self.currentFilter[i]!=col) {
							newSelection.push(self.currentFilter[i]);
							newSelection.push(self.currentFilter[i+1]);
						}						
						i+=2;
					}
					returnValue = new wigiiApi.MatrixHelper(self.matrix);
					if(newSelection.length>0) returnValue = returnValue.filter.apply(newSelection);
				}
				else if(self.previous) {
					self.previous.next = undefined;
					returnValue = self.previous;
					self.previous = undefined;
				}
				else returnValue = new wigiiApi.MatrixHelper(self.matrix);
				return returnValue;
			};
			/**
			 * Clears all selections and returns a MatrixHelper showing all rows
			 * @return wigiiApi.MatrixHelper
			 */
			self.clearAll = function() {
				return new wigiiApi.MatrixHelper(self.matrix);
			};
		});
		
		ncddoc(function(){/**
		 * A constraint on a selected set of drop-downs.
		 * The drop-downs can only show values which are compatible with the given matrix.
		 * The matrix is a set of rows, each row is a vector giving one possible combination of values for the drop-downs.
		 * The order of the selected drop-downs must match the order of the columns in the rows, 
		 * or the drop-down field name must match a field name in the row.
		*/},
		wigiiApi.DropDownConstraint = function(selector,matrix) {
			var self = this;
			self.className = 'DropDownConstraint';
			self.ctxKey = wigiiApi.ctxKey+'_'+self.className;
			self.matrixHelper = wigiiApi.getMatrixHelper(matrix);
			self.lock=false;
			if(self.matrixHelper.matrix.length>0) {
				self.dropDowns = selector;
				// stores associated field names
				if($.type(self.matrixHelper.matrix[0])!=='array') {
					self.fieldNames = [];
					self.dropDowns.each(function(){
						self.fieldNames.push($(this).closest('div.field').wigii('FieldHelper').fieldName());
					});
				}
				// indexes current set of drop-downs values
				self.dropDownIndex = (self.fieldNames?{}:[]);
				self.dropDowns.each(function(){
					var dropDown = $(this);
					// retrieves matrix column associated to drop-down
					var col=self.dropDowns.index(dropDown);
					if(self.fieldNames) col = self.fieldNames[col];	
					// loops on all options and indexes them
					var options = {};					
					dropDown.find('option').each(function(){
						var option = $(this);
						var val = option.attr('value');
						if(val!=='' && val!==null) {
							options[val] = {
								'value':val,
								'title':option.attr('title'),
								'label':option.text()
							};
						}
					});
					self.dropDownIndex[col] = options;
				});
				// manages constraint on drop-down change
				self.dropDowns.change(function(){
					if(self.lock) return;
					self.lock=true;
					var dropDown = $(this);
					// retrieves matrix column associated to drop-down
					var col=self.dropDowns.index(dropDown);
					if(self.fieldNames) col = self.fieldNames[col];
					
					
					var newFilter = self.matrixHelper;
					var val = dropDown.val();
					// removes column from existing filter and adds column to new filter
					if(val!=='' && val!==null) {
						if(newFilter.currentFilter.length>0 && newFilter.currentFilter.indexOf(col)%2==0) newFilter = newFilter.clear(col);
						newFilter = newFilter.filter(col,val);
					}
					// if val is empty then clears all
					else newFilter = newFilter.clearAll();
					
					
					// builds each drop-down options based on new filter
					self.dropDowns.each(function(){
						var dropDown = $(this);
						var currentVal = dropDown.val();
						// retrieves matrix column associated to drop-down
						var col=self.dropDowns.index(dropDown);
						if(self.fieldNames) col = self.fieldNames[col];	
						// clears all current options
						dropDown.empty();
						// fills again the options based on new filtered column
						var colValues = newFilter.column(col,true);						
						var dropDownValues = self.dropDownIndex[col];
						var html = wigiiApi.getHtmlBuilder();
						dropDown.append(html.reset().putStartTag('option','value',"",'title',"").put("").putEndTag('option').html());
						var newVal = '';
						for(var i=0;i<colValues.length;i++) {
							var option = dropDownValues[colValues[i]];
							dropDown.append(html.reset().putStartTag('option','value',option.value,'title',option.title).put(option.label).putEndTag('option').html());
							if(currentVal==option.value) newVal = currentVal;
						}
						if(colValues.length==1) newVal = dropDownValues[colValues[0]].value;
						if(newFilter.currentFilter.length==0) newVal='';//resets everything if filter is reset
						dropDown.val(newVal).trigger('change');
					});
					self.matrixHelper = newFilter;
					self.lock=false;
				});
				// first load
				$(self.dropDowns[0]).trigger('change');
			}
		});
		
		ncddoc(function(){/**
		 * JQuery collection event handlers
		*/},
		wigiiApi.JQueryService = function() {
			var self = this;
			self.className = 'JQueryService';
			self.ctxKey = wigiiApi.ctxKey+'_'+self.className;	
			//self.debugLogger = wigiiApi.getDebugLogger(self.className);
			
			self.bindHelpService = function(selection,options) {				
				//self.debugLogger.logBeginOperation('bindHelpService');				
				var helpService = wigiiApi.getHelpService();
				var optionsFx = ($.type(options) === 'function');
				// finds closes div.value and ensures overflow is visible
				var visibleOverflowOnEnclosingValueDiv = function(startElt) {
					var valueDiv = startElt.closest('div.value, div.field');
					if(valueDiv.length > 0 && valueDiv.hasClass('value')) valueDiv.css('overflow','visible');
				}
				if(options && (options.content || optionsFx)) {			
					var contentFx = !optionsFx && ($.type(options.content) === 'function');
					selection.each(function(i){
						var e = $(this);						
						var content, opts;
						if(optionsFx) {
							opts = options(e); content = opts.content;
						}
						else {
							content = (contentFx?options.content(e):options.content);
							// clones the options
							opts = {};
							for(var attr in options) {
								opts[attr] = options[attr];
							}
						}			
						//self.debugLogger.write("index:"+i+", optionsFx:"+optionsFx+", contentFx:"+contentFx+", options:"+JSON.stringify(options));
						if(content) {
							helpService.renderHelpAnchor(e, content, opts);							
						}
					});
				}
				else {
					selection.each(function(i){
						var e = $(this);
						var content = undefined;
						var opts = {width:(e.attr("data-popup-width")?e.attr("data-popup-width"):400),
							height:(e.attr("data-popup-height")?e.attr("data-popup-height"):400),
							type:(e.attr("data-popup-type")?e.attr("data-popup-type"):'help'),
							position:(e.attr("data-popup-position")?e.attr("data-popup-position"):'SE')
						};						
						// case: div with localContent
						if(e.is("div.localContent")) {
							content = e.html();							
							opts.localContent = true;							
							e = e.parent().find("div.value");							
							if(content) {
								helpService.renderHelpAnchor(e, content, opts);							
							}							
						}			
						// case: div with remoteContent
						else if(e.is("div.remoteContent")) {
							content = e.text();/* remote content is an url, so retrieves it as text to avoid double coding of amperstands */							
							opts.localContent = false;							
							e = e.parent().find("div.value");							
							if(content) {
								helpService.renderHelpAnchor(e, content, opts);							
							}							
						}
						// case: div with json data containing remote content
						else if(e.is("div.json")) {
							content = e.html();
							if(content) {
								content = JSON.parse(content);
								if(!content['width']) content.width=opts.width;
								if(!content['height']) content.height=opts.height;
								if(!content['type']) content.type=opts.type;
								opts=content;
								e = e.parent().find("div.value");								
								if(opts.content) {
									helpService.renderHelpAnchor(e, opts.content, opts);							
								}	
							}													
						}
						// case: a with href
						else if(e.is("a")) {
							content = e.attr('href');
							opts.localContent = false;
							opts.domInsertionMode = 'after';
							e.hide();
							// if e is into a div.value, ensures overflow is visible
							visibleOverflowOnEnclosingValueDiv(e);
							if(content) {
								helpService.renderHelpAnchor(e, content, opts);							
							}
						}
						// case: span with localContent
						else if(e.is("span")) {
							content = e.html();
							opts.localContent = true;
							opts.domInsertionMode = 'after';
							e.hide();
							// if e is into a div.value, ensures overflow is visible
							visibleOverflowOnEnclosingValueDiv(e);
							if(content) {
								helpService.renderHelpAnchor(e, content, opts);							
							}
						}
					});					
				}
				//self.debugLogger.logEndOperation('bindHelpService');
			};	
			
			self.FieldHelper = function(selection,options) {
				//var ctxKey = self.ctxKey+"_FieldHelper";
				var returnValue=undefined;
				// filters on Fields				
				if(selection && selection.length>0) {
					selection = selection.filter('div.field');
					if(selection && selection.length>0) {
						returnValue = wigiiApi.getFieldHelper();
						returnValue.attach(selection, options);
					}
				}								
				return (!returnValue?{$:selection}:returnValue);
			};
			
			self.FormHelper = function(selection,options) {
				//var ctxKey = self.ctxKey+"_FormHelper";
				var returnValue=undefined;
				// checks we have only one element (no strict checking on Wigii form identity)				
				if(selection && selection.length==1) {
					returnValue = wigiiApi.getFormHelper();
					returnValue.attach(selection, options);
				}
				else if(selection && selection.length>1) throw wigiiApi.createServiceException('Wigii FormHelper selector can only be activated on a JQuery collection containing one element and not '+selection.length, wigiiApi.errorCodes.INVALID_ARGUMENT);
				return (!returnValue?{$:selection}:returnValue);
			};
			
			self.DropDownConstraint = function(selection,matrix) {
				//var ctxKey = self.ctxKey+"_DropDownConstraint";
				var returnValue=undefined;
				// filters on select objects				
				if(selection && selection.length>0) {
					selection = selection.filter('select');
					if(selection && selection.length>0) {
						returnValue = wigiiApi.createDropDownConstraint(selection,matrix);
					}
				}								
				return (!returnValue?{$:selection}:returnValue);
			};
			
			self.ButtonHelper = function(selection,options) {
				var returnValue=undefined;
				// checks we have at least one selected button like element	
				if(selection && selection.length>0) {
					returnValue = wigiiApi.createButtonHelper(selection,options);
				}
				return (!returnValue?{$:selection}:returnValue);
			};
			
			/**
			 * Fills a set of drop-downs given some options
			 * @param Object|Array options a bag of parameters of the form
			 * - arr|array: Array containing the values or objects used to populate the drop-down
			 * - val|value: String|Function the name of a field in the object to be used as a drop-down value or a callback function computing the drop-down values.
			 * The callback function is of the form value(i,data,selector) where i=0..array.length, data = array[i], selector is the given JQuery selector to access the DOM context.
			 * The function should return a scalar value used a the drop-down value.
			 * - lab|label String|Function the name of a field in the object to be used as a drop-down label or a callback function computing the drop-down labels.
			 * The callback function is of the form label(i,data,selector) where i=0..array.length, data = array[i], selector is the given JQuery selector to access the DOM context.
			 * The function should return a scalar value used a the drop-down label.
			 * If options is an array, then considers it as an array of values used to fill the drop-down.
			 * @return JQuery selector for chaining
			 */
			self.fillDropDown = function(selection,options) {
				var returnValue=undefined;
				// filters on select objects				
				if(selection && selection.length>0) {
					selection = selection.filter('select');
					if(selection && selection.length>0) {
						if($.isArray(options)) options = {arr:options};
						else if(!options) options = {};
						var arr = options.arr || options.array;
						var val = options.val || options.value;
						var lab = options.lab || options.label;
						selection.each(function(){
							var dropdown = $(this);
							wigiiApi.fillDropDownFromArray(dropdown,arr,val,lab,options);
						});
						returnValue = selection;
					}
				}								
				return (!returnValue?{$:selection}:returnValue);
			};
		});
		
		ncddoc(function(){/**
		 * DataFlowService javascript implementation
		*/},
		wigiiApi.DataFlowService = function() {
			var self = this;			
			self.className = 'DataFlowService';
			self.ctxKey = wigiiApi.ctxKey+'_'+self.className;
			
			/**
			 * Reads the data coming from the source and processes it through the selected flow activities
			 *@param Function source a data flow source function. 
			 * A data source function is a function which takes an open DataFlowContext in parameter and then calls processDataChunk as many times as needed.
			 * var rangeGen = function(from,to,step) { return function(dataFlowContext) {
			 *	for(var i=from;i<=to;i+=step) dataFlowContext.processDataChunk(i);
			 * }};
			 *@param Array activities an array of activity functions. An activity function is a function which receives the current chunk of data, 
			 * an activity context in which a processing state can be stored and the data flow context to get insight on the global state of the data flow beeing executed.
			 * var power = function(factor) { return function(data,activityCtx,dataFlowContext) {
			 * 		var returnValue = 1;
			 *		for(var i=0;i<factor;i++) returnValue *= data;
			 *		return returnValue;
			 * }};
			 * var sum = function(data,activityCtx,dataFlowContext) {
			 *	 switch(activityCtx.state) {
			 *	 	case dataFlowContext.DFA_STARTSTREAM: activityCtx.sum = 0; break;
			 *		case dataFlowContext.DFA_RUNNING: activityCtx.sum += data; break;
			 *		case dataFlowContext.DFA_ENDSTREAM: dataFlowContext.writeResultToOuput(activityCtx.sum,activityCtx); break;
			 *	 }	
			 * };
			 *@example wigii().getDataFlowService().processDataSource(rangeGen(-10,10,2),[power(3),sum])
			 *@return Any the data flow result
			 */
			self.processDataSource = function(source,activities) {
				var dfCtx = self.startStream(activities);
				source(dfCtx);
				return self.endStream(dfCtx);
			};
			
			/**
			 * Starts a new data flow stream
			 *@param Array activities an array functions describing the pipe of activities
			 *@return wigiiApi.DataFlowService.DataFlowContext a DataFlowContext instance referencing the open stream
			 */
			self.startStream = function(activities) {
				return new self.DataFlowContext(self, activities);
			};
			/**
			 * Processes a data chunk in the context of an open stream
			 *@param Any data chunk of data to be processed.
			 * Must be compatible with the first step of the pipe of activities
			 *@param wigiiApi.DataFlowService.DataFlowContext the reference to the current open stream
			 */
			self.processDataChunk = function(data,dataFlowContext) {
				if(!dataFlowContext.impl.dataFlow) throw wigiiApi.createServiceException('DataFlow is not running, call startStream to start it', wigiiApi.errorCodes.INVALID_STATE);
				// pushes data to first activity
				var dataFlowActivity = self.impl.getOpenedDataFlowActivityForStep(0,dataFlowContext);							
				dataFlowActivity.state = dataFlowContext.DFA_RUNNING;
				var result = dataFlowContext.activities[0](data,dataFlowActivity,dataFlowContext);
				if(result !== undefined) dataFlowContext.writeResultToOuput(result,dataFlowActivity);
			};
			/**
			 * Ends the current running data flow stream
			 * After the call of this method, the DataFlowContext is closed and any calls to processDataChunk will fail.			
			 *@param wigiiApi.DataFlowService.DataFlowContext the reference to the current open stream
			 *@return optionally returns some data if the last stage of the list of activities writes some output.
			 */
			self.endStream = function(dataFlowContext) {
				var returnValue = undefined;
				if(dataFlowContext.impl.dataFlow) {
					for(var stepId=0; stepId < dataFlowContext.activities.length; stepId++) {
						// if activity is open, 
						if(stepId < dataFlowContext.impl.dataFlow.length) {
							var dataFlowActivity = dataFlowContext.impl.dataFlow[stepId];
							// calls end stream on activity
							dataFlowActivity.state = dataFlowContext.DFA_ENDSTREAM;
							dataFlowContext.activities[stepId](undefined,dataFlowActivity,dataFlowContext);
							// flushes output buffer
							returnValue = self.impl.flushStepBufferIntoActivity(stepId,dataFlowContext);
						}
					}
					dataFlowContext.impl.dataFlow = undefined;
				}
				return returnValue;
			};
			
			/**
			 * An open data flow context for the given list of activities
			 */
			self.DataFlowContext = function(dataFlowService, activities) {
				var self = this;
				self.className = 'DataFlowContext';
				self.ctxKey = wigiiApi.ctxKey+'_'+self.className;
				self.impl = {dfS:dataFlowService,dataFlow:[]};
				
				/**
				 * Data Flow Activity state START OF STREAM
				 */
				self.DFA_STARTSTREAM = 1;
				/**
				 * Data Flow Activity state RUNNING
				 */
				self.DFA_RUNNING = 2;
				/**
				 * Data Flow Activity state END OF STREAM
				 */
				self.DFA_ENDSTREAM = 3;							
				
				// Accessors
				
				self.activities = activities;
				
				/**
				 * Returns a reference to the underlying DataFlow Service
				 */
				self.getDataFlowService = function() {return self.impl.dfS;};
				
				// Methods 
				
				/**
				 * Writes some data to the output data flow
				 * The underlying DataFlowService will process the data chunk and
				 * call if needed the next steps in the data flow chain.
				 * This method can be called as many times a needed.
				 * Each call results in one data chunk to be passed to the DataFlowService for further processing.
				 * @param Any resultData some result data, can be any kind of object
				 * @param wigiiApi.DataFlowService.DataFlowActivityContext the reference to the current executing dataflow activity
				 */
				self.writeResultToOuput = function(resultData,dataFlowActivityContext) {
					self.impl.dfS.impl.processResultFromActivity(resultData,dataFlowActivityContext);
				};		

				/**
				 * Shortcut on self.getDataFlowService().processDataChunk
				 * Pushes a data chunk at the beginning of the flow
				 */
				self.processDataChunk = function(data) {
					self.impl.dfS.processDataChunk(data,self);
				};
			};
			
			/**
			 * A running data flow activity context
			 */
			self.DataFlowActivityContext = function(stepId,dataFlowContext) {
				var self = this;
				self.className = 'DataFlowActivityContext';
				self.ctxKey = wigiiApi.ctxKey+'_'+self.className;
				self.impl = {dfCtx:dataFlowContext, stepBuffer:[]};
				/**
				 * The current executing step ID in this DataFlow
				 */
				self.stepId = stepId;
				/**
				 * The current state of this activity in this DataFlow. 
				 * One of DataFlowContext.DFA_STARTSTREAM, DataFlowContext.DFA_RUNNING, DataFlowContext.DFA_ENDSTREAM.
				 */
				self.state = undefined;
				/**
				 * True if the current step is the last step of the dataflow
				 * Or equivalently if no more DataFlowActivity is coming after the one which is currently executing
				 */
				self.isCurrentStepTheLastStep = (stepId==dataFlowContext.activities.length-1);
			};
			
			// Implementation
			
			self.impl = {};
			self.impl.processResultFromActivity = function(resultData,dataFlowActivityContext) {
				if(resultData !== undefined) {
					// if buffer is not empty, flushes it
					if(dataFlowActivityContext.impl.stepBuffer.length>0) self.impl.flushStepBufferIntoActivity(dataFlowActivityContext.stepId, dataFlowActivityContext.impl.dfCtx);
					// stores data in buffer
					dataFlowActivityContext.impl.stepBuffer.push(resultData);
				}
			};
			self.impl.getOpenedDataFlowActivityForStep = function(stepId,dataFlowContext) {
				var returnValue = undefined;
				// checks if current step is already running
				if(!dataFlowContext.impl.dataFlow) dataFlowContext.impl.dataFlow = [];
				if(stepId < dataFlowContext.impl.dataFlow.length) returnValue = dataFlowContext.impl.dataFlow[stepId];
				// if not, then creates it and starts the stream on it
				else {
					returnValue = new self.DataFlowActivityContext(stepId,dataFlowContext);
					dataFlowContext.impl.dataFlow.push(returnValue);
					returnValue.state = dataFlowContext.DFA_STARTSTREAM;
					dataFlowContext.activities[stepId](undefined,returnValue,dataFlowContext);
				}
				return returnValue;
			};
			self.impl.flushStepBufferIntoActivity = function(stepId,dataFlowContext) {
				if(!dataFlowContext.impl.dataFlow) throw wigiiApi.createServiceException('DataFlow is not running, call startStream to start it', wigiiApi.errorCodes.INVALID_STATE);
				if(stepId < dataFlowContext.impl.dataFlow.length) {
					var dataFlowActivity = dataFlowContext.impl.dataFlow[stepId];
					// flushes buffer in next activity if not last one.
					if(!dataFlowActivity.isCurrentStepTheLastStep) {
						var nextStepId = stepId+1;
						while(dataFlowActivity.impl.stepBuffer.length>0) {
							var data = dataFlowActivity.impl.stepBuffer.shift();							
							var nextActivityContext = self.impl.getOpenedDataFlowActivityForStep(nextStepId,dataFlowContext);
							// pushes data to next activity
							nextActivityContext.state = dataFlowContext.DFA_RUNNING;
							var result = dataFlowContext.activities[nextStepId](data,nextActivityContext,dataFlowContext);
							if(result !== undefined) dataFlowContext.writeResultToOuput(result,nextActivityContext);
						}
					}
					// if last step, returns buffered value
					else if(dataFlowActivity.impl.stepBuffer.length>1) throw wigiiApi.createServiceException('On the DataFlow last step, only one result can be generated. You should add a new step to merge the multiple results into one.', wigiiApi.errorCodes.INVALID_STATE);
					else return dataFlowActivity.impl.stepBuffer.shift();
				}
			};
		});
		
		
		
		
		
		
		// Models
		
		ncddoc(function(){/**
		 * A Wigii FormEvent
		*/},
		wigiiApi.FormEvent = function(eventName,formId,fieldId,fieldName) {
			var self = this;
			self.className = 'FormEvent';
			self.ctxKey = wigiiApi.ctxKey+'_'+self.className;	
			
			self.context = {
				'eventName':eventName,
				'formId':formId,
				'fieldId':fieldId,
				'fieldName':fieldName
			};
			
			self.eventName = function() {return self.context.eventName;};
			self.formId = function() {return self.context.formId;};
			self.fieldId = function() {return self.context.fieldId;};
			self.fieldName = function() {return self.context.fieldName;};
			self.subFieldName = function(subFieldName) {
				if(subFieldName) self.context.subFieldName = subFieldName;
				else return self.context.subFieldName;
			};
			self.value = function(value) {
				if(value) self.context.value = value;
				else return self.context.value;
			};
			self.dataType = function(dataType) {
				if(dataType) self.context.dataType = dataType;
				else return self.context.dataType;
			};
			self.toJson = function() {
				if(self.context) return JSON.stringify(self.context);
				else return '';
			};
		});
		
		ncddoc(function(){/**
		 * A Wigii Field
		 * 
		 * @param String fieldName the name of the field
		 * @param String dataType the Wigii DataType name of the field
		 * @param String label a label for the end user (already translated)
		 * @param Object attributes optional map of attributes
		*/},
		wigiiApi.Field = function(fieldName,dataType,label,attributes) {
			var self = this;
			self.className = 'Field';
			self.ctxKey = wigiiApi.ctxKey+'_'+self.className;	
			
			self.context = {
				'fieldName':fieldName,
				'dataType':dataType,
				'label':label,
				'attributes':attributes
			};
			
			self.fieldName = function(){return self.context.fieldName;};
			self.dataType = function(){return self.context.dataType;};
			self.label = function(label) {
				if(label===undefined) return self.context.label;
				else self.context.label = label;
			};
			self.attribute = function(name,value) {
				if(!name) throw wigiiApi.createServiceException('attribute name cannot be null', wigiiApi.errorCodes.INVALID_ARGUMENT);
				if(!self.context.attributes) self.context.attributes = {};
				if(value===undefined) return self.context.attributes[name];
				else self.context.attributes[name] = value;
			};
		});
		
		ncddoc(function(){/**
		 * A Wigii FieldList
		*/},
		wigiiApi.FieldList = function() {
			var self = this;
			self.className = 'FieldList';
			self.ctxKey = wigiiApi.ctxKey+'_'+self.className;
			
			self.context = {
				'indexByName':{},
				'indexByPos':[]
			};
			
			/**
			 * Adds a field to the FieldList
			 * @param Field field the field to add to the list
			 * @return FieldList for chaining
			 * @throws ServiceException::ALREADY_EXISTS if a field which same name is already in the list.
			 */
			self.addField = function(field) {
				if(!field) throw wigiiApi.createServiceException('field cannot be null', wigiiApi.errorCodes.INVALID_ARGUMENT);
				var fieldName = field.fieldName();
				if(self.doesFieldExist(fieldName)) wigiiApi.createServiceException("field '"+fieldName+"' already exists in the list", wigiiApi.errorCodes.ALREADY_EXISTS);
				self.context.indexByName[fieldName] = field;
				self.context.indexByPos.push(fieldName);
			};
			/**
			 * Checks if a Field with the given name exists in the list
			 * @param String fieldName the field name to check
			 * @return Field return Field if exists in the list else undefined
			 */
			self.doesFieldExist = function(fieldName) {
				if(!fieldName) return undefined;
				return self.context.indexByName[fieldName];
			};
			/**
			 * Return the Field in the list given its name.
			 * @param String fieldName the name of the field to retrieve
			 * @return Field the field
			 * @throws ServiceException::DOES_NOT_EXIST if no Field with this name exist in the list
			 */
			self.getField = function(fieldName) {
				if(!fieldName) throw wigiiApi.createServiceException('fieldName cannot be null', wigiiApi.errorCodes.INVALID_ARGUMENTfield.fieldName());
				var returnValue = self.context.indexByName[fieldName];
				if(!returnValue) throw wigiiApi.createServiceException("field '"+fieldName+"' does not exist in the list", wigiiApi.errorCodes.DOES_NOT_EXIST);
				return returnValue;
			};
			/**
			 * @return Boolean true if list is empty, else false
			 */
			self.isEmpty = function() {
				return (self.context.indexByPos.length==0);
			};
			/**
			 * @return Int the number of elements in the list, 0 if empty.
			 */
			self.count = function() {
				return self.context.indexByPos.length;
			};
			/**
			 * Iterates other the list and calls the given callback function
			 * @param Function callback function of the form callback(index,Field) where index=0..count-1.
			 */
			self.each = function(callback) {
				if(!$.isFunction(callback)) throw wigiiApi.createServiceException('callback should be a function of the form callback(index,Field)', wigiiApi.errorCodes.INVALID_ARGUMENT);
				var indexByPos = self.context.indexByPos;
				var indexByName = self.context.indexByName;
				for(var i=0;i<indexByPos.length;i++) {
					callback(i,indexByName[indexByPos[i]]);
				}
			};
		});
		
		ncddoc(function(){/**
		 * Wigii Bag
		*/},
		wigiiApi.WigiiBag = function() {
			var self = this;
			self.className = 'WigiiBag';
			self.ctxKey = wigiiApi.ctxKey+'_'+self.className;
			
			self.context = {
				'bag':{}
			};
			
			/**
			 * Returns the value of the field given its name and optional subFieldName
			 * @param fieldName the name of the Field
			 * @param subFieldName the name of the subfield. If undefined, assumes 'value' subField.
			 * @return Scalar the field value or undefined if field has no value.
			 */
			self.getValue = function(fieldName,subFieldName) {
				if(!fieldName) throw wigiiApi.createServiceException('fieldName cannot be null', wigiiApi.errorCodes.INVALID_ARGUMENT);				
				var fieldValue = self.context.bag[fieldName];
				if(fieldValue) {
					if(!subFieldName) subFieldName = 'value';
					return fieldValue[subFieldName];
				}
				else return undefined;
			};
			/**
			 * Stores the value in the WigiiBag. Replaces any existing value for this fieldName and subFieldName
			 * @param Scalar value the value to store in the WigiiBag
			 * @param fieldName the name of the Field
			 * @param subFieldName the name of the subField. If undefined, assumes 'value' subField.
			 */
			self.setValue = function(value,fieldName,subFieldName) {
				if(!fieldName) throw wigiiApi.createServiceException('fieldName cannot be null', wigiiApi.errorCodes.INVALID_ARGUMENT);
				var fieldValue = self.context.bag[fieldName];
				if(!fieldValue) {
					fieldValue = {};
					self.context.bag[fieldName] = fieldValue;
				}
				if(!subFieldName) subFieldName = 'value';
				fieldValue[subFieldName] = value;
			};
		});
		
		ncddoc(function(){/**
		 * A Wigii Record
		 * @param FieldList fieldList optional predefined FieldList of the Record.
		 * @param WigiiBag wigiiBag optional predefined WigiiBag of the Record.
		*/},
		wigiiApi.Record = function(fieldList,wigiiBag) {
			var self = this;
			self.className = 'Record';
			self.ctxKey = wigiiApi.ctxKey+'_'+self.className;
			
			self.context = {
				'fieldList':fieldList||wigiiApi.createFieldListInstance(),
				'wigiiBag':wigiiBag||wigiiApi.createWigiiBagInstance()
			};
			
			/**
			 * @return FieldList
			 */
			self.fieldList = function() {return self.context.fieldList;};
			/**			
			 * @return WigiiBag
			 */
			self.wigiiBag = function() {return self.context.wigiiBag;};
			
			/**
			 * Creates a new Field in the Record and adds it at the end of the list
			 * @param String fieldName the name of the field
			 * @param String dataType the Wigii DataType name of the field
			 * @param String label a label for the end user (already translated)
			 * @param Object attributes optional map of attributes
			 * @return Record for chaining
			 */
			self.createField = function(fieldName,dataType,label,attributes) {
				var field = wigiiApi.createFieldInstance(fieldName, dataType, label, attributes);
				self.fieldList().addField(field);
				return self;
			};
			/**
			 * Returns the value of the Field in the Record
			 * @param String fieldName the name of the field
			 * @param String subFieldName the name of the subfield. If undefined, assumes 'value' subfield.
			 * @return Scalar the field value or undefined if field does not exist.
			 */
			self.getFieldValue = function(fieldName,subFieldName) {
				return self.wigiiBag().getValue(fieldName,subFieldName);
			};
			/**
			 * Sets the value of a Field in the Record
			 * @param Scalar value the field value to store into the Record
			 * @param String fieldName the name of the Field
			 * @param subFieldName the name of the subfield. If undefined, assumes 'value' subfield.
			 * @return Record for chaining
			 */
			self.setFieldValue = function(value,fieldName,subFieldName) {
				self.wigiiBag().setValue(value,fieldName,subFieldName);
				return self;
			};
		});
		
		// ServiceProvider
		
		ncddoc(function(){/**
		 * Lookups a service instance given a service name
		 * returns undefined if not found
		*/},
		wigiiApi.lookupService = function(serviceName) {
			if(!serviceName) return;
			var srvGetter = wigiiApi['get'+serviceName];
			if($.type(srvGetter) === 'function') {
				return srvGetter();
			}
		});
		
		ncddoc(function(){/**
		 * Returns an instance of the debugger attached to the given class
		*/},
		wigiiApi.getDebugLogger = function(typeName) {
			return new wigiiApi.DebugLogger(typeName);
		});
		
		ncddoc(function(){/**
		 * Returns the ExceptionSink instance attached to the API
		*/},
		wigiiApi.getExceptionSink = function() {
			if(!wigiiApi['exceptionSinkInstance']) {
				wigiiApi.exceptionSinkInstance = new wigiiApi.ExceptionSink();
			}
			return wigiiApi.exceptionSinkInstance;
		});
		
		ncddoc(function(){/**
		 * Creates a new PopUp instance
		*/},
		wigiiApi.createPopUpInstance = function(anchor,options) {
			return new wigiiApi.PopUp(anchor,options);
		});
		
		ncddoc(function(){/**
		 * Returns a HelpService instance
		*/},
		wigiiApi.getHelpService = function() {
			if(!wigiiApi['helpServiceInstance']) {
				wigiiApi.helpServiceInstance = new wigiiApi.HelpService();
			}
			return wigiiApi.helpServiceInstance;
		});
		
		ncddoc(function(){/**
		 * Returns a JQueryService instance
		*/},
		wigiiApi.getJQueryService = function() {
			if(!wigiiApi['jQueryServiceInstance']) {
				wigiiApi.jQueryServiceInstance = new wigiiApi.JQueryService();
			}
			return wigiiApi.jQueryServiceInstance;
		});
		
		ncddoc(function(){/**
		 * Returns a WncdContainer instance
		 * @param Object wncd A Wigii NCD Lib instance (normally the defined wncd symbol)
		*/},
		wigiiApi.getWncdContainer = function(wncd) {
			if(!wigiiApi['wncdContainerInstance']) {
				wigiiApi.wncdContainerInstance = new wigiiApi.WncdContainer(wncd);
			}
			return wigiiApi.wncdContainerInstance;
		});
		
		ncddoc(function(){/**
		 * Creates a function that can be used to attach a comment and some custom attributes to a given function.
		 * The comment or the attributes are stored in the wncdAttr object attached to the function 
		 * and can be used as meta information further down in the code.
		 * The function has the following signature wncdAttr(comment,key1,val1,...,keyn,valn,f) where
		 * - Arg(0) comment. A comment describing the function, as a string or as a source code native comment wrapped into a function
		 * - Arg(1..n) keyI, valI: Between first argument comment and last argument f, as many pairs key,value as needed can be inserted. These pairs key:value will be added to the attached wncdAttr object.
		 * - Arg(last) f: Function|Object. The function to which to add the NCD attributes. 
		 * The wncdAttr function returns f for chaining.
		 *@param Boolean enable If true, the wncd attributes are actively loaded when the function is executed, else there are ignored. 
		 *@return Function a function to attach comments and custom attributes to functions
		*/},
		wigiiApi.getWncdAttrFx = function(enable) { return wigiiNcdAttr(enable);});
		
		ncddoc(function(){/**
		 * Returns DataFlowService instance
		*/},
		wigiiApi.getDataFlowService = function() {
			if(!wigiiApi['dataflowServiceInstance']) {
				wigiiApi.dataflowServiceInstance = new wigiiApi.DataFlowService();
			}
			return wigiiApi.dataflowServiceInstance;
		});
		
		ncddoc(function(){/**
		 * Creates an HtmlBuilder instance
		*/},
		wigiiApi.getHtmlBuilder = function() {			
			return new wigiiApi.HtmlBuilder();
		});
		
		ncddoc(function(){/**
		 * Creates a FieldHelper instance
		*/},
		wigiiApi.getFieldHelper = function() {
			return new wigiiApi.FieldHelper();
		});
		
		ncddoc(function(){/**
		 * Creates a FormHelper instance
		*/},
		wigiiApi.getFormHelper = function() {
			return new wigiiApi.FormHelper();
		});
		
		ncddoc(function(){/**
		 * Creates a ButtonHelper instance on a given button selector
		*/},
		wigiiApi.createButtonHelper = function(btn,options) {
			return new wigiiApi.ButtonHelper(btn,options);
		});
		
		ncddoc(function(){/**
		 * Creates an ArrayHelper instance
		*/},
		wigiiApi.getArrayHelper = function(arr) {
			return new wigiiApi.ArrayHelper(arr);
		});
		
		ncddoc(function(){/**
		 * Creates a MatrixHelper instance
		*/},
		wigiiApi.getMatrixHelper = function(matrix) {
			return new wigiiApi.MatrixHelper(matrix);
		});
		
		ncddoc(function(){/**
		 * Creates a DropDownConstraint and binds it to some selected drop-downs
		*/},
		wigiiApi.createDropDownConstraint = function(selector,matrix) {
			return new wigiiApi.DropDownConstraint(selector,matrix);
		});
		
		ncddoc(function(){/**
		 * Creates a FormEvent instance
		*/},
		wigiiApi.createFormEventInstance = function(eventName,formId,fieldId,fieldName) {
			return new wigiiApi.FormEvent(eventName,formId,fieldId,fieldName);
		});
		
		ncddoc(function(){/**
		 * Creates a Field instance
		*/},
		wigiiApi.createFieldInstance = function(fieldName,dataType,label,attributes) {
			return new wigiiApi.Field(fieldName,dataType,label,attributes);
		});
		
		ncddoc(function(){/**
		 * Creates a FieldList instance
		*/},
		wigiiApi.createFieldListInstance = function() {
			return new wigiiApi.FieldList();
		});
		
		ncddoc(function(){/**
		 * Creates a WigiiBag instance
		*/},
		wigiiApi.createWigiiBagInstance = function() {
			return new wigiiApi.WigiiBag();
		});
		
		ncddoc(function(){/**
		 * Creates a Record instance
		*/},
		wigiiApi.createRecordInstance = function(fieldList,wigiiBag) {
			return new wigiiApi.Record(fieldList,wigiiBag);
		});
		
		ncddoc(function(){/**
		 * @return wigiiApi.MatrixHelper
		*/},
		wigiiApi.matrix = function(matrix,selectedRows) {
			return new wigiiApi.MatrixHelper(matrix,selectedRows);
		});		
		
		// Wigii client
					
		ncddoc(function(){/**
		 * Logs a message in the console
		 * @param String message the message to log.
		*/},
		wigiiApi.log = function(message) {			
			wigiiApiConsole().log("INFO WigiiApi : "+message);
			return wigiiApi;
		});
		
		ncddoc(function(){/**
		 * Clears the WigiiAPI log console
		*/},
		wigiiApi.clearLog = function() {
			wigiiApiConsole().clear();
			return wigiiApi;
		});
		
		ncddoc(function(){/**
		 * Returns WigiiApi DebugLogger instance
		*/},
		wigiiApi.debugLogger = function() {
			if(!wigiiApi['debugLoggerInstance']) {
				wigiiApi.debugLoggerInstance = wigiiApi.getDebugLogger('WigiiApi');
			}
			return wigiiApi.debugLoggerInstance;
		});
		
		ncddoc(function(){/**
		 * Builds a complete Wigii Update url given a sub-url.
		 * @param String url a logical update url of the form idAnswer/WigiiNamespace/Module/action/parameter
		 * @return String complete encoded url ready to be passed to an AJAX query.
		*/},
		wigiiApi.buildUpdateUrl = function(url) {
			return encodeURI(wigiiApi.SITE_ROOT +"Update/"+window.crtContextId+wigiiApi.EXEC_requestSeparator+url);
		});
		
		ncddoc(function(){/**
		 * Builds a Wigii Update callback function which can be passed as a SUCCESS function to an AJAX query.
		 * @param Object context a map of [idAnswer=>context object] to be passed to the parseUpdateResult function.
		 * @return Function the callback function
		*/},
		wigiiApi.buildUpdateCallback = function(context) {
			return function(data,textStatus){wigiiApi.parseUpdateResult(data,textStatus,context);};
		});
		
		ncddoc(function(){/**
		 * Builds a Wigii url fragment by joining the keys and values given into the urlArgs object
		 * @param Object|Array|String urlArgs or an object with some (key,value) pairs, or an array of values, or a single string.
		 * @return String the built url fragment of the form key1=value1/key2=value2/... or value1/value2/value3
		*/},
		wigiiApi.buildUrlFragment = function(urlArgs) {
			var returnValue = '';
			if($.isArray(urlArgs)) {
				for(var i=0;i<urlArgs.length;i++) {
					if(i>0) returnValue += '/';
					returnValue += urlArgs[i];
				}				
			}
			else if($.isPlainObject(urlArgs)) {				
				for(var key in urlArgs) {
					if(returnValue!='') returnValue += '/';
					returnValue += key+'='+urlArgs[key];
				}
			}
			else returnValue = urlArgs;
			if(returnValue != '') returnValue = encodeURI(returnValue);
			return returnValue;
		});
		
		ncddoc(function(){/**
		 * Wigii Update protocol query answer parser
		 * @param String html string received from server following Wigii Update protocol format
		 * @param String textStatus JQuery AJAX text status
		 * @param Object context the optional map [idAnswer=>context object] used to retrieve contextual data according to idAnswer.
		*/},
		wigiiApi.parseUpdateResult = function(html,textStatus,context) {
			//wigiiApi.debugLogger().logBeginOperation('parseUpdateResult');
			// splits received html in several answers
			var tabReq = html.split(wigiiApi.EXEC_answerRequestSeparator);
			var tabLength = tabReq.length;
			var lookupPaths = {};
			var request,tempCode;
			for (var i=0; i<tabLength; i++){
				// splits request-answer in several parameters
				request = tabReq[i].split(wigiiApi.EXEC_answerParamSeparator);
				if(request != ""){
					// JSCode answer
					if (request[0] == "JSCode"){
						// if a cache key is present, puts js code in cache
						if(request.length > 2){
							// parses JS code
							tempCode = wigiiApi.decHTML(request[2]);
							// detects a PHP Fatal Error answer and cancels js execution
							if(tempCode.substr(0, 6)=="<br />"){
								tempCode = null;
							}
							// replaces actual js code in cache with new one received
							if(request[1] == "foundInCache") {
								if(lookupPaths["foundInCache"]) {
									wigiiApi.setJSCache(lookupPaths["foundInCache"][1], lookupPaths["foundInCache"][0], tempCode);
									wigiiApi.keepInCache(lookupPaths["foundInCache"][0]);
								}
							}
							// puts js code in cache
							else {
								wigiiApi.setJSCache(request[1], lookupPaths[request[1]], tempCode);
								wigiiApi.keepInCache(lookupPaths[request[1]]);
							}						
						} 
						// parses js code
						else {
							tempCode = decHTML(request[1]);
							// detects a PHP Fatal Error answer and cancels js execution
							if(tempCode.substr(0, 6)=="<br />"){
								tempCode = null;
							}
						}
						// executes javascript
						if(!wigiiApi.holdJsCodeAnswers()) eval(tempCode);
						else wigiiApi.log(tempCode);
					} 
					// Alert answer
					else if (request[0] == "Alert"){
						alert(request[1]);
					} 
					// Reload answer
					else if (request[0] == "Reload"){
						window.self.location = request[1];
					} 
					// NoAnswer
					else if (request[0] == "NoAnswer"){
						// detects a cache key
						if(request[1].indexOf('cacheKey_') == 0) {
							lookupPaths[request[0]] = request[1];
						}
						//should never occurs, but if there is an answer
						//then we alert it.
						else if(request[1] != ""){
							if(request.length>2){
								alert(request[1]+'\n'+request[2]);
							} else {
								alert(request[1]);
							}
						}
					} 
					// foundInCache answer
					else if (request[0] == "foundInCache"){
						// detects a cache key
						if(request[1].indexOf('cacheKey_') == 0) {
							lookupPaths[request[0]] = [request[1],request[2]];
						}
					} 
					// Wigii service handlers
					else if(request[0].indexOf('Wigii_') == 0) {
						tempCode = request[0].split('_');
						if(tempCode.length>1) {
							// lookups service
							var srv = wigiiApi.lookupService(tempCode[1]);
							if(srv) {								
								var answerType = 'html';
								var tempCode = request[1];
								// retrieves answer type
								if(request.length>2) {
									answerType = request[1];
									tempCode = request[2];									
								}
								// parses json answer
								if(answerType == 'json') {
									try {
										tempCode = $.parseJSON(tempCode);
									}
									catch(exc) {throw wigiiApi.createServiceException('json response parsing exception', wigiiApi.errorCodes.WRAPPING, exc);}
								}
								// retrieves right context
								var ctx = (context && context[request[0]]?context[request[0]]:context);
								try {
									// calls html handler
									if(answerType=='html' && $.type(srv['html']) === 'function') srv.html(tempCode,ctx);
									// calls json handler
									else if(answerType=='json' && $.type(srv['json']) === 'function' && tempCode) srv.json(tempCode,ctx);
								}
								catch(exc) {wigiiApi.publishException(exc);}
							}
						}
					}
					// DIV answer
					else {				
						// if 'keep' does nothing, keeps actual html content
						if(request[1]=='keep'){
							/* does nothing */
						} 
						// else replaces div content with answer
						else {							
							// very important to stop all the timers on elements that we will destroy.
							$("#"+request[0]).stopTime();
							$("#"+request[0]+" *").stopTime();
							// if cache key, then replaces html and puts in cache
							if(request.length > 2){
								// replaces div html with answer
								$("#"+request[0]).html(request[2]);
								// if empty answer, close open dialog if needed
								if(request[2]==''){
									if($("#"+request[0]).is(':ui-dialog')){
										$("#"+request[0]).dialog("destroy");
									}
								} 
								// puts answer in cache
								else {
									wigiiApi.setCache(request[0], request[1], request[2]);
									wigiiApi.keepInCache(request[1]);
									lookupPaths[request[0]] = request[1];
								}
							// no cache key, only replaces div html with answer
							} else {
								$("#"+request[0]).html(request[1]);
								// if empty answer, close open dialog if needed
								if(request[1]==''){
									if($("#"+request[0]).is(':ui-dialog')){
										$("#"+request[0]).dialog("destroy");
									}
								}
							}
						}
					}
				}
			}
			wigiiApi.clearKeepInCache();
			//wigiiApi.debugLogger().logEndOperation('parseUpdateResult');
		});
		
		ncddoc(function(){/**
		 * Shows the details of the element
		*/},
		wigiiApi.showElement = function(wigiiNamespaceUrl,moduleName,elementId,urlArgs) {
			if(urlArgs) urlArgs = '/'+wigiiApi.buildUrlFragment(urlArgs);
			update('elementDialog/'+wigiiNamespaceUrl+'/'+moduleName+'/element/detail/'+elementId+urlArgs);
		});
		
		ncddoc(function(){/**
		 * Print the details of the element
		*/},
		wigiiApi.printElement = function(wigiiNamespaceUrl,moduleName,elementId) {
			window.open(SITE_ROOT +"usecontext/"+crtContextId+"/__/"+wigiiNamespaceUrl+'/'+moduleName+'/element/print/'+elementId);
		});
		
		ncddoc(function(){/**
		 * Print the details of the element from a template
		*/},
		wigiiApi.printElementWithTemplate = function(wigiiNamespaceUrl,moduleName,elementId,template) {
			if(template) template = "/"+template;
			window.open(SITE_ROOT +"usecontext/"+crtContextId+"/__/"+wigiiNamespaceUrl+'/'+moduleName+'/element/template/'+elementId+template);
		});
		
		ncddoc(function(){/**
		 * Opens a Wigii Form to edit the element
		*/},
		wigiiApi.editElement = function(wigiiNamespaceUrl,moduleName,elementId,urlArgs) {
			if(urlArgs) urlArgs = '/'+wigiiApi.buildUrlFragment(urlArgs);
			update('elementDialog/'+wigiiNamespaceUrl+'/'+moduleName+'/element/edit/'+elementId+urlArgs);
		});
		
		ncddoc(function(){/**
		 * Opens a Wigii Form to add a new element
		*/},
		wigiiApi.addElement = function(wigiiNamespaceUrl,moduleName,groupId,urlArgs) {
			if(urlArgs) urlArgs = '/'+wigiiApi.buildUrlFragment(urlArgs);
			update('elementDialog/'+wigiiNamespaceUrl+'/'+moduleName+'/element/add/'+groupId+urlArgs);
		});
		
		ncddoc(function(){/**
		 * Opens a Wigii Form to copy a new element
		*/},
		wigiiApi.copyElement = function(wigiiNamespaceUrl,moduleName,elementId,groupId,urlArgs) {
			if(urlArgs) urlArgs = '/'+wigiiApi.buildUrlFragment(urlArgs);
			update('elementDialog/'+wigiiNamespaceUrl+'/'+moduleName+'/element/copy/'+elementId+'/'+groupId+urlArgs);
		});
		
		ncddoc(function(){/**
		 * Returns a FormHelper instance centered on current opened Wigii element form
		 * @return wigiiApi.FormHelper
		*/},
		wigiiApi.form = function() {
			var form = $('#elementDialog form');
			if(form.length == 0) form = $('#detailElement_form');
			return form.wigii('FormHelper');
		});
		
		ncddoc(function(){/**
		 * Calls asynchronously a FuncExp on server side through the Fx endpoint.
		 *@param String fx the FuncExp string to be called on server side
		 *@param Object options an optional bag of options. The following options are supported:
		 * - resultHandler: Function. A function to handle the FuncExp result. Function signature is resultHandler(data), where data is the received value of the JQuery ajax call.
		 * - exceptionHandler: Function. A function which handles any thrown exception from server. Function signature is exceptionHandler(exception,context) where exception is Wigii API exception object of the form {name:string,code:int,message:string}
		 * and context is an object with some server context information of the form {request:string, wigiiNamespace:string, module:string, action:string, realUsername:string, username:string, principalNamespace:string, version:string}
		 * If exceptionHandler is not set, then exception is published through the wigii.publishException method.
		 * - silent: Boolean. If silent is true, then no exception handler is called if an error occurs.
		 * - fxEndPoint: URL String. A url which points to a Wigii server Fx endpoint. If not defined calls wigii.SITE_ROOT/crtWigiiNamespace/crtModule/fx
		 * - postData: Object|Array. Some optional data to be posted to the server with the Fx call. The data is serialized as JSON.
		 * - postAsForm: Boolean. If true, the data is posted as an HTTP form, else posted as JSON.
		*/},
		wigiiApi.callFx = function(fx,options) {
			if(!fx) throw wigiiApi.createServiceException('fx cannot be null',wigiiApi.errorCodes.INVALID_ARGUMENT);
			
			// sets default options
			options = options || {};
			if(!options.fxEndPoint) {
				if(window.crtWigiiNamespaceUrl) options.fxEndPoint = wigiiApi.SITE_ROOT+'/'+crtWigiiNamespaceUrl+'/'+crtModuleName+'/fx';
				else options.fxEndPoint = wigiiApi.SITE_ROOT+'/NoWigiiNamespace/NoModule/fx';
			}
			if(!options.fxEndPoint.endsWith('/')) options.fxEndPoint += '/';
			if(!options.exceptionHandler && !options.silent) options.exceptionHandler = function(exception,context) { wigiiApi.publishException(exception); }
			
			// encodes fx call
			fx = $.base64EncodeUrl(fx)
			
			// prepares ajax options		
			var ajaxOptions = {type:"GET",
				url:options.fxEndPoint+fx,
				crossDomain: true,
				xhrFields: {withCredentials: true}
			}		
			if(options.resultHandler) ajaxOptions.success = options.resultHandler;
			if(!options.silent && options.exceptionHandler) ajaxOptions.error = function(xhr,textStatus) {
				// if HTTP error 500, assumes we have a server side exception sent as xml
				if(xhr.status == 500 && xhr.responseXML) {
					var serverError = $(xhr.responseXML);
					// extracts exception part
					var exception = serverError.find('exception');
					if(exception) {
						exception = {
							name: exception.find('name').text(),
							code: exception.find('code').text(),
							message: exception.find('message').text()
						};
					}
					// extracts context part
					var context = serverError.find('context');
					if(context) {
						context = {
							request: context.find('request').text(),
							wigiiNamespace: context.find('wigiiNamespace').text(),
							module: context.find('module').text(),
							action: context.find('action').text(),
							realUsername: context.find('realUsername').text(),
							username: context.find('username').text(),
							principalNamespace: context.find('principalNamespace').text()
						}
					}
					// calls exception handler
					options.exceptionHandler(exception,context);
				}
				// else converts HTTP error to exception
				else options.exceptionHandler({code:xhr.status||wigiiApi.errorCodes.UNKNOWN_ERROR,message:xhr.responseText||"Ajax status: "+textStatus});
			};
			
			// if data, then HTTP POST
			if(options.postData) {
				ajaxOptions.type = "POST";
				if(options.postAsForm) {
					ajaxOptions.data = options.postData;
				}
				else {
					ajaxOptions.contentType = 'text/plain';
					ajaxOptions.dataType = 'json';			
					ajaxOptions.data = JSON.stringify(options.postData);
					ajaxOptions.processData = false;
				}
			}
			
			// Fx Ajax call
			$.ajax(ajaxOptions);
		});
		
		ncddoc(function(){/**
		 * Default Fx error handler that can be plugged as an error callback into a jQuery ajax call.
		 * This error handler publishes the Wigii exception that occured on server side.
		*/},
		wigiiApi.defaultFxErrorHandler = function(xhr,textStatus) {
			var context = undefined;
			var exception = undefined;
			// tries to extract the error as XML
			var serverError = xhr.responseXML;
			if(!serverError) {						
				serverError = xhr.responseText;
				try {
					serverError = $.parseXML(serverError);
				}
				catch(e) { serverError = undefined;}
			}
			// if HTTP error 500, assumes we have a server side exception sent as xml			
			if(xhr.status == 500 && serverError) {									
				serverError = $(serverError);
				// extracts exception part
				exception = serverError.find('exception');
				if(exception) {
					exception = {
						name: exception.find('name').text(),
						code: exception.find('code').text(),
						message: exception.find('message').text()
					};
				}
				// extracts context part
				context = serverError.find('context');
				if(context) {
					context = {
						request: context.find('request').text(),
						wigiiNamespace: context.find('wigiiNamespace').text(),
						module: context.find('module').text(),
						action: context.find('action').text(),
						realUsername: context.find('realUsername').text(),
						username: context.find('username').text(),
						principalNamespace: context.find('principalNamespace').text()
					}
				}						
			}
			// else converts HTTP error to exception (ignores ajax abort) 
			else if(textStatus != 'abort') exception = {code:xhr.status||wigiiApi.errorCodes.UNKNOWN_ERROR,message:xhr.responseText||"Ajax status: "+textStatus};
			// shows exception as a centered popup
			if(exception) wigiiApi.getHelpService().showFloatingHelp(undefined, undefined, wigiiApi.exception2html(exception,context), {localContent:true,position:"center",removeOnClose:true});
		});
		
		ncddoc(function(){/**
		 * Returns current selected language code
		*/},
		wigiiApi.lang = function() {
			return crtLang;
		});
		
		// Functions
		
		ncddoc(function(){/**
		 * remove any ' , or spaces from a string and multiply it with 1.0 to cast it in a real number
		 * @param value : string representing a number
		 * @return float : a clean numercic value
		*/},
		wigiiApi.str2float = function (value){
			return 1.0*value.replace(/'/g,'').replace(/,/g,'').replace(/ /g,'');
		});
		
		ncddoc(function(){/**
		 * format a numeric value with thousand separatos
		 * @param numeric
		 * @return string : a formated numeric value
		*/},
		wigiiApi.txtNumeric = function (value){
			value += '';
		    var x = value.split('.');
		    var x1 = x[0];
		    var x2 = x.length > 1 ? '.' + x[1] : '';
		    var rgx = /(\d+)(\d{3})/;
		    while (rgx.test(x1)) {
		            x1 = x1.replace(rgx, '$1' + "'" + '$2');
		    }
		    return x1 + x2;
		});
		
		ncddoc(function(){/**
		 * add double quote around the value
		 * @param string
		 * @return string
		*/},
		wigiiApi.txtQuot = function (value){
			return '"'+value+'"';
		});
		
		ncddoc(function(){/**
		 * Returns a label in the current language
		 * @example Two syntaxes are possible:
		 * wigii().txtDico("l01","Label in english","l02","Label en français");
		 * wigii().txtDico({l01:"Label in english",l02:"Label en français"})
		 * @example Natural Code Develoment :
		 * var t = wigii().txtDico;
		 * wigii().form().tool('copy').label(t("l01","Create an invoice","l02","Créer une facture"));
		*/},
		wigiiApi.txtDico = function(lang,label) {
			var dico = undefined;
			if($.isPlainObject(lang)) dico = lang;
			else {
				dico = {};
				dico[lang] = label;
				if(arguments.length>2) {
					var i=2;
					while(i<arguments.length) {
						lang = arguments[i];
						i++;
						if(i<arguments.length) label = arguments[i];
						else label = '';
						i++;
						dico[lang] = label;
					}
				}
			}
			return dico[wigiiApi.lang()];
		});
		
		ncddoc(function(){/**
		 * apply && between all the args
		 * this is useful in configuration files as the character & is reserved
		 * @param Any val1 left hand side
		 * @param Any val2 right hand side
		 * @param Any valI any other number of arguments to combine in the AND expression
		 * @return val1 && val2 && valI ...
		*/},
		wigiiApi.logAnd = function (val1, val2){
			if(arguments.length>2) {
				var returnValue = arguments[0];
				if(returnValue) {
					for(var i=1;i<arguments.length;i++) {
						returnValue = returnValue && arguments[i];
						if(!returnValue) break;
					}
				}
				return returnValue;
			}
			else return val1 && val2;
		});		

		ncddoc(function(){/** 
		 * ceil a value up to the number. IE: ceilTo(10.34, 0.05) returns 10.35
		 * the third parameter is optional and allows to fixe the number of decimals returned 
		 * this function is typically used for financial fields 
		*/},
		wigiiApi.ceilTo = function (value, number, fixed) {
			if (arguments.length<3) fixed = null;
			//due to rounding errors in float calculation in javascript
			//we force the usage with ints if fixed is defined
			//for example if you do: 701.05/0.05 you get 14020.999999999998 instead of 14021
			//this explain as well why 701.05%0.05 gives 0.049 which is far different than the 0 that it should return...
			var op = 1;
			//detect how many decimals the number have
			var floatDec = (number+"").indexOf(".");
			if(floatDec){
				floatDec = (number+"").length-floatDec-1; //-1 because of the .
				op = Math.pow(10,floatDec);
			}
			remain = Math.round(value*op) % Math.round(number*op);
			remain = remain / op;
			if (remain > 0) value = value - remain + number;
			if(fixed) return value.toFixed(2);
			return value;
		});

		ncddoc(function(){/**
		 * Generates a range of numbers, starting from one number, to another number, by a given step.
		 * @param Number from start number, can be integer, float, positive, null or negative.
		 * @param Number to stop number, can be integer, float, positive, null or negative.
		 * @param Number step increment number, can be integer, float, positive or negative. Not null.
		 * @param Function callback a callback function which receives the generated number		 
		*/},
		wigiiApi.genRange = function(from,to,step,callback) {
			if($.isFunction(callback)) {
				if(!($.isNumeric(from) && $.isNumeric(to) && $.isNumeric(step))) throw wigiiApi.createServiceException('from, to and step should all be numbers',wigiiApi.errorCodes.INVALID_ARGUMENT);			
				if(step>0) {
					while(from<to) {
						callback(from);
						from += step;
					}
				}
				else if(step<0) {
					while(from>to) {
						callback(from);
						from -= step;
					}
				}
				else throw wigiiApi.createServiceException('step cannot be 0',wigiiApi.errorCodes.INVALID_ARGUMENT);
			}
		});
		
		ncddoc(function(){/**
		 * Reads the data coming from the source and processes it through the selected flow activities
		 *@param Function source a data flow source function. 
		 * A data source function is a function which takes an open DataFlowContext in parameter and then calls processDataChunk as many times as needed.
		 * var rangeGen = function(from,to,step) { return function(dataFlowContext) {
		 *	for(var i=from;i<=to;i+=step) dataFlowContext.processDataChunk(i);
		 * }};
		 *@param Array activities an array of activity functions. An activity function is a function which receives the current chunk of data, 
		 * an activity context in which a processing state can be stored and the data flow context to get insight on the global state of the data flow beeing executed.
		 * var power = function(factor) { return function(data,activityCtx,dataFlowContext) {
		 * 		var returnValue = 1;
		 *		for(var i=0;i<factor;i++) returnValue *= data;
		 *		return returnValue;
		 * }};
		 * var sum = function(data,activityCtx,dataFlowContext) {
		 *	 switch(activityCtx.state) {
		 *	 	case dataFlowContext.DFA_STARTSTREAM: activityCtx.sum = 0; break;
		 *		case dataFlowContext.DFA_RUNNING: activityCtx.sum += data; break;
		 *		case dataFlowContext.DFA_ENDSTREAM: dataFlowContext.writeResultToOuput(activityCtx.sum,activityCtx); break;
		 *	 }	
		 * };
		 *@example wigii().sel(rangeGen(-10,10,2),[power(3),sum])
		 *@see wigiiApi.DataFlowService method processDataSource
		 *@return Any the data flow result
		*/},
		wigiiApi.sel = function(source,activities) { return wigiiApi.getDataFlowService().processDataSource(source,activities); });
		
		ncddoc(function(){/**
		 * Converts a date to a string in format YYYY-MM-DD
		 * @param Date date the date instance to convert to string. If undefined takes current date.
		 * @return String the date formatted as a String
		*/},
		wigiiApi.day2string = function(date) {
			if(!date) date = new Date();
			var returnValue = '';
			// year
			var c = date.getFullYear();
			returnValue += c;
			// month
			c = date.getMonth()+1;
			if(c<10) returnValue += "-0"+c;
			else returnValue += "-"+c;
			// day
			c = date.getDate();
			if(c<10) returnValue += "-0"+c;
			else returnValue += "-"+c;
			
			return returnValue;
		});
		
		ncddoc(function(){/**
		 * Converts a date to a string in format YYYY-MM-DD hh:mm
		 * @param Date date the date instance to convert to string. If undefined takes current date.
		 * @return String the date formatted as a String
		*/},
		wigiiApi.minutes2string = function(date) {
			if(!date) date = new Date();
			var returnValue = wigiiApi.day2string(date);
			// hours
			var c = date.getHours();
			if(c<10) returnValue += " 0"+c;
			else returnValue += " "+c;
			// minutes
			c = date.getMinutes();
			if(c<10) returnValue += ":0"+c;
			else returnValue += ":"+c;
			
			return returnValue;
		});
		
		ncddoc(function(){/**
		 * Converts a date to a string in format YYYY-MM-DD hh:mm:ss
		 * @param Date date the date instance to convert to string. If undefined takes current date.
		 * @return String the date formatted as a String
		*/},
		wigiiApi.seconds2string = function(date) {
			if(!date) date = new Date();
			var returnValue = wigiiApi.minutes2string(date);
			// seconds
			var c = date.getSeconds();
			if(c<10) returnValue += ":0"+c;
			else returnValue += ":"+c;
			
			return returnValue;
		});
		
		ncddoc(function(){/**
		 * Converts a date to a string in format YYYY-MM-DD hh:mm:ss,milliseconds
		 * @param Date date the date instance to convert to string. If undefined takes current date.
		 * @return String the date formatted as a String
		*/},
		wigiiApi.milliseconds2string = function(date) {
			if(!date) date = new Date();
			var returnValue = wigiiApi.seconds2string(date);
			// milliseconds
			var c = date.getMilliseconds();
			if(c<10) returnValue += ",00"+c;
			if(c<100) returnValue += ",0"+c;
			else returnValue += ","+c;
			
			return returnValue;
		});
		
		ncddoc(function(){/**
		 * Returns a string representing a date in a French style (d.m.Y H:i:s).
		 *@param Integer|String timestamp timestamp to convert to date string or Wigii date string.
		 *@param String options a formating option string. One of : 
		 * noSeconds: display date and time up to minutes, 
		 * noTime: displays only date without time, 
		 * noDate: displays only time without date.
		*/},
		wigiiApi.txtFrenchDate = function(timestamp, options) {			
			var d = ($.type(timestamp)== 'date'? timestamp: new Date(timestamp));
			var returnValue = '';
			var v = 0;
			if(options!= 'noDate') {
				// Day
				v = d.getDate();
				if(v<10) returnValue += '0'+v;
				else returnValue += v;
				returnValue += '.';			
				// Month
				v = d.getMonth()+1;
				if(v<10) returnValue += '0'+v;
				else returnValue += v;
				returnValue += '.';
				// Year
				returnValue += d.getFullYear();
			}
			if(options != 'noTime') {
				if(options != 'noDate') returnValue += ' ';
				// Hour
				v = d.getHours();
				if(v<10) returnValue += '0'+v;
				else returnValue += v;
				returnValue += ':';
				// Minute
				v = d.getMinutes();
				if(v<10) returnValue += '0'+v;
				else returnValue += v;
				if(options != 'noSeconds') {
					returnValue += ':';
					// Seconds
					v = d.getSeconds();
					if(v<10) returnValue += '0'+v;
					else returnValue += v;
				}
			}
			
			return returnValue;
		});
		
		ncddoc(function(){/**
		 * Serializes an XML Dom object to string
		 * @param XMLDocument xmlDom an XML DOM document as created by calling jQuery.parseXML
		 * @return String XML serialized
		*/},
		wigiiApi.xml2string = function(xmlDom) {
			return (typeof XMLSerializer!=="undefined") ? 
					(new window.XMLSerializer()).serializeToString(xmlDom) : 
					xmlDom.xml;
		});
		
		ncddoc(function(){/**
		 * throws a ServiceException::NOT_IMPLEMENTED exception
		*/},
		wigiiApi.throwNotImplemented = function() {
			throw new wigiiApi.ServiceException("not implemented", wigiiApi.errorCodes.NOT_IMPLEMENTED);
		});
		
		ncddoc(function(){/**
		 * throws a ServiceException 
		*/},
		wigiiApi.createServiceException = function(message,code,previous) {
			return new wigiiApi.ServiceException(message, code, previous);
		});
		
		ncddoc(function(){/**
		 * Publishes an exception that cannot be handled
		*/},
		wigiiApi.publishException = function(exception) {
			wigiiApi.getExceptionSink().publish(exception);
		});
		
		ncddoc(function(){/**
		 * Converts an exception to HTML code that can be displayed
		 * @param Object|XML exception an exception object {name:string,code:int,message:string}
		 * @param Object|XML context if defined, then information about server context in the form 
		 * {request:string, wigiiNamespace:string, module:string, action:string, realUsername:string, username:string, principalNamespace:string, version:string}
		*/},
		wigiiApi.exception2html = function(exception,context) {
			var htmlb = wigiiApi.getHtmlBuilder();
			// if exception is not a plain object, then assumes its some xml
			if(!$.isPlainObject(exception)) {
				exception = $(exception);
				exception = {
					name: exception.find('name').text(),
					code: exception.find('code').text(),
					message: exception.find('message').text()
				};
			}
			
			htmlb.putStartTag('h2').put(exception.code).prepend(' ',wigiiApi.errorLabels[exception.code]).putEndTag('h2');
			htmlb.putStartTag('p').implode(' : ',exception.name,exception.message).putEndTag('p');
			if(context) {
				// if context is not a plain object, then assumes its some xml
				if(!$.isPlainObject(context)) {
					context = $(context);
					context = {
						request: context.find('request').text(),
						wigiiNamespace: context.find('wigiiNamespace').text(),
						module: context.find('module').text(),
						action: context.find('action').text(),
						realUsername: context.find('realUsername').text(),
						username: context.find('username').text(),
						principalNamespace: context.find('principalNamespace').text()
					}
				}
				
				htmlb.putStartTag('div','class','elementHistoric')
				.putStartTag('div', 'class', 'label SBB expanded','onclick',"$(this).toggleClass('expanded').toggleClass('collapsed');$(this).next().toggle();").put('Context').putEndTag('div')
				.putStartTag('table','style','display:table;').putStartTag('tbody');
				if(context.request) htmlb.putStartTag('tr','style','height:30px;').putStartTag('td','class','label').put('Request').putEndTag('td').putStartTag('td').put(context.request).putEndTag('td').putEndTag('tr');
				if(context.wigiiNamespace) htmlb.putStartTag('tr','style','height:35px;').putStartTag('td','class','label').put('Wigii Namespace').putEndTag('td').putStartTag('td').put(context.wigiiNamespace).putEndTag('td').putEndTag('tr');
				if(context.module) htmlb.putStartTag('tr','style','height:20px;').putStartTag('td','class','label').put('Module').putEndTag('td').putStartTag('td').put(context.module).putEndTag('td').putEndTag('tr');
				if(context.action) htmlb.putStartTag('tr','style','height:20px;').putStartTag('td','class','label').put('Action').putEndTag('td').putStartTag('td').put(context.action).putEndTag('td').putEndTag('tr');
				if(context.realUsername) htmlb.putStartTag('tr','style','height:20px;').putStartTag('td','class','label').put('Login').putEndTag('td').putStartTag('td').put(context.realUsername).putEndTag('td').putEndTag('tr');
				if(context.username) htmlb.putStartTag('tr','style','height:20px;').putStartTag('td','class','label').put('Role').putEndTag('td').putStartTag('td').put(context.username).putEndTag('td').putEndTag('tr');
				if(context.principalNamespace) htmlb.putStartTag('tr','style','height:35px;').putStartTag('td','class','label').put('User namespace').putEndTag('td').putStartTag('td').put(context.principalNamespace).putEndTag('td').putEndTag('tr');
				htmlb.putEndTag('tbody').putEndTag('table')
				.putEndTag('div');
			}			
			return htmlb.html();
		});
		
		ncddoc(function(){/**
		 * Calculates the left and top attributes of a box options according to some position options.
		 * Uses window (viewport) coordinate system and not document coordinates.
		 * @param jQuery.Event mouseEvent jQuery mouse event object (click, drag, etc.) 
		 * @param Object boxOptions an object containing {left,top,width,height} options.
		 * @param Object positionOptions the positioning options relative to mouse event of the form
		 *  {
		 *  position: String. One of 'N','NE','E','SE','S','SW','W','NW','center'.
		 *  offset: Int. Distance from mouse event coordinates to box limit.
		 *  preventCovering: Boolean. If true, then box doesn't overlap mouse event position, but can potentially overflow window limit.
		 *  By default, preventCovering is false, meaning that the box is always visible but can potentially cover mouse event position.
		 *  }
		 * @return Object box options updated
		*/},
		wigiiApi.positionBox = function(mouseEvent,boxOptions,positionOptions) {
			if(!boxOptions) boxOptions = {};
			var screenTop=undefined,screenLeft=undefined,boxTop=undefined,boxLeft=undefined;			
			if(!positionOptions) positionOptions = {};
			if(!positionOptions.referenceWindow) positionOptions.referenceWindow = $(window);
			var refWindowTop = 0, refWindowLeft = 0, refWindowOffset = positionOptions.referenceWindow.offset();
			if(refWindowOffset) {refWindowTop = refWindowOffset.top; refWindowLeft = refWindowOffset.left;}
			
			// if no mouseEvent then takes window center
			if(!mouseEvent) {			
				screenTop = Math.floor(positionOptions.referenceWindow.height()/2);
				screenLeft = Math.floor(positionOptions.referenceWindow.width()/2);	
				if(!positionOptions.position) positionOptions.position = 'center';
			}
			// else takes mouse position
			else {
				screenTop = mouseEvent.pageY-(refWindowTop > 0 ? refWindowTop:positionOptions.referenceWindow.scrollTop());
				screenLeft = mouseEvent.pageX-(refWindowLeft > 0 ? refWindowLeft:positionOptions.referenceWindow.scrollLeft());
				if(!positionOptions.position) positionOptions.position = 'SE';
				if(!positionOptions.position=='center' && !positionOptions.offset && positionOptions.offset!==0) positionOptions.offset=15;
			}
			// calculates boxTop and boxLeft
			switch(positionOptions.position) {
			case 'center': 
				boxTop = boxOptions.height/2;
				boxLeft = boxOptions.width/2;
				break;
			case 'N':
				boxTop = screenTop-positionOptions.offset-boxOptions.height;
				boxLeft = screenLeft-boxOptions.width/2;
				break;
			case 'NE':
				boxTop = screenTop-positionOptions.offset-boxOptions.height;
				boxLeft = screenLeft+positionOptions.offset;
				break;
			case 'E':
				boxTop = screenTop-boxOptions.height/2;
				boxLeft = screenLeft+positionOptions.offset;
				break;	
			case 'SE':
				boxTop = screenTop+positionOptions.offset;		
				boxLeft = screenLeft+positionOptions.offset;	
				break;
			case 'S':
				boxTop = screenTop+positionOptions.offset;
				boxLeft = screenLeft-boxOptions.width/2;
				break;
			case 'SW':
				boxTop = screenTop+positionOptions.offset;
				boxLeft = screenLeft-positionOptions.offset-boxOptions.width;
				break;	
			case 'W':
				boxTop = screenTop-boxOptions.height/2;
				boxLeft = screenLeft-positionOptions.offset-boxOptions.width;
				break;	
			case 'NW':
				boxTop = screenTop-positionOptions.offset-boxOptions.height;
				boxLeft = screenLeft-positionOptions.offset-boxOptions.width;
				break;
			}
			// keeps box fully visible except if preventCovering		
			if(!positionOptions.preventCovering) {				
				if(boxTop<0) boxTop = 0;
				if(boxLeft<0) boxLeft = 0;
				boxTop = Math.max(Math.min(boxTop,positionOptions.referenceWindow.height()-boxOptions.height-20),10);
				boxLeft = Math.max(Math.min(boxLeft,positionOptions.referenceWindow.width()-boxOptions.width-30),10);
			}
			boxOptions.left = Math.ceil(boxLeft);
			boxOptions.top = Math.ceil(boxTop);
			return boxOptions;
		});
		
		ncddoc(function(){/**
		 * Fills a drop-down (html select element) from an array. All existing options are flushed.
		 * @param JQuery selector JQuery selector on an existing select element
		 * @param Array array array of objects or values to fill the drop-down with
		 * @param String|Function value the name of a field in the object to be used as a drop-down value or a callback function computing the drop-down values.
		 * The callback function is of the form value(i,data,selector) where i=0..array.length, data = array[i], selector is the given JQuery selector to access the DOM context.
		 * The function should return a scalar value used a the drop-down value.
		 * @param String|Function label the name of a field in the object to be used as a drop-down label or a callback function computing the drop-down labels.
		 * The callback function is of the form label(i,data,selector) where i=0..array.length, data = array[i], selector is the given JQuery selector to access the DOM context.
		 * The function should return a scalar value used a the drop-down label.
		 * @param Object options a bag of options to customize the rendering process
		 * @return JQuery returns the updated select element
		*/},
		wigiiApi.fillDropDownFromArray = function(selector,array,value,label,options) {
			if(!selector) throw wigiiApi.createServiceException("selector cannot be empty", wigiiApi.errorCodes.INVALID_ARGUMENT);
			var currentVal = selector.val();
			var newVal='';
			// empties current drop-down
			selector.empty();
			if(array) {
				// checks arguments
				if(!$.isArray(array)) throw wigiiApi.createServiceException("fillDropDownFromArray needs an array", wigiiApi.errorCodes.INVALID_ARGUMENT);
				var isValFx=false;
				if($.isFunction(value)) isValFx=true;
				var isLabFx = false;
				if($.isFunction(label)) isLabFx=true;				
				// loops through array and creates html
				var html = wigiiApi.getHtmlBuilder();
				var v,l;				
				selector.append(html.reset().putStartTag('option','value',"").put("").putEndTag('option').html());
				for(var i=0;i<array.length;i++) {
					var data = array[i];
					var isObj = $.isPlainObject(data);
					// generates value
					if(isValFx) v = value(i,data,selector);
					else if(isObj) v = data[value];
					else v = data;
					if(currentVal==v) newVal=v;
					// generates label
					if(label) {
						if(isLabFx) l = label(i,data,selector);
						else if(isObj) l = data[label];
						else l = data;
					}					
					// no label, then takes value
					else l = v;
					// generates html
					selector.append(html.reset().putStartTag('option','value',v).put(l).putEndTag('option').html());
				}				
			}
			// if select2 drop-down, then triggers change to refresh the list
			selector.val(newVal).trigger('change');
			return selector;
		});
		
		// Link with WigiiExecutor.js
		
		wigiiApi.initContext = function() {
			wigiiApi.SITE_ROOT = window.SITE_ROOT;
			wigiiApi.EXEC_answerRequestSeparator = window.EXEC_answerRequestSeparator;
			wigiiApi.EXEC_answerParamSeparator = window.EXEC_answerParamSeparator;
			wigiiApi.EXEC_requestSeparator = window.EXEC_requestSeparator;			
		};
		wigiiApi.initContext();		
		wigiiApi.encHTML = window.encHTML;
		wigiiApi.decHTML = window.decHTML;
		wigiiApi.setCache = window.setCache;
		wigiiApi.setJSCache = window.setJSCache;
		wigiiApi.keepInCache = window.keepInCache;
		wigiiApi.clearKeepInCache = window.clearKeepInCache;
	}, 
	/*
	 * Default WigiiAPI instance
	 */
	wigiiApiInstance = new WigiiApi(), 
	/*
	 * WigiiAPI functional facade
	 */
	wigiiFacade = function(selector, options) {
		var wigiiApi = wigiiApiInstance;
		if(!selector) return wigiiApi;		
		var service = wigiiApi[selector];
		if(!service) throw new wigiiApi.ServiceException("service '"+selector+"' is not a valid Wigii API service", wigiiApi.errorCodes.INVALID_ARGUMENT);
		// if service is an object constructor, then returns a new instance
		if($.type(service)==='function') {
			if(options) return new service(options);
			else return new service();
		}
		// else returns singleton
		else return service;
	},
	/*
	 * WigiiAPI console attached to browser 
	 */
	wigiiApiConsoleInstance = undefined,
	wigiiApiConsole = function() {
		var wigiiApi = wigiiApiInstance;
		if(!wigiiApiConsoleInstance) {
			wigiiApiConsoleInstance = {
				popup : function() {
					if(!this['popupInstance']) {
						this.popupInstance = wigiiApi.createPopUpInstance($('body'), {
							id: 'wigiiApiConsole_'+wigiiApi.instantiationTime,
							title:'Wigii API Console'				
						});
					}
					return this.popupInstance;
				},
				clear : function() {
					if(this['popupInstance']) {
						this.popupInstance.remove();
						delete this['popupInstance'];
					}
				},
				debug : function(message) {
					this.popup().body().append("<p>"+wigiiApi.milliseconds2string()+" "+message+"</p>");
					this.popup().show();
				},	
				log : function(message) {
					this.popup().body().append("<p>"+wigiiApi.milliseconds2string()+" "+message+"</p>");
					this.popup().show();
				},
				error : function(message) {
					this.popup().body().append("<p>"+wigiiApi.milliseconds2string()+" "+message+"</p>");
					this.popup().show();
				}
			};
		}
		return wigiiApiConsoleInstance;
	};
	
	// Bootstrap
	window.wigii = wigiiFacade;
})(window,jQuery);


/**
 * Wigii JQuery plugin
 * Created by CWE on July 14th 2015
 */
(function($) {
	/**
	 * JQuery Wigii plugin
	 * @param String cmd selects a service or a command in the WigiiAPI which accepts a jQuery collection
	 * @param Object options a map of configuration options to be passed to the called service.
	 * @return JQuery|Any returns the service or command result if defined, or the JQuery collection if no specific result.
	 */
	$.fn.wigii = function(cmd, options) {
		var wigiiApi = wigii();		
		var returnValue = undefined;
		try {
			if(!cmd) throw wigiiApi.createServiceException("cmd cannot be null",wigiiApi.errorCodes.INVALID_ARGUMENT);			
			var jQueryHandler = wigiiApi.getJQueryService()[cmd];
			if(!jQueryHandler || $.type(jQueryHandler) !== 'function') throw wigiiApi.createServiceException("Wigii API JQueryService does not support the '"+cmd+"' command.",wigiiApi.errorCodes.UNSUPPORTED_OPERATION);
			returnValue = jQueryHandler(this,options);
		}
		catch(e) {wigiiApi.publishException(e);}
		if(returnValue) return returnValue;
		else return this;		
	};
})(jQuery);
