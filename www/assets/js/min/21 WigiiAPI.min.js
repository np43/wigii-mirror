window.sm=window.smaller=function(d,c){return d<c};window.gr=window.greater=function(d,c){return d>c};window.smeq=window.smallerOrEqual=function(d,c){return d<=c};window.greq=window.greaterOrEqual=function(d,c){return d>=c};(function(window,$){var WigiiStdFL=function(api){var wigiiApi=api||wigii();var wigiiStdFL=this;wigiiStdFL.currentFx;wigiiStdFL.evaluateArg=function(arg){if($.type(arg)==="function"){return arg()}else{return arg}};wigiiStdFL.FuncExpEvalException=function(message,code,previous){var self=this;self.name="FuncExpEvalException";self.message=message;self.code=code||wigiiApi.errorCodes.UNKNOWN_ERROR;self.previousException=previous};wigiiStdFL.createFuncExpEvalException=function(message,code,previous){return new wigiiStdFL.FuncExpEvalException(message,code,previous)};wigiiStdFL.ctlIf=function(condition,ifTrue,ifFalse){var fl=wigiiStdFL;return function(){if(fl.evaluateArg(condition)){return fl.evaluateArg(ifTrue)}else{return fl.evaluateArg(ifFalse)}}};wigiiStdFL.ctlSeq=function(){var fl=wigiiStdFL,args=$.makeArray(arguments);return function(){if(args){var returnValue=undefined;for(var i=0;i<args.length;i++){returnValue=fl.evaluateArg(args[i])}return returnValue}}};wigiiStdFL.logAnd=function(){var fl=wigiiStdFL,args=$.makeArray(arguments);return function(){if(!args||args.length<2){throw fl.createFuncExpEvalException("For logical AND, the number of arguments should be at least 2",wigiiApi.errorCodes.INVALID_ARGUMENT)}for(var i=0;i<args.length;i++){if(!fl.evaluateArg(args[i])){return false}}return true}};wigiiStdFL.logOr=function(){var fl=wigiiStdFL,args=$.makeArray(arguments);return function(){if(!args||args.length<2){throw fl.createFuncExpEvalException("For logical OR, the number of arguments should be at least 2",wigiiApi.errorCodes.INVALID_ARGUMENT)}for(var i=0;i<args.length;i++){if(fl.evaluateArg(args[i])){return true}}return false}};wigiiStdFL.logNot=function(arg){var fl=wigiiStdFL;return function(){return !fl.evaluateArg(arg)}};wigiiStdFL.eq=function(){var fl=wigiiStdFL,args=$.makeArray(arguments);return function(){if(!args||args.length<2){throw fl.createFuncExpEvalException("For equality, the number of arguments should be at least 2",wigiiApi.errorCodes.INVALID_ARGUMENT)}var first=true,firstVal=undefined;for(var i=0;i<args.length;i++){if(first){firstVal=fl.evaluateArg(args[i]);first=false}else{if(fl.evaluateArg(args[i])!=firstVal){return false}}}return true}};wigiiStdFL.sm=function(){var fl=wigiiStdFL,args=$.makeArray(arguments);return function(){if(!args||args.length<2){throw fl.createFuncExpEvalException("For comparison, the number of arguments should be at least 2",wigiiApi.errorCodes.INVALID_ARGUMENT)}var first=true,firstVal=undefined;for(var i=0;i<args.length;i++){if(first){firstVal=fl.evaluateArg(args[i]);first=false}else{if(firstVal>=fl.evaluateArg(args[i])){return false}}}return true}};wigiiStdFL.gr=function(){var fl=wigiiStdFL,args=$.makeArray(arguments);return function(){if(!args||args.length<2){throw fl.createFuncExpEvalException("For comparison, the number of arguments should be at least 2",wigiiApi.errorCodes.INVALID_ARGUMENT)}var first=true,firstVal=undefined;for(var i=0;i<args.length;i++){if(first){firstVal=fl.evaluateArg(args[i]);first=false}else{if(firstVal<=fl.evaluateArg(args[i])){return false}}}return true}};wigiiStdFL.smeq=function(){var fl=wigiiStdFL,args=$.makeArray(arguments);return function(){if(!args||args.length<2){throw fl.createFuncExpEvalException("For comparison, the number of arguments should be at least 2",wigiiApi.errorCodes.INVALID_ARGUMENT)}var first=true,firstVal=undefined;for(var i=0;i<args.length;i++){if(first){firstVal=fl.evaluateArg(args[i]);first=false}else{if(firstVal>fl.evaluateArg(args[i])){return false}}}return true}};wigiiStdFL.greq=function(){var fl=wigiiStdFL,args=$.makeArray(arguments);return function(){if(!args||args.length<2){throw fl.createFuncExpEvalException("For comparison, the number of arguments should be at least 2",wigiiApi.errorCodes.INVALID_ARGUMENT)}var first=true,firstVal=undefined;for(var i=0;i<args.length;i++){if(first){firstVal=fl.evaluateArg(args[i]);first=false}else{if(firstVal<fl.evaluateArg(args[i])){return false}}}return true}}};var WigiiApi=function(){var wigiiApi=this;wigiiApi.instantiationTime=(new Date()).getTime();wigiiApi.ctxKey="Wigii_"+wigiiApi.instantiationTime;wigiiApi.context={};wigiiApi.holdJsCodeAnswers=function(bool){if(bool===undefined){return wigiiApi.context.holdJsCodeAnswers}else{wigiiApi.context.holdJsCodeAnswers=bool}};wigiiApi.errorCodes={UNAUTHORIZED:401,FORBIDDEN:403,NOT_FOUND:404,UNKNOWN_ERROR:1000,NOT_IMPLEMENTED:1001,WRAPPING:1002,UNSUPPORTED_OPERATION:1003,INVALID_ARGUMENT:1004,UNEXPECTED_ERROR:1005,DATA_INTEGRITY_ERROR:1006,DEPRECATED:1007,INVALID_STATE:1008,CONFIGURATION_ERROR:1009,OPERATION_CANCELED:1010,OUT_OF_BOUND:3100,ALREADY_EXISTS:3101,DOES_NOT_EXIST:3102,SYMBOL_NOT_FOUND:4600,INVALID_RETURN_VALUE:4601,VARIABLE_NOT_DECLARED:4602,DIVISION_BY_ZERO:4603,ASSERTION_FAILED:4604};wigiiApi.initializeErrorLabels=function(){if(!wigiiApi.errorLabels){wigiiApi.errorLabels={};for(var errName in wigiiApi.errorCodes){wigiiApi.errorLabels[wigiiApi.errorCodes[errName]]=errName}}};wigiiApi.initializeErrorLabels();wigiiApi.ServiceException=function(message,code,previous){var self=this;self.name="ServiceException";self.message=message;self.code=code||wigiiApi.errorCodes.UNKNOWN_ERROR;self.previousException=previous};wigiiApi.DebugLogger=function(typeName){var self=this;self.attachedClass=typeName;self.enabled=true;self.write=function(message){if(self.enabled){wigiiApiConsole().debug("DEBUG "+self.attachedClass+" : "+message)}};self.writeIf=function(condition,message){if(self.enabled&&condition){wigiiApiConsole().debug("DEBUG "+self.attachedClass+" : "+message)}};self.logBeginOperation=function(operation){self.write("BEGIN "+operation)};self.logEndOperation=function(operation){self.write("END "+operation)}};wigiiApi.ExceptionSink=function(){var self=this;self.publish=function(exception){while($.type(exception)==="object"&&exception.code==wigiiApi.errorCodes.WRAPPING&&exception.previousException){exception=exception.previousException}var exceptionType=$.type(exception);if(exceptionType==="object"){name=exception.name||"ServiceException";code=exception.code||wigiiApi.errorCodes.UNKNOWN_ERROR;message=exception.message||"No message"}else{if(exceptionType==="array"){name="ServiceException";code=wigiiApi.errorCodes.UNKNOWN_ERROR;message="Array"}else{if(exception){name="ServiceException";code=wigiiApi.errorCodes.UNKNOWN_ERROR;message=exception}else{name="ServiceException";code=wigiiApi.errorCodes.UNKNOWN_ERROR;message="UNKNOWN_ERROR"}}}var errorMessage="EXCEPTION "+name+"   code:"+code+"\n"+message;try{wigiiApiConsole().error(errorMessage)}catch(e){alert(errorMessage+"\n\n(note: using browser alert because WigiiAPIConsole is not working)")}}};wigiiApi.PopUp=function(anchor,options){var self=this;if(!anchor){anchor=$("body")}else{anchor=$(anchor)}if(!options){options={}}if(options.resizable!==false){options.resizable=true}if(options.closeable!==false){options.closeable=true}self.show=function(eventHandler){if($.isFunction(eventHandler)){if(!self.showEventSubscribers){self.showEventSubscribers=[]}self.showEventSubscribers.push(eventHandler)}else{if(self.popupElt){$(self.popupElt).show();if(!self.isVisible){self.isVisible=true;if(self.isRelativeToAnchor){anchor.parent().css("overflow","visible")}if(self.resetOnShow&&self.defaultOptions){var w=self.window();w.css("top",self.defaultOptions.top).css("left",self.defaultOptions.left);if(self.defaultOptions.width&&self.defaultOptions.height){w.css("height",self.defaultOptions.height+20).css("width",self.defaultOptions.width).resize()}self.body().scrollTop(0).scrollLeft(0)}if(self.showEventSubscribers){for(var i=0;i<self.showEventSubscribers.length;i++){var handler=self.showEventSubscribers[i];if($.isFunction(handler)){handler(self)}}}}}}return self};self.hide=function(eventHandler){if($.isFunction(eventHandler)){if(!self.hideEventSubscribers){self.hideEventSubscribers=[]}self.hideEventSubscribers.push(eventHandler)}else{if(self.popupElt){$(self.popupElt).hide();if(self.isVisible){self.isVisible=false;if(self.isRelativeToAnchor){anchor.parent().css("overflow","")}if(self.hideEventSubscribers){for(var i=0;i<self.hideEventSubscribers.length;i++){var handler=self.hideEventSubscribers[i];if($.isFunction(handler)){handler(self)}}}}}}return self};self.toggle=function(){if(self.isVisible){self.hide()}else{self.show()}};self.remove=function(eventHandler){if($.isFunction(eventHandler)){if(!self.removeEventSubscribers){self.removeEventSubscribers=[]}self.removeEventSubscribers.push(eventHandler)}else{if(self.popupElt){$(self.popupElt).remove();self.isVisible=false;delete self.popupElt;if(self.removeEventSubscribers){for(var i=0;i<self.removeEventSubscribers.length;i++){var handler=self.removeEventSubscribers[i];if($.isFunction(handler)){handler(self)}}}}}return self};self.html=function(htmlString){var b=self.body();if(b){if($.isFunction(htmlString)){htmlString(b,self)}else{b.html(htmlString)}if(b.children().size()>0){b.css("height",b.height()+1)}}if(b.children().size()>0&&self.defaultOptions&&!self.defaultOptions.width&&!self.defaultOptions.height){var w=self.window();self.defaultOptions.width=w.width();self.defaultOptions.height=w.height()}};self.window=function(){if(self.popupElt){return $(self.popupElt)}};self.body=function(){if(self.popupElt){return $(self.popupElt).find("div.popupBody")}};var insertIntoAnchor=anchor.is("body")||(options.domInsertionMode=="append");if(insertIntoAnchor&&!options.id&&!options.classId){options.id="popup_"+(new Date()).getTime()}if(!options.referenceWindow){options.referenceWindow=$(window)}var popupSelector=(options.id?"#"+options.id:(options.classId?"."+options.classId:undefined));var title=options.title;var width=options.width||Math.round(options.referenceWindow.width()/3);var height=options.height||Math.round(options.referenceWindow.height()/3);var top=options.top||Math.max(0,(options.referenceWindow.height()-height)/2);var left=options.left||Math.max(0,(options.referenceWindow.width()-width)/2);var popupPosition="fixed";if(options.relativeToAnchor&&!anchor.is("body")){var anchorOffset=anchor.offset();var parentOffset=anchor.parent().offset();top=top+(anchorOffset.top-parentOffset.top);left=left+(anchorOffset.left-parentOffset.left);anchor.parent().css("position","relative").css("overflow","visible");popupPosition="absolute";if(!self.isRelativeToAnchor){self.isRelativeToAnchor=true}}var popupHtml="<div";if(options.id){popupHtml+=' id="'+options.id+'"'}popupHtml+=' class="'+(options.classId&&!options.id?options.classId:"")+' ui-corner-all ui-widget ui-dialog SBIB"';popupHtml+=' style="cursor:default;z-index:998;position:'+popupPosition+";background-color:#fff;border-style:solid;border-width:1px;top:"+top+"px;left:"+left+"px;padding:5px;width:"+width+"px;height:auto;max-height:"+height+'px;display:none;float:none;border-color:black;"';popupHtml+=">";if(title){popupHtml+='<div class="popupTitle ui-corner-all ui-widget-header" style="'+(options.resizable?"cursor:move;":"")+"float:left;font-style:normal;font-weight:bold;font-size:small;text-align:left;padding-left:13px;padding-right:0;padding-top:5px;padding-bottom:5px;margin:0;color:black;min-height:14px;width:"+(width-13)+'px" >'+title+"</div>"}else{popupHtml+='<div class="popupTitle emptyTitle ui-corner-all" style="'+(options.resizable?"cursor:move;":"")+"float:left;z-index:999;position:absolute;right:4px;top:-10px;font-style:normal;font-weight:bold;font-size:small;text-align:left;padding-left:13px;padding-right:0;padding-top:5px;padding-bottom:5px;margin:0;color:black;height:14px;width:"+(width-10)+'px" >&nbsp;</div>'}if(options.closeable){if(title){popupHtml+='<div class="exit ui-corner-all" style="z-index:999;position:absolute;right:6px;top:8px;cursor:pointer;width:15px;height:17px;float:right;text-align:center;vertical-align:middle;color:black;font-weight:bold;font-style:normal;font-size:small;padding:0;margin:0">x</div>'}else{popupHtml+='<div class="exit ui-corner-all SBIB" style="z-index:999;position:absolute;right:-2px;top:-3px;cursor:pointer;width:15px;height:17px;float:right;background-color:#fff;border-style:solid;border-width:1px;text-align:center;vertical-align:middle;color:black;font-weight:bold;font-style:normal;font-size:small;padding:0;margin:0;border-color:black">x</div>'}}popupHtml+='<div class="clear"></div>';popupHtml+='<div class="popupBody" style="z-index:998;cursor:default;float:left;font-weight:normal;font-style:normal;font-size:small;text-align:left;padding:0;margin:0;margin-top:1px;color:black;overflow-y:auto;height:auto;max-height:'+(title?height-40:height-8)+"px;width:"+(width-9)+'px;"><br/></div></div>';if(insertIntoAnchor){anchor.find(popupSelector).remove();anchor.append(popupHtml);self.popupElt=anchor.find(popupSelector)}else{if(popupSelector){anchor.parent().find(popupSelector).remove()}anchor.after(popupHtml);self.popupElt=anchor.next()}if(options.resetOnShow){self.defaultOptions={top:top,left:left};if(!options.resizable){self.defaultOptions.width=width;self.defaultOptions.height=height}self.resetOnShow=true}if(options.resizable){self.popupElt.draggable({handle:".popupTitle"}).resizable().resize(function(event){event.stopPropagation();$(this).css("min-width","0").css("min-height","0").css("max-width","none").css("max-height","none");var body=$(this).find("div.popupBody");body.css("min-width","0").css("min-height","0").css("max-width","none").css("max-height","none").width($(this).width()-5);var title=$(this).find("div.popupTitle");if(title.hasClass("emptyTitle")){title.width($(this).width()-10);body.height($(this).height()-8)}else{title.width($(this).width()-13);body.height($(this).height()-28)}})}if(options.closeable){var closeHandler=undefined;if(options.removeOnClose){closeHandler=function(event){self.remove();event.stopPropagation()}}else{closeHandler=function(event){self.hide();event.stopPropagation()}}self.popupElt.find("div.exit").click(closeHandler)}self.body().mousedown(function(event){event.stopPropagation()})};wigiiApi.HelpService=function(){var self=this;self.className="HelpService";self.ctxKey=wigiiApi.ctxKey+"_"+self.className;self.debugLogger=wigiiApi.getDebugLogger(self.className);self.html=function(htmlString,context){if(context&&context.popup){context.popup.html(htmlString);context.popup.show()}};self.json=function(object,context){if(!$.isPlainObject(object)){return}else{if(object.exception){self.html(wigiiApi.exception2html(object.exception,object.context),context)}else{if(object.notification){self.showNotification(object.notification)}}}};self.showHelp=function(content,anchor,options){options.referenceWindow=anchor.parentsUntil("#scrollElement").last().parent();if(options.referenceWindow.attr("id")!="scrollElement"||isWorkzoneViewDocked()){options.referenceWindow=anchor.parentsUntil("#elementDialog").last().parent()}var context=anchor.data(self.ctxKey);if(!context){context={};if(!options.top&&!options.left){var anchorOffset=anchor.offset();var scrollLeft=options.referenceWindow.scrollLeft();var scrollTop=options.referenceWindow.scrollTop();var refWindowOffset=options.referenceWindow.offset();if(refWindowOffset&&(refWindowOffset.top>0||refWindowOffset.left>0)){scrollLeft=refWindowOffset.left;scrollTop=refWindowOffset.top}switch(options.position){case"SE":case"S":case"SW":options.height=Math.max(options.height,options.referenceWindow.height()-(anchorOffset.top-scrollTop)-options.offset-15);break;case"center":options.height=Math.max(options.height,Math.floor(options.referenceWindow.height()/2));break}wigiiApi.positionBox({pageX:anchorOffset.left,pageY:anchorOffset.top},options,options);options.top=options.top-(anchorOffset.top-scrollTop);options.left=options.left-(anchorOffset.left-scrollLeft);options.relativeToAnchor=true}else{options.relativeToAnchor=false}context.popup=wigiiApi.createPopUpInstance(anchor,options);if(options.type=="help"){fh=anchor.parents("div.field").first().wigii("FieldHelper");if(fh.ctxKey){fh=fh.formHelper();context.popup.show(fh.onHelpPopupShow);context.popup.hide(fh.onHelpPopupHide)}}context.popup.show();if(options.localContent){context.popup.html(content)}else{$.ajax({url:wigiiApi.buildUpdateUrl(content),cache:false,success:wigiiApi.buildUpdateCallback(context)})}if(options.relativeToAnchor){var w=context.popup.window();options.height=w.height();options.width=w.width();wigiiApi.positionBox({pageX:anchorOffset.left,pageY:anchorOffset.top},options,options);options.top=options.top-(anchorOffset.top-scrollTop);if(context.popup.defaultOptions){context.popup.defaultOptions.top=options.top}w.css("top",Math.ceil(options.top))}anchor.data(self.ctxKey,context);if(options.removeOnClose){context.popup.remove(function(){anchor.remove()})}}else{context.popup.show()}};self.toggleHelp=function(content,anchor,options){var context=anchor.data(self.ctxKey);if(context){context.popup.toggle()}else{self.showHelp(content,anchor,options)}};self.showFloatingHelp=function(container,mouseEvent,content,options){if(!container){container=$("body")}if(!options){options={}}if(!options.type){options.type="help"}if(!options.width){options.width=400}if(!options.height){options.height=400}if(!options.position&&!options.top&&!options.left){options.position="SE"}if(!options.offset&&!options.top&&!options.left){options.offset=0}options.removeOnClose=true;options.domInsertionMode="append";if(!options.top&&!options.left){switch(options.position){case"SE":case"S":case"SW":if(mouseEvent){options.height=Math.max(options.height,$(window).height()-(mouseEvent.pageY-$(window).scrollTop())-options.offset-15)}else{options.height=Math.max(options.height,Math.floor($(window).height()/2))}break;case"center":options.height=Math.max(options.height,Math.floor($(window).height()/2));break}wigiiApi.positionBox(mouseEvent,options,options)}var context={};context.popup=wigiiApi.createPopUpInstance(container,options);context.popup.show();if(options.localContent){context.popup.html(content)}else{$.ajax({url:wigiiApi.buildUpdateUrl(content),cache:false,success:wigiiApi.buildUpdateCallback(context)})}};self.renderHelpAnchor=function(container,content,options){if(!container){return}if(!options){options={}}if(!options.type){options.type="help"}if(!options.domInsertionMode){options.domInsertionMode="append"}if(!options.width){options.width=400}if(!options.height){options.height=400}if(!options.position&&!options.top&&!options.left){options.position="SE"}if(!options.offset&&!options.top&&!options.left){options.offset=15}options.resetOnShow=true;var ctxKey=self.ctxKey+"_"+options.type;var helpAnchor="";switch(options.type){case"help":helpAnchor="helpAnchor";break;case"warning":helpAnchor="warningAnchor";break;case"error":helpAnchor="errorAnchor";break;case"notif":helpAnchor="notifAnchor";break;case"search":helpAnchor="searchAnchor";break;case"info":default:helpAnchor="infoAnchor"}var helpSpan='<a class="'+ctxKey+" HelpService "+helpAnchor+'"></a>';var neighbor=undefined;switch(options.domInsertionMode){case"append":container.append(helpSpan);helpSpan=container.find("a."+ctxKey);neighbor=helpSpan.prev();if(neighbor.is("a")){neighbor=helpSpan.prevUntil("div,span,select").last().prev()}break;case"after":container.after(helpSpan);helpSpan=container.next("a."+ctxKey);break;default:helpSpan=undefined}if(helpSpan){if(neighbor){var w=neighbor.width();if(neighbor.hasClass("flex")||neighbor.hasClass("chosen")){var cssW=neighbor.css("width");if(cssW&&cssW.indexOf("%")>=0){cssW=undefined}if(!cssW){cssW=neighbor.css("max-width")}if(!cssW){cssW=neighbor.parent().css("max-width")}if(cssW){try{w=Number.parseInt(cssW.replace("px",""))-5}catch(exc){}}}if(w>=75){neighbor.width(w-25);neighbor.css("width",(w-25)+"px").resize()}neighbor.children("div,span,select").each(function(){var e=$(this);w=e.width();if(w>=75){e.width(w-25);e.css("width",(w-25)+"px").resize()}})}options.domInsertionMode="after";if(options.position=="blank"){helpSpan.attr("href",content).attr("target","_blank")}else{helpSpan.off().click(function(event){var e=$(this);wigiiApi.getHelpService().toggleHelp(content,e,options);event.stopPropagation()})}}};self.showNotification=function(notif){if(!$.isPlainObject(notif)){return}if(!notif.url){return}if(notif.target!="elementDialog"){notif.target="searchBar"}if(!notif.type){notif.type="info"}var wigiiNotif=undefined;if(notif.target=="searchBar"){if(notif.type=="help"){var wigiiHelp=$("#searchBar .toolbarBox .moduleHelp");if(wigiiHelp.length==0){$("#searchBar .toolbarBox").prepend('<div class="moduleHelp"/>');wigiiNotif=$("#searchBar .toolbarBox .moduleHelp")}else{wigiiHelp.empty();wigiiNotif=wigiiHelp}notif.position="SW";if(!notif.width){notif.width=800}if(!notif.height){notif.height=400}}else{wigiiNotif=$("#searchBar .toolbarBox .wigiiNotif");if(wigiiNotif.length==0){$("#searchBar .toolbarBox").append('<div class="wigiiNotif" style="padding-right:3px;padding-left:3px;padding-top:3px;padding-bottom:3px;margin-right:10px;max-width:100%;overflow:hidden;"/>');wigiiNotif=$("#searchBar .toolbarBox .wigiiNotif")}}}else{if(notif.target=="elementDialog"){wigiiNotif=$("#elementDialog").parent().find(".wigiiNotif");if(wigiiNotif.length==0){if(isWorkzoneViewDocked()){$("#validTop").children().last().after('<div class="wigiiNotif" style=""/>');wigiiNotif=$("#validTop").find(".wigiiNotif")}else{$("#elementDialog").parent().find(".ui-dialog-titlebar-close").before('<div class="wigiiNotif" style="float:right;padding-right:3px;padding-left:3px;padding-top:3px;padding-bottom:3px;margin-right:10px;max-width:100%;overflow:hidden;"/>');wigiiNotif=$("#elementDialog").parent().find(".wigiiNotif")}}if(notif.type=="help"){var wigiiHelp=wigiiNotif.prev(".elementHelp");if(wigiiHelp.length==0){wigiiNotif.before('<div class="elementHelp" style="float:right;padding-right:3px;padding-left:0px;padding-top:3px;padding-bottom:3px;margin-right:10px;max-width:100%;overflow:hidden;"/>');if(isWorkzoneViewDocked()){wigiiNotif=$("#validTop .elementHelp");wigiiNotif.css("margin-top","25px")}else{wigiiNotif=$("#elementDialog").parent().find(".elementHelp")}}else{wigiiHelp.empty();wigiiNotif=wigiiHelp}notif.position="SW";if(!notif.width){notif.width=600}if(!notif.height){notif.height=300}}}}if(wigiiNotif){self.renderHelpAnchor(wigiiNotif,notif.url,notif)}};self.removePrependStar=function(collection){collection.each(function(){$(this).contents().each(function(){if($(this)[0].nodeType==3){if($(this)[0].nodeValue.indexOf("*")!=-1){$(this).remove();return false}}})})}};wigiiApi.FieldHelper=function(){var self=this;self.className="FieldHelper";self.ctxKey=wigiiApi.ctxKey+"_"+self.className;self.debugLogger=wigiiApi.getDebugLogger(self.className);self.attach=function(field,options){if(!field||field.length==0){return}if(field.length>1){self.list=field;self.$=field;self.options=options}else{if(field.length==1){self.context=field.data(self.ctxKey);if(!self.context){self.context={};field.data(self.ctxKey,self.context);var fieldInfo=field.attr("id");self.context.fieldId=fieldInfo;if(fieldInfo){fieldInfo=fieldInfo.split("__");if(fieldInfo.length>0){self.context.formId=fieldInfo[0]}if(fieldInfo.length>1){self.context.fieldName=fieldInfo[1]}}self.context.dataType=field.attr("data-wigii-datatype")}self.$=field}}};self.getIterator=function(){return wigiiApi.getFieldHelper()};self.iterate=function(iterator,actions){if($.type(actions)==="function"&&self.list){var options=self.options;self.list.each(function(i){var e=$(this);iterator.attach(e,options);actions()})}};self.forEachField=function(doAction){if($.isFunction(doAction)){if(self.list){var iterator=self.getIterator();self.iterate(iterator,function(){doAction(iterator)})}else{doAction(self)}}return self};self.setValue=function(value,subFieldName){if(self.list){var iterator=self.getIterator();var actions=function(){iterator.setValue(value,subFieldName)};self.iterate(iterator,actions)}else{if(subFieldName!=undefined){$("#"+self.fieldId()+" :input[name="+self.fieldName()+"_"+subFieldName+"]").val(value)}else{if($("#"+self.fieldId()+" :input").hasClass("htmlArea")){$("#"+self.fieldId()+" :input").ckeditor(function(textarea){$(textarea).ckeditor().val(value)})}else{$("#"+self.fieldId()+" :input").val(value)}}}return self};self.setNumValue=function(value){if(self.list){var iterator=self.getIterator();var actions=function(){iterator.setNumValue(value)};self.iterate(iterator,actions)}else{self.setValue(wigiiApi.txtNumeric(value))}return self};self.getValue=function(subFieldName){var returnValue=undefined;if(self.list){returnValue=[];var iterator=self.getIterator();var actions=function(){returnValue.push(iterator.getValue(subFieldName))};self.iterate(iterator,actions)}else{if(subFieldName!=undefined){if(self.formId()=="detailElement_form"){returnValue=$("#"+self.fieldId()+" div.value").html()}else{returnValue=$("#"+self.fieldId()+" :input[name="+self.fieldName()+"_"+subFieldName+"]").val()}}else{if($("#"+self.fieldId()+" :input").hasClass("htmlArea")){$("#"+self.fieldId()+" :input").ckeditor(function(textarea){returnValue=$(textarea).ckeditor().val()})}else{if(self.formId()=="detailElement_form"){returnValue=$("#"+self.fieldId()+" div.value").html()}else{returnValue=$("#"+self.fieldId()+" :input").val()}}}}return returnValue};self.getNumValue=function(){var returnValue=undefined;if(self.list){returnValue=[];var iterator=self.getIterator();var actions=function(){returnValue.push(iterator.getNumValue())};self.iterate(iterator,actions)}else{returnValue=wigiiApi.str2float(self.getValue())}return returnValue};self.getDbValue=function(){var returnValue=undefined;if(self.list){returnValue=[];var iterator=self.getIterator();var actions=function(){returnValue.push(iterator.getDbValue())};self.iterate(iterator,actions)}else{returnValue=self.$.find("div.value").attr("data-wigii-dbvalue");if(self.dataType()=="MultipleAttributs"&&returnValue!=""&&returnValue!=null){returnValue=returnValue.split(",")}else{if(returnValue==""||returnValue==null){returnValue=self.getValue()}}}return returnValue};self.sum=function(){var returnValue=0;self.forEachField(function(fh){returnValue+=fh.getNumValue()});return returnValue};self.ceilTo=function(number,fixed){var returnValue=undefined;if(self.list){returnValue=[];var iterator=self.getIterator();var actions=function(){returnValue.push(iterator.ceilTo(number,fixed))};self.iterate(iterator,actions)}else{self.setNumValue(wigiiApi.ceilTo(self.getNumValue(),number,fixed));returnValue=self.getNumValue()}return returnValue};self.value=function(subFieldName){return self.getValue(subFieldName)};self.fieldId=function(){var returnValue=undefined;if(self.list){returnValue=[];var iterator=self.getIterator();var actions=function(){returnValue.push(iterator.fieldId())};self.iterate(iterator,actions)}else{if(self.context){returnValue=self.context.fieldId}}return returnValue};self.fieldName=function(){var returnValue=undefined;if(self.list){returnValue=[];var iterator=self.getIterator();var actions=function(){returnValue.push(iterator.fieldName())};self.iterate(iterator,actions)}else{if(self.context){returnValue=self.context.fieldName}}return returnValue};self.formId=function(){var returnValue=undefined;if(self.list){returnValue=[];var iterator=self.getIterator();var actions=function(){returnValue.push(iterator.formId())};self.iterate(iterator,actions)}else{if(self.context){returnValue=self.context.formId}}return returnValue};self.dataType=function(){var returnValue=undefined;if(self.list){returnValue=[];var iterator=self.getIterator();var actions=function(){returnValue.push(iterator.dataType())};self.iterate(iterator,actions)}else{if(self.context){returnValue=self.context.dataType}}return returnValue};self.formHelper=function(){var id=self.formId();if($.type(id)==="array"){if(id.length>1){id=wigii("ArrayHelper",id).filterDuplicates().array();if(id.length>1){throw wigiiApi.createServiceException("FieldHelper is currently attached to a set of fields not belonging to same Wigii Form, cannot create FormHelper",wigiiApi.errorCodes.INVALID_STATE)}}else{if(id.length==0){id=undefined}else{id=id[0]}}}if(id){return $("#"+id).wigii("FormHelper")}};self.onFormEvent=function(eventHandler,options){if(self.list){var iterator=self.getIterator();var actions=function(){iterator.onFormEvent(eventHandler,options)};self.iterate(iterator,actions)}else{if(self.context){if(!self.context.formEventSubscribers){self.context.formEventSubscribers=[];var fieldId=self.fieldId();var jQueryEventHandler=function(eventObject){var e=$(this);var fh=$("#"+fieldId).wigii("FieldHelper");if(fh.context&&fh.context.formEventSubscribers){var formId=fh.formId();var fieldName=fh.fieldName();var eventName=eventObject.type;if(eventName=="select2:open"){eventName="focus"}else{if(eventName=="select2:close"){eventName="blur"}}var formEvent=wigiiApi.createFormEventInstance(eventName,formId,fieldId,fieldName);var dataType=fh.dataType();formEvent.dataType(dataType);var subFieldName=e.attr("id");subFieldName=subFieldName.replace(formId+"_"+fieldName+"_","");subFieldName=subFieldName.split("_");subFieldName=subFieldName[0];if(dataType==="Addresses"&&subFieldName=="zip"){subFieldName="zip_code"}formEvent.subFieldName(subFieldName);formEvent.value(e.val());var subscribers=fh.context.formEventSubscribers;for(var i=0;i<subscribers.length;i++){var formEventHandler=subscribers[i];if(formEventHandler){var trigger=true;var opts=formEventHandler.options;if(opts){if(opts.eventName&&opts.eventName.indexOf(formEvent.eventName())===-1){trigger=false}if(opts.fieldName&&opts.fieldName.indexOf(formEvent.fieldName())===-1){trigger=false}if(opts.subFieldName&&opts.subFieldName.indexOf(formEvent.subFieldName())===-1){trigger=false}if(opts.dataType&&opts.dataType.indexOf(formEvent.dataType())===-1){trigger=false}}formEventHandler=formEventHandler.eventHandler;if($.type(formEventHandler)==="function"&&trigger){formEventHandler(formEvent)}}}}};$("#"+fieldId+" div.value").find("input,select,textarea").filter('[id^="'+self.formId()+"_"+self.fieldName()+'"]').on("change input focus blur select2:open select2:close",jQueryEventHandler)}self.context.formEventSubscribers.push({eventHandler:eventHandler,options:options})}}return self};self.change=function(eventHandler){if(self.list){var iterator=self.getIterator();var actions=function(){iterator.change(eventHandler)};self.iterate(iterator,actions)}else{if(self.context){if(eventHandler==undefined){return $("#"+self.fieldId()+" :input").change()}return $("#"+self.fieldId()+" :input").change(eventHandler)}}}};wigiiApi.FormHelper=function(){var self=this;self.className="FormHelper";self.ctxKey=wigiiApi.ctxKey+"_"+self.className;self.attach=function(wigiiForm,options){if(!wigiiForm||wigiiForm.length==0){return}if(wigiiForm.length>1){throw wigiiApi.createServiceException("Wigii FormHelper selector can only be activated on a JQuery collection containing one element and not "+selection.length,wigiiApi.errorCodes.INVALID_ARGUMENT)}self.context=wigiiForm.data(self.ctxKey);if(!self.context){self.context={};wigiiForm.data(self.ctxKey,self.context);self.context.formId=wigiiForm.attr("id")}self.$=wigiiForm};self.formId=function(){if(self.context){return self.context.formId}};self.elementId=function(){var sel=$("#elementDialog div.T");var elementId="";if(sel.length>0){elementId=sel.attr("href").replace("#","")}if(elementId==""){sel=self.$.find("input[name=elementId]");if(sel.length>0){elementId=sel.val()}}return elementId};self.field=function(fieldName){var returnValue=undefined;if($.isArray(fieldName)){returnValue=self.fields(fieldName)}else{if(fieldName){returnValue=$("#"+self.formId()+"__"+fieldName).wigii("FieldHelper")}}return returnValue};self.fields=function(selector){if($.isArray(selector)){return self.fields("#"+self.formId()+"__"+selector.join(", #"+self.formId()+"__"))}else{if(selector){return self.$.find("div.field[data-wigii-datatype]").filter(selector).wigii("FieldHelper")}else{return self.$.find("div.field[data-wigii-datatype]").wigii("FieldHelper")}}};self.val=function(fieldName,value,subFieldName){if(value!=undefined){self.field(fieldName).setValue(value,subFieldName)}return self.field(fieldName).getValue(subFieldName)};self.numVal=function(fieldName,value){if(value!=undefined){self.field(fieldName).setNumValue(value)}return self.field(fieldName).getNumValue()};self.dbVal=function(fieldName){return self.field(fieldName).getDbValue()};self.ceilTo=function(fieldName,number,fixed){return self.field(fieldName).ceilTo(number,fixed)};self.copyFields=function(fromFields,toFields,beforeTarget){var i=0;if(!$.isArray(toFields)){toFields=[toFields]}self.fields(fromFields).forEachField(function(field){var fieldHtml=field.$[0].outerHTML;fieldHtml=fieldHtml.replace(new RegExp(field.fieldName(),"g"),toFields[i]);if(beforeTarget==undefined){field.$.parent().append(fieldHtml)}else{field.formHelper().$.insertBefore(beforeTarget)}var newField=field.formHelper().field(toFields[i]);newField.$.find(".select2, .cke").remove();addJsCodeAfterFormIsShown("#"+newField.fieldId());i++});if(i>0){return self.fields(toFields)}};self.button=function(name,selector){if(!self.context.buttons){self.context.buttons={}}if(!self.context.buttons[name]){var btn=undefined;if(selector){btn=self.$.find(selector)}else{btn=self.$.find("button."+name);if(btn.length==0){btn=self.$.find("div."+name)}if(btn.length==0){btn=self.$.find("span."+name)}}self.context.buttons[name]=btn.wigii("ButtonHelper")}return self.context.buttons[name]};self.ok=function(){if(!self.context.buttons){self.context.buttons={}}if(!self.context.buttons.ok){var btn=undefined;if(isWorkzoneViewDocked()){btn=$("#elementDialog button.ok")}else{btn=$("#elementDialog").parent().find("button.ok")}self.context.buttons.ok=btn.wigii("ButtonHelper")}return self.context.buttons.ok};self.cancel=function(){if(!self.context.buttons){self.context.buttons={}}if(!self.context.buttons.cancel){var btn=undefined;if(self.formId()=="detailElement_form"){if(isWorkzoneViewDocked()){btn=$("#elementDialog div.T .el_closeDetails")}else{btn=$("#elementDialog").parent().find("button.ui-dialog-titlebar-close")}}else{if(isWorkzoneViewDocked()){btn=$("#elementDialog button.cancel")}else{btn=$("#elementDialog").parent().find("button.cancel")}}self.context.buttons.cancel=btn.wigii("ButtonHelper")}return self.context.buttons.cancel};self.title=function(title){if(title===undefined){if(!isWorkzoneViewDocked()){return $("#elementDialog").parent().find(".ui-dialog-title").html()}}else{if(!isWorkzoneViewDocked()){$("#elementDialog").parent().find(".ui-dialog-title").html(title)}return self}};self.tool=function(name){if(self.formId()!="detailElement_form"){throw wigiiApi.createServiceException("Standard Wigii toolbar is available only on element detail",wigiiApi.errorCodes.UNSUPPORTED_OPERATION)}if(!self.context.buttons){self.context.buttons={}}if(!self.context.buttons[name]){var btn=undefined;var mappedName=name;if(name=="link"){mappedName="sendLink"}if(name=="print"){mappedName="printDetails"}if(isWorkzoneViewDocked()){btn=$("#elementDialog div.T .el_"+mappedName)}else{btn=$("#elementDialog div.T .el_"+mappedName);if(btn.length==0){btn=$("#elementDialog").parent().find("div.ui-dialog-titlebar .el_"+mappedName)}}if(btn.length==0){$("#elementDialog div.T > div").last().after('<div class="H el_'+mappedName+'"></div>');btn=$("#elementDialog div.T .el_"+mappedName)}self.context.buttons[name]=btn.wigii("ButtonHelper")}return self.context.buttons[name]};self.launchCopy=function(dialogTitle,dialogIntro,urlArgs,defaultGroupId){var startUrl="elementDialog/"+crtWigiiNamespaceUrl+"/"+crtModuleName;var targetFolder=defaultGroupId;if(targetFolder===undefined){targetFolder=$("#groupPanel li.selected.write");if(targetFolder.length>0){targetFolder=targetFolder.attr("id").split("_")[1]}else{targetFolder=undefined}}var initialFolder=targetFolder;var itemID=self.elementId();if(urlArgs){urlArgs="/"+wigiiApi.buildUrlFragment(urlArgs)}prepareOrganizeDialog(function(e){if(!$(this).hasClass("disabled")){$("#organizeDialog .selected").removeClass("selected");$(this).toggleClass("selected");targetFolder=$(this).parent().attr("id").split("_")[1]}return false},function(){if(!targetFolder){jAlert(DIALOG_selectAtLeastOneGroup);return false}if($("#organizeDialog").is(":ui-dialog")){$("#organizeDialog").dialog("destroy")}invalidCache("moduleView");if(targetFolder!=initialFolder){startUrl="NoAnswer/"+crtWigiiNamespaceUrl+"/"+crtModuleName+"/groupSelectorPanel/selectGroup/"+targetFolder+EXEC_requestSeparator+startUrl}update(startUrl+"/element/copy/"+itemID+"/"+targetFolder+urlArgs)});$("#organizeDialog").prev().find(".ui-dialog-title").text(dialogTitle||DIALOG_copyToFolder);$("#organizeDialog").prepend('<div class="introduction">'+(dialogIntro||DIALOG_copyToFolder_help)+"</div>");$("#organizeDialog>.groupPanel li:not(.write)").addClass("disabled noRights");$("#organizeDialog>.groupPanel li:not(.write)>div").addClass("disabled noRights");if(targetFolder){$("#organizeDialog>.groupPanel #group_"+targetFolder+", #organizeDialog>.groupPanel #group_"+targetFolder+">div").addClass("selected")}unfoldToSelectedGroupButNotChildren("#organizeDialog>.groupPanel");positionSelectedGroup("#organizeDialog>.groupPanel");if(targetFolder){$("#organizeDialog").next().find("button.ok").focus()}};self.onFormEvent=function(eventHandler,options){if(self.context){if(!self.context.formEventSubscribers){self.context.formEventSubscribers=[];self.fields().onFormEvent(function(formEvent){var fh=$("#"+formEvent.formId()).wigii("FormHelper");if(fh.context&&fh.context.formEventSubscribers){var subscribers=fh.context.formEventSubscribers;for(var i=0;i<subscribers.length;i++){var formEventHandler=subscribers[i];if(formEventHandler){var trigger=true;var opts=formEventHandler.options;if(opts){if(opts.eventName&&opts.eventName.indexOf(formEvent.eventName())===-1){trigger=false}if(opts.fieldName&&opts.fieldName.indexOf(formEvent.fieldName())===-1){trigger=false}if(opts.subFieldName&&opts.subFieldName.indexOf(formEvent.subFieldName())===-1){trigger=false}if(opts.dataType&&opts.dataType.indexOf(formEvent.dataType())===-1){trigger=false}}formEventHandler=formEventHandler.eventHandler;if($.type(formEventHandler)==="function"&&trigger){formEventHandler(formEvent)}}}}})}self.context.formEventSubscribers.push({eventHandler:eventHandler,options:options})}return self};self.onHelpPopupShow=function(popup){if(self.context.helpPopup){self.context.helpPopup.hide();if(self.context.helpPopup!==popup){self.context.helpPopup=popup}}else{self.context.helpPopup=popup}};self.onHelpPopupHide=function(popup){if(self.context.helpPopup===popup){self.context.helpPopup=undefined}}};wigiiApi.ButtonHelper=function(btn,options){var self=this;self.className="ButtonHelper";self.ctxKey=wigiiApi.ctxKey+"_"+self.className;self.$=btn;self.label=function(l){if(l===undefined){return self.$.html()}else{self.$.html(l);return self}};self.click=function(eventHandler){if($.isFunction(eventHandler)){self.$.click(eventHandler)}else{self.$.click()}return self};self.disabled=function(bool){if(bool===undefined){return self.$.prop("disabled")}else{self.$.prop("disabled",(bool==true));return self}}};wigiiApi.WncdContainer=function(wncd){var self=this;self.className="WncdContainer";self.ctxKey=wigiiApi.ctxKey+"_"+self.className;self.impl={onDataChangeSubscribers:undefined,onElementDeletedSubscribers:undefined};self.reset=function(){self.impl.onDataChangeSubscribers=undefined;self.impl.onElementDeletedSubscribers=undefined};self.getWigiiDataModel=function(){if(!wncd){throw wigiiApi.createServiceException("wncd libraries have not been correctly loaded, wncd symbol is not available.",wigiiApi.errorCodes.UNSUPPORTED_OPERATION)}return wncd.program.context[wigiiApi.context.crtView]};self.dataChange=function(onDataChange){if($.isFunction(onDataChange)){if(!self.impl.onDataChangeSubscribers){self.impl.onDataChangeSubscribers=[]}self.impl.onDataChangeSubscribers.push(onDataChange)}else{if(onDataChange===undefined){if(self.impl.onDataChangeSubscribers){var dataModel=self.getWigiiDataModel();for(var i=0;i<self.impl.onDataChangeSubscribers.length;i++){var eh=self.impl.onDataChangeSubscribers[i];if($.isFunction(eh)){eh(self,dataModel)}}}}}return self};self.forEachElement=function(callback){self.iterateOnElementList(self.getWigiiDataModel(),callback);return self};self.iterateOnElementList=function(wigiiDataModel,callback){if(!wigiiDataModel){throw wigiiApi.createServiceException("wigiiDataModel cannot be null",wigiiApi.errorCode.INVALID_ARGUMENT)}if(!$.isFunction(callback)){throw wigiiApi.createServiceException("callback should be a function of the form callback(index,elementId, element)",wigiiApi.errorCode.INVALID_ARGUMENT)}var elementList=wigiiDataModel.elementList;if(elementList){var index=1;for(var eltId in elementList){var element=elementList[eltId];callback(index,element.__element.id,element);index++}}};self.showElement=function(elementId){update("elementDialog/"+crtWigiiNamespaceUrl+"/"+crtModuleName+"/element/detail/"+elementId)};self.editElement=function(elementId){update("elementDialog/"+crtWigiiNamespaceUrl+"/"+crtModuleName+"/element/edit/"+elementId)};self.deleteElement=function(elementId){update("elementDialog/"+crtWigiiNamespaceUrl+"/"+crtModuleName+"/element/delete/"+elementId+"/elementDialog")};self.elementDeleted=function(onElementDeleted){if($.isFunction(onElementDeleted)){if(!self.impl.onElementDeletedSubscribers){self.impl.onElementDeletedSubscribers=[]}self.impl.onElementDeletedSubscribers.push(onElementDeleted)}else{if(onElementDeleted){if(self.impl.onElementDeletedSubscribers){var elementId=onElementDeleted;for(var i=0;i<self.impl.onElementDeletedSubscribers.length;i++){var eh=self.impl.onElementDeletedSubscribers[i];if($.isFunction(eh)){eh(self,elementId)}}}}}return self};self.saveFieldValue=function(elementId,fieldName,value,options){options=options||{};options.caller="saveFieldValue";var target="Wigii_"+self.className;var autosaveForm={autoSaveFieldId:target,autoSaveMesssageTargetId:target,noCalculation:(options.noCalculation==true),noNotification:(options.noNotification==true)};if($.isPlainObject(value)){for(var subField in value){autosaveForm[fieldName+"_"+subField]=value[subField]}}else{autosaveForm[fieldName+"_value"]=value}setVis("busyDiv",true);$.ajax({type:"POST",url:wigiiApi.buildUpdateUrl(target+"/"+crtWigiiNamespaceUrl+"/"+crtModuleName+"/autoSave/"+elementId+"/"+fieldName),data:autosaveForm,success:wigiiApi.buildUpdateCallback(options)})};self.json=function(object,context){if(context){setVis("busyDiv",false);var exception=undefined;var exceptionContext=undefined;if($.isPlainObject(object)){if(object.exception){exception=object.exception;exceptionContext=object.context}}if(exception){if(!context.silent){if($.isFunction(context.exceptionHandler)){context.exceptionHandler(exception,exceptionContext)}else{wigiiApi.publishException(exception)}}}else{if($.isFunction(context.onSuccessCallback)){context.onSuccessCallback(object)}}}}};wigiiApi.HtmlBuilder=function(){var self=this;self.className="HtmlBuilder";self.ctxKey=wigiiApi.ctxKey+"_"+self.className;self.buffer="";self.jsBuffer=[];self.html=function(){return self.buffer};self.runJsCode=function(){for(var i=0;i<self.jsBuffer.length;i++){var jsCode=self.jsBuffer[i];if($.isFunction(jsCode)){jsCode()}}return self};self.reset=function(){self.buffer="";self.jsBuffer=[];return self};self.put=function(str){if(str){self.buffer+=str}return self};self.putNl2Br=function(str){if(typeof str==="undefined"||str===null){}else{self.buffer+=(str+"").replace(/([^>\r\n]?)(\r\n|\n\r|\r|\n)/g,"$1<br />$2")}return self};self.implode=function(sep){if(arguments.length>1){var i=1;var result="",value;while(i<arguments.length){value=arguments[i];if(value){if(result){result+=sep}result+=value}i++}self.buffer+=result}return self};self.prepend=function(prefix,str){if(str){self.buffer+=prefix+str}return self};self.putNbsp=function(multiplier){if(!multiplier){multiplier=1}for(var i=0;i<multiplier;i++){self.buffer+="&nbsp;"}return self};self.putQuot=function(str){if(str){self.buffer+="&quot;"+str+"&quot;"}else{self.buffer+="&quot;"}return self};self.putAmp=function(){self.buffer+="&amp;";return self};self.putLt=function(){self.buffer+="&lt;";return self};self.putGt=function(){self.buffer+="&gt;";return self};self.putApos=function(){self.buffer+="&apos;";return self};self.putHashTag=function(){self.buffer+="#";return self};self.putBrTag=function(multiplier){if(!multiplier){multiplier=1}for(var i=0;i<multiplier;i++){self.buffer+="<br />"}return self};self.putBr=self.putBrTag;self.putStartTag=function(tagName){if(!tagName){throw wigiiApi.createServiceException("putStartTag takes a non null tagName",wigiiApi.errorCodes.INVALID_ARGUMENT)}self.buffer+="<"+tagName;if(arguments.length>1){var i=1;var key,value;while(i<arguments.length){key=arguments[i];if(!key){throw wigiiApi.createServiceException("html attribute name cannot be null",wigiiApi.errorCodes.INVALID_ARGUMENT)}i++;if(i<arguments.length){value=arguments[i];i++}else{value=""}self.buffer+=" "+key+'="'+value+'"'}}self.buffer+=">";return self};self.putEndTag=function(tagName){if(!tagName){throw wigiiApi.createServiceException("putEndTag takes a non null tagName",wigiiApi.errorCodes.INVALID_ARGUMENT)}self.buffer+="</"+tagName+">";return self};self.putHtmlHeader=function(){self.buffer+='<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">';return self};self.putJsCode=function(actions){var actionType=$.type(actions);if(actionType==="function"){self.jsBuffer.push(actionType)}else{if(actionType==="string"){self.jsBuffer.push(function(){eval(actions)})}}return self};self.putHtmlBuilder=function(htmlBuilder){if(htmlBuilder){self.put(htmlBuilder.html());for(var i=0;i<htmlBuilder.jsBuffer.length;i++){self.putJsCode(htmlBuilder.jsBuffer[i])}}return self}};wigiiApi.ArrayHelper=function(arr){var self=this;self.className="ArrayHelper";self.ctxKey=wigiiApi.ctxKey+"_"+self.className;if($.type(arr)!=="array"){throw wigiiApi.createServiceException("arr should be an array",wigiiApi.errorCodes.INVALID_ARGUMENT)}self.arr=arr;self.clone=function(){self.arr=self.arr.slice();return self};self.sort=function(asc){if(asc!==false){asc=true}self.arr.sort();if(!asc){self.arr.reverse()}return self};self.filterDuplicates=function(){var d=self.distribution();self.arr=[];for(var val in d){self.arr.push(val)}return self};self.distribution=function(){var d={};for(var i=0;i<self.arr.length;i++){var val=self.arr[i];if(!val){val=""}var c=d[val];if(c){c+=1}else{c=1}d[val]=c}return d};self.array=function(){return self.arr}};wigiiApi.MatrixHelper=function(matrix,selectedRows){var self=this;self.className="MatrixHelper";self.ctxKey=wigiiApi.ctxKey+"_"+self.className;if($.type(matrix)!=="array"){throw wigiiApi.createServiceException("matrix should be an array",wigiiApi.errorCodes.INVALID_ARGUMENT)}self.matrix=matrix;self.selectedRows=selectedRows;self.currentFilter=[];self.next=undefined;self.previous=undefined;self.filter=function(col,value){var matchingRows=[];if(self.selectedRows){for(var i=0;i<self.selectedRows.length;i++){if(value==self.matrix[self.selectedRows[i]][col]){matchingRows.push(self.selectedRows[i])}}}else{for(var i=0;i<self.matrix.length;i++){if(value==self.matrix[i][col]){matchingRows.push(i)}}}var returnValue=new wigiiApi.MatrixHelper(self.matrix,matchingRows);returnValue.currentFilter=self.currentFilter.concat([col,value]);self.next=returnValue;returnValue.previous=self;var args;if(arguments.length>2){args=Array.prototype.slice.call(arguments,2)}else{args=[]}if(args.length>0){returnValue=returnValue.filter.apply(returnValue,args)}return returnValue};self.column=function(col,unique){var returnValue=(unique?{}:[]);if(self.selectedRows){for(var i=0;i<self.selectedRows.length;i++){var val=self.matrix[self.selectedRows[i]][col];if(unique){returnValue[val]=val}else{returnValue.push(val)}}}else{for(var i=0;i<self.matrix.length;i++){var val=self.matrix[i][col];if(unique){returnValue[val]=val}else{returnValue.push(val)}}}return(unique?Object.keys(returnValue):returnValue)};self.rows=function(){var returnValue=[];if(self.selectedRows){for(var i=0;i<self.selectedRows.length;i++){returnValue.push(self.matrix[self.selectedRows[i]])}}else{for(var i=0;i<self.matrix.length;i++){returnValue.push(self.matrix[i])}}return returnValue};self.clear=function(col){var returnValue=undefined;if(col!==undefined&&self.currentFilter.length>2&&self.currentFilter[self.currentFilter.length-3]!=col){var newSelection=[];var i=0;while(i<self.currentFilter.length){if(self.currentFilter[i]!=col){newSelection.push(self.currentFilter[i]);newSelection.push(self.currentFilter[i+1])}i+=2}returnValue=new wigiiApi.MatrixHelper(self.matrix);if(newSelection.length>0){returnValue=returnValue.filter.apply(newSelection)}}else{if(self.previous){self.previous.next=undefined;returnValue=self.previous;self.previous=undefined}else{returnValue=new wigiiApi.MatrixHelper(self.matrix)}}return returnValue};self.clearAll=function(){return new wigiiApi.MatrixHelper(self.matrix)}};wigiiApi.DropDownConstraint=function(selector,matrix){var self=this;self.className="DropDownConstraint";self.ctxKey=wigiiApi.ctxKey+"_"+self.className;self.matrixHelper=wigiiApi.getMatrixHelper(matrix);self.lock=false;if(self.matrixHelper.matrix.length>0){self.dropDowns=selector;if($.type(self.matrixHelper.matrix[0])!=="array"){self.fieldNames=[];self.dropDowns.each(function(){self.fieldNames.push($(this).closest("div.field").wigii("FieldHelper").fieldName())})}self.dropDownIndex=(self.fieldNames?{}:[]);self.dropDowns.each(function(){var dropDown=$(this);var col=self.dropDowns.index(dropDown);if(self.fieldNames){col=self.fieldNames[col]}var options={};dropDown.find("option").each(function(){var option=$(this);var val=option.attr("value");if(val!==""&&val!==null){options[val]={value:val,title:option.attr("title"),label:option.text()}}});self.dropDownIndex[col]=options});self.dropDowns.change(function(){if(self.lock){return}self.lock=true;var dropDown=$(this);var col=self.dropDowns.index(dropDown);if(self.fieldNames){col=self.fieldNames[col]}var newFilter=self.matrixHelper;var val=dropDown.val();if(val!==""&&val!==null){if(newFilter.currentFilter.length>0&&newFilter.currentFilter.indexOf(col)%2==0){newFilter=newFilter.clear(col)}newFilter=newFilter.filter(col,val)}else{newFilter=newFilter.clearAll()}self.dropDowns.each(function(){var dropDown=$(this);var currentVal=dropDown.val();var col=self.dropDowns.index(dropDown);if(self.fieldNames){col=self.fieldNames[col]}dropDown.empty();var colValues=newFilter.column(col,true);var dropDownValues=self.dropDownIndex[col];var html=wigiiApi.getHtmlBuilder();dropDown.append(html.reset().putStartTag("option","value","","title","").put("").putEndTag("option").html());var newVal="";for(var i=0;i<colValues.length;i++){var option=dropDownValues[colValues[i]];dropDown.append(html.reset().putStartTag("option","value",option.value,"title",option.title).put(option.label).putEndTag("option").html());if(currentVal==option.value){newVal=currentVal}}if(colValues.length==1){newVal=dropDownValues[colValues[0]].value}if(newFilter.currentFilter.length==0){newVal=""}dropDown.val(newVal).trigger("change")});self.matrixHelper=newFilter;self.lock=false});$(self.dropDowns[0]).trigger("change")}};wigiiApi.JQueryService=function(){var self=this;self.className="JQueryService";self.ctxKey=wigiiApi.ctxKey+"_"+self.className;self.bindHelpService=function(selection,options){var helpService=wigiiApi.getHelpService();var optionsFx=($.type(options)==="function");var visibleOverflowOnEnclosingValueDiv=function(startElt){var valueDiv=startElt.closest("div.value, div.field");if(valueDiv.length>0&&valueDiv.hasClass("value")){valueDiv.css("overflow","visible")}};if(options&&(options.content||optionsFx)){var contentFx=!optionsFx&&($.type(options.content)==="function");selection.each(function(i){var e=$(this);var content,opts;if(optionsFx){opts=options(e);content=opts.content}else{content=(contentFx?options.content(e):options.content);opts={};for(var attr in options){opts[attr]=options[attr]}}if(content){helpService.renderHelpAnchor(e,content,opts)}})}else{selection.each(function(i){var e=$(this);var content=undefined;var opts={width:(e.attr("data-popup-width")?e.attr("data-popup-width"):400),height:(e.attr("data-popup-height")?e.attr("data-popup-height"):400),type:(e.attr("data-popup-type")?e.attr("data-popup-type"):"help"),position:(e.attr("data-popup-position")?e.attr("data-popup-position"):"SE")};if(e.is("div.localContent")){content=e.html();opts.localContent=true;e=e.parent().find("div.value");if(content){helpService.renderHelpAnchor(e,content,opts)}}else{if(e.is("div.remoteContent")){content=e.text();opts.localContent=false;e=e.parent().find("div.value");if(content){helpService.renderHelpAnchor(e,content,opts)}}else{if(e.is("div.json")){content=e.html();if(content){content=JSON.parse(content);if(!content.width){content.width=opts.width}if(!content.height){content.height=opts.height}if(!content.type){content.type=opts.type}opts=content;e=e.parent().find("div.value");if(opts.content){helpService.renderHelpAnchor(e,opts.content,opts)}}}else{if(e.is("a")){content=e.attr("href");opts.localContent=false;opts.domInsertionMode="after";e.hide();visibleOverflowOnEnclosingValueDiv(e);if(content){helpService.renderHelpAnchor(e,content,opts)}}else{if(e.is("span")){content=e.html();opts.localContent=true;opts.domInsertionMode="after";e.hide();visibleOverflowOnEnclosingValueDiv(e);if(content){helpService.renderHelpAnchor(e,content,opts)}}}}}}})}};self.FieldHelper=function(selection,options){var returnValue=undefined;if(selection&&selection.length>0){selection=selection.filter("div.field");if(selection&&selection.length>0){returnValue=wigiiApi.getFieldHelper();returnValue.attach(selection,options)}}return(!returnValue?{$:selection}:returnValue)};self.FormHelper=function(selection,options){var returnValue=undefined;if(selection&&selection.length==1){returnValue=wigiiApi.getFormHelper();returnValue.attach(selection,options)}else{if(selection&&selection.length>1){throw wigiiApi.createServiceException("Wigii FormHelper selector can only be activated on a JQuery collection containing one element and not "+selection.length,wigiiApi.errorCodes.INVALID_ARGUMENT)}}return(!returnValue?{$:selection}:returnValue)};self.DropDownConstraint=function(selection,matrix){var returnValue=undefined;if(selection&&selection.length>0){selection=selection.filter("select");if(selection&&selection.length>0){returnValue=wigiiApi.createDropDownConstraint(selection,matrix)}}return(!returnValue?{$:selection}:returnValue)};self.ButtonHelper=function(selection,options){var returnValue=undefined;if(selection&&selection.length>0){returnValue=wigiiApi.createButtonHelper(selection,options)}return(!returnValue?{$:selection}:returnValue)}};wigiiApi.FormEvent=function(eventName,formId,fieldId,fieldName){var self=this;self.className="FormEvent";self.ctxKey=wigiiApi.ctxKey+"_"+self.className;self.context={eventName:eventName,formId:formId,fieldId:fieldId,fieldName:fieldName};self.eventName=function(){return self.context.eventName};self.formId=function(){return self.context.formId};self.fieldId=function(){return self.context.fieldId};self.fieldName=function(){return self.context.fieldName};self.subFieldName=function(subFieldName){if(subFieldName){self.context.subFieldName=subFieldName}else{return self.context.subFieldName}};self.value=function(value){if(value){self.context.value=value}else{return self.context.value}};self.dataType=function(dataType){if(dataType){self.context.dataType=dataType}else{return self.context.dataType}};self.toJson=function(){if(self.context){return JSON.stringify(self.context)}else{return""}}};wigiiApi.Field=function(fieldName,dataType,label,attributes){var self=this;self.className="Field";self.ctxKey=wigiiApi.ctxKey+"_"+self.className;self.context={fieldName:fieldName,dataType:dataType,label:label,attributes:attributes};self.fieldName=function(){return self.context.fieldName};self.dataType=function(){return self.context.dataType};self.label=function(label){if(label===undefined){return self.context.label}else{self.context.label=label}};self.attribute=function(name,value){if(!name){throw wigiiApi.createServiceException("attribute name cannot be null",wigiiApi.errorCodes.INVALID_ARGUMENT)}if(!self.context.attributes){self.context.attributes={}}if(value===undefined){return self.context.attributes[name]}else{self.context.attributes[name]=value}}};wigiiApi.FieldList=function(){var self=this;self.className="FieldList";self.ctxKey=wigiiApi.ctxKey+"_"+self.className;self.context={indexByName:{},indexByPos:[]};self.addField=function(field){if(!field){throw wigiiApi.createServiceException("field cannot be null",wigiiApi.errorCodes.INVALID_ARGUMENT)}var fieldName=field.fieldName();if(self.doesFieldExist(fieldName)){wigiiApi.createServiceException("field '"+fieldName+"' already exists in the list",wigiiApi.errorCodes.ALREADY_EXISTS)}self.context.indexByName[fieldName]=field;self.context.indexByPos.push(fieldName)};self.doesFieldExist=function(fieldName){if(!fieldName){return undefined}return self.context.indexByName[fieldName]};self.getField=function(fieldName){if(!fieldName){throw wigiiApi.createServiceException("fieldName cannot be null",wigiiApi.errorCodes.INVALID_ARGUMENTfield.fieldName())}var returnValue=self.context.indexByName[fieldName];if(!returnValue){throw wigiiApi.createServiceException("field '"+fieldName+"' does not exist in the list",wigiiApi.errorCodes.DOES_NOT_EXIST)}return returnValue};self.isEmpty=function(){return(self.context.indexByPos.length==0)};self.count=function(){return self.context.indexByPos.length};self.each=function(callback){if(!$.isFunction(callback)){throw wigiiApi.createServiceException("callback should be a function of the form callback(index,Field)",wigiiApi.errorCodes.INVALID_ARGUMENT)}var indexByPos=self.context.indexByPos;var indexByName=self.context.indexByName;for(var i=0;i<indexByPos.length;i++){callback(i,indexByName[indexByPos[i]])}}};wigiiApi.WigiiBag=function(){var self=this;self.className="WigiiBag";self.ctxKey=wigiiApi.ctxKey+"_"+self.className;self.context={bag:{}};self.getValue=function(fieldName,subFieldName){if(!fieldName){throw wigiiApi.createServiceException("fieldName cannot be null",wigiiApi.errorCodes.INVALID_ARGUMENT)}var fieldValue=self.context.bag[fieldName];if(fieldValue){if(!subFieldName){subFieldName="value"}return fieldValue[subFieldName]}else{return undefined}};self.setValue=function(value,fieldName,subFieldName){if(!fieldName){throw wigiiApi.createServiceException("fieldName cannot be null",wigiiApi.errorCodes.INVALID_ARGUMENT)}var fieldValue=self.context.bag[fieldName];if(!fieldValue){fieldValue={};self.context.bag[fieldName]=fieldValue}if(!subFieldName){subFieldName="value"}fieldValue[subFieldName]=value}};wigiiApi.Record=function(fieldList,wigiiBag){var self=this;self.className="Record";self.ctxKey=wigiiApi.ctxKey+"_"+self.className;self.context={fieldList:fieldList||wigiiApi.createFieldListInstance(),wigiiBag:wigiiBag||wigiiApi.createWigiiBagInstance()};self.fieldList=function(){return self.context.fieldList};self.wigiiBag=function(){return self.context.wigiiBag};self.createField=function(fieldName,dataType,label,attributes){var field=wigiiApi.createFieldInstance(fieldName,dataType,label,attributes);self.fieldList().addField(field);return self};self.getFieldValue=function(fieldName,subFieldName){return self.wigiiBag().getValue(fieldName,subFieldName)};self.setFieldValue=function(value,fieldName,subFieldName){self.wigiiBag().setValue(value,fieldName,subFieldName);return self}};wigiiApi.lookupService=function(serviceName){if(!serviceName){return}var srvGetter=wigiiApi["get"+serviceName];if($.type(srvGetter)==="function"){return srvGetter()}};wigiiApi.getDebugLogger=function(typeName){return new wigiiApi.DebugLogger(typeName)};wigiiApi.getExceptionSink=function(){if(!wigiiApi.exceptionSinkInstance){wigiiApi.exceptionSinkInstance=new wigiiApi.ExceptionSink()}return wigiiApi.exceptionSinkInstance};wigiiApi.createPopUpInstance=function(anchor,options){return new wigiiApi.PopUp(anchor,options)};wigiiApi.getHelpService=function(){if(!wigiiApi.helpServiceInstance){wigiiApi.helpServiceInstance=new wigiiApi.HelpService()}return wigiiApi.helpServiceInstance};wigiiApi.getJQueryService=function(){if(!wigiiApi.jQueryServiceInstance){wigiiApi.jQueryServiceInstance=new wigiiApi.JQueryService()}return wigiiApi.jQueryServiceInstance};wigiiApi.getWncdContainer=function(wncd){if(!wigiiApi.wncdContainerInstance){wigiiApi.wncdContainerInstance=new wigiiApi.WncdContainer(wncd)}return wigiiApi.wncdContainerInstance};wigiiApi.getHtmlBuilder=function(){return new wigiiApi.HtmlBuilder()};wigiiApi.getFieldHelper=function(){return new wigiiApi.FieldHelper()};wigiiApi.getFormHelper=function(){return new wigiiApi.FormHelper()};wigiiApi.createButtonHelper=function(btn,options){return new wigiiApi.ButtonHelper(btn,options)};wigiiApi.getArrayHelper=function(arr){return new wigiiApi.ArrayHelper(arr)};wigiiApi.getMatrixHelper=function(matrix){return new wigiiApi.MatrixHelper(matrix)};wigiiApi.createDropDownConstraint=function(selector,matrix){return new wigiiApi.DropDownConstraint(selector,matrix)};wigiiApi.createFormEventInstance=function(eventName,formId,fieldId,fieldName){return new wigiiApi.FormEvent(eventName,formId,fieldId,fieldName)};wigiiApi.createFieldInstance=function(fieldName,dataType,label,attributes){return new wigiiApi.Field(fieldName,dataType,label,attributes)};wigiiApi.createFieldListInstance=function(){return new wigiiApi.FieldList()};wigiiApi.createWigiiBagInstance=function(){return new wigiiApi.WigiiBag()};wigiiApi.createRecordInstance=function(fieldList,wigiiBag){return new wigiiApi.Record(fieldList,wigiiBag)};wigiiApi.matrix=function(matrix,selectedRows){return new wigiiApi.MatrixHelper(matrix,selectedRows)};wigiiApi.log=function(message){wigiiApiConsole().log("INFO WigiiApi : "+message);return wigiiApi};wigiiApi.clearLog=function(){wigiiApiConsole().clear();return wigiiApi};wigiiApi.debugLogger=function(){if(!wigiiApi.debugLoggerInstance){wigiiApi.debugLoggerInstance=wigiiApi.getDebugLogger("WigiiApi")}return wigiiApi.debugLoggerInstance};wigiiApi.buildUpdateUrl=function(url){return encodeURI(wigiiApi.SITE_ROOT+"Update/"+wigiiApi.crtContextId+wigiiApi.EXEC_requestSeparator+url)};wigiiApi.buildUpdateCallback=function(context){return function(data,textStatus){wigiiApi.parseUpdateResult(data,textStatus,context)}};wigiiApi.buildUrlFragment=function(urlArgs){var returnValue="";if($.isArray(urlArgs)){for(var i=0;i<urlArgs.length;i++){if(i>0){returnValue+="/"}returnValue+=urlArgs[i]}}else{if($.isPlainObject(urlArgs)){for(var key in urlArgs){if(returnValue!=""){returnValue+="/"}returnValue+=key+"="+urlArgs[key]}}else{returnValue=urlArgs}}if(returnValue!=""){returnValue=encodeURI(returnValue)}return returnValue};wigiiApi.parseUpdateResult=function(html,textStatus,context){var tabReq=html.split(wigiiApi.EXEC_answerRequestSeparator);var tabLength=tabReq.length;var lookupPaths={};var request,tempCode;for(var i=0;i<tabLength;i++){request=tabReq[i].split(wigiiApi.EXEC_answerParamSeparator);if(request!=""){if(request[0]=="JSCode"){if(request.length>2){tempCode=wigiiApi.decHTML(request[2]);if(tempCode.substr(0,6)=="<br />"){tempCode=null}if(request[1]=="foundInCache"){if(lookupPaths.foundInCache){wigiiApi.setJSCache(lookupPaths.foundInCache[1],lookupPaths.foundInCache[0],tempCode);wigiiApi.keepInCache(lookupPaths.foundInCache[0])}}else{wigiiApi.setJSCache(request[1],lookupPaths[request[1]],tempCode);wigiiApi.keepInCache(lookupPaths[request[1]])}}else{tempCode=decHTML(request[1]);if(tempCode.substr(0,6)=="<br />"){tempCode=null}}if(!wigiiApi.holdJsCodeAnswers()){eval(tempCode)}else{wigiiApi.log(tempCode)}}else{if(request[0]=="Alert"){alert(request[1])}else{if(request[0]=="Reload"){window.self.location=request[1]}else{if(request[0]=="NoAnswer"){if(request[1].indexOf("cacheKey_")==0){lookupPaths[request[0]]=request[1]}else{if(request[1]!=""){if(request.length>2){alert(request[1]+"\n"+request[2])}else{alert(request[1])}}}}else{if(request[0]=="foundInCache"){if(request[1].indexOf("cacheKey_")==0){lookupPaths[request[0]]=[request[1],request[2]]}}else{if(request[0].indexOf("Wigii_")==0){tempCode=request[0].split("_");if(tempCode.length>1){var srv=wigiiApi.lookupService(tempCode[1]);if(srv){var answerType="html";var tempCode=request[1];if(request.length>2){answerType=request[1];tempCode=request[2]}if(answerType=="json"){try{tempCode=$.parseJSON(tempCode)}catch(exc){throw wigiiApi.createServiceException("json response parsing exception",wigiiApi.errorCodes.WRAPPING,exc)}}var ctx=(context&&context[request[0]]?context[request[0]]:context);try{if(answerType=="html"&&$.type(srv.html)==="function"){srv.html(tempCode,ctx)}else{if(answerType=="json"&&$.type(srv.json)==="function"&&tempCode){srv.json(tempCode,ctx)}}}catch(exc){wigiiApi.publishException(exc)}}}}else{if(request[1]=="keep"){}else{$("#"+request[0]).stopTime();$("#"+request[0]+" *").stopTime();if(request.length>2){$("#"+request[0]).html(request[2]);if(request[2]==""){if($("#"+request[0]).is(":ui-dialog")){$("#"+request[0]).dialog("destroy")}}else{wigiiApi.setCache(request[0],request[1],request[2]);wigiiApi.keepInCache(request[1]);lookupPaths[request[0]]=request[1]}}else{$("#"+request[0]).html(request[1]);if(request[1]==""){if($("#"+request[0]).is(":ui-dialog")){$("#"+request[0]).dialog("destroy")}}}}}}}}}}}}wigiiApi.clearKeepInCache()};wigiiApi.showElement=function(wigiiNamespaceUrl,moduleName,elementId,urlArgs){if(urlArgs){urlArgs="/"+wigiiApi.buildUrlFragment(urlArgs)}update("elementDialog/"+wigiiNamespaceUrl+"/"+moduleName+"/element/detail/"+elementId+urlArgs)};wigiiApi.printElement=function(wigiiNamespaceUrl,moduleName,elementId){window.open(SITE_ROOT+"usecontext/"+crtContextId+"/__/"+wigiiNamespaceUrl+"/"+moduleName+"/element/print/"+elementId)};wigiiApi.printElementWithTemplate=function(wigiiNamespaceUrl,moduleName,elementId,template){if(template){template="/"+template}window.open(SITE_ROOT+"usecontext/"+crtContextId+"/__/"+wigiiNamespaceUrl+"/"+moduleName+"/element/template/"+elementId+template)};wigiiApi.editElement=function(wigiiNamespaceUrl,moduleName,elementId,urlArgs){if(urlArgs){urlArgs="/"+wigiiApi.buildUrlFragment(urlArgs)}update("elementDialog/"+wigiiNamespaceUrl+"/"+moduleName+"/element/edit/"+elementId+urlArgs)};wigiiApi.addElement=function(wigiiNamespaceUrl,moduleName,groupId,urlArgs){if(urlArgs){urlArgs="/"+wigiiApi.buildUrlFragment(urlArgs)}update("elementDialog/"+wigiiNamespaceUrl+"/"+moduleName+"/element/add/"+groupId+urlArgs)};wigiiApi.copyElement=function(wigiiNamespaceUrl,moduleName,elementId,groupId,urlArgs){if(urlArgs){urlArgs="/"+wigiiApi.buildUrlFragment(urlArgs)}update("elementDialog/"+wigiiNamespaceUrl+"/"+moduleName+"/element/copy/"+elementId+"/"+groupId+urlArgs)};wigiiApi.form=function(){var form=$("#elementDialog form");if(form.length==0){form=$("#detailElement_form")}return form.wigii("FormHelper")};wigiiApi.callFx=function(fx,options){if(!fx){throw wigiiApi.createServiceException("fx cannot be null",wigiiApi.errorCodes.INVALID_ARGUMENT)}options=options||{};if(!options.fxEndPoint){if(window.crtWigiiNamespaceUrl){options.fxEndPoint=wigiiApi.SITE_ROOT+"/"+crtWigiiNamespaceUrl+"/"+crtModuleName+"/fx"}else{options.fxEndPoint=wigiiApi.SITE_ROOT+"/NoWigiiNamespace/NoModule/fx"}}if(!options.fxEndPoint.endsWith("/")){options.fxEndPoint+="/"}if(!options.exceptionHandler&&!options.silent){options.exceptionHandler=function(exception,context){wigiiApi.publishException(exception)}}fx=$.base64EncodeUrl(fx);var ajaxOptions={type:"GET",url:options.fxEndPoint+fx,crossDomain:true,xhrFields:{withCredentials:true}};if(options.resultHandler){ajaxOptions.success=options.resultHandler}if(!options.silent&&options.exceptionHandler){ajaxOptions.error=function(xhr,textStatus){if(xhr.status==500&&xhr.responseXML){var serverError=$(xhr.responseXML);var exception=serverError.find("exception");if(exception){exception={name:exception.find("name").text(),code:exception.find("code").text(),message:exception.find("message").text()}}var context=serverError.find("context");if(context){context={request:context.find("request").text(),wigiiNamespace:context.find("wigiiNamespace").text(),module:context.find("module").text(),action:context.find("action").text(),realUsername:context.find("realUsername").text(),username:context.find("username").text(),principalNamespace:context.find("principalNamespace").text()}}options.exceptionHandler(exception,context)}else{options.exceptionHandler({code:xhr.status||wigiiApi.errorCodes.UNKNOWN_ERROR,message:xhr.responseText||"Ajax status: "+textStatus})}}}if(options.postData){ajaxOptions.type="POST";if(options.postAsForm){ajaxOptions.data=options.postData}else{ajaxOptions.contentType="text/plain";ajaxOptions.dataType="json";ajaxOptions.data=JSON.stringify(options.postData);ajaxOptions.processData=false}}$.ajax(ajaxOptions)};wigiiApi.defaultFxErrorHandler=function(xhr,textStatus){var context=undefined;var exception=undefined;var serverError=xhr.responseXML;if(!serverError){serverError=xhr.responseText;try{serverError=$.parseXML(serverError)}catch(e){serverError=undefined}}if(xhr.status==500&&serverError){serverError=$(serverError);exception=serverError.find("exception");if(exception){exception={name:exception.find("name").text(),code:exception.find("code").text(),message:exception.find("message").text()}}context=serverError.find("context");if(context){context={request:context.find("request").text(),wigiiNamespace:context.find("wigiiNamespace").text(),module:context.find("module").text(),action:context.find("action").text(),realUsername:context.find("realUsername").text(),username:context.find("username").text(),principalNamespace:context.find("principalNamespace").text()}}}else{if(textStatus!="abort"){exception={code:xhr.status||wigiiApi.errorCodes.UNKNOWN_ERROR,message:xhr.responseText||"Ajax status: "+textStatus}}}if(exception){wigiiApi.getHelpService().showFloatingHelp(undefined,undefined,wigiiApi.exception2html(exception,context),{localContent:true,position:"center",removeOnClose:true})}};wigiiApi.lang=function(){return crtLang};wigiiApi.str2float=function(value){return 1*value.replace(/'/g,"").replace(/,/g,"").replace(/ /g,"")};wigiiApi.txtNumeric=function(value){value+="";var x=value.split(".");var x1=x[0];var x2=x.length>1?"."+x[1]:"";var rgx=/(\d+)(\d{3})/;while(rgx.test(x1)){x1=x1.replace(rgx,"$1'$2")}return x1+x2};wigiiApi.txtQuot=function(value){return'"'+value+'"'};wigiiApi.txtDico=function(lang,label){var dico=undefined;if($.isPlainObject(lang)){dico=lang}else{dico={};dico[lang]=label;if(arguments.length>2){var i=2;while(i<arguments.length){lang=arguments[i];i++;if(i<arguments.length){label=arguments[i]}else{label=""}i++;dico[lang]=label}}}return dico[wigiiApi.lang()]};wigiiApi.logAnd=function(val1,val2){return val1&&val2};wigiiApi.ceilTo=function(value,number,fixed){if(arguments.length<3){fixed=null}var op=1;var floatDec=(number+"").indexOf(".");if(floatDec){floatDec=(number+"").length-floatDec-1;op=Math.pow(10,floatDec)}remain=Math.round(value*op)%Math.round(number*op);remain=remain/op;if(remain>0){value=value-remain+number}if(fixed){return value.toFixed(2)}return value};wigiiApi.genRange=function(from,to,step,callback){if($.isFunction(callback)){if(!($.isNumeric(from)&&$.isNumeric(to)&&$.isNumeric(step))){throw wigiiApi.createServiceException("from, to and step should all be numbers",wigiiApi.errorCodes.INVALID_ARGUMENT)}if(step>0){while(from<to){callback(from);from+=step}}else{if(step<0){while(from>to){callback(from);from-=step}}else{throw wigiiApi.createServiceException("step cannot be 0",wigiiApi.errorCodes.INVALID_ARGUMENT)}}}};wigiiApi.day2string=function(date){if(!date){date=new Date()}var returnValue="";var c=date.getFullYear();returnValue+=c;c=date.getMonth()+1;if(c<10){returnValue+="-0"+c}else{returnValue+="-"+c}c=date.getDate();if(c<10){returnValue+="-0"+c}else{returnValue+="-"+c}return returnValue};wigiiApi.minutes2string=function(date){if(!date){date=new Date()}var returnValue=wigiiApi.day2string(date);var c=date.getHours();if(c<10){returnValue+=" 0"+c}else{returnValue+=" "+c}c=date.getMinutes();if(c<10){returnValue+=":0"+c}else{returnValue+=":"+c}return returnValue};wigiiApi.seconds2string=function(date){if(!date){date=new Date()}var returnValue=wigiiApi.minutes2string(date);var c=date.getSeconds();if(c<10){returnValue+=":0"+c}else{returnValue+=":"+c}return returnValue};wigiiApi.milliseconds2string=function(date){if(!date){date=new Date()}var returnValue=wigiiApi.seconds2string(date);var c=date.getMilliseconds();if(c<10){returnValue+=",00"+c}if(c<100){returnValue+=",0"+c}else{returnValue+=","+c}return returnValue};wigiiApi.txtFrenchDate=function(timestamp,options){var d=($.type(timestamp)=="date"?timestamp:new Date(timestamp));var returnValue="";var v=0;if(options!="noDate"){v=d.getDate();if(v<10){returnValue+="0"+v}else{returnValue+=v}returnValue+=".";v=d.getMonth()+1;if(v<10){returnValue+="0"+v}else{returnValue+=v}returnValue+=".";returnValue+=d.getFullYear()}if(options!="noTime"){if(options!="noDate"){returnValue+=" "}v=d.getHours();if(v<10){returnValue+="0"+v}else{returnValue+=v}returnValue+=":";v=d.getMinutes();if(v<10){returnValue+="0"+v}else{returnValue+=v}if(options!="noSeconds"){returnValue+=":";v=d.getSeconds();if(v<10){returnValue+="0"+v}else{returnValue+=v}}}return returnValue};wigiiApi.xml2string=function(xmlDom){return(typeof XMLSerializer!=="undefined")?(new window.XMLSerializer()).serializeToString(xmlDom):xmlDom.xml};wigiiApi.throwNotImplemented=function(){throw new wigiiApi.ServiceException("not implemented",wigiiApi.errorCodes.NOT_IMPLEMENTED)};wigiiApi.createServiceException=function(message,code,previous){return new wigiiApi.ServiceException(message,code,previous)};wigiiApi.publishException=function(exception){wigiiApi.getExceptionSink().publish(exception)};wigiiApi.exception2html=function(exception,context){var htmlb=wigiiApi.getHtmlBuilder();if(!$.isPlainObject(exception)){exception=$(exception);exception={name:exception.find("name").text(),code:exception.find("code").text(),message:exception.find("message").text()}}htmlb.putStartTag("h2").put(exception.code).prepend(" ",wigiiApi.errorLabels[exception.code]).putEndTag("h2");htmlb.putStartTag("p").implode(" : ",exception.name,exception.message).putEndTag("p");if(context){if(!$.isPlainObject(context)){context=$(context);context={request:context.find("request").text(),wigiiNamespace:context.find("wigiiNamespace").text(),module:context.find("module").text(),action:context.find("action").text(),realUsername:context.find("realUsername").text(),username:context.find("username").text(),principalNamespace:context.find("principalNamespace").text()}}htmlb.putStartTag("div","class","elementHistoric").putStartTag("div","class","label SBB expanded","onclick","$(this).toggleClass('expanded').toggleClass('collapsed');$(this).next().toggle();").put("Context").putEndTag("div").putStartTag("table","style","display:table;").putStartTag("tbody");if(context.request){htmlb.putStartTag("tr","style","height:30px;").putStartTag("td","class","label").put("Request").putEndTag("td").putStartTag("td").put(context.request).putEndTag("td").putEndTag("tr")}if(context.wigiiNamespace){htmlb.putStartTag("tr","style","height:35px;").putStartTag("td","class","label").put("Wigii Namespace").putEndTag("td").putStartTag("td").put(context.wigiiNamespace).putEndTag("td").putEndTag("tr")}if(context.module){htmlb.putStartTag("tr","style","height:20px;").putStartTag("td","class","label").put("Module").putEndTag("td").putStartTag("td").put(context.module).putEndTag("td").putEndTag("tr")}if(context.action){htmlb.putStartTag("tr","style","height:20px;").putStartTag("td","class","label").put("Action").putEndTag("td").putStartTag("td").put(context.action).putEndTag("td").putEndTag("tr")}if(context.realUsername){htmlb.putStartTag("tr","style","height:20px;").putStartTag("td","class","label").put("Login").putEndTag("td").putStartTag("td").put(context.realUsername).putEndTag("td").putEndTag("tr")}if(context.username){htmlb.putStartTag("tr","style","height:20px;").putStartTag("td","class","label").put("Role").putEndTag("td").putStartTag("td").put(context.username).putEndTag("td").putEndTag("tr")}if(context.principalNamespace){htmlb.putStartTag("tr","style","height:35px;").putStartTag("td","class","label").put("User namespace").putEndTag("td").putStartTag("td").put(context.principalNamespace).putEndTag("td").putEndTag("tr")}htmlb.putEndTag("tbody").putEndTag("table").putEndTag("div")}return htmlb.html()};wigiiApi.positionBox=function(mouseEvent,boxOptions,positionOptions){if(!boxOptions){boxOptions={}}var screenTop=undefined,screenLeft=undefined,boxTop=undefined,boxLeft=undefined;if(!positionOptions){positionOptions={}}if(!positionOptions.referenceWindow){positionOptions.referenceWindow=$(window)}var refWindowTop=0,refWindowLeft=0,refWindowOffset=positionOptions.referenceWindow.offset();if(refWindowOffset){refWindowTop=refWindowOffset.top;refWindowLeft=refWindowOffset.left}if(!mouseEvent){screenTop=Math.floor(positionOptions.referenceWindow.height()/2);screenLeft=Math.floor(positionOptions.referenceWindow.width()/2);if(!positionOptions.position){positionOptions.position="center"}}else{screenTop=mouseEvent.pageY-(refWindowTop>0?refWindowTop:positionOptions.referenceWindow.scrollTop());screenLeft=mouseEvent.pageX-(refWindowLeft>0?refWindowLeft:positionOptions.referenceWindow.scrollLeft());if(!positionOptions.position){positionOptions.position="SE"}if(!positionOptions.position=="center"&&!positionOptions.offset&&positionOptions.offset!==0){positionOptions.offset=15}}switch(positionOptions.position){case"center":boxTop=boxOptions.height/2;boxLeft=boxOptions.width/2;break;case"N":boxTop=screenTop-positionOptions.offset-boxOptions.height;boxLeft=screenLeft-boxOptions.width/2;break;case"NE":boxTop=screenTop-positionOptions.offset-boxOptions.height;boxLeft=screenLeft+positionOptions.offset;break;case"E":boxTop=screenTop-boxOptions.height/2;boxLeft=screenLeft+positionOptions.offset;break;case"SE":boxTop=screenTop+positionOptions.offset;boxLeft=screenLeft+positionOptions.offset;break;case"S":boxTop=screenTop+positionOptions.offset;boxLeft=screenLeft-boxOptions.width/2;break;case"SW":boxTop=screenTop+positionOptions.offset;boxLeft=screenLeft-positionOptions.offset-boxOptions.width;break;case"W":boxTop=screenTop-boxOptions.height/2;boxLeft=screenLeft-positionOptions.offset-boxOptions.width;break;case"NW":boxTop=screenTop-positionOptions.offset-boxOptions.height;boxLeft=screenLeft-positionOptions.offset-boxOptions.width;break}if(!positionOptions.preventCovering){if(boxTop<0){boxTop=0}if(boxLeft<0){boxLeft=0}boxTop=Math.max(Math.min(boxTop,positionOptions.referenceWindow.height()-boxOptions.height-20),10);boxLeft=Math.max(Math.min(boxLeft,positionOptions.referenceWindow.width()-boxOptions.width-30),10)}boxOptions.left=Math.ceil(boxLeft);boxOptions.top=Math.ceil(boxTop);return boxOptions};wigiiApi.initContext=function(){wigiiApi.SITE_ROOT=window.SITE_ROOT;wigiiApi.crtContextId=window.crtContextId;wigiiApi.EXEC_answerRequestSeparator=window.EXEC_answerRequestSeparator;wigiiApi.EXEC_answerParamSeparator=window.EXEC_answerParamSeparator;wigiiApi.EXEC_requestSeparator=window.EXEC_requestSeparator};wigiiApi.initContext();wigiiApi.encHTML=window.encHTML;wigiiApi.decHTML=window.decHTML;wigiiApi.setCache=window.setCache;wigiiApi.setJSCache=window.setJSCache;wigiiApi.keepInCache=window.keepInCache;wigiiApi.clearKeepInCache=window.clearKeepInCache;wigiiApi.fl;wigiiApi.initFL=function(libs){wigiiApi.fl=new WigiiStdFL(wigiiApi);for(var i=0;i<arguments.length;i++){var lib=arguments[i];if($.isArray(lib)){for(var j=0;j<lib.length;j++){var lib2=lib[j];if($.type(lib2)==="object"){for(var fxName in lib2){this.fl[fxName]=lib2[fxName]}}}}else{if($.type(lib)==="object"){for(var fxName in lib){this.fl[fxName]=lib[fxName]}}}}};wigiiApi.evalfx=function(fx){var returnValue=undefined;try{if($.type(fx)==="function"){if(!this.fl){this.initFL()}this.fl.currentFx=fx;var res=this.fl.currentFx();if($.type(res)==="function"){returnValue=res()}else{returnValue=res}}else{returnValue=fx}}catch(e){this.publishException(e)}return returnValue}},wigiiApiInstance=new WigiiApi(),wigiiFacade=function(selector,options){var wigiiApi=wigiiApiInstance;if(!selector){return wigiiApi}var service=wigiiApi[selector];if(!service){throw new wigiiApi.ServiceException("service '"+selector+"' is not a valid Wigii API service",wigiiApi.errorCodes.INVALID_ARGUMENT)}if($.type(service)==="function"){if(options){return new service(options)}else{return new service()}}else{return service}},wigiiApiConsoleInstance=undefined,wigiiApiConsole=function(){var wigiiApi=wigiiApiInstance;if(!wigiiApiConsoleInstance){wigiiApiConsoleInstance={popup:function(){if(!this["popupInstance"]){this.popupInstance=wigiiApi.createPopUpInstance($("body"),{id:"wigiiApiConsole_"+wigiiApi.instantiationTime,title:"Wigii API Console"})}return this.popupInstance},clear:function(){if(this["popupInstance"]){this.popupInstance.remove();delete this["popupInstance"]}},debug:function(message){this.popup().body().append("<p>"+wigiiApi.milliseconds2string()+" "+message+"</p>");this.popup().show()},log:function(message){this.popup().body().append("<p>"+wigiiApi.milliseconds2string()+" "+message+"</p>");this.popup().show()},error:function(message){this.popup().body().append("<p>"+wigiiApi.milliseconds2string()+" "+message+"</p>");this.popup().show()}}}return wigiiApiConsoleInstance};window.wigii=wigiiFacade;wigiiApiInstance.initFL()})(window,jQuery);(function(a){a.fn.wigii=function(g,c){var f=wigii();var d=undefined;try{if(!g){throw f.createServiceException("cmd cannot be null",f.errorCodes.INVALID_ARGUMENT)}var b=f.getJQueryService()[g];if(!b||a.type(b)!=="function"){throw f.createServiceException("Wigii API JQueryService does not support the '"+g+"' command.",f.errorCodes.UNSUPPORTED_OPERATION)}d=b(this,c)}catch(h){f.publishException(h)}if(d){return d}else{return this}}})(jQuery);