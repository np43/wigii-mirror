externalAccessTimeoutTimer=null;previewCrtHeight=10;function getBasicCKEditorToolbar(){return[["Bold","Italic","Underline","TextColor","PasteText"],["NumberedList","BulletedList","Outdent","Indent","Link","Image","Templates"]]}function getMediumCKEditorToolbar(){return[["Templates","Maximize","-","PasteText","RemoveFormat"],["NumberedList","BulletedList","Outdent","Indent"],["Link","Image","Table","HorizontalRule","-","Source","Scayt"],"/",["Format","FontSize","Bold","Italic","Underline","TextColor","BGColor","Strike","SpecialChar"],["JustifyLeft","JustifyCenter","JustifyRight"]]}function getFullCKEditorToolbar(){return[["Source","-","Templates","Preview","Maximize"],["Cut","Copy","Paste","PasteText","RemoveFormat","-","Undo","Redo"],["Find","Replace","-","SelectAll","-","Scayt","About"],"/",["NumberedList","BulletedList","-","Outdent","Indent","-","JustifyLeft","JustifyCenter","JustifyRight","JustifyBlock"],["Link","Unlink","Anchor","Image","Table","HorizontalRule","SpecialChar","CreateDiv","ShowBlocks"],"/",["Format","FontSize"],["TextColor","BGColor"],["Bold","Italic","Underline","Strike","Subscript","Superscript"]]}function getScayt_sLangFromLanguage(a){switch(a){case"en":return"en_GB";case"fr":return"fr_FR";default:return"en_GB"}}function boxChooseFile(c,e,b,a,f){$(c).click(function(){boxSelect.unregister(boxSelect.SUCCESS_EVENT_TYPE);boxSelect.unregister(boxSelect.CANCEL_EVENT_TYPE);boxSelect.success(function(h){var g=$(b).parent();$(c).hide();$(e).hide();boxSuccess(b,a,h,f,g)});boxSelect.cancel(function(){});boxSelect.launchPopup()})}function boxSuccess(e,j,f,g,l){$("div.updateCurrentFile",l).show();$("div.removeCurrentFile",l).show();$("div.downloadCurrentFile",l).hide();var a=f[0].name;var c=f[0].id;var k=a.lastIndexOf(".");var h="";var b="";if(k>-1){b=a.substring(k+1).toLowerCase();h="."+b;a=a.substring(0,k)}$(j).val("box://".concat(c));$(j.replace("path","type")).val(h);$(this).hide();$(e).val(a).show().focus().change().select();$("div.filePreview",l).css("background-image",'url("'+g+"images/preview/prev.26."+b+'.png")');$("div.filePreview",l).show()}function boxUpdateFileInfo(f,c,o,g,a,l,h,k){var m=f.split("__");var n=m[1];m=m[0];if($("#"+f+" div.value input#"+m+"_"+n+"_path_hidden").length>0){$("#"+m+"_"+n+"_name_text").val(c);$("#"+m+"_"+n+"_size_hidden").val(a);$("#"+m+"_"+n+"_type_hidden").val(o);$("#"+m+"_"+n+"_mime_hidden").val(g);$("#"+m+"_"+n+"_date_hidden").val(h)}else{var b=$("#"+f+" div.value.file");if(b.length>0){if(b.find("div.fdet.small").length>0){b.find("div.fdet a.H.fileDownload").html(c);b.find("div.fdet font").html("("+l+", "+k+")");var j=b.find("div.fdet a.fdet.fileDownload img");if(j.attr("title")){j.attr("title",j.attr("title").replace(/\(.*\)/g,"("+l+")"))}j=b.find("div.fdet img.checkOutIn");if(j.attr("title")){j.attr("title",j.attr("title").replace(/\(.*\)/g,"("+l+")"))}}else{b.find("div.fdet a.fileDownload").html(c);b.find("div.fdet font").html("("+k+")");b.find("a.fdet.fileDownload div span font").html("("+l+")")}}}}function addJsCodeOnFileInput(f,c,a,g,j){var b=$(c).parent();var e=a.replace("_path_hidden","_box_hidden");$("div.removeCurrentFile",b).click(function(){var l=$(c).parent();$(this).hide();var k="#".concat($(c).parent().parent().attr("id"));if(domElementHasWigiiService(k,"box")){domElementRemoveWigiiService(k,"box")}$("div.filePreview",l).hide();$("div.updateCurrentFile",l).hide();$("div.downloadCurrentFile",l).hide();$("div.backToFilename",l).hide();$(e).show();$(f).val("").show();$(c).val("").hide().change().blur();$(a).val("")});$("div.backToFilename",b).click(function(){var k=$(c).parent();$(this).hide();$("div.filePreview",k).show();$("div.updateCurrentFile",k).show();$("div.removeCurrentFile",k).show();$(f).hide();$(c).show()});$("div.updateCurrentFile",b).click(function(l){var k=$(c).parent();if($(a).val().indexOf("box://")>=0&&window.boxSelect){boxSelect.unregister(boxSelect.SUCCESS_EVENT_TYPE);boxSelect.unregister(boxSelect.CANCEL_EVENT_TYPE);boxSelect.success(function(m){$("div.downloadCurrentFile",k).hide();$("div.removeCurrentFile",k).hide();boxSuccess(c,a,m,j,k)});boxSelect.cancel(function(){});boxSelect.launchPopup()}else{$(this).hide();$("div.removeCurrentFile",k).show();$("div.filePreview",k).hide();$("div.backToFilename",k).show();$(c).hide();$(f).show();showHelp($(f),g,0,"left")}});$(f).click(function(){hideHelp()}).change(function(){var k=$(f).parent();$("div.backToFilename",k).hide();$("div.updateCurrentFile",k).show();$("div.removeCurrentFile",k).show();var l=$(this).val();l=l.substring(l.lastIndexOf('"."\\"."\\"."')+1);var n=l.substring(l.lastIndexOf(".")+1);l=l.substring(0,l.lastIndexOf("."));var m=new RegExp(".*/","g");l=l.replace(m,"");m=new RegExp(".*\\\\","g");l=l.replace(m,"");$(this).hide();$(e).hide();$(c).val(l).show().focus().select();$("div.filePreview",k).css("background-image",'url("'+j+"images/preview/prev.26."+n+'.png")');$("div.filePreview",k).show()});if(!!navigator.userAgent.match(/Trident/g)||!!navigator.userAgent.match(/MSIE/g)){}else{var h=document.getElementById(f.replace("#","")).parentNode.parentNode;h.ondragover=h.ondragenter=function(k){$(f).parent().parent().css("background-color","#ddd");k.preventDefault()};h.ondragleave=h.ondragout=function(k){$(f).parent().parent().css("background-color","transparent");k.preventDefault()};h.ondrop=function(k){document.getElementById(f.replace("#","")).files=k.dataTransfer.files;$(f).change();$(f).parent().parent().css("background-color","transparent");k.preventDefault()}}}function addJsCodeOnOnLineFileInput(c,e,j,l,h,f,g,b,k,a){v=$(e).parent();$("div.removeExistingOnLineFile",v).click(function(){v=$(e).parent();$(this).hide();$("div.filePreview",v).hide();$("div.removeExistingOnLineFile",v).hide();$("div.updateExistingOnLineFile",v).hide();$("div.newOnLineFile",v).show();$(e).val("").hide();$(c).val("").change().blur()});$("div.newOnLineFile, div.updateExistingOnLineFile",v).click(function(p){myPosition={my:"center top",at:"center top+50"};v=$(e).parent();if($(c).val()==""){if(j!=null){t=CKEDITOR.getTemplates("default").templates;for(i in t){if(t[i].title==j){$(c).val(t[i].html)}}}}$("#elementPreview").html('<textarea style="width:'+($(window).width()-30)+'px;" id="elementPreview_textContent">'+$(c).val().replace(/&/g,"&amp;")+"</textarea>");crtActiveOnlineFileTextContentId=c;if($("#elementPreview").is(":ui-dialog")){$("#elementPreview").dialog("destroy")}var o={ok:function(){crtActiveOnlineFileTextContentId=null;$(c).val($("#elementPreview").find("textarea:first").ckeditorGet().getData()).change().blur();v=$(e).parent();$("div.filePreview",v).css("background-image",'url("'+f+'images/preview/prev.26.html.png")');$("div.filePreview",v).show();$("div.removeExistingOnLineFile",v).show();$("div.updateExistingOnLineFile",v).show();$("div.newOnLineFile",v).hide();if($(e).val()==null||$(e).val()==""){$(e).val(g)}$(e).show().focus().select();CKEDITOR.remove($("#elementPreview").find("textarea:first").ckeditorGet());$(this).val("").dialog("destroy")}};if(l!==false){o[l]=function(){crtActiveOnlineFileTextContentId=null;$(this).dialog("destroy")}}$("#elementPreview").dialog({buttons:o,width:$(window).width()-110,position:myPosition,closeOnEscape:false,draggable:false,resizable:false,modal:false,beforeClose:function(){}});$("#elementPreview").prev().css("display","none");var n="elementPreview_textContent";var m=CKEDITOR.instances[n];if(m){CKEDITOR.remove(m)}tempZIndex=$("#elementPreview").parent().css("zIndex")+1;$("#elementPreview").find("textarea:first").ckeditor({language:b,scayt_sLang:getScayt_sLangFromLanguage(b),templates:crtWigiiNamespaceUrl+",default",templates_files:[a],baseFloatZIndex:tempZIndex,toolbar:getFullCKEditorToolbar(),toolbarCanCollapse:true,toolbarStartupExpanded:true,resize_minWidth:$(window).width()-130,height:k-100,allowedContent:true,filebrowserUploadUrl:crtWigiiNamespaceUrl+"/"+crtModuleName+"/CKEditor/upload"})})}var progressBarTimeout=null;var savingBarTimeout=null;var jsFileContentInForm=null;function getAjaxformOption(a){return{success:parseUpdateResult,beforeSerialize:function(){if($(a+" .removeDisableOnSubmit").length>0){$(a+" .removeDisableOnSubmit").removeAttr("disabled")}},beforeSubmit:function(f,e,c){hideHelp();setVis("busyDiv",true);if(savingBarTimeout==null){savingBarTimeout=setTimeout(function(){$("#savingBar").html(wigii().context.serverSavingWaitingMsg).show();if($(a).wigii("FormHelper").fields("[data-wigii-service~='box-upload']").$.length){var g=wigii().context.box;g.showBoxWaitingMsg=true;if(!g.waitForBoxUpload){g.waitForBoxUpload=function(){if(wigii().context.box.showBoxWaitingMsg){$("#savingBar").html(wigii().context.box.serverSavingWaitingMsg).show()}else{$("#savingBar").html(wigii().context.serverSavingWaitingMsg).show()}wigii().context.box.showBoxWaitingMsg=!wigii().context.box.showBoxWaitingMsg;savingBarTimeout=setTimeout(wigii().context.box.waitForBoxUpload,5000)}}savingBarTimeout=setTimeout(g.waitForBoxUpload,3500)}},2000)}if(jsFileContentInForm){for(var b in jsFileContentInForm){f[f.length]={name:b,value:jsFileContentInForm[b]}}jsFileContentInForm=null}closeAnyJsOnGoingStreams()},uploadProgress:function(f,b,e,c){$("#formProgressBar").progressbar({value:c});if(progressBarTimeout==null){progressBarTimeout=setTimeout(function(){$("#formProgressBar").show()},500)}if(c>=100){setTimeout(function(){if(progressBarTimeout){clearTimeout(progressBarTimeout)}progressBarTimeout=null;$("#formProgressBar").hide()},500)}},error:errorOnUpdate,cache:false}}function closeAnyJsOnGoingStreams(){if(jsOnGoingStreams){for(var b in jsOnGoingStreams){if(typeof jsOnGoingStreams[b]=="object"){var c=jsOnGoingStreams[b].getAudioTracks();if(c){for(var a in c){c[a].stop()}}}}jsOnGoingStreams=null}}var jsOnGoingStreams=null;function addJsCodeOnFileAudioRecording(f,a,b,c,l,m,h){window.AudioContext=window.AudioContext||window.webkitAudioContext;if(navigator.mediaDevices.getUserMedia){var g=[];var n=null;var e=function(o){console.error("Error: ",o)};var j=function(p){if(!jsOnGoingStreams){jsOnGoingStreams={}}jsOnGoingStreams[a]=p;var o=new MediaRecorder(p);$("#"+b).click(function(){if(o.state=="inactive"){o.start()}else{if(o.state=="paused"){o.resume()}else{if(o.state=="recording"){o.pause()}}}$("#"+c).show();if(o.state=="recording"){$(this).addClass("isRecording");$(this).html('<img src="images/icones/tango/16x16/actions/media-playback-pause.png" style="float:left;margin-right:5px;"/>'+m)}else{$(this).removeClass("isRecording");$(this).html('<img src="images/icones/tango/16x16/devices/audio-input-microphone.png" style="float:left;margin-right:5px;"/>'+l)}});$("#"+c).click(function(){if(o.state!="inactive"){o.stop();p.getAudioTracks()[0].stop();$("#"+b).hide();$(this).html('<img src="images/icones/18px/accept.png" style="float:left;margin-right:5px;"/>'+h)}});o.onstop=function(u){var q=String(moment().format("YYYY-MM-DD HH:mm"))+".ogg";var s=new File(g,q,{type:"audio/ogg; codecs=opus"});$("#"+f+"_name_text").val(q.replace(".ogg",""));$("#"+f+"_type_hidden").val(".ogg");$("#"+f+"_size_hidden").val(s.size);$("#"+f+"_path_hidden").val("");g=[];jsFileContentInForm[a]=s};o.ondataavailable=function(q){g.push(q.data)}};try{navigator.mediaDevices.getUserMedia({audio:true}).then(j,e)}catch(k){console.error("Error: ",k)}}}function addJsCodeAfterFormIsShown(e,c,b,a){jsFileContentInForm={};$(e+" textarea.htmlArea").each(function(){var g=$(this).attr("id");var f=CKEDITOR.instances[g];if(f){CKEDITOR.remove(f)}if($(e+" textarea.htmlArea").closest(".ui-dialog").length>0){tempZIndex=$(e+" textarea.htmlArea").closest(".ui-dialog").css("zIndex")+1}else{tempZIndex=100}if($(this).hasClass("fullToolbarHtmlArea")){toolbar=getFullCKEditorToolbar()}else{if($(this).hasClass("mediumToolbarHtmlArea")){toolbar=getMediumCKEditorToolbar()}else{toolbar=getBasicCKEditorToolbar()}}if($(this).hasClass("activateHtmlArea")){height=100}else{height=40}maxHeight=450;options={};if($(this).hasClass("wordlimit")&&!$(this).hasClass("isJournal")){wordlimit=$(this).attr("class").match(/ wordlimit_([0-9]*) /g)[0].replace(/ wordlimit_([0-9]*) /g,"$1");extraPlugins="";if(options.extraPlugins){extraPlugins=options.extraPlugins+","}extraPlugins+="wordcount,undo";options=$.extend(options,{extraPlugins:extraPlugins,wordcount_limit:wordlimit,wordcount_format:'<span class="cke_path_item">Word count: %count% / %limit%</span>'})}if($(this).hasClass("difH")){height=$(this).height()-40}else{extraPlugins="";if(options.extraPlugins){extraPlugins=options.extraPlugins+","}extraPlugins+="autogrow";options=$.extend(options,{extraPlugins:extraPlugins,autoGrow_minHeight:height,autoGrow_maxHeight:maxHeight})}options=$.extend({language:c,scayt_sLang:getScayt_sLangFromLanguage(c),templates:b,templates_files:[a],baseFloatZIndex:tempZIndex,toolbar:toolbar,toolbarCanCollapse:true,toolbarStartupExpanded:$(this).hasClass("activateHtmlArea"),height:height,resize_minWidth:50,allowedContent:true,filebrowserUploadUrl:crtWigiiNamespaceUrl+"/"+crtModuleName+"/CKEditor/upload"},options);$(this).ckeditor(function(){t=$("#"+this.element.getId());if(t.hasClass("collapsed")){t.next().hide()}this.on("focus",function(){$(this.element.$).triggerHandler("focus")});this.on("blur",function(){$(this.element.$).blur()})},options);$(window).resize()});autosize($(e+" textarea:not(.noWrap):not(.noElastic)").css("max-height",450).css("min-height",30));$(e+" textarea.noWrap").css("overflow","auto").tabby();$(e+" :input:enabled:not([readonly]):first").focus();$("select.flex, select.chosen",e).each(function(j){var l=$(this);var g=$.trim(l.attr("data-placeholder"))||false;var k=l.attr("data-max-selection")||false;var h={};if(g!=false&&g.length>0){if(l.hasClass("flex")){h.allowClear=true}h.placeholder=g}if(k!=false&&l.hasClass("chosen")){h.maximumSelectionLength=k}if(l.hasClass("allowNewValues")){h.tags=[]}if(l.hasClass("displayDBValue")){h.templateSelection=function(m){return m.id}}var f=l.attr("data-attributematchexp")||false;if(f){h.ajax={url:function(m){return encodeURI(SITE_ROOT+"useContext/"+crtContextId+EXEC_requestSeparator+crtWigiiNamespaceUrl+"/"+crtModuleName+"/fx/"+f+"/"+m.term)},data:function(m){},dataType:"json",delay:Number(l.attr("data-querydelay"))||250,error:wigii().defaultFxErrorHandler};h.minimumInputLength=Number(l.attr("data-queryminlength"))||1;h.selectId=l.attr("id");h.dataAdapter=$.fn.select2.amd.require("select2/data/wigiiAjaxAdapter")}l.select2(h)});$(e+" textarea:not(.htmlArea,.isJournal).wordlimit").each(function(){$(this).wordlimit({allowed:$(this).attr("class").match(/ wordlimit_([0-9]*) /g)[0].replace(/ wordlimit_([0-9]*) /g,"$1")})});$(e+" .colorPickerInput:input:enabled:not([readonly])").spectrum({preferredFormat:"hex",chooseText:DIALOG_okLabel,cancelText:DIALOG_cancelLabel,allowEmpty:true,showInput:true,showPalette:true,maxPaletteSize:10,maxSelectionSize:10,localStorageKey:"spectrum."+crtWigiiNamespaceUrl,palette:[["rgb(0, 0, 0)","rgb(67, 67, 67)","rgb(102, 102, 102)","rgb(153, 153, 153)","rgb(183, 183, 183)","rgb(204, 204, 204)","rgb(217, 217, 217)","rgb(239, 239, 239)","rgb(243, 243, 243)","rgb(255, 255, 255)"],["rgb(152, 0, 0)","rgb(255, 0, 0)","rgb(255, 153, 0)","rgb(255, 255, 0)","rgb(0, 255, 0)","rgb(0, 255, 255)","rgb(74, 134, 232)","rgb(0, 0, 255)","rgb(153, 0, 255)","rgb(255, 0, 255)"],["rgb(230, 184, 175)","rgb(244, 204, 204)","rgb(252, 229, 205)","rgb(255, 242, 204)","rgb(217, 234, 211)","rgb(208, 224, 227)","rgb(201, 218, 248)","rgb(207, 226, 243)","rgb(217, 210, 233)","rgb(234, 209, 220)"],["rgb(221, 126, 107)","rgb(234, 153, 153)","rgb(249, 203, 156)","rgb(255, 229, 153)","rgb(182, 215, 168)","rgb(162, 196, 201)","rgb(164, 194, 244)","rgb(159, 197, 232)","rgb(180, 167, 214)","rgb(213, 166, 189)"],["rgb(204, 65, 37)","rgb(224, 102, 102)","rgb(246, 178, 107)","rgb(255, 217, 102)","rgb(147, 196, 125)","rgb(118, 165, 175)","rgb(109, 158, 235)","rgb(111, 168, 220)","rgb(142, 124, 195)","rgb(194, 123, 160)"],["rgb(166, 28, 0)","rgb(204, 0, 0)","rgb(230, 145, 56)","rgb(241, 194, 50)","rgb(106, 168, 79)","rgb(69, 129, 142)","rgb(60, 120, 216)","rgb(61, 133, 198)","rgb(103, 78, 167)","rgb(166, 77, 121)"],["rgb(133, 32, 12)","rgb(153, 0, 0)","rgb(180, 95, 6)","rgb(191, 144, 0)","rgb(56, 118, 29)","rgb(19, 79, 92)","rgb(17, 85, 204)","rgb(11, 83, 148)","rgb(53, 28, 117)","rgb(116, 27, 71)"],["rgb(91, 15, 0)","rgb(102, 0, 0)","rgb(120, 63, 4)","rgb(127, 96, 0)","rgb(39, 78, 19)","rgb(12, 52, 61)","rgb(28, 69, 135)","rgb(7, 55, 99)","rgb(32, 18, 77)","rgb(76, 17, 48)"]]});$(e).ajaxForm(getAjaxformOption(e));$(e+" div.label").click(function(){$(":input:visible:first",$(this).next()).select()});$(e+" .addC").nextAll().hide();$(e+" .addC").click(function(){$(this).hide();$(this).next().show();$(this).next().children(".ui-datepicker-trigger").show();$(this).next().children(".ui-tabs").show();$(this).next().children(".cke").show();$(this).prev().css("width","100%");$(this).next().find(":input:first").focus()});if($(e+" .ui-datepicker-trigger").length){$(e+" .ui-datepicker-trigger").css("width","30px")}$(e+" select[multiple]:not([readonly]):not([disabled])").click(function(){multipleSelectOnClick(this.id)}).each(function(){multipleSelectVals[this.id]=$(this).val()});$("*:input:checkbox[data-max-selection]").click(function(h){var g=h.target.dataset.maxSelection;if(g>0){var f=$(h.target).parent().parent();$(f).find('span[class="max-selection-alert"]').remove();if($(f).find(":checkbox:checked").length>=g){if($(f).find(":checkbox:checked").length>g){$(h.target).attr("checked",false)}$(f).find(":checkbox:not(:checked)").attr("disabled",true);$(f).append('<span class="max-selection-alert" style="color:DarkGray">You can only select '+g+" items</span>")}else{$(f).find(":checkbox:not(:checked)").attr("disabled",false)}}});$(e+" div.field .label").bind("contextmenu",function(f){$(this).parent().find(">.addinfo").show();return false});$(e+" div.field").mouseleave(function(f){$(this).find(".addinfo").hide()});$(e+" div.field div.value span.genPasswordBtn").click(function(g){var f=$(this).attr("data-wigii-for");if(f){if($("#"+f).attr("type")=="password"){$(this).parent().find('span.showPasswordBtn[data-wigii-for="'+f+'"]').click()}$("#"+f).val(wigii().genPassword())}});$(e+" div.field div.value span.showPasswordBtn").click(function(g){var f=$(this).attr("data-wigii-for");if(f){$(this).show();if($("#"+f).attr("type")=="password"){$("#"+f).attr("type","text");$(this).css("text-decoration","line-through")}else{$("#"+f).attr("type","password");$(this).css("text-decoration","none")}}});$(e+" div.field div.value span.showPasswordBtn").each(function(h){var f=$(this).attr("data-wigii-for");var g=$(this);if(f){$("#"+f).on("input",function(){g.show()})}});if(isWorkzoneViewDocked()){addScrollWithShadow($(e).parent().prop("id"))}}function addJsCodeOnTimeRangeChooser(g,e,f){var a=function(l,k,j){var h=this;h.className="TimeSlotChooser";h.ctxKey=l+"_"+k+"_"+h.className;h.options=j||{};h.context={pageNo:0,nbPages:0,queryObject:{begDate:undefined,nbOfDays:undefined},timeSlots:[],timeSlotIndex:{}};h.impl={onSelectTimeSlotSubscribers:[]};h.formId=l;h.fieldName=k;h.field=function(){return $("#"+h.formId+"__"+h.fieldName)};h.$=function(){return $("#"+h.formId+"__"+h.fieldName+" div.globalTimeSlots")};if(!h.options.nbOfDays){h.options.nbOfDays=5}h.queryObject=function(){return h.context.queryObject};h.loadNewPage=function(p,m){var n;if(h.context.nbPages==0){n=wigii().day2string()}else{n=(h.context.timeSlots[h.context.timeSlotIndex["page_"+h.context.nbPages+"_end"]]).begDate;n=(new Date(n)).getTime();n+=3600*24*1000;n=wigii().day2string(new Date(n))}h.context.queryObject.begDate=n;h.context.queryObject.nbOfDays=h.options.nbOfDays;var o=function(w){if(w.length>0){var u=h.context.nbPages+1;var x=h.context.timeSlots.length;h.context.timeSlotIndex["page_"+u+"_start"]=x;for(var s=0;s<w.length;s++){var q=w[s];h.context.timeSlots.push(q);h.context.timeSlotIndex[q.begDate+" "+q.begTime]=x;x++}h.context.timeSlotIndex["page_"+u+"_end"]=x-1;h.context.nbPages=u}if(p){p(h,m)}};if(h.options.timeSlotQueryUrl){if(!h.impl.ajaxOptions){h.impl.ajaxOptions={};h.impl.ajaxOptions.type="POST";h.impl.ajaxOptions.contentType="text/plain";h.impl.ajaxOptions.dataType="json";h.impl.ajaxOptions.processData=false;h.impl.ajaxOptions.xhrFields={withCredentials:true};h.impl.ajaxOptions.crossDomain=true;h.impl.ajaxOptions.error=wigii().defaultFxErrorHandler}h.impl.ajaxOptions.url=h.options.timeSlotQueryUrl;h.impl.ajaxOptions.data=JSON.stringify(h.context.queryObject);h.impl.ajaxOptions.success=o;$.ajax(h.impl.ajaxOptions)}else{o(wigii().genTimeSlots(h.context.queryObject.begDate,undefined,{nbDays:h.context.queryObject.nbOfDays}))}};h.reset=function(){h.context.timeSlotIndex={};h.context.timeSlots=[];h.context.nbPages=0;h.context.pageNo=0;h.today()};h.today=function(){h.impl.gotoPage(1)};h.nextRange=function(){h.impl.gotoPage(h.context.pageNo+1)};h.previousRange=function(){if(h.context.pageNo>1){h.impl.gotoPage(h.context.pageNo-1)}};h.impl.gotoPage=function(s){if(s<=0){throw wigii().createServiceException("page number should start at 1",wigii().errorCodes.INVALID_ARGUMENT)}var q=s;var o=function(n){n.context.pageNo=q;if(q==1){n.$().find("div.commands span.glyphicon-chevron-left").addClass("disabled")}else{n.$().find("div.commands span.glyphicon-chevron-left").removeClass("disabled")}n.impl.renderTimeSlots(n.context.timeSlotIndex["page_"+n.context.pageNo+"_start"],n.context.timeSlotIndex["page_"+n.context.pageNo+"_end"])};var m=function(n,p){if(p>0){n.loadNewPage(m,p-1)}else{o(n)}};if(h.context.nbPages>=q){o(h)}else{if(q==h.context.nbPages+1){h.loadNewPage(o)}else{m(h,q-h.context.nbPages)}}};h.selectTimeSlot=function(n,p){var m;m=h.context.timeSlotIndex[n+" "+p];if(m!==undefined){m=h.context.timeSlots[m]}if(m){$("#"+h.formId+"_"+h.fieldName+"_begTime_text").val(m.begTime);$("#"+h.formId+"_"+h.fieldName+"_endTime_text").val(m.endTime);$("#"+h.formId+"_"+h.fieldName+"_begDate_text, #"+h.formId+"_"+h.fieldName+"_endDate_text").val(wigii().txtFrenchDate(m.begDate,"noTime")).change();if($("#"+h.formId+"_"+h.fieldName+"_isAllDay_checkbox").prop("checked")){$("#"+h.formId+"_"+h.fieldName+"_isAllDay_checkbox").click()}if(h.impl.onSelectTimeSlotSubscribers.length>0){for(var o=0;o<h.impl.onSelectTimeSlotSubscribers.length;o++){h.impl.onSelectTimeSlotSubscribers[o](m,h)}}}};h.onSelectTimeSlot=function(m){if(!$.isFunction(m)){throw wigii().createServiceException("onSelectTimeSlot event handler should be a function",wigii().errorCodes.INVALID_ARGUMENT)}h.impl.onSelectTimeSlotSubscribers.push(m)};h.impl.renderTimeSlots=function(s,w){var o=h.impl.container.reset().htmlBuilder();var q;for(var n=s;n<=w;n++){var m=h.context.timeSlots[n];var p=false;if(n==s){q=m.begDate;p=true}else{if(m.begDate!=q){o.$tag("div");q=m.begDate;p=true}}if(p){o.tag("div","class","dayTimeSlots","data-timeslotdate",m.begDate);var u=new Date(m.begDate);o.tag("div","class","timeSlotHeader").tag("p","class","title").put(wigii().txtFrenchDate(u,"longDate")).$tag("p").tag("p","class","date").put(wigii().txtWeekDay(u)).$tag("p").$tag("div")}o.tag("div","class","timeSlot").put(m.begTime).$tag("div")}o.$tag("div");o.emit();h.$().find("div.timeSlotsContainer div.timeSlot").click(function(){h.selectTimeSlot($(this).parent().attr("data-timeslotdate"),$(this).text())})};if(!window.wncd){wigii().createServiceException("Wigii NCD library is required to render TimeSlotChooser",wigii().errorCodes.CONFIGURATION_ERROR)}h.impl.container=h.$().find("div.timeSlotsContainer").wncd("html");h.field().data(h.ctxKey,h);h.$().find("div.commands span.glyphicon-chevron-left").click(h.previousRange);h.$().find("div.commands span.glyphicon-calendar").click(h.today);h.$().find("div.commands span.glyphicon-chevron-right").click(h.nextRange);h.today()};var b={};var c=$("#"+g+"__"+e+" div.globalTimeSlots");if(c.attr("data-nbofdays")){b.nbOfDays=Number.parseInt(c.attr("data-nbofdays"))}if(c.attr("data-freetimeslotsexp")){b.timeSlotQueryUrl=encodeURI(SITE_ROOT+"useContext/"+crtContextId+EXEC_requestSeparator+crtWigiiNamespaceUrl+"/"+crtModuleName+"/"+(f?"public/storedFx":"fx")+"/"+c.attr("data-freetimeslotsexp"))}new a(g,e,b)}function convertTimestamps(a){orignalText=$(a).val();res=orignalText.match(/TIMESTAMP\(([0-9]{4}\-[0-9]{2}\-[0-9]{2}[ \:0-9]*)\)/gi);for(r in res){d=new Date(res[r].replace("TIMESTAMP","").replace("(","").replace(")","").replace(/-/g,"/"));orignalText=orignalText.replace(res[r],Math.round(d.getTime()/1000))}$(a).val(orignalText)}emailingFormCrtMergeField="";function setListenerForEmailMerge(a){$("#"+a+" #Emailing_form__message>.label span").click(function(b){clone=$(this).clone();clone.css("position","absolute");clone.css("z-index","999999999");clone.offset({left:$(this).position().left+10,top:$(this).position().top+10});emailingFormCrtMergeField=clone.attr("title");crtOverSubject=false;$("#"+a+"").mousemove(function(c){clone.offset({left:c.pageX+10,top:c.pageY+10})});$("#"+a+" #Emailing_form_object_value_text").mouseenter(function(){crtOverSubject=true});$("#"+a+" #Emailing_form_object_value_text").mouseleave(function(){crtOverSubject=false});b.stopPropagation();$("#"+a+"").one("click",function(){clone.remove();if($("#"+a+" #Emailing_form_object_value_text:focus").length){$("#"+a+" #Emailing_form_object_value_text").val($("#"+a+" #Emailing_form_object_value_text").val()+emailingFormCrtMergeField)}emailingFormCrtMergeField=null;$("#cke_Emailing_form_message_value_textarea iframe").contents().find("body").unbind("click")});$("#cke_Emailing_form_message_value_textarea iframe").contents().find("body").one("click",function(){clone.remove();ckInst=CKEDITOR.instances.Emailing_form_message_value_textarea;ckInst.insertHtml(emailingFormCrtMergeField);$("#"+a+"").unbind("click");emailingFormCrtMergeField=null});$("#"+a+" #Emailing_form__message>.label").append(clone)})}confirmationEmailFormCrtMergeField="";function setListenerForConfirmationEmailMerge(a){$("#groupSubscription_form__subscriptionConfEmailText>.label span").click(function(b){clone=$(this).clone();clone.css("position","absolute");clone.css("z-index","999999999");clone.offset({left:$(this).position().left+10,top:$(this).position().top+10});confirmationEmailFormCrtMergeField=clone.attr("title");crtOverSubject=false;$("#"+a+"").mousemove(function(c){clone.offset({left:c.pageX+10,top:c.pageY+10})});$("#groupSubscription_form_subscriptionConfEmailSubject_tabs input").mouseenter(function(){crtOverSubject=true});$("#groupSubscription_form_subscriptionConfEmailSubject_tabs input").mouseleave(function(){crtOverSubject=false});b.stopPropagation();$("#"+a+"").one("click",function(){clone.remove();if($("#groupSubscription_form_subscriptionConfEmailSubject_tabs input:focus").length){$("#groupSubscription_form_subscriptionConfEmailSubject_tabs input:focus").val($("#groupSubscription_form_subscriptionConfEmailSubject_tabs input:focus").val()+confirmationEmailFormCrtMergeField)}confirmationEmailFormCrtMergeField=null;$("#cke_groupSubscription_form_subscriptionConfEmailText_value_l01_textarea iframe").contents().find("body").unbind("click");$("#cke_groupSubscription_form_subscriptionConfEmailText_value_l02_textarea iframe").contents().find("body").unbind("click")});$("#cke_groupSubscription_form_subscriptionConfEmailText_value_l01_textarea iframe").contents().find("body").one("click",function(){clone.remove();ckInst=CKEDITOR.instances.groupSubscription_form_subscriptionConfEmailText_value_l01_textarea;ckInst.insertHtml(confirmationEmailFormCrtMergeField);$("#"+a+"").unbind("click");confirmationEmailFormCrtMergeField=null});$("#cke_groupSubscription_form_subscriptionConfEmailText_value_l02_textarea iframe").contents().find("body").one("click",function(){clone.remove();ckInst=CKEDITOR.instances.groupSubscription_form_subscriptionConfEmailText_value_l02_textarea;ckInst.insertHtml(confirmationEmailFormCrtMergeField);$("#"+a+"").unbind("click");confirmationEmailFormCrtMergeField=null});$("#groupSubscription_form__subscriptionConfEmailText>.label").append(clone)})}function actOnDisplayOnRightSide(e,b,c,a){if($("#elementRightSide").length==0){if($("#"+e+" .elementDetail").length){$("#"+e+" .elementDetail").wrapInner('<div class="center" />');$("#"+e+" .elementDetail").prepend('<table style="border:none;border-collapse:collapse;margin:0px;padding:0px;"><tr><td valign="top" class="center"></td><td valign="top" class="right"></td></tr></table>');$("#"+e+" .elementDetail td.center").append($("#"+e+" .elementDetail div.center"));$("#"+e+" .elementDetail td.right").append('<div style="float:left;border-width:1px;padding:5px;width:'+(c)+'px;text-align:left;" id="elementRightSide" class="Tcolor"></div>');$("#"+e+" .elementDetail>table td.center").width(a+22);$("#"+e+"").closest(".ui-dialog").width(a+c+32);$("#"+e+">div.T").width(a+c+31);if($("#"+e+"").closest(".ui-dialog").position()){$("#"+e+"").closest(".ui-dialog").css("left",Math.min($("#"+e+"").closest(".ui-dialog").position().left,$(window).width()-$("#"+e+"").closest(".ui-dialog").outerWidth()-5))}}else{if($("#mainDiv .elementDetail").length){$("#mainDiv .elementDetail").wrapInner('<div class="center" />');$("#mainDiv .elementDetail").prepend('<table style="border:none;border-collapse:collapse;margin:0px;padding:0px;"><tr><td valign="top" class="center"></td><td valign="top" class="right"></td></tr></table>');$("#mainDiv .elementDetail td.center").append($("#mainDiv .elementDetail div.center"));$("#mainDiv .elementDetail td.right").append('<div style="float:left;border-width:1px;padding:5px;width:'+(c)+'px;text-align:left;" id="elementRightSide" class="Tcolor"></div>');$("#mainDiv .elementDetail>table td.center").width(a+22)}else{if($("#mainDiv .public form").length){$("#mainDiv .public form").wrapInner('<div class="center" />');$("#mainDiv .public form").prepend('<table style="border:none;border-collapse:collapse;margin:0px;padding:0px;"><tr><td valign="top" class="center"></td><td valign="top" class="right"></td></tr></table>');$("#mainDiv .public form td.center").append($("#mainDiv .public form div.center"));$("#mainDiv .public form td.right").append('<div style="float:left;border-width:1px;padding:5px;width:'+(c)+'px;text-align:left;" id="elementRightSide" class="Tcolor"></div>');$("#mainDiv .public form>table td.center").width(a+22);$("#mainDiv .public form").width(a+c+32);$("#mainDiv .public").width(a+c+32);$("#mainDiv .public form>table").after($("#mainDiv .public form>table td.center>div.center>div.publicFormBorder"));$("#mainDiv .public form>div.publicFormBorder").width(a+c+32)}else{if($("#mainDiv .public").length){$("#mainDiv .public").wrapInner('<div class="center" />');$("#mainDiv .public").prepend('<table style="border:none;border-collapse:collapse;margin:0px;padding:0px;"><tr><td valign="top" class="center"></td><td valign="top" class="right"></td></tr></table>');$("#mainDiv .public td.center").append($("#mainDiv .public div.center"));$("#mainDiv .public td.right").append('<div style="float:left;border-width:1px;padding:5px;width:'+(c)+'px;text-align:left;" id="elementRightSide" class="Tcolor"></div>');$("#mainDiv .public>table td.center").width(a+22);$("#mainDiv .public").width(a+c+32);$("#mainDiv .public>table").after($("#mainDiv .public>table td.center>div.center>div.publicFormBorder"));$("#mainDiv .public>div.publicFormBorder").width(a+c+32)}else{if($("#"+e+" form").length){$("#"+e+" form").wrapInner('<div class="center" />');$("#"+e+" form").prepend('<table style="border:none;border-collapse:collapse;margin:0px;padding:0px;"><tr><td valign="top" class="center"></td><td valign="top" class="right"></td></tr></table>');$("#"+e+" form td.center").append($("#"+e+" form div.center"));$("#"+e+" form td.right").append('<div style="float:left;border-width:1px;padding:5px;width:'+(c)+'px;text-align:left;" id="elementRightSide" class="Tcolor"></div>');$("#"+e+" form>table td.center").width(a+12);$("#"+e+" form").width(a+c+32);$("#"+e+"").closest(".ui-dialog").width(a+c+37);if($("#"+e+"").closest(".ui-dialog").position()){$("#"+e+"").closest(".ui-dialog").css("left",Math.min($("#"+e+"").closest(".ui-dialog").position().left,$(window).width()-$("#"+e+"").closest(".ui-dialog").outerWidth()-5))}$("#"+e).ready(function(){var f=$(".ui-dialog").width()+20;$(".ui-dialog").css("width",f)})}else{return}}}}}}$("#"+b).width(c).find("div.label").width(c).next().width(c);if($("#"+b+" div.value>div").length){$("#"+b+" div.value>div").width(c)}$("#elementRightSide").append($("#"+b));$("#elementRightSide .label").css("font-weight","bold");$("#elementRightSide .field:gt(0)").css("border-top","solid 2px #fff").css("margin-top","5px");if($("#"+e+" .elementDetail").length){$("#elementRightSide div.value").css("max-height",((($(".elementDetail table td.center>div.center").height())/$("#elementRightSide div.value").length)-30)+"px").css("overflow-y","scroll")}if($("#mainDiv .public").length&&$("#mainDiv .public form").length==0){$("#elementRightSide div.value").css("max-height",((($("#mainDiv .public table td.center>div.center").height())/$("#elementRightSide div.value").length)-30)+"px").css("overflow-y","scroll")}$(".ui-dialog").css("max-width","")}function messageDownload(a){if(domElementHasWigiiService("#"+a,"box")){$("#fileDownloadingBar").html(wigii().context.box.fileDownloadingWaitingMsg);setVis("fileDownloadingBar",true)}else{$("#fileDownloadingBar").html(wigii().context.fileDownloadingWaitingMsg)}}function setListenerToDownloadFile(a,c,b){$("#"+a+" .fileDownload").click(function(f){messageDownload(a);if(domElementHasWigiiService("#"+a,"box")){setTimeout(function(){setVis("fileDownloadingBar",false)},5000)}f.stopPropagation();download(b);return false})}function setListenerToPreviewFile(a,e,c,b){$("#"+a+" .value .imgPreview").click(function(f){previewImage(c,b);messageDownload(a);f.stopPropagation()});$("#"+a+" .value .htmlPreview").click(function(f){previewHtml(c,b);messageDownload(a);f.stopPropagation()});$("#"+a+" .value .htmlPreviewPrint").click(function(f){previewHtml(c,b,true);messageDownload(a);f.stopPropagation()})}function setListenerToUnzipForViewing(a,e,c,b){$("#"+a+" .value .htmlPreview").click(function(f){previewUnzipForViewing(c,b);f.stopPropagation()})}function setListenerToAddJournalItem(k,c,l,h,e,g,a,j,f,b,m){if(k==""){k="mainDiv"}if(!$("#"+h+"").hasClass("allowOnReadOnly")&&(($("#"+k+">.elementDetail").length==1&&$("#"+k+" div.T div.el_edit").length==0)||$("#"+h+".readOnly").length>0)){$("#"+h+" div.label span").remove();$("#"+h+" div.label").text($("#"+h+" div.label").text().replace("(","").replace(")",""));return}$("#"+h+" div.label span.addJournalItem").click(function(n){emb=$(this);$(emb).parent().find(".addJournalItemMenu").remove();$(emb).after('<div class="addJournalItemMenu SBB ui-corner-all" style="z-index:999999;position:fixed;font-weight:normal;background-color:#fff;top:'+(Math.min(n.pageY-$(window).scrollTop(),$(window).height()-350))+"px; left:"+(Math.min(n.pageX-$(window).scrollLeft(),$(window).width()-420))+'px; padding:5px; " ><span class="label" style="float:left;margin-top:5px; margin-bottom:5px;width:400px;" >'+$(emb).parent().text().replace(/\(.*\)/,"")+'</span><div class="clear"></div><textarea id="'+h+'_addJournalItem" style="margin-top:5px; margin-bottom:5px;width:400px;" class="elastic" ></textarea><br /><input type="button" name="ok" value="'+j+'" /><input type="button" name="cancel" value="'+f+'" /></div>');if(g){options={};if($("#"+h+" div.value textarea").hasClass("wordlimit")){wordlimit=$("#"+h+" div.value textarea").attr("class").match(/ wordlimit_([0-9]*) /g)[0].replace(/ wordlimit_([0-9]*) /g,"$1");options=$.extend({extraPlugins:"wordcount,undo",wordcount_limit:wordlimit,wordcount_format:'<span class="cke_path_item">Word count: %count% / %limit%</span>'},options)}else{if($("#"+h+"").hasClass("wordlimit")){wordlimit=$("#"+h+"").attr("class").match(/ wordlimit_([0-9]*) /g)[0].replace(/ wordlimit_([0-9]*) /g,"$1");options=$.extend({extraPlugins:"wordcount,undo",wordcount_limit:wordlimit,wordcount_format:'<span class="cke_path_item">Word count: %count% / %limit%</span>'},options)}}options=$.extend({language:e,scayt_sLang:getScayt_sLangFromLanguage(e),baseFloatZIndex:$(this).closest(".ui-dialog").css("zIndex")+1,toolbar:getBasicCKEditorToolbar(),toolbarCanCollapse:true,toolbarStartupExpanded:$(emb).parent().parent().find(".activateHtmlArea").length>0,width:400,height:200,resize_minWidth:50,startupFocus:true,allowedContent:true,filebrowserUploadUrl:crtWigiiNamespaceUrl+"/"+crtModuleName+"/CKEditor/upload"},options);$(emb).parent().find(".elastic").ckeditor(function(){},options)}else{autosize($(emb).parent().find(".elastic").css("max-height",450).css("min-height",30));if($(emb).parent().parent().find(".value textarea").hasClass("wordlimit")){$(emb).parent().find(".elastic").wordlimit({allowed:$(emb).parent().parent().find(".value textarea").attr("class").match(/ wordlimit_([0-9]*) /g)[0].replace(/ wordlimit_([0-9]*) /g,"$1")})}else{if($(emb).parent().parent().hasClass("wordlimit")){$(emb).parent().find(".elastic").wordlimit({allowed:$(emb).parent().parent().attr("class").match(/ wordlimit_([0-9]*) /g)[0].replace(/ wordlimit_([0-9]*) /g,"$1")})}}$(emb).parent().find(".elastic").focus()}$(emb).next().click(function(o){o.stopPropagation();return false});$('.addJournalItemMenu input[type="button"]:input[name="cancel"]',$(emb).parent()).click(function(){$(this).parent().hide()});$('.addJournalItemMenu input[type="button"]:input[name="ok"]',$(emb).parent()).click(function(){$(this).parent().hide();if(b){url=SITE_ROOT+"Update/"+crtContextId+EXEC_requestSeparator+b;var o=new jQuery.ajax({type:"POST",url:encodeURI(url),success:parseUpdateResult,cache:false,data:{addJournalItemMessage:a.replace(m,$(this).parent().find("textarea").val()),elementId:c,journalFieldName:l,elementDialogId:k},error:errorOnUpdate})}else{$("#"+h+" div.value textarea").val(a.replace(m,$(this).parent().find("textarea").val()).replace(/\\n/g,"\n").replace("style=&quot;",'style="').replace("&quot;>",'">')+$("#"+h+" div.value textarea").val());if(!g){$("#"+h+" div.value textarea").change().blur()}else{$("#"+h+" div.value textarea").blur()}}});$(emb).next().draggable({handle:".label"});n.stopPropagation();return false})}function setListenerToPreviousVersions(inputPathId,areYouSure){$("#"+inputPathId).parent().find("a.previousVersion").mouseenter(function(){$(this).parent().find(".deletePreviousVersion").stop().remove();$(this).append('<span class="deletePreviousVersion" style="font-size:11px;padding:5px;margin-top:-8px;margin-right:-5px;margin-left:0px;cursor:pointer;display:none;">x</span>');$(".deletePreviousVersion",this).show().click(function(e){var vToDel=$("#"+inputPathId).parent().find("a.previousVersion:has(span.deletePreviousVersion)");jYescancel(areYouSure+":<br /><br />"+$(this).parent().find("span.H").text(),null,function(check){if(check===true){eval(vToDel.attr("href").replace("javascript:download('"+SITE_ROOT.replace("//","//"),"update('NoAnswer/").replace("previousVersion","deletePreviousVersion"));vToDel.fadeOut(800,function(){vToDel.remove()})}else{if(check===null){}}});e.stopPropagation();return false})}).mouseleave(function(){$(".deletePreviousVersion",this).stop().fadeOut(500,function(){$(this).remove()})})}function setListenerToEmailExternalCode(j,a,f,e,h,l,m,c,b,k,g){if(j==""){j="mainDiv"}$("#"+a+"").click(function(){setVis("busyDiv",true);url=SITE_ROOT+"Update/"+crtContextId+EXEC_requestSeparator+"emailExternalCodeMenu/"+crtWigiiNamespaceUrl+"/"+crtModuleName+"/getExternalAccessMenuContent";var n=new jQuery.ajax({type:"POST",url:encodeURI(url),success:function(o,p){otherRequest=o.split(EXEC_answerRequestSeparator);o=otherRequest[0].split(EXEC_answerParamSeparator);otherRequest.shift();i=1;externalAccessMenusendEmailTitle=o[i++];externalAccessMenuEndDate=o[i++];okLabel=o[i++];cancelLabel=o[i++];subjectLabel=o[i++];helloBaseText=o[i++];helloBaseSubject=o[i++];validationEmailHtml=o[i++];validationEmailSubject=o[i++];externalAccessViewEmailHtml=o[i++];externalAccessViewEmailSubject=o[i++];externalAccessEditEmailHtml=o[i++];externalAccessEditEmailSubject=o[i++];areYouSureToStopExternalAccess=o[i++];emb=$("#"+a+"");$(emb).parent().find(".externalAccessMenu").remove();$(emb).after('<div class="externalAccessMenu SBB ui-corner-all" style="font-weight:normal;background-color:#fff;top:'+(parseInt($(emb).position().top)+parseInt($(emb).outerHeight()))+"px; left:"+($(emb).position().left-170)+'px; padding:5px; position:absolute;" ><div style="width:380px;font-weight:bold;">'+externalAccessMenusendEmailTitle+"</div>"+m+'<div class="endDate" style="cursor:pointer;margin-bottom:5px;margin-top:5px;"><span class="endDate" style="cursor:pointer;margin-right:5px;" onclick="$(this).next().focus();">'+externalAccessMenuEndDate+'</span><input class="endDate" type="text" name="externalAccessEndDate" value="'+l+'" /></div><hr class="SBB"><span class="grayFont subject" style="display:none;">'+subjectLabel+'&nbsp;</span><input class="subject" type="text" name="subject" value="" style="display:none;margin-top:0px; margin-bottom:5px;" /><textarea style="display:none;margin-top:5px; margin-bottom:5px;" class="elastic"></textarea><br /><input type="button" name="ok" disabled="on" value="'+okLabel+'" /><input type="button" name="cancel" value="'+cancelLabel+'" /></div>');externalTempCode=null;$(emb).parent().find("input.subject").width(395-$(emb).parent().find("span.subject").width());if((!isWorkzoneViewDocked()&&$("#"+j+" div.T div.el_edit").length==0)||(isWorkzoneViewDocked()&&$("#searchBar .middleBox div.T div.el_edit").length==0)){$('.externalAccessMenu input[value="externalAccessMenuViewLink"]').hide().next().hide().next().hide();$('.externalAccessMenu input[value="externalAccessMenuEditLink"]').hide().next().hide().next().hide();$('.externalAccessMenu input[value="externalAccessMenuStop"]').hide().next().hide().next().hide();$('.externalAccessMenu input[value="externalAccessMenuValidationLink"]').hide().next().hide().next().hide()}$(emb).parent().find(".endDate").hide();$(emb).next().find('input[type="radio"]').click(function(){$(this).attr("checked",true);$(this).parent().find('input[type="button"]:input[name="ok"]').removeAttr("disabled");showCkEditor=false;showEndDate=false;switch($(this).val()){case"externalAccessMenusendEmail":$(this).parent().find("span.stopAccess").remove();$(this).parent().find(".elastic").val(helloBaseText);$(this).parent().find("input.subject").val(helloBaseSubject);externalTempCode=null;showEndDate=false;showCkEditor=true;break;case"externalAccessMenuValidationLink":$(this).parent().find("span.stopAccess").remove();$(this).parent().find(".elastic").val(validationEmailHtml);$(this).parent().find("input.subject").val(validationEmailSubject);externalTempCode=f;showEndDate=false;showCkEditor=true;break;case"externalAccessMenuViewLink":$(this).parent().find("span.stopAccess").remove();$(this).parent().find(".elastic").val(externalAccessViewEmailHtml);$(this).parent().find("input.subject").val(externalAccessViewEmailSubject);externalTempCode=h;showEndDate=true;showCkEditor=true;break;case"externalAccessMenuEditLink":$(this).parent().find("span.stopAccess").remove();$(this).parent().find(".elastic").val(externalAccessEditEmailHtml);$(this).parent().find("input.subject").val(externalAccessEditEmailSubject);externalTempCode=h;showEndDate=true;showCkEditor=true;break;case"externalAccessMenuStop":if($(this).parent().find(".cke").length>0){$(this).parent().find(".elastic").ckeditorGet().destroy()}$(this).parent().find(".elastic").hide();$(this).parent().find(".subject").hide();$(this).parent().find('input[type="button"]:input[name="ok"]').before('<span class="stopAccess">'+areYouSureToStopExternalAccess+"<br /><br /></span>");externalTempCode=h;showEndDate=false;showCkEditor=false;break}if(showEndDate){$(this).parent().find("input.endDate").datepicker({dateFormat:"dd.mm.yy",changeYear:true,firstDay:1,constrainInput:true,showOn:"button"}).width("75").click(function(){$(this).datepicker("hide")});$(this).parent().find(".endDate").show()}else{$(this).parent().find(".endDate").hide()}if(showCkEditor){$(this).parent().find(".subject").show();$(this).parent().find(".elastic").ckeditor({language:c,scayt_sLang:getScayt_sLangFromLanguage(c),baseFloatZIndex:$(this).closest(".ui-dialog").css("zIndex")+1,toolbar:getBasicCKEditorToolbar(),toolbarCanCollapse:true,toolbarStartupExpanded:false,extraPlugins:"autogrow",autoGrow_minHeight:Math.max(80,$(this).height()),width:400,allowedContent:true,resize_minWidth:50,startupFocus:true})}});$(emb).next().find('input[type="button"]:input[name="cancel"]').click(function(){$(this).parent().hide().remove()});$(emb).next().find('input[type="button"]:input[name="ok"]').click(function(){$(this).parent().hide();url=SITE_ROOT+"Update/"+crtContextId+EXEC_requestSeparator+j+"/"+crtWigiiNamespaceUrl+"/"+crtModuleName+"/element/manageEmail/"+b+"/";var q=new jQuery.ajax({type:"POST",url:encodeURI(url),success:parseUpdateResult,cache:false,data:{externalMessage:$(this).parent().find("textarea").val(),externalSubject:$(this).parent().find("input.subject").val(),externalAction:$(this).parent().find("input:radio:checked").val(),externalCode:externalTempCode,externalEndDate:$(this).parent().find("input.endDate").val(),externalElementId:b,externalFieldName:k,externalEmail:g},error:errorOnUpdate})});if(otherRequest){parseUpdateResult(otherRequest.join(EXEC_answerRequestSeparator),p)}},cache:false,data:{proofKey:f,externalCode:h,proofStatus:e},error:errorOnUpdate});onUpdateErrorCounter=0})}var crtAutoSaveFieldChanged={};var changeAutoSaveFieldForSubmit={};var tempAutoSaveFormIndex=0;function saveField(g,e,l,f,h){if(arguments.length<5){h=null}if($("#"+l+" input[name=captcha_code]").length){return false}setVis("busyDiv",true);if($("#"+l).hasClass("field")){var b=l.replace(g+"__","");var j=l}else{var c=$("#"+l).parents(".field");if(c.length>0){var b=c.attr("id").replace(g+"__","");var j=c.attr("id")}else{c=$("#"+l).parent().parent();if(c.attr("id").indexOf(g+"__")===0){var b=c.attr("id").replace(g+"__","");var j=$("#"+l).parent().find("div.cke_contents").attr("id")}else{throw"cannot find wrapping field name for "+l+" in autosave."}}}crtAutoSaveFieldChanged[b]=true;changeAutoSaveFieldForSubmit["changedAutoSaveField["+b+"]"]=true;var a=SITE_ROOT+e+"/"+b+(h?"/"+h:"");$("#"+j).prepend('<div class="autoSaveConfirmation ui-widget ui-corner-all" style="position:absolute;margin-left:0px;margin-top:20px;padding:2px;">'+f+'<span class="percent"></span></div>');asFid="tempAutoSaveFileForm"+(tempAutoSaveFormIndex++);$("#"+l).wrap('<form id="'+asFid+'" action="'+a+'" enctype="multipart/form-data" method="post" ></form>');var k=false;if($("#"+l).find(".removeDisableOnSubmit[disabled]").andSelf().filter(".removeDisableOnSubmit[disabled]").length){$("#"+l).find(".removeDisableOnSubmit[disabled]").andSelf().filter(".removeDisableOnSubmit[disabled]").attr("disabled",false);k=true}$("#"+asFid).ajaxForm({success:function(m,n){parseUpdateResult(m,n)},data:{autoSaveFieldId:l,autoSaveMesssageTargetId:j},uploadProgress:function(p,m,o,n){$("#"+j+" .autoSaveConfirmation .percent").html(" ("+n+"%)")},cache:false});$("#"+asFid).submit();setTimeout(function(){if(k){$("#"+l).find(".removeDisableOnSubmit").andSelf().filter(".removeDisableOnSubmit").attr("disabled",true)}$("#"+l).unwrap()},10)}function autoSaveCKEditor(b,c,e,a){$(b).ckeditorGet().updateElement();saveField(c,e,$(b).attr("id"),a);return false}var focusAutoSaveFieldId="initial";var crtAutoSaveFieldDirty={};var crtActiveCKEditor=null;var crtActiveOnlineFileTextContentId=null;var blockHistoryForOnlineFileTextFieldName=null;function setListenerForAutoSave(c,e,b){focusAutoSaveFieldId="initial";crtAutoSaveFieldDirty={};crtAutoSaveFieldChanged={};changeAutoSaveFieldForSubmit={};tempAutoSaveFormIndex=0;$("#"+c+" :input").change(function(){crtAutoSaveFieldDirty[$(this).parents(".field").attr("id")]=true});$("#"+c+" :radio, #"+c+" :checkbox").click(function(){crtAutoSaveFieldDirty[$(this).parents(".field").attr("id")]=true;if(crtAutoSaveFieldDirty[$(this).parents(".field").attr("id")]){saveField(c,e,$(this).parents(".field").attr("id"),b);crtAutoSaveFieldDirty[$(this).parents(".field").attr("id")]=false}});onFocus=function(f){if($(this).parents(".field").length){focusAutoSaveFieldId=$(this).parents(".field").attr("id")}};$("#"+c+" :input").focus(onFocus);onBlur=function(){var f=$(this).parents(".field").attr("id");focusAutoSaveFieldId="";setTimeout(function(){if((focusAutoSaveFieldId!=f)&&crtAutoSaveFieldDirty[f]){var g=null;if(f==c+"__"+blockHistoryForOnlineFileTextFieldName){g="blockHistory";blockHistoryForOnlineFileTextFieldName=null}saveField(c,e,f,b,g);crtAutoSaveFieldDirty[f]=false}},10)};$("#"+c+" :input:not(:radio,:checkbox)").blur(onBlur);$("#"+c+" select.flex, #"+c+" select.chosen").on("select2:open",onFocus).on("select2:close",onBlur);$("#"+c+" div.value textarea.htmlArea").blur(function(){crtActiveCKEditor=null;autoSaveCKEditor(this,c,e,b)});$("#"+c+" div.value textarea.htmlArea").focus(function(){crtActiveCKEditor=this});$("#"+c).stopTime(c+"autoSaveFormCKEditors");$("#"+c).everyTime(1000*30,c+"autoSaveFormCKEditors",function(g){if(crtActiveCKEditor!=null){autoSaveCKEditor(crtActiveCKEditor,c,e,b)}if(crtActiveOnlineFileTextContentId!=null){$(crtActiveOnlineFileTextContentId).val($("#elementPreview").find("textarea:first").ckeditorGet().getData());var f=$(crtActiveOnlineFileTextContentId).parents(".field").attr("id");saveField(c,e,f,b,(crtActiveOnlineFileTextContentId=="#editElement_form_"+blockHistoryForOnlineFileTextFieldName+"_textContent_textarea"?"blockHistory":null));crtAutoSaveFieldDirty[f]=false}});$("#"+c).ajaxForm($.extend({},getAjaxformOption("#"+c),{data:changeAutoSaveFieldForSubmit,beforeSerialize:function(){if($("#"+c+" .removeDisableOnSubmit").length>0){$("#"+c+" .removeDisableOnSubmit").removeAttr("disabled")}$("#"+c).find("form").each(function(){$(this).children().unwrap()})}}));if($("#"+c+" .cancel").length){$("#"+c+" .cancel").hide()}if($("#"+c).parents(".ui-dialog").find("button.cancel").length){$("#"+c).parents(".ui-dialog").find("button.cancel").hide()}if(isWorkzoneViewDocked()){var a=initMiddleBox();a.append($("#elementDialog .T").addClass("docked").css({width:""}));$("#searchBar .toolbarBox").hide()}}function setListenerForTimeline(h,a,f,c){var e=c.historyFields;e=$.parseJSON(e);var g=new Date();var b=g.getDate()+"."+(g.getMonth()+1)+"."+g.getFullYear();$("#"+a+" input").click(function(){if($(this).attr("class")=="inTimeline"){if($(this).prop("checked")==false){$(this).prop("checked",false)}else{$(this).prop("checked",true)}var k=$(this).parent().index()-1;var j=f-k;$(this).parent().parent().children("div .child:lt("+k+")").each(function(){var p=$(this).children("input").attr("value");var o=h+"_"+e[p]+"_value_text";$(this).children("input").prop("checked",true);if(!$("#"+o).attr("value")){$("#"+o).attr("value",b)}});$(this).parent().parent().children("div .child:gt(-"+j+")").each(function(){$(this).children("input").prop("checked",false)});$("#"+a+" .value").children("input").each(function(){$(this).prop("checked",false)});if($(this).prop("checked")==true){$(this).prop("checked",true);var n=$(this).attr("value");var m=$("#"+n.replace(/ /g,"_")+"_date span");var l=h+"_"+e[n]+"_value_text";$(this).attr("id");if(!$("#"+l).attr("value")){$("#"+l).attr("value",b);m.html(b).show()}}else{$("#"+a).prop("checked",false)}}})}function actOnHistorizedHtmlFile(a){if(a&&crtActiveOnlineFileTextContentId==("#editElement_form_"+a+"_textContent_textarea")){blockHistoryForOnlineFileTextFieldName=a}}function domElementAddWigiiService(a,g){var c=$(a).attr("data-wigii-service");if(c==null){c=g}else{var e=g.split(" ");var f=c.split(" ");for(key1 in e){var b=false;for(key2 in f){if(e[key1]===f[key2]){b=true}}if(!b){c=c.concat(" ".concat(e[key1]))}}}$(a).attr("data-wigii-service",c)}function domElementRemoveWigiiService(a,g){var b=$(a).attr("data-wigii-service");var f="";if(b!=null){var c=g.split(" ");var e=b.split(" ");for(key in c){e.splice(e.indexOf(c[key]),1)}for(key in e){f=f.concat(" ".concat(e[key]))}$(a).attr("data-wigii-service",f)}}function domElementHasWigiiService(a,c){var b=$(a).attr("data-wigii-service");if(b!=null){var e=b.split(" ");for(key in e){if(e[key]===c){return true}}}return false};