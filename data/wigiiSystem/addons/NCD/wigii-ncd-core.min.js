/*!
 *  This file is part of Wigii (R) software.
 *  Wigii is developed to inspire humanity. To Humankind we offer Gracefulness, Righteousness and Goodness.
 *  
 *  Wigii is free software: you can redistribute it and/or modify it 
 *  under the terms of the GNU General Public License as published by
 *  the Free Software Foundation, either version 3 of the License, 
 *  or (at your option) any later version.
 *  
 *  Wigii is distributed in the hope that it will be useful, but WITHOUT ANY WARRANTY; 
 *  without even the implied warranty of MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  
 *  See the GNU General Public License for more details.
 *
 *  A copy of the GNU General Public License is available in the Readme folder of the source code.  
 *  If not, see <http://www.gnu.org/licenses/>.
 *
 *  @copyright  Copyright (c) 2016-2017  Wigii.org
 *  @author     <http://www.wigii.org/system/libs>      Wigii.org 
 *  @link       <http://www.wigii-system.net>     		<https://github.com/wigii/wigii>   Source Code
 *  @license    <http://www.gnu.org/licenses/>     		GNU General Public License
 */
(function(window,$){var wigiiNcdOptions=undefined;if(window.wigiiNcd&&window.wigiiNcd.options){wigiiNcdOptions=window.wigiiNcd.options}if(!wigiiNcdOptions){wigiiNcdOptions={}}if(!wigiiNcdOptions.privateNcdMembers){wigiiNcdOptions.privateNcdMembers={}}var ncdprivate=function(memberName){wigiiNcdOptions.privateNcdMembers[memberName]=true};var wigiiNcdAttr=function(comment,f){if(wigiiNcdOptions.loadNcdAttributes&&f){var args=undefined;if(arguments.length>2){args=Array.prototype.slice.call(arguments);comment=args[0];f=args[args.length-1]}if($.isFunction(comment)){comment=comment.toString().match(/(\/\*\*([^*]|[\r\n]|(\*+([^*\/]|[\r\n])))*\*+\/)/g);if(comment){comment=comment[0]}}var wncdAttr=f.wncdAttr||{};if(comment){wncdAttr.comment=comment}if(args&&args.length>0){var i=0;var key,value;while(i<args.length){key=args[i];i++;if(i<args.length){value=args[i];i++}if(key&&value!==undefined){wncdAttr[key]=value}}}f.wncdAttr=wncdAttr}return f};var ncddoc=wigiiNcdAttr;var WigiiNcd=function(){var wigiiNcd=this;wigiiNcd.instantiationTime=Date.now();ncdprivate("instantiationTime");wigiiNcd.ctxKey="WigiiNcd_"+wigiiNcd.instantiationTime;wigiiNcd.context={};ncdprivate("context");wigiiNcd.errorCodes={UNAUTHORIZED:401,FORBIDDEN:403,NOT_FOUND:404,UNKNOWN_ERROR:1000,NOT_IMPLEMENTED:1001,WRAPPING:1002,UNSUPPORTED_OPERATION:1003,INVALID_ARGUMENT:1004,UNEXPECTED_ERROR:1005,DATA_INTEGRITY_ERROR:1006,DEPRECATED:1007,INVALID_STATE:1008,CONFIGURATION_ERROR:1009,OPERATION_CANCELED:1010,OUT_OF_BOUND:3100,ALREADY_EXISTS:3101,DOES_NOT_EXIST:3102,SYNTAX_ERROR:3800,SYMBOL_NOT_FOUND:4600,INVALID_RETURN_VALUE:4601,VARIABLE_NOT_DECLARED:4602,DIVISION_BY_ZERO:4603,ASSERTION_FAILED:4604};wigiiNcd.initializeErrorLabels=function(){if(!wigiiNcd.errorLabels){wigiiNcd.errorLabels={};for(var errName in wigiiNcd.errorCodes){wigiiNcd.errorLabels[wigiiNcd.errorCodes[errName]]=errName}}};ncdprivate("initializeErrorLabels");wigiiNcd.initializeErrorLabels();ncddoc(function(){},wigiiNcd.ServiceException=function(message,code,previous){var self=this;self.name="ServiceException";self.message=message;self.code=code||wigiiNcd.errorCodes.UNKNOWN_ERROR;self.previousException=previous});ncddoc(function(){},wigiiNcd.StringStack=function(){var self=this;self.className="StringStack";self.ctxKey=wigiiNcd.ctxKey+"_"+self.className;self.stack=[];self.popSubscribers=[];self.push=function(str){self.stack.push({start:str,content:"",end:undefined});return self};self.append=function(str){var top=undefined;if(self.stack.length>0){top=self.stack[self.stack.length-1]}if(!top){top={start:"",content:""+str,end:undefined};self.stack.push(top)}else{top.content+=str}return self};self.current=function(){if(self.stack.length>0){return self.stack[self.stack.length-1].content}else{return""}};self.reset=function(){self.stack=[]};self.pop=function(str){var top=self.stack.pop();if(!top){top={start:"",content:"",end:undefined}}top.end=""+str;if(self.popSubscribers.length>0){for(var i=0;i<self.popSubscribers.length;i++){self.popSubscribers[i](top.start,top.content,top.end)}}if(self.stack.length>0){self.stack[self.stack.length-1].content+=top.start+top.content+top.end}else{return top.start+top.content+top.end}};self.onPop=function(eventHandler){if(!$.isFunction(eventHandler)){throw wigiiNcd.createServiceException("pop event handler should be a function",wigiiNcd.errorCodes.INVALID_ARGUMENT)}self.popSubscribers.push(eventHandler)}});ncddoc(function(){},wigiiNcd.HtmlEmitter=function(output){var self=this;self.className="HtmlEmitter";self.ctxKey=wigiiNcd.ctxKey+"_"+self.className;self.options={};self.context={};self.impl={};self.modelers=[];self.children={};if(!output){output=$("body")}else{output=$(output)}self.$=function(){return output};self.emittedClass=function(cssClass){if(cssClass){self.options.emittedClass=cssClass}if(!self.options.emittedClass){self.options.emittedClass="ncd"}return self.options.emittedClass};self.addModeler=function(modeler){self.modelers.push(modeler);modeler(self);if(self.children){for(var i=0;i<self.children.length;i++){self.children[i].addModeler(modeler)}}return self};self.setCursor=function(node){self.context.cursor=output.find(node)};self.removeCursor=function(){self.context.cursor=undefined};self.put=function(str){self.htmlTree.append(str);return self};self.startH1=function(cssClass){self.htmlTree.push(wigiiNcd.getHtmlBuilder().putStartTag("h1","class",self.emittedClass()+(cssClass?" "+cssClass:"")).html());return self};self.endH1=function(){self.impl.putHtml(self.htmlTree.pop("</h1>"));return self};self.startP=function(cssClass){self.htmlTree.push(wigiiNcd.getHtmlBuilder().putStartTag("p","class",self.emittedClass()+(cssClass?" "+cssClass:"")).html());return self};self.endP=function(){self.impl.putHtml(self.htmlTree.pop("</p>"));return self};self.startSpan=function(cssClass){self.htmlTree.push(wigiiNcd.getHtmlBuilder().putStartTag("span","class",self.emittedClass()+(cssClass?" "+cssClass:"")).html());return self};self.endSpan=function(){self.impl.putHtml(self.htmlTree.pop("</span>"));return self};self.startColor=function(color,backgroundColor,cssClass){self.htmlTree.push(wigiiNcd.getHtmlBuilder().putStartTag("span","class",self.emittedClass()+(cssClass?" "+cssClass:""),"style","color:"+color+";"+(backgroundColor?"margin:0.05em;padding:0.03em 0.1em;border-style:solid;border-radius:0.2em;background-color:"+backgroundColor+";border-color:"+color+";":"")).html());return self};self.endColor=function(){self.impl.putHtml(self.htmlTree.pop("</span>"));return self};self.startDelay=function(delay,cssClass){self.htmlTree.push(wigiiNcd.getHtmlBuilder().putStartTag("div","class",self.emittedClass()+(cssClass?" "+cssClass:""),"style","display:none;","data-ncd-delay",delay).html());return self};self.endDelay=function(){var delayedDiv=self.impl.putHtml(self.htmlTree.pop("</div>"),true);delayedDiv.delay(delayedDiv.attr("data-ncd-delay")*1000).fadeIn(700);return self};self.putButton=function(label,onClick,cssClass,id,context){self.htmlTree.push(wigiiNcd.getHtmlBuilder().putStartTag("button","id",(id?id:""),"class",self.emittedClass()+(cssClass?" "+cssClass:"")).html());self.htmlTree.append(label);var b=self.impl.putHtml(self.htmlTree.pop("</button>"),true);if($.isFunction(onClick)&&b){b.off().click(function(e){if(window.wigiiNcdEtp&&window.wigiiNcdEtp.program.context){window.wigiiNcdEtp.program.context.html(self)}try{onClick.apply(this,[e,context])}catch(exc){self.publishException(exc)}})}return self};self.createGrid=function(nRows,nCols){return new wigiiNcd.Grid(self,nRows,nCols)};self.createTextArea=function(cssClass,index){return new wigiiNcd.TextArea(self,cssClass,index)};self.createTextInput=function(cssClass,index){return new wigiiNcd.TextInput(self,cssClass,index)};self.createPasswordInput=function(cssClass,index){return new wigiiNcd.PasswordInput(self,cssClass,index)};self.createCheckbox=function(cssClass,index){return new wigiiNcd.CheckBox(self,cssClass,index)};self.createUnorderedList=function(itemGenerator,itemRenderer,options){return new wigiiNcd.UnorderedList(self,itemGenerator,itemRenderer,options)};self.list=self.createUnorderedList;self.htmlBuilder=function(){return wigiiNcd.getHtmlBuilder(self)};self.div=function(id,cssClass){var returnValue=self.children[id];if(!returnValue){self.putHtml(wigiiNcd.getHtmlBuilder().putStartTag("div","class",self.emittedClass()+(cssClass?" "+cssClass:""),"id",id).putEndTag("div").html());returnValue=wigiiNcd.getHtmlEmitter(output.find("#"+id));if(self.modelers){for(var i=0;i<self.modelers.length;i++){returnValue.addModeler(self.modelers[i])}}self.children[id]=returnValue}return returnValue};self.clone=function(output){if(output===undefined){return self}var returnValue=wigiiNcd.getHtmlEmitter(output);if(self.modelers){for(var i=0;i<self.modelers.length;i++){returnValue.addModeler(self.modelers[i])}}return returnValue};self.reset=function(){self.children={};self.context={};output.empty();return self};self.clearErrors=function(){output.find("p."+self.emittedClass()+"-error").remove();return self};self.end=function(){self.impl.putHtml(self.htmlTree.pop(""));return self};self.publishException=function(exception){var htmlb=wigiiNcd.getHtmlBuilder();htmlb.putStartTag("p","class",self.emittedClass()+"-error").put(exception.code).prepend(" ",wigiiNcd.errorLabels[exception.code]).putBr().implode(" : ",exception.name,exception.message.replace(/</g,"&lt;").replace(/>/g,"&gt;")).putEndTag("p");if(exception.fileName&&exception.lineNumber){htmlb.putStartTag("p","class",self.emittedClass()+"-error").put("in file ").put(exception.fileName).put(" on line ").put(exception.lineNumber).putEndTag("p")}if(exception.stack){htmlb.putStartTag("pre","class",self.emittedClass()+"-error").put(exception.stack).putEndTag("pre")}self.impl.putHtml(htmlb.html());return self};self.putHtml=function(html){self.impl.putHtml(html);return self};self.impl.putHtml=function(html,returnLastCreated){if(self.context.cursor){self.context.cursor.before(html);if(returnLastCreated){return self.context.cursor.prev()}else{return output}}else{output.append(html);if(returnLastCreated){return output.children().last()}else{return output}}};self.htmlTree=wigiiNcd.createStringStackInstance();self.htmlTree.onPop(function(start,content,end){if(!start&&!end){return}var i=end.indexOf("</");var j=end.indexOf(">");var endtag=end.substring(i+2,j).trim();i=start.indexOf("<");j=start.indexOf(" ");var starttag=start.substring(i+1,j).trim();if(endtag!=starttag){throw wigiiNcd.createServiceException("invalid end tag '"+endtag+"' in context "+start+content.substr(0,64)+(content.length>64?"...":"")+end,wigiiNcd.errorCodes.SYNTAX_ERROR)}})});ncddoc(function(){},wigiiNcd.HtmlBuilder=function(htmlEmitter){var self=this;self.className="HtmlBuilder";self.ctxKey=wigiiNcd.ctxKey+"_"+self.className+Date.now();self.context={htmlEmitter:htmlEmitter};self.buffer="";self.jsBuffer=[];self.differedQueue=[];self.html=function(){if(self.differedQueue.length>0){var returnValue="";for(var i=0;i<self.differedQueue.length;i++){var f=self.differedQueue[i];if($.isFunction(f)){var r=f();if(r!==undefined){returnValue+=r}}else{if($.isPlainObject(f)){var r=f.fx.apply(null,f.args);if(r!==undefined){returnValue+=r}}else{returnValue+=f}}}returnValue+=self.buffer;return returnValue}else{return self.buffer}};self.emit=function(htmlEmitter){if(!htmlEmitter){htmlEmitter=self.context.htmlEmitter}if(htmlEmitter){var htmls="";if(self.differedQueue.length>0){var insertionTags=[];for(var i=0;i<self.differedQueue.length;i++){var f=self.differedQueue[i];if($.isFunction(f)){f={fx:f}}if($.isPlainObject(f)){f.id=self.ctxKey+"_"+i;htmls+='<span id="'+f.id+'"></span>';insertionTags.push(f)}else{htmls+=f}}if(self.buffer!=""){htmls+=self.buffer}htmlEmitter.putHtml(htmls);if(insertionTags.length>0){for(var i=0;i<insertionTags.length;i++){var insertionTag=htmlEmitter.$().find("#"+insertionTags[i].id);if(insertionTag){htmlEmitter.setCursor(insertionTag);if(window.wigiiNcdEtp&&window.wigiiNcdEtp.program.context){window.wigiiNcdEtp.program.context.html(htmlEmitter)}var r=insertionTags[i];r=r.fx.apply(null,r.args);if(r!==undefined){htmlEmitter.putHtml(r)}htmlEmitter.removeCursor();insertionTag.remove()}}}}else{if(self.buffer!=""){htmlEmitter.putHtml(self.buffer)}}return htmlEmitter}};self.runJsCode=function(){for(var i=0;i<self.jsBuffer.length;i++){var jsCode=self.jsBuffer[i];if($.isFunction(jsCode)){jsCode()}}return self};self.reset=function(){self.buffer="";self.jsBuffer=[];self.differedQueue=[];return self};self.put=function(str){if(str){self.buffer+=str}return self};self.implode=function(sep){if(arguments.length>1){var i=1;var result="",value;while(i<arguments.length){value=arguments[i];if(value){if(result){result+=sep}result+=value}i++}self.buffer+=result}return self};self.prepend=function(prefix,str){if(str){self.buffer+=prefix+str}return self};self.putNbsp=function(multiplier){if(!multiplier){multiplier=1}for(var i=0;i<multiplier;i++){self.buffer+="&nbsp;"}return self};self.putBr=function(multiplier){if(!multiplier){multiplier=1}for(var i=0;i<multiplier;i++){self.buffer+="<br/>"}return self};self.putQuot=function(){self.buffer+="&quot;";return self};self.putAmp=function(){self.buffer+="&amp;";return self};self.putLt=function(){self.buffer+="&lt;";return self};self.putGt=function(){self.buffer+="&gt;";return self};self.putApos=function(){self.buffer+="&apos;";return self};self.putHashTag=function(){self.buffer+="#";return self};self.putStartTag=function(tagName){if(!tagName){throw wigiiNcd.createServiceException("putStartTag takes a non null tagName",wigiiNcd.errorCodes.INVALID_ARGUMENT)}self.buffer+="<"+tagName;if(arguments.length>1){var i=1;var key,value;while(i<arguments.length){key=arguments[i];if(!key){throw wigiiNcd.createServiceException("html attribute name cannot be null",wigiiNcd.errorCodes.INVALID_ARGUMENT)}i++;if(i<arguments.length){value=arguments[i];i++}else{value=""}if(value!==""&&value!==undefined){self.buffer+=" "+key+'="'+value+'"'}}}self.buffer+=">";return self};self.putEndTag=function(tagName){if(!tagName){throw wigiiNcd.createServiceException("putEndTag takes a non null tagName",wigiiNcd.errorCodes.INVALID_ARGUMENT)}self.buffer+="</"+tagName+">";return self};self.putHtmlHeader=function(){self.buffer+="<!DOCTYPE html>";return self};self.putJsCode=function(actions){var actionType=$.type(actions);if(actionType==="function"){self.jsBuffer.push(actions)}else{if(actionType==="string"){self.jsBuffer.push(function(){eval(actions)})}}return self};self.putHtmlBuilder=function(htmlBuilder){if(htmlBuilder){self.put(htmlBuilder.html());for(var i=0;i<htmlBuilder.jsBuffer.length;i++){self.putJsCode(htmlBuilder.jsBuffer[i])}}return self};self.insert=function(f){if(f){var args;if(arguments.length>1){args=Array.prototype.slice.call(arguments,1)}else{args=[]}if(self.buffer!=""){self.differedQueue.push(self.buffer);self.buffer=""}self.differedQueue.push((args.length>0?{fx:f,args:args}:f))}return self};self.tag=self.putStartTag;self.$tag=self.putEndTag;self.nbsp=self.putNbsp;self.br=self.putBr;self.amp=self.putAmp;self.apos=self.putApos;self.quot=self.putQuot;self.hashTag=self.putHashTag;self.gt=self.putGt;self.lt=self.putLt;self.out=self.put});ncddoc(function(){},wigiiNcd.Grid=function(htmlEmitter,nRows,nCols){var self=this;self.className="Grid";self.ctxKey=wigiiNcd.ctxKey+"_"+self.className+Date.now();self.context={};self.context.rows=[];var htmlB=wigiiNcd.getHtmlBuilder();htmlB.putStartTag("table","class",htmlEmitter.emittedClass(),"id",self.ctxKey);for(var i=0;i<nRows;i++){htmlB.putStartTag("tr","class",htmlEmitter.emittedClass());self.context.rows.push([]);for(var j=0;j<nCols;j++){var id=self.ctxKey+"_"+i+"_"+j;htmlB.putStartTag("td","class",htmlEmitter.emittedClass(),"id",id);self.context.rows[i].push(new wigiiNcd.GridCell(self,i,j,id));htmlB.putNbsp(4);htmlB.putEndTag("td")}htmlB.putEndTag("tr")}htmlB.putEndTag("table");htmlEmitter.putHtml(htmlB.html());self.cell=function(x,y){if(x<0||x>=nRows){return undefined}if(y<0||y>=nCols){return undefined}return self.context.rows[x][y]};self.nRows=function(){return nRows};self.nCols=function(){return nCols}});ncddoc(function(){},wigiiNcd.GridCell=function(grid,x,y,id){var self=this;self.className="GridCell";self.ctxKey=wigiiNcd.ctxKey+"_"+self.className;self.context={};self.text=function(txt){if(txt===undefined){return self.context.text}else{self.context.text=txt;$("#"+id).html(txt);return self}};self.color=function(c){if(c===undefined){return self.context.color}else{self.context.color=c;$("#"+id).css("background-color",c);return self}};self.left=function(wrap){var neighbour=y-1;if(neighbour<0){if(wrap){neighbour=grid.nCols()-1}else{return undefined}}return grid.cell(x,neighbour)};self.right=function(wrap){var neighbour=y+1;if(neighbour>=grid.nCols()){if(wrap){neighbour=0}else{return undefined}}return grid.cell(x,neighbour)};self.up=function(wrap){var neighbour=x-1;if(neighbour<0){if(wrap){neighbour=grid.nRows()-1}else{return undefined}}return grid.cell(neighbour,y)};self.down=function(wrap){var neighbour=x+1;if(neighbour>=grid.nRows()){if(wrap){neighbour=0}else{return undefined}}return grid.cell(neighbour,y)};self.offset=function(x,y){var newX=(self.x()+x)%grid.nRows();var newY=(self.y()+y)%grid.nCols();return grid.cell(newX,newY)};self.grid=function(){return grid};self.x=function(){return x};self.y=function(){return y};self.id=function(){return id};self.click=function(onClick){if($.isFunction(onClick)){$("#"+id).off("click").click(function(){onClick(self)})}else{if(onClick===undefined){$("#"+id).click()}}return self}});ncddoc(function(){},wigiiNcd.TextArea=function(htmlEmitter,cssClass,index){var self=this;self.className="TextArea";self.ctxKey=wigiiNcd.ctxKey+"_"+self.className+Date.now()+(index!==undefined?index:"");self.context={index:index};var htmlB=wigiiNcd.getHtmlBuilder();htmlB.putStartTag("textarea","class",htmlEmitter.emittedClass()+(cssClass?" "+cssClass:""),"id",self.ctxKey);htmlB.putEndTag("textarea");htmlEmitter.putHtml(htmlB.html());self.$=function(){return $("#"+self.ctxKey)};self.color=function(backgroundC,textC){var elt=$("#"+self.ctxKey);if(backgroundC){elt.css("background-color",backgroundC)}if(textC){elt.css("color",textC)}return self};self.text=function(txt){if(txt===undefined){return self.context.text}else{self.context.text=txt;$("#"+self.ctxKey).val(txt);return self}};self.onInput=function(onInput){if($.isFunction(onInput)){if(!self.context.onInputSubscribers){self.context.onInputSubscribers=[];$("#"+self.ctxKey).on("input",function(){self.onInput()})}self.context.onInputSubscribers.push(onInput)}else{if(onInput===undefined){if(self.context.onInputSubscribers){for(var i=0;i<self.context.onInputSubscribers.length;i++){var eh=self.context.onInputSubscribers[i];if($.isFunction(eh)){eh(self,$("#"+self.ctxKey).val())}}}}}return self};self.autocomplete=function(propositionGenerator,options){wigiiNcd.bindAutoCompletionSense(self,propositionGenerator,options);return self}});ncddoc(function(){},wigiiNcd.TextInput=function(htmlEmitter,cssClass,index){var self=this;self.className="TextInput";self.ctxKey=wigiiNcd.ctxKey+"_"+self.className+Date.now()+(index!==undefined?index:"");self.context={index:index};var htmlB=wigiiNcd.getHtmlBuilder();htmlB.putStartTag("input","type","text","class",htmlEmitter.emittedClass()+(cssClass?" "+cssClass:""),"id",self.ctxKey);htmlB.putEndTag("input");htmlEmitter.putHtml(htmlB.html());self.$=function(){return $("#"+self.ctxKey)};self.color=function(backgroundC,textC){var elt=$("#"+self.ctxKey);if(backgroundC){elt.css("background-color",backgroundC)}if(textC){elt.css("color",textC)}return self};self.text=function(txt){if(txt===undefined){return self.context.text}else{self.context.text=txt;$("#"+self.ctxKey).val(txt);return self}};self.onInput=function(onInput){if($.isFunction(onInput)){if(!self.context.onInputSubscribers){self.context.onInputSubscribers=[];$("#"+self.ctxKey).on("input",function(){self.onInput()})}self.context.onInputSubscribers.push(onInput)}else{if(onInput===undefined){if(self.context.onInputSubscribers){for(var i=0;i<self.context.onInputSubscribers.length;i++){var eh=self.context.onInputSubscribers[i];if($.isFunction(eh)){eh(self,$("#"+self.ctxKey).val())}}}}}return self};self.autocomplete=function(propositionGenerator,options){wigiiNcd.bindAutoCompletionSense(self,propositionGenerator,options);return self}});ncddoc(function(){},wigiiNcd.PasswordInput=function(htmlEmitter,cssClass,index){var self=this;self.className="PasswordInput";self.ctxKey=wigiiNcd.ctxKey+"_"+self.className+Date.now()+(index!==undefined?index:"");self.context={index:index};var htmlB=wigiiNcd.getHtmlBuilder();htmlB.putStartTag("input","type","password","class",htmlEmitter.emittedClass()+(cssClass?" "+cssClass:""),"id",self.ctxKey);htmlB.putEndTag("input");htmlEmitter.putHtml(htmlB.html());self.$=function(){return $("#"+self.ctxKey)};self.color=function(backgroundC,textC){var elt=$("#"+self.ctxKey);if(backgroundC){elt.css("background-color",backgroundC)}if(textC){elt.css("color",textC)}return self};self.text=function(txt){if(txt===undefined){return self.context.text}else{self.context.text=txt;$("#"+self.ctxKey).val(txt);return self}};self.onInput=function(onInput){if($.isFunction(onInput)){if(!self.context.onInputSubscribers){self.context.onInputSubscribers=[];$("#"+self.ctxKey).on("input",function(){self.onInput()})}self.context.onInputSubscribers.push(onInput)}else{if(onInput===undefined){if(self.context.onInputSubscribers){for(var i=0;i<self.context.onInputSubscribers.length;i++){var eh=self.context.onInputSubscribers[i];if($.isFunction(eh)){eh(self,$("#"+self.ctxKey).val())}}}}}return self};self.autocomplete=function(propositionGenerator,options){wigiiNcd.bindAutoCompletionSense(self,propositionGenerator,options);return self}});ncddoc(function(){},wigiiNcd.TextInputWrapper=function(txtInput,cssClass,index){var self=this;self.className="TextInputWrapper";txtInput=$(txtInput);if(txtInput.attr("id")){self.ctxKey=txtInput.attr("id")}else{self.ctxKey=wigiiNcd.ctxKey+"_"+self.className+Date.now()+(index!==undefined?index:"");txtInput.attr("id",self.ctxKey)}if(cssClass){txtInput.addClass(cssClass)}self.context={index:index};self.$=function(){return $("#"+self.ctxKey)};self.color=function(backgroundC,textC){var elt=$("#"+self.ctxKey);if(backgroundC){elt.css("background-color",backgroundC)}if(textC){elt.css("color",textC)}return self};self.text=function(txt){if(txt===undefined){return self.context.text}else{self.context.text=txt;$("#"+self.ctxKey).val(txt);return self}};self.onInput=function(onInput){if($.isFunction(onInput)){if(!self.context.onInputSubscribers){self.context.onInputSubscribers=[];$("#"+self.ctxKey).on("input",function(){self.onInput()})}self.context.onInputSubscribers.push(onInput)}else{if(onInput===undefined){if(self.context.onInputSubscribers){for(var i=0;i<self.context.onInputSubscribers.length;i++){var eh=self.context.onInputSubscribers[i];if($.isFunction(eh)){eh(self,$("#"+self.ctxKey).val())}}}}}return self};self.autocomplete=function(propositionGenerator,options){wigiiNcd.bindAutoCompletionSense(self,propositionGenerator,options);return self}});ncddoc(function(){},wigiiNcd.CheckBox=function(htmlEmitter,cssClass,index){var self=this;self.className="CheckBox";self.ctxKey=wigiiNcd.ctxKey+"_"+self.className+Date.now()+(index!==undefined?index:"");self.context={index:index};self.$=function(){return $("#"+self.ctxKey)};self.checked=function(bool){if(bool===undefined){return self.context.checked}else{self.context.checked=(bool==true);$("#"+self.ctxKey).prop("checked",bool);return self}};self.onClick=function(onClick){if($.isFunction(onClick)){self.context.onClickSubscribers.push(onClick)}else{if(onClick===undefined){if(self.context.onClickSubscribers){for(var i=0;i<self.context.onClickSubscribers.length;i++){var eh=self.context.onClickSubscribers[i];if($.isFunction(eh)){eh(self,self.context.checked==true)}}}}}return self};self.toggle=function(){self.checked(!self.checked());return self};var htmlB=wigiiNcd.getHtmlBuilder();htmlB.putStartTag("input","type","checkbox","class",htmlEmitter.emittedClass()+(cssClass?" "+cssClass:""),"id",self.ctxKey);htmlB.putEndTag("input");htmlEmitter.putHtml(htmlB.html());if(!self.context.onClickSubscribers){self.context.onClickSubscribers=[];$("#"+self.ctxKey).click(function(){self.toggle();self.onClick()})}});ncddoc(function(){},wigiiNcd.UnorderedList=function(htmlEmitter,itemGenerator,itemRenderer,options){var self=this;self.className="UnorderedList";self.ctxKey=wigiiNcd.ctxKey+"_"+self.className+Date.now();self.options=options||{};self.impl={};self.context={items:[],selection:{},selectedCount:0,currentItem:undefined};if(self.options.selectedClass===undefined){self.options.selectedClass="selected"}if(self.options.highlightedClass===undefined){self.options.highlightedClass="highlighted"}self.$=function(){return $("ul#"+self.ctxKey)};self.size=function(){return self.context.items.length};self.items=function(){return self.context.items};self.selection=function(){var returnValue={};for(var i in self.context.selection){if(self.context.selection[i]){returnValue[i]=self.context.items[i-1]}}return returnValue};self.selected=function(i,bool){if(i===undefined&&bool===undefined){return self.context.selectedCount}if(i<1||self.size()<i){throw wncd.createServiceException("index "+i+" is out of list range.",wncd.errorCodes.OUT_OF_BOUND)}if(bool===undefined){return(self.context.selection[i]==true)}else{if(bool&&self.options.maxSelection>1&&self.context.selectedCount>=self.options.maxSelection){throw wncd.createServiceException("A maximum of "+self.options.maxSelection+" items can be selected.",wncd.errorCodes.ASSERTION_FAILED)}else{if(bool&&self.options.maxSelection==1&&self.context.selectedCount==1){self.selected(Object.keys(self.selection())[0],false)}}self.context.selection[i]=(bool==true);var li=self.$().find("> li:nth-child("+i+")");if(self.context.selection[i]){if(self.options.unselectedClass){li.removeClass(self.options.unselectedClass)}li.addClass(self.options.selectedClass);self.context.selectedCount++}else{li.removeClass(self.options.selectedClass);if(self.context.unselectedClass){li.addClass(self.options.unselectedClass)}self.context.selectedCount--}return self}};self.toggle=function(i){self.selected(i,!self.selected(i));return self};self.onItemClick=function(onClick){if($.isFunction(onClick)){self.options.onItemClick=onClick}else{self.impl.onItemClick(onClick)}return self};self.add=function(item){var n=self.size();if(item!==undefined){var htmlB=self.$().wncd("html").htmlBuilder();self.context.items.push(item);n++;self.impl.buildLi(n,item,htmlB);htmlB.emit();self.$().find("> li:nth-child("+n+")").click(self.impl.onLiClick)}return self};self.highLight=function(i,outputOption){if(i!==undefined){if(i<1||self.size()<i){throw wncd.createServiceException("index "+i+" is out of list range.",wncd.errorCodes.OUT_OF_BOUND)}if(self.context.currentItem){self.$().find("> li:nth-child("+self.context.currentItem+")").removeClass(self.options.highlightedClass)}self.context.currentItem=i}if(self.context.currentItem){self.$().find("> li:nth-child("+self.context.currentItem+")").addClass(self.options.highlightedClass);switch(outputOption){case"index":return self.context.currentItem;case"all":return{index:self.context.currentItem,item:self.context.items[self.context.currentItem-1],selected:self.selected(self.context.currentItem)};case"item":default:return self.context.items[self.context.currentItem-1]}}};self.clearHighLight=function(){if(self.context.currentItem){self.$().find("> li:nth-child("+self.context.currentItem+")").removeClass(self.options.highlightedClass);self.context.currentItem=undefined}return self};self.next=function(wrap,outputOption){if(self.context.currentItem){self.$().find("> li:nth-child("+self.context.currentItem+")").removeClass(self.options.highlightedClass)}if(self.context.currentItem===undefined){self.context.currentItem=1}else{if(self.context.currentItem>=self.size()){if(wrap){self.context.currentItem=1}else{self.context.currentItem=undefined}}else{self.context.currentItem++}}if(self.context.currentItem){self.$().find("> li:nth-child("+self.context.currentItem+")").addClass(self.options.highlightedClass);switch(outputOption){case"index":return self.context.currentItem;case"all":return{index:self.context.currentItem,item:self.context.items[self.context.currentItem-1],selected:self.selected(self.context.currentItem)};case"item":default:return self.context.items[self.context.currentItem-1]}}};self.previous=function(wrap,outputOption){if(self.context.currentItem){self.$().find("> li:nth-child("+self.context.currentItem+")").removeClass(self.options.highlightedClass)}if(self.context.currentItem===undefined){self.context.currentItem=self.size()}else{if(self.context.currentItem<=1){if(wrap){self.context.currentItem=self.size()}else{self.context.currentItem=undefined}}else{self.context.currentItem--}}if(self.context.currentItem){self.$().find("> li:nth-child("+self.context.currentItem+")").addClass(self.options.highlightedClass);switch(outputOption){case"index":return self.context.currentItem;case"all":return{index:self.context.currentItem,item:self.context.items[self.context.currentItem-1],selected:self.selected(self.context.currentItem)};case"item":default:return self.context.items[self.context.currentItem-1]}}};self.impl.buildLi=function(n,item,htmlB){var itemHtml=itemRenderer(n,item,self);if(itemHtml){if($.type(itemHtml)==="object"){var tagArgs=["li","class",htmlEmitter.emittedClass()+(self.context.unselectedClass?" "+self.context.unselectedClass:"")+(itemHtml["class"]?" "+itemHtml["class"]:"")];var plainHtml="";itemHtml["class"]=undefined;for(var key in itemHtml){if(key=="html"){plainHtml=itemHtml[key]}else{if(itemHtml[key]){tagArgs.push(key);tagArgs.push(itemHtml[key])}}}htmlB.tag.apply(undefined,tagArgs).put(plainHtml).$tag("li")}else{htmlB.tag("li","class",htmlEmitter.emittedClass()+(self.context.unselectedClass?" "+self.context.unselectedClass:"")).put(itemHtml).$tag("li")}}};var htmlB=htmlEmitter.htmlBuilder();htmlB.tag("ul","id",self.ctxKey,"class",htmlEmitter.emittedClass()+(self.options.cssClass?" "+self.options.cssClass:""));var shouldContinue=true;var n=0;while(shouldContinue){var item=itemGenerator(n,self);if(item!==undefined){self.context.items.push(item);n++;self.impl.buildLi(n,item,htmlB)}else{shouldContinue=false}}htmlB.$tag("ul").emit();self.impl.onItemClick=function(i){self.toggle(i);if($.isFunction(self.options.onItemClick)){self.options.onItemClick(i,self.context.items[i-1],self.selected(i),self)}};self.impl.onLiClick=function(e){try{self.impl.onItemClick($(this).index()+1)}catch(exc){if(!(self.options.maxSelection>1&&exc.code==wncd.errorCodes.ASSERTION_FAILED)){htmlEmitter.publishException(exc)}}e.stopPropagation()};self.$().find("> li").click(self.impl.onLiClick)});ncddoc(function(){},wigiiNcd.GridTurtle=function(grid,headColor,tailColor){var self=this;headColor=headColor||"red";tailColor=tailColor||"blue";if(!grid){throw wigiiNcd.createServiceException("grid cannot be null",wigiiNcd.errorCodes.INVALID_ARGUMENT)}self.context={};self.start=function(x,y,direction){direction=direction||"N";switch(direction){case"N":case"S":case"E":case"W":self.context.direction=direction;break;default:throw wigiiNcd.createServiceException("invalid direction '"+direction+"'",wigiiNcd.errorCodes.INVALID_ARGUMENT)}if(grid.cell(x,y)){self.context.x=x;self.context.y=y}else{throw wigiiNcd.createServiceException("invalid start coordinates ("+x+","+y+")",wigiiNcd.errorCodes.INVALID_ARGUMENT)}self.show()};self.moveForward=function(){var nextC;switch(self.context.direction){case"N":nextC=grid.cell(self.context.x,self.context.y).up(true);break;case"S":nextC=grid.cell(self.context.x,self.context.y).down(true);break;case"E":nextC=grid.cell(self.context.x,self.context.y).right(true);break;case"W":nextC=grid.cell(self.context.x,self.context.y).left(true);break;default:throw wigiiNcd.createServiceException("Not started. Call start function first.",wigiiNcd.errorCodes.INVALID_STATE)}self.context.x=nextC.x();self.context.y=nextC.y();self.show()};self.moveForwardAndLeft=function(){var nextC;switch(self.context.direction){case"N":nextC=grid.cell(self.context.x,self.context.y).up(true).left(true);break;case"S":nextC=grid.cell(self.context.x,self.context.y).down(true).right(true);break;case"E":nextC=grid.cell(self.context.x,self.context.y).right(true).up(true);break;case"W":nextC=grid.cell(self.context.x,self.context.y).left(true).down(true);break;default:throw wigiiNcd.createServiceException("Not started. Call start function first.",wigiiNcd.errorCodes.INVALID_STATE)}self.context.x=nextC.x();self.context.y=nextC.y();self.show()};self.moveForwardAndRight=function(){var nextC;switch(self.context.direction){case"N":nextC=grid.cell(self.context.x,self.context.y).up(true).right(true);break;case"S":nextC=grid.cell(self.context.x,self.context.y).down(true).left(true);break;case"E":nextC=grid.cell(self.context.x,self.context.y).right(true).down(true);break;case"W":nextC=grid.cell(self.context.x,self.context.y).left(true).up(true);break;default:throw wigiiNcd.createServiceException("Not started. Call start function first.",wigiiNcd.errorCodes.INVALID_STATE)}self.context.x=nextC.x();self.context.y=nextC.y();self.show()};self.turnBack=function(){switch(self.context.direction){case"N":self.context.direction="S";break;case"S":self.context.direction="N";break;case"E":self.context.direction="W";break;case"W":self.context.direction="E";break;default:throw wigiiNcd.createServiceException("Not started. Call start function first.",wigiiNcd.errorCodes.INVALID_STATE)}self.show()};self.turnLeft=function(){switch(self.context.direction){case"N":self.context.direction="W";break;case"S":self.context.direction="E";break;case"E":self.context.direction="N";break;case"W":self.context.direction="S";break;default:throw wigiiNcd.createServiceException("Not started. Call start function first.",wigiiNcd.errorCodes.INVALID_STATE)}self.show()};self.turnRight=function(){switch(self.context.direction){case"N":self.context.direction="E";break;case"S":self.context.direction="W";break;case"E":self.context.direction="S";break;case"W":self.context.direction="N";break;default:throw wigiiNcd.createServiceException("Not started. Call start function first.",wigiiNcd.errorCodes.INVALID_STATE)}self.show()};self.previous={x:undefined,y:undefined,text:undefined,color:undefined};self.show=function(){var c;if(self.previous.x!==undefined&&self.previous.y!==undefined){c=grid.cell(self.previous.x,self.previous.y);c.text(" ").color(tailColor)}c=grid.cell(self.context.x,self.context.y);self.previous.x=self.context.x;self.previous.y=self.context.y;self.previous.text=c.text();self.previous.color=c.color();var headTxt="";switch(self.context.direction){case"N":headTxt="&#9650;";break;case"S":headTxt="&#9660;";break;case"W":headTxt="&#9664;";break;case"E":headTxt="&#9654;";break}c.text(headTxt).color(headColor)};self.grid=function(){return grid};self.currentCell=function(){return grid.cell(self.context.x,self.context.y)};self.cell=function(x,y){var e1x=0,e1y=0,e2x=0,e2y=0;switch(self.context.direction){case"N":e1x=-1;e1y=0;e2x=0;e2y=1;break;case"S":e1x=1;e1y=0;e2x=0;e2y=-1;break;case"E":e1x=0;e1y=1;e2x=1;e2y=0;break;case"W":e1x=0;e1y=-1;e2x=-1;e2y=0;break;default:throw wigiiNcd.createServiceException("Not started. Call start function first.",wigiiNcd.errorCodes.INVALID_STATE)}var rx=(self.context.x+x*e1x+y*e1y)%grid.nRows();if(rx<0){rx=grid.nRows()+rx}var ry=(self.context.y+x*e2x+y*e2y)%grid.nCols();if(ry<0){ry=grid.nCols()+ry}return grid.cell(rx,ry)}});ncddoc(function(){},wigiiNcd.Graph=function(){var self=this;self.className="Graph";self.ctxKey=wigiiNcd.ctxKey+"_"+self.className;self.context={graphNodes:[]};self.parentGraphNode=function(graphNode){if(graphNode===undefined){return self.context.parentGraphNode}else{if(self.context.parentGraphNode){self.context.parentGraphNode.context.subGraph=undefined;self.context.parentGraphNode=undefined}if(graphNode!==null){self.context.parentGraphNode=graphNode;graphNode.context.subGraph=self}}return self};self.forEachGraphNode=function(callback){for(var i=0;i<self.context.graphNodes.length;i++){callback(self.context.graphNodes[i])}};self.isEmpty=function(){return self.context.graphNodes.length==0};self.countGraphNodes=function(){return self.context.graphNodes.length};self.createGraphNode=function(){var returnValue=new wigiiNcd.GraphNode(self);self.context.graphNodes.push(returnValue);return returnValue}});ncddoc(function(){},wigiiNcd.GraphNode=function(graph){var self=this;self.className="GraphNode";self.ctxKey=wigiiNcd.ctxKey+"_"+self.className;self.context={graph:graph};self.value=function(val){if(val===undefined){return self.context.value}else{if(val===null){self.context.value=undefined}else{self.context.value=val}}return self};self.attribute=function(key,val){if(self.context.attributes){self.context.attributes={}}if(!key){return self.context.attributes}else{if(val===undefined){return self.context.attributes[key]}else{if(val===null){delete self.context.attributes[key]}else{self.context.attributes[key]=val}}}return self};self.depLink=function(name,graphNode){if(!self.context.depLinks){self.context.depLinks={}}if(!name){return self.context.depLinks}else{if(graphNode===undefined){return self.context.depLinks[name]}else{if(self.context.depLinks[name]){delete self.context.depLinks[name].context.arrLinks[name];delete self.context.depLinks[name]}if(graphNode!==null){self.context.depLinks[name]=graphNode;if(!graphNode.context.arrLinks){graphNode.context.arrLinks={}}graphNode.context.arrLinks[name]=self}}}return self};self.depLinkAttr=function(name,key,val){if(!name){throw wigiiNcd.createServiceException("link name cannot be null",wigiiNcd.errorCodes.INVALID_ARGUMENT)}if(!self.context.depLinkAttr){self.context.depLinkAttr={}}if(!self.context.depLinkAttr[name]){self.context.depLinkAttr[name]={}}if(key===undefined){return self.context.depLinkAttr[name]}else{if(key===null){self.context.depLinkAttr[name]={}}else{if(val===undefined){return self.context.depLinkAttr[name][key]}else{if(val===null){delete self.context.depLinkAttr[name][key]}else{self.context.depLinkAttr[name][key]=val}}}}return self};self.arrLink=function(name,graphNode){if(!self.context.arrLinks){self.context.arrLinks={}}if(!name){return self.context.arrLinks}else{if(graphNode===undefined){return self.context.arrLinks[name]}else{if(self.context.arrLinks[name]){delete self.context.arrLinks[name].context.depLinks[name];delete self.context.arrLinks[name]}if(graphNode!==null){if(!graphNode.context.depLinks){graphNode.context.depLinks={}}graphNode.context.depLinks[name]=self;self.context.arrLinks[name]=graphNode}}}return self};self.arrLinkAttr=function(name,key,val){var depNode=self.arrLink(name);if(!depNode){throw wigiiNcd.createServiceException("no arriving link with name "+name,wigiiNcd.errorCodes.INVALID_ARGUMENT)}var returnValue=depNode.depLinkAttr(name,key,val);if(key===undefined||val===undefined){return returnValue}else{return self}};self.subGraph=function(graph){if(graph===undefined){return self.context.subGraph}else{if(self.context.subGraph){self.context.subGraph.context.parentGraphNode=undefined;self.context.subGraph=undefined}if(graph!==null){self.context.subGraph=graph;graph.context.parentGraphNode=self}}return self};self.graph=function(){return self.context.graph}});ncddoc(function(){},wigiiNcd.SelectionSense=function(onClick,options){var self=this;self.className="SelectionSense";self.ctxKey=wigiiNcd.ctxKey+"_"+self.className+Date.now();self.context={selected:false,selectedClass:"selected",unselectedClass:undefined};if(options){if(options.selectedClass){self.context.selectedClass=options.selectedClass}if(options.unselectedClass){self.context.unselectedClass=options.unselectedClass}}self.onClick=function(){self.toggle();if($.isFunction(onClick)){onClick(self)}};self.anchors=[];self.selected=function(bool){if(bool===undefined){return self.context.selected}else{self.context.selected=(bool==true);for(var i=0;i<self.anchors.length;i++){var anchor=self.anchors[i];if(self.context.selected){if(self.context.unselectedClass){anchor.removeClass(self.context.unselectedClass)}anchor.addClass(self.context.selectedClass)}else{anchor.removeClass(self.context.selectedClass);if(self.context.unselectedClass){anchor.addClass(self.context.unselectedClass)}}}return self}};self.toggle=function(){self.selected(!self.selected());return self};self.bind=function(anchor){anchor.click(self.onClick);anchor.css("cursor","pointer");self.anchors.push(anchor);if(self.context.selected){if(self.context.unselectedClass){anchor.removeClass(self.context.unselectedClass)}anchor.addClass(self.context.selectedClass)}else{anchor.removeClass(self.context.selectedClass);if(self.context.unselectedClass){anchor.addClass(self.context.unselectedClass)}}return self}});ncddoc(function(){},wigiiNcd.CountingSense=function(onClick,options){var self=this;self.className="CountingSense";self.ctxKey=wigiiNcd.ctxKey+"_"+self.className+Date.now();self.context={counter:0};self.onClick=function(){if($.isFunction(onClick)){onClick(self)}else{self.inc()}};self.anchors=[];self.count=function(){return self.context.counter};self.reset=function(defaultValue){if(defaultValue!==undefined){self.context.counter=defaultValue}else{self.context.counter=0}return self};self.inc=function(val){if(val!==undefined){self.context.counter+=val}else{self.context.counter+=1}return self};self.dec=function(val){if(val!==undefined){self.context.counter-=val}else{self.context.counter-=1}return self};self.bind=function(anchor){anchor.click(self.onClick);anchor.css("cursor","pointer");self.anchors.push(anchor);return self}});ncddoc(function(){},wigiiNcd.AutocompletionSense=function(propositionGenerator,options){var self=this;self.className="AutocompletionSense";self.ctxKey=wigiiNcd.ctxKey+"_"+self.className+Date.now();self.options=options||{};self.impl={};self.context={interactivePanelReady:false};if($.isFunction(propositionGenerator)){self.impl.propositionGenerator=propositionGenerator}else{if($.isArray(propositionGenerator)){self.impl.propositionGenerator=function(n,txt,list){if(list.context.visited===undefined){list.context.visited=0}while(list.context.visited<propositionGenerator.length){var returnValue=propositionGenerator[list.context.visited++];if(returnValue.toLowerCase().indexOf(txt.toLowerCase())>=0){return returnValue}}}}}if(!self.options.matchClass){self.options.matchClass="match"}if(!self.options.matchTag){self.options.matchTag="strong"}if(!self.options.renderProposition){self.options.renderProposition=function(i,data,list){if(!list.context.txtLowerCase){list.context.txtLowerCase=list.context.txt.toLowerCase();list.context.txtLength=list.context.txt.length}var txtPos=data.toLowerCase().indexOf(list.context.txtLowerCase);var returnValue=data;if(txtPos>=0){returnValue=wncd.getHtmlBuilder().out(data.substr(0,txtPos)).tag(self.options.matchTag,"class",self.options.matchClass).out(data.substr(txtPos,list.context.txtLength)).$tag(self.options.matchTag).out(data.substr(txtPos+list.context.txtLength)).html()}return returnValue}}if(!self.options.actionOnChosenProposition){self.options.actionOnChosenProposition="replace"}if(!self.options.updateTextWithProposition){self.options.updateTextWithProposition=function(txt,proposition){if(self.options.actionOnChosenProposition=="replace"){return proposition}else{if(self.options.actionOnChosenProposition=="append"){return txt+proposition}else{if(self.options.actionOnChosenProposition=="prepend"){return proposition+txt}}}}}self.$=function(){return $("#"+self.ctxKey)};self.chooseOne=function(txt,choiceCallback){if(!self.context.interactivePanelReady){self.impl.initializeInteractivePanel()}self.options.panel.reset();self.context.list=self.options.panel.list(function(n,list){list.context.txt=txt;return self.impl.propositionGenerator(n,txt,list)},self.options.renderProposition,{onItemClick:function(i,data,selected){if(selected){choiceCallback(self.options.updateTextWithProposition(txt,data));self.options.panel.reset();self.context.list=undefined;if(self.options.hideOnSelection){self.options.panel.$().hide()}}},maxSelection:1});self.context.list.$().find("> li").on("hover",function(){self.context.list.highLight($(this).index()+1)});if(self.options.hideOnSelection){self.options.panel.$().show()}self.options.panel.$().scrollTop(0);return self};self.bind=function(txtInput){if(!self.context.interactivePanelReady){self.impl.initializeInteractivePanel(txtInput)}var txtInputSetText=function(txt){txtInput.text(txt);txtInput.$().change().focus()};txtInput.onInput(function(txtInput,txt){self.chooseOne(txt,txtInputSetText)})};self.impl.initializeInteractivePanel=function(txtInput){if(!self.options.panel){if(self.options.hideOnSelection===undefined){self.options.hideOnSelection=true}var anchor=txtInput.$();anchor.parent().css("overflow","visible");anchor.after(wigiiNcd.getHtmlBuilder().tag("div","id",self.ctxKey,"class","autocompletionsense"+(self.options.cssClass?" "+self.options.cssClass:""),"style","position:relative;"+(self.options.hideOnSelection?"display:none;":"")).$tag("div").html());self.options.panel=wncd.html(self.$())}else{if($.type(self.options.panel)==="string"||self.options.panel.className!="HtmlEmitter"){self.options.panel=wncd.html(self.options.panel).div(self.ctxKey,"autocompletionsense"+(self.options.cssClass?" "+self.options.cssClass:""))}}txtInput.$().on("keydown",function(e){if(e.key=="Up"||e.key=="ArrowUp"){if(self.context.list){var i=self.context.list.previous(true,"index");var p=self.options.panel.$();var li=self.context.list.$().find("> li:nth-child("+i+")");if(i==self.context.list.size()){p.scrollTop(li.offset().top)}else{if(li.offset().top<p.offset().top){p.scrollTop(Math.max(p.scrollTop()-li.height(),0))}}}}else{if(e.key=="Down"||e.key=="ArrowDown"){if(self.context.list){var i=self.context.list.next(true,"index");var p=self.options.panel.$();if(i==1){p.scrollTop(0)}else{var li=self.context.list.$().find("> li:nth-child("+i+")");if(li.offset().top+li.height()>p.offset().top+p.height()){p.scrollTop(p.scrollTop()+li.height())}}}}}}).on("keypress",function(e){if(self.options.hideOnSelection&&(e.key=="Esc"||e.key=="Escape"||!$(this).val()&&e.key=="Backspace")){self.options.panel.$().hide();if(self.context.list){self.context.list.clearHighLight()}}else{if(e.key=="Enter"){var i=(self.context.list?self.context.list.highLight(undefined,"index"):undefined);if(i){self.context.list.onItemClick(i)}else{if(self.options.hideOnSelection){self.options.panel.$().hide()}}}}});self.options.panel.out("ready");self.context.interactivePanelReady=true}});ncddoc(function(){},wigiiNcd.popup=function(message,options){if(!window.wigii){throw wigiiNcd.createServiceException("wigii Api is not loaded, popup fonction is not supported.",wigiiNcd.errorCodes.UNSUPPORTED_OPERATION)}options=options||{};options.localContent=true;options.position="center";options.removeOnClose=true;var wrappedMessage=undefined;if($.isFunction(message)){wrappedMessage=function(popupBody,popup){var html=wncd.html(popupBody);var currentDiv=wncd.currentDiv();popup.remove(function(){wncd.program.context.html(currentDiv)});wncd.program.context.html(html);message(popup);wncd.program.context.html(currentDiv)}}else{wrappedMessage=message}wigii("HelpService").showFloatingHelp(undefined,undefined,wrappedMessage,options)});ncddoc(function(){},wigiiNcd.publishWigiiException=function(exception,context){if(!window.wigii){throw wigiiNcd.createServiceException("wigii Api is not loaded, publishWigiiException fonction is not supported.",wigiiNcd.errorCodes.UNSUPPORTED_OPERATION)}wigiiNcd.popup(wigii().exception2html(exception,context))});ncddoc(function(){},wigiiNcd.wigiiContainer=function(){if(!window.wigii){throw wigiiNcd.createServiceException("wigii Api is not loaded, wigiiContainer fonction is not supported.",wigiiNcd.errorCodes.UNSUPPORTED_OPERATION)}return wigii().getWncdContainer(wncd)});ncddoc(function(){},wigiiNcd.getWigiiContainer=wigiiNcd.wigiiContainer);ncddoc(function(){},wigiiNcd.sel=function(source,activities){if(!window.wigii){throw wigiiNcd.createServiceException("wigii Api is not loaded, sel fonction is not supported.",wigiiNcd.errorCodes.UNSUPPORTED_OPERATION)}return wigii().sel(source,activities)});ncddoc(function(){},wigiiNcd.JQueryService=function(){var self=this;self.className="JQueryService";self.ctxKey=wigiiNcd.ctxKey+"_"+self.className;self.HtmlEmitter=function(selection,options){var returnValue=undefined;if(selection&&selection.length==1){returnValue=wncd.html(selection)}else{if(selection&&selection.length>1){throw wigiiNcd.createServiceException("Wigii NCD HtmlEmitter selector can only be activated on a JQuery collection containing one element and not "+selection.length,wigiiNcd.errorCodes.INVALID_ARGUMENT)}}return(!returnValue?{$:selection}:returnValue)};self.html=self.HtmlEmitter;self.wrap=function(selection,options){var returnValue=undefined;if(selection&&selection.length==1){returnValue=wigiiNcd.wrapTextInput(selection,options)}else{if(selection&&selection.length>1){throw wigiiNcd.createServiceException("Wigii NCD wrap selector can only be activated on a JQuery collection containing one element and not "+selection.length,wigiiNcd.errorCodes.INVALID_ARGUMENT)}}return(!returnValue?{$:selection}:returnValue)}});wigiiNcd.source={};ncddoc(function(){},wigiiNcd.source.genRange=function(from,to,step){return function(dataFlowContext){if(!($.isNumeric(from)&&$.isNumeric(to)&&$.isNumeric(step))){throw wigiiNcd.createServiceException("from, to and step should all be numbers",wigiiNcd.errorCodes.INVALID_ARGUMENT)}if(step>0){while(from<to){dataFlowContext.processDataChunk(from);from+=step}}else{if(step<0){while(from>to){dataFlowContext.processDataChunk(from);from-=step}}else{throw wigiiNcd.createServiceException("step cannot be 0",wigiiNcd.errorCodes.INVALID_ARGUMENT)}}}});ncddoc(function(){},wigiiNcd.source.genInterval=function(from,to,nbSlices){return function(dataFlowContext){if(!($.isNumeric(from)&&$.isNumeric(to)&&$.isNumeric(nbSlices))){throw wigiiNcd.createServiceException("from, to and nbSlices should all be numbers",wigiiNcd.errorCodes.INVALID_ARGUMENT)}var factor=(to-from)/nbSlices;for(var i=0;i<=nbSlices;i++){dataFlowContext.processDataChunk(from+factor*i)}}});ncddoc(function(){},wigiiNcd.source.linearSequence=function(length,factor,shift,alternateSign){return function(dataFlowContext){if(!($.isNumeric(length)&&$.isNumeric(factor)&&$.isNumeric(shift))){throw wigiiNcd.createServiceException("length should be a positive integer, factor and shift should be numbers",wigiiNcd.errorCodes.INVALID_ARGUMENT)}var negative=false;for(var i=1;i<=length;i++){dataFlowContext.processDataChunk((negative?-(factor*i+shift):factor*i+shift));if(alternateSign){negative=!negative}}}});wigiiNcd.dfa={};ncddoc(function(){},wigiiNcd.dfa.arrayBuffer=function(options){var options=options||{};return function(data,activityCtx,dataFlowContext){if(activityCtx.state==dataFlowContext.DFA_STARTSTREAM){if(options.unpair){activityCtx.buffer={};if(!options.keyField){options.keyField="key"}if(!options.valueField){options.valueField="value"}}else{if(options.keyField){activityCtx.buffer={}}else{activityCtx.buffer=[]}}}else{if(activityCtx.state==dataFlowContext.DFA_RUNNING){if(options.unpair){if($.isPlainObject(data)){activityCtx.buffer[data[options.keyField]]=(data.hasOwnProperty(options.valueField)?data[options.valueField]:data)}else{activityCtx.buffer[data]=data}}else{if(options.keyField){if($.isPlainObject(data)){activityCtx.buffer[data[options.keyField]]=data}else{activityCtx.buffer[data]=data}}else{activityCtx.buffer.push(data)}}}else{if(activityCtx.state==dataFlowContext.DFA_ENDSTREAM){dataFlowContext.writeResultToOuput(activityCtx.buffer,activityCtx)}}}}});ncddoc(function(){},wigiiNcd.dfa.points2SVG=function(options){var options=options||{};return function(data,activityCtx,dataFlowContext){var svgTag;if(activityCtx.state==dataFlowContext.DFA_STARTSTREAM){activityCtx.options=options;if(options.stroke===false){options.stroke="none"}else{if(options.stroke===undefined){options.stroke="#3333ff"}}if(options.strokeLineCap===undefined){options.strokeLineCap="round"}if(options.pointDefaultRadius&&!options.pointRadius){options.pointRadius=true}if(options.pointRadius===true){options.pointRadius=options.strokeWidth||2}if(options.pointRadius){if(options.pointStroke===undefined&&options.stroke!="none"){options.pointStroke=options.stroke}if(options.pointStrokeWidth===undefined){options.pointStrokeWidth=options.strokeWidth}if(options.pointFill===undefined&&options.stroke!="none"){options.pointFill=options.pointStroke}if(options.pointShape===undefined){options.pointShape="circle"}activityCtx.pointsSVG=wncd.getHtmlBuilder()}}else{if(activityCtx.state==dataFlowContext.DFA_RUNNING){if(!activityCtx.path){activityCtx.path="M"+data.x+" "+data.y}else{activityCtx.path+=" L"+data.x+" "+data.y}if(options.pointRadius&&!options.outputPathString){var radius=options.pointRadius;if(options.pointDefaultRadius){radius=Number(data.weight||0)*options.pointDefaultRadius}else{if($.isFunction(options.pointRadius)){radius=options.pointRadius(data,activityCtx)}}if($.isFunction(options.pointShape)){activityCtx.pointsSVG.put(options.pointShape(data,activityCtx))}else{svgTag=[];if(options.pointShape==="circle"){svgTag.push("circle");svgTag.push("cx");svgTag.push(data.x);svgTag.push("cy");svgTag.push(data.y);svgTag.push("r");svgTag.push(radius)}else{if(options.pointShape==="square"){svgTag.push("rect");svgTag.push("x");svgTag.push(data.x-radius);svgTag.push("y");svgTag.push(data.y-radius);svgTag.push("width");svgTag.push(radius*2);svgTag.push("height");svgTag.push(radius*2)}else{if(options.pointShape==="triangle"){var demiBase=0.5*radius;var hauteur=Math.sqrt(3)/2*radius;var dHauteur=Math.tan(Math.PI/6)*demiBase;var points="";points+=data.x+","+(data.y-hauteur+dHauteur);points+=" "+(data.x-demiBase)+","+(data.y+dHauteur);points+=" "+(data.x+demiBase)+","+(data.y+dHauteur);points+=" Z";svgTag.push("polygon");svgTag.push("points");svgTag.push(points)}else{if(options.pointShape==="diamond"){var demiBase=radius/2;var hauteur=Math.tan(Math.PI/3)*demiBase;var points="";points+=data.x+","+(data.y-hauteur);points+=" "+(data.x-demiBase)+","+data.y;points+=" "+data.x+","+(data.y+hauteur);points+=" "+(data.x+demiBase)+","+data.y;points+=" Z";svgTag.push("polygon");svgTag.push("points");svgTag.push(points)}}}}if(options.pointStroke){svgTag.push("stroke");svgTag.push(($.isFunction(options.pointStroke)?options.pointStroke(data,activityCtx):options.pointStroke))}if(options.pointStrokeWidth){svgTag.push("stroke-width");svgTag.push(options.pointStrokeWidth)}if(options.pointFill){svgTag.push("fill");svgTag.push(($.isFunction(options.pointFill)?options.pointFill(data,activityCtx):options.pointFill))}activityCtx.pointsSVG.tag.apply(undefined,svgTag).$tag(svgTag[0])}}}else{if(activityCtx.state==dataFlowContext.DFA_ENDSTREAM){if(options.close){activityCtx.path+=" Z"}if(options.outputPathString){dataFlowContext.writeResultToOuput(activityCtx.path,activityCtx)}else{var svgBuilder=wncd.getHtmlBuilder();var initPathOptions=function(pathTag){if(options.close){if(options.fill&&options.fill!=="css"){pathTag.push("fill");pathTag.push(options.fill)}}else{pathTag.push("fill");pathTag.push("none")}if(options.stroke&&options.stroke!=="css"){pathTag.push("stroke");pathTag.push(options.stroke)}if(options.strokeWidth){pathTag.push("stroke-width");pathTag.push(options.strokeWidth)}if(options.strokeLineCap&&options.strokeLineCap!=="css"){pathTag.push("stroke-linecap");pathTag.push(options.strokeLineCap)}};svgTag=[];if(options.pointRadius){svgTag.push("g")}else{svgTag.push("path")}if(options.id){svgTag.push("id");svgTag.push(options.id)}if(options.cssClass){svgTag.push("class");svgTag.push(options.cssClass)}if(options.style){svgTag.push("style");svgTag.push(options.style)}if(options.pointRadius){var pathTag=["path","d",activityCtx.path];initPathOptions(pathTag);svgBuilder.tag.apply(undefined,svgTag).tag.apply(undefined,pathTag).$tag(pathTag[0]).putHtmlBuilder(activityCtx.pointsSVG).$tag(svgTag[0])}else{svgTag.push("d");svgTag.push(activityCtx.path);initPathOptions(svgTag);svgBuilder.tag.apply(undefined,svgTag).$tag(svgTag[0])}dataFlowContext.writeResultToOuput(svgBuilder.html(),activityCtx)}}}}}});ncddoc(function(){},wigiiNcd.dfa.autoSizePoints=function(options){var options=options||{};return function(data,activityCtx,dataFlowContext){if(activityCtx.state==dataFlowContext.DFA_STARTSTREAM){if(options.coordMin===undefined){options.coordMin=0}if(options.coordMax===undefined){options.coordMax=1024}activityCtx.buffer=[]}else{if(activityCtx.state==dataFlowContext.DFA_RUNNING){if(activityCtx.minX===undefined){activityCtx.minX=data.x}else{if(data.x<activityCtx.minX){activityCtx.minX=data.x}}if(activityCtx.maxX===undefined){activityCtx.maxX=data.x}else{if(data.x>activityCtx.maxX){activityCtx.maxX=data.x}}if(activityCtx.minY===undefined){activityCtx.minY=data.y}else{if(data.y<activityCtx.minY){activityCtx.minY=data.y}}if(activityCtx.maxY===undefined){activityCtx.maxY=data.y}else{if(data.y>activityCtx.maxY){activityCtx.maxY=data.y}}activityCtx.buffer.push(data)}else{if(activityCtx.state==dataFlowContext.DFA_ENDSTREAM){var factor=Math.max(Math.abs(activityCtx.maxX-activityCtx.minX),Math.abs(activityCtx.maxY-activityCtx.minY));factor=Math.abs(options.coordMax-options.coordMin)/factor;var p;for(var i=0;i<activityCtx.buffer.length;i++){p=activityCtx.buffer[i];p.x=(p.x-activityCtx.minX)*factor+options.coordMin;p.y=options.coordMax-((p.y-activityCtx.minY)*factor+options.coordMin);dataFlowContext.writeResultToOuput(p,activityCtx)}}}}}});ncddoc(function(){},wigiiNcd.createStringStackInstance=function(){return new wigiiNcd.StringStack()});ncddoc(function(){},wigiiNcd.getHtmlEmitter=function(output){return new wigiiNcd.HtmlEmitter(output)});ncddoc(function(){},wigiiNcd.getHtmlBuilder=function(htmlEmitter){return new wigiiNcd.HtmlBuilder(htmlEmitter)});ncddoc(function(){},wigiiNcd.createSelectionSense=function(onClick,options){return new wigiiNcd.SelectionSense(onClick,options)});ncddoc(function(){},wigiiNcd.bindSelectionSense=function(anchor,onClick,options){return wigiiNcd.createSelectionSense(onClick,options).bind(anchor)});ncddoc(function(){},wigiiNcd.createCountingSense=function(onClick,options){return new wigiiNcd.CountingSense(onClick,options)});ncddoc(function(){},wigiiNcd.bindCountingSense=function(anchor,onClick,options){return wigiiNcd.createCountingSense(onClick,options).bind(anchor)});ncddoc(function(){},wigiiNcd.createAutoCompletionSense=function(propositionGenerator,options){return new wigiiNcd.AutocompletionSense(propositionGenerator,options)});ncddoc(function(){},wigiiNcd.bindAutoCompletionSense=function(txtInput,propositionGenerator,options){return wigiiNcd.createAutoCompletionSense(propositionGenerator,options).bind(txtInput)});ncddoc(function(){},wigiiNcd.wrapTextInput=function(txtInput,cssClass){return new wigiiNcd.TextInputWrapper(txtInput,cssClass)});ncddoc(function(){},wigiiNcd.createGraph=function(){return new wigiiNcd.Graph()});ncddoc(function(){},wigiiNcd.getJQueryService=function(){if(!wigiiNcd.jQueryServiceInstance){wigiiNcd.jQueryServiceInstance=new wigiiNcd.JQueryService();ncdprivate("jQueryServiceInstance")}return wigiiNcd.jQueryServiceInstance});ncddoc(function(){},wigiiNcd.throwNotImplemented=function(){throw new wigiiNcd.ServiceException("not implemented",wigiiNcd.errorCodes.NOT_IMPLEMENTED)});ncddoc(function(){},wigiiNcd.createServiceException=function(message,code,previous){return new wigiiNcd.ServiceException(message,code,previous)});ncddoc(function(){},wigiiNcd.obj2FxString=function(obj){var objType=$.type(obj);if(objType==="function"){if($.isFunction(obj.toFxString)){return obj.toFxString()}else{return obj.toString()}}else{if(objType==="number"){return obj}else{if(objType==="boolean"){return obj.toString()}else{if(objType==="string"){return'"'+obj.replace(/"/g,'\\"')+'"'}else{if(objType==="object"){return"JSON.parse('"+JSON.stringify(obj)+"')"}else{if(obj===undefined){return'""'}else{return'"'+obj.toString()+'"'}}}}}}});ncddoc(function(){},wigiiNcd.fxString2obj=function(str){if(str){var wigiiNcd=window.wigiiNcd;var returnValue=eval(str);return returnValue}});ncddoc(function(){},wigiiNcd.updateObjIfChanged=function(obj1,obj2){if(!obj1||!obj2){throw wigiiNcd.createServiceException("obj1 and obj2 cannot be null.",wigiiNcd.errorCodes.INVALID_ARGUMENT)}var updateChain={context:{obj1:obj1,obj2:obj2,changes:false}};updateChain.field=function(fieldName){if(updateChain.context.obj2[fieldName]!=updateChain.context.obj1[fieldName]){updateChain.context.obj1[fieldName]=updateChain.context.obj2[fieldName];updateChain.context.changes=true}return updateChain};updateChain.set=function(fieldName,value,subFieldName){if(updateChain.context.changes){if(subFieldName!==undefined){updateChain.context.obj1[fieldName][subFieldName]=value}else{updateChain.context.obj1[fieldName]=value}}return updateChain};updateChain.hasChanges=function(){return updateChain.context.changes};return updateChain});ncddoc(function(){},wigiiNcd.txtDate=function(timestamp){var d=($.type(timestamp)=="date"?timestamp:new Date(timestamp));var returnValue="";var v=0;returnValue+=d.getFullYear();returnValue+="-";v=d.getMonth()+1;if(v<10){returnValue+="0"+v}else{returnValue+=v}returnValue+="-";v=d.getDate();if(v<10){returnValue+="0"+v}else{returnValue+=v}returnValue+=" ";v=d.getHours();if(v<10){returnValue+="0"+v}else{returnValue+=v}returnValue+=":";v=d.getMinutes();if(v<10){returnValue+="0"+v}else{returnValue+=v}returnValue+=":";v=d.getSeconds();if(v<10){returnValue+="0"+v}else{returnValue+=v}return returnValue});ncddoc(function(){},wigiiNcd.txtFrenchDate=function(timestamp,options){var d=($.type(timestamp)=="date"?timestamp:new Date(timestamp));var returnValue="";var v=0;if(options!="noDate"){v=d.getDate();if(v<10){returnValue+="0"+v}else{returnValue+=v}returnValue+=".";v=d.getMonth()+1;if(v<10){returnValue+="0"+v}else{returnValue+=v}returnValue+=".";returnValue+=d.getFullYear()}if(options!="noTime"){if(options!="noDate"){returnValue+=" "}v=d.getHours();if(v<10){returnValue+="0"+v}else{returnValue+=v}returnValue+=":";v=d.getMinutes();if(v<10){returnValue+="0"+v}else{returnValue+=v}if(options!="noSeconds"){returnValue+=":";v=d.getSeconds();if(v<10){returnValue+="0"+v}else{returnValue+=v}}}return returnValue});ncddoc(function(){},wigiiNcd.html=function(output){return wigiiNcd.getHtmlEmitter(output)});ncddoc(function(){},wigiiNcd.version=function(){return"2.12"});ncddoc(function(){},wigiiNcd.comment=wigiiNcdAttr);ncddoc(function(){},wigiiNcd.attr=wigiiNcdAttr)};var wigiiNcdInstance=new WigiiNcd();var wigiiNcdFacade=function(selector,options){var wigiiNcd=wigiiNcdInstance;return wigiiNcd};if(!$.isFunction(window.wigiiNcd)||window.wigiiNcd().version()<wigiiNcdFacade().version()){window.wigiiNcd=wigiiNcdFacade;if(wigiiNcdOptions.publishNcdToWncd===undefined){wigiiNcdOptions.publishNcdToWncd=function(wigiiNcd,wncd){for(var member in wigiiNcd){if(!wigiiNcdOptions.privateNcdMembers[member]){wncd[member]=wigiiNcd[member]}}}}window.wncd={};if(wigiiNcdOptions.publishNcdToWncd){wigiiNcdOptions.publishNcdToWncd(wigiiNcdInstance,window.wncd)}}})(window,jQuery);(function(a){a.fn.wncd=function(h,d){var f=wigiiNcd();var g=undefined;try{if(!h){throw f.createServiceException("cmd cannot be null",f.errorCodes.INVALID_ARGUMENT)}var c=f.getJQueryService()[h];if(!c||a.type(c)!=="function"){throw f.createServiceException("Wigii NCD JQueryService does not support the '"+h+"' command.",f.errorCodes.UNSUPPORTED_OPERATION)}g=c(this,d)}catch(j){if(window.wigii){wigii().publishException(j)}else{throw j}}if(g){return g}else{return this}}})(jQuery);(function(e){e.fn.tabby=function(g){var h=e.extend({},e.fn.tabby.defaults,g);var j=e.fn.tabby.pressed;return this.each(function(){$this=e(this);var k=e.meta?e.extend({},h,$this.data()):h;$this.bind("keydown",function(m){var l=e.fn.tabby.catch_kc(m);if(16==l){j.shft=true}if(17==l){j.ctrl=true;setTimeout("$.fn.tabby.pressed.ctrl = false;",1000)}if(18==l){j.alt=true;setTimeout("$.fn.tabby.pressed.alt = false;",1000)}if(9==l&&!j.ctrl&&!j.alt){m.preventDefault;j.last=l;setTimeout("$.fn.tabby.pressed.last = null;",0);f(e(m.target).get(0),j.shft,k);return false}}).bind("keyup",function(l){if(16==e.fn.tabby.catch_kc(l)){j.shft=false}}).bind("blur",function(l){if(9==j.last){e(l.target).one("focus",function(m){j.last=null}).get(0).focus()}})})};e.fn.tabby.catch_kc=function(g){return g.keyCode?g.keyCode:g.charCode?g.charCode:g.which};e.fn.tabby.pressed={shft:false,ctrl:false,alt:false,last:null};function c(g){if(window.console&&window.console.log){window.console.log("textarea count: "+g.size())}}function f(k,j,h){var g=k.scrollTop;if(k.setSelectionRange){a(k,j,h)}else{if(document.selection){d(k,j,h)}}k.scrollTop=g}e.fn.tabby.defaults={tabString:String.fromCharCode(9)};function a(k,g,w){var v=k.selectionStart;var t=k.selectionEnd;if(v==t){if(g){if("\t"==k.value.substring(v-w.tabString.length,v)){k.value=k.value.substring(0,v-w.tabString.length)+k.value.substring(v);k.focus();k.setSelectionRange(v-w.tabString.length,v-w.tabString.length)}else{if("\t"==k.value.substring(v,v+w.tabString.length)){k.value=k.value.substring(0,v)+k.value.substring(v+w.tabString.length);k.focus();k.setSelectionRange(v,v)}}}else{k.value=k.value.substring(0,v)+w.tabString+k.value.substring(v);k.focus();k.setSelectionRange(v+w.tabString.length,v+w.tabString.length)}}else{var x=k.value.split("\n");var u=new Array();var m=0;var j=0;var h=false;for(var q in x){j=m+x[q].length;u.push({start:m,end:j,selected:(m<=v&&j>v)||(j>=t&&m<t)||(m>v&&j<t)});m=j+1}var l=0;for(var q in u){if(u[q].selected){var s=u[q].start+l;if(g&&w.tabString==k.value.substring(s,s+w.tabString.length)){k.value=k.value.substring(0,s)+k.value.substring(s+w.tabString.length);l-=w.tabString.length}else{if(!g){k.value=k.value.substring(0,s)+w.tabString+k.value.substring(s);l+=w.tabString.length}}}}k.focus();var r=v+((l>0)?w.tabString.length:(l<0)?-w.tabString.length:0);var n=t+l;k.setSelectionRange(r,n)}}function d(s,y,g){var r=document.selection.createRange();if(s==r.parentElement()){if(""==r.text){if(y){var m=r.getBookmark();r.moveStart("character",-g.tabString.length);if(g.tabString==r.text){r.text=""}else{r.moveToBookmark(m);r.moveEnd("character",g.tabString.length);if(g.tabString==r.text){r.text=""}}r.collapse(true);r.select()}else{r.text=g.tabString;r.collapse(false);r.select()}}else{var l=r.text;var q=l.length;var w=l.split("\r\n");var B=document.body.createTextRange();B.moveToElementText(s);B.setEndPoint("EndToStart",r);var n=B.text;var z=n.split("\r\n");var t=n.length;var A=document.body.createTextRange();A.moveToElementText(s);A.setEndPoint("StartToEnd",r);var x=A.text;var h=document.body.createTextRange();h.moveToElementText(s);h.setEndPoint("StartToEnd",B);var u=h.text;var j=e(s).html();e("#r3").text(t+" + "+q+" + "+x.length+" = "+j.length);if((t+u.length)<j.length){z.push("");t+=2;if(y&&g.tabString==w[0].substring(0,g.tabString.length)){w[0]=w[0].substring(g.tabString.length)}else{if(!y){w[0]=g.tabString+w[0]}}}else{if(y&&g.tabString==z[z.length-1].substring(0,g.tabString.length)){z[z.length-1]=z[z.length-1].substring(g.tabString.length)}else{if(!y){z[z.length-1]=g.tabString+z[z.length-1]}}}for(var v=1;v<w.length;v++){if(y&&g.tabString==w[v].substring(0,g.tabString.length)){w[v]=w[v].substring(g.tabString.length)}else{if(!y){w[v]=g.tabString+w[v]}}}if(1==z.length&&0==t){if(y&&g.tabString==w[0].substring(0,g.tabString.length)){w[0]=w[0].substring(g.tabString.length)}else{if(!y){w[0]=g.tabString+w[0]}}}if((t+q+x.length)<j.length){w.push("");q+=2}B.text=z.join("\r\n");r.text=w.join("\r\n");var k=document.body.createTextRange();k.moveToElementText(s);if(0<t){k.setEndPoint("StartToEnd",B)}else{k.setEndPoint("StartToStart",B)}k.setEndPoint("EndToEnd",r);k.select()}}}})(jQuery);(function(f){var o=function(s,r){return(s<<r)|(s>>>(32-r))};var a=function(v,s){var x,r,u,w,t;u=(v&2147483648);w=(s&2147483648);x=(v&1073741824);r=(s&1073741824);t=(v&1073741823)+(s&1073741823);if(x&r){return(t^2147483648^u^w)}if(x|r){if(t&1073741824){return(t^3221225472^u^w)}else{return(t^1073741824^u^w)}}else{return(t^u^w)}};var q=function(r,t,s){return(r&t)|((~r)&s)};var n=function(r,t,s){return(r&s)|(t&(~s))};var l=function(r,t,s){return(r^t^s)};var k=function(r,t,s){return(t^(r|(~s)))};var h=function(u,t,z,y,r,v,w){u=a(u,a(a(q(t,z,y),r),w));return a(o(u,v),t)};var d=function(u,t,z,y,r,v,w){u=a(u,a(a(n(t,z,y),r),w));return a(o(u,v),t)};var j=function(u,t,z,y,r,v,w){u=a(u,a(a(l(t,z,y),r),w));return a(o(u,v),t)};var e=function(u,t,z,y,r,v,w){u=a(u,a(a(k(t,z,y),r),w));return a(o(u,v),t)};var g=function(u){var y;var t=u.length;var s=t+8;var x=(s-(s%64))/64;var w=(x+1)*16;var z=Array(w-1);var r=0;var v=0;while(v<t){y=(v-(v%4))/4;r=(v%4)*8;z[y]=(z[y]|(u.charCodeAt(v)<<r));v++}y=(v-(v%4))/4;r=(v%4)*8;z[y]=z[y]|(128<<r);z[w-2]=t<<3;z[w-1]=t>>>29;return z};var c=function(u){var t="",r="",v,s;for(s=0;s<=3;s++){v=(u>>>(s*8))&255;r="0"+v.toString(16);t=t+r.substr(r.length-2,2)}return t};var m=function(s){s=s.replace(/\x0d\x0a/g,"\x0a");var r="";for(var u=0;u<s.length;u++){var t=s.charCodeAt(u);if(t<128){r+=String.fromCharCode(t)}else{if((t>127)&&(t<2048)){r+=String.fromCharCode((t>>6)|192);r+=String.fromCharCode((t&63)|128)}else{r+=String.fromCharCode((t>>12)|224);r+=String.fromCharCode(((t>>6)&63)|128);r+=String.fromCharCode((t&63)|128)}}}return r};f.extend({md5:function(r){var z=Array();var J,K,s,y,I,T,S,Q,N;var G=7,E=12,C=17,A=22;var R=5,O=9,M=14,L=20;var w=4,v=11,u=16,t=23;var H=6,F=10,D=15,B=21;r=m(r);z=g(r);T=1732584193;S=4023233417;Q=2562383102;N=271733878;for(J=0;J<z.length;J+=16){K=T;s=S;y=Q;I=N;T=h(T,S,Q,N,z[J+0],G,3614090360);N=h(N,T,S,Q,z[J+1],E,3905402710);Q=h(Q,N,T,S,z[J+2],C,606105819);S=h(S,Q,N,T,z[J+3],A,3250441966);T=h(T,S,Q,N,z[J+4],G,4118548399);N=h(N,T,S,Q,z[J+5],E,1200080426);Q=h(Q,N,T,S,z[J+6],C,2821735955);S=h(S,Q,N,T,z[J+7],A,4249261313);T=h(T,S,Q,N,z[J+8],G,1770035416);N=h(N,T,S,Q,z[J+9],E,2336552879);Q=h(Q,N,T,S,z[J+10],C,4294925233);S=h(S,Q,N,T,z[J+11],A,2304563134);T=h(T,S,Q,N,z[J+12],G,1804603682);N=h(N,T,S,Q,z[J+13],E,4254626195);Q=h(Q,N,T,S,z[J+14],C,2792965006);S=h(S,Q,N,T,z[J+15],A,1236535329);T=d(T,S,Q,N,z[J+1],R,4129170786);N=d(N,T,S,Q,z[J+6],O,3225465664);Q=d(Q,N,T,S,z[J+11],M,643717713);S=d(S,Q,N,T,z[J+0],L,3921069994);T=d(T,S,Q,N,z[J+5],R,3593408605);N=d(N,T,S,Q,z[J+10],O,38016083);Q=d(Q,N,T,S,z[J+15],M,3634488961);S=d(S,Q,N,T,z[J+4],L,3889429448);T=d(T,S,Q,N,z[J+9],R,568446438);N=d(N,T,S,Q,z[J+14],O,3275163606);Q=d(Q,N,T,S,z[J+3],M,4107603335);S=d(S,Q,N,T,z[J+8],L,1163531501);T=d(T,S,Q,N,z[J+13],R,2850285829);N=d(N,T,S,Q,z[J+2],O,4243563512);Q=d(Q,N,T,S,z[J+7],M,1735328473);S=d(S,Q,N,T,z[J+12],L,2368359562);T=j(T,S,Q,N,z[J+5],w,4294588738);N=j(N,T,S,Q,z[J+8],v,2272392833);Q=j(Q,N,T,S,z[J+11],u,1839030562);S=j(S,Q,N,T,z[J+14],t,4259657740);T=j(T,S,Q,N,z[J+1],w,2763975236);N=j(N,T,S,Q,z[J+4],v,1272893353);Q=j(Q,N,T,S,z[J+7],u,4139469664);S=j(S,Q,N,T,z[J+10],t,3200236656);T=j(T,S,Q,N,z[J+13],w,681279174);N=j(N,T,S,Q,z[J+0],v,3936430074);Q=j(Q,N,T,S,z[J+3],u,3572445317);S=j(S,Q,N,T,z[J+6],t,76029189);T=j(T,S,Q,N,z[J+9],w,3654602809);N=j(N,T,S,Q,z[J+12],v,3873151461);Q=j(Q,N,T,S,z[J+15],u,530742520);S=j(S,Q,N,T,z[J+2],t,3299628645);T=e(T,S,Q,N,z[J+0],H,4096336452);N=e(N,T,S,Q,z[J+7],F,1126891415);Q=e(Q,N,T,S,z[J+14],D,2878612391);S=e(S,Q,N,T,z[J+5],B,4237533241);T=e(T,S,Q,N,z[J+12],H,1700485571);N=e(N,T,S,Q,z[J+3],F,2399980690);Q=e(Q,N,T,S,z[J+10],D,4293915773);S=e(S,Q,N,T,z[J+1],B,2240044497);T=e(T,S,Q,N,z[J+8],H,1873313359);N=e(N,T,S,Q,z[J+15],F,4264355552);Q=e(Q,N,T,S,z[J+6],D,2734768916);S=e(S,Q,N,T,z[J+13],B,1309151649);T=e(T,S,Q,N,z[J+4],H,4149444226);N=e(N,T,S,Q,z[J+11],F,3174756917);Q=e(Q,N,T,S,z[J+2],D,718787259);S=e(S,Q,N,T,z[J+9],B,3951481745);T=a(T,K);S=a(S,s);Q=a(Q,y);N=a(N,I)}var P=c(T)+c(S)+c(Q)+c(N);return P.toLowerCase()}})})(jQuery);(function(h,d,k){var a=undefined;if(h.wigiiNcdEtp&&h.wigiiNcdEtp.options){a=h.wigiiNcdEtp.options}if(!a){a={}}if(!a.privateNcdEtpMembers){a.privateNcdEtpMembers={}}var c=function(q){a.privateNcdEtpMembers[q]=true};var l=k().comment;var f={};f.instantiationTime=Date.now();c("instantiationTime");f.ctxKey="WigiiNcdEtp_"+f.instantiationTime;c("ctxKey");f.version=function(){return"2.12"};if(!a.programOutput){a.programOutput="#programOutput"}var e=k().getHtmlEmitter(a.programOutput);f.html=e;c("html");var n=function(r){e.clearErrors();try{r();e.end()}catch(q){e.publishException(q)}};f.debug={};f.debug.initialize=function(){if(d("#programWatcherContainer").length==0){e.$().css("float","left").css("width","71%").after('<div id="programWatcherContainer"><div id="programWatcher"></div></div><div style="clear:both;"></div>')}d("#programWatcherContainer").show();return f.debug};f.debug.$=function(){return d("#programWatcherContainer")};var j={stockerDonnee:function(r,s,q){if(q===undefined){wigii().getRiseNcd().storeData(r,undefined,s)}else{wigii().getRiseNcd().storeData(r,s,q)}},obtenirDonnee:function(q){return wigii().getRiseNcd().getData(q)},creerEspaceStockage:function(q,r){return wigii().getRiseNcd().createDataStorage(q,r)},sysUsername:function(){return wigii().getRiseNcd().sysUsername()},rise:function(){return wigii().getRiseNcd()}};e.addModeler(function(q){q.impl.out=function(s,r){q.startSpan(r);q.put(s);q.endSpan();return q};q.impl.h1=function(s,r){q.startH1(r);q.put(s);q.endH1();return q};q.impl.p=function(r){q.startP(r);return q};q.impl.$p=function(){q.endP();return q};q.impl.b=function(r){q.startSpan("b");q.put(r);q.endSpan();return q};q.impl.i=function(r){q.startSpan("i");q.put(r);q.endSpan();return q};q.impl.u=function(r){q.startSpan("u");q.put(r);q.endSpan();return q};q.impl.a=function(r){q.put(k().getHtmlBuilder().putStartTag("a","href",r,"target","_blank","class",q.emittedClass()).put(r).putEndTag("a").html());return q};q.impl.color=function(t,s,r){q.startColor(t,s,r);return q};q.impl.$color=function(){q.endColor();return q};q.impl.bouton=function(s,u,r,v,t){q.putButton(s,u,r,v,t);return q};q.impl.input=function(r){return q.createTextArea(r)};q.impl.display=function(t,r,s){return q.createTextInput(s).color(t,r)};q.impl.insert=function(r){q.htmlBuilder().insert(r).emit();return q};q.impl.button=q.impl.bouton;q.out=q.impl.out;q.h1=q.impl.h1;q.p=q.impl.p;q.$p=q.impl.$p;q.b=q.impl.b;q.i=q.impl.i;q.u=q.impl.u;q.a=q.impl.a;q.color=q.impl.color;q.$color=q.impl.$color;q.bouton=q.impl.bouton;q.input=q.impl.input;q.display=q.impl.display;q.insert=q.impl.insert;q.button=q.impl.button});e.addModeler(function(q){q.context.gridInstance=undefined;q.impl.grille=function(s,r){if(s===undefined&&r===undefined){return q.context.gridInstance}if(q.context.gridInstance){d("#"+q.context.gridInstance.ctxKey).remove()}q.context.gridInstance=q.createGrid(s,r);q.context.gridInstance.cellule=q.impl.grille.cellule;q.context.gridInstance.couleur=q.impl.grille.couleur;q.context.gridInstance.texte=q.impl.grille.texte;q.context.gridInstance.onclick=q.impl.grille.onclick;q.context.gridInstance.nLignes=q.context.gridInstance.nRows;q.context.gridInstance.nColonnes=q.context.gridInstance.nCols;q.context.gridInstance.initializeCellForEtp=function(u){if(!u.context.etpReady){u.texte=u.text;u.couleur=u.color;u.gauche=function(){return q.context.gridInstance.initializeCellForEtp(u.left(true))};u.droite=function(){return q.context.gridInstance.initializeCellForEtp(u.right(true))};u.bas=function(){return q.context.gridInstance.initializeCellForEtp(u.down(true))};u.haut=function(){return q.context.gridInstance.initializeCellForEtp(u.up(true))};u.bouton=function(v,w){d("#"+u.id()).addClass("button");return u.text(v).click(w)};u.cellule=function(v,w){return q.impl.grille.cellule(v,w)};var t=u.offset;u.offset=function(v,w){return q.context.gridInstance.initializeCellForEtp(t(v,w))};u.espace={};u.context.etpReady=true}return u};return q.context.gridInstance};q.impl.grille.cellule=function(r,s){return q.context.gridInstance.initializeCellForEtp(q.context.gridInstance.cell(r-1,s-1))};q.impl.grille.couleur=function(s,t,r){if(r===undefined){return q.context.gridInstance.cell(s-1,t-1).color()}else{q.context.gridInstance.cell(s-1,t-1).color(r);return q.context.gridInstance}};q.impl.grille.texte=function(r,t,s){if(s===undefined){return q.context.gridInstance.cell(r-1,t-1).text()}else{q.context.gridInstance.cell(r-1,t-1).text(s);return q.context.gridInstance}};q.impl.grille.onclick=function(t){for(var s=0;s<q.context.gridInstance.nRows();s++){for(var r=0;r<q.context.gridInstance.nCols();r++){q.context.gridInstance.cell(s,r).click(function(u){if(f.programme.context){f.programme.context.html(q)}t(u.x()+1,u.y()+1)})}}return q.context.gridInstance};q.impl.grille.nLignes=function(){return q.context.gridInstance.nLignes()};q.impl.grille.nColonnes=function(){return q.context.gridInstance.nColonnes()};q.impl.grille.nRows=function(){return q.context.gridInstance.nRows()};q.impl.grille.nCols=function(){return q.context.gridInstance.nCols()};q.grille=q.impl.grille});var m={impl:{collection:{},instance:function(r){var q=this;q.index=r;q.list=[];q.lire=function(s){if(s-1<0||s-1>=q.list.length){throw k().createServiceException("L'index "+s+" est invalide, il doit être compris entre 1 et "+q.list.length,k().errorCodes.INVALID_ARGUMENT)}return q.list[s-1]};q.lirePremier=function(){return q.lire(1)};q.lireDernier=function(){return q.lire(q.taille())};q.remplacer=function(t,s){if(t-1<0||t-1>=q.list.length){throw k().createServiceException("L'index "+t+" est invalide, il doit être compris entre 1 et "+q.list.length,k().errorCodes.INVALID_ARGUMENT)}q.list[t-1]=s;return q};q.ajouter=function(s){q.list.push(s);return q};q.sortirDernier=function(){return q.list.pop()};q.taille=function(){return q.list.length};q.montrer=function(){f.debug.initialize().$().find("#programWatcher").html("<u>"+q.index+"</u> Taille: "+q.taille()+"<br/>"+JSON.stringify(q.list))};q.exporter=function(){return q.list};q.importer=function(s){if(s===undefined||s===null){return q}if(d.isArray(s)){q.list=s}else{q.list.push(s)}return q};q.vider=function(){q.list=[];return q};q.trier=function(s){q.list.sort(s);return q};q.read=q.lire;q.readFirst=q.lirePremier;q.readLast=q.lireDernier;q.replace=q.remplacer;q.add=q.ajouter;q.removeLast=q.sortirDernier;q.size=q.taille;q.show=q.montrer;q.exportContent=q.exporter;q.importContent=q.importer;q.empty=q.vider;q.sort=q.trier}},no:function(q){var r=m.impl.collection["P_"+q];if(!r){r=new (m.impl.instance)(q);m.impl.collection["P_"+q]=r}return r},reset:function(){m.impl.collection={}},lire:function(q){return m.no("default").lire(q)},lirePremier:function(){return m.no("default").lirePremier()},lireDernier:function(){return m.no("default").lireDernier()},remplacer:function(r,q){return m.no("default").remplacer(r,q)},ajouter:function(q){return m.no("default").ajouter(q)},sortirDernier:function(){return m.no("default").sortirDernier()},taille:function(){return m.no("default").taille()},montrer:function(){return m.no("default").montrer()},exporter:function(){return m.no("default").exporter()},importer:function(q){return m.no("default").importer(q)},vider:function(){return m.no("default").vider()},trier:function(q){return m.no("default").trier(q)}};var g={impl:{collection:{},instance:function(r){var q=this;q.index=r;q.context={currentFieldName:undefined,fieldIndex:0};q.fields={};q.Field=function(s,u,x,z,w,y,v){var t=this;t.context={};t.context.formulaire=s;t.context.nom=u;t.context.id="formulaire_"+s.index+"__"+u;t.context.display=undefined;t.context.label=x;t.context.changed=false;t.id=function(){return t.context.id};t.$=function(){return d("#"+t.context.id)};t.nom=function(){return t.context.nom};t.input=function(){return t.context.display};t.valeur=function(A){if(A===undefined){return t.context.display.text()}else{t.context.display.text(A);t.context.changed=false;return t}};t.label=function(A){if(A===undefined){return t.context.label}else{t.context.label=A;d("#"+t.context.id+" div.etp-label span:first-child").html(A);return t}};t.label.couleur=function(A){if(A===undefined){return d("#"+t.context.id+" div.etp-label span:first-child").css("color")}else{d("#"+t.context.id+" div.etp-label span:first-child").css("color",A);return t}};t.couleur=function(A){if(A===undefined){return d("#"+t.context.id).css("background-color")}else{d("#"+t.context.id).css("background-color",A);return t}};t.vider=function(){t.context.display.text("");return t};t.focus=function(){d("#"+t.context.display.ctxKey).focus();t.context.formulaire.context.currentFieldName=t.context.nom;return t};t.disabled=function(A){if(A===undefined){return d("#"+t.context.display.ctxKey).prop("disabled")}else{d("#"+t.context.display.ctxKey).prop("disabled",A);return t}};t.readonly=function(A){if(A===undefined){return d("#"+t.context.display.ctxKey).prop("readonly")}else{d("#"+t.context.display.ctxKey).prop("readonly",A);return t}};t.changed=function(A){if(A===undefined){return t.context.changed}else{t.context.changed=A;return t}};t.champ=function(A){return t.context.formulaire.champ(A)};t.name=t.nom;t.value=t.valeur;t.label.color=t.label.couleur;t.color=t.couleur;t.empty=t.vider;t.field=t.champ;f.programme.currentDiv().putHtml(k().getHtmlBuilder().putStartTag("div","id",t.context.id,"class","etp-field "+e.emittedClass()).putStartTag("div","class","etp-label "+e.emittedClass()).putStartTag("span","class",e.emittedClass()).put(t.context.label).putEndTag("span").putEndTag("div").putStartTag("div","class","etp-value "+e.emittedClass()).putEndTag("div").putEndTag("div").html());s.context.fieldIndex++;if(y){switch(y){case"TextArea":t.context.display=k().getHtmlEmitter("#"+t.context.id+" div.etp-value").createTextArea(undefined,s.context.fieldIndex).color(w,z);break;case"PasswordInput":t.context.display=k().getHtmlEmitter("#"+t.context.id+" div.etp-value").createPasswordInput(undefined,s.context.fieldIndex).color(w,z);break;case"Empty":t.context.display=undefined;break;default:throw k().createServiceException("Le type de champ '"+y+"' n'est pas supporté.",k().errorCodes.INVALID_ARGUMENT)}}else{t.context.display=k().getHtmlEmitter("#"+t.context.id+" div.etp-value").createTextInput(undefined,s.context.fieldIndex).color(w,z)}if(t.context.display){t.context.display.id=function(){return t.context.display.ctxKey};t.context.display.$=function(){return d("#"+t.context.display.ctxKey)};t.context.display.couleur=t.context.display.color;t.context.display.onInput(function(B,A){B.context.text=A;t.context.changed=true});t.context.display.$().click(function(){t.context.formulaire.context.currentFieldName=t.context.nom})}return t};q.creerChamp=function(s,u,v,t){var w=q.fields[s];if(w){throw k().createServiceException("Le champ "+s+" existe déjà dans le formulaire, il ne peut pas être créé une deuxième fois. Choisissez un autre nom.",k().errorCodes.INVALID_ARGUMENT)}q.fields[s]=new q.Field(q,s,u,v,t);return q};q.creerChampTexte=function(s,u,v,t){var w=q.fields[s];if(w){throw k().createServiceException("Le champ "+s+" existe déjà dans le formulaire, il ne peut pas être créé une deuxième fois. Choisissez un autre nom.",k().errorCodes.INVALID_ARGUMENT)}q.fields[s]=new q.Field(q,s,u,v,t,"TextArea");return q};q.creerChampPassword=function(s,u,v,t){var w=q.fields[s];if(w){throw k().createServiceException("Le champ "+s+" existe déjà dans le formulaire, il ne peut pas être créé une deuxième fois. Choisissez un autre nom.",k().errorCodes.INVALID_ARGUMENT)}q.fields[s]=new q.Field(q,s,u,v,t,"PasswordInput");return q};q.creerChampCustom=function(w,z,s,u,B){var y=q.fields[w];if(y){throw k().createServiceException("Le champ "+w+" existe déjà dans le formulaire, il ne peut pas être créé une deuxième fois. Choisissez un autre nom.",k().errorCodes.INVALID_ARGUMENT)}q.fields[w]=new q.Field(q,w,z,u,B,"Empty");var x;if(arguments.length>5){x=Array.prototype.slice.call(arguments,5)}else{x=[]}var v=q.fields[w].$().find("div.etp-value").wncd("html");if(d.isFunction(s)){var A=wncd.currentDiv();wncd.programme.context.html(v);var t=s.apply(null,x);if(t!==undefined){v.putHtml(t)}wncd.programme.context.html(A)}else{v.putHtml(s)}return q};q.champ=function(s){var t=q.fields[s];if(!t){throw k().createServiceException("Le champ "+s+" n'existe pas dans le formulaire.",k().errorCodes.INVALID_ARGUMENT)}return t};q.champExiste=function(s){var t=q.fields[s];return(t?true:false)};q.champCourant=function(s){if(s!==undefined){q.context.currentFieldName=s}if(!q.context.currentFieldName){throw k().createServiceException("Aucun champ n'est actuellement sélectionné dans le formulaire. Cliquez sur un champ.",k().errorCodes.INVALID_STATE)}return q.champ(q.context.currentFieldName)};q.vider=function(){for(var s in q.fields){q.fields[s].vider()}return q};q.supprimer=function(){g.remove(q.index)};q.createField=q.creerChamp;q.createTextField=q.creerChampTexte;q.createPasswordField=q.creerChampPassword;q.createCustomField=q.creerChampCustom;q.field=q.champ;q.fieldExist=q.champExiste;q.currentField=q.champCourant;q.empty=q.vider;q.remove=q.supprimer;q.reset=function(){return g.reset(q.index)}}},no:function(q){var r=g.impl.collection["F_"+q];if(!r){r=new (g.impl.instance)(q);g.impl.collection["F_"+q]=r}return r},remove:function(q){var r=g.impl.collection["F_"+q];if(r){g.impl.collection["F_"+q]=null;for(fieldName in r.fields){var s=r.fields[fieldName];d("#"+s.id()).remove();s.context.formulaire=undefined;s.context.display=undefined;s.context=undefined}}},creerChamp:function(q,s,t,r){return g.no("default").creerChamp(q,s,t,r)},creerChampTexte:function(q,s,t,r){return g.no("default").creerChampTexte(q,s,t,r)},creerChampPassword:function(q,s,t,r){return g.no("default").creerChampPassword(q,s,t,r)},creerChampCustom:function(q,s,t,u,r){return g.no("default").creerChampCustom(q,s,t,u,r)},champ:function(q){return g.no("default").champ(q)},champExiste:function(q){return g.no("default").champExiste(q)},champCourant:function(q){return g.no("default").champCourant(q)},vider:function(){return g.no("default").vider()},supprimer:function(){return g.no("default").supprimer()},reset:function(q){if(q===undefined){q="default"}g.no(q).supprimer();return g.no(q)}};f.programme=n;f.out=e.out;f.h1=e.h1;f.p=e.p;f.$p=e.$p;f.b=e.b;f.i=e.i;f.u=e.u;f.a=e.a;f.color=e.color;f.$color=e.$color;f.bouton=e.bouton;f.input=e.input;f.display=e.display;f.grille=e.grille;f.panier=m;f.formulaire=g;f.serveur=j;f.ctlSel=k().sel;for(var o in k().dfa){f["dfa"+o.substring(0,1).toUpperCase()+o.substring(1)]=k().dfa[o]}f.program=f.programme;f.button=f.bouton;f.grid=f.grille;f.basket=f.panier;f.basket.read=f.panier.lire;f.basket.readFirst=f.panier.lirePremier;f.basket.readLast=f.panier.lireDernier;f.basket.replace=f.panier.remplacer;f.basket.add=f.panier.ajouter;f.basket.removeLast=f.panier.sortirDernier;f.basket.size=f.panier.taille;f.basket.show=f.panier.montrer;f.basket.exportContent=f.panier.exporter;f.basket.importContent=f.panier.importer;f.basket.empty=f.panier.vider;f.basket.sort=f.panier.trier;f.form=f.formulaire;f.form.createField=f.formulaire.creerChamp;f.form.createTextField=f.formulaire.creerChampTexte;f.form.createPasswordField=f.formulaire.creerChampPassword;f.form.createCustomField=f.formulaire.creerChampCustom;f.form.field=f.formulaire.champ;f.form.currentField=f.formulaire.champCourant;f.form.empty=f.formulaire.vider;f.server=f.serveur;f.server.getData=f.serveur.obtenirDonnee;f.server.storeData=f.serveur.stockerDonnee;if(!h.wigiiNcdEtp||!h.wigiiNcdEtp.version||h.wigiiNcdEtp.version()<f.version()){h.wigiiNcdEtp=f;if(a.publishNcdEtpToWncd===undefined){a.publishNcdEtpToWncd=function(q,r){for(var s in q){if(!a.privateNcdEtpMembers[s]){r[s]=q[s]}}r.html=q.html.clone}}if(!h.wncd){h.wncd={}}if(a.publishNcdEtpToWncd){a.publishNcdEtpToWncd(f,h.wncd)}if(a.publishNcdEtpToWindow===undefined){a.publishNcdEtpToWindow=function(q,r){for(var s in q){if(!a.privateNcdEtpMembers[s]){r[s]=q[s]}}}}if(a.publishNcdEtpToWindow){a.publishNcdEtpToWindow(f,h)}}if(a.ncdEtpReady===undefined){a.ncdEtpReady=function(q){var r=d("#footer");if(r.length>0){r.append("<span><i>&nbsp;Wigii NCD core v."+q.version()+" loaded</i></span>")}}}if(a.ncdEtpReady){a.ncdEtpReady(f)}f.options=a;c("options")})(window,jQuery,wigiiNcd);(function(q,l,G,g){var I=g.options;var k=function(M){I.privateNcdEtpMembers[M]=true};var w=G().comment;var f=G().comment;var x=g.html;var n=f(function(){},function(){var N=Array.prototype.slice.call(arguments);var P=H();var O=undefined;P.pause=function(){if(!P.isPaused){P.isPaused=true}};P.resume=function(R){O=R;if(P.isPaused){P.isPaused=false;P.argsI++;try{while(P.argsI<N.length){if(l.isFunction(N[P.argsI])){O=N[P.argsI](P);if(l.isFunction(O)){O=O(P)}}else{throw G().createServiceException("programme instruction number "+P.argsI+" is not a function.",G().errorCodes.INVALID_ARGUMENT)}if(P.isPaused){return}P.argsI++}P.html().end()}catch(Q){P.html().publishException(Q)}}};try{P.html().clearErrors();while(P.argsI<N.length){if(l.isFunction(N[P.argsI])){O=N[P.argsI](P);if(l.isFunction(O)){O=O(P)}}else{throw G().createServiceException("programme instruction number "+P.argsI+" is not a function.",G().errorCodes.INVALID_ARGUMENT)}if(P.isPaused){return}P.argsI++}P.html().end()}catch(M){P.html().publishException(M)}});w(function(){},g.Runtime=function(M,O){var N=this;N.className="Runtime";N.instantiationTime=Date.now();N.ctxKey=g.ctxKey+"_"+N.className+N.instantiationTime;N.options=O||{};N.context={html:M};N.impl={};N.program=function(){N.context.currentDiv=wncd.currentDiv();wncd.program.context.html(N.context.html);var Q=Array.prototype.slice.call(arguments);var S=H();var R=undefined;S.pause=function(){if(!S.isPaused){S.isPaused=true}};S.resume=function(U){R=U;if(S.isPaused){S.isPaused=false;S.argsI++;try{while(S.argsI<Q.length){if(l.isFunction(Q[S.argsI])){R=Q[S.argsI](S);if(l.isFunction(R)){R=R(S)}}else{throw G().createServiceException("programme instruction number "+S.argsI+" is not a function.",G().errorCodes.INVALID_ARGUMENT)}if(S.isPaused){return}S.argsI++}S.html().end()}catch(T){S.html().publishException(T)}wncd.program.context.html(N.context.currentDiv)}};try{S.html().clearErrors();while(S.argsI<Q.length){if(l.isFunction(Q[S.argsI])){R=Q[S.argsI](S);if(l.isFunction(R)){R=R(S)}}else{throw G().createServiceException("programme instruction number "+S.argsI+" is not a function.",G().errorCodes.INVALID_ARGUMENT)}if(S.isPaused){return}S.argsI++}S.html().end()}catch(P){S.html().publishException(P)}wncd.program.context.html(N.context.currentDiv)};N.programme=N.program});w(function(){},g.createRuntime=function(M,N){return new g.Runtime(M,N)});w(function(){},G().getJQueryService().run=function(O,M){var N=undefined;if(O&&O.length==1){N=g.createRuntime(wncd.html(O),M)}else{if(O&&O.length>1){throw wncd.createServiceException("Wigii NCD run selector can only be activated on a JQuery collection containing one element and not "+O.length,wncd.errorCodes.INVALID_ARGUMENT)}}return(!N?{$:O}:N)});var F=f(function(){},function(){var M=Array.prototype.slice.call(arguments);var N=function(){n.apply(null,M)};N.toFxString=function(){var O="sousProgramme(";for(var P=0;P<M.length;P++){if(P>0){O+=","}O+=G().obj2FxString(M[P])}O+=")";return O};return N});var H=f(function(){},function(){var M={argsI:0,isPaused:false,impl:{}};M.html=function(N){if(N===undefined){return M.impl.html||g.html}else{M.impl.html=N;return M}};M.html(n.currentDiv());return M});var t=f(function(){},function(P,O,M){n.context.fxCtx=O;var N=P.apply(null,M);n.context.fxCtx=undefined;return N});var j=f(function(){},function(N){var M;if(arguments.length>1){M=Array.prototype.slice.call(arguments,1)}else{M=[]}return function(Q){var O=[];for(var P=0;P<M.length;P++){if(l.isFunction(M[P])){O[P]=M[P](Q)}else{O[P]=M[P]}}return t(N,Q,O)}});var y=f(function(){},function(P,O){var M;if(arguments.length>2){M=Array.prototype.slice.call(arguments,2)}else{M=[]}var N=function(S){var Q=[];for(var R=0;R<M.length;R++){if(l.isFunction(M[R])){Q[R]=M[R](S)}else{Q[R]=M[R]}}return t(O,S,Q)};N.toFxString=function(){var Q=P+"(";for(var R=0;R<M.length;R++){if(R>0){Q+=","}Q+=G().obj2FxString(M[R])}Q+=")";return Q};return N});var K=f(function(){},function(P,O){var M;if(arguments.length>2){M=Array.prototype.slice.call(arguments,2)}else{M=[]}var N=function(T){var Q=[];for(var R=0;R<M.length;R++){if(l.isFunction(M[R])){Q[R]=M[R](T)}else{Q[R]=M[R]}}var S=O(T);return t(S,T,Q)};N.toFxString=function(){var Q=P+"(";for(var R=0;R<M.length;R++){if(R>0){Q+=","}Q+=G().obj2FxString(M[R])}Q+=")";return Q};return N});var D=f(function(){},function(){var M=[];var P=H();var N={addFx:function(Q){M.push(Q)},toFx:function(){return function(R){P.html(R.html());var Q=undefined;P.pause=function(){if(!P.isPaused){P.isPaused=true;if(R){R.pause()}}};P.resume=function(S){Q=S;if(P.isPaused){P.isPaused=false;P.argsI++;while(P.argsI<M.length){if(l.isFunction(M[P.argsI])){Q=M[P.argsI](P);if(l.isFunction(Q)){Q=Q(P)}}else{Q=M[P.argsI]}if(P.isPaused){return}P.argsI++}P.argsI=0;if(R){Q=R.resume(Q)}}return Q};while(P.argsI<M.length){if(l.isFunction(M[P.argsI])){Q=M[P.argsI](P);if(l.isFunction(Q)){Q=Q(P)}}else{Q=M[P.argsI]}if(P.isPaused){return}P.argsI++}P.argsI=0;return Q}}};if(arguments.length>0){M=Array.prototype.slice.call(arguments);var O=N.toFx();O.toFxString=function(){var Q="ctlSeq(";for(var R=0;R<M.length;R++){if(R>0){Q+=","}Q+=G().obj2FxString(M[R])}Q+=")";return Q};return O}else{return N}});var v=f(function(){},function(N){var M=function(O){return t(N,O,undefined)};M.toFxString=function(){var O="scripte(";O+=G().obj2FxString(N);O+=")";return O};return M});var d=f(function(){},function(O,Q,M){var P=H();P.stepI=1;P.isSpanFunction=l.isFunction(O);if(!l.isFunction(Q)){throw G().createServiceException("generator should be a function.",G().errorCodes.INVALID_ARGUMENT)}var N=function(U){P.html(U.html());var T=undefined;P.pause=function(){if(!P.isPaused){P.isPaused=true;if(U){U.pause()}}};P.resume=function(X){T=X;if(P.isPaused){P.isPaused=false;P.stepI++;var V=(P.isSpanFunction?O(P.stepI,M):P.stepI<=O);while(V){var W=Q(P.stepI,M);if(l.isFunction(W)){T=W(P)}else{T=W}if(P.isPaused){return}P.stepI++;V=(P.isSpanFunction?O(P.stepI,M):P.stepI<=O)}P.stepI=1;if(U){T=U.resume(T)}}return T};var R=(P.isSpanFunction?O(P.stepI,M):P.stepI<=O);while(R){var S=Q(P.stepI,M);if(l.isFunction(S)){T=S(P)}else{T=S}if(P.isPaused){return}P.stepI++;R=(P.isSpanFunction?O(P.stepI,M):P.stepI<=O)}P.stepI=1;return T};N.toFxString=function(){var R="ctlGen(";R+=G().obj2FxString(O);R+=",";R+=G().obj2FxString(Q);R+=",";if(M===undefined){R+="undefined"}else{R+=G().obj2FxString(M)}R+=")";return R};return N});var e={};var A={};var s=function(Q){if(!Q){throw G().createServiceException("Catalog ID cannot be null",G().errorCodes.INVALID_ARGUMENT)}var N=e[Q];if(!N){N=n.panier.no(g.ctxKey+"_"+Q);N.importer(g.serveur.obtenirDonnee(Q));var P=N.taille();if(P>0){for(var M=1;M<=P;M++){var O=N.lire(M);if(O&&O.info){A[Q+"_"+O.info.id]=O}}}e[Q]=N}return N};var C=function(O,N){var M=A[O+"_"+N];if(!M){if(s(O).taille()>0){M=A[O+"_"+N]}}return M};var E=f(function(){},function(P,N,R,M){var O=F(p(),out("Du code publique."),$p(),p(),out("Définir le catalogue ID et le code ID pour le charger."),$p());var Q={info:undefined};if(N&&R){Q=C(N,R);if(!Q){throw G().createServiceException("No source code found in catalog '"+N+"' with ID '"+R+"'",G().errorCodes.INVALID_ARGUMENT)}O=G().fxString2obj(l.base64Decode(Q.program))}return{label:P,cssClass:M,program:O,info:Q.info}});var r=f(function(){},function(U,R,N,W){try{var M={label:U,cssClass:W,program:R,info:{}};if(N){M.info.author=N.author;M.info.description=N.description;if(N.key){M.info.key=l.md5(N.key)}if(N.publish){var T=Date.now();var P={info:M.info,program:l.base64Encode(G().obj2FxString(R))};var Q=false;var S=false;if(N.id){var O=C(N.catalog,N.id);if(!O){M.info.id=N.id;M.info.catalog=N.catalog;M.info.date=T;M.info.modificationDate=T;s(M.info.catalog).ajouter(P);A[M.info.catalog+"_"+M.info.id]=P;Q=true}else{if(O.info.key&&O.info.key!=P.info.key){throw G().createServiceException("Invalid modification key. No rights to modify code in catalog '"+N.catalog+"' with ID '"+N.id+"'",G().errorCodes.FORBIDDEN)}Q=G().updateObjIfChanged(O.info,P.info).field("author").field("description").set("modificationDate",T).hasChanges();Q=G().updateObjIfChanged(O,P).field("program").set("info",T,"modificationDate").hasChanges()|Q;if(Q){P=O}}}else{M.info.id=T+"_"+P.program.substr(3,8);M.info.catalog=N.catalog;M.info.date=T;M.info.modificationDate=T;s(M.info.catalog).ajouter(P);A[M.info.catalog+"_"+M.info.id]=P;Q=true;S=true}if(Q){P.id=P.info.id;g.serveur.stockerDonnee(N.catalog,"id",P)}if(S){M.program=F(p(),out('Le code source "'),i(N.description),out('" a été publié dans le catalogue '+N.catalog+" sous l'ID: "),b(P.id),$p(),p(),color("orange"),out("Ajoutez l'ID dans les infos de publications du code source avant de recharger une nouvelle fois la page."),$color(),$p())}}}}catch(V){n.html().publishException(V)}return M});var c=f(function(){},function(){var R=Date.now();var O=Array.prototype.slice.call(arguments);var N=x.div("menu"+R);var S=x.div("codeOutput"+R);var Q={};Q.modules=[];var M=function(T){T.menu=Q;Q.modules.push(T);N.button(T.label,function(){S.reset();n.context.codeSource=T;n.context.html(S);T.program();n.context.html(x)},T.cssClass)};for(var P=0;P<O.length;P++){M(O[P])}});var h=f(function(){},function(N,P){var O=r(undefined,N,P);try{O.program()}catch(M){n.html().publishException(M)}});var u=f(function(){},function(N,P){try{var O=E(undefined,N,P);O.program()}catch(M){n.html().publishException(M)}});w(function(){},g.CodeSourceEditor=function(O,N){var M=this;M.className="CodeSourceEditor";M.instantiationTime=Date.now();M.ctxKey=g.ctxKey+"_"+M.className+M.instantiationTime;M.options=N||{};M.context={};M.impl={};if(!M.options.testBtnLabel){M.options.testBtnLabel="Test"}if(!M.options.programOutput){M.options.programOutput=wncd.currentDiv();if(M.options.resetOutput===undefined){M.options.resetOutput=false}}else{if(M.options.programOutput==="above"||M.options.programOutput==="below"||M.options.programOutput==="between"){if(M.options.resetOutput===undefined){M.options.resetOutput=true}}else{if(l.type(M.options.programOutput)==="string"||M.options.programOutput.className!="HtmlEmitter"){M.options.programOutput=wncd.html(M.options.programOutput);if(M.options.resetOutput===undefined){M.options.resetOutput=true}}else{if(M.options.resetOutput===undefined){M.options.resetOutput=true}}}}M.context.codeScript=v(O);M.context.srcCode=G().obj2FxString(M.context.codeScript);M.impl.runCode=function(P){var Q=n.currentDiv();n.context.html(M.options.programOutput);if(M.options.resetOutput){M.options.programOutput.reset()}P();n.context.html(Q)};if(M.options.programOutput==="above"){M.options.programOutput=n.currentDiv().div(M.ctxKey+"_out")}M.context.textArea=n.currentDiv().createTextArea(M.options.textAreaClass);M.context.textArea.text(M.context.srcCode).onInput(function(Q,P){Q.text(P)}).$().tabby();if(M.options.programOutput==="between"){M.options.programOutput=n.currentDiv().div(M.ctxKey+"_out")}n.currentDiv().button(M.options.testBtnLabel,function(){var Q=M.context.textArea.text();var P=G().fxString2obj(Q);M.impl.runCode(P);M.context.codeScript=P;if(M.options.afterTest){M.options.afterTest(M)}},M.options.testBtnClass);if(M.options.programOutput==="below"){M.options.programOutput=n.currentDiv().div(M.ctxKey+"_out")}if(M.options.runOnLoad){M.impl.runCode(M.context.codeScript);if(M.options.afterTest){M.options.afterTest(M)}}});w(function(){},g.createCodeSourceEditor=function(N,M){return new g.CodeSourceEditor(N,M)});var o=f(function(){},function(O,M){var N=function(P){return g.createCodeSourceEditor(O,M)};N.toFxString=function(){var P="exemple(";P+=G().obj2FxString(O);if(M){P+=",";P+=G().obj2FxString(M)}P+=")";return P};return N});var m=function(M){var N=function(O){if(O){O.pause();setTimeout(function(){try{O.resume()}catch(P){O.html().publishException(P)}},1000*M)}};N.toFxString=function(){var O="pause(";O+=G().obj2FxString(M);O+=")";return O};return N};var L=f(function(){},function(N,O){var M=function(P){if(P){if(!O){O=n.context}if(!N){N="interruption"}O[N]=P;P.pause()}};M.toFxString=function(){var P="interrupt(";if(N){P+=G().obj2FxString(N)}else{P+='"interruption"'}P+=",";if(O){P+=G().obj2FxString(O)}else{P+="programme.context"}P+=")";return P};return M});var a=function(O,N,M){var P=function(Q){Q.html().button(O,function(){if(l.isFunction(N)){t(N,Q,undefined)}if(Q){Q.resume()}},M);if(Q){Q.pause()}};P.toFxString=function(){var Q="boutonDePause(";Q+=G().obj2FxString(O);if(N){Q+=",";Q+=G().obj2FxString(N)}if(M){if(!N){Q+=",undefined"}Q+=",";Q+=G().obj2FxString(N)}Q+=")";return Q};return P};var z=function(N,P,M,Q,O){return K("bouton",function(R){return R.html().button},N,function(){return P},M,Q,O)};x.addModeler(function(M){M.tortue={impl:{collection:{},instance:function(O){var N=this;N.context={tortue:undefined,key:O};N.impl={};N.impl.initialize=function(P){if(!M.context.gridInstance){throw G().createServiceException("Aucune grille n'existe. Appelez d'abord la fonction grille(nLignes,nCols).",G().errorCodes.INVALID_STATE)}if(!N.context.tortue||P){N.context.tortue=new (G().GridTurtle)(M.context.gridInstance,undefined,P)}return N.context.tortue};N.impl.start=function(P,S,R,Q){N.impl.initialize(Q).start(P-1,S-1,R)};N.impl.avance=function(){N.impl.initialize().moveForward()};N.impl.avanceDiagGauche=function(){N.impl.initialize().moveForwardAndLeft()};N.impl.avanceDiagDroite=function(){N.impl.initialize().moveForwardAndRight()};N.impl.demiTour=function(){N.impl.initialize().turnBack()};N.impl.tourneAGauche=function(){N.impl.initialize().turnLeft()};N.impl.tourneADroite=function(){N.impl.initialize().turnRight()};N.start=function(P,S,R,Q){return j(N.impl.start,P,S,R,Q)};N.avance=function(){return D(m(0.4),j(N.impl.avance))};N.avanceDiagGauche=function(){return D(m(0.4),j(N.impl.avanceDiagGauche))};N.avanceDiagDroite=function(){return D(m(0.4),j(N.impl.avanceDiagDroite))};N.demiTour=function(){return D(m(0.4),j(N.impl.demiTour))};N.tourneAGauche=function(){return D(m(0.4),j(N.impl.tourneAGauche))};N.tourneADroite=function(){return D(m(0.4),j(N.impl.tourneADroite))};N.marche=function(Q,P){if(!P){P=function(R,S){return S.avance()}}else{if(!l.isFunction(P)){throw G().createServiceException("plan doit être une fonction.",G().errorCodes.INVALID_ARGUMENT)}}return d(Q,P,N.chainable(true))};N.celluleCourante=function(){if(N.context.tortue){return N.context.tortue.grid().initializeCellForEtp(N.context.tortue.currentCell())}};N.cellule=function(P,Q){if(N.context.tortue){return N.context.tortue.grid().initializeCellForEtp(N.context.tortue.cell(P,Q))}};N.memoire=function(){if(N.context.tortue){return N.context.tortue.context}};N.chainable=function(S){var P=D();var Q=N;P.addFx(function(T){T.returnValue=Q;return T.returnValue});var R=function(U){var T=P.toFx()(U);if(S){P=D()}return T};R.start=function(T,W,V,U){P.addFx(Q.start(T,W,V,U));return R},R.avance=function(){P.addFx(Q.avance());return R},R.avanceDiagGauche=function(){P.addFx(Q.avanceDiagGauche());return R},R.avanceDiagDroite=function(){P.addFx(Q.avanceDiagDroite());return R},R.demiTour=function(){P.addFx(Q.demiTour());return R},R.tourneAGauche=function(){P.addFx(Q.tourneAGauche());return R},R.tourneADroite=function(){P.addFx(Q.tourneADroite());return R};R.pause=function(T){P.addFx(m(T));return R};R.marche=function(U,T){P.addFx(Q.marche(U,T));return R};R.celluleCourante=function(){return Q.celluleCourante()};R.cellule=function(T,U){return Q.cellule(T,U)};R.memoire=function(){return Q.memoire()};return R}}},no:function(O){var N=M.tortue.impl.collection["T_"+O];if(!N){N=new (M.tortue.impl.instance)(O);M.tortue.impl.collection["T_"+O]=N}return N.chainable()},reset:function(){M.tortue.impl.collection={}},start:function(N,Q,P,O){return M.tortue.no("default").start(N,Q,P,O||"blue")},avance:function(){return M.tortue.no("default").avance()},avanceDiagGauche:function(){return M.tortue.no("default").avanceDiagGauche()},avanceDiagDroite:function(){return M.tortue.no("default").avanceDiagDroite()},demiTour:function(){return M.tortue.no("default").demiTour()},tourneAGauche:function(){return M.tortue.no("default").tourneAGauche()},tourneADroite:function(){return M.tortue.no("default").tourneADroite()},pause:function(N){return M.tortue.no("default").pause(N)},marche:function(O,N){return M.tortue.no("default").marche(O,N)},celluleCourante:function(){return M.tortue.no("default").celluleCourante()},cellule:function(N,O){return M.tortue.no("default").cellule(N,O)},memoire:function(){return M.tortue.no("default").memoire()}}});var B={no:function(M){return n.currentDiv().tortue.no(M)},reset:function(){n.currentDiv().tortue.reset()},start:function(M,P,O,N){return B.no("default").start(M,P,O,N||"blue")},avance:function(){return B.no("default").avance()},avanceDiagGauche:function(){return B.no("default").avanceDiagGauche()},avanceDiagDroite:function(){return B.no("default").avanceDiagDroite()},demiTour:function(){return B.no("default").demiTour()},tourneAGauche:function(){return B.no("default").tourneAGauche()},tourneADroite:function(){return B.no("default").tourneADroite()},pause:function(M){return B.no("default").pause(M)},marche:function(N,M){return B.no("default").marche(N,M)},celluleCourante:function(){return B.no("default").celluleCourante()},cellule:function(M,N){return B.no("default").cellule(M,N)},memoire:function(){return B.no("default").memoire()}};var J=function(N,M){return y("grille",function(O,P){n.currentDiv().tortue.reset();n.currentDiv().grille(O,P)},N,M)};J.cellule=function(M,P){var N=D();N.addFx(function(Q){Q.returnValue=Q.html().grille.cellule(M,P);return Q.returnValue});var O=function(Q){return N.toFx()(Q)};O.couleur=function(Q){N.addFx(function(R){R.returnValue=R.returnValue.couleur(Q);return R.returnValue});return O};O.texte=function(Q){N.addFx(function(R){R.returnValue=R.returnValue.texte(Q);return R.returnValue});return O};O.pause=function(Q){N.addFx(m(Q));return O};O.bouton=function(Q,R){N.addFx(function(S){S.returnValue=S.returnValue.bouton(Q,R);return S.returnValue});return O};O.gauche=function(){N.addFx(function(Q){Q.returnValue=Q.returnValue.gauche();return Q.returnValue});return O};O.droite=function(){N.addFx(function(Q){Q.returnValue=Q.returnValue.droite();return Q.returnValue});return O};O.bas=function(){N.addFx(function(Q){Q.returnValue=Q.returnValue.bas();return Q.returnValue});return O};O.haut=function(){N.addFx(function(Q){Q.returnValue=Q.returnValue.haut();return Q.returnValue});return O};O.cellule=function(Q,R){N.addFx(function(S){S.returnValue=S.returnValue.cellule(Q,R);return S.returnValue});return O};O.offset=function(Q,R){N.addFx(function(S){S.returnValue=S.returnValue.offset(Q,R);return S.returnValue});return O};return O};J.couleur=function(M,O,N){return K("grille.couleur",function(P){return P.html().grille.couleur},M,O,N)};J.texte=function(N,O,M){return K("grille.texte",function(P){return P.html().grille.texte},N,O,M)};J.onclick=function(M){return K("grille.onclick",function(N){return N.html().grille.onclick},function(){return M})};J.fonctionSurClique=J.onclick;g.out=function(N,M){return K("out",function(O){return O.html().out},N,M)};g.h1=function(N,M){return K("h1",function(O){return O.html().h1},N,M)};g.p=function(M){return K("p",function(N){return N.html().p},M)};g.$p=function(){return K("$p",function(M){return M.html().$p})};g.b=function(M){return K("b",function(N){return N.html().b},M)};g.i=function(M){return K("i",function(N){return N.html().i},M)};g.u=function(M){return K("u",function(N){return N.html().u},M)};g.a=function(M){return K("a",function(N){return N.html().a},M)};g.color=function(O,N,M){return K("color",function(P){return P.html().color},O,N,M)};g.$color=function(){return K("$color",function(M){return M.html().$color})};x.addModeler(function(M){M.layout=function(R){var O;if(arguments.length>1){O=Array.prototype.slice.call(arguments,1)}else{O=[]}var P={};P.x=function(U,T,S){if(S.h&&!T){P.h(U,S.h,S)}else{if(S.v&&!T){P.v(U,S.v,S)}else{U.html().htmlBuilder().tag("div","id",S.id,"class",S.name+(S.cssClass?" "+S.cssClass:""),"style","float:left;"+(S.minWidth?"min-width:"+S.minWidth+";":"")+"width:"+S.width+"%;"+(S.maxWidth?"max-width:"+S.maxWidth+";":"")+(S.minHeight?"min-height:"+S.minHeight+";":"")+"height:"+S.height+"%;"+(S.maxHeight?"max-height:"+S.maxHeight+";":"")).insert(T[0]).$tag("div").emit()}}};P.x1=P.x;P.x2=P.x;P.x3=P.x;P.x4=P.x;P.x5=P.x;P.x6=P.x;P.x7=P.x;P.x8=P.x;P.x9=P.x;P.x10=P.x;P.weightOf=function(S){if(S&&S.startsWith("x")){return Number(S.substr(1))}else{return 0}};P.h=function(Y,W,ab){var V=Y.html().htmlBuilder();var S=ab.width;if(S){S=S+"%"}else{S=ab.cssWidth}var aa=ab.height;if(aa){aa=aa+"%"}else{aa=ab.cssHeight}var U=0;var X=0;for(var T=0;T<W.length;T++){U+=W[T].options.weight}U=100/U;V.tag("div","id",ab.id,"class","h"+(ab.cssClass?" "+ab.cssClass:""),"style","float:left;"+(ab.minWidth?"min-width:"+ab.minWidth+";":"")+"width:"+S+";"+(ab.maxWidth?"max-width:"+ab.maxWidth+";":"")+(ab.minHeight?"min-height:"+ab.minHeight+";":"")+"height:"+aa+";"+(ab.maxHeight?"max-height:"+ab.maxHeight+";":""));for(var T=0;T<W.length;T++){var Z=W[T];if(T<W.length-1){Z.options.width=Math.floor(Z.options.weight*U)}else{Z.options.width=100-X}X+=Z.options.width;Z.options.height=100;V.insert(function(ac){ac(wncd.createFxContext())},Z)}V.$tag("div").emit()};P.v=function(Y,W,ab){var V=Y.html().htmlBuilder();var S=ab.width;if(S){S=S+"%"}else{S=ab.cssWidth}var aa=ab.height;if(aa){aa=aa+"%"}else{aa=ab.cssHeight}var U=0;var X=0;for(var T=0;T<W.length;T++){U+=W[T].options.weight}U=100/U;V.tag("div","id",ab.id,"class","v"+(ab.cssClass?" "+ab.cssClass:""),"style","float:left;"+(ab.minWidth?"min-width:"+ab.minWidth+";":"")+"width:"+S+";"+(ab.maxWidth?"max-width:"+ab.maxWidth+";":"")+(ab.minHeight?"min-height:"+ab.minHeight+";":"")+"height:"+aa+";"+(ab.maxHeight?"max-height:"+ab.maxHeight+";":""));for(var T=0;T<W.length;T++){var Z=W[T];Z.options.width=100;if(T<W.length-1){Z.options.height=Math.floor(Z.options.weight*U)}else{Z.options.height=100-X}X+=Z.options.height;V.insert(function(ac){ac(wncd.createFxContext())},Z)}V.$tag("div").emit()};P.fx=function(U,T,S){S={name:U,id:"",cssClass:"",minWidth:"",maxWidth:"",minHeight:"",maxHeight:"",weight:P.weightOf(U),h:(S?S.h:undefined),v:(S?S.v:undefined)};var V=function(W){return P[U](W,T,S)};V.options=S;V.id=function(W){S.id=W;return V};V.cssClass=function(W){S.cssClass=W;return V};V.minWidth=function(W){S.minWidth=W;return V};V.maxWidth=function(W){S.maxWidth=W;return V};V.minHeight=function(W){S.minHeight=W;return V};V.maxHeight=function(W){S.maxHeight=W;return V};if(!P.weightOf(U)){V.height=function(W){S.cssHeight=W;return V};V.width=function(W){S.cssWidth=W;return V}}V.toFxString=function(){var X=U;var W=T;if(S.h){X+=".h";W=S.h}else{if(S.v){X+=".v";W=S.v}}X+="(";for(var Y=0;Y<W.length;Y++){if(Y>0){X+=","}X+=wncd.obj2FxString(W[Y])}X+=")";if(S.id){X+='.id("'+S.id+'")'}if(S.cssClass){X+='.cssClass("'+S.cssClass+'")'}if(S.minWidth){X+='.minWidth("'+S.minWidth+'")'}if(S.maxWidth){X+='.maxWidth("'+S.maxWidth+'")'}if(S.minHeight){X+='.minHeight("'+S.minHeight+'")'}if(S.maxHeight){X+='.maxHeight("'+S.maxHeight+'")'}if(U=="h"||U=="v"){if(S.cssWidth){X+='.width("'+S.cssWidth+'")'}if(S.cssHeight){X+='.height("'+S.cssHeight+'")'}}return X};return V};P.hFx=function(){return P.fx("h",Array.prototype.slice.call(arguments))};P.vFx=function(){return P.fx("v",Array.prototype.slice.call(arguments))};P.xFx=function(T){var U=function(){return P.fx(T,Array.prototype.slice.call(arguments))};var S={v:undefined,h:undefined};U.v=function(){S.v=Array.prototype.slice.call(arguments);return P.fx(T,undefined,S)};U.h=function(){S.h=Array.prototype.slice.call(arguments);return P.fx(T,undefined,S)};return U};P.x1Fx=P.xFx("x1");P.x2Fx=P.xFx("x2");P.x3Fx=P.xFx("x3");P.x4Fx=P.xFx("x4");P.x5Fx=P.xFx("x5");P.x6Fx=P.xFx("x6");P.x7Fx=P.xFx("x7");P.x8Fx=P.xFx("x8");P.x9Fx=P.xFx("x9");P.x10Fx=P.xFx("x10");var N=[P.hFx,P.vFx,P.x1Fx,P.x2Fx,P.x3Fx,P.x4Fx,P.x5Fx,P.x6Fx,P.x7Fx,P.x8Fx,P.x9Fx,P.x10Fx];Array.prototype.push.apply(N,O);var Q=R.apply(null,N);if(Q){wncd.program(Q)}return M}});n.context={impl:{},html:function(M){if(M===undefined){if(n.context.fxCtx&&l.isFunction(n.context.fxCtx.html)){return n.context.fxCtx.html()}else{if(n.context.impl.html){return n.context.impl.html}else{return g.html}}}else{if(n.context.fxCtx&&l.isFunction(n.context.fxCtx.html)){n.context.fxCtx.html(M)}n.context.impl.html=M;return n.context}}};n.grille=x.grille;n.tortue=x.tortue;n.panier=g.panier;n.formulaire=g.formulaire;n.serveur=g.serveur;n.div=function(N,M){return x.div(N,M)};n.html=function(){return x};n.mainDiv=n.html;n.currentDiv=function(){return n.context.html()};n.out=function(N,M){n.currentDiv().out(N,M);return n};n.h1=function(N,M){n.currentDiv().h1(N,M);return n};n.p=function(M){n.currentDiv().p(M);return n};n.$p=function(){n.currentDiv().$p();return n};n.b=function(M){n.currentDiv().b(M);return n};n.i=function(M){n.currentDiv().i(M);return n};n.u=function(M){n.currentDiv().u(M);return n};n.a=function(M){n.currentDiv().a(M);return n};n.color=function(O,N,M){n.currentDiv().color(O,N,M);return n};n.$color=function(){n.currentDiv().$color();return n};n.bouton=function(N,P,M,Q,O){n.currentDiv().bouton(N,P,M,Q,O);return n};n.codeSource=function(){return n.context.codeSource};n.libSource=h;n.libPublic=u;n.txtDate=G().txtDate;n.txtFrenchDate=G().txtFrenchDate;n.createSelectionSense=G().createSelectionSense;n.bindSelectionSense=G().bindSelectionSense;n.createCountingSense=G().createCountingSense;n.bindCountingSense=G().bindCountingSense;n.ctlSel=G().sel;g.programme=n;g.sousProgramme=F;g.fx=j;g.fx_s=y;g.createFxContext=H;g.ctlSeq=D;g.sequence=D;g.sequence.ajouter=g.sequence.addFx;g.sequence.fin=g.sequence.toFx;g.scripte=v;g.exemple=o;g.ctlGen=d;g.codePublic=E;g.codeSource=r;g.libPublic=u;g.libSource=h;g.menu=c;g.pause=m;g.interrupt=L;g.boutonDePause=a;g.bouton=z;g.tortue=B;g.grille=J;g.program=g.programme;g.subProgram=g.sousProgramme;g.sequence.add=g.sequence.addFx;g.sequence.end=g.sequence.toFx;g.script=g.scripte;g.example=g.exemple;g.buttonPause=g.boutonDePause;g.button=g.bouton;g.turtle=g.tortue;g.grid=g.grille;if(I.publishNcdEtpFxToWncd===undefined){I.publishNcdEtpFxToWncd=function(M,N){if(I.publishNcdEtpToWncd){I.publishNcdEtpToWncd(M,N)}N.div=M.program.div;N.currentDiv=M.program.currentDiv}}if(!q.wncd){q.wncd={}}if(I.publishNcdEtpFxToWncd){I.publishNcdEtpFxToWncd(g,q.wncd)}if(I.publishNcdEtpToWindow){I.publishNcdEtpToWindow(g,q)}if(I.ncdEtpFxReady===undefined){I.ncdEtpFxReady=function(M){var N=l("#footer");if(N.length>0){N.append("<span><i>, Wigii NCD Fx loaded</i></span>")}}}if(I.ncdEtpFxReady){I.ncdEtpFxReady(g)}})(window,jQuery,wigiiNcd,wigiiNcdEtp);if(!wncd.externals){wncd.externals={};
/*!
 * Prism 1.9.0: Lightweight, robust, elegant syntax highlighting (http://prismjs.com)
 * @author Lea Verou http://lea.verou.me
 * @license MIT license http://www.opensource.org/licenses/mit-license.php/
 * Packaged Prism library as a wncd external library by camille@wigii.org on 12.12.2017
 */
}wncd.externals.Prism=(function(a){var e=/\blang(?:uage)?-(\w+)\b/i;var g=0;var d=a.Prism={manual:true,disableWorkerMessageHandler:a.Prism&&a.Prism.disableWorkerMessageHandler,util:{encode:function(h){if(h instanceof f){return new f(h.type,d.util.encode(h.content),h.alias)}else{if(d.util.type(h)==="Array"){return h.map(d.util.encode)}else{return h.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/\u00a0/g," ")}}},type:function(h){return Object.prototype.toString.call(h).match(/\[object (\w+)\]/)[1]},objId:function(h){if(!h.__id){Object.defineProperty(h,"__id",{value:++g})}return h.__id},clone:function(k){var j=d.util.type(k);switch(j){case"Object":var l={};for(var h in k){if(k.hasOwnProperty(h)){l[h]=d.util.clone(k[h])}}return l;case"Array":return k.map(function(m){return d.util.clone(m)})}return k}},languages:{extend:function(l,h){var k=d.util.clone(d.languages[l]);for(var j in h){k[j]=h[j]}return k},insertBefore:function(h,q,o,k){k=k||d.languages;var j=k[h];if(arguments.length==2){o=arguments[1];for(var n in o){if(o.hasOwnProperty(n)){j[n]=o[n]}}return j}var l={};for(var m in j){if(j.hasOwnProperty(m)){if(m==q){for(var n in o){if(o.hasOwnProperty(n)){l[n]=o[n]}}}l[m]=j[m]}}d.languages.DFS(d.languages,function(r,s){if(s===k[h]&&r!=h){this[r]=l}});return k[h]=l},DFS:function(l,m,k,h){h=h||{};for(var j in l){if(l.hasOwnProperty(j)){m.call(l,j,l[j],k||j);if(d.util.type(l[j])==="Object"&&!h[d.util.objId(l[j])]){h[d.util.objId(l[j])]=true;d.languages.DFS(l[j],m,null,h)}else{if(d.util.type(l[j])==="Array"&&!h[d.util.objId(l[j])]){h[d.util.objId(l[j])]=true;d.languages.DFS(l[j],m,j,h)}}}}}},plugins:{},highlightAll:function(h,j){d.highlightAllUnder(document,h,j)},highlightAllUnder:function(h,m,o){var l={callback:o,selector:'code[class*="language-"], [class*="language-"] code, code[class*="lang-"], [class*="lang-"] code'};d.hooks.run("before-highlightall",l);var n=l.elements||h.querySelectorAll(l.selector);for(var k=0,j;j=n[k++];){d.highlightElement(j,m===true,l.callback)}},highlightElement:function(n,l,r){var m,h,q=n;while(q&&!e.test(q.className)){q=q.parentNode}if(q){m=(q.className.match(e)||[,""])[1].toLowerCase();h=d.languages[m]}n.className=n.className.replace(e,"").replace(/\s+/g," ")+" language-"+m;if(n.parentNode){q=n.parentNode;if(/pre/i.test(q.nodeName)){q.className=q.className.replace(e,"").replace(/\s+/g," ")+" language-"+m}}var j=n.textContent;var o={element:n,language:m,grammar:h,code:j};d.hooks.run("before-sanity-check",o);if(!o.code||!o.grammar){if(o.code){d.hooks.run("before-highlight",o);o.element.textContent=o.code;d.hooks.run("after-highlight",o)}d.hooks.run("complete",o);return}d.hooks.run("before-highlight",o);if(l&&a.Worker){var k=new Worker(d.filename);k.onmessage=function(s){o.highlightedCode=s.data;d.hooks.run("before-insert",o);o.element.innerHTML=o.highlightedCode;r&&r.call(o.element);d.hooks.run("after-highlight",o);d.hooks.run("complete",o)};k.postMessage(JSON.stringify({language:o.language,code:o.code,immediateClose:true}))}else{o.highlightedCode=d.highlight(o.code,o.grammar,o.language);d.hooks.run("before-insert",o);o.element.innerHTML=o.highlightedCode;r&&r.call(n);d.hooks.run("after-highlight",o);d.hooks.run("complete",o)}},highlight:function(k,h,l){var j=d.tokenize(k,h);return f.stringify(d.util.encode(j),l)},matchGrammar:function(y,H,N,t,Q,D,P){var B=d.Token;for(var v in N){if(!N.hasOwnProperty(v)||!N[v]){continue}if(v==P){return}var h=N[v];h=(d.util.type(h)==="Array")?h:[h];for(var I=0;I<h.length;++I){var M=h[I],O=M.inside,K=!!M.lookbehind,u=!!M.greedy,o=0,A=M.alias;if(u&&!M.pattern.global){var s=M.pattern.toString().match(/[imuy]*$/)[0];M.pattern=RegExp(M.pattern.source,s+"g")}M=M.pattern||M;for(var J=t,r=Q;J<H.length;r+=H[J].length,++J){var E=H[J];if(H.length>y.length){return}if(E instanceof B){continue}M.lastIndex=0;var w=M.exec(E),q=1;if(!w&&u&&J!=H.length-1){M.lastIndex=r;w=M.exec(y);if(!w){break}var G=w.index+(K?w[1].length:0),m=w.index+w[0].length,F=J,C=r;for(var L=H.length;F<L&&(C<m||(!H[F].type&&!H[F-1].greedy));++F){C+=H[F].length;if(G>=C){++J;r=C}}if(H[J] instanceof B||H[F-1].greedy){continue}q=F-J;E=y.slice(r,C);w.index-=r}if(!w){if(D){break}continue}if(K){o=w[1].length}var G=w.index+o,w=w[0].slice(o),m=G+w.length,x=E.slice(0,G),n=E.slice(m);var l=[J,q];if(x){++J;r+=x.length;l.push(x)}var z=new B(v,O?d.tokenize(w,O):w,A,w,u);l.push(z);if(n){l.push(n)}Array.prototype.splice.apply(H,l);if(q!=1){d.matchGrammar(y,H,N,J,r,true,v)}if(D){break}}}}},tokenize:function(l,h,n){var m=[l];var k=h.rest;if(k){for(var j in k){h[j]=k[j]}delete h.rest}d.matchGrammar(l,m,h,0,0,false);return m},hooks:{all:{},add:function(j,k){var h=d.hooks.all;h[j]=h[j]||[];h[j].push(k)},run:function(h,k){var l=d.hooks.all[h];if(!l||!l.length){return}for(var j=0,m;m=l[j++];){m(k)}}}};var f=d.Token=function(k,l,h,j,m){this.type=k;this.content=l;this.alias=h;this.length=(j||"").length|0;this.greedy=!!m};f.stringify=function(m,n,l){if(typeof m=="string"){return m}if(d.util.type(m)==="Array"){return m.map(function(o){return f.stringify(o,n,m)}).join("")}var k={type:m.type,content:f.stringify(m.content,n,l),tag:"span",classes:["token",m.type],attributes:{},language:n,parent:l};if(m.alias){var h=d.util.type(m.alias)==="Array"?m.alias:[m.alias];Array.prototype.push.apply(k.classes,h)}d.hooks.run("wrap",k);var j=Object.keys(k.attributes).map(function(o){return o+'="'+(k.attributes[o]||"").replace(/"/g,"&quot;")+'"'}).join(" ");return"<"+k.tag+' class="'+k.classes.join(" ")+'"'+(j?" "+j:"")+">"+k.content+"</"+k.tag+">"};if(!a.document){if(!a.addEventListener){return a.Prism}if(!d.disableWorkerMessageHandler){a.addEventListener("message",function(h){var l=JSON.parse(h.data),m=l.language,k=l.code,j=l.immediateClose;a.postMessage(d.highlight(k,d.languages[m],m));if(j){a.close()}},false)}return a.Prism}var c=document.currentScript||[].slice.call(document.getElementsByTagName("script")).pop();if(c){d.filename=c.src;if(!d.manual&&!c.hasAttribute("data-manual")){if(document.readyState!=="loading"){if(window.requestAnimationFrame){window.requestAnimationFrame(d.highlightAll)}else{window.setTimeout(d.highlightAll,16)}}else{document.addEventListener("DOMContentLoaded",d.highlightAll)}}}return a.Prism})(wncd.externals);wncd.externals.Prism.languages.markup={comment:/<!--[\s\S]*?-->/,prolog:/<\?[\s\S]+?\?>/,doctype:/<!DOCTYPE[\s\S]+?>/i,cdata:/<!\[CDATA\[[\s\S]*?]]>/i,tag:{pattern:/<\/?(?!\d)[^\s>\/=$<]+(?:\s+[^\s>\/=]+(?:=(?:("|')(?:\\[\s\S]|(?!\1)[^\\])*\1|[^\s'">=]+))?)*\s*\/?>/i,inside:{tag:{pattern:/^<\/?[^\s>\/]+/i,inside:{punctuation:/^<\/?/,namespace:/^[^\s>\/:]+:/}},"attr-value":{pattern:/=(?:("|')(?:\\[\s\S]|(?!\1)[^\\])*\1|[^\s'">=]+)/i,inside:{punctuation:[/^=/,{pattern:/(^|[^\\])["']/,lookbehind:true}]}},punctuation:/\/?>/,"attr-name":{pattern:/[^\s>\/]+/,inside:{namespace:/^[^\s>\/:]+:/}}}},entity:/&#?[\da-z]{1,8};/i};wncd.externals.Prism.languages.markup.tag.inside["attr-value"].inside.entity=wncd.externals.Prism.languages.markup.entity;wncd.externals.Prism.hooks.add("wrap",function(a){if(a.type==="entity"){a.attributes.title=a.content.replace(/&amp;/,"&")}});wncd.externals.Prism.languages.xml=wncd.externals.Prism.languages.markup;wncd.externals.Prism.languages.html=wncd.externals.Prism.languages.markup;wncd.externals.Prism.languages.mathml=wncd.externals.Prism.languages.markup;wncd.externals.Prism.languages.svg=wncd.externals.Prism.languages.markup;wncd.externals.Prism.languages.css={comment:/\/\*[\s\S]*?\*\//,atrule:{pattern:/@[\w-]+?.*?(?:;|(?=\s*\{))/i,inside:{rule:/@[\w-]+/}},url:/url\((?:(["'])(?:\\(?:\r\n|[\s\S])|(?!\1)[^\\\r\n])*\1|.*?)\)/i,selector:/[^{}\s][^{};]*?(?=\s*\{)/,string:{pattern:/("|')(?:\\(?:\r\n|[\s\S])|(?!\1)[^\\\r\n])*\1/,greedy:true},property:/[-_a-z\xA0-\uFFFF][-\w\xA0-\uFFFF]*(?=\s*:)/i,important:/\B!important\b/i,"function":/[-a-z0-9]+(?=\()/i,punctuation:/[(){};:]/};wncd.externals.Prism.languages.css.atrule.inside.rest=wncd.externals.Prism.util.clone(wncd.externals.Prism.languages.css);if(wncd.externals.Prism.languages.markup){wncd.externals.Prism.languages.insertBefore("markup","tag",{style:{pattern:/(<style[\s\S]*?>)[\s\S]*?(?=<\/style>)/i,lookbehind:true,inside:wncd.externals.Prism.languages.css,alias:"language-css",greedy:true}});wncd.externals.Prism.languages.insertBefore("inside","attr-value",{"style-attr":{pattern:/\s*style=("|')(?:\\[\s\S]|(?!\1)[^\\])*\1/i,inside:{"attr-name":{pattern:/^\s*style/i,inside:wncd.externals.Prism.languages.markup.tag.inside},punctuation:/^\s*=\s*['"]|['"]\s*$/,"attr-value":{pattern:/.+/i,inside:wncd.externals.Prism.languages.css}},alias:"language-css"}},wncd.externals.Prism.languages.markup.tag)}wncd.externals.Prism.languages.clike={comment:[{pattern:/(^|[^\\])\/\*[\s\S]*?(?:\*\/|$)/,lookbehind:true},{pattern:/(^|[^\\:])\/\/.*/,lookbehind:true}],string:{pattern:/(["'])(?:\\(?:\r\n|[\s\S])|(?!\1)[^\\\r\n])*\1/,greedy:true},"class-name":{pattern:/((?:\b(?:class|interface|extends|implements|trait|instanceof|new)\s+)|(?:catch\s+\())[\w.\\]+/i,lookbehind:true,inside:{punctuation:/[.\\]/}},keyword:/\b(?:if|else|while|do|for|return|in|instanceof|function|new|try|throw|catch|finally|null|break|continue)\b/,"boolean":/\b(?:true|false)\b/,"function":/[a-z0-9_]+(?=\()/i,number:/\b-?(?:0x[\da-f]+|\d*\.?\d+(?:e[+-]?\d+)?)\b/i,operator:/--?|\+\+?|!=?=?|<=?|>=?|==?=?|&&?|\|\|?|\?|\*|\/|~|\^|%/,punctuation:/[{}[\];(),.:]/};wncd.externals.Prism.languages.javascript=wncd.externals.Prism.languages.extend("clike",{keyword:/\b(?:as|async|await|break|case|catch|class|const|continue|debugger|default|delete|do|else|enum|export|extends|finally|for|from|function|get|if|implements|import|in|instanceof|interface|let|new|null|of|package|private|protected|public|return|set|static|super|switch|this|throw|try|typeof|var|void|while|with|yield)\b/,number:/\b-?(?:0[xX][\dA-Fa-f]+|0[bB][01]+|0[oO][0-7]+|\d*\.?\d+(?:[Ee][+-]?\d+)?|NaN|Infinity)\b/,"function":/[_$a-z\xA0-\uFFFF][$\w\xA0-\uFFFF]*(?=\s*\()/i,operator:/-[-=]?|\+[+=]?|!=?=?|<<?=?|>>?>?=?|=(?:==?|>)?|&[&=]?|\|[|=]?|\*\*?=?|\/=?|~|\^=?|%=?|\?|\.{3}/});wncd.externals.Prism.languages.insertBefore("javascript","keyword",{regex:{pattern:/(^|[^/])\/(?!\/)(\[[^\]\r\n]+]|\\.|[^/\\\[\r\n])+\/[gimyu]{0,5}(?=\s*($|[\r\n,.;})]))/,lookbehind:true,greedy:true},"function-variable":{pattern:/[_$a-z\xA0-\uFFFF][$\w\xA0-\uFFFF]*(?=\s*=\s*(?:function\b|(?:\([^()]*\)|[_$a-z\xA0-\uFFFF][$\w\xA0-\uFFFF]*)\s*=>))/i,alias:"function"}});wncd.externals.Prism.languages.insertBefore("javascript","string",{"template-string":{pattern:/`(?:\\[\s\S]|[^\\`])*`/,greedy:true,inside:{interpolation:{pattern:/\$\{[^}]+\}/,inside:{"interpolation-punctuation":{pattern:/^\$\{|\}$/,alias:"punctuation"},rest:wncd.externals.Prism.languages.javascript}},string:/[\s\S]+/}}});if(wncd.externals.Prism.languages.markup){wncd.externals.Prism.languages.insertBefore("markup","tag",{script:{pattern:/(<script[\s\S]*?>)[\s\S]*?(?=<\/script>)/i,lookbehind:true,inside:wncd.externals.Prism.languages.javascript,alias:"language-javascript",greedy:true}})}wncd.externals.Prism.languages.js=wncd.externals.Prism.languages.javascript;
/*! END OF PRISM http://prismjs.com */
/*!
  * Wigii Natural Code Development (NCD) standard library
  * Created by Camille Weber (camille@wigii.org), 15.11.2017
  */
wncd.comment(function(){},wncd.ObjectDoc=function(d,c){var a=this;a.className="ObjectDoc";a.instantiationTime=Date.now();a.ctxKey=wncd.ctxKey+"_"+a.className+a.instantiationTime;a.options=c||{};a.context={stack:[],docModel:{libs:{},members:{}}};a.impl={};if(!a.options.noOutput){if(!a.options.docOutput){a.options.docOutput=wncd.currentDiv()}else{if($.type(a.options.docOutput)==="string"||a.options.docOutput.className!="HtmlEmitter"){a.options.docOutput=wncd.html(a.options.docOutput)}}a.$=function(){return a.options.docOutput.$()}}if(a.options.expandLevel===undefined){a.options.expandLevel=1}if(!a.options.nullEmitter){a.options.nullEmitter=wncd.div("nullEmitter")}if(!a.options.privateValues){a.options.privateValues={}}a.options.privateValues.id=true;a.options.privateValues.ctxKey=true;a.options.privateValues.instantiationTime=true;a.options.privateValues.className=true;a.options.privateValues.$=true;a.options.privateValues.wncdAttr=true;if(a.options.privateValues.context===undefined){a.options.privateValues.context=true}if(a.options.privateValues.impl===undefined){a.options.privateValues.impl=true}if(a.options.privateValues.options===undefined){a.options.privateValues.options=true}if(!a.options.onMemberCreation){a.options.onMemberCreation=function(j,h,f,g,e){if(!f.noOutput){f.renderMember(j,h,f,g,e)}}}if(!a.options.renderMember){a.options.renderMember=function(l,k,f,g,e){var j=k.context.docOutput;if(!j){j=f.docOutput}j=j.div(l.uri,"method");if(l.context.expandable){j.out("+","methodExpand")}if(l.modelType==="Class"){j.out("class","classKeyword keyword")}else{if(l.modelType==="Function"){j.out("function","functionKeyword keyword")}}j.htmlBuilder().tag("a","class","methodName selfLink","href","#"+l.uri).out(l.name,"methodName").$tag("a").emit();if(l.context.args){j.out(" ").out(l.context.args);if(l.context.srcCode&&!l.context.expandable){j.out("+","methodSrcExpand");wncd.bindSelectionSense(j.$().find("span.methodSrcExpand"),function(m){if(m.selected()){j.$().find("div.methodSrc").show()}else{j.$().find("div.methodSrc").hide()}})}else{if(l.context.srcCode&&l.modelType==="Class"){j.out("+","classSrcExpand");wncd.bindSelectionSense(j.$().find("span.classSrcExpand"),function(m){if(m.selected()){j.$().find("div.classSrc").show()}else{j.$().find("div.classSrc").hide()}})}}}else{if((l.context.objectType==="number"||l.context.objectType==="string")&&!f.privateValues[l.name]&&l.context.object){j.out(":","typeAssignement").out(l.context.object,"scalarValue")}else{if(l.context.object===f.nullEmitter){j.out(":","typeAssignement").out("undefined","keyword")}else{j.out(":","typeAssignement").out(l.context.objectType,"keyword")}}}j.out(" ","methodEnd");if(l.context.srcCode&&l.modelType==="Class"){j.htmlBuilder().tag("div","class","classSrc").insert(f.renderClassSrc,l.context.srcCode,l.context.comment).$tag("div").emit()}if(l.context.expandable){var h=wncd.bindSelectionSense(j.$().find("span.methodExpand"),function(m){if(m.selected()){if(l.context.expand){l.context.expand()}j.$().find("div.methodMembers").show()}else{j.$().find("div.methodMembers").hide()}});j.htmlBuilder().tag("div","class","methodMembers").$tag("div").emit();l.context.docOutput=j.clone(j.$().find("div.methodMembers"));if(e<f.expandLevel){h.selected(true)}l.context.selectionSense=h}else{if(l.context.srcCode){j.htmlBuilder().tag("div","class","methodSrc").insert(f.renderMemberSrc,l.context.srcCode,l.context.comment).$tag("div").emit()}}}}if(!a.options.renderMemberSrc){a.options.renderMemberSrc=function(f,g){var e=wncd.externals.Prism;f=a.impl.normalizeSrcIndentation(f);f=(g?a.impl.normalizeCommentIndentation(g)+"\n":"")+f;wncd.currentDiv().htmlBuilder().tag("pre").tag("code","class","language-js").put(e.highlight(f,e.languages.js)).$tag("code").$tag("pre").emit()}}if(!a.options.renderClassSrc){a.options.renderClassSrc=function(f,g){var e=wncd.externals.Prism;f=a.impl.normalizeSrcIndentation(f);f=(g?a.impl.normalizeCommentIndentation(g)+"\n":"")+f;wncd.currentDiv().htmlBuilder().tag("pre").tag("code","class","language-js").put(e.highlight(f,e.languages.js)).$tag("code").$tag("pre").emit()}}a.impl.qualifier2uri=function(h,g,e){var f="";if(h){f+=h.replace(".","__")}if(g){if(f){f+="__"}f+=g}if(e){if(f){f+="__"}f+=e}return f.replace("$","S")};a.impl.buildQualifiedName=function(h,g,e){var f="";if(h){f+=h}if(g){if(f){f+="."}f+=g}if(e){if(f){f+="."}f+=e}return f};a.impl.extractClassMemberComments=function(e){var f={};var h=/(\/\*\*([^*]|[\r\n]|(\*+([^*\/]|[\r\n])))*\*+\/)[}]?[,]?\s*([\w]+)[.]([\w.]+)\s*=/g;var g=undefined;while((g=h.exec(e))!==null){f[g[6]]=g[1];f.className=g[5]}return f};a.impl.createObjModel=function(h,g,e){var f={};if(h){f.namespace=h}if(g){f.className=g}if(e){f.name=e}f.uri=a.impl.qualifier2uri(h,g,e);f.qualifiedName=a.impl.buildQualifiedName(h,g,e);f.context={};return f};a.impl.initClassModel=function(e){e.vars={};e.methods={};e.innerClasses={};e.modelType="Class";e.parent=undefined};a.impl.initFunctionModel=function(e){e.args=[];e.returnType=undefined;e.attributes={};e.modelType="Function";e.parent=undefined};a.impl.initVariableModel=function(e){e.type=undefined;e.value=undefined;e.attributes={};e.modelType="Variable";e.parent=undefined};a.impl.initLibModel=function(e){e.members={};e.modelType="Lib"};a.impl.normalizeSrcIndentation=function(j){var f=/[\n\r]([\t ]*)}$/g;var h=f.exec(j);var e=(h?h[1]:"");var g=e+j;if(e.length>0){f=new RegExp("^\\s{0,"+(e.length+1)+"}","gm");g=g.replace(f,"")}return g};a.impl.normalizeCommentIndentation=function(j){var f=/[\n\r]([\t ]*)\*\/$/g;var h=f.exec(j);var e=(h?h[1]:"");var g=e.substr(1)+j;if(e.length>0){f=new RegExp("^\\s{0,"+(e.length)+"}","gm");g=g.replace(f,"")}return g};a.impl.visitObj=function(k,n,f,m){var e=f.stack[m-1];var g=[];for(var l in k){var j=a.impl.createObjModel(e.namespace,(e.modelType==="Class"?e.name:e.className),l);j.context.object=k[l];g.push(j)}if(!n.noSorting){g.sort(function(q,o){if(q.name<o.name){return -1}else{if(q.name>o.name){return 1}else{return 0}}})}if(n.expandLevel>0){for(var h=0;h<g.length;h++){var j=g[h];a.impl.visitObjMember(j,n,f,m)}}a.context.stack.pop()};a.impl.visitObjMember=function(n,v,h,s){var g=h.stack[s-1];var f=$.type(n.context.object);var k=undefined;var o=undefined;var e=false;var j=false;var r=undefined;var q=undefined;if(f==="function"){k=wncd.obj2FxString(n.context.object);o=k.match(/^function\s*(\([^\(\)]*\))/);if(o){o=o[1]}j=/^function\s*\([^\(\)]*\)\s*\{\s*var\s*self\s*=\s*this;/.test(k);r=a.impl.extractClassMemberComments(k);if(n.context.object.wncdAttr&&n.context.object.wncdAttr.comment){q=n.context.object.wncdAttr.comment}if(j){var m={};var l=Array(n.context.object.length).fill(v.nullEmitter);var u=wncd.currentDiv();try{wncd.program.context.html(v.nullEmitter);n.context.object.apply(m,l);wncd.program.context.html(u);v.nullEmitter.reset()}catch(t){wncd.program.context.html(u)}if(!m.className){m.className=n.name}n.context.object=m;e=(Object.keys(n.context.object).length>0)}else{e=(Object.keys(n.context.object).length>(q?1:0))}}else{if(f==="object"&&n.context.object!==v.nullEmitter){e=(Object.keys(n.context.object).length>0)}}if(j){a.impl.initClassModel(n);n.context.srcCode=k;n.context.args=o;n.context.classMemberComments=r}else{if(f==="function"){a.impl.initFunctionModel(n);n.context.srcCode=k;n.context.args=o}else{a.impl.initVariableModel(n);n.context.objectType=f}}n.context.expandable=e;if(q){n.context.comment=q}else{if(g.context.classMemberComments){n.context.comment=g.context.classMemberComments[n.name]}}if(v.privateValues[n.name]){n.context.expandable=false}if(g.modelType==="Lib"){g.members[n.name]=n}else{if(g.modelType==="Class"){if(n.modelType==="Variable"){g.vars[n.name]=n}else{if(n.modelType==="Function"){g.methods[n.name]=n}else{if(n.modelType==="Class"){n.namespace=g.qualifiedName;n.qualifiedName=a.impl.buildQualifiedName(n.namespace,n.name);n.uri=a.impl.qualifier2uri(g.uri,n.name);g.innerClasses[n.name]=n}}}}else{if(g.modelType==="Function"){n.namespace=g.qualifiedName;n.qualifiedName=a.impl.buildQualifiedName(n.namespace,n.name);n.uri=a.impl.qualifier2uri(g.uri,n.name);g.attributes[n.name]=n}else{if(g.modelType==="Variable"){n.namespace=g.qualifiedName;n.qualifiedName=a.impl.buildQualifiedName(n.namespace,n.name);n.uri=a.impl.qualifier2uri(g.uri,n.name);g.attributes[n.name]=n}}}}h.docModel.members[n.qualifiedName]=n;n.parent=g;if(n.context.expandable){n.context.expand=function(){n.context.expand=undefined;h.stack.push(n);a.impl.visitObj(n.context.object,v,h,h.stack.length)}}if(v.onMemberCreation){v.onMemberCreation(n,g,v,h,s)}if(s<v.expandLevel&&n.context.expand){n.context.expand()}};a.buildDocModel=function(g,f,e){if(g){var h=a.impl.createObjModel(f,undefined,e);if(e){a.impl.initClassModel(h)}else{a.impl.initLibModel(h)}a.context.stack.push(h);a.impl.visitObj(g,a.options,a.context,1);if(h.modelType==="Lib"){a.context.docModel.libs[h.namespace]=h}a.context.docModel.members[h.qualifiedName]=h}return a.context.docModel};a.buildDocModel(d,a.options.namespace,a.options.className)});wncd.comment(function(){},wncd.createObjectDoc=function(c,a){return new wncd.ObjectDoc(c,a)});wncd.comment(function(){},wncd.ObjectDocBrowser=function(a,d){var c=this;c.className="ObjectDocBrowser";c.instantiationTime=Date.now();c.ctxKey=wncd.ctxKey+"_"+c.className+c.instantiationTime;c.options=d||{};c.context={articles:undefined,articlesIndex:{},currentArticle:undefined};c.impl={onCloseArticleSubscribers:[],onActivateArticleSubscribers:[]};c.$=function(){return $("#"+c.ctxKey)};if(!c.options.title){c.options.title=wncd.getHtmlBuilder().tag("p","class","title").out("Wigii ").tag("span","style","color:#3333ff").out("NCD").$tag("span").out(" Documentation reference").$tag("p").html()}if(!c.options.searchButtonLabel){c.options.searchButtonLabel="&#128270;"}if(!c.options.libInstance){c.options.libInstance=wncd;c.options.libNamespace="wncd"}if(!c.options.libNamespace){c.options.libNamespace="Library Doc"}if(!c.options.label){c.options.label="&#128214; "+c.options.libNamespace}if(!c.options.renderSearchBar){c.options.renderSearchBar=function(e){c.context.searchBar=wncd.currentDiv().reset().display(undefined,undefined,"searchBar");c.context.searchBar.$().on("change",function(){c.expandToMember($(this).val())})}}if(!c.options.renderBrowserPanel){c.options.renderBrowserPanel=function(e){wncd.currentDiv().reset().layout(function(k,o,j,g,f,t,s,q,n,m,l,r){return k(j(function(){if(c.context.articles){c.context.articlesIndex={};c.context.currentArticle=undefined;c.context.articles=undefined}}).cssClass("docBrowserToolbar"),r(function(){wncd.currentDiv().div(c.options.libNamespace,"method").color("#3333FF").out(c.options.libNamespace).$color();c.context.wncdDoc=wncd.createObjectDoc(c.options.libInstance,{docOutput:wncd.currentDiv().div(c.options.libNamespace),expandLevel:5,noSorting:true,namespace:c.options.libNamespace,privateValues:{}});c.collapseAll();c.context.searchBar.autocomplete(Object.keys(c.context.wncdDoc.context.docModel.members)).$().focus()}).cssClass("docBrowser")).width("100%").height("100%").id(c.ctxKey)})}}if(!c.options.renderFooterBar){c.options.renderFooterBar=function(e){wncd.currentDiv().reset().out("Natural Code Development, Wigii.org (CWE), 10.01.2018");if(e.context.startupLog){wncd.currentDiv().out(", ").out(e.context.startupLog)}}}c.collapseAll=function(){if(c.context.wncdDoc){var g=c.context.wncdDoc.context.docModel.libs[c.options.libNamespace].members;for(var f in g){var e=g[f].context.selectionSense;if(e&&e.selected()){e.onClick()}}c.$().find("> div.docBrowser").scrollTop(0)}};c.expandToMember=function(g){if(!c.context.wncdDoc){return}var h=c.context.wncdDoc.context.docModel.members[g];if(!h){return}var e=h;while(e){if(e.context.selectionSense&&!e.context.selectionSense.selected()){e.context.selectionSense.onClick()}e=e.parent}var f=c.$().find("> div.docBrowser");f.scrollTop(0).scrollTop($("#"+h.uri).offset().top-f.offset().top)};c.addArticle=function(e){if(!c.context.articles){c.context.articles=c.$().find("> div.docBrowserToolbar").wncd("html").list(function(g,f){},function(f,h,g){return h.label||h.key},{maxSelection:1,onItemClick:function(f,j,g,h){if(g){c.activateArticle(j.key)}else{c.closeCurrentArticle()}}})}c.context.articles.add(e);c.context.articlesIndex[e.key]=c.context.articles.size();return c};c.activateArticle=function(f){if(!f){throw wncd.createServiceException("key cannot be null",wncd.errorCodes.INVALID_ARGUMENT)}var e=c.context.articlesIndex[f];if(!e){throw wncd.createServiceException("no article found under key "+f,wncd.errorCodes.INVALID_ARGUMENT)}if(!c.context.articles.selected(e)){c.context.articles.selected(e,true)}var g=c.context.articles.items()[e-1];if(c.context.currentArticle){c.onCloseArticle()}c.context.currentArticle=g;c.onActivateArticle();c.impl.renderArticle(g);return g};c.impl.renderArticle=function(e){wncd.program.context.html(c.$().find("> div.docBrowser").wncd("html").reset());wncd.program(e.content)};c.closeCurrentArticle=function(){c.activateArticle(c.ctxKey)};c.onCloseArticle=function(g){if($.isFunction(g)){c.impl.onCloseArticleSubscribers.push(g)}else{if(g===undefined){for(var e=0;e<c.impl.onCloseArticleSubscribers.length;e++){var f=c.impl.onCloseArticleSubscribers[e];if($.isFunction(f)){f(c.context.currentArticle,c)}}}}return c};c.onActivateArticle=function(f){if($.isFunction(f)){c.impl.onActivateArticleSubscribers.push(f)}else{if(f===undefined){for(var e=0;e<c.impl.onActivateArticleSubscribers.length;e++){var g=c.impl.onActivateArticleSubscribers[e];if($.isFunction(g)){g(c.context.currentArticle,c)}}}}return c};if($.type(a)!=="object"||a.className!="Desktop"){throw wncd.createServiceException("container should be a non null instance of wncd.Desktop",wncd.errorCodes.INVALID_ARGUMENT)}c.options.obj=c;a.registerComponent(c.ctxKey,c.options.renderSearchBar,c.options.renderBrowserPanel,c.options.renderFooterBar,c.options)});wncd.comment(function(){},wncd.ContextualMenu=function(d,e,c){var a=this;a.className="ContextualMenu";a.instantiationTime=Date.now();a.ctxKey=wncd.ctxKey+"_"+a.className+a.instantiationTime;a.options=c||{};a.context={isVisible:false,rootMenu:a,openMenu:undefined};a.impl={};a.impl.SubMenu=function(j,h,k,g){var f=this;f.className="SubMenu";f.instantiationTime=Date.now();f.ctxKey=wncd.ctxKey+"_"+f.className+f.instantiationTime;f.options=Object.assign({},j.options,g);f.context={isVisible:false,rootMenu:j.context.rootMenu,openMenu:undefined,parent:j,label:h};f.impl={};f.impl.createSubMenu=function(m,n,l){return new f.context.rootMenu.impl.SubMenu(f,m,n,l)};if($.isFunction(k)){f.impl.compose=function(o,m){var l=k(o,f.impl.createSubMenu,m);if($.type(l)==="object"&&l.className=="SubMenu"){l.ctxKey+=o;l.context.itemNumber=o+1}return l}}else{if($.isArray(k)){f.impl.compose=function(o,m){if(o<k.length){var l=k[o];if($.type(l)==="object"&&l[f.options.subMenuField]){l=f.impl.createSubMenu(l[f.options.labelField],l[f.options.subMenuField],f.options);l.ctxKey+=o;l.context.itemNumber=o+1}return l}}}else{throw wncd.createServiceException("compose should be an array or a function",wncd.errorCodes.INVALID_ARGUMENT)}}f.$=function(){return $("#"+f.ctxKey)};f.show=function(){if(!f.context.list){f.context.list=wncd.html(f.$()).list(f.impl.compose,f.options.render,f.options);f.context.list.context.menu=f;f.options.top=f.$().prev().position().top;f.options.positionMenu(f.context.parent,f.options);f.$().css("top",f.options.top).css("left",f.options.left)}if(!f.context.isVisible){f.$().show();f.context.isVisible=true}};f.hide=function(l){if(f.context.isVisible){if(f.context.openMenu){f.context.openMenu.hide();f.context.openMenu=undefined}f.$().hide();f.context.isVisible=false;if(l&&f.context.parent){f.context.parent.hide(l)}}};f.toggle=function(){if(f.context.isVisible){f.hide()}else{f.show()}}};a.impl.createSubMenu=function(g,h,f){return new a.impl.SubMenu(a,g,h,f)};if(!a.options.labelField){a.options.labelField="label"}if(!a.options.subMenuField){a.options.subMenuField="subMenu"}if($.isFunction(e)){a.impl.compose=function(h,g){var f=e(h,a.impl.createSubMenu,g);if($.type(f)==="object"&&f.className=="SubMenu"){f.ctxKey+=h;f.context.itemNumber=h+1}return f}}else{if($.isArray(e)){a.impl.compose=function(h,g){if(h<e.length){var f=e[h];if($.type(f)==="object"&&f[a.options.subMenuField]){f=a.impl.createSubMenu(f[a.options.labelField],f[a.options.subMenuField],a.options);f.ctxKey+=h;f.context.itemNumber=h+1}return f}}}else{throw wncd.createServiceException("compose should be an array or a function",wncd.errorCodes.INVALID_ARGUMENT)}}a.options.maxSelection=1;if(!a.options.rightMenuLabel){a.options.rightMenuLabel="&#9654;"}if(!a.options.positionMenu){a.options.positionMenu=function(h,g){if(h.className=="ContextualMenu"||h.className=="SubMenu"){var j=h.$();g.left=j.width()}else{var f=h.position();g.top=f.top+(g.top?g.top:0);g.left=f.left+(g.left?g.left:0)}}}if(!a.options.buildMenuPanel){a.options.buildMenuPanel=function(h,f){var g="position:absolute;display:none;";if(f.top){g+="top:"+Math.ceil(f.top)+"px;"}if(f.left){g+="left:"+Math.ceil(f.left)+"px;"}return wncd.getHtmlBuilder().tag("div","id",h,"class","contextualMenu"+(f.cssClass?" "+f.cssClass:""),"style",g).$tag("div").html()}}if(!a.options.render){a.options.render=function(g,j,k){var f=k.options;if($.type(j)==="object"&&j.className=="SubMenu"){var h="position:absolute;display:none;";if(f.top){h+="top:"+Math.ceil(f.top)+"px;"}if(f.left){h+="left:"+Math.ceil(f.left)+"px;"}return wncd.getHtmlBuilder().tag("span","class","label").out(j.context.label).$tag("span").tag("span","class","rightMenu").out(a.options.rightMenuLabel).$tag("span").tag("div","id",j.ctxKey,"style",h).$tag("div").html()}else{if($.type(j)==="object"&&j[f.labelField]){return wncd.getHtmlBuilder().tag("span","class","label").out(j[f.labelField]).$tag("span").tag("span","class","noMenu").out("&nbsp;").$tag("span").html()}else{return wncd.getHtmlBuilder().tag("span","class","label").out(j).$tag("span").tag("span","class","noMenu").out("&nbsp;").$tag("span").html()}}}}if(a.options.onItemClick){a.impl.onItemClick=a.options.onItemClick}a.options.onItemClick=function(f,h,g,j){if($.type(h)==="object"&&h.className=="SubMenu"){if(h.context.isVisible){h.hide();j.context.menu.context.openMenu=undefined}else{if(j.context.menu.context.openMenu){j.context.menu.context.openMenu.hide()}h.show();j.context.menu.context.openMenu=h}}else{j.context.menu.hide(true);var k=j.context.menu.context.rootMenu.impl.onItemClick;if($.isFunction(k)){k(f,h,g,j)}}};a.$=function(){return $("#"+a.ctxKey)};a.show=function(){if(!a.context.isVisible){a.$().show();a.context.isVisible=true}};a.hide=function(){if(a.context.isVisible){if(a.context.openMenu){a.context.openMenu.hide();a.context.openMenu=undefined}a.$().hide();a.context.isVisible=false}};a.toggle=function(){if(a.context.isVisible){a.hide()}else{a.show()}};if(!d){throw wncd.createServiceException("anchor should point to an existing DOM element",wncd.errorCodes.INVALID_ARGUMENT)}d=$(d);d.css("position","relative");d.parent().css("position","relative").css("overflow","visible");a.options.positionMenu(d,a.options);d.after(a.options.buildMenuPanel(a.ctxKey,a.options));a.context.list=wncd.html(a.$()).list(a.impl.compose,a.options.render,a.options);a.context.list.context.menu=a;d.click(a.toggle)});wncd.comment(function(){},wncd.getJQueryService().menu=function(d,a){var c=undefined;if(d&&d.length==1){var f=undefined;var e=$.type(a);if(e==="array"||e==="function"){f=a;a=undefined}else{if(e==="object"){f=a.compose}}c=new wncd.ContextualMenu(d,f,a)}else{if(d&&d.length>1){throw wncd.createServiceException("Wigii NCD menu selector can only be activated on a JQuery collection containing one element and not "+d.length,wncd.errorCodes.INVALID_ARGUMENT)}}return(!c?{$:d}:c)});wncd.comment(function(){},wncd.Desktop=function(c){var a=this;a.className="Desktop";a.instantiationTime=Date.now();a.ctxKey=wncd.ctxKey+"_"+a.className;a.options=c||{};a.context={components:{},currentComponent:undefined};a.impl={onCloseSubscribers:[],onActivateSubscribers:[]};if(!a.options.userMenuLabel){a.options.userMenuLabel="&#9776;"}if(!a.options.label){a.options.label="&#127968;"}if(!a.options.title){a.options.title="&nbsp;"}a.options.obj=a;if(!a.options.height){a.options.height="100%"}if(!a.options.width){a.options.width="100%"}if(!a.options.logo){a.options.logo=wncd.getHtmlBuilder().tag("img","class","logo","src","https://rise.wigii.org/NCD/CMS/www/etp/logo_wigii_48.gif").$tag("img").html()}if(!a.options.htmlEmitter){a.options.htmlEmitter=wncd.currentDiv()}else{if($.type(a.options.htmlEmitter)==="string"||a.options.htmlEmitter.className!="HtmlEmitter"){a.options.htmlEmitter=wncd.html(a.options.htmlEmitter)}}if(!a.options.displayHeaderBar){a.options.displayHeaderBar=function(d){wncd.currentDiv().reset()}}if(!a.options.displayWorkzone){a.options.displayWorkzone=function(d){wncd.currentDiv().reset()}}if(!a.options.displayFooterBar){a.options.displayFooterBar=function(e){var d="";if(program.context.startupLog){if(program.context.startupLog.ncdEtpReady){d+="Wigii NCD core v."+program.context.startupLog.version}if(program.context.startupLog.ncdEtpFxReady){d+=(d?", ":"")+"Fx layer ready "+wncd.txtDate(new Date())}}a.context.startupLog=d;wncd.currentDiv().reset().out(a.context.startupLog)}}if(!a.options.displayUserMenu){a.options.displayUserMenu=function(e){a.context.userMenu=[];for(var d in a.context.components){a.context.userMenu.push(d)}wncd.currentDiv().reset().out(a.options.userMenuLabel,"userMenuButton").$().find("span.userMenuButton").wncd("menu",{compose:function(j,f,h){if(j<a.context.userMenu.length){var g=a.context.components[a.context.userMenu[j]];if(g.options&&g.options.label){g.label=g.options.label}else{g.label=g.key}return g}},onItemClick:function(g,f){a.activate(f.key)},top:5,left:20,cssClass:"userMenu"})}}if(!a.options.layoutDesktop){a.options.layoutDesktop=function(g,m,f,e,d,s,q,n,l,k,j,o,r){return m(d.h(f.h(d(a.options.logo||"&nbsp;"),e().id(r.ctxKey+"_userMenu").cssClass("userMenuContainer")),l.v(f().id(r.ctxKey+"_titleBar").cssClass("titleBar").minHeight("20px").maxHeight("40px"),d().id(r.ctxKey+"_headerBar").cssClass("headerBar").minHeight("20px"))).minHeight("100px"),o().id(r.ctxKey+"_workzone").cssClass("workzone"),f().id(r.ctxKey+"_footerBar").cssClass("footerBar").minHeight("20px").maxHeight("40px")).cssClass("desktop").width(r.options.width).height(r.options.height)}}a.registerComponent=function(f,h,e,g,d){a.context.components[f]={key:f,displayHeaderBar:h,displayWorkzone:e,displayFooterBar:g,options:d};wncd.program.context.html(a.options.userMenuEmitter);a.options.displayUserMenu(a);return a};a.add=function(e,d){var f=wncd[e];if(!$.isFunction(f)){throw wncd.createServiceException("Unsupported class "+e,wncd.errorCodes.UNSUPPORTED_OPERATION)}new f(a,d);return a};a.activate=function(e){if(!e){throw wncd.createServiceException("key cannot be null",wncd.errorCodes.INVALID_ARGUMENT)}var d=a.context.components[e];if(!d){throw wncd.createServiceException("no component registered under key "+e,wncd.errorCodes.INVALID_ARGUMENT)}if(a.context.currentComponent){a.onClose()}a.context.currentComponent=e;a.onActivate();a.options.titleBarEmitter.reset().out(d.options.title||"&nbsp;");if($.isFunction(d.displayHeaderBar)){wncd.program.context.html(a.options.headerBarEmitter);d.displayHeaderBar(a)}if($.isFunction(d.displayWorkzone)){wncd.program.context.html(a.options.workzoneEmitter);d.displayWorkzone(a)}if($.isFunction(d.displayFooterBar)){wncd.program.context.html(a.options.footerBarEmitter);d.displayFooterBar(a)}wncd.program.context.html(a.options.workzoneEmitter);return a.getComponentObject(e)};a.getComponentObject=function(e){if(!e){throw wncd.createServiceException("key cannot be null",wncd.errorCodes.INVALID_ARGUMENT)}var d=a.context.components[e];if(!d){throw wncd.createServiceException("no component registered under key "+e,wncd.errorCodes.INVALID_ARGUMENT)}if(d.options){return d.options.obj}};a.closeCurrentComponent=function(){a.activate(a.ctxKey)};a.onClose=function(f){if($.isFunction(f)){a.impl.onCloseSubscribers.push(f)}else{if(f===undefined){for(var d=0;d<a.impl.onCloseSubscribers.length;d++){var e=a.impl.onCloseSubscribers[d];if($.isFunction(e)){e(a.context.currentComponent,a)}}}}return a};a.onActivate=function(e){if($.isFunction(e)){a.impl.onActivateSubscribers.push(e)}else{if(e===undefined){for(var d=0;d<a.impl.onActivateSubscribers.length;d++){var f=a.impl.onActivateSubscribers[d];if($.isFunction(f)){f(a.context.currentComponent,a)}}}}return a};a.options.htmlEmitter.layout(a.options.layoutDesktop,a);a.options.userMenuEmitter=a.options.htmlEmitter.clone(a.options.htmlEmitter.$().find("div.desktop div#"+a.ctxKey+"_userMenu"));a.options.titleBarEmitter=a.options.htmlEmitter.clone(a.options.htmlEmitter.$().find("div.desktop div#"+a.ctxKey+"_titleBar"));a.options.headerBarEmitter=a.options.htmlEmitter.clone(a.options.htmlEmitter.$().find("div.desktop div#"+a.ctxKey+"_headerBar"));a.options.workzoneEmitter=a.options.htmlEmitter.clone(a.options.htmlEmitter.$().find("div.desktop div#"+a.ctxKey+"_workzone"));a.options.footerBarEmitter=a.options.htmlEmitter.clone(a.options.htmlEmitter.$().find("div.desktop div#"+a.ctxKey+"_footerBar"));a.registerComponent(a.ctxKey,a.options.displayHeaderBar,a.options.displayWorkzone,a.options.displayFooterBar,a.options);a.activate(a.ctxKey)});wncd.createDesktop=function(a){return new wncd.Desktop(a)};wncd.comment(function(){},wncd.SelfLearningTaskList=function(a,d){var c=this;c.className="SelfLearningTaskList";c.instantiationTime=Date.now();c.ctxKey=wncd.ctxKey+"_"+c.className+c.instantiationTime;c.options=d||{};c.context={taskCatalog:[],tasks:[],taskIndex:{}};c.impl={};c.$=function(){return $("#"+c.ctxKey)};if(!c.options.label){c.options.label="&#128203;"}if(!c.options.title){c.options.title=wncd.getHtmlBuilder().tag("p","class","title").out("&#128203;&nbsp;").out("Task List").$tag("p").html()}if(c.options.enableTimeTracking===undefined){c.options.enableTimeTracking=true}if(c.options.enableTaskAbort===undefined){c.options.enableTaskAbort=true}if(c.options.multiTasking===undefined){c.options.multiTasking=true}if(!c.options.runButtonLabel){c.options.runButtonLabel="&#9654;"}if(!c.options.pauseButtonLabel){c.options.pauseButtonLabel="&#9208;"}if(c.options.defaultOnTaskEnd===undefined){c.options.defaultOnTaskEnd=function(e,g){var f=(g=="completed"?"Completed":"Aborted");$("#task_"+e.id).addClass(g).find("span.taskLabel").append("&nbsp;"+f+(e.duration>0?"&nbsp;duration: "+(e.duration/1000)+"s":""))}}if(!c.options.renderSearchBar){c.options.renderSearchBar=function(e){c.context.searchBar=wncd.currentDiv().reset().display(undefined,undefined,"searchBar");var f=function(j){var h=$(this).val();if(c.context.tasks.length==0||c.context.tasks[c.context.tasks.length-1].label!=h){var g=c.impl.createTask(h);c.addTask(g)}};c.context.searchBar.$().on("change",f)}}if(!c.options.renderTask){c.options.renderTask=function(g,e){if(e.status!="completed"&&e.status!="aborted"){var f=wncd.currentDiv().div(c.ctxKey).htmlBuilder();f.tag("p","id","task_"+e.id,"class","task").tag("span","class","taskCompleted").out("&#10004;").$tag("span");if(c.options.enableTimeTracking){if(e.status=="running"){f.tag("span","class","taskRun").out(c.options.pauseButtonLabel).$tag("span")}else{f.tag("span","class","taskRun").out(c.options.runButtonLabel).$tag("span")}}if(c.options.enableTaskAbort){f.tag("span","class","taskAborted").out("&#10006;").$tag("span")}f.tag("span","class","taskIndex").out(g).$tag("span").tag("span","class","taskLabel").out(e.label).$tag("span").$tag("p").emit();$("#task_"+e.id+" span.taskCompleted").click(c.impl.onClickTaskCompleted);if(c.options.enableTimeTracking){$("#task_"+e.id+" span.taskRun").click(c.impl.onClickTaskRunPause)}if(c.options.enableTaskAbort){$("#task_"+e.id+" span.taskAborted").click(c.impl.onClickTaskAborted)}}}}if(!c.options.renderTaskList){c.options.renderTaskList=function(e){wncd.currentDiv().reset().div(c.ctxKey,"taskList");for(var f=0;f<c.context.tasks.length;f++){c.options.renderTask(f+1,c.context.tasks[f])}c.context.searchBar.autocomplete(c.context.taskCatalog).$().focus()}}if(!c.options.renderFooterBar){c.options.renderFooterBar=function(e){wncd.currentDiv().reset().out("Wigii.org, NCD App (CWE), 05.03.2018, Self Learning Task List");if(e.context.startupLog){wncd.currentDiv().out(", ").out(e.context.startupLog)}}}c.addTask=function(e){if(!e){throw wncd.createServiceException("task cannot be null",wncd.errorCodes.INVALID_ARGUMENT)}if(c.context.taskIndex[e.id]){throw wncd.createServiceException("task '"+e.id+"' already exists in the list",wncd.errorCodes.ALREADY_EXISTS)}var f=c.context.tasks.push(e);c.context.taskIndex[e.id]=e;if(!c.context.taskCatalog.includes(e.label)){c.context.taskCatalog.push(e.label);c.context.taskCatalog.sort()}c.options.renderTask(f,e)};c.completeTask=function(f){var e=c.context.taskIndex[f];if(!e){throw wncd.createServiceException("task '"+e.id+"' doesn't exists in the list",wncd.errorCodes.DOES_NOT_EXIST)}c.impl.taskController(e,"completed")};c.abortTask=function(f){var e=c.context.taskIndex[f];if(!e){throw wncd.createServiceException("task '"+e.id+"' doesn't exists in the list",wncd.errorCodes.DOES_NOT_EXIST)}c.impl.taskController(e,"aborted")};c.startTask=function(f){var e=c.context.taskIndex[f];if(!e){throw wncd.createServiceException("task '"+e.id+"' doesn't exists in the list",wncd.errorCodes.DOES_NOT_EXIST)}c.impl.taskController(e,"run")};c.pauseTask=function(f){var e=c.context.taskIndex[f];if(!e){throw wncd.createServiceException("task '"+e.id+"' doesn't exists in the list",wncd.errorCodes.DOES_NOT_EXIST)}c.impl.taskController(e,"pause")};c.onTaskEnd=function(e){if(!$.isFunction(e)){throw wncd.createServiceException("task end event handler should be a function",wncd.errorCodes.INVALID_ARGUMENT)}c.onTaskEndSubscribers.push(e)};c.onTaskEndSubscribers=[];c.onTaskControl=function(e){if(!$.isFunction(e)){throw wncd.createServiceException("task end event handler should be a function",wncd.errorCodes.INVALID_ARGUMENT)}c.onTaskControlSubscribers.push(e)};c.onTaskControlSubscribers=[];c.impl.createTask=function(e){return{label:e,id:Date.now(),duration:0}};c.impl.onClickTaskCompleted=function(e){var f=$(this).parent().attr("id").replace("task_","");c.impl.taskController(c.context.taskIndex[f],"completed")};c.impl.onClickTaskRunPause=function(e){var g=$(this).parent().attr("id").replace("task_","");var f=c.context.taskIndex[g];c.impl.taskController(f,(f.status=="running"?"pause":"run"))};c.impl.onClickTaskAborted=function(e){var f=$(this).parent().attr("id").replace("task_","");c.impl.taskController(c.context.taskIndex[f],"aborted")};c.impl.taskController=function(e,f){switch(e.status){case"running":if(f=="pause"){e.status="paused";c.impl.endTask(e)}else{if(f=="completed"){e.status="completed";c.impl.endTask(e)}else{if(f=="aborted"){e.status="aborted";c.impl.endTask(e)}}}break;case undefined:case"paused":if(f=="run"){if(!c.options.multiTasking&&c.context.currentTask&&c.context.currentTask.id!=e.id){c.impl.taskController(c.context.currentTask,"pause");c.context.currentTask=e}e.status="running";c.impl.startTask(e)}else{if(f=="completed"){e.status="completed";c.impl.endTask(e)}else{if(f=="aborted"){e.status="aborted";c.impl.endTask(e)}}}break;case"completed":case"aborted":break}};c.impl.startTask=function(f){var e=Date.now();if(!f.startDate){f.startDate=e}else{f.resumeDate=e}if(c.onTaskControlSubscribers.length>0){for(var g=0;g<c.onTaskControlSubscribers.length;g++){c.onTaskControlSubscribers[g](f,(f.resumeDate?"resume":"run"))}}};c.impl.endTask=function(e){var g=Date.now();if(e.resumeDate){e.duration+=(g-e.resumeDate)}else{e.duration+=(g-e.startDate)}e.endDate=g;if(c.onTaskControlSubscribers.length>0&&e.status=="paused"){for(var f=0;f<c.onTaskControlSubscribers.length;f++){c.onTaskControlSubscribers[f](e,"pause")}}else{if(c.onTaskEndSubscribers.length>0&&(e.status=="completed"||e.status=="aborted")){for(var f=0;f<c.onTaskEndSubscribers.length;f++){c.onTaskEndSubscribers[f](e,e.status)}}}};if(c.options.defaultOnTaskEnd!==false){c.onTaskEnd(c.options.defaultOnTaskEnd)}if(c.options.enableTimeTracking){c.onTaskControl(function(e,f){if(f=="pause"){$("#task_"+e.id+" span.taskRun").html(c.options.runButtonLabel)}else{$("#task_"+e.id+" span.taskRun").html(c.options.pauseButtonLabel)}})}if($.type(a)!=="object"||a.className!="Desktop"){throw wncd.createServiceException("container should be a non null instance of wncd.Desktop",wncd.errorCodes.INVALID_ARGUMENT)}c.options.obj=c;a.registerComponent(c.ctxKey,c.options.renderSearchBar,c.options.renderTaskList,c.options.renderFooterBar,c.options)});wncd.createSelfLearningTaskList=function(a,c){return new wncd.SelfLearningTaskList(a,c)};wncd.comment(function(){},wncd.AgileStoryBoard=function(a,e){var c=this;c.className="AgileStoryBoard";c.instantiationTime=Date.now();c.ctxKey=wncd.ctxKey+"_"+c.className+c.instantiationTime;c.options=e||{};c.context={storyAssignees:[],stories:[],storiesIndex:{}};c.context.container=a;c.impl={};c.$=function(){return $("#"+c.ctxKey)};if(!c.options.label){c.options.label="&#9096;"}if(!c.options.title){c.options.title=wncd.getHtmlBuilder().tag("p","class","title").out("&#9096;&nbsp;").out("Agile Story Board").$tag("p").html()}if(!c.options.storyStatuses){c.options.storyStatuses=["Pipeline","Design","Execute","Ready for release","Pre-Production","Done"]}if(!c.options.height){c.options.height="100%"}if(!c.options.width){c.options.width="100%"}if(!c.options.createStoryButtonLabel){c.options.createStoryButtonLabel="+ Story"}if(c.options.filterLabel===undefined){c.options.filterLabel="Show:"}if(!c.options.filterAllLabel){c.options.filterAllLabel="All"}if(!c.options.filterUnassignedLabel){c.options.filterUnassignedLabel="Unassigned"}if(a&&a.className=="WncdContainer"){if(!c.options.elementStatusField){c.options.elementStatusField="status"}if(!c.options.elementPositionField){c.options.elementPositionField="position"}if(!c.options.mapElement2Story){c.options.mapElement2Story=function(g,f){f.id=g.__element.id,f.assignee=g.assignee.value;f.label=g.label.value;f.description=g.description.value;f.status=g.status.value;if(g.position){f.position=g.position.value}else{f.position=0}f.date=g.__element.sys_date;f.creationDate=g.__element.sys_creationDate;f.user=g.__element.sys_user;f.username=g.__element.sys_username;f.creationUser=g.__element.sys_creationUser;f.creationUsername=g.__element.sys_creationUsername}}}if(!c.options.renderStory){c.options.renderStory=function(f,h,j){var g=f;h.out("&#9998;","storyEditButton").out("&#10006;","storyDeleteButton");if(g.options.noOrdering!=true&&j.status!="5completer"){h.out("&#11121;","storyMoveTopButton");h.out("&#129093;","storyMoveUpButton");h.out("&#129095;","storyMoveDownButton");h.out("&#11123;","storyMoveBottomButton")}h.out((j.assignee===null?g.options.filterUnassignedLabel:j.assignee),"storyAssignee");if(j.label!==null){h.out(j.label,"storyLabel")}if(j.description!==null){h.out(j.description,"storyDescription")}}}if(!c.options.renderFooterBar){c.options.renderFooterBar=function(f){wncd.currentDiv().reset().out("Wigii.org, NCD App (CWE), 24.03.2018, Agile Story Board v.1.01");if(f.context.startupLog){wncd.currentDiv().out(", ").out(f.context.startupLog)}}}c.impl.renderFilters=function(f){c.impl.headerBarEmitter=wncd.currentDiv();wncd.currentDiv().reset();if(!f||f.className!="WncdContainer"){wncd.currentDiv().button(c.options.createStoryButtonLabel,function(){c.impl.createStoryInColumn(c.options.storyStatuses[0])},"storyBoardCreateButton")}if(c.options.filterLabel){wncd.currentDiv().out(c.options.filterLabel,"storyBoardFilterLabel")}wncd.currentDiv().button(c.options.filterAllLabel,function(){c.impl.setAssigneeFilter()},"storyBoardFilter","storyBoardFilter_all");for(var h=0;h<c.context.storyAssignees.length;h++){var g=c.context.storyAssignees[h];wncd.currentDiv().button((g===null?c.options.filterUnassignedLabel:g),function(k,j){c.impl.setAssigneeFilter(j)},"storyBoardFilter","storyBoardFilter_"+h,g)}c.impl.setAssigneeFilter(c.context.assigneeFilter)};c.impl.setAssigneeFilter=function(f){var g="storyBoardFilter_all";if(c.context.assigneeFilter!==undefined){g=c.context.storyAssignees.indexOf(c.context.assigneeFilter);if(g>=0){g="storyBoardFilter_"+g}else{g="storyBoardFilter_all"}}$("#"+g).removeClass("activeFilter");g="storyBoardFilter_all";if(f!==undefined){g=c.context.storyAssignees.indexOf(f);if(g>=0){g="storyBoardFilter_"+g}else{g="storyBoardFilter_all"}}$("#"+g).addClass("activeFilter");if(c.context.assigneeFilter!==f){c.context.assigneeFilter=f;wncd.program.context.html(c.impl.workzoneEmitter);c.impl.renderStoryBoard(a)}};c.impl.renderStoryBoard=function(f){c.impl.workzoneEmitter=wncd.currentDiv();wncd.currentDiv().reset().layout(function(o,u,m,l,k,B,y,w,t,s,q,x){var r=[];for(var n=0;n<c.options.storyStatuses.length;n++){var A;if(c.options.storyStatusesLabel&&c.options.storyStatusesLabel.length>n){A=c.options.storyStatusesLabel[n]}else{A=c.options.storyStatuses[n]}var z=m.v(m(A).cssClass("storyBoardColumnHeader").minHeight("50px"),q().cssClass("storyBoardColumnContent")).id(c.ctxKey+"_"+n).cssClass("storyBoardColumn");r.push(z)}return o.apply(undefined,r).id(c.ctxKey).cssClass("storyBoard").width("100%").height("100%")});if(c.options.columnHeaderBackgroundColor){c.$().find("div.storyBoardColumnHeader").css("background-color",c.options.columnHeaderBackgroundColor)}if(c.options.columnHeaderColor){c.$().find("div.storyBoardColumnHeader").css("color",c.options.columnHeaderColor)}c.$().find("div.storyBoardColumnContent").droppable({accept:"div.story",hoverClass:"dragOn",drop:function(l,m){var k=Number($(this).parent().attr("id").replace(c.ctxKey+"_",""));var n=m.draggable.attr("id").replace("story_","");m.draggable.draggable("option","revert",false);c.impl.moveStoryToColumn(c.context.storiesIndex[n],c.options.storyStatuses[k])}});c.context.stories.sort(function(l,k){if(l.position===undefined){l.position=0}if(k.position===undefined){k.position=0}return l.position-k.position});var g=[];for(var j=0;j<c.context.stories.length;j++){var h=c.context.stories[j];if(h.status=="5completer"){g.push(h)}else{if(!h.deleted&&(c.context.assigneeFilter===undefined||c.context.assigneeFilter==h.assignee)){c.impl.addStoryToBoard(h)}}}g.sort(function(l,k){if(l.date===undefined){l.date=0}if(k.date===undefined){k.date=0}return k.date-l.date});for(var j=0;j<g.length;j++){var h=g[j];if(!h.deleted&&(c.context.assigneeFilter===undefined||c.context.assigneeFilter==h.assignee)){c.impl.addStoryToBoard(h)}}};c.impl.addStoryToBoard=function(k,j){var g=c.options.storyStatuses.indexOf(k.status);if(g>=0){var h=$("#"+c.ctxKey+"_"+g+" div.storyBoardColumnContent").wncd("html").div("story_"+k.id,"story");h.$().attr("data-storypos",k.position);h.$().attr("data-storydate",k.date);if(j){var m=h.$().parent().find("div.story").filter(function(n,f){if(k.status=="5completer"){return $(this).attr("data-storydate")<k.date}else{return $(this).attr("data-storypos")>k.position}});if(m.length>0){h.$().insertBefore(m[0])}}c.options.renderStory(c,h,k);$("#story_"+k.id).draggable({containment:"#"+c.ctxKey,cursor:"move",helper:"clone",revert:true});if(a&&a.className=="WncdContainer"){$("#story_"+k.id).click(function(){a.showElement(k.id)})}var l;if(a&&a.className=="WncdContainer"){l=function(f){a.editElement(k.id);f.stopPropagation()}}else{l=function(){var f=$(this).parent().attr("id").replace("story_","");c.impl.editStory(c.context.storiesIndex[f])}}$("#story_"+k.id+" span.storyEditButton").click(l);if(a&&a.className=="WncdContainer"){l=function(f){a.deleteElement(k.id);f.stopPropagation()}}else{l=function(){var f=$(this).parent().attr("id").replace("story_","");c.impl.deleteStory(c.context.storiesIndex[f])}}$("#story_"+k.id+" span.storyDeleteButton").click(l);if(c.options.noOrdering!=true){$("#story_"+k.id+" span.storyMoveTopButton").click(function(n){var o=$(this).parent().attr("id").replace("story_","");var f=c.context.storiesIndex[o];c.impl.moveStoryToTop(f);n.stopPropagation()})}if(c.options.noOrdering!=true){$("#story_"+k.id+" span.storyMoveUpButton").click(function(o){var q=$(this).parent().attr("id").replace("story_","");var n=c.context.storiesIndex[q];var f=$("#story_"+q).prev();if(f){q=f.attr("id").replace("story_","");f=c.context.storiesIndex[q];c.impl.swapStoryUp(n,f)}o.stopPropagation()})}if(c.options.noOrdering!=true){$("#story_"+k.id+" span.storyMoveDownButton").click(function(o){var q=$(this).parent().attr("id").replace("story_","");var f=c.context.storiesIndex[q];var n=$("#story_"+q).next();if(n){q=n.attr("id").replace("story_","");n=c.context.storiesIndex[q];c.impl.swapStoryUp(n,f)}o.stopPropagation()})}if(c.options.noOrdering!=true){$("#story_"+k.id+" span.storyMoveBottomButton").click(function(n){var o=$(this).parent().attr("id").replace("story_","");var f=c.context.storiesIndex[o];c.impl.moveStoryToBottom(f);n.stopPropagation()})}}};c.impl.swapStoryUp=function(h,f){var g=f.position;f.position=h.position;h.position=g;if(a&&a.className=="WncdContainer"){a.saveFieldValue(h.id,c.options.elementPositionField,h.position,{noCalculation:(c.options.noCalculation==true),noNotification:(c.options.noNotification==true)});a.saveFieldValue(f.id,c.options.elementPositionField,f.position,{noCalculation:(c.options.noCalculation==true),noNotification:(c.options.noNotification==true)})}$("#story_"+h.id).insertBefore($("#story_"+f.id));$("#story_"+h.id).attr("data-storypos",h.position);$("#story_"+f.id).attr("data-storypos",f.position)};c.impl.moveStoryToTop=function(g){var f=$("#story_"+g.id).parent().children("div:first-child");if(f.attr("id")!="story_"+g.id){g.position=Number(f.attr("data-storypos"))-(10+90*Math.random());if(a&&a.className=="WncdContainer"){a.saveFieldValue(g.id,c.options.elementPositionField,g.position,{noCalculation:(c.options.noCalculation==true),noNotification:(c.options.noNotification==true)})}$("#story_"+g.id).insertBefore(f).attr("data-storypos",g.position)}};c.impl.moveStoryToBottom=function(g){var f=$("#story_"+g.id).parent().children("div:last-child");if(f.attr("id")!="story_"+g.id){g.position=Number(f.attr("data-storypos"))+(10+90*Math.random());if(a&&a.className=="WncdContainer"){a.saveFieldValue(g.id,c.options.elementPositionField,g.position,{noCalculation:(c.options.noCalculation==true),noNotification:(c.options.noNotification==true)})}$("#story_"+g.id).insertAfter(f).attr("data-storypos",g.position)}};c.impl.createStoryInColumn=function(g){var f=c.options.storyStatuses.indexOf(g);if(f==-1){throw wncd.createServiceException("status '"+g+"' is not on the board",wncd.errorCodes.INVALID_ARGUMENT)}var h={id:Date.now(),status:g,position:c.context.stories.length+1,label:"",assignee:"",description:"",deleted:false};c.impl.editStory(h)};c.impl.editStory=function(f){wncd.program.context.html(c.impl.workzoneEmitter);wncd.currentDiv().reset().htmlBuilder().tag("div","class","storyBoardForm").insert(function(g){wncd.form.no("editStory").supprimer();wncd.form.no("editStory").createField("storyLabel","Titre du déliverable").createField("storyAssignee","Assigné à").createTextField("storyDescription","Décrire succintement le travail à accomplir").field("storyLabel").value(g.label).focus();wncd.form.no("editStory").field("storyDescription").value(g.description);wncd.form.no("editStory").field("storyAssignee").value(g.assignee).context.display.autocomplete(c.context.storyAssignees);wncd.currentDiv().button("OK",function(){g.label=wncd.form.no("editStory").field("storyLabel").value();g.assignee=wncd.form.no("editStory").field("storyAssignee").value();g.description=wncd.form.no("editStory").field("storyDescription").value();if(!c.context.storiesIndex[g.id]){c.context.stories.push(g);c.context.storiesIndex[g.id]=g}if(c.context.storyAssignees.indexOf(g.assignee)<0){c.context.storyAssignees.push(g.assignee);wncd.program.context.html(c.impl.headerBarEmitter);c.impl.renderFilters(a)}wncd.program.context.html(c.impl.workzoneEmitter);c.impl.renderStoryBoard(a)}).button("Cancel",function(){wncd.program.context.html(c.impl.workzoneEmitter);c.impl.renderStoryBoard(a)})},f).$tag("div").emit()};c.impl.deleteStory=function(f){f.deleted=true;c.impl.removeStoryFromBoard(f)};c.impl.removeStoryFromBoard=function(f){$("#story_"+f.id).remove()};c.impl.moveStoryToColumn=function(g,f){if(f!=g.status){if(a&&a.className=="WncdContainer"){var h=g.status;a.saveFieldValue(g.id,c.options.elementStatusField,f,{exceptionHandler:function(k,j){c.impl.removeStoryFromBoard(g);g.status=h;c.impl.addStoryToBoard(g,true);wncd.publishWigiiException(k,j)},noCalculation:(c.options.noCalculation==true),noNotification:(c.options.noNotification==true)})}c.impl.removeStoryFromBoard(g);g.status=f;c.impl.addStoryToBoard(g,true)}};if(a&&a.className=="Desktop"){c.options.obj=c;a.registerComponent(c.ctxKey,c.impl.renderFilters,c.impl.renderStoryBoard,c.options.renderFooterBar,c.options)}else{if(a&&a.className=="WncdContainer"){var d=a.getWigiiDataModel();a.iterateOnElementList(d,function(g,f,j){var h={};c.options.mapElement2Story(j,h);c.context.stories.push(h);c.context.storiesIndex[h.id]=h;if(c.context.storyAssignees.indexOf(h.assignee)<0){c.context.storyAssignees.push(h.assignee)}});a.dataChange(function(f,g){f.iterateOnElementList(g,function(j,h,l){var k={};c.options.mapElement2Story(l,k);c.context.storiesIndex[k.id]=k;if(c.context.storyAssignees.indexOf(k.assignee)<0){c.context.storyAssignees.push(k.assignee)}c.context.stories=Object.values(c.context.storiesIndex);wncd.program.context.html(c.impl.headerBarEmitter);c.impl.renderFilters(f);wncd.program.context.html(c.impl.workzoneEmitter);c.impl.renderStoryBoard(f)})});a.elementDeleted(function(f,g){var h=c.context.storiesIndex[g];if(h){c.impl.deleteStory(h)}})}wncd.currentDiv().layout(function(k,o,j,g,f,t,s,q,n,m,l,r){return o(j().id(c.ctxKey+"_filters").cssClass("storyBoardFilters"),r().id(c.ctxKey+"_storyBoard")).width(c.options.width).height(c.options.height)});wncd.program.context.html($("#"+c.ctxKey+"_filters").wncd("html"));c.impl.renderFilters(a);wncd.program.context.html($("#"+c.ctxKey+"_storyBoard").wncd("html"));c.impl.renderStoryBoard(a)}});wncd.createAgileStoryBoard=function(a,c){return new wncd.AgileStoryBoard(a,c)};wncd.comment(function(){},wncd.UIRecorder=function(c){var a=this;a.className="UIRecorder";a.instantiationTime=Date.now();a.ctxKey=wncd.ctxKey+"_"+a.className+a.instantiationTime;a.options=c||{};a.context={uiRecords:[]};a.impl={onUIRecordSubscribers:[],beforePlayUIRecordSubscribers:[],afterPlayUIRecordSubscribers:[]};a.interactionRules=function(d){if(d===undefined){return a.options.interactionRules}else{a.options.interactionRules=d;return a}};a.setupInteractionRules=function(d){var e=a.impl.createInteractiveRule;a.interactionRules(d(e));return a};a.start=function(){if(a.options.showGUI&&!a.context.playList){a.context.playList=a.context.playListEmitter.list(function(d){},a.impl.renderUIRecordInList)}a.impl.bindEvents();return a};a.refreshBindings=function(){a.impl.unbindEvents();a.impl.bindEvents();var e={};var d=$("body");e.timestamp=Date.now();e.eventName="refreshBindings";e.ctxKey=a.ctxKey;e.domId=d.attr("id");e.domElt=d.prop("tagName");e.cssClass=d.attr("class");e.selector="body";e.index=$(e.selector).index(d);a.impl.onUIRecord(d,e);return a};a.stop=function(){a.impl.unbindEvents();return a};a.reset=function(){a.stop();a.context.uiRecords=[];if(a.options.showGUI){a.context.playList=undefined;a.context.playListEmitter.reset()}a.start();return a};a.play=function(e){var d=wncd.ctlSeq();var f=undefined;e.forEach(function(g){d.addFx(wncd.fx(a.impl.playUIRecordProcess,g));if(g.eventName=="change"){d.addFx(wncd.pause(1))}if(g.eventName=="change"){d.addFx(wncd.pause(0.25))}if(g.eventName=="click"){d.addFx(wncd.pause(2))}if(g.eventName=="refreshBindings"){d.addFx(wncd.pause(1))}f=g});if(a.options.showGUI){a.context.playList.clearHighLight()}wncd.programme(d.toFx());return a};a.replay=function(){a.stop();a.play(a.context.uiRecords);return a};a.show=function(){wncd.popup(function(d){wncd.currentDiv().button("Start",a.start,"uiRecorderStartButton uiRecorderIgnore").button("Rebind",a.refreshBindings,"uiRecorderRebindButton uiRecorderIgnore").button("Stop",a.stop,"uiRecorderStopButton uiRecorderIgnore").button("Play",a.replay,"uiRecorderPlayButton uiRecorderIgnore").button("Reset",a.reset,"uiRecorderResetButton uiRecorderIgnore");a.context.playListEmitter=wncd.currentDiv().div(a.ctxKey+"_PlayList","uiRecorderPlayList uiRecorderIgnore")})};a.onUIRecord=function(d){if(!$.isFunction(d)){throw wncd.createServiceException("ui record event handler should be a function",wncd.errorCodes.INVALID_ARGUMENT)}a.impl.onUIRecordSubscribers.push(d);return a};a.beforePlayUIRecord=function(d){if(!$.isFunction(d)){throw wncd.createServiceException("beforePlayUIRecord event handler should be a function",wncd.errorCodes.INVALID_ARGUMENT)}a.impl.beforePlayUIRecordSubscribers.push(d);return a};a.afterPlayUIRecord=function(d){if(!$.isFunction(d)){throw wncd.createServiceException("afterPlayUIRecord event handler should be a function",wncd.errorCodes.INVALID_ARGUMENT)}a.impl.afterPlayUIRecordSubscribers.push(d);return a};a.impl.createInteractiveRule=function(e,d,f){return{uiObject:e,selector:d,eventType:f}};a.impl.playUIRecordProcess=function(e){if(a.impl.beforePlayUIRecordSubscribers.length>0){for(var d=0;d<a.impl.beforePlayUIRecordSubscribers.length;d++){a.impl.beforePlayUIRecordSubscribers[d](e,a)}}if(a.options.showGUI){a.context.playList.next()}a.impl.playUIRecord(e);if(a.impl.afterPlayUIRecordSubscribers.length>0){for(var d=0;d<a.impl.afterPlayUIRecordSubscribers.length;d++){a.impl.afterPlayUIRecordSubscribers[d](e,a)}}};a.impl.playUIRecord=function(e){if(e.eventName=="refreshBindings"){return}var d=[];if(e.domId){d=$(e.domId)}if(d.length==0&&e.index>-1){d=$(e.selector).eq(e.index)}if(d.length==0&&e.cssClass){d=$(e.selector).filter("."+e.cssClass.replace(/ /g,"."))}if(d.length!=1){wigii().log("not found "+e.selector+" "+e.index+" "+e.cssClass);return}if(e.eventName=="click"){d.click()}else{if(e.eventName=="input"){d.val(e.inputValue)}else{if(e.eventName=="change"){if(d.attr("type")=="checkbox"){d.click()}else{d.val(e.inputValue)}}}}};a.impl.renderUIRecordInList=function(d,f,e){return wncd.getHtmlBuilder().tag("span","class","uiRecordTimestamp").put(f.timestamp).$tag("span").tag("span","class","uiRecordEventName").put(f.eventName).$tag("span").put("on").tag("span","class","uiRecordCssClass").put(f.cssClass).$tag("span").put("from").tag("span","class","uiRecordSelector").put(f.selector).$tag("span").html()};a.impl.onEvent=function(e,d,f){if(f.hasClass("uiRecorderIgnore")){return}if(d[a.ctxKey]){return}var g={};g.timestamp=Date.now();g.eventName=e;g.ctxKey=a.ctxKey;g.domId=f.attr("id");g.domElt=f.prop("tagName");g.cssClass=f.attr("class");g.selector=d.data.firedRule.selector;g.index=$(g.selector).index(f);g.uiObject=d.data.firedRule.uiObject;g.inputValue=f.val();g.rightClick=(d.button===2);g.key=d.key;g.shiftKey=d.shiftKey;g.ctrlKey=d.ctrlKey;g.altKey=d.altKey;g.metaKey=d.metaKey;d[a.ctxKey]=g;a.impl.onUIRecord(f,g)};a.impl.onUIRecord=function(e,f){if(a.options.noBuffering!==true){a.context.uiRecords.push(f)}if(a.options.showGUI){a.context.playList.add(f)}if(a.impl.onUIRecordSubscribers.length>0){for(var d=0;d<a.impl.onUIRecordSubscribers.length;d++){a.impl.onUIRecordSubscribers[d](e,f,a)}}};a.impl.bindEvents=function(){a.options.interactionRules.forEach(function(e){var d=e.eventType;if($.isArray(d)){d=d.join(" ")}if(!e.eventHandler){e.eventHandler=function(g){a.impl.onEvent(g.type,g,$(this))}}var f={ctxKey:a.ctxKey,firedRule:e};$(e.selector).on(d,null,f,e.eventHandler)})};a.impl.unbindEvents=function(){a.options.interactionRules.forEach(function(e){if(e.eventHandler){var d=e.eventType;if($.isArray(d)){d=d.join(" ")}$(e.selector).off(d,null,e.eventHandler)}})};if(!a.options.interactionRules){a.setupInteractionRules(function(d){return[d("groupPanelCollapse","div#groupPanel div.collapse","click"),d("groupPanelFolderMenu","div#groupPanel div.cm, div#groupPanel div.cm > div","click"),d("groupPanelRootFolders","div#groupPanel ul#group_0","click"),d("groupPanelFolder","div#groupPanel ul#group_0 li, div#groupPanel ul#group_0 li > div > a","click"),d("groupPanelFolderExpand","div#groupPanel ul#group_0 li > div > span.folder","click"),d("groupPanelFolderMenu","div#groupPanel ul#group_0 li > div > span.menu","click"),d("homeMenu","ul#navigateMenuBsp li.home > a","click"),d("navigationMenu","ul#navigateMenuBsp li.dropdown > a, ul#navigateMenuBsp li.dropdown ul.dropdown-menu > li > a, ul#navigateMenuBsp li.dropdown-submenu ul.dropdown-menu > li > a","click"),d("elementListRow","div#moduleView div.dataZone tr.H","click"),d("elementMenu","div#moduleView div.dataZone tr.H > td > div.menu","click"),d("element","div#moduleView div.dataZone tr.H > td > div","click"),d("addNewElement","div.toolbarBox > div.addNewElement","click"),d("elementDetailButton","div#elementDialog div.T div.H","click"),d("elementField","div.field > div.value :input","change"),d("elementField","div.field > div.value :text","input"),d("elementField","div.field > div.addC.d","click"),d("elementField","div.field > div.label > span.expand","click"),d("elementField","div.field > div.label > span.H.addJournalItem","click"),d("link","a.H","click"),d("button","div.ui-dialog div.ui-dialog-buttonset > button.ui-button","click"),d("textInput",":text","input"),d("input",":input","change")]})}if(a.options.showGUI){a.show()}});wncd.createUIRecorder=function(a){return new wncd.UIRecorder(a)};